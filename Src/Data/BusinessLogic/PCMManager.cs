using DevExpress.Internal;
using Emdep.Geos.Data.BusinessLogic.Logging;
using Emdep.Geos.Data.Common;
using Emdep.Geos.Data.Common.Epc;
using Emdep.Geos.Data.Common.Hrm;
using Emdep.Geos.Data.Common.PCM;
using Emdep.Geos.Data.Common.PLM;
using Emdep.Geos.Data.Common.SynchronizationClass;
using Emdep.Geos.Data.DataAccess;
using Emdep.Geos.Services.Contracts;
using MySql.Data.MySqlClient;
using Newtonsoft.Json;
using Prism.Logging;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Configuration;
using System.Data;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using System.Transactions;
using System.Windows;

namespace Emdep.Geos.Data.BusinessLogic
{
    public class PCMManager
    {
        #region [GEOS2-5404][rdixit][13.08.2024]
        public PCMManager()
        {
            try
            {
                if (Log4NetLogger.Logger == null)
                {
                    string ApplicationLogFilePath = System.Web.Hosting.HostingEnvironment.MapPath("/") + "log4net.config";
                    CreateIfNotExists(ApplicationLogFilePath);
                    FileInfo file = new FileInfo(ApplicationLogFilePath);
                    Log4NetLogger.Logger = LoggerFactory.CreateLogger(LogType.Log4Net, file);
                    Log4NetLogger.Logger.Log(string.Format("PCMManager()..... Constructor Executed"), category: Category.Info, priority: Priority.Low);
                }
            }
            catch
            {
                throw;
            }
        }
        void CreateIfNotExists(string config_path)
        {
            string log4netConfig = @"<?xml version=""1.0"" encoding=""utf-8""?>
                                        <configuration>
                                          <configSections>
                                            <section name=""log4net"" type=""log4net.Config.Log4NetConfigurationSectionHandler, log4net"" />
                                          </configSections>
                                          <log4net debug=""true"">
                                            <appender name=""RollingLogFileAppender"" type=""log4net.Appender.RollingFileAppender"">
                                              <file value=""C:\Temp\LogsService.txt""/>
                                              <appendToFile value=""true"" />
                                              <rollingStyle value=""Size"" />
                                              <maxSizeRollBackups value=""10"" />
                                              <maximumFileSize value=""10MB"" />
                                              <staticLogFileName value=""true"" />
                                              <layout type=""log4net.Layout.PatternLayout"">
                                                <conversionPattern value=""%-5p %d %5rms - %m%n"" />
                                              </layout>
                                            </appender>
                                            <root>
                                              <level value=""Info"" />
                                              <appender-ref ref=""RollingLogFileAppender"" />
                                            </root>
                                          </log4net>
                                        </configuration>";

            if (!File.Exists(config_path))
            {
                File.WriteAllText(config_path, log4netConfig);
            }
        }
        #endregion

        #region Declaration 
        List<string> CurrencyIcon = new List<string>();
        DataTable DataTableArticleDecompostion;
        DataTable DataTableLinkedArticle;
        int treeviewcount = 1;
        #endregion

        #region Product Catalogue Manager

        #region Add methods

        /// <summary>
        /// This method is used to insert Catalogue Item
        /// </summary>
        /// <param name="catalogueItem">Get catalogue item details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public CatalogueItem AddCatalogueItem(CatalogueItem catalogueItem, string MainServerConnectionString, string CatalogueItemAttachedDocPath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    string lastestCatalogueItemCode = "";
                    lastestCatalogueItemCode = GetLatestCatalogueItemCode(MainServerConnectionString);
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItem_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCatalogueItemCode) && lastestCatalogueItemCode != catalogueItem.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCatalogueItemCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", catalogueItem.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdTemplate", catalogueItem.IdTemplate);
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", catalogueItem.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", catalogueItem.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", catalogueItem.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", catalogueItem.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", catalogueItem.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", catalogueItem.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", catalogueItem.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", catalogueItem.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", catalogueItem.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", catalogueItem.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", catalogueItem.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", catalogueItem.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", catalogueItem.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", catalogueItem.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", catalogueItem.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", catalogueItem.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_parent", catalogueItem.Parent);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", catalogueItem.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", catalogueItem.IsEnabled);

                        catalogueItem.IdCatalogueItem = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (catalogueItem.IdCatalogueItem > 0)
                    {
                        AddWaysByCatalogueItem(MainServerConnectionString, catalogueItem.IdCatalogueItem, 1, catalogueItem.WayList);
                        AddDetectionsByCatalogueItem(MainServerConnectionString, catalogueItem.IdCatalogueItem, 2, catalogueItem.DetectionList);
                        AddOptionsByCatalogueItem(MainServerConnectionString, catalogueItem.IdCatalogueItem, 3, catalogueItem.OptionList);
                        AddSparePartsByCatalogueItem(MainServerConnectionString, catalogueItem.IdCatalogueItem, 4, catalogueItem.SparePartList);
                        AddConnectorFamiliesByCatalogueItem(MainServerConnectionString, catalogueItem.IdCatalogueItem, catalogueItem.FamilyList);
                        AddCatalogueItemAttachedDocByCatalogueItem(MainServerConnectionString, catalogueItem.IdCatalogueItem, catalogueItem.FileList, CatalogueItemAttachedDocPath);
                        AddCatalogueItemAttachedLinkByCatalogueItem(MainServerConnectionString, catalogueItem.IdCatalogueItem, catalogueItem.CatalogueItemAttachedLinkList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCatalogueItem(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return catalogueItem;
        }

        /// <summary>
        /// This method is to insert ways by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get detection type id.</param>
        /// <param name="WayList">Get way list details.</param>
        public void AddWaysByCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<Ways> WayList)
        {
            try
            {
                if (WayList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WayList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddWaysByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to insert detections by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get detection type id.</param>
        /// <param name="DetectionList">Get detection list details.</param>
        public void AddDetectionsByCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<Detections> DetectionList)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Detections detectionList in DetectionList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to insert options by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get detection type id.</param>
        /// <param name="OptionList">Get option list details.</param>
        public void AddOptionsByCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<Options> OptionList)
        {
            try
            {
                if (OptionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Options optionList in OptionList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddOptionsByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to insert spare parts by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get detection type id.</param>
        /// <param name="SparePartList">Get spare part list details.</param>
        public void AddSparePartsByCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<SpareParts> SparePartList)
        {
            try
            {
                if (SparePartList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSparePartsByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to insert connector families by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="FamilyList">Get family list details.</param>
        public void AddConnectorFamiliesByCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem, List<ConnectorFamilies> FamilyList)
        {
            try
            {
                if (FamilyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in FamilyList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCatalogueItem_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                            mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddConnectorFamiliesByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, productType.CreatedBy);
                        AddSitesByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        /// <summary>
        /// This method is used to insert ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public DetectionDetails AddDetection(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }

        /// <summary>
        /// This method is used to insert product type by template
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="IdCPType">Get product type id.</param>
        public void AddProductTypeByTemplate(string MainServerConnectionString, UInt64 IdTemplate, UInt64 IdCPType)
        {
            try
            {
                if (IdTemplate > 0)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeByTemplate(). IdTemplate- {0} ErrorMessage- {1}", IdTemplate, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert product type Attached Doc
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeAttachedDoc">Get product Type Attached Doc details.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type Attached Doc Path.</param>
        public void AddProductTypeAttachedDocByProductType(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeAttachedDoc> ProductTypeAttachedDocList, string ProductTypeAttachedDocPath)
        {
            try
            {
                if (ProductTypeAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedDoc productTypeAttachedDocList in ProductTypeAttachedDocList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedDocList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IdDocType", productTypeAttachedDocList.IdDocType);

                            productTypeAttachedDocList.IdCPTypeAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                            if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                            {
                                AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeAttachedDocByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add product type Attached Doc to path
        /// </summary>
        /// <param name="productTypeAttachedDoc">Get product Type Attached Doc details.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type Attached Doc Path.</param>
        public bool AddProductTypeAttachedDocToPath(ProductTypeAttachedDoc productTypeAttachedDoc, string ProductTypeAttachedDocPath)
        {
            if (productTypeAttachedDoc.ProductTypeAttachedDocInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", ProductTypeAttachedDocPath, productTypeAttachedDoc.IdCPTypeAttachedDoc);
                    string filePath = completePath + "\\" + productTypeAttachedDoc.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    else
                    {
                        DirectoryInfo di = new DirectoryInfo(completePath);
                        foreach (FileInfo file in di.GetFiles())
                        {
                            file.Delete();
                        }
                    }

                    File.WriteAllBytes(filePath, productTypeAttachedDoc.ProductTypeAttachedDocInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeAttachedDocToPath()- Filename - {0}. ErrorMessage- {1}", productTypeAttachedDoc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is used to insert files by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="CatalogueItemAttachedDocList">Get File list details.</param>
        /// <param name="CatalogueItemAttachedDocPath">Get Catalogue Item Attached Doc Path.</param>
        public void AddCatalogueItemAttachedDocByCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem, List<CatalogueItemAttachedDoc> CatalogueItemAttachedDocList, string CatalogueItemAttachedDocPath)
        {
            try
            {
                if (CatalogueItemAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CatalogueItemAttachedDoc catalogueItemAttachedDocList in CatalogueItemAttachedDocList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItemAttachedDocs_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", catalogueItemAttachedDocList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", catalogueItemAttachedDocList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", catalogueItemAttachedDocList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", catalogueItemAttachedDocList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IdDocType", catalogueItemAttachedDocList.IdDocType);

                            catalogueItemAttachedDocList.IdCatalogueItemAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                            if (catalogueItemAttachedDocList.IdCatalogueItemAttachedDoc > 0)
                            {
                                AddCatalogueItemAttachedDocToPath(catalogueItemAttachedDocList, CatalogueItemAttachedDocPath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCatalogueItemAttachedDocByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add Catalogue Item Attached Doc to path
        /// </summary>
        /// <param name="CatalogueItemAttachedDoc">Get Catalogue Item Attached Doc details.</param>
        /// <param name="CatalogueItemAttachedDocPath">Get Catalogue Item Attached Doc Path.</param>
        public bool AddCatalogueItemAttachedDocToPath(CatalogueItemAttachedDoc CatalogueItemAttachedDoc, string CatalogueItemAttachedDocPath)
        {
            if (CatalogueItemAttachedDoc.CatalogueItemAttachedDocInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", CatalogueItemAttachedDocPath, CatalogueItemAttachedDoc.IdCatalogueItemAttachedDoc);
                    string filePath = completePath + "\\" + CatalogueItemAttachedDoc.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    else
                    {
                        DirectoryInfo di = new DirectoryInfo(completePath);
                        foreach (FileInfo file in di.GetFiles())
                        {
                            file.Delete();
                        }
                    }
                    File.WriteAllBytes(filePath, CatalogueItemAttachedDoc.CatalogueItemAttachedDocInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCatalogueItemAttachedDocToPath()- Filename - {0}. ErrorMessage- {1}", CatalogueItemAttachedDoc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is used to insert files by Detection
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get Detection id.</param>
        /// <param name="DetectionAttachedDocList">Get File list details.</param>
        /// <param name="DetectionAttachedDocPath">Get Detection Attached Doc Path.</param>
        public void AddDetectionAttachedDocByDetection(string MainServerConnectionString, UInt32 IdDetection, List<DetectionAttachedDoc> DetectionAttachedDocList, string DetectionAttachedDocPath)
        {
            try
            {
                if (DetectionAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionAttachedDoc detectionAttachedDocList in DetectionAttachedDocList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionAttachedDocList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedDocList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionAttachedDocList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionAttachedDocList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IdDocType", detectionAttachedDocList.IdDocType);

                            detectionAttachedDocList.IdDetectionAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                            if (detectionAttachedDocList.IdDetectionAttachedDoc > 0)
                            {
                                AddDetectionAttachedDocToPath(detectionAttachedDocList, DetectionAttachedDocPath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionAttachedDocByDetection(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add Detection Attached Doc to path
        /// </summary>
        /// <param name="DetectionAttachedDoc">Get Detection Attached Doc details.</param>
        /// <param name="DetectionAttachedDocPath">Get Detection Attached Doc Path.</param>
        public bool AddDetectionAttachedDocToPath(DetectionAttachedDoc DetectionAttachedDoc, string DetectionAttachedDocPath)
        {
            if (DetectionAttachedDoc.DetectionAttachedDocInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", DetectionAttachedDocPath, DetectionAttachedDoc.IdDetectionAttachedDoc);
                    string filePath = completePath + "\\" + DetectionAttachedDoc.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    else
                    {
                        DirectoryInfo di = new DirectoryInfo(completePath);
                        foreach (FileInfo file in di.GetFiles())
                        {
                            file.Delete();
                        }
                    }
                    File.WriteAllBytes(filePath, DetectionAttachedDoc.DetectionAttachedDocInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetectionAttachedDocToPath()- Filename - {0}. ErrorMessage- {1}", DetectionAttachedDoc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is used to insert product type Attached Link
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product Type ID.</param>
        /// <param name="ProductTypeAttachedLinkList">Get product Type Attached Link details.</param>
        public void AddProductTypeAttachedLinkByProductType(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeAttachedLink> ProductTypeAttachedLinkList)
        {
            try
            {
                if (ProductTypeAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedLink productTypeAttachedLinkList in ProductTypeAttachedLinkList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_Name", productTypeAttachedLinkList.Name);
                            mySqlCommand.Parameters.AddWithValue("_Address", productTypeAttachedLinkList.Address);
                            mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedLinkList.Description);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedLinkList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeAttachedLink(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert Catalogue Item Attached Link
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get Catalogue Item ID.</param>
        /// <param name="CatalogueItemAttachedLinkList">Get Catalogue Item Attached Link details.</param>
        public void AddCatalogueItemAttachedLinkByCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem, List<CatalogueItemAttachedLink> CatalogueItemAttachedLinkList)
        {
            try
            {
                if (CatalogueItemAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CatalogueItemAttachedLink catalogueItemAttachedLinkList in CatalogueItemAttachedLinkList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItems_AttachedLinks_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                            mySqlCommand.Parameters.AddWithValue("_Name", catalogueItemAttachedLinkList.Name);
                            mySqlCommand.Parameters.AddWithValue("_Address", catalogueItemAttachedLinkList.Address);
                            mySqlCommand.Parameters.AddWithValue("_Description", catalogueItemAttachedLinkList.Description);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", catalogueItemAttachedLinkList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCatalogueItemAttachedLinkByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert Detection Attached Link
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get Detection ID.</param>
        /// <param name="DetectionAttachedLinkList">Get Detection Attached Link details.</param>
        public void AddDetectionAttachedLinkByDetection(string MainServerConnectionString, UInt32 IdDetection, List<DetectionAttachedLink> DetectionAttachedLinkList)
        {
            try
            {
                if (DetectionAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionAttachedLink detectionAttachedLinkList in DetectionAttachedLinkList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_AttachedLinks_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_Name", detectionAttachedLinkList.Name);
                            mySqlCommand.Parameters.AddWithValue("_Address", detectionAttachedLinkList.Address);
                            mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedLinkList.Description);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionAttachedLinkList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionAttachedLinkByDetection(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert ways by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="WayList">Get way list details.</param>
        public void AddWaysByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Ways> WayList)
        {
            try
            {
                if (WayList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WayList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddWaysByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert detections by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="DetectionList">Get detection list details.</param>
        public void AddDetectionsByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Detections> DetectionList)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Detections detectionList in DetectionList)
                        {
                            if (detectionList.IdDetections > 0)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionList.OrderNumber);

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert options by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="OptionList">Get option list details.</param>
        public void AddOptionsByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Options> OptionList)
        {
            try
            {
                if (OptionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Options optionList in OptionList)
                        {
                            if (optionList.IdOptions > 0)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", optionList.OrderNumber);

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddOptionsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert spare parts by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="SparePartList">Get spare part list details.</param>
        public void AddSparePartsByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<SpareParts> SparePartList)
        {
            try
            {
                if (SparePartList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSparePartsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to insert spare parts by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="SparePartList">Get spare part list details.</param>
        public void AddSparePartsByProductType_V2140(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<SpareParts> SparePartList)
        {
            try
            {
                if (SparePartList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                            mySqlCommand.Parameters.AddWithValue("_OrderNumber", sparePartsList.OrderNumber);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSparePartsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert connector families by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="FamilyList">Get family list details.</param>
        public void AddConnectorFamiliesByProductType(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> FamilyList)
        {
            try
            {
                if (FamilyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in FamilyList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddConnectorFamiliesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert product type by template
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="TemplateList">Get template list details.</param>
        /// <param name="IdCPType">Get product type id.</param>
        public void AddTemplatesByProductType(string MainServerConnectionString, List<Template> TemplateList, UInt64 IdCPType)
        {
            try
            {
                if (TemplateList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Template templateList in TemplateList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", templateList.IdTemplate);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddTemplatesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert product type image
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeImage">Get product Type Image details.</param>
        /// <param name="ProductTypeImagePath">Get product type Image Path.</param>
        public void AddProductTypeImageByProductType(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeImage> ProductTypeImageList, string ProductTypeImagePath)
        {
            try
            {
                if (ProductTypeImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeImage productTypeImageList in ProductTypeImageList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeImageList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", productTypeImageList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeImageList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeImageList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Position", productTypeImageList.Position);

                            productTypeImageList.IdCPTypeImage = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                            if (productTypeImageList.IdCPTypeImage > 0)
                            {
                                AddProductTypeImageToPath(productTypeImageList, ProductTypeImagePath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeImageByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add product type image to path
        /// </summary>
        /// <param name="productTypeImage">Get product Type Image details.</param>
        /// <param name="ProductTypeImagePath">Get product type Image Path.</param>
        public bool AddProductTypeImageToPath(ProductTypeImage productTypeImage, string ProductTypeImagePath)
        {
            if (productTypeImage.ProductTypeImageInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", ProductTypeImagePath, productTypeImage.IdCPTypeImage);
                    string filePath = completePath + "\\" + productTypeImage.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    else
                    {
                        DirectoryInfo di = new DirectoryInfo(completePath);
                        foreach (FileInfo file in di.GetFiles())
                        {
                            file.Delete();
                        }
                    }
                    File.WriteAllBytes(filePath, productTypeImage.ProductTypeImageInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeImageToPath()- Filename - {0}. ErrorMessage- {1}", productTypeImage.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is used to insert detection image
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="DetectionImageList">Get detection Image details.</param>
        /// <param name="DetectionImagePath">Get detection Image Path.</param>
        public void AddDetectionImageByDetection(string MainServerConnectionString, UInt32 IdDetection, List<DetectionImage> DetectionImageList, string DetectionImagePath)
        {
            try
            {
                if (DetectionImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionImage detectionImageList in DetectionImageList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionImages_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionImageList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", detectionImageList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionImageList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionImageList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Position", detectionImageList.Position);

                            detectionImageList.IdDetectionImage = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                            if (detectionImageList.IdDetectionImage > 0)
                            {
                                AddDetectionImageToPath(detectionImageList, DetectionImagePath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionImageByDetection(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add detection image to path
        /// </summary>
        /// <param name="detectionImage">Get detection Image details.</param>
        /// <param name="DetectionImagePath">Get detection Image Path.</param>
        public bool AddDetectionImageToPath(DetectionImage detectionImage, string DetectionImagePath)
        {
            if (detectionImage.DetectionImageInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", DetectionImagePath, detectionImage.IdDetectionImage);
                    string filePath = completePath + "\\" + detectionImage.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    else
                    {
                        DirectoryInfo di = new DirectoryInfo(completePath);
                        foreach (FileInfo file in di.GetFiles())
                        {
                            file.Delete();
                        }
                    }
                    File.WriteAllBytes(filePath, detectionImage.DetectionImageInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetectionImageToPath()- Filename - {0}. ErrorMessage- {1}", detectionImage.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is used to insert product type log entry
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="LogList">Get log list details.</param>
        public void AddProductTypeLogEntry(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByCptype_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeLogEntry(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert detection group
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetectionType">Get detection type.</param>
        /// <param name="DetectionGroupList">Get detection Group details.</param>
        public void AddDetectionGroup(string MainServerConnectionString, UInt32 IdDetectionType, List<DetectionGroup> DetectionGroupList)
        {
            try
            {
                if (DetectionGroupList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionGroup detectionGroupList in DetectionGroupList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Groups_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_Name", detectionGroupList.Name);
                            mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionGroupList.OrderNumber);
                            mySqlCommand.Parameters.AddWithValue("_Name_es", detectionGroupList.Name_es);
                            mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionGroupList.Name_fr);
                            mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionGroupList.Name_pt);
                            mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionGroupList.Name_ro);
                            mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionGroupList.Name_zh);
                            mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionGroupList.Name_ru);
                            mySqlCommand.Parameters.AddWithValue("_Description", detectionGroupList.Description);
                            mySqlCommand.Parameters.AddWithValue("_Description_es", detectionGroupList.Description_es);
                            mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionGroupList.Description_fr);
                            mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionGroupList.Description_pt);
                            mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionGroupList.Description_ro);
                            mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionGroupList.Description_zh);
                            mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionGroupList.Description_ru);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionGroupList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            detectionGroupList.IdGroup = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionGroup(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert customers and regions by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomerList">Get customer list details.</param>
        public void AddCustomersRegionsByProductType(string MainServerConnectionString, UInt64 IdCPType, List<RegionsByCustomer> CustomerList, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (RegionsByCustomer customerList in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersRegionsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to insert customers and regions by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomerList">Get customer list details.</param>
        public void AddSitesByProductType(string MainServerConnectionString, UInt64 IdCPType, List<RegionsByCustomer> CustomersList, string PCMConnectionString)
        {
            try
            {
                if (CustomersList != null)
                {
                    List<Site> SitesAddCustomerList = new List<Site>();

                    try
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegion", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            foreach (RegionsByCustomer customerList in CustomersList)
                            {
                                mySqlCommand.Parameters.Clear();
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                {
                                    while (reader.Read())
                                    {
                                        if (reader["IdSite"] != DBNull.Value)
                                        {
                                            Site site = new Site();
                                            site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                            SitesAddCustomerList.Add(site);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType - PCM_GetSitesByCustomerAndRegion. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        throw;
                    }

                    if (SitesAddCustomerList != null && SitesAddCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesAddCustomerList = SitesAddCustomerList.Distinct().ToList();
                            foreach (Site site in SitesAddCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType - PCM_SitesByCPType_Insert. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert customers and regions by detection
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="CustomerList">Get customer list details.</param>
        /// <param name="IdDetectiontype">Get detection type id.</param>
        public void AddCustomersRegionsByDetection(string MainServerConnectionString, UInt32 IdDetection, List<RegionsByCustomer> CustomerList, UInt32 IdDetectiontype, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (RegionsByCustomer customerList in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersRegionsByDetection(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to insert detection log entry
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="IdDetectionType">Get detection type id.</param>
        /// <param name="LogList">Get log list details.</param>
        public void AddDetectionLogEntry(string MainServerConnectionString, UInt32 IdDetection, List<DetectionLogEntry> LogList, UInt32 IdDetectionType)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByDetection_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionLogEntry(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to insert pcm article categories
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="pcmArticleCategory">get pcm article category details.</param>
        public PCMArticleCategory AddPCMArticleCategory(string MainServerConnectionString, PCMArticleCategory pcmArticleCategory, List<PCMArticleCategory> pcmArticleCategoryList)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Category_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", pcmArticleCategory.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", pcmArticleCategory.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", pcmArticleCategory.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", pcmArticleCategory.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", pcmArticleCategory.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", pcmArticleCategory.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", pcmArticleCategory.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", pcmArticleCategory.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", pcmArticleCategory.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", pcmArticleCategory.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", pcmArticleCategory.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", pcmArticleCategory.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", pcmArticleCategory.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", pcmArticleCategory.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                        mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", pcmArticleCategory.IdArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Parent", pcmArticleCategory.Parent);
                        mySqlCommand.Parameters.AddWithValue("_IsLeaf", pcmArticleCategory.IsLeaf);
                        mySqlCommand.Parameters.AddWithValue("_IdCreator", pcmArticleCategory.IdCreator);

                        pcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    //update position of pcm article categories
                    UpdatePCMArticleCategoryPosition(MainServerConnectionString, pcmArticleCategoryList, pcmArticleCategory.IdCreator);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPCMArticleCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return pcmArticleCategory;
        }


        /// <summary>
        /// This method is used to insert Compatibilities by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CompatibilityList">Get Compatibility List details.</param>
        public bool AddCompatibilitiesByProductType(string MainServerConnectionString, byte IdCPType, List<ProductTypeCompatibility> CompatibilityList)
        {
            bool isSave = false;
            try
            {
                if (CompatibilityList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeCompatibility productTypeCompatibility in CompatibilityList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPtype", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdCPtypeCompatibility", productTypeCompatibility.IdCPtypeCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_IdArticleCompatibility", productTypeCompatibility.IdArticleCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_IdTypeCompatibility", productTypeCompatibility.IdTypeCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_MinimumElements", productTypeCompatibility.MinimumElements);
                            mySqlCommand.Parameters.AddWithValue("_MaximumElements", productTypeCompatibility.MaximumElements);
                            if (productTypeCompatibility.IdRelationshipType == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", productTypeCompatibility.IdRelationshipType);
                            }
                            mySqlCommand.Parameters.AddWithValue("_Quantity", productTypeCompatibility.Quantity);
                            mySqlCommand.Parameters.AddWithValue("_Remarks", productTypeCompatibility.Remarks);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", productTypeCompatibility.IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                    isSave = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCompatibilitiesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isSave;
        }

        /// <summary>
        /// This method is used to insert Compatibilities by Article
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdArticle">Get Article id.</param>
        /// <param name="CompatibilityList">Get Compatibility List details.</param>
        public bool AddCompatibilitiesByArticle(string MainServerConnectionString, UInt32 IdArticle, List<ArticleCompatibility> CompatibilityList)
        {
            bool isSave = false;
            try
            {
                if (CompatibilityList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ArticleCompatibility articleCompatibility in CompatibilityList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_article_compatibilities_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdArticleCompatibility", articleCompatibility.IdArticleCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_IdTypeCompatibility", articleCompatibility.IdTypeCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_MinimumElements", articleCompatibility.MinimumElements);
                            mySqlCommand.Parameters.AddWithValue("_MaximumElements", articleCompatibility.MaximumElements);
                            if (articleCompatibility.IdRelationshipType == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", articleCompatibility.IdRelationshipType);
                            }
                            mySqlCommand.Parameters.AddWithValue("_Quantity", articleCompatibility.Quantity);
                            mySqlCommand.Parameters.AddWithValue("_Remarks", articleCompatibility.Remarks);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", articleCompatibility.IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCompatibilitiesByArticle(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isSave;
        }

        public void AddPCMArticleLogEntry(string MainServerConnectionString, UInt32 IdArticle, List<PCMArticleLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PCMArticleLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByPCMArticle_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddPCMArticleLogEntry(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public bool AddPCMArticleImageToPath(PCMArticleImage Image, string ImagePath, string ArticleReference)
        {
            if (Image.PCMArticleImageInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", ImagePath, ArticleReference);
                    string filePath = completePath + "\\" + Image.IdPCMArticleImage + "_" + Image.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    string[] filePaths = Directory.GetFiles(completePath, Image.IdPCMArticleImage + "_*", SearchOption.AllDirectories);
                    foreach (string file in filePaths)
                    {
                        File.Delete(file);
                    }
                    File.WriteAllBytes(filePath, Image.PCMArticleImageInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPCMArticleImageToPath()- Filename - {0}. ErrorMessage- {1}", Image.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }
        #endregion

        #region Update methods

        /// <summary>
        /// This method is used to Update Catalogue Item
        /// </summary>
        /// <param name="catalogueItemModel">Get catalogue item details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateCatalogueItem(CatalogueItem catalogueItemModel, string MainServerConnectionString, string CatalogueItemAttachedDocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItem_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", catalogueItemModel.IdCatalogueItem);
                        mySqlCommand.Parameters.AddWithValue("_IdTemplate", catalogueItemModel.IdTemplate);
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", catalogueItemModel.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", catalogueItemModel.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", catalogueItemModel.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", catalogueItemModel.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", catalogueItemModel.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", catalogueItemModel.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", catalogueItemModel.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", catalogueItemModel.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", catalogueItemModel.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", catalogueItemModel.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", catalogueItemModel.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", catalogueItemModel.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", catalogueItemModel.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", catalogueItemModel.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", catalogueItemModel.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", catalogueItemModel.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_parent", catalogueItemModel.Parent);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", catalogueItemModel.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete ways, detections, options, spare parts & families
                    AddDeleteWays(MainServerConnectionString, catalogueItemModel.IdCatalogueItem, 1, catalogueItemModel.WayList);
                    AddDeleteDetections(MainServerConnectionString, catalogueItemModel.IdCatalogueItem, 2, catalogueItemModel.DetectionList);
                    AddDeleteOptions(MainServerConnectionString, catalogueItemModel.IdCatalogueItem, 3, catalogueItemModel.OptionList);
                    AddDeleteSpareParts(MainServerConnectionString, catalogueItemModel.IdCatalogueItem, 4, catalogueItemModel.SparePartList);
                    AddDeleteFamilies(MainServerConnectionString, catalogueItemModel.IdCatalogueItem, catalogueItemModel.FamilyList);
                    AddUpdateDeleteCatalogueItemFiles(MainServerConnectionString, catalogueItemModel.IdCatalogueItem, catalogueItemModel.FileList, CatalogueItemAttachedDocPath);
                    AddUpdateDeleteCatalogueItemLinks(MainServerConnectionString, catalogueItemModel.IdCatalogueItem, catalogueItemModel.CatalogueItemAttachedLinkList);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", catalogueItemModel.IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddDeleteWaysByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddDeleteSparePartsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, productType.ModifiedBy);
                    AddDeleteSitesByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, PCMConnectionString);
                    AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateDetection(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);

                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update product type image
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeImage">Get product Type Image details.</param>
        /// <param name="ProductTypeImagePath">Get product type Image Path.</param>
        public bool IsUpdateProductTypeImage(ProductTypeImage productTypeImage, string ProductTypeImagePath, string MainServerConnectionString)
        {
            bool isUpdated = false;
            try
            {
                if (productTypeImage.ProductTypeImageInBytes != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCPTypeImage", productTypeImage.IdCPTypeImage);
                        mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeImage.SavedFileName);
                        mySqlCommand.Parameters.AddWithValue("_Description", productTypeImage.Description);
                        mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeImage.OriginalFileName);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeImage.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_Position", productTypeImage.Position);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    AddProductTypeImageToPath(productTypeImage, ProductTypeImagePath);
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdateProductTypeImage(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update product type Attached Doc
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeAttachedDoc">Get product Type Attached Doc details.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type Attached Doc Path.</param>
        public bool IsUpdateProductTypeAttachedDoc(ProductTypeAttachedDoc productTypeAttachedDoc, string ProductTypeAttachedDocPath, string MainServerConnectionString)
        {
            bool isUpdated = false;
            try
            {
                if (productTypeAttachedDoc.ProductTypeAttachedDocInBytes != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDoc.IdCPTypeAttachedDoc);
                        mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDoc.SavedFileName);
                        mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDoc.Description);
                        mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDoc.OriginalFileName);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeAttachedDoc.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdDocType", productTypeAttachedDoc.IdDocType);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    AddProductTypeAttachedDocToPath(productTypeAttachedDoc, ProductTypeAttachedDocPath);
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdateProductTypeAttachedDoc(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update template by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product Type Id.</param>
        /// <param name="IdTemplate">Get template Id.</param>
        public bool IsUpdateTemplateByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, UInt64 IdTemplate_Old)
        {
            bool isUpdated = false;
            try
            {
                if (IdTemplate > 0)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        if (IdTemplate_Old == 0)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        else
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate_old", IdTemplate_Old);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdateTemplateByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }


        /// <summary>
        /// This method is used to Add/Update/Delete Product Type Links
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdPCMArticleCategory">Get PCM Article Category id.</param>
        /// <param name="ArticleList">Article List details.</param>
        public bool IsUpdatePCMArticleCategoryInArticle(string MainServerConnectionString, uint IdPCMArticleCategory, List<Articles> ArticleList)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (ArticleList != null)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            foreach (Articles Article in ArticleList)
                            {
                                if (Article.IdArticle > 0)
                                {
                                    if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Update", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", null);
                                        mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                    else if (Article.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Update", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                                        mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategoryInArticle(). IdPCMArticleCategory- {0} ErrorMessage- {1}", IdPCMArticleCategory, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update pcm article category
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="pcmArticleCategory">Get pcm article category details.</param>
        public bool IsUpdatePCMArticleCategory(string MainServerConnectionString, PCMArticleCategory pcmArticleCategory, List<PCMArticleCategory> pcmArticleCategoryList)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Category_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", pcmArticleCategory.IdPCMArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Name", pcmArticleCategory.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", pcmArticleCategory.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", pcmArticleCategory.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", pcmArticleCategory.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", pcmArticleCategory.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", pcmArticleCategory.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", pcmArticleCategory.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", pcmArticleCategory.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", pcmArticleCategory.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", pcmArticleCategory.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", pcmArticleCategory.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", pcmArticleCategory.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", pcmArticleCategory.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", pcmArticleCategory.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                        mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", pcmArticleCategory.IdArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Parent", pcmArticleCategory.Parent);
                        mySqlCommand.Parameters.AddWithValue("_IsLeaf", pcmArticleCategory.IsLeaf);
                        mySqlCommand.Parameters.AddWithValue("_IdModifier", pcmArticleCategory.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    //update position of pcm article categories
                    UpdatePCMArticleCategoryPosition(MainServerConnectionString, pcmArticleCategoryList, pcmArticleCategory.IdModifier);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to Update PCM Article Category In Article With Status
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdPCMArticleCategory">Get PCM Article Category id.</param>
        /// <param name="Article">Article details.</param>
        public bool IsUpdatePCMArticleCategoryInArticleWithStatus(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticleCategoryWithStatus_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);

                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategoryInArticleWithStatus(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update DWOS template by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product Type Id.</param>
        /// <param name="IdTemplate">Get template Id.</param>
        public bool IsUpdateDWOSTemplateByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            bool isUpdated = false;
            try
            {
                if (IdTemplate > 0)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_DWOSTemplateByCPType_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdateDWOSTemplateByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }
        #endregion

        #region Delete Methods

        /// <summary>
        /// This method is used to Delete Catalogue Item
        /// </summary>
        /// <param name="idCatalogueItem">Get catalogue item id.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool IsDeletedCatalogueItem(UInt32 idCatalogueItem, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idCatalogueItem > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItem_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", idCatalogueItem);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", idCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        /// <summary>
        /// This method is to Delete Detections by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        public void DeleteDetectionsByIdCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem)
        {
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Delete", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", IdCatalogueItem);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionsByIdCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to Delete connector families by catalogue item
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        public void DeleteConnectorFamiliesByIdCatalogueItem(string MainServerConnectionString, UInt32 IdCatalogueItem)
        {
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCatalogueItem_Delete", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", IdCatalogueItem);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteConnectorFamiliesByIdCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to delete product type image
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeImage">Get product Type Image details.</param>
        /// <param name="ProductTypeImagePath">Get product type Image Path.</param>
        public bool IsDeleteProductTypeImage(ProductTypeImage productTypeImage, string ProductTypeImagePath, string MainServerConnectionString)
        {
            bool isDeleted = false;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Delete", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeImage", productTypeImage.IdCPTypeImage);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                }
                IsDeleteProductTypeImageFromPath(productTypeImage, ProductTypeImagePath);
                isDeleted = true;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeleteProductTypeImage(). IdCPTypeImage- {0} ErrorMessage- {1}", productTypeImage.IdCPTypeImage, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDeleted;
        }

        /// <summary>
        /// This method is to delete product type image from path
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeImage">Get product Type Image details.</param>
        /// <param name="ProductTypeImagePath">Get product type Image Path.</param>
        public bool IsDeleteProductTypeImageFromPath(ProductTypeImage productTypeImage, string ProductTypeImagePath)
        {
            try
            {
                if (ProductTypeImagePath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", ProductTypeImagePath, productTypeImage.IdCPTypeImage);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        Directory.Delete(completePath, true);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeleteProductTypeImageFromPath()- Filename - {0}. ErrorMessage- {1}", productTypeImage.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to delete product type Attached Doc
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeAttachedDoc">Get product Type Attached Doc details.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type Attached Doc Path.</param>
        public bool IsDeleteProductTypeAttachedDoc(ProductTypeAttachedDoc productTypeAttachedDoc, string ProductTypeAttachedDocPath, string MainServerConnectionString)
        {
            bool isDeleted = false;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Delete", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDoc.IdCPTypeAttachedDoc);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                }
                IsDeleteProductTypeAttachedDocFromPath(productTypeAttachedDoc, ProductTypeAttachedDocPath);
                isDeleted = true;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeleteProductTypeAttachedDoc(). IdCPTypeAttachedDoc- {0} ErrorMessage- {1}", productTypeAttachedDoc.IdCPTypeAttachedDoc, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDeleted;
        }

        /// <summary>
        /// This method is to delete product type Attached Doc from path
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeAttachedDoc">Get product Type Attached Doc details.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type Attached Doc Path.</param>
        public bool IsDeleteProductTypeAttachedDocFromPath(ProductTypeAttachedDoc productTypeAttachedDoc, string ProductTypeAttachedDocPath)
        {
            try
            {
                if (ProductTypeAttachedDocPath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", ProductTypeAttachedDocPath, productTypeAttachedDoc.IdCPTypeAttachedDoc);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        Directory.Delete(completePath, true);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeleteProductTypeAttachedDocFromPath()- Filename - {0}. ErrorMessage- {1}", productTypeAttachedDoc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to delete catalogue Item Attached Doc from path
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="catalogueItemAttachedDoc">Get catalogue Item Attached Doc details.</param>
        /// <param name="CatalogueItemAttachedDocPath">Get catalogue Item Attached Doc Path.</param>
        public bool IsDeleteCatalogueItemAttachedDocFromPath(CatalogueItemAttachedDoc catalogueItemAttachedDoc, string CatalogueItemAttachedDocPath)
        {
            try
            {
                if (CatalogueItemAttachedDocPath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", CatalogueItemAttachedDocPath, catalogueItemAttachedDoc.IdCatalogueItemAttachedDoc);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        Directory.Delete(completePath, true);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeleteCatalogueItemAttachedDocFromPath()- Filename - {0}. ErrorMessage- {1}", catalogueItemAttachedDoc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to delete Detection Attached Doc from path
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="DetectionAttachedDoc">Get Detection Attached Doc details.</param>
        /// <param name="DetectionAttachedDocPath">Get Detection Attached Doc Path.</param>
        public bool IsDeleteDetectionAttachedDocFromPath(DetectionAttachedDoc DetectionAttachedDoc, string DetectionAttachedDocPath)
        {
            try
            {
                if (DetectionAttachedDocPath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", DetectionAttachedDocPath, DetectionAttachedDoc.IdDetectionAttachedDoc);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        Directory.Delete(completePath, true);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeleteDetectionAttachedDocFromPath()- Filename - {0}. ErrorMessage- {1}", DetectionAttachedDoc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is used to Delete product type
        /// </summary>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool IsDeletedProductType(UInt64 IdCPType, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (IdCPType > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedProductType(). IdProductType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        /// <summary>
        /// This method is to delete detection image from path
        /// </summary>
        /// <param name="DetectionImage">Get detection Image details.</param>
        /// <param name="DetectionImagePath">Get detection Image Path.</param>
        public bool IsDeleteDetectionImageFromPath(DetectionImage DetectionImage, string DetectionImagePath)
        {
            try
            {
                if (DetectionImagePath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", DetectionImagePath, DetectionImage.IdDetectionImage);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        Directory.Delete(completePath, true);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeleteDetectionImageFromPath()- Filename - {0}. ErrorMessage- {1}", DetectionImage.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is used to Delete detection
        /// </summary>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool IsDeletedDetection(UInt32 IdDetection, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (IdDetection > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedDetection(). IdProductType- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public bool IsDeletePCMArticleImageFromPath(PCMArticleImage Image, string ImagePath, string ArticleReference)
        {
            try
            {
                if (ImagePath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", ImagePath, ArticleReference);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        completePath = completePath + "\\" + Image.IdPCMArticleImage + "_" + Image.SavedFileName;

                        if (File.Exists(completePath))
                        {
                            File.Delete(completePath);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePCMArticleImageFromPath()- Filename - {0}. ErrorMessage- {1}", Image.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }
        #endregion

        #region Add / Update / Delete methods

        /// <summary>
        /// This method is used to Add/Delete families
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="FamilyList">The list of family.</param>
        public void AddDeleteFamilies(string MainServerConnectionString, UInt32 IdCatalogueItem, List<ConnectorFamilies> Families)
        {
            try
            {
                if (Families != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in Families)
                        {
                            if (familyList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCatalogueItem_By_IdFamily_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_idFamily", familyList.IdFamily);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (familyList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCatalogueItem_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);

                                familyList.IdFamily = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteWays(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete ways
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get catalogue type id.</param>
        /// <param name="WaysList">The list of ways.</param>
        public void AddDeleteWays(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<Ways> WaysList)
        {
            try
            {
                if (WaysList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WaysList)
                        {
                            if (wayList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_By_IdDetection_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_idDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_idDetection", wayList.IdWays);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (wayList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteWays(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete detections
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get catalogue type id.</param>
        /// <param name="DetectionsList">The list of detections.</param>
        public void AddDeleteDetections(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<Detections> DetectionsList)
        {
            try
            {
                if (DetectionsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Detections detectionList in DetectionsList)
                        {
                            if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_By_IdDetection_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_idDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_idDetection", detectionList.IdDetections);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteDetections(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete options
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get catalogue type id.</param>
        /// <param name="OptionsList">The list of options.</param>
        public void AddDeleteOptions(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<Options> OptionsList)
        {
            try
            {
                Detections obj = new Detections();
                if (OptionsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Options optionList in OptionsList)
                        {
                            if (optionList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_By_IdDetection_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_idDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_idDetection", optionList.IdOptions);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (optionList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteOptions(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete spare parts
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="IdDetectionType">Get catalogue type id.</param>
        /// <param name="SparePartsList">The list of spare parts.</param>
        public void AddDeleteSpareParts(string MainServerConnectionString, UInt32 IdCatalogueItem, UInt32 IdDetectionType, List<SpareParts> SparePartsList)
        {
            try
            {
                if (SparePartsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartsList)
                        {
                            if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_By_IdDetection_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_idCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_idDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_idDetection", sparePartsList.IdSpareParts);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCatalogueItem_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSpareParts(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Catalogue Item Files
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="CatalogueItemAttachedDocPath">Get file path.</param>
        /// <param name="CatalogueItemAttachedDocList">The list of files.</param>
        public void AddUpdateDeleteCatalogueItemFiles(string MainServerConnectionString, UInt32 IdCatalogueItem, List<CatalogueItemAttachedDoc> CatalogueItemAttachedDocList, string CatalogueItemAttachedDocPath)
        {
            try
            {
                if (CatalogueItemAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CatalogueItemAttachedDoc catalogueItemAttachedDocList in CatalogueItemAttachedDocList)
                        {
                            if (catalogueItemAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItemAttachedDocs_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItemAttachedDoc", catalogueItemAttachedDocList.IdCatalogueItemAttachedDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteCatalogueItemAttachedDocFromPath(catalogueItemAttachedDocList, CatalogueItemAttachedDocPath);
                            }
                            else if (catalogueItemAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (catalogueItemAttachedDocList.IdCatalogueItemAttachedDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItemAttachedDocs_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItemAttachedDoc", catalogueItemAttachedDocList.IdCatalogueItemAttachedDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", catalogueItemAttachedDocList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", catalogueItemAttachedDocList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", catalogueItemAttachedDocList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", catalogueItemAttachedDocList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_IdDocType", catalogueItemAttachedDocList.IdDocType);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddCatalogueItemAttachedDocToPath(catalogueItemAttachedDocList, CatalogueItemAttachedDocPath);
                                }
                            }
                            else if (catalogueItemAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItemAttachedDocs_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", catalogueItemAttachedDocList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", catalogueItemAttachedDocList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", catalogueItemAttachedDocList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", catalogueItemAttachedDocList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_IdDocType", catalogueItemAttachedDocList.IdDocType);

                                catalogueItemAttachedDocList.IdCatalogueItemAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (catalogueItemAttachedDocList.IdCatalogueItemAttachedDoc > 0)
                                {
                                    AddCatalogueItemAttachedDocToPath(catalogueItemAttachedDocList, CatalogueItemAttachedDocPath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCatalogueItemFiles(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete product type Files
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeAttachedDocList">The list of files.</param>
        public void AddUpdateDeleteProductTypeFiles(string MainServerConnectionString, UInt64 IdCpType, List<ProductTypeAttachedDoc> ProductTypeAttachedDocList, string ProductTypeAttachedDocPath)
        {
            try
            {
                if (ProductTypeAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedDoc productTypeAttachedDocList in ProductTypeAttachedDocList)
                        {
                            if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDocList.IdCPTypeAttachedDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteProductTypeAttachedDocFromPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                            }
                            else if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDocList.IdCPTypeAttachedDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeAttachedDocList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_IdDocType", productTypeAttachedDocList.IdDocType);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                                }
                            }
                            else if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedDocList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_IdDocType", productTypeAttachedDocList.IdDocType);

                                productTypeAttachedDocList.IdCPTypeAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                                {
                                    AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeFiles(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Detection Files
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get Detection id.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionAttachedDocList">The list of files.</param>
        public void AddUpdateDeleteDetectionFiles(string MainServerConnectionString, UInt32 IdDetection, List<DetectionAttachedDoc> DetectionAttachedDocList, string DetectionAttachedDocPath)
        {
            try
            {
                if (DetectionAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionAttachedDoc detectionAttachedDocList in DetectionAttachedDocList)
                        {
                            if (detectionAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedDoc", detectionAttachedDocList.IdDetectionAttachedDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteDetectionAttachedDocFromPath(detectionAttachedDocList, DetectionAttachedDocPath);
                            }
                            else if (detectionAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (detectionAttachedDocList.IdDetectionAttachedDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedDoc", detectionAttachedDocList.IdDetectionAttachedDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionAttachedDocList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedDocList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionAttachedDocList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionAttachedDocList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_IdDocType", detectionAttachedDocList.IdDocType);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddDetectionAttachedDocToPath(detectionAttachedDocList, DetectionAttachedDocPath);
                                }
                            }
                            else if (detectionAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionAttachedDocList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedDocList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionAttachedDocList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionAttachedDocList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_IdDocType", detectionAttachedDocList.IdDocType);

                                detectionAttachedDocList.IdDetectionAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (detectionAttachedDocList.IdDetectionAttachedDoc > 0)
                                {
                                    AddDetectionAttachedDocToPath(detectionAttachedDocList, DetectionAttachedDocPath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionFiles(). IdCatalogueItem- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Catalogue Item Links
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <param name="CatalogueItemAttachedLinkList">The list of links.</param>
        public void AddUpdateDeleteCatalogueItemLinks(string MainServerConnectionString, UInt32 IdCatalogueItem, List<CatalogueItemAttachedLink> CatalogueItemAttachedLinkList)
        {
            try
            {
                if (CatalogueItemAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CatalogueItemAttachedLink catalogueItemAttachedLinkList in CatalogueItemAttachedLinkList)
                        {
                            if (catalogueItemAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItems_AttachedLinks_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItemAttachedLink", catalogueItemAttachedLinkList.IdCatalogueItemAttachedLink);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (catalogueItemAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (catalogueItemAttachedLinkList.IdCatalogueItemAttachedLink > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItems_AttachedLinks_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItemAttachedLink", catalogueItemAttachedLinkList.IdCatalogueItemAttachedLink);
                                    mySqlCommand.Parameters.AddWithValue("_Name", catalogueItemAttachedLinkList.Name);
                                    mySqlCommand.Parameters.AddWithValue("_Address", catalogueItemAttachedLinkList.Address);
                                    mySqlCommand.Parameters.AddWithValue("_Description", catalogueItemAttachedLinkList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", catalogueItemAttachedLinkList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (catalogueItemAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CatalogueItems_AttachedLinks_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                                mySqlCommand.Parameters.AddWithValue("_Name", catalogueItemAttachedLinkList.Name);
                                mySqlCommand.Parameters.AddWithValue("_Address", catalogueItemAttachedLinkList.Address);
                                mySqlCommand.Parameters.AddWithValue("_Description", catalogueItemAttachedLinkList.Description);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", catalogueItemAttachedLinkList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCatalogueItemLinks(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Product Type Links
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get Product Type id.</param>
        /// <param name="ProductTypeAttachedLinkList">The list of links.</param>
        public void AddUpdateDeleteProductTypeLinks(string MainServerConnectionString, UInt64 IdCpType, List<ProductTypeAttachedLink> ProductTypeAttachedLinkList)
        {
            try
            {
                if (ProductTypeAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedLink productTypeAttachedLinkList in ProductTypeAttachedLinkList)
                        {
                            if (productTypeAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedLink", productTypeAttachedLinkList.IdCPTypeAttachedLink);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (productTypeAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeAttachedLinkList.IdCPTypeAttachedLink > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedLink", productTypeAttachedLinkList.IdCPTypeAttachedLink);
                                    mySqlCommand.Parameters.AddWithValue("_Name", productTypeAttachedLinkList.Name);
                                    mySqlCommand.Parameters.AddWithValue("_Address", productTypeAttachedLinkList.Address);
                                    mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedLinkList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeAttachedLinkList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (productTypeAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_Name", productTypeAttachedLinkList.Name);
                                mySqlCommand.Parameters.AddWithValue("_Address", productTypeAttachedLinkList.Address);
                                mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedLinkList.Description);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedLinkList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeLinks(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Detection Links
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get Detection id.</param>
        /// <param name="DetectionAttachedLinkList">The list of links.</param>
        public void AddUpdateDeleteDetectionLinks(string MainServerConnectionString, UInt32 IdDetection, List<DetectionAttachedLink> DetectionAttachedLinkList)
        {
            try
            {
                if (DetectionAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionAttachedLink detectionAttachedLinkList in DetectionAttachedLinkList)
                        {
                            if (detectionAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_AttachedLinks_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedLink", detectionAttachedLinkList.IdDetectionAttachedLink);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (detectionAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (detectionAttachedLinkList.IdDetectionAttachedLink > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_AttachedLinks_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedLink", detectionAttachedLinkList.IdDetectionAttachedLink);
                                    mySqlCommand.Parameters.AddWithValue("_Name", detectionAttachedLinkList.Name);
                                    mySqlCommand.Parameters.AddWithValue("_Address", detectionAttachedLinkList.Address);
                                    mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedLinkList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionAttachedLinkList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (detectionAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_AttachedLinks_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_Name", detectionAttachedLinkList.Name);
                                mySqlCommand.Parameters.AddWithValue("_Address", detectionAttachedLinkList.Address);
                                mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedLinkList.Description);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionAttachedLinkList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionLinks(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete families by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="FamilyList">The list of family.</param>
        public void AddDeleteFamiliesByProductType(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> Families)
        {
            try
            {
                if (Families != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in Families)
                        {
                            if (familyList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (familyList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);

                                familyList.IdFamily = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteFamiliesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete ways by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="WaysList">The list of ways.</param>
        public void AddDeleteWaysByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Ways> WaysList)
        {
            try
            {
                if (WaysList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WaysList)
                        {
                            if (wayList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (wayList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteWaysByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete detections by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="DetectionsList">The list of detections.</param>
        public void AddUpdateDeleteDetectionsByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Detections> DetectionsList)
        {
            try
            {
                if (DetectionsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Detections detectionList in DetectionsList)
                        {
                            if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (IdCPType > 0 && detectionList.IdDetections > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (IdCPType > 0 && detectionList.IdDetections > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionList.OrderNumber);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (IdCPType > 0 && detectionList.IdDetections > 0 && IdTemplate > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionList.OrderNumber);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteDetectionsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Add/Delete detections by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="DetectionsList">The list of detections.</param>
        public void AddUpdateDeleteSparePartsByProductType_V2140(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<SpareParts> SparePartsList)
        {
            try
            {
                if (SparePartsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartsList)
                        {
                            if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (IdCPType > 0 && sparePartsList.IdSpareParts > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (IdCPType > 0 && sparePartsList.IdSpareParts > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", sparePartsList.OrderNumber);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (IdCPType > 0 && sparePartsList.IdSpareParts > 0 && IdTemplate > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", sparePartsList.OrderNumber);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeletesparePartsListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete options by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="OptionsList">The list of options.</param>
        public void AddUpdateDeleteOptionsByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Options> OptionsList)
        {
            try
            {
                Detections obj = new Detections();
                if (OptionsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Options optionList in OptionsList)
                        {
                            if (optionList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (IdCPType > 0 && optionList.IdOptions > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (optionList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (IdCPType > 0 && optionList.IdOptions > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", optionList.OrderNumber);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (optionList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (IdCPType > 0 && optionList.IdOptions > 0 && IdTemplate > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", optionList.OrderNumber);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteOptionsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete spare parts by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="SparePartsList">The list of spare parts.</param>
        public void AddDeleteSparePartsByProductType(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<SpareParts> SparePartsList)
        {
            try
            {
                if (SparePartsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartsList)
                        {
                            if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSparePartsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete templates by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="TemplateList">The list of template.</param>
        public void AddDeleteTemplatesByProductType(string MainServerConnectionString, UInt64 IdCPType, List<Template> TemplateList)
        {
            try
            {
                if (TemplateList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Template templateList in TemplateList)
                        {
                            if (templateList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (templateList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", templateList.IdTemplate);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteTemplatesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Product Type Images
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <param name="ProductTypeImageList">The list of images.</param>
        public void AddUpdateDeleteProductTypeImages(string MainServerConnectionString, UInt64 IdCpType, List<ProductTypeImage> ProductTypeImageList, string ProductTypeImagePath)
        {
            try
            {
                if (ProductTypeImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeImage productTypeImageList in ProductTypeImageList)
                        {
                            if (productTypeImageList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPTypeImage", productTypeImageList.IdCPTypeImage);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteProductTypeImageFromPath(productTypeImageList, ProductTypeImagePath);
                            }
                            else if (productTypeImageList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeImageList.IdCPTypeImage > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeImage", productTypeImageList.IdCPTypeImage);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeImageList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", productTypeImageList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeImageList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeImageList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_Position", productTypeImageList.Position);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddProductTypeImageToPath(productTypeImageList, ProductTypeImagePath);
                                }
                            }
                            else if (productTypeImageList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeImageList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", productTypeImageList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeImageList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeImageList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Position", productTypeImageList.Position);

                                productTypeImageList.IdCPTypeImage = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (productTypeImageList.IdCPTypeImage > 0)
                                {
                                    AddProductTypeImageToPath(productTypeImageList, ProductTypeImagePath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeImages(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Detection Images
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get Detection id.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="DetectionImageList">The list of images.</param>
        public void AddUpdateDeleteDetectionImages(string MainServerConnectionString, UInt32 IdDetection, List<DetectionImage> DetectionImageList, string DetectionImagePath)
        {
            try
            {
                if (DetectionImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionImage detectionImageList in DetectionImageList)
                        {
                            if (detectionImageList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionImages_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionImage", detectionImageList.IdDetectionImage);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteDetectionImageFromPath(detectionImageList, DetectionImagePath);
                            }
                            else if (detectionImageList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (detectionImageList.IdDetectionImage > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionImages_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdDetectionImage", detectionImageList.IdDetectionImage);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionImageList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", detectionImageList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionImageList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionImageList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_Position", detectionImageList.Position);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddDetectionImageToPath(detectionImageList, DetectionImagePath);
                                }
                            }
                            else if (detectionImageList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionImages_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionImageList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", detectionImageList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionImageList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionImageList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Position", detectionImageList.Position);

                                detectionImageList.IdDetectionImage = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (detectionImageList.IdDetectionImage > 0)
                                {
                                    AddDetectionImageToPath(detectionImageList, DetectionImagePath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionImages(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Detection group
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetectionType">Get Detection type.</param>
        /// <param name="DetectionGroupList">The list of group.</param>
        public UInt32 AddUpdateDeleteDetectionGroup(string MainServerConnectionString, UInt32 IdDetectionType, List<DetectionGroup> DetectionGroupList, DetectionOrderGroup DetectionOrderGroup)
        {
            UInt32 idGroup = 0;
            try
            {
                if (DetectionGroupList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (DetectionGroup detectionGroupList in DetectionGroupList)
                        {
                            if (detectionGroupList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand1 = new MySqlCommand("PCM_DetectionGroupsByGroup_Update", mySqlConnection);
                                mySqlCommand1.CommandType = CommandType.StoredProcedure;
                                mySqlCommand1.Parameters.AddWithValue("_IdGroup", detectionGroupList.IdGroup);
                                mySqlCommand1.ExecuteNonQuery();

                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Groups_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionGroupList.IdGroup);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (detectionGroupList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (detectionGroupList.IdGroup > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Groups_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionGroupList.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                    mySqlCommand.Parameters.AddWithValue("_Name", detectionGroupList.Name);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionGroupList.OrderNumber);
                                    mySqlCommand.Parameters.AddWithValue("_Name_es", detectionGroupList.Name_es);
                                    mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionGroupList.Name_fr);
                                    mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionGroupList.Name_pt);
                                    mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionGroupList.Name_ro);
                                    mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionGroupList.Name_zh);
                                    mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionGroupList.Name_ru);
                                    mySqlCommand.Parameters.AddWithValue("_Description", detectionGroupList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_Description_es", detectionGroupList.Description_es);
                                    mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionGroupList.Description_fr);
                                    mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionGroupList.Description_pt);
                                    mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionGroupList.Description_ro);
                                    mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionGroupList.Description_zh);
                                    mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionGroupList.Description_ru);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionGroupList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (detectionGroupList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Groups_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_Name", detectionGroupList.Name);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionGroupList.OrderNumber);
                                mySqlCommand.Parameters.AddWithValue("_Name_es", detectionGroupList.Name_es);
                                mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionGroupList.Name_fr);
                                mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionGroupList.Name_pt);
                                mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionGroupList.Name_ro);
                                mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionGroupList.Name_zh);
                                mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionGroupList.Name_ru);
                                mySqlCommand.Parameters.AddWithValue("_Description", detectionGroupList.Description);
                                mySqlCommand.Parameters.AddWithValue("_Description_es", detectionGroupList.Description_es);
                                mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionGroupList.Description_fr);
                                mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionGroupList.Description_pt);
                                mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionGroupList.Description_ro);
                                mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionGroupList.Description_zh);
                                mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionGroupList.Description_ru);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionGroupList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                detectionGroupList.IdGroup = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (DetectionOrderGroup != null && DetectionOrderGroup.Name == detectionGroupList.Name)
                                {
                                    idGroup = detectionGroupList.IdGroup;
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionGroup(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return idGroup;
        }

        /// <summary>
        /// This method is used to Add/Delete customers and regions by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        public void AddDeleteCustomersRegionsByProductType(string MainServerConnectionString, UInt64 IdCPType, List<RegionsByCustomer> CustomersList, UInt32 IdCreator)
        {
            try
            {
                if (CustomersList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (RegionsByCustomer customersList in CustomersList)
                        {
                            if (customersList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersRegionsByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete customers and regions by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        public void AddDeleteSitesByProductType(string MainServerConnectionString, UInt64 IdCPType, List<RegionsByCustomer> CustomersList, string PCMConnectionString)
        {
            try
            {
                if (CustomersList != null)
                {
                    List<Site> SitesDeleteCustomerList = new List<Site>();
                    List<Site> SitesAddCustomerList = new List<Site>();
                    if (CustomersList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                    {
                        try
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                            {
                                mySqlConnection.Open();
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegion", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                foreach (RegionsByCustomer customerList in CustomersList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).ToList())
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                    {
                                        while (reader.Read())
                                        {
                                            if (reader["IdSite"] != DBNull.Value)
                                            {
                                                Site site = new Site();
                                                site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                                SitesDeleteCustomerList.Add(site);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType-PCM_GetSitesByCustomerAndRegion. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (CustomersList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add))
                    {
                        try
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                            {
                                mySqlConnection.Open();
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegionByCPType", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                foreach (RegionsByCustomer customerList in CustomersList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList())
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                    {
                                        while (reader.Read())
                                        {
                                            if (reader["IdSite"] != DBNull.Value)
                                            {
                                                Site site = new Site();
                                                site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                                SitesAddCustomerList.Add(site);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType-PCM_GetSitesByCustomerAndRegionByCPType. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (SitesDeleteCustomerList != null && SitesDeleteCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Delete", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesDeleteCustomerList = SitesDeleteCustomerList.Distinct().ToList();
                            foreach (Site site in SitesDeleteCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType-PCM_SitesByCPType_Delete. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }


                    if (SitesAddCustomerList != null && SitesAddCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesAddCustomerList = SitesAddCustomerList.Distinct().ToList();
                            foreach (Site site in SitesAddCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();

                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType-PCM_SitesByCPType_Insert. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Delete customers and regions by detection
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        /// <param name="IdDetectiontype">Get detection type id.</param>
        public void AddDeleteCustomersRegionsByDetection(string MainServerConnectionString, UInt32 IdDetection, List<RegionsByCustomer> CustomersList, UInt32 IdDetectiontype, UInt32 IdCreator)
        {
            try
            {
                if (CustomersList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (RegionsByCustomer customersList in CustomersList)
                        {
                            if (customersList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersRegionsByDetection(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Update PCM article category position
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="pcmArticleCategoryList">The list of pcm article category.</param>
        public void UpdatePCMArticleCategoryPosition(string MainServerConnectionString, List<PCMArticleCategory> pcmArticleCategoryList, uint? IdModifier)
        {
            try
            {
                if (pcmArticleCategoryList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (PCMArticleCategory pcmArticleCategory in pcmArticleCategoryList)
                        {
                            if (pcmArticleCategory.IdPCMArticleCategory > 0)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Category_Position_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", pcmArticleCategory.IdPCMArticleCategory);
                                mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                                mySqlCommand.Parameters.AddWithValue("_IdModifier", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdatePCMArticleCategoryPosition(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to Add/Update/Delete Product Type Capabilities
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get Product Type id.</param>
        /// <param name="CompatibilityList">The list of Compatibility.</param>
        public void AddUpdateDeleteProductTypeCompatibilities(string MainServerConnectionString, byte IdCpType, List<ProductTypeCompatibility> CompatibilityList)
        {
            try
            {
                if (CompatibilityList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeCompatibility productTypeCompatibility in CompatibilityList)
                        {
                            if (productTypeCompatibility.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCompatibility", productTypeCompatibility.IdCompatibility);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (productTypeCompatibility.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeCompatibility.IdCompatibility > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCompatibility", productTypeCompatibility.IdCompatibility);
                                    mySqlCommand.Parameters.AddWithValue("_MinimumElements", productTypeCompatibility.MinimumElements);
                                    mySqlCommand.Parameters.AddWithValue("_MaximumElements", productTypeCompatibility.MaximumElements);
                                    if (productTypeCompatibility.IdRelationshipType == 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", productTypeCompatibility.IdRelationshipType);
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_Quantity", productTypeCompatibility.Quantity);
                                    mySqlCommand.Parameters.AddWithValue("_Remarks", productTypeCompatibility.Remarks);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", productTypeCompatibility.IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (productTypeCompatibility.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPtype", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_IdCPtypeCompatibility", productTypeCompatibility.IdCPtypeCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_IdArticleCompatibility", productTypeCompatibility.IdArticleCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_IdTypeCompatibility", productTypeCompatibility.IdTypeCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_MinimumElements", productTypeCompatibility.MinimumElements);
                                mySqlCommand.Parameters.AddWithValue("_MaximumElements", productTypeCompatibility.MaximumElements);
                                if (productTypeCompatibility.IdRelationshipType == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", productTypeCompatibility.IdRelationshipType);
                                }
                                mySqlCommand.Parameters.AddWithValue("_Quantity", productTypeCompatibility.Quantity);
                                mySqlCommand.Parameters.AddWithValue("_Remarks", productTypeCompatibility.Remarks);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", productTypeCompatibility.IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeCapabilities(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Add/Update/Delete Article Capabilities
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdArticle">Get Article id.</param>
        /// <param name="CompatibilityList">The list of Compatibility.</param>
        public void AddUpdateDeleteArticleCompatibilities(string MainServerConnectionString, UInt32 IdArticle, List<ArticleCompatibility> CompatibilityList)
        {
            try
            {
                if (CompatibilityList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ArticleCompatibility articleCompatibility in CompatibilityList)
                        {
                            if (articleCompatibility.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_article_compatibilities_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCompatibility", articleCompatibility.IdCompatibility);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (articleCompatibility.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (articleCompatibility.IdCompatibility > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_article_compatibilities_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCompatibility", articleCompatibility.IdCompatibility);
                                    mySqlCommand.Parameters.AddWithValue("_MinimumElements", articleCompatibility.MinimumElements);
                                    mySqlCommand.Parameters.AddWithValue("_MaximumElements", articleCompatibility.MaximumElements);
                                    if (articleCompatibility.IdRelationshipType == 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", articleCompatibility.IdRelationshipType);
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_Quantity", articleCompatibility.Quantity);
                                    mySqlCommand.Parameters.AddWithValue("_Remarks", articleCompatibility.Remarks);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", articleCompatibility.IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (articleCompatibility.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_article_compatibilities_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdArticleCompatibility", articleCompatibility.IdArticleCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_IdCPtypeCompatibility", articleCompatibility.IdCPtypeCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_IdTypeCompatibility", articleCompatibility.IdTypeCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_MinimumElements", articleCompatibility.MinimumElements);
                                mySqlCommand.Parameters.AddWithValue("_MaximumElements", articleCompatibility.MaximumElements);
                                if (articleCompatibility.IdRelationshipType == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", articleCompatibility.IdRelationshipType);
                                }
                                mySqlCommand.Parameters.AddWithValue("_Quantity", articleCompatibility.Quantity);
                                mySqlCommand.Parameters.AddWithValue("_Remarks", articleCompatibility.Remarks);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", articleCompatibility.IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteArticleCompatibilities(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddUpdateDeletePCMArticleImages(string MainServerConnectionString, UInt32 IdArticle, List<PCMArticleImage> ImageList, string ImagePath, string ArticleReference)
        {
            try
            {
                if (ImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PCMArticleImage Image in ImageList)
                        {
                            if (Image.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Images_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdPCMArticleImage", Image.IdPCMArticleImage);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeletePCMArticleImageFromPath(Image, ImagePath, ArticleReference);
                            }
                            else if (Image.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (Image.IdPCMArticleImage > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Images_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdPCMArticleImage", Image.IdPCMArticleImage);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", Image.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", Image.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", Image.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", Image.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_Position", Image.Position);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddPCMArticleImageToPath(Image, ImagePath, ArticleReference);
                                }
                            }
                            else if (Image.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Images_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", Image.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", Image.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", Image.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", Image.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Position", Image.Position);

                                Image.IdPCMArticleImage = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (Image.IdPCMArticleImage > 0)
                                {
                                    AddPCMArticleImageToPath(Image, ImagePath, ArticleReference);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePCMArticleImages(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        #endregion

        #region Get Methods

        /// <summary>
        /// This method is used to get all catalogue items.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of catalogue items.</returns>
        public List<CatalogueItem> GetAllCatalogueItems(string PCMConnectionString)
        {
            List<CatalogueItem> catalogueItems = new List<CatalogueItem>();
            try
            {
                using (MySqlConnection connCatalogueItems = new MySqlConnection(PCMConnectionString))
                {
                    connCatalogueItems.Open();

                    MySqlCommand catalogueitemCommand = new MySqlCommand("PCM_GetAllCatalogueItems", connCatalogueItems);
                    catalogueitemCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader catalogueitemReader = catalogueitemCommand.ExecuteReader())
                    {
                        while (catalogueitemReader.Read())
                        {
                            CatalogueItem catalogueitem = new CatalogueItem();

                            catalogueitem.IdCatalogueItem = Convert.ToUInt32(catalogueitemReader["idCatalogueItem"]);

                            if (catalogueitemReader["Code"] != DBNull.Value)
                            {
                                catalogueitem.Code = Convert.ToString(catalogueitemReader["Code"]);
                            }
                            if (catalogueitemReader["IdTemplate"] != DBNull.Value)
                            {
                                catalogueitem.IdTemplate = Convert.ToUInt64(catalogueitemReader["IdTemplate"]);
                                catalogueitem.Template = new Template();
                                catalogueitem.Template.IdTemplate = Convert.ToByte(catalogueitemReader["IdTemplate"]);
                                if (catalogueitemReader["TemplateName"] != DBNull.Value)
                                {
                                    catalogueitem.Template.Name = Convert.ToString(catalogueitemReader["TemplateName"]);
                                }
                            }
                            if (catalogueitemReader["IdCPType"] != DBNull.Value)
                            {
                                catalogueitem.IdCPType = Convert.ToUInt64(catalogueitemReader["IdCPType"]);
                                catalogueitem.ProductType = new ProductTypes();
                                catalogueitem.ProductType.IdCPType = Convert.ToUInt64(catalogueitemReader["IdCPType"]);
                                if (catalogueitemReader["ProductType"] != DBNull.Value)
                                {
                                    catalogueitem.ProductType.Name = Convert.ToString(catalogueitemReader["ProductType"]);
                                }
                            }
                            if (catalogueitemReader["IdStatus"] != DBNull.Value)
                            {
                                catalogueitem.IdStatus = Convert.ToInt32(catalogueitemReader["IdStatus"]);
                                catalogueitem.Status = new LookupValue();
                                catalogueitem.Status.IdLookupValue = Convert.ToInt32(catalogueitemReader["IdStatus"]);
                                if (catalogueitemReader["Status"] != DBNull.Value)
                                {
                                    catalogueitem.Status.Value = Convert.ToString(catalogueitemReader["Status"]);
                                }
                            }
                            if (catalogueitemReader["Name"] != DBNull.Value)
                            {
                                catalogueitem.Name = Convert.ToString(catalogueitemReader["Name"]);
                            }
                            if (catalogueitemReader["CreatedIn"] != DBNull.Value)
                            {
                                catalogueitem.CreatedIn = Convert.ToDateTime(catalogueitemReader["CreatedIn"]);
                            }
                            if (catalogueitemReader["LastUpdate"] != DBNull.Value)
                            {
                                catalogueitem.LastUpdate = Convert.ToDateTime(catalogueitemReader["LastUpdate"]);
                            }
                            if (catalogueitemReader["Description"] != DBNull.Value)
                            {
                                catalogueitem.Description = Convert.ToString(catalogueitemReader["Description"]);
                            }

                            catalogueItems.Add(catalogueitem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCatalogueItems(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return catalogueItems;
        }

        /// <summary>
        /// This method is used to get all Product Types.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Product Types.</returns>
        public List<ProductTypes> GetAllProductTypes(string PCMConnectionString)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }

                            cpType.WayList = GetWayListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.DetectionList = GetDetectionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.OptionList = GetOptionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.SparePartList = GetSparePartListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }

        /// <summary>
        /// This method is used to get all Templates.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Templates.</returns>
        public List<Template> GetAllTemplates(string PCMConnectionString)
        {
            List<Template> Templates = new List<Template>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllTemplates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            Template Template = new Template();
                            Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Template.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IsObsolete"] != DBNull.Value)
                            {
                                Template.IsObsolete = Convert.ToByte(reader["IsObsolete"]);
                            }

                            if (reader["HtmlColor"] != DBNull.Value)
                            {
                                Template.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            Templates.Add(Template);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllTemplates(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Templates;
        }

        /// <summary>
        /// This method is used to get all Families.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Families.</returns>
        public List<ConnectorFamilies> GetAllFamilies(string PCMConnectionString)
        {
            List<ConnectorFamilies> ConnectorFamilies = new List<ConnectorFamilies>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllFamilies", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ConnectorFamilies ConnectorFamily = new ConnectorFamilies();
                            ConnectorFamily.IdFamily = Convert.ToUInt64(reader["IdFamily"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                ConnectorFamily.Name = Convert.ToString(reader["Name"]);
                            }
                            ConnectorFamilies.Add(ConnectorFamily);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllFamilies(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ConnectorFamilies;
        }

        /// <summary>
        /// This method is used to get all Detection Types.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Detection Types.</returns>
        public List<DetectionTypes> GetAllDetectionTypes(string PCMConnectionString)
        {
            List<DetectionTypes> DetectionTypes = new List<DetectionTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllDetectionTypes", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionTypes DetectionType = new DetectionTypes();

                            DetectionType.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionType.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["SortOrder"] != DBNull.Value)
                            {
                                DetectionType.SortOrder = Convert.ToUInt64(reader["SortOrder"]);
                            }

                            if (reader["Color"] != DBNull.Value)
                            {
                                DetectionType.Color = Convert.ToString(reader["Color"]);
                            }

                            DetectionTypes.Add(DetectionType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionTypes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return DetectionTypes;
        }

        /// <summary>
        /// This method is used to get Way List.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Ways.</returns>
        public List<Ways> GetAllWayList(string PCMConnectionString)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1); //Detetction type: 1 for ways. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }

                            Ways.Add(Way);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWayList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }

        /// <summary>
        /// This method is used to get Detection List.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Detections.</returns>
        public List<Detections> GetAllDetectionList(string PCMConnectionString)
        {
            List<Detections> Detections = new List<Detections>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2); //Detetction type: 2 for detections. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }
                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }

        /// <summary>
        /// This method is used to get Option List.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Options.</returns>
        public List<Options> GetAllOptionList(string PCMConnectionString)
        {
            List<Options> Options = new List<Options>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3); //Detetction type: 3 for options. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            Option.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }
                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllOptionList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }

        /// <summary>
        /// This method is used to get Spare Part List.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Spare Parts.</returns>
        public List<SpareParts> GetAllSparePartList(string PCMConnectionString)
        {
            List<SpareParts> SpareParts = new List<SpareParts>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4); //Detetction type: 4 for spare parts. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePart = new SpareParts();

                            SparePart.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePart.Name = Convert.ToString(reader["Name"]);
                            }

                            SpareParts.Add(SparePart);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllSparePartList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SpareParts;
        }

        /// <summary>
        /// This method is to get lookup values
        /// </summary>
        /// <param name="key">Get key</param>
        /// <returns>List of Lookup values</returns>
        /// <example>
        /// This sample shows how to call the method
        /// <code>
        /// class TestClass 
        /// {
        ///     static void Main(string[] args)
        ///     {
        ///          PCMManager mgr = new PCMManager();
        ///          list = mgr.GetLookupValues(key); // using EF WorkbenchContext
        ///                   
        ///     }
        /// }
        /// </code>
        /// </example>
        public IList<LookupValue> GetLookupValues(byte key)
        {
            IList<LookupValue> list = null;

            using (var context = new WorkbenchContext())
            {
                list = (from records in context.LookupValues where records.IdLookupKey == key select records).OrderBy(y => y.Position).ToList();
            }

            return list;
        }

        /// <summary>
        /// This method is used to get Families by Catalogue Item.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <returns>The list of Families by catalogue item.</returns>
        public List<ConnectorFamilies> GetFamiliesByCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem)
        {
            List<ConnectorFamilies> ConnectorFamilies = new List<ConnectorFamilies>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFamiliesByCatalogueItem", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ConnectorFamilies ConnectorFamily = new ConnectorFamilies();
                            ConnectorFamily.IdFamily = Convert.ToUInt64(reader["IdFamily"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                ConnectorFamily.Name = Convert.ToString(reader["Name"]);
                            }
                            ConnectorFamilies.Add(ConnectorFamily);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetFamiliesByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ConnectorFamilies;
        }

        /// <summary>
        /// This method is used to get Way List by catalogue item.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <returns>The list of Ways by catalogue item.</returns>
        public List<Ways> GetWayListByCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCatalogueItem", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1); //Detetction type: 1 for ways. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }

                            Ways.Add(Way);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWayListByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }

        /// <summary>
        /// This method is used to get Detection List by catalogue item.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <returns>The list of Detections by catalogue item.</returns>
        public List<Detections> GetDetectionListByCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem)
        {
            List<Detections> Detections = new List<Detections>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCatalogueItem", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2); //Detetction type: 2 for detections. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }

                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionListByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }

        /// <summary>
        /// This method is used to get Option List by catalogue item.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <returns>The list of Options by catalogue item.</returns>
        public List<Options> GetOptionListByCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem)
        {
            List<Options> Options = new List<Options>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCatalogueItem", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3); //Detetction type: 3 for options. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            Option.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }

                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionListByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }

        /// <summary>
        /// This method is used to get Spare Part List by catalogue item.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <returns>The list of Spare Parts by catalogue item.</returns>
        public List<SpareParts> GetSparePartListByCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem)
        {
            List<SpareParts> SpareParts = new List<SpareParts>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCatalogueItem", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4); //Detetction type: 4 for spare parts. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePart = new SpareParts();

                            SparePart.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePart.Name = Convert.ToString(reader["Name"]);
                            }

                            SpareParts.Add(SparePart);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSparePartListByCatalogueItem(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SpareParts;
        }

        /// <summary>
        /// This method is used to get Catalogue Item by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get catalogue item id.</param>
        /// <returns>The data of catalogue item by id.</returns>
        public CatalogueItem GetCatalogueItemByIdCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem, string CatalogueItemAttachedDocPath)
        {
            CatalogueItem catalogueItem = new CatalogueItem();
            try
            {
                using (MySqlConnection connCatalogueItems = new MySqlConnection(PCMConnectionString))
                {
                    connCatalogueItems.Open();

                    MySqlCommand catalogueitemCommand = new MySqlCommand("PCM_GetCatalogueItemByIdCatalogueItem", connCatalogueItems);
                    catalogueitemCommand.CommandType = CommandType.StoredProcedure;
                    catalogueitemCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);

                    using (MySqlDataReader catalogueitemReader = catalogueitemCommand.ExecuteReader())
                    {
                        while (catalogueitemReader.Read())
                        {
                            catalogueItem.IdCatalogueItem = Convert.ToUInt32(catalogueitemReader["idCatalogueItem"]);

                            if (catalogueitemReader["Code"] != DBNull.Value)
                            {
                                catalogueItem.Code = Convert.ToString(catalogueitemReader["Code"]);
                            }
                            if (catalogueitemReader["IdTemplate"] != DBNull.Value)
                            {
                                catalogueItem.IdTemplate = Convert.ToUInt64(catalogueitemReader["IdTemplate"]);
                                catalogueItem.Template = new Template();
                                catalogueItem.Template.IdTemplate = Convert.ToByte(catalogueitemReader["IdTemplate"]);
                                if (catalogueitemReader["TemplateName"] != DBNull.Value)
                                {
                                    catalogueItem.Template.Name = Convert.ToString(catalogueitemReader["TemplateName"]);
                                }
                            }
                            if (catalogueitemReader["IdCPType"] != DBNull.Value)
                            {
                                catalogueItem.IdCPType = Convert.ToUInt64(catalogueitemReader["IdCPType"]);
                                catalogueItem.ProductType = new ProductTypes();
                                catalogueItem.ProductType.IdCPType = Convert.ToUInt64(catalogueitemReader["IdCPType"]);
                                if (catalogueitemReader["ProductType"] != DBNull.Value)
                                {
                                    catalogueItem.ProductType.Name = Convert.ToString(catalogueitemReader["ProductType"]);
                                }
                            }
                            if (catalogueitemReader["Name"] != DBNull.Value)
                            {
                                catalogueItem.Name = Convert.ToString(catalogueitemReader["Name"]);
                            }
                            if (catalogueitemReader["Description"] != DBNull.Value)
                            {
                                catalogueItem.Description = Convert.ToString(catalogueitemReader["Description"]);
                            }
                            if (catalogueitemReader["IdStatus"] != DBNull.Value)
                            {
                                catalogueItem.IdStatus = Convert.ToInt32(catalogueitemReader["IdStatus"]);
                                catalogueItem.Status = new LookupValue();
                                catalogueItem.Status.IdLookupValue = Convert.ToInt32(catalogueitemReader["IdStatus"]);
                                if (catalogueitemReader["Status"] != DBNull.Value)
                                {
                                    catalogueItem.Status.Value = Convert.ToString(catalogueitemReader["Status"]);
                                }
                            }
                            if (catalogueitemReader["CreatedIn"] != DBNull.Value)
                            {
                                catalogueItem.CreatedIn = Convert.ToDateTime(catalogueitemReader["CreatedIn"]);
                            }
                            if (catalogueitemReader["LastUpdate"] != DBNull.Value)
                            {
                                catalogueItem.LastUpdate = Convert.ToDateTime(catalogueitemReader["LastUpdate"]);
                            }

                            if (catalogueitemReader["Name_es"] != DBNull.Value)
                            {
                                catalogueItem.Name_es = Convert.ToString(catalogueitemReader["Name_es"]);
                            }
                            if (catalogueitemReader["Name_fr"] != DBNull.Value)
                            {
                                catalogueItem.Name_fr = Convert.ToString(catalogueitemReader["Name_fr"]);
                            }
                            if (catalogueitemReader["Name_pt"] != DBNull.Value)
                            {
                                catalogueItem.Name_pt = Convert.ToString(catalogueitemReader["Name_pt"]);
                            }
                            if (catalogueitemReader["Name_ro"] != DBNull.Value)
                            {
                                catalogueItem.Name_ro = Convert.ToString(catalogueitemReader["Name_ro"]);
                            }
                            if (catalogueitemReader["Name_ru"] != DBNull.Value)
                            {
                                catalogueItem.Name_ru = Convert.ToString(catalogueitemReader["Name_ru"]);
                            }
                            if (catalogueitemReader["Name_zh"] != DBNull.Value)
                            {
                                catalogueItem.Name_zh = Convert.ToString(catalogueitemReader["Name_zh"]);
                            }
                            if (catalogueitemReader["Description_es"] != DBNull.Value)
                            {
                                catalogueItem.Description_es = Convert.ToString(catalogueitemReader["Description_es"]);
                            }
                            if (catalogueitemReader["Description_fr"] != DBNull.Value)
                            {
                                catalogueItem.Description_fr = Convert.ToString(catalogueitemReader["Description_fr"]);
                            }
                            if (catalogueitemReader["Description_pt"] != DBNull.Value)
                            {
                                catalogueItem.Description_pt = Convert.ToString(catalogueitemReader["Description_pt"]);
                            }
                            if (catalogueitemReader["Description_ro"] != DBNull.Value)
                            {
                                catalogueItem.Description_ro = Convert.ToString(catalogueitemReader["Description_ro"]);
                            }
                            if (catalogueitemReader["Description_ru"] != DBNull.Value)
                            {
                                catalogueItem.Description_ru = Convert.ToString(catalogueitemReader["Description_ru"]);
                            }
                            if (catalogueitemReader["Description_zh"] != DBNull.Value)
                            {
                                catalogueItem.Description_zh = Convert.ToString(catalogueitemReader["Description_zh"]);
                            }
                        }
                    }
                }

                catalogueItem.WayList = GetWayListByCatalogueItem(PCMConnectionString, catalogueItem.IdCatalogueItem);
                catalogueItem.DetectionList = GetDetectionListByCatalogueItem(PCMConnectionString, catalogueItem.IdCatalogueItem);
                catalogueItem.OptionList = GetOptionListByCatalogueItem(PCMConnectionString, catalogueItem.IdCatalogueItem);
                catalogueItem.SparePartList = GetSparePartListByCatalogueItem(PCMConnectionString, catalogueItem.IdCatalogueItem);
                catalogueItem.FamilyList = GetFamiliesByCatalogueItem(PCMConnectionString, catalogueItem.IdCatalogueItem);
                catalogueItem.FileList = GetCatalogueItemAttachedDocsByIdCatalogueItem(PCMConnectionString, catalogueItem.IdCatalogueItem, CatalogueItemAttachedDocPath);
                catalogueItem.CatalogueItemAttachedLinkList = GetCatalogueItemAttachedLinksByIdCatalogueItem(PCMConnectionString, catalogueItem.IdCatalogueItem);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCatalogueItemByID(). IdCatalogueItem- {0} ErrorMessage- {1}", IdCatalogueItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return catalogueItem;
        }

        /// <summary>
        /// This method is used to get all product Types by template.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Product Types By Template.</returns>
        public List<ProductTypes> GetProductTypesByTemplate(string PCMConnectionString, UInt64 idTemplate)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetProductTypesByTemplate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", idTemplate);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypesByTemplate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }

        /// <summary>
        /// This method is to get latest Catalogue Item code
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>latest Catalogue Item code</returns>
        public string GetLatestCatalogueItemCode(string PCMConnectionString)
        {
            UInt32 idCatalogueItem;
            string CatalogueItemCode;
            string Characters = "CP";
            Int16 Year = 0;
            string Seperator = ".";
            Int16 Number = 0;

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLatestCatalogueItemCode", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["idCatalogueItem"] != DBNull.Value)
                                idCatalogueItem = Convert.ToUInt32(reader["idCatalogueItem"]);

                            if (reader["CatalogueItemCode"] != DBNull.Value)
                                CatalogueItemCode = Convert.ToString(reader["CatalogueItemCode"]);

                            if (reader["Characters"] != DBNull.Value)
                                Characters = Convert.ToString(reader["Characters"]);

                            if (reader["Year"] != DBNull.Value)
                                Year = Convert.ToInt16(reader["Year"]);

                            if (reader["Seperator"] != DBNull.Value)
                                Seperator = Convert.ToString(reader["Seperator"]);

                            if (reader["Number"] != DBNull.Value)
                                Number = Convert.ToInt16(reader["Number"]);
                        }
                    }
                }

                Int16 currentYear = Convert.ToInt16(DateTime.Now.ToString("yy"));

                if (Year == currentYear)
                {
                    Number += 1;
                    return string.Format("{0}{1}{2}{3}", Characters, currentYear, Seperator, Number.ToString("0000"));
                }
                else if (currentYear > Year)
                {
                    return string.Format("{0}{1}{2}{3}", "CP", currentYear, Seperator, 1.ToString("0000"));
                }
                else
                {
                    return string.Format("{0}{1}{2}{3}", "CP", currentYear, Seperator, 1.ToString("0000"));
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestCatalogueItemCode(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get all Test Types.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Test Types.</returns>
        public List<TestTypes> GetAllTestTypes(string PCMConnectionString)
        {
            List<TestTypes> TestTypes = new List<TestTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllTestTypes", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            TestTypes TestType = new TestTypes();
                            TestType.IdTestType = Convert.ToUInt64(reader["IdTestType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                TestType.Name = Convert.ToString(reader["Name"]);
                            }
                            TestTypes.Add(TestType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllTestTypes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return TestTypes;
        }

        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType(PCMConnectionString, productTypes.IdCPType);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);

                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        /// <summary>
        /// This method is used to get Detection by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="DetectionAttachedDocPath">Get attached doc path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <returns>The data of detection by id.</returns>
        public DetectionDetails GetDetectionByIdDetection(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }

        /// <summary>
        /// This method is used to get all Languages.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Language.</returns>
        public List<Language> GetAllLanguages(string PCMConnectionString)
        {
            List<Language> Languages = new List<Language>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllLanguages", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Language Language = new Language();
                            Language.IdLanguage = Convert.ToInt32(reader["IdLanguage"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Language.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["TwoLetterIsoLanguage"] != DBNull.Value)
                            {
                                Language.TwoLetterISOLanguage = Convert.ToString(reader["TwoLetterIsoLanguage"]);
                            }
                            Languages.Add(Language);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllLanguages(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Languages;
        }

        /// <summary>
        /// This method is used to get Product Type Images by id product type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductType">Get product type image id.</param>
        /// <param name="ProductTypeImagePath">Get product type image path.</param>
        /// <returns>The list of Product Type Image by id product type.</returns>
        public List<ProductTypeImage> GetProductTypeImagesByIdProductType(string PCMConnectionString, UInt64 IdProductType, string ProductTypeImagePath)
        {
            List<ProductTypeImage> ProductTypeImages = new List<ProductTypeImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeImagesByIdCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdProductType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeImage ProductTypeImage = new ProductTypeImage();

                            ProductTypeImage.IdCPTypeImage = Convert.ToUInt64(reader["IdCPTypeImage"]);
                            ProductTypeImage.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                ProductTypeImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                ProductTypeImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                ProductTypeImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeImage.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            ProductTypeImage.ProductTypeImageInBytes = GetProductTypeImage(Convert.ToString(ProductTypeImage.IdCPTypeImage), ProductTypeImagePath, ProductTypeImage.SavedFileName);
                            ProductTypeImages.Add(ProductTypeImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeImagesByIdProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeImages;
        }

        /// <summary>
        /// This method is used to get product type image by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductTypeImage">Get product type image id.</param>
        /// <param name="ProductTypeImagePath">Get product type image path.</param>
        /// <returns>The data of product type image by id.</returns>
        public ProductTypeImage GetProductTypeImagesByIdProductTypeImage(string PCMConnectionString, UInt64 IdProductTypeImage, string ProductTypeImagePath)
        {
            ProductTypeImage productTypeImage = new ProductTypeImage();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeImagesByIdCPTypeImage", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeImage", IdProductTypeImage);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            productTypeImage.IdCPTypeImage = Convert.ToUInt64(reader["IdCPTypeImage"]);
                            productTypeImage.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                productTypeImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                productTypeImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                productTypeImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                productTypeImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                productTypeImage.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            productTypeImage.ProductTypeImageInBytes = GetProductTypeImage(Convert.ToString(productTypeImage.IdCPTypeImage), ProductTypeImagePath, productTypeImage.SavedFileName);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeImagesByIdProductTypeImage(). IdProductTypeImage- {0} ErrorMessage- {1}", IdProductTypeImage, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypeImage;
        }

        /// <summary>
        /// This method is used to get product type image by id.
        /// </summary>
        /// <param name="IdProductTypeImage">Get product type image id.</param>
        /// <param name="ProductTypeImagePath">Get Image Path.</param>
        /// <param name="SavedFileName">Get File Name.</param>
        public byte[] GetProductTypeImage(string IdProductTypeImage, string ProductTypeImagePath, string SavedFileName)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Format(@"{0}\{1}\{2}", ProductTypeImagePath, IdProductTypeImage, SavedFileName);

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeImage(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get Detection Images by id Detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get Detection image id.</param>
        /// <param name="DetectionImagePath">Get Detection image path.</param>
        /// <returns>The list of Detection Image by id Detection.</returns>
        public List<DetectionImage> GetDetectionImagesByIdDetection(string PCMConnectionString, UInt32 IdDetection, string DetectionImagePath)
        {
            List<DetectionImage> DetectionImages = new List<DetectionImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionImagesByIdDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionImage DetectionImage = new DetectionImage();

                            DetectionImage.IdDetectionImage = Convert.ToUInt32(reader["IdDetectionImage"]);
                            DetectionImage.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                DetectionImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                DetectionImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                DetectionImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionImage.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            DetectionImage.DetectionImageInBytes = GetDetectionImage(Convert.ToString(DetectionImage.IdDetectionImage), DetectionImagePath, DetectionImage.SavedFileName);
                            DetectionImages.Add(DetectionImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionImagesByIdDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionImages;
        }

        /// <summary>
        /// This method is used to get Detection image by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionImage">Get Detection image id.</param>
        /// <param name="DetectionImagePath">Get Detection image path.</param>
        /// <returns>The data of Detection image by id.</returns>
        public DetectionImage GetDetectionImagesByIdDetectionImage(string PCMConnectionString, UInt32 IdDetectionImage, string DetectionImagePath)
        {
            DetectionImage DetectionImage = new DetectionImage();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionImagesByIdDetectionImage", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionImage", IdDetectionImage);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionImage.IdDetectionImage = Convert.ToUInt32(reader["IdDetectionImage"]);
                            DetectionImage.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                DetectionImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                DetectionImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                DetectionImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionImage.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            DetectionImage.DetectionImageInBytes = GetDetectionImage(Convert.ToString(DetectionImage.IdDetectionImage), DetectionImagePath, DetectionImage.SavedFileName);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionImagesByIdDetectionImage(). IdDetectionImage- {0} ErrorMessage- {1}", IdDetectionImage, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionImage;
        }

        /// <summary>
        /// This method is used to get detection image by id.
        /// </summary>
        /// <param name="IdDetectionImage">Get detection image id.</param>
        /// <param name="DetectionImagePath">Get Image Path.</param>
        /// <param name="SavedFileName">Get File Name.</param>
        public byte[] GetDetectionImage(string IdDetectionImage, string DetectionImagePath, string SavedFileName)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Format(@"{0}\{1}\{2}", DetectionImagePath, IdDetectionImage, SavedFileName);

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionImage(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get Product Type Attached Docs by id product type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductType">Get product type Attached Doc id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type attached doc path.</param>
        /// <returns>The list of Product Type Attached Doc by id product type.</returns>
        public List<ProductTypeAttachedDoc> GetProductTypeAttachedDocsByIdProductType(string PCMConnectionString, UInt64 IdProductType, string ProductTypeAttachedDocPath)
        {
            List<ProductTypeAttachedDoc> ProductTypeAttachedDocs = new List<ProductTypeAttachedDoc>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeAttachedDocsByIdCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdProductType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeAttachedDoc ProductTypeAttachedDoc = new ProductTypeAttachedDoc();

                            ProductTypeAttachedDoc.IdCPTypeAttachedDoc = Convert.ToUInt32(reader["IdCPTypeAttachedDoc"]);
                            ProductTypeAttachedDoc.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["IdDocType"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.IdDocType = Convert.ToInt32(reader["IdDocType"]);
                                ProductTypeAttachedDoc.DocumentType = new DocumentType();
                                ProductTypeAttachedDoc.DocumentType.IdDocumentType = Convert.ToByte(reader["IdDocType"]);
                                if (reader["DocumentType"] != DBNull.Value)
                                {
                                    ProductTypeAttachedDoc.DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            ProductTypeAttachedDoc.ProductTypeAttachedDocInBytes = GetProductTypeAttachedDoc(Convert.ToString(ProductTypeAttachedDoc.IdCPTypeAttachedDoc), ProductTypeAttachedDocPath, ProductTypeAttachedDoc.SavedFileName);
                            ProductTypeAttachedDocs.Add(ProductTypeAttachedDoc);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedDocsByIdProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeAttachedDocs;
        }

        /// <summary>
        /// This method is used to get product type Attached Doc by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductTypeAttachedDoc">Get product type Attached Doc id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type attached doc path.</param>
        /// <returns>The data of product type Attached Doc by id.</returns>
        public ProductTypeAttachedDoc GetProductTypeAttachedDocsByIdProductTypeAttachedDoc(string PCMConnectionString, Int32 IdProductTypeAttachedDoc, string ProductTypeAttachedDocPath)
        {
            ProductTypeAttachedDoc productTypeAttachedDoc = new ProductTypeAttachedDoc();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeAttachedDocsByIdCPTypeAttachedDoc", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", IdProductTypeAttachedDoc);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            productTypeAttachedDoc.IdCPTypeAttachedDoc = Convert.ToUInt32(reader["IdCPTypeAttachedDoc"]);
                            productTypeAttachedDoc.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                productTypeAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                productTypeAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                productTypeAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["IdDocType"] != DBNull.Value)
                            {
                                productTypeAttachedDoc.IdDocType = Convert.ToInt32(reader["IdDocType"]);
                                productTypeAttachedDoc.DocumentType = new DocumentType();
                                productTypeAttachedDoc.DocumentType.IdDocumentType = Convert.ToByte(reader["IdDocType"]);
                                if (reader["DocumentType"] != DBNull.Value)
                                {
                                    productTypeAttachedDoc.DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                productTypeAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            productTypeAttachedDoc.ProductTypeAttachedDocInBytes = GetProductTypeAttachedDoc(Convert.ToString(productTypeAttachedDoc.IdCPTypeAttachedDoc), ProductTypeAttachedDocPath, productTypeAttachedDoc.SavedFileName);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedDocsByIdProductTypeAttachedDoc(). IdProductTypeAttachedDoc- {0} ErrorMessage- {1}", IdProductTypeAttachedDoc, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypeAttachedDoc;
        }

        /// <summary>
        /// This method is used to get product type Attached Doc by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductTypeAttachedDoc">Get product type Attached Doc id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get Attached Doc Path.</param>
        /// <param name="SavedFileName">Get File Name.</param>
        public byte[] GetProductTypeAttachedDoc(string IdProductTypeAttachedDoc, string ProductTypeAttachedDocPath, string SavedFileName)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Format(@"{0}\{1}\{2}", ProductTypeAttachedDocPath, IdProductTypeAttachedDoc, SavedFileName);

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedDoc(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get Catalogue Item Attached Docs by id Catalogue Item.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get Catalogue Item id.</param>
        /// <param name="CatalogueItemAttachedDocPath">Get Catalogue Item attached doc path.</param>
        /// <returns>The list of Catalogue Item Attached Doc by id Catalogue Item.</returns>
        public List<CatalogueItemAttachedDoc> GetCatalogueItemAttachedDocsByIdCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem, string CatalogueItemAttachedDocPath)
        {
            List<CatalogueItemAttachedDoc> CatalogueItemAttachedDocs = new List<CatalogueItemAttachedDoc>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCatalogueItemAttachedDocsByIdCatalogueItem", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CatalogueItemAttachedDoc CatalogueItemAttachedDoc = new CatalogueItemAttachedDoc();

                            CatalogueItemAttachedDoc.IdCatalogueItemAttachedDoc = Convert.ToUInt32(reader["IdCatalogueItemAttachedDoc"]);
                            CatalogueItemAttachedDoc.IdCatalogueItem = Convert.ToUInt32(reader["IdCatalogueItem"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["idDocType"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.IdDocType = Convert.ToUInt32(reader["idDocType"]);
                                CatalogueItemAttachedDoc.DocumentType = new DocumentType();
                                CatalogueItemAttachedDoc.DocumentType.IdDocumentType = Convert.ToByte(reader["idDocType"]);
                                if (reader["DocumentType"] != DBNull.Value)
                                {
                                    CatalogueItemAttachedDoc.DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            CatalogueItemAttachedDoc.CatalogueItemAttachedDocInBytes = GetCatalogueItemAttachedDoc(Convert.ToString(CatalogueItemAttachedDoc.IdCatalogueItemAttachedDoc), CatalogueItemAttachedDocPath, CatalogueItemAttachedDoc.SavedFileName);
                            CatalogueItemAttachedDocs.Add(CatalogueItemAttachedDoc);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCatalogueItemAttachedDocsByIdCatalogueItem(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CatalogueItemAttachedDocs;
        }

        /// <summary>
        /// This method is used to get catalogue item Attached Doc by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItemAttachedDoc">Get catalogue item Attached Doc id.</param>
        /// <param name="CatalogueItemAttachedDocPath">Get catalogue item attached doc path.</param>
        /// <returns>The data of catalogue item Attached Doc by id.</returns>
        public CatalogueItemAttachedDoc GetCatalogueItemAttachedDocsById(string PCMConnectionString, UInt32 IdCatalogueItemAttachedDoc, string CatalogueItemAttachedDocPath)
        {
            CatalogueItemAttachedDoc CatalogueItemAttachedDoc = new CatalogueItemAttachedDoc();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCatalogueItemAttachedDocsByIdCatalogueItemAttachedDoc", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItemAttachedDoc", IdCatalogueItemAttachedDoc);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CatalogueItemAttachedDoc.IdCatalogueItemAttachedDoc = Convert.ToUInt32(reader["IdCatalogueItemAttachedDoc"]);
                            CatalogueItemAttachedDoc.IdCatalogueItem = Convert.ToUInt32(reader["IdCatalogueItem"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["idDocType"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.IdDocType = Convert.ToUInt32(reader["idDocType"]);
                                CatalogueItemAttachedDoc.DocumentType = new DocumentType();
                                CatalogueItemAttachedDoc.DocumentType.IdDocumentType = Convert.ToByte(reader["idDocType"]);
                                if (reader["DocumentType"] != DBNull.Value)
                                {
                                    CatalogueItemAttachedDoc.DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                CatalogueItemAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            CatalogueItemAttachedDoc.CatalogueItemAttachedDocInBytes = GetCatalogueItemAttachedDoc(Convert.ToString(CatalogueItemAttachedDoc.IdCatalogueItemAttachedDoc), CatalogueItemAttachedDocPath, CatalogueItemAttachedDoc.SavedFileName);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCatalogueItemAttachedDocsById(). IdCatalogueItemAttachedDoc- {0} ErrorMessage- {1}", IdCatalogueItemAttachedDoc, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CatalogueItemAttachedDoc;
        }

        /// <summary>
        /// This method is used to get catalogue item Attached Doc by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItemAttachedDoc">Get catalogue item Attached Doc id.</param>
        /// <param name="CatalogueItemAttachedDocPath">Get Attached Doc Path.</param>
        /// <param name="SavedFileName">Get File Name.</param>
        public byte[] GetCatalogueItemAttachedDoc(string IdCatalogueItemAttachedDoc, string CatalogueItemAttachedDocPath, string SavedFileName)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Format(@"{0}\{1}\{2}", CatalogueItemAttachedDocPath, IdCatalogueItemAttachedDoc, SavedFileName);

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCatalogueItemAttachedDoc(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get Detection Attached Docs by id Detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get Detection Attached Doc id.</param>
        /// <param name="DetectionAttachedDocPath">Get Detection attached doc path.</param>
        /// <returns>The list of Detection Attached Doc by id Detection.</returns>
        public List<DetectionAttachedDoc> GetDetectionAttachedDocsByIdDetection(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath)
        {
            List<DetectionAttachedDoc> DetectionAttachedDocs = new List<DetectionAttachedDoc>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionAttachedDocsByIdDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionAttachedDoc DetectionAttachedDoc = new DetectionAttachedDoc();

                            DetectionAttachedDoc.IdDetectionAttachedDoc = Convert.ToUInt32(reader["IdDetectionAttachedDoc"]);
                            DetectionAttachedDoc.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["IdDocType"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.IdDocType = Convert.ToUInt32(reader["IdDocType"]);
                                DetectionAttachedDoc.DocumentType = new DocumentType();
                                DetectionAttachedDoc.DocumentType.IdDocumentType = Convert.ToByte(reader["IdDocType"]);
                                if (reader["DocumentType"] != DBNull.Value)
                                {
                                    DetectionAttachedDoc.DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            DetectionAttachedDoc.DetectionAttachedDocInBytes = GetDetectionAttachedDoc(Convert.ToString(DetectionAttachedDoc.IdDetectionAttachedDoc), DetectionAttachedDocPath, DetectionAttachedDoc.SavedFileName);
                            DetectionAttachedDocs.Add(DetectionAttachedDoc);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionAttachedDocsByIdDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionAttachedDocs;
        }

        /// <summary>
        /// This method is used to get Detection Attached Doc by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionAttachedDoc">Get Detection Attached Doc id.</param>
        /// <param name="DetectionAttachedDocPath">Get Detection attached doc path.</param>
        /// <returns>The data of Detection Attached Doc by id.</returns>
        public DetectionAttachedDoc GetDetectionAttachedDocsById(string PCMConnectionString, UInt32 IdDetectionAttachedDoc, string DetectionAttachedDocPath)
        {
            DetectionAttachedDoc DetectionAttachedDoc = new DetectionAttachedDoc();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionAttachedDocsByIdDetectionAttachedDoc", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedDoc", IdDetectionAttachedDoc);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionAttachedDoc.IdDetectionAttachedDoc = Convert.ToUInt32(reader["IdDetectionAttachedDoc"]);
                            DetectionAttachedDoc.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["IdDocType"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.IdDocType = Convert.ToUInt32(reader["IdDocType"]);
                                DetectionAttachedDoc.DocumentType = new DocumentType();
                                DetectionAttachedDoc.DocumentType.IdDocumentType = Convert.ToByte(reader["IdDocType"]);
                                if (reader["DocumentType"] != DBNull.Value)
                                {
                                    DetectionAttachedDoc.DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            DetectionAttachedDoc.DetectionAttachedDocInBytes = GetDetectionAttachedDoc(Convert.ToString(DetectionAttachedDoc.IdDetectionAttachedDoc), DetectionAttachedDocPath, DetectionAttachedDoc.SavedFileName);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionAttachedDocsById(). IdDetectionAttachedDoc- {0} ErrorMessage- {1}", IdDetectionAttachedDoc, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionAttachedDoc;
        }

        /// <summary>
        /// This method is used to get Detection Attached Doc by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionAttachedDoc">Get Detection Attached Doc id.</param>
        /// <param name="DetectionAttachedDocPath">Get Attached Doc Path.</param>
        /// <param name="SavedFileName">Get File Name.</param>
        public byte[] GetDetectionAttachedDoc(string IdDetectionAttachedDoc, string DetectionAttachedDocPath, string SavedFileName)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Format(@"{0}\{1}\{2}", DetectionAttachedDocPath, IdDetectionAttachedDoc, SavedFileName);

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionAttachedDoc(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get Catalogue Item Attached Links by id Catalogue Item.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItem">Get Catalogue Item id.</param>
        /// <returns>The list of Catalogue Item Attached Link by id Catalogue Item.</returns>
        public List<CatalogueItemAttachedLink> GetCatalogueItemAttachedLinksByIdCatalogueItem(string PCMConnectionString, UInt32 IdCatalogueItem)
        {
            List<CatalogueItemAttachedLink> CatalogueItemAttachedLinks = new List<CatalogueItemAttachedLink>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCatalogueItemsAttachedLinksByIdCatalogueItem", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItem", IdCatalogueItem);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CatalogueItemAttachedLink CatalogueItemAttachedLink = new CatalogueItemAttachedLink();

                            CatalogueItemAttachedLink.IdCatalogueItemAttachedLink = Convert.ToUInt32(reader["IdCatalogueItemAttachedLink"]);
                            CatalogueItemAttachedLink.IdCatalogueItem = Convert.ToUInt32(reader["IdCatalogueItem"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            CatalogueItemAttachedLinks.Add(CatalogueItemAttachedLink);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCatalogueItemAttachedLinksByIdCatalogueItem(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CatalogueItemAttachedLinks;
        }

        /// <summary>
        /// This method is used to get catalogue item Attached Link by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCatalogueItemAttachedLink">Get catalogue item Attached Link id.</param>
        /// <returns>The data of catalogue item Attached Link by id.</returns>
        public CatalogueItemAttachedLink GetCatalogueItemAttachedLinkById(string PCMConnectionString, UInt32 IdCatalogueItemAttachedLink)
        {
            CatalogueItemAttachedLink CatalogueItemAttachedLink = new CatalogueItemAttachedLink();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCatalogueItemsAttachedLinksByIdCatalogueItemAttachedLink", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCatalogueItemAttachedLink", IdCatalogueItemAttachedLink);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CatalogueItemAttachedLink.IdCatalogueItemAttachedLink = Convert.ToUInt32(reader["IdCatalogueItemAttachedLink"]);
                            CatalogueItemAttachedLink.IdCatalogueItem = Convert.ToUInt32(reader["IdCatalogueItem"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                CatalogueItemAttachedLink.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCatalogueItemAttachedLinkById(). IdCatalogueItemAttachedLink- {0} ErrorMessage- {1}", IdCatalogueItemAttachedLink, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CatalogueItemAttachedLink;
        }

        /// <summary>
        /// This method is used to get Product Type Attached Links by id Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type Attached Link id.</param>
        /// <returns>The list of Product Type Attached Link by id Product Type.</returns>
        public List<ProductTypeAttachedLink> GetProductTypeAttachedLinksByIdProductType(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ProductTypeAttachedLink> ProductTypeAttachedLinks = new List<ProductTypeAttachedLink>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypesAttachedLinksByIdCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeAttachedLink ProductTypeAttachedLink = new ProductTypeAttachedLink();

                            ProductTypeAttachedLink.IdCPTypeAttachedLink = Convert.ToUInt32(reader["IdCPTypeAttachedLink"]);
                            ProductTypeAttachedLink.IdCPType = Convert.ToUInt32(reader["IdCPType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            ProductTypeAttachedLinks.Add(ProductTypeAttachedLink);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedLinksByIdProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeAttachedLinks;
        }

        /// <summary>
        /// This method is used to get catalogue item Attached Link by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductTypeAttachedLink">Get catalogue item Attached Link id.</param>
        /// <returns>The data of catalogue item Attached Link by id.</returns>
        public ProductTypeAttachedLink GetProductTypeAttachedLinkById(string PCMConnectionString, UInt32 IdCPTypeAttachedLink)
        {
            ProductTypeAttachedLink ProductTypeAttachedLink = new ProductTypeAttachedLink();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypesAttachedLinksByIdCPTypeAttachedLink", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedLink", IdCPTypeAttachedLink);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeAttachedLink.IdCPTypeAttachedLink = Convert.ToUInt32(reader["IdCPTypeAttachedLink"]);
                            ProductTypeAttachedLink.IdCPType = Convert.ToUInt32(reader["IdCPType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedLinkById(). IdCPTypeAttachedLink- {0} ErrorMessage- {1}", IdCPTypeAttachedLink, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeAttachedLink;
        }

        /// <summary>
        /// This method is used to get Detection Attached Links by id Detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get Detection id.</param>
        /// <returns>The list of Detection Attached Link by id Detection.</returns>
        public List<DetectionAttachedLink> GetDetectionAttachedLinksByIdDetection(string PCMConnectionString, UInt32 IdDetection)
        {
            List<DetectionAttachedLink> DetectionAttachedLinks = new List<DetectionAttachedLink>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsAttachedLinksByIdDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionAttachedLink DetectionAttachedLink = new DetectionAttachedLink();

                            DetectionAttachedLink.IdDetectionAttachedLink = Convert.ToUInt32(reader["IdDetectionAttachedLink"]);
                            DetectionAttachedLink.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionAttachedLink.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                DetectionAttachedLink.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionAttachedLink.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionAttachedLink.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            DetectionAttachedLinks.Add(DetectionAttachedLink);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionAttachedLinksByIdDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionAttachedLinks;
        }

        /// <summary>
        /// This method is used to get catalogue item Attached Link by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionAttachedLink">Get catalogue item Attached Link id.</param>
        /// <returns>The data of catalogue item Attached Link by id.</returns>
        public DetectionAttachedLink GetDetectionAttachedLinkById(string PCMConnectionString, UInt32 IdDetectionAttachedLink)
        {
            DetectionAttachedLink DetectionAttachedLink = new DetectionAttachedLink();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsAttachedLinksByIdDetectionAttachedLink", connDetectionDetails);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedLink", IdDetectionAttachedLink);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionAttachedLink.IdDetectionAttachedLink = Convert.ToUInt32(reader["IdDetectionAttachedLink"]);
                            DetectionAttachedLink.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionAttachedLink.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                DetectionAttachedLink.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionAttachedLink.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionAttachedLink.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionAttachedLinkById(). IdDetectionAttachedLink- {0} ErrorMessage- {1}", IdDetectionAttachedLink, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionAttachedLink;
        }

        /// <summary>
        /// This method is to get latest Product Type Reference
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>latest Product Type Reference</returns>
        public string GetLatestProuductTypeReference(string PCMConnectionString)
        {
            UInt32 idCPType;
            string cptypeReference;
            string Characters = "CP";
            Int16 Year = 0;
            string Seperator = ".";
            Int16 Number = 0;

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLatestProuductTypeReference", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["IdCPType"] != DBNull.Value)
                                idCPType = Convert.ToUInt32(reader["IdCPType"]);

                            if (reader["cptypeReference"] != DBNull.Value)
                                cptypeReference = Convert.ToString(reader["cptypeReference"]);

                            if (reader["Characters"] != DBNull.Value)
                                Characters = Convert.ToString(reader["Characters"]);

                            if (reader["Year"] != DBNull.Value)
                                Year = Convert.ToInt16(reader["Year"]);

                            if (reader["Seperator"] != DBNull.Value)
                                Seperator = Convert.ToString(reader["Seperator"]);

                            if (reader["Number"] != DBNull.Value)
                                Number = Convert.ToInt16(reader["Number"]);
                        }
                    }
                }

                Int16 currentYear = Convert.ToInt16(DateTime.Now.ToString("yy"));

                if (Year == currentYear)
                {
                    Number += 1;
                    return string.Format("{0}{1}{2}{3}", Characters, currentYear, Seperator, Number.ToString("0000"));
                }
                else if (currentYear > Year)
                {
                    return string.Format("{0}{1}{2}{3}", "CP", currentYear, Seperator, 1.ToString("0000"));
                }
                else
                {
                    return string.Format("{0}{1}{2}{3}", "CP", currentYear, Seperator, 1.ToString("0000"));
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestProuductTypeReference(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get Families by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Families by Product Type.</returns>
        public List<ConnectorFamilies> GetFamiliesByProductType(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ConnectorFamilies> ConnectorFamilies = new List<ConnectorFamilies>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFamiliesByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ConnectorFamilies ConnectorFamily = new ConnectorFamilies();
                            ConnectorFamily.IdFamily = Convert.ToUInt64(reader["IdFamily"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                ConnectorFamily.Name = Convert.ToString(reader["Name"]);
                            }
                            ConnectorFamilies.Add(ConnectorFamily);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetFamiliesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ConnectorFamilies;
        }

        /// <summary>
        /// This method is used to get Way List by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Ways by Product Type.</returns>
        public List<Ways> GetWayListByProductType(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1); //Detetction type: 1 for ways. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }

                            Ways.Add(Way);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWayListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }

        /// <summary>
        /// This method is used to get Detection List by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Detections by Product Type.</returns>
        public List<Detections> GetDetectionListByProductType(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> Detections = new List<Detections>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2); //Detetction type: 2 for detections. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                Detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }
                            if (reader["GroupName"] != DBNull.Value)
                            {
                                Detection.GroupName = Convert.ToString(reader["GroupName"]);
                            }
                            if (reader["GroupOrder"] != DBNull.Value)
                            {
                                Detection.OrderNumber = Convert.ToInt32(reader["GroupOrder"]);
                            }

                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }

        /// <summary>
        /// This method is used to get Option List by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Options by Product Type.</returns>
        public List<Options> GetOptionListByProductType(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> Options = new List<Options>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3); //Detetction type: 3 for options. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            Option.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                Option.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }
                            if (reader["GroupName"] != DBNull.Value)
                            {
                                Option.GroupName = Convert.ToString(reader["GroupName"]);
                            }
                            if (reader["GroupOrder"] != DBNull.Value)
                            {
                                Option.OrderNumber = Convert.ToInt32(reader["GroupOrder"]);
                            }

                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }

        /// <summary>
        /// This method is used to get Spare Part List by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Spare Parts by Product Type.</returns>
        public List<SpareParts> GetSparePartListByProductType(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SpareParts = new List<SpareParts>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4); //Detetction type: 4 for spare parts. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePart = new SpareParts();

                            SparePart.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePart.Name = Convert.ToString(reader["Name"]);
                            }

                            SpareParts.Add(SparePart);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSparePartListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SpareParts;
        }

        /// <summary>
        /// This method is used to get default way type List.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of default way type.</returns>
        public List<DefaultWayType> GetAllDefaultWayTypeList(string PCMConnectionString)
        {
            List<DefaultWayType> defaultWayTypes = new List<DefaultWayType>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllDefaultWayTypes", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DefaultWayType defaultWayType = new DefaultWayType();

                            defaultWayType.IdDefaultWayType = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                defaultWayType.Name = Convert.ToString(reader["Name"]);
                            }

                            defaultWayTypes.Add(defaultWayType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDefaultWayTypeList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return defaultWayTypes;
        }

        /// <summary>
        /// This method is used to get all templates by product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of templates by product Type.</returns>
        public List<Template> GetTemplatesByProductType(string PCMConnectionString, UInt64 IdCPType)
        {
            List<Template> templates = new List<Template>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetTemplatesByProductType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Template template = new Template();
                            template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                template.Name = Convert.ToString(reader["Name"]);
                            }
                            templates.Add(template);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetTemplatesByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return templates;
        }

        /// <summary>
        /// This method is used to get log entries by product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of log by product Type.</returns>
        public List<ProductTypeLogEntry> GetProductTypeLogEntriesByProductType(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ProductTypeLogEntry> CPTypeLogEntries = new List<ProductTypeLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByIdCptype", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeLogEntry ProductTypeLogEntry = new ProductTypeLogEntry();

                            ProductTypeLogEntry.IdLogEntryByCptype = Convert.ToUInt32(reader["IdLogEntryByCptype"]);

                            ProductTypeLogEntry.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            CPTypeLogEntries.Add(ProductTypeLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeLogEntriesByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPTypeLogEntries;
        }

        /// <summary>
        /// This method is used to get Detection Groups.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups.</returns>
        public List<DetectionOrderGroup> GetDetectionOrderGroup(string PCMConnectionString, UInt32 IdDetectionType)
        {
            List<DetectionOrderGroup> DetectionOrderGroups = new List<DetectionOrderGroup>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionOrderGroups", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionOrderGroup DetectionOrderGroup = new DetectionOrderGroup();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                DetectionOrderGroup.Key = Convert.ToString(reader["KeyName"]);
                            }

                            DetectionOrderGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionOrderGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                DetectionOrderGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            DetectionOrderGroups.Add(DetectionOrderGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionOrderGroup(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionOrderGroups;
        }

        /// <summary>
        /// This method is used to get Detection order Groups with detections.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions.</returns>
        public List<DetectionOrderGroup> GetDetectionOrderGroupsWithDetections(string PCMConnectionString, UInt32 IdDetectionType)
        {
            List<DetectionOrderGroup> detectionOrderGroups = new List<DetectionOrderGroup>();
            try
            {
                detectionOrderGroups = GetDetectionOrderGroup(PCMConnectionString, IdDetectionType);
                if (detectionOrderGroups.Count > 0)
                {
                    int i = 1;

                    using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByDetectionGroups", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                        using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                        {
                            while (reader.Read())
                            {
                                DetectionOrderGroup detectionOrderGroup = new DetectionOrderGroup();

                                detectionOrderGroup.Key = Convert.ToString(i);

                                detectionOrderGroup.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                detectionOrderGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                                if (reader["DetectionName"] != DBNull.Value)
                                {
                                    detectionOrderGroup.Name = Convert.ToString(reader["DetectionName"]);
                                }

                                if (reader["Parent"] != DBNull.Value)
                                {
                                    detectionOrderGroup.Parent = Convert.ToString(reader["Parent"]);
                                }
                                detectionOrderGroups.Add(detectionOrderGroup);

                                i++;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionOrderGroupsWithDetections(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionOrderGroups;
        }

        /// <summary>
        /// This method is used to get Detection Groups by detection type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The Detection Groups by detection type.</returns>
        public List<DetectionGroup> GetDetectionGroupsByDetectionType(string PCMConnectionString, UInt32 IdDetectionType)
        {
            List<DetectionGroup> DetectionGroups = new List<DetectionGroup>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsGroupsByDetectionType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionGroup DetectionGroup = new DetectionGroup();

                            DetectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            DetectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                DetectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                DetectionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                DetectionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                DetectionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                DetectionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                DetectionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                DetectionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                DetectionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                DetectionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                DetectionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                DetectionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                DetectionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                DetectionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionGroup.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            DetectionGroups.Add(DetectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroupsByDetectionType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionGroups;
        }

        /// <summary>
        /// This method is used to get all Detection Groups.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups.</returns>
        public List<DetectionGroup> GetDetectionGroupsList(string PCMConnectionString, UInt32 IdDetectionType)
        {
            List<DetectionGroup> DetectionGroups = new List<DetectionGroup>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionGroupsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionGroup DetectionGroup = new DetectionGroup();

                            DetectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            DetectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                DetectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["OriginalName"] != DBNull.Value)
                            {
                                DetectionGroup.OriginalName = Convert.ToString(reader["OriginalName"]);
                            }
                            DetectionGroups.Add(DetectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroupsList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionGroups;
        }

        /// <summary>
        /// This method is used to get Detection Groups by id group.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdGroup">Get id group</param>
        /// <returns>The Detection Groups by id group.</returns>
        public DetectionGroup GetDetectionGroupsByIdGroup(string PCMConnectionString, UInt32 IdGroup)
        {
            DetectionGroup DetectionGroups = new DetectionGroup();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionGroupsByIdGroup", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionGroups.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            DetectionGroups.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionGroups.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                DetectionGroups.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                DetectionGroups.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                DetectionGroups.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                DetectionGroups.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                DetectionGroups.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                DetectionGroups.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                DetectionGroups.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionGroups.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                DetectionGroups.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                DetectionGroups.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                DetectionGroups.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                DetectionGroups.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                DetectionGroups.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                DetectionGroups.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionGroups.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroupsByIdGroup(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionGroups;
        }

        /// <summary>
        /// This method is used to get Detection concat by id group.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdGroup">Get id group</param>
        /// <returns>The Detection concat by id group.</returns>
        public string GetDetectionsConcatByIdGroup(string PCMConnectionString, UInt32 IdGroup)
        {
            string detections = "";
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetConcatDetectionsByDetectionGroup", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["Names"] != DBNull.Value)
                            {
                                detections = Convert.ToString(reader["Names"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroupsByIdGroup(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detections;
        }

        /// <summary>
        /// This method is used to get Detection Groups.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups.</returns>
        public List<Detections> GetDetectionGroups(string PCMConnectionString, UInt32 IdDetectionType)
        {
            List<Detections> Detections = new List<Detections>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsWithDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Detection.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Detection.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Detection.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }

        /// <summary>
        /// This method is used to get Options Groups.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get Options type</param>
        /// <returns>The list of option Groups.</returns>
        public List<Options> GetOptionGroups(string PCMConnectionString, UInt32 IdDetectionType)
        {
            List<Options> Options = new List<Options>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsWithDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Option.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Option.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Option.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Option.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }

        /// <summary>
        /// This method is used to get Detection Groups by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <param name="IdCPType">Get product type</param>
        /// <returns>The list of Detection Groups by cptype.</returns>
        public List<Detections> GetDetectionGroupsByCPType(string PCMConnectionString, UInt32 IdDetectionType, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> Detections = new List<Detections>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Detection.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Detection.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Detection.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroupsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }

        /// <summary>
        /// This method is used to get Options Groups by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get Options type</param>
        /// <param name="IdCPType">Get product type</param>
        /// <returns>The list of option Groups by cptype.</returns>
        public List<Options> GetOptionGroupsByCPType(string PCMConnectionString, UInt32 IdDetectionType, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> Options = new List<Options>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Option.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Option.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Option.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Option.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionGroupsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }

        /// <summary>
        /// This method is used to get SpareParts Groups by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get Options type</param>
        /// <param name="IdCPType">Get product type</param>
        /// <returns>The list of option Groups by cptype.</returns>
        public List<SpareParts> GetSparePartsGroupsByCPType(string PCMConnectionString, UInt32 IdDetectionType, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SpareParts = new List<SpareParts>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePart = new SpareParts();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                SparePart.Key = Convert.ToString(reader["KeyName"]);
                            }

                            SparePart.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePart.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePart.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePart.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SpareParts.Add(SparePart);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSparePartsGroupsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SpareParts;
        }

        /// <summary>
        /// This method is used to get Detection order Groups with detections by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions by cptype.</returns>
        public List<Detections> GetDetectionsWithGroupsByCpType(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                detectionGroups = GetDetectionGroupsByCPType(PCMConnectionString, 2, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                detectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionsWithGroupsByCpType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<Options> GetOptionsWithGroupsByCpType(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                OptionGroups = GetOptionGroupsByCPType(PCMConnectionString, 3, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                OptionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            OptionGroups.Add(OptionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }


        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<SpareParts> GetSparePartsWithGroupsByCpType(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SparePartGroups = new List<SpareParts>();
            try
            {
                SparePartGroups = GetSparePartsGroupsByCPType(PCMConnectionString, 4, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePartGroup = new SpareParts();

                            SparePartGroup.Key = Convert.ToString(reader["IdDetection"]);

                            SparePartGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                SparePartGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePartGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                SparePartGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePartGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePartGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SparePartGroups.Add(SparePartGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SparePartGroups;
        }

        /// <summary>
        /// This method is used to get All Detection Groups with detections.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions.</returns>
        public List<Detections> GetAllDetectionsWithGroups(string PCMConnectionString)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                detectionGroups = GetDetectionGroups(PCMConnectionString, 2);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionsWithGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get Option type</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<Options> GetAllOptionsWithGroups(string PCMConnectionString)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                OptionGroups = GetOptionGroups(PCMConnectionString, 3);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }

                            OptionGroups.Add(OptionGroup);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllOptionsWithGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }

        /// <summary>
        /// This method is used to get all customers
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of customers.</returns>
        public List<RegionsByCustomer> GetAllCustomers(string PCMConnectionString)
        {
            List<RegionsByCustomer> regionsByCustomerList = new List<RegionsByCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllCustomers", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            RegionsByCustomer RegionsByCustomer = new RegionsByCustomer();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                RegionsByCustomer.Key = Convert.ToString(reader["KeyName"]);
                            }

                            RegionsByCustomer.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                RegionsByCustomer.GroupName = Convert.ToString(reader["Name"]);
                            }

                            regionsByCustomerList.Add(RegionsByCustomer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCustomers(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        /// <summary>
        /// This method is used to get customers with regions.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of customers with regions.</returns>
        public List<RegionsByCustomer> GetCustomersWithRegions(string PCMConnectionString)
        {
            List<RegionsByCustomer> regionsByCustomerList = new List<RegionsByCustomer>();
            try
            {
                //regionsByCustomerList = GetAllCustomers(PCMConnectionString);
                //int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegions", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            RegionsByCustomer regionsByCustomer = new RegionsByCustomer();

                            //regionsByCustomer.Key = Convert.ToString(i);

                            regionsByCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            regionsByCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);

                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                regionsByCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                regionsByCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                regionsByCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            regionsByCustomerList.Add(regionsByCustomer);

                            //i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegions(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        /// <summary>
        /// This method is used to get customers with regions by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">CPType id.</param>
        /// <returns>The list of customers with regions by cptype.</returns>
        public List<RegionsByCustomer> GetCustomersWithRegionsByCPType(string PCMConnectionString, UInt64 IdCPType)
        {
            List<RegionsByCustomer> regionsByCustomerList = new List<RegionsByCustomer>();
            try
            {
                //regionsByCustomerList = GetAllCustomers(PCMConnectionString);
                //int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegionsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            RegionsByCustomer regionsByCustomer = new RegionsByCustomer();

                            //regionsByCustomer.Key = Convert.ToString(i);

                            regionsByCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            regionsByCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                regionsByCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }
                            if (reader["RegionName"] != DBNull.Value)
                            {
                                regionsByCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                regionsByCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                regionsByCustomer.IsChecked = true;
                            }
                            if (reader["UniqueId"] != DBNull.Value)
                            {
                                regionsByCustomer.UniqueId = Convert.ToString(reader["UniqueId"]);
                            }
                            regionsByCustomerList.Add(regionsByCustomer);

                            //i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegionsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        /// <summary>
        /// This method is used to get customers with regions by detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Detection id.</param>
        /// <param name="IdDetectionType">Detection type id.</param>
        /// <returns>The list of customers with regions by detection.</returns>
        public List<RegionsByCustomer> GetCustomersWithRegionsByDetection(string PCMConnectionString, UInt32 IdDetection, UInt32 IdDetectionType)
        {
            List<RegionsByCustomer> regionsByCustomerList = new List<RegionsByCustomer>();
            try
            {
                //regionsByCustomerList = GetAllCustomers(PCMConnectionString);
                //int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegionsByDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            RegionsByCustomer regionsByCustomer = new RegionsByCustomer();

                            //regionsByCustomer.Key = Convert.ToString(i);

                            regionsByCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            regionsByCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);

                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                regionsByCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                regionsByCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                regionsByCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                regionsByCustomer.IsChecked = true;
                            }
                            regionsByCustomerList.Add(regionsByCustomer);

                            //i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegionsByDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        /// <summary>
        /// This method is used to get article categories.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Article categories.</returns>
        public List<ArticleCategories> GetArticleCategories(string connectionstring)
        {

            List<ArticleCategories> articleCategories = new List<ArticleCategories>();
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCategories ArticleCategories = new ArticleCategories();
                            ArticleCategories.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                ArticleCategories.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                ArticleCategories.Parent = Convert.ToUInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                ArticleCategories.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                ArticleCategories.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["TaricCode"] != DBNull.Value)
                                ArticleCategories.TaricCode = Convert.ToString(reader["TaricCode"]);

                            if (reader["NCM_Code"] != DBNull.Value)
                                ArticleCategories.NCM_Code = Convert.ToString(reader["NCM_Code"]);

                            if (reader["HS_Code"] != DBNull.Value)
                                ArticleCategories.HS_Code = Convert.ToString(reader["HS_Code"]);

                            if (reader["KeyName"] != DBNull.Value)
                                ArticleCategories.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                ArticleCategories.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                ArticleCategories.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                            {
                                ArticleCategories.Article_count = Convert.ToInt32(reader["Articles_Count"]);
                            }
                            if (reader["Name"] != DBNull.Value && reader["Articles_Count"] != DBNull.Value)
                            {
                                ArticleCategories.NameWithArticleCount = Convert.ToString(ArticleCategories.Name + " [" + ArticleCategories.Article_count + "]");
                                if (ArticleCategories.Parent != null)
                                {
                                    articleCategories.Where(a => a.Parent == null && a.IdArticleCategory == ArticleCategories.Parent).ToList().ForEach(a => { a.NameWithArticleCount = Convert.ToString(a.Name + " [" + Convert.ToInt32(ArticleCategories.Article_count + a.Article_count) + "]"); a.Article_count = Convert.ToInt32(ArticleCategories.Article_count + a.Article_count); });
                                }
                            }
                            else
                            {
                                ArticleCategories.NameWithArticleCount = Convert.ToString(ArticleCategories.Name + " [" + ArticleCategories.Article_count + "]");
                                if (ArticleCategories.Parent != null)
                                {
                                    //if(ArticleCategories.Article_count==0)
                                    //{
                                    //    ArticleCategories.Article_count = 1;
                                    //}
                                    ArticleCategories.NameWithArticleCount = Convert.ToString(ArticleCategories.Name + " [" + ArticleCategories.Article_count + "]");

                                    articleCategories.Where(a => a.Parent == null && a.IdArticleCategory == ArticleCategories.Parent).ToList().ForEach(a => { a.NameWithArticleCount = Convert.ToString(a.Name + " [" + Convert.ToInt32(ArticleCategories.Article_count + a.Article_count) + "]"); a.Article_count = Convert.ToInt32(ArticleCategories.Article_count + a.Article_count); });
                                }
                            }

                            articleCategories.Add(ArticleCategories);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articleCategories;
        }



        /// <summary>
        /// This method is used to get all article.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Article.</returns>
        public List<Articles> GetAllArticles(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdArticleCategory"] != DBNull.Value)
                            {
                                article.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                article.ArticleCategory = new ArticleCategories();
                                article.ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.ArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllArticles(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articles;
        }

        /// <summary>
        /// This method is used to get all article.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Article.</returns>
        public List<Articles> GetAllActiveArticles(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection con = new MySqlConnection(connectionString))
                {
                    con.Open();

                    MySqlCommand concommand = new MySqlCommand("PCM_GetAllActiveArticles", con);
                    concommand.CommandType = CommandType.StoredProcedure;
                    concommand.CommandTimeout = 8000;
                    using (MySqlDataReader reader = concommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.IsPCMArticle = true;
                            }

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdArticleCategory"] != DBNull.Value)
                            {
                                article.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                article.ArticleCategory = new ArticleCategories();
                                article.ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.ArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }

                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllActiveArticles(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articles;
        }

        /// <summary>
        /// This method is used to get articles by category.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdArticleCategory">Article category id.</param>
        /// <returns>The list of Articles by category.</returns>
        public List<Articles> GetArticlesByCategory(string connectionString, string ArticleVisualAidsPath, uint IdArticleCategory)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticlesByIdArticleCategory", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", IdArticleCategory);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            //if (reader["Length"] != DBNull.Value)
                            //    article.Length = Convert.ToDouble(reader["Length"]);

                            //if (reader["Width"] != DBNull.Value)
                            //    article.Width = Convert.ToDouble(reader["Width"]);

                            //if (reader["Height"] != DBNull.Value)
                            //    article.Height = Convert.ToDouble(reader["Height"]);

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdArticleCategory"] != DBNull.Value)
                            {
                                article.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                article.ArticleCategory = new ArticleCategories();
                                article.ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.ArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articles;
        }

        /// <summary>
        /// This method is used to get articles by category.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdArticleCategory">Article category id.</param>
        /// <returns>The list of Articles by category.</returns>
        public List<Articles> GetActiveArticlesByCategory(string connectionString, string ArticleVisualAidsPath, uint IdArticleCategory)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetActiveArticlesByIdArticleCategory", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", IdArticleCategory);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            //if (reader["Length"] != DBNull.Value)
                            //    article.Length = Convert.ToDouble(reader["Length"]);

                            //if (reader["Width"] != DBNull.Value)
                            //    article.Width = Convert.ToDouble(reader["Width"]);

                            //if (reader["Height"] != DBNull.Value)
                            //    article.Height = Convert.ToDouble(reader["Height"]);

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdArticleCategory"] != DBNull.Value)
                            {
                                article.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                article.ArticleCategory = new ArticleCategories();
                                article.ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.ArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetActiveArticlesByCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articles;
        }


        /// <summary>
        /// This method is used to get pcm article categories.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of PCM Article categories.</returns>
        public List<PCMArticleCategory> GetActivePCMArticleCategories(string connectionstring)
        {
            List<PCMArticleCategory> pcmArticleCategory = new List<PCMArticleCategory>();
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetActivePCMArticleCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory PCMArticleCategory = new PCMArticleCategory();
                            PCMArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                PCMArticleCategory.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                PCMArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                PCMArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                PCMArticleCategory.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["KeyName"] != DBNull.Value)
                                PCMArticleCategory.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                PCMArticleCategory.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                PCMArticleCategory.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count = Convert.ToInt32(reader["Articles_Count"]);

                            if (reader["Name"] != DBNull.Value && reader["Articles_Count"] != DBNull.Value)
                            {
                                PCMArticleCategory.NameWithArticleCount = Convert.ToString(PCMArticleCategory.Name + " [" + PCMArticleCategory.Article_count + "]");
                                if (PCMArticleCategory.Parent != null)
                                {
                                    pcmArticleCategory.Where(a => a.Parent == null && a.IdPCMArticleCategory == PCMArticleCategory.Parent).ToList().ForEach(a => { a.NameWithArticleCount = Convert.ToString(a.Name + " [" + Convert.ToInt32(PCMArticleCategory.Article_count + a.Article_count) + "]"); a.Article_count = Convert.ToInt32(PCMArticleCategory.Article_count + a.Article_count); });
                                }
                            }
                            else
                            {
                                PCMArticleCategory.NameWithArticleCount = Convert.ToString(PCMArticleCategory.Name + " [" + PCMArticleCategory.Article_count + "]");
                                if (PCMArticleCategory.Parent != null)
                                {
                                    //if(PCMArticleCategory.Article_count==0)
                                    //{
                                    //    PCMArticleCategory.Article_count = 1;
                                    //}
                                    PCMArticleCategory.NameWithArticleCount = Convert.ToString(PCMArticleCategory.Name + " [" + PCMArticleCategory.Article_count + "]");

                                    pcmArticleCategory.Where(a => a.Parent == null && a.IdPCMArticleCategory == PCMArticleCategory.Parent).ToList().ForEach(a => { a.NameWithArticleCount = Convert.ToString(a.Name + " [" + Convert.ToInt32(PCMArticleCategory.Article_count + a.Article_count) + "]"); a.Article_count = Convert.ToInt32(PCMArticleCategory.Article_count + a.Article_count); });
                                }
                            }

                            pcmArticleCategory.Add(PCMArticleCategory);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetActivePCMArticleCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticleCategory;
        }

        /// <summary>
        /// This method is used to get all PCM article.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of PCM Article.</returns>
        public List<Articles> GetAllPCMArticles(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        /// <summary>
        /// This method is used to get all PCM article.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of PCM Article.</returns>
        public List<Articles> GetAllActivePCMArticles(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllActivePCMArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }

                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllActivePCMArticles(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        /// <summary>
        /// This method is used to get PCM article by category.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of PCM Article by category.</returns>
        public List<Articles> GetPCMArticlesByCategory(string connectionString, string ArticleVisualAidsPath, uint IdPCMArticleCategory)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetPCMArticlesByIdPCMArticleCategory", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesByCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        /// <summary>
        /// This method is used to get PCM article by category.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of PCM Article by category.</returns>
        public List<Articles> GetActivePCMArticlesByCategory(string connectionString, string ArticleVisualAidsPath, uint IdPCMArticleCategory)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetActivePCMArticlesByIdPCMArticleCategory", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);


                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetActivePCMArticlesByCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        /// <summary>
        /// This method is used to get log entries by detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get detection id</param>
        /// <param name="IdDetectionType">Get detection type id</param>
        /// <returns>The list of log by detection.</returns>
        public List<DetectionLogEntry> GetDetectionLogEntriesByDetection(string PCMConnectionString, UInt32 IdDetection, UInt32 IdDetectionType)
        {
            List<DetectionLogEntry> detectionLogEntryList = new List<DetectionLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByIdDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionLogEntry detectionLogEntry = new DetectionLogEntry();

                            detectionLogEntry.IdLogEntryByDetection = Convert.ToUInt32(reader["IdLogEntryByDetection"]);

                            detectionLogEntry.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            detectionLogEntry.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                detectionLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                detectionLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                detectionLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                detectionLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            detectionLogEntryList.Add(detectionLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionLogEntriesByDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionLogEntryList;
        }

        /// <summary>
        /// This method is used to get sites by customer and region.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdRegion">get region id.</param>
        /// <param name="IdCustomer">get customer id.</param>
        /// <returns>The list of site by customer and region.</returns>
        public List<Site> GetSitesByCustomerAndRegion(string PCMConnectionString, UInt32 IdRegion, UInt32 IdCustomer)
        {
            List<Site> sites = new List<Site>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegion", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdRegion", IdRegion);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdCustomer);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site site = new Site();

                            site.IdSite = Convert.ToUInt32(reader["IdSite"]);

                            sites.Add(site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSitesByCustomerAndRegion(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return sites;
        }

        /// <summary>
        /// This method is used to get sites by customer and region by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdRegion">get region id.</param>
        /// <param name="IdCustomer">get customer id.</param>
        /// <param name="IdCPType">get cptype id.</param>
        /// <returns>The list of site by customer and region by cptype.</returns>
        public List<Site> GetSitesByCustomerAndRegionByCPType(string PCMConnectionString, UInt32 IdRegion, UInt32 IdCustomer, UInt64 IdCPType)
        {
            List<Site> sites = new List<Site>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegionByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdRegion", IdRegion);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdCustomer);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site site = new Site();

                            site.IdSite = Convert.ToUInt32(reader["IdSite"]);

                            sites.Add(site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSitesByCustomerAndRegion(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return sites;
        }

        /// <summary>
        /// This method is to get articles image in bytes
        /// </summary>
        /// <param name="ArticleVisualAidsPath">Get articles image path</param>
        /// <param name="article">Get articles details</param>
        /// <returns>Article image bytes</returns>
        public byte[] GetArticleImageInBytes(string ArticleVisualAidsPath, Articles article)
        {
            try
            {


                if (!Directory.Exists(ArticleVisualAidsPath))
                {
                    return null;
                }

                string fileUploadPath = ArticleVisualAidsPath + article.ImagePath;

                if (!File.Exists(fileUploadPath))
                {
                    return null;
                }

                if (article != null && !string.IsNullOrEmpty(article.ImagePath))
                {

                    byte[] bytes = null;

                    try
                    {
                        using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                        {
                            bytes = new byte[stream.Length];
                            int numBytesToRead = (int)stream.Length;
                            int numBytesRead = 0;

                            while (numBytesToRead > 0)
                            {
                                // Read may return anything from 0 to numBytesToRead.
                                int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                                // Break when the end of the file is reached.
                                if (n == 0)
                                    break;

                                numBytesRead += n;
                                numBytesToRead -= n;
                            }
                        }

                        return bytes;
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error GetArticleImageInBytes() article ImagePath-{0}. ErrorMessage- {1}", article.ImagePath, ex.Message), category: Category.Exception, priority: Priority.Low);
                        //throw;
                    }
                }
            }
            catch (Exception ex)
            {


            }

            return null;
        }

        /// <summary>
        /// This method is used to get pcm article category by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="idPCMArticleCategory">get pcm article category details.</param>
        /// <returns>The pcm article category by id.</returns>
        public PCMArticleCategory GetPCMArticleCategoryById(string PCMConnectionString, uint idPCMArticleCategory)
        {
            PCMArticleCategory pcmArticleCategory = new PCMArticleCategory();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetPCMArticleCategoryByIdPCMArticleCategory", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", idPCMArticleCategory);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            pcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                pcmArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);
                            }
                            if (reader["IsLeaf"] != DBNull.Value)
                            {
                                pcmArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                pcmArticleCategory.Position = Convert.ToUInt32(reader["Position"]);
                            }
                            if (reader["IdArticleCategory"] != DBNull.Value)
                            {
                                pcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                pcmArticleCategory.ArticleCategory = new ArticleCategories();
                                pcmArticleCategory.ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                                if (reader["ArticleCategoryParent"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.Parent = Convert.ToUInt64(reader["ArticleCategoryParent"]);
                                }
                                if (reader["ArticleCategoryIsLeaf"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.IsLeaf = Convert.ToInt64(reader["ArticleCategoryIsLeaf"]);
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategoryById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticleCategory;
        }

        /// <summary>
        /// This method is used to get article by id.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>Get Article by id.</returns>
        public Articles GetArticleByIdArticle(string PCMConnectionString, string ArticleVisualAidsPath, UInt32 IdArticle, string ImagePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);
                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        /// <summary>
        /// This method is used to get all Templates.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Templates.</returns>
        public List<ProductTypesTemplate> GetTemplateList(string PCMConnectionString)
        {
            List<ProductTypesTemplate> Templates = new List<ProductTypesTemplate>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllTemplates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ProductTypesTemplate Template = new ProductTypesTemplate();
                            Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Template.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Template.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Templates.Add(Template);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetTemplateList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Templates;
        }

        /// <summary>
        /// This method is used to Get Product Types With Template.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Product Types With Template.</returns>
        public List<ProductTypesTemplate> GetProductTypesWithTemplate(string PCMConnectionString)
        {
            List<ProductTypesTemplate> templateList = new List<ProductTypesTemplate>();
            try
            {
                templateList = GetTemplateList(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetProductTypesWithTemplate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypesTemplate template = new ProductTypesTemplate();
                            template.Key = Convert.ToString(i);

                            template.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                            }

                            if (reader["ProductType"] != DBNull.Value)
                            {
                                template.Name = Convert.ToString(reader["ProductType"]);
                                template.ProductType = new ProductTypes();
                                template.ProductType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);
                                template.ProductType.Name = Convert.ToString(reader["ProductType"]);
                                template.ProductType.Reference = Convert.ToString(reader["Reference"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                template.Parent = Convert.ToString(reader["Parent"]);
                            }
                            templateList.Add(template);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypesWithTemplate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return templateList;
        }


        /// <summary>
        /// This method is used to get Compatibilities By Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get detection id</param>
        /// <returns>The list of Compatibilities By Product Type.</returns>
        public List<ProductTypeCompatibility> GetCompatibilitiesByProductType(string PCMConnectionString, byte IdCPType)
        {
            List<ProductTypeCompatibility> productTypeCompatibilityList = new List<ProductTypeCompatibility>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCPTypeCompatibilitiesByIdCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeCompatibility productTypeCompatibility = new ProductTypeCompatibility();

                            productTypeCompatibility.IdCPType = IdCPType;
                            productTypeCompatibility.IdCompatibility = Convert.ToUInt32(reader["IdCompatibility"]);

                            if (reader["IdCPtypeCompatibility"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdCPtypeCompatibility = Convert.ToByte(reader["IdCPtypeCompatibility"]);
                                if (reader["CPTypeName"] != DBNull.Value)
                                {
                                    productTypeCompatibility.Name = Convert.ToString(reader["CPTypeName"]);
                                    productTypeCompatibility.ProductType = new ProductTypes();
                                    if (reader["CPTypeReference"] != DBNull.Value)
                                    {
                                        productTypeCompatibility.Code = Convert.ToString(reader["CPTypeReference"]);
                                        productTypeCompatibility.ProductType.Reference = Convert.ToString(reader["CPTypeReference"]);
                                    }
                                    productTypeCompatibility.ProductType.IdCPType = Convert.ToUInt64(reader["IdCPtypeCompatibility"]);
                                    productTypeCompatibility.ProductType.Name = Convert.ToString(reader["CPTypeName"]);
                                }
                            }
                            if (reader["IdArticleCompatibility"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdArticleCompatibility = Convert.ToUInt32(reader["IdArticleCompatibility"]);
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    productTypeCompatibility.Name = Convert.ToString(reader["ArticleDesc"]);
                                    productTypeCompatibility.Article = new Articles();
                                    if (reader["ArticleReference"] != DBNull.Value)
                                    {
                                        productTypeCompatibility.Code = Convert.ToString(reader["ArticleReference"]);
                                        productTypeCompatibility.Article.Reference = Convert.ToString(reader["ArticleReference"]);
                                    }
                                    productTypeCompatibility.Article.IdArticle = Convert.ToUInt32(reader["IdArticleCompatibility"]);
                                    productTypeCompatibility.Article.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                            }
                            if (reader["IdTypeCompatibility"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdTypeCompatibility = Convert.ToUInt32(reader["IdTypeCompatibility"]);
                            }
                            if (reader["MinimumElements"] != DBNull.Value)
                            {
                                productTypeCompatibility.MinimumElements = Convert.ToInt32(reader["MinimumElements"]);
                            }
                            if (reader["MaximumElements"] != DBNull.Value)
                            {
                                productTypeCompatibility.MaximumElements = Convert.ToInt32(reader["MaximumElements"]);
                            }
                            if (reader["Quantity"] != DBNull.Value)
                            {
                                productTypeCompatibility.Quantity = Convert.ToInt32(reader["Quantity"]);
                            }
                            if (reader["Remarks"] != DBNull.Value)
                            {
                                productTypeCompatibility.Remarks = Convert.ToString(reader["Remarks"]);
                            }
                            if (reader["IdRelationshipType"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdRelationshipType = Convert.ToInt32(reader["IdRelationshipType"]);
                                if (reader["RelationshipType"] != DBNull.Value)
                                {
                                    productTypeCompatibility.RelationshipType = new LookupValue();
                                    productTypeCompatibility.RelationshipType.IdLookupValue = Convert.ToInt32(reader["IdRelationshipType"]);
                                    productTypeCompatibility.RelationshipType.Value = Convert.ToString(reader["RelationshipType"]);
                                }
                            }
                            productTypeCompatibilityList.Add(productTypeCompatibility);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompatibilitiesByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypeCompatibilityList;
        }

        /// <summary>
        /// This method is used to get Compatibilities By Article.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdArticle">Get article id</param>
        /// <returns>The list of Compatibilities By Article.</returns>
        public List<ArticleCompatibility> GetCompatibilitiesByArticle(string PCMConnectionString, UInt32 IdArticle)
        {
            List<ArticleCompatibility> articleCompatibilityList = new List<ArticleCompatibility>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleCompatibilitiesByIdArticle", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCompatibility articleCompatibility = new ArticleCompatibility();

                            articleCompatibility.IdArticle = IdArticle;
                            articleCompatibility.IdCompatibility = Convert.ToUInt32(reader["IdCompatibility"]);

                            if (reader["IdArticleCompatibility"] != DBNull.Value)
                            {
                                articleCompatibility.IdArticleCompatibility = Convert.ToUInt32(reader["IdArticleCompatibility"]);
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    articleCompatibility.Name = Convert.ToString(reader["ArticleDesc"]);
                                    articleCompatibility.Article = new Articles();
                                    if (reader["ArticleReference"] != DBNull.Value)
                                    {
                                        articleCompatibility.Code = Convert.ToString(reader["ArticleReference"]);
                                        articleCompatibility.Article.Reference = Convert.ToString(reader["ArticleReference"]);
                                    }
                                    articleCompatibility.Article.IdArticle = Convert.ToUInt32(reader["IdArticleCompatibility"]);
                                    articleCompatibility.Article.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                            }

                            if (reader["IdCPtypeCompatibility"] != DBNull.Value)
                            {
                                articleCompatibility.IdCPtypeCompatibility = Convert.ToByte(reader["IdCPtypeCompatibility"]);
                                if (reader["CPTypeName"] != DBNull.Value)
                                {
                                    articleCompatibility.Name = Convert.ToString(reader["CPTypeName"]);
                                    articleCompatibility.ProductType = new ProductTypes();
                                    if (reader["CPTypeReference"] != DBNull.Value)
                                    {
                                        articleCompatibility.Code = Convert.ToString(reader["CPTypeReference"]);
                                        articleCompatibility.ProductType.Reference = Convert.ToString(reader["CPTypeReference"]);
                                    }
                                    articleCompatibility.ProductType.IdCPType = Convert.ToUInt64(reader["IdCPtypeCompatibility"]);
                                    articleCompatibility.ProductType.Name = Convert.ToString(reader["CPTypeName"]);
                                }
                            }

                            if (reader["IdTypeCompatibility"] != DBNull.Value)
                            {
                                articleCompatibility.IdTypeCompatibility = Convert.ToUInt32(reader["IdTypeCompatibility"]);
                            }
                            if (reader["MinimumElements"] != DBNull.Value)
                            {
                                articleCompatibility.MinimumElements = Convert.ToInt32(reader["MinimumElements"]);
                            }
                            if (reader["MaximumElements"] != DBNull.Value)
                            {
                                articleCompatibility.MaximumElements = Convert.ToInt32(reader["MaximumElements"]);
                            }
                            if (reader["Quantity"] != DBNull.Value)
                            {
                                articleCompatibility.Quantity = Convert.ToInt32(reader["Quantity"]);
                            }
                            if (reader["Remarks"] != DBNull.Value)
                            {
                                articleCompatibility.Remarks = Convert.ToString(reader["Remarks"]);
                            }
                            if (reader["IdRelationshipType"] != DBNull.Value)
                            {
                                articleCompatibility.IdRelationshipType = Convert.ToInt32(reader["IdRelationshipType"]);
                                if (reader["RelationshipType"] != DBNull.Value)
                                {
                                    articleCompatibility.RelationshipType = new LookupValue();
                                    articleCompatibility.RelationshipType.IdLookupValue = Convert.ToInt32(reader["IdRelationshipType"]);
                                    articleCompatibility.RelationshipType.Value = Convert.ToString(reader["RelationshipType"]);
                                }
                            }
                            articleCompatibilityList.Add(articleCompatibility);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompatibilitiesByArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCompatibilityList;
        }


        /// <summary>
        /// This method is used to get all pcm article categories.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of pcm article categories.</returns>
        public List<PCMArticlesWithCategory> GetPCMArticleCategoryListForCompatibility(string PCMConnectionString)
        {
            List<PCMArticlesWithCategory> pcmArticlesWithCategoryList = new List<PCMArticlesWithCategory>();
            try
            {
                int i = 1;
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Compatibility_GetAllPCMArticleCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            PCMArticlesWithCategory pcmArticlesWithCategory = new PCMArticlesWithCategory();
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.KeyName = Convert.ToString(reader["KeyName"]);
                            }
                            else
                            {
                                pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Parent = Convert.ToUInt32(reader["Parent"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }

                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);
                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategoryListForCompatibility(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        /// <summary>
        /// This method is used to Get PCM Articles With Category.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of PCM Articles With Category.</returns>
        public List<PCMArticleCategory> GetPCMArticlesWithCategory(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Compatibility_GetAllPCMArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        /// <summary>
        /// This method is used to Get All Detections Ways Options Spare Parts.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The Get List of Detections Ways Options Spare Parts.</returns>
        public List<DetectionDetails> GetAllDetectionsWaysOptionsSpareParts(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllDetections", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionsWaysOptionsSpareParts().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }


        public List<PCMArticleLogEntry> GetLogEntriesByIdPCMArticle(string PCMConnectionString, UInt32 IdArticle)
        {
            List<PCMArticleLogEntry> pCMArticleLogEntries = new List<PCMArticleLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByIdPCMArticle", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleLogEntry pCMArticleLogEntry = new PCMArticleLogEntry();

                            pCMArticleLogEntry.IdLogEntryByPCMArticle = Convert.ToUInt32(reader["IdLogEntryByPCMArticle"]);

                            pCMArticleLogEntry.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                pCMArticleLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                pCMArticleLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                pCMArticleLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                pCMArticleLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            pCMArticleLogEntries.Add(pCMArticleLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLogEntriesByIdPCMArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pCMArticleLogEntries;
        }

        public List<PCMArticleImage> GetPCMArticleImagesByIdPCMArticle(string PCMConnectionString, UInt32 IdArticle, string ImagePath, string ArticleReference)
        {
            List<PCMArticleImage> pCMArticleImages = new List<PCMArticleImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleImagesByIdPCMArticle", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleImage image = new PCMArticleImage();

                            image.IdPCMArticleImage = Convert.ToUInt32(reader["IdPCMArticleImage"]);
                            image.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                image.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                image.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                image.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                image.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                image.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            image.PCMArticleImageInBytes = GetPCMArticleImage(Convert.ToString(image.IdPCMArticleImage), ImagePath, image.SavedFileName, ArticleReference);
                            pCMArticleImages.Add(image);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleImagesByIdPCMArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pCMArticleImages;
        }

        public byte[] GetPCMArticleImage(string IdPCMArticleImage, string ImagePath, string SavedFileName, string ArticleReference)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Format(@"{0}\{1}\{2}", ImagePath, ArticleReference, IdPCMArticleImage + "_" + SavedFileName);

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleImage(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<ArticleDocument> GetArticleAttachmentByIdArticle(string connectionString, UInt32 idArticle)
        {
            List<ArticleDocument> articleDocumentLst = new List<ArticleDocument>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("articledocs_GetArticleAttachmentDetailsByIdArticle", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticleDocument articleDocument = new ArticleDocument();
                        try
                        {
                            if (reader["IdArticleDoc"] != DBNull.Value)
                            {
                                articleDocument.IdArticleDoc = Convert.ToInt64(reader["IdArticleDoc"]);
                            }

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleDocument.IdArticle = Convert.ToInt32(reader["IdArticle"]);
                            }

                            articleDocument.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            articleDocument.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            articleDocument.Description = Convert.ToString(reader["Description"]);

                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                articleDocument.CreatedIn = Convert.ToDateTime(reader["CreatedIn"]);
                            }

                            if (reader["ModifiedIn"] != DBNull.Value)
                            {
                                articleDocument.ModifiedIn = Convert.ToDateTime(reader["ModifiedIn"]);
                            }

                            if (reader["ModifiedBy"] != DBNull.Value)
                            {
                                articleDocument.ModifiedBy = Convert.ToInt32(reader["ModifiedBy"]);

                                articleDocument.DocumentModifiedBy = new People();
                                articleDocument.DocumentModifiedBy.IdPerson = Convert.ToInt32(reader["ModifiedBy"]);
                                articleDocument.DocumentModifiedBy.Name = Convert.ToString(reader["ModifiedByName"]);
                                articleDocument.DocumentModifiedBy.Surname = Convert.ToString(reader["ModifiedBySurname"]);

                                if (reader["ModifiedByIdSite"] != DBNull.Value)
                                {
                                    articleDocument.DocumentModifiedBy.Company = new Company();
                                    articleDocument.DocumentModifiedBy.Company.IdCompany = Convert.ToInt32(reader["ModifiedByIdSite"]);
                                    articleDocument.DocumentModifiedBy.Company.Name = Convert.ToString(reader["ModifiedBySiteName"]);
                                }
                            }

                            if (reader["CreatedBy"] != DBNull.Value)
                            {
                                articleDocument.CreatedBy = Convert.ToInt32(reader["CreatedBy"]);

                                articleDocument.DocumentCreatedBy = new People();
                                articleDocument.DocumentCreatedBy.IdPerson = Convert.ToInt32(reader["CreatedBy"]);
                                articleDocument.DocumentCreatedBy.Name = Convert.ToString(reader["CreatedByName"]);
                                articleDocument.DocumentCreatedBy.Surname = Convert.ToString(reader["CreatedBySurname"]);

                                if (reader["CreatedByIdSite"] != DBNull.Value)
                                {
                                    articleDocument.DocumentCreatedBy.Company = new Company();
                                    articleDocument.DocumentCreatedBy.Company.IdCompany = Convert.ToInt32(reader["CreatedByIdSite"]);
                                    articleDocument.DocumentCreatedBy.Company.Name = Convert.ToString(reader["CreatedBySiteName"]);
                                }

                            }

                            if (reader["idDocType"] != DBNull.Value)
                            {
                                articleDocument.IdDocType = Convert.ToInt64(reader["idDocType"]);
                                articleDocument.ArticleDocumentType = new ArticleDocumentType();
                                articleDocument.ArticleDocumentType.IdDocType = Convert.ToInt64(reader["idDocType"]);
                                articleDocument.ArticleDocumentType.DocumentType = Convert.ToString(reader["DocumentType"]);
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleAttachmentByIdArticle(). IdArticleDoc- {0} IdArticle-{1}  ErrorMessage- {2}", articleDocument.IdArticleDoc, articleDocument.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                        articleDocumentLst.Add(articleDocument);
                    }

                }
            }

            return articleDocumentLst;
        }

        public bool IsUpdatedPCMArticleCategoryOrder(string MainServerConnectionString, List<PCMArticleCategory> pcmArticleCategoryList, uint? IdModifier)
        {
            bool isupdate = false;
            try
            {
                if (pcmArticleCategoryList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (PCMArticleCategory pcmArticleCategory in pcmArticleCategoryList)
                        {
                            if (pcmArticleCategory.IdPCMArticleCategory > 0)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticleCategoryPosition_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", pcmArticleCategory.IdPCMArticleCategory);
                                mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                                if (pcmArticleCategory.Parent == 0 || pcmArticleCategory.Parent == null)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_Parent", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_Parent", pcmArticleCategory.Parent);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdModifier", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                        isupdate = true;
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdatePCMArticleCategoryPosition(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isupdate;
        }


        /// <summary>
        /// This method is used to Get PCM Articles With Category.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of PCM Articles With Category.</returns>
        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReference(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Compatibility_GetAllPCMArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        public List<ArticleCategories> GetActiveArticleCategories(string connectionstring)
        {

            List<ArticleCategories> articleCategories = new List<ArticleCategories>();
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetActiveArticleCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCategories ArticleCategories = new ArticleCategories();
                            ArticleCategories.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                ArticleCategories.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                ArticleCategories.Parent = Convert.ToUInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                ArticleCategories.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                ArticleCategories.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["TaricCode"] != DBNull.Value)
                                ArticleCategories.TaricCode = Convert.ToString(reader["TaricCode"]);

                            if (reader["NCM_Code"] != DBNull.Value)
                                ArticleCategories.NCM_Code = Convert.ToString(reader["NCM_Code"]);

                            if (reader["HS_Code"] != DBNull.Value)
                                ArticleCategories.HS_Code = Convert.ToString(reader["HS_Code"]);

                            if (reader["KeyName"] != DBNull.Value)
                                ArticleCategories.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                ArticleCategories.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                ArticleCategories.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                            {
                                ArticleCategories.Article_count = Convert.ToInt32(reader["Articles_Count"]);
                            }
                            if (reader["Articles_Count"] != DBNull.Value)
                            {
                                ArticleCategories.Article_count_original = Convert.ToInt32(reader["Articles_Count"]);
                            }
                            articleCategories.Add(ArticleCategories);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetActiveArticleCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articleCategories;
        }







        public List<PCMArticleCategory> GetPCMArticleCategories(string connectionstring)
        {
            List<PCMArticleCategory> pcmArticleCategory = new List<PCMArticleCategory>();
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticleCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory PCMArticleCategory = new PCMArticleCategory();
                            PCMArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                PCMArticleCategory.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                PCMArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                PCMArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                PCMArticleCategory.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["KeyName"] != DBNull.Value)
                                PCMArticleCategory.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                PCMArticleCategory.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                PCMArticleCategory.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count = Convert.ToInt32(reader["Articles_Count"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count_original = Convert.ToInt32(reader["Articles_Count"]);

                            pcmArticleCategory.Add(PCMArticleCategory);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return pcmArticleCategory;
        }

        public bool IsDeletePCMArticleCategory(string MainServerConnectionString, List<PCMArticleCategory> PCMArticleCategoryList)
        {
            bool isDeleted = false;
            try
            {
                if (PCMArticleCategoryList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PCMArticleCategory pCMArticleCategory in PCMArticleCategoryList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticleCategory_Delete", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", pCMArticleCategory.IdPCMArticleCategory);
                            mySqlCommand.ExecuteNonQuery();

                            isDeleted = true;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePCMArticleCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDeleted;
        }

        #region pcm Article table change
        public bool IsUpdatePCMArticleCategoryInArticleWithStatus_V2060(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticleCategoryWithStatus_Update_V2060", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.ExecuteNonQuery();
                            mySqlConnection.Close();
                            isUpdated = true;
                        }
                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategoryInArticleWithStatus_V2060(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }

        public List<PCMArticleCategory> GetPCMArticleCategories_V2060(string connectionstring)
        {
            List<PCMArticleCategory> pcmArticleCategory = new List<PCMArticleCategory>();
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticleCategories_V2060", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory PCMArticleCategory = new PCMArticleCategory();
                            PCMArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                PCMArticleCategory.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                PCMArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                PCMArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                PCMArticleCategory.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["KeyName"] != DBNull.Value)
                                PCMArticleCategory.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                PCMArticleCategory.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                PCMArticleCategory.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count = Convert.ToInt32(reader["Articles_Count"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count_original = Convert.ToInt32(reader["Articles_Count"]);

                            pcmArticleCategory.Add(PCMArticleCategory);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategories_V2060(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return pcmArticleCategory;
        }


        public List<Articles> GetAllPCMArticles_V2060(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2060", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);
                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);
                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);
                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);
                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);
                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);
                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);
                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);
                            article.Visibility = "Hidden";
                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }
                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];
                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];
                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];
                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);
                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }
                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);
                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);
                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);
                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }
                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);
                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);
                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }


        public Articles GetArticleByIdArticle_V2060(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2060", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);
                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);
                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]);
                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]);
                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]);
                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]);
                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]);
                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]);
                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }
                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];
                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];
                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];
                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);
                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }
                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);
                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);
                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);
                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }
                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);
                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);
                        }
                    }
                }
                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return article;
        }



        public List<PCMArticleCategory> GetPCMArticlesWithCategory_V2060(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories_V2060(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Compatibility_GetAllPCMArticles_V2060", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReference_V2060(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories_V2060(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Compatibility_GetAllPCMArticles_V2060", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryForReference_V2060(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        public bool AddDeletePCMArticle(string MainServerConnectionString, uint IdPCMArticleCategory, List<Articles> ArticleList, int IdUser)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (ArticleList != null)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            foreach (Articles Article in ArticleList)
                            {
                                if (Article.IdArticle > 0)
                                {
                                    if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticles_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                    else if (Article.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticles_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", IdUser);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDeletePCMArticle().  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public byte[] GetPCMArticleCategoryImageInBytes(PCMArticleCategory PCMArticleCategory, string PCMArticleCategoryFolderPath)
        {
            try
            {
                if (!Directory.Exists(PCMArticleCategoryFolderPath))
                {
                    return null;
                }

                string fileUploadPath = string.Format(@"{0}\{1}\{2}", PCMArticleCategoryFolderPath, PCMArticleCategory.IdPCMArticleCategory, PCMArticleCategory.ImagePath);
                if (!File.Exists(fileUploadPath))
                {
                    return null;
                }

                if (!string.IsNullOrEmpty(PCMArticleCategory.ImagePath))
                {

                    byte[] bytes = null;

                    try
                    {
                        using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                        {
                            bytes = new byte[stream.Length];
                            int numBytesToRead = (int)stream.Length;
                            int numBytesRead = 0;

                            while (numBytesToRead > 0)
                            {
                                // Read may return anything from 0 to numBytesToRead.
                                int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                                // Break when the end of the file is reached.
                                if (n == 0)
                                    break;

                                numBytesRead += n;
                                numBytesToRead -= n;
                            }
                        }

                        return bytes;
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategoryImageInBytes() pcm article category ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        //throw;
                    }
                }
            }
            catch (Exception ex)
            {

            }

            return null;
        }


        public bool IsDeletePCMArticleCategoryImageFromPath(PCMArticleCategory PCMArticleCategory, string ImageFolderPath)
        {
            try
            {
                if (ImageFolderPath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", ImageFolderPath, PCMArticleCategory.IdPCMArticleCategory);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        Directory.Delete(completePath, true);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePCMArticleCategoryImageFromPath()-  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }


        public bool IsDeletePCMArticleCategory(string MainServerConnectionString, List<PCMArticleCategory> PCMArticleCategoryList, string ImagePath)
        {
            bool isDeleted = false;
            try
            {
                if (PCMArticleCategoryList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PCMArticleCategory pCMArticleCategory in PCMArticleCategoryList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticleCategory_Delete", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", pCMArticleCategory.IdPCMArticleCategory);
                            mySqlCommand.ExecuteNonQuery();

                            IsDeletePCMArticleCategoryImageFromPath(pCMArticleCategory, ImagePath);
                            isDeleted = true;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePCMArticleCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDeleted;
        }


        public bool IsUpdatePCMArticleCategory(string MainServerConnectionString, PCMArticleCategory pcmArticleCategory, List<PCMArticleCategory> pcmArticleCategoryList, string ImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Category_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", pcmArticleCategory.IdPCMArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Name", pcmArticleCategory.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", pcmArticleCategory.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", pcmArticleCategory.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", pcmArticleCategory.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", pcmArticleCategory.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", pcmArticleCategory.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", pcmArticleCategory.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", pcmArticleCategory.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", pcmArticleCategory.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", pcmArticleCategory.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", pcmArticleCategory.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", pcmArticleCategory.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", pcmArticleCategory.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", pcmArticleCategory.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                        mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", pcmArticleCategory.IdArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Parent", pcmArticleCategory.Parent);
                        mySqlCommand.Parameters.AddWithValue("_IsLeaf", pcmArticleCategory.IsLeaf);
                        mySqlCommand.Parameters.AddWithValue("_IdModifier", pcmArticleCategory.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_ImagePath", pcmArticleCategory.ImagePath);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    //update position of pcm article categories
                    UpdatePCMArticleCategoryPosition(MainServerConnectionString, pcmArticleCategoryList, pcmArticleCategory.IdModifier);
                    AddPCMArticleCategoryImageToPath(pcmArticleCategory, ImagePath);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public bool AddPCMArticleCategoryImageToPath(PCMArticleCategory PCMArticleCategory, string ImageFolderPath)
        {
            if (PCMArticleCategory.PCMArticleCategoryImageInByte != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", ImageFolderPath, PCMArticleCategory.IdPCMArticleCategory);
                    string filePath = completePath + "\\" + PCMArticleCategory.ImagePath;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    else
                    {
                        DirectoryInfo di = new DirectoryInfo(completePath);
                        foreach (FileInfo file in di.GetFiles())
                        {
                            file.Delete();
                        }
                    }
                    File.WriteAllBytes(filePath, PCMArticleCategory.PCMArticleCategoryImageInByte);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPCMArticleCategoryImageToPath()- ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        public PCMArticleCategory AddPCMArticleCategory(string MainServerConnectionString, PCMArticleCategory pcmArticleCategory, List<PCMArticleCategory> pcmArticleCategoryList, string ImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Category_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", pcmArticleCategory.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", pcmArticleCategory.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", pcmArticleCategory.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", pcmArticleCategory.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", pcmArticleCategory.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", pcmArticleCategory.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", pcmArticleCategory.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", pcmArticleCategory.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", pcmArticleCategory.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", pcmArticleCategory.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", pcmArticleCategory.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", pcmArticleCategory.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", pcmArticleCategory.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", pcmArticleCategory.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                        mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", pcmArticleCategory.IdArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Parent", pcmArticleCategory.Parent);
                        mySqlCommand.Parameters.AddWithValue("_IsLeaf", pcmArticleCategory.IsLeaf);
                        mySqlCommand.Parameters.AddWithValue("_IdCreator", pcmArticleCategory.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_ImagePath", pcmArticleCategory.ImagePath);

                        pcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    //update position of pcm article categories
                    UpdatePCMArticleCategoryPosition(MainServerConnectionString, pcmArticleCategoryList, pcmArticleCategory.IdCreator);
                    AddPCMArticleCategoryImageToPath(pcmArticleCategory, ImagePath);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPCMArticleCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return pcmArticleCategory;
        }


        public PCMArticleCategory GetPCMArticleCategoryById(string PCMConnectionString, uint idPCMArticleCategory, string ImagePath)
        {
            PCMArticleCategory pcmArticleCategory = new PCMArticleCategory();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetPCMArticleCategoryByIdPCMArticleCategory", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", idPCMArticleCategory);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            pcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                pcmArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);
                            }
                            if (reader["IsLeaf"] != DBNull.Value)
                            {
                                pcmArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                pcmArticleCategory.Position = Convert.ToUInt32(reader["Position"]);
                            }
                            if (reader["IdArticleCategory"] != DBNull.Value)
                            {
                                pcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                pcmArticleCategory.ArticleCategory = new ArticleCategories();
                                pcmArticleCategory.ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                                if (reader["ArticleCategoryParent"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.Parent = Convert.ToUInt64(reader["ArticleCategoryParent"]);
                                }
                                if (reader["ArticleCategoryIsLeaf"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.IsLeaf = Convert.ToInt64(reader["ArticleCategoryIsLeaf"]);
                                }
                            }
                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                pcmArticleCategory.ImagePath = Convert.ToString(reader["ImagePath"]);
                                pcmArticleCategory.PCMArticleCategoryImageInByte = GetPCMArticleCategoryImageInBytes(pcmArticleCategory, ImagePath);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategoryById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticleCategory;
        }

        public bool IsUpdatePCMArticleCategoryInArticleWithStatus_V2070(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticleCategoryWithStatus_Update_V2070", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);

                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategoryInArticleWithStatus_V2060(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public List<Articles> GetAllPCMArticles_V2070(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2060(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2070", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (CategoryList != null)
                            {
                                article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                            }

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }


        public Articles GetArticleByIdArticle_V2070(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2070", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();
                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        public bool IsUpdatePCMArticleCategoryInArticleWithStatus_V2090(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticleCategoryWithStatus_Update_V2090", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                            mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);

                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategoryInArticleWithStatus_V2090(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddUpdateDeletePCMArticleImages_V2090(string MainServerConnectionString, UInt32 IdArticle, List<PCMArticleImage> ImageList, string ImagePath, string ArticleReference)
        {
            try
            {
                if (ImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PCMArticleImage Image in ImageList)
                        {
                            if (Image.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Images_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdPCMArticleImage", Image.IdPCMArticleImage);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeletePCMArticleImageFromPath(Image, ImagePath, ArticleReference);
                            }
                            else if (Image.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (Image.IdPCMArticleImage > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Images_Update_V2090", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdPCMArticleImage", Image.IdPCMArticleImage);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", Image.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", Image.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", Image.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", Image.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_Position", Image.Position);
                                    mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Image.IsImageShareWithCustomer);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddPCMArticleImageToPath(Image, ImagePath, ArticleReference);
                                }
                            }
                            else if (Image.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Images_Insert_V2090", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", Image.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", Image.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", Image.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", Image.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Position", Image.Position);
                                mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Image.IsImageShareWithCustomer);

                                Image.IdPCMArticleImage = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (Image.IdPCMArticleImage > 0)
                                {
                                    AddPCMArticleImageToPath(Image, ImagePath, ArticleReference);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePCMArticleImages_V2090(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public Articles GetArticleByIdArticle_V2090(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2090", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);
                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        public List<PCMArticleImage> GetPCMArticleImagesByIdPCMArticle_V2090(string PCMConnectionString, UInt32 IdArticle, string ImagePath, string ArticleReference)
        {
            List<PCMArticleImage> pCMArticleImages = new List<PCMArticleImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleImagesByIdPCMArticle_V2090", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleImage image = new PCMArticleImage();

                            image.IdPCMArticleImage = Convert.ToUInt32(reader["IdPCMArticleImage"]);
                            image.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                image.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                image.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                image.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                image.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                image.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                            {
                                image.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);
                            }
                            image.PCMArticleImageInBytes = GetPCMArticleImage(Convert.ToString(image.IdPCMArticleImage), ImagePath, image.SavedFileName, ArticleReference);
                            pCMArticleImages.Add(image);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleImagesByIdPCMArticle_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pCMArticleImages;
        }

        public string GetPCMArticleExistNames(string PCMConnectionString, UInt32 IdArticle)
        {
            string ExistNames = "";
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CheckPCMArticleExist_GetNames", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["existwindownames"] != DBNull.Value)
                            {
                                ExistNames = Convert.ToString(reader["existwindownames"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleExistNames(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ExistNames;
        }
        #endregion

        #endregion

        #region connection methods

        /// <summary>
        /// This method is used to get connection string name exists or not by name.
        /// </summary>
        public bool IsConnectionStringNameExist(string Name)
        {
            bool isExist = false;
            ConnectionStringSettingsCollection settings = ConfigurationManager.ConnectionStrings;
            if (settings != null)
            {
                foreach (ConnectionStringSettings cs in settings)
                {
                    if (cs.Name == Name)
                    {
                        isExist = true;
                        return isExist;
                    }
                }
            }
            return isExist;
        }

        #endregion

        #region V2100

        public Articles GetArticleByIdArticle_V2100(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2100", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2100(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        public List<ArticleDocument> GetArticleAttachmentByIdArticle_V2100(string connectionString, UInt32 idArticle)
        {
            List<ArticleDocument> articleDocumentLst = new List<ArticleDocument>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleAttachmentDetailsByIdArticle", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticleDocument articleDocument = new ArticleDocument();
                        try
                        {
                            if (reader["IdArticleDoc"] != DBNull.Value)
                            {
                                articleDocument.IdArticleDoc = Convert.ToInt64(reader["IdArticleDoc"]);
                            }

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleDocument.IdArticle = Convert.ToInt32(reader["IdArticle"]);
                            }

                            articleDocument.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            articleDocument.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            articleDocument.Description = Convert.ToString(reader["Description"]);

                            if (reader["idDocType"] != DBNull.Value)
                            {
                                articleDocument.IdDocType = Convert.ToInt64(reader["idDocType"]);
                                articleDocument.ArticleDocumentType = new ArticleDocumentType();
                                articleDocument.ArticleDocumentType.IdDocType = Convert.ToInt64(reader["idDocType"]);
                                articleDocument.ArticleDocumentType.DocumentType = Convert.ToString(reader["DocumentType"]);
                            }
                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                articleDocument.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                articleDocument.ModifiedIn = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleAttachmentByIdArticle_V2100(). IdArticleDoc- {0} IdArticle-{1}  ErrorMessage- {2}", articleDocument.IdArticleDoc, articleDocument.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                        articleDocumentLst.Add(articleDocument);
                    }

                }
            }

            return articleDocumentLst;
        }

        public bool IsUpdatePCMArticleCategoryInArticleWithStatus_V2100(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath, string PCMArticleDocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticleCategoryWithStatus_Update_V2100", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                            mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                        AddUpdateDeletePCMArticleDocs(MainServerConnectionString, Article.IdArticle, Article.PCMArticleAttachmentList, PCMArticleDocPath, Article.Reference);
                        AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);

                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategoryInArticleWithStatus_V2100(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddUpdateDeletePCMArticleDocs(string MainServerConnectionString, UInt32 IdArticle, List<ArticleDocument> DocList, string DocPath, string ArticleReference)
        {
            try
            {
                if (DocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ArticleDocument doc in DocList)
                        {
                            if (doc.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Docs_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticleDoc", doc.IdArticleDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeletePCMArticleDocFromPath(doc, DocPath, ArticleReference);
                            }
                            else if (doc.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (doc.IdArticleDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Docs_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdArticleDoc", doc.IdArticleDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", doc.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", doc.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", doc.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", doc.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_idDocType", doc.IdDocType);
                                    mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", doc.IsShareWithCustomer);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddPCMArticleDocToPath(doc, DocPath, ArticleReference);
                                }
                            }
                            else if (doc.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Docs_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", doc.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", doc.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", doc.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", doc.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_idDocType", doc.IdDocType);
                                mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", doc.IsShareWithCustomer);

                                doc.IdArticleDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (doc.IdArticleDoc > 0)
                                {
                                    AddPCMArticleDocToPath(doc, DocPath, ArticleReference);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePCMArticleDocs(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public bool IsDeletePCMArticleDocFromPath(ArticleDocument doc, string DocPath, string ArticleReference)
        {
            try
            {
                if (DocPath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", DocPath, ArticleReference);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        completePath = completePath + "\\" + doc.SavedFileName;

                        if (File.Exists(completePath))
                        {
                            File.Delete(completePath);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePCMArticleDocFromPath()- Filename - {0}. ErrorMessage- {1}", doc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        public bool AddPCMArticleDocToPath(ArticleDocument doc, string DocPath, string ArticleReference)
        {
            if (doc.PCMArticleFileInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", DocPath, ArticleReference);
                    string filePath = completePath + "\\" + doc.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    File.WriteAllBytes(filePath, doc.PCMArticleFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPCMArticleDocToPath()- Filename - {0}. ErrorMessage- {1}", doc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        public List<DocumentType> GetDocumentTypes(string PCMConnectionString)
        {
            List<DocumentType> DocumentTypes = new List<DocumentType>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDocumentTypes", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            DocumentType DocumentType = new DocumentType();
                            DocumentType.IdDocumentType = Convert.ToByte(reader["idDocType"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                            }
                            DocumentTypes.Add(DocumentType);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDocumentTypes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DocumentTypes;
        }

        public void AddWarehouseArticleLogEntry(string MainServerConnectionString, UInt32 IdArticle, List<LogEntriesByArticle> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByArticle logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByWarehouseArticleDocs_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_logDateTime", logList.LogDateTime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddWarehouseArticleLogEntry(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public List<Articles> GetAllPCMArticles_V2100(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2060(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2100", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (CategoryList != null)
                            {
                                article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                            }


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }


                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2100(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }



        public List<Articles> GetAllPCMArticles_V2110(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2060(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (CategoryList != null)
                            {
                                article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                            }


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription"] != DBNull.Value)
                            {
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]);
                                if (!string.IsNullOrEmpty(article.PCMDescription))
                                {
                                    article.IsRichText = "Yes";
                                }
                                else
                                {
                                    article.IsRichText = "";
                                }
                            }
                            if (reader["IsRtfText"] != DBNull.Value)
                            {
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);
                            }
                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        public bool IsUpdatePCMArticleCategoryInArticleWithStatus_V2110(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath, string PCMArticleDocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticleCategoryWithStatus_Update_V2110", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                            mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_ArticleName", Article.Description);

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                        AddUpdateDeletePCMArticleDocs(MainServerConnectionString, Article.IdArticle, Article.PCMArticleAttachmentList, PCMArticleDocPath, Article.Reference);
                        AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);

                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategoryInArticleWithStatus_V2110(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public List<DetectionDetails> GetAllDetectionsWaysOptionsSpareParts_V2110(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllDetections_V2110", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionsWaysOptionsSpareParts_V2110().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }


        public List<ProductTypes> GetAllProductTypes_V2110(string PCMConnectionString)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }

                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    cpType.Status.HtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }

                            cpType.WayList = GetWayListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.DetectionList = GetDetectionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.OptionList = GetOptionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.SparePartList = GetSparePartListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }


        public int CheckPCMArticleExist(string PCMConnectionString, UInt32 IdArticle)
        {
            int IdExist = 0;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CheckPCMArticleExist", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["Exist"] != DBNull.Value)
                            {
                                IdExist = Convert.ToInt16(reader["Exist"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error CheckPCMArticleExist(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return IdExist;
        }

        public Articles GetArticleByIdArticleForInformationData(string PCMConnectionString, uint IdArticle)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2100", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticleForInformationData(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        #endregion

        #region V2111
        public bool IsUpdatePCMArticle(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath, string PCMArticleDocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_PCMArticle_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                            mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_es", Article.PCMDescription_es);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_fr", Article.PCMDescription_fr);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ro", Article.PCMDescription_ro);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_zh", Article.PCMDescription_zh);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_pt", Article.PCMDescription_pt);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ru", Article.PCMDescription_ru);

                            mySqlCommand.ExecuteNonQuery();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                        AddUpdateDeletePCMArticleDocs(MainServerConnectionString, Article.IdArticle, Article.PCMArticleAttachmentList, PCMArticleDocPath, Article.Reference);
                        AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);
                        UpdateWarehouseArticle(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticle, Article.IdModifier);

                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticle(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void UpdateWarehouseArticle(string MainServerConnectionString, UInt32 IdArticle, Article WarehouseArticle, uint? IdModifier)
        {
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();


                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_WarehouseArticle_Update", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    mySqlCommand.Parameters.AddWithValue("_idArticle", WarehouseArticle.IdArticle);
                    mySqlCommand.Parameters.AddWithValue("_IdModifier", IdModifier);
                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                    mySqlCommand.Parameters.AddWithValue("_ArticleName", WarehouseArticle.Description);
                    mySqlCommand.Parameters.AddWithValue("_Description_es", WarehouseArticle.Description_es);
                    mySqlCommand.Parameters.AddWithValue("_Description_fr", WarehouseArticle.Description_fr);
                    mySqlCommand.Parameters.AddWithValue("_Description_ro", WarehouseArticle.Description_ro);
                    mySqlCommand.Parameters.AddWithValue("_Description_zh", WarehouseArticle.Description_zh);
                    mySqlCommand.Parameters.AddWithValue("_Description_pt", WarehouseArticle.Description_pt);
                    mySqlCommand.Parameters.AddWithValue("_Description_ru", WarehouseArticle.Description_ru);

                    mySqlCommand.ExecuteNonQuery();
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateWarehouseArticle(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public bool IsUpdatePCMArticleFromGrid(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_PCMArticleFromGrid_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_ArticleName", Article.Description);

                            mySqlCommand.ExecuteNonQuery();

                            isUpdated = true;
                        }

                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);

                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleFromGrid(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        #endregion

        public Articles GetArticleByIdArticle_V2120(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        public string GetPCMArticleExistNames_V2120(string PCMConnectionString, UInt32 IdArticle)
        {
            string ExistNames = "";
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CheckPCMArticleExist_GetNames_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["existwindownames"] != DBNull.Value)
                            {
                                ExistNames = Convert.ToString(reader["existwindownames"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleExistNames_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ExistNames;
        }


        public bool IsDeletePCMArticleImageFromPath_V2120(uint IdPCMArticleImage, string SavedFileName, string ImagePath, string ArticleReference)
        {
            try
            {
                if (ImagePath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", ImagePath, ArticleReference);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        completePath = completePath + "\\" + IdPCMArticleImage + "_" + SavedFileName;

                        if (File.Exists(completePath))
                        {
                            File.Delete(completePath);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePCMArticleImageFromPath_V2120()- Filename - {0}. ErrorMessage- {1}", SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }


        public void GetPCMImagesAndDeleteByIdArticle(string PCMConnectionString, string IdArticles, string PCMArticleImagePath)
        {
            try
            {
                if (!string.IsNullOrEmpty(IdArticles))
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleImagesByIdPCMArticles_ForDelete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdArticles", IdArticles);
                        using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                        {
                            while (reader.Read())
                            {
                                IsDeletePCMArticleImageFromPath_V2120(Convert.ToUInt32(reader["IdPCMArticleImage"]), Convert.ToString(reader["SavedFileName"]), PCMArticleImagePath, Convert.ToString(reader["Reference"]));
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMImagesAndDeleteByIdArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public bool AddDeletePCMArticle_V2120(string MainServerConnectionString, uint IdPCMArticleCategory, List<Articles> ArticleList, int IdUser, string PCMArticleImagePath)
        {
            bool isUpdated = false;
            string IdDeletedArticles = string.Join(",", ArticleList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).Select(a => a.IdArticle));
            GetPCMImagesAndDeleteByIdArticle(MainServerConnectionString, IdDeletedArticles, PCMArticleImagePath);

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (ArticleList != null)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            foreach (Articles Article in ArticleList)
                            {
                                if (Article.IdArticle > 0)
                                {
                                    if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticles_Delete_V2120", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                    else if (Article.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticles_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", IdUser);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDeletePCMArticle_V2140().  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        /// <summary>
        /// This method is used to update ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateDetection_V2140(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection_V2140(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        /// <summary>
        /// This method is used to insert ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public DetectionDetails AddDetection_V2140(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }

        /// <summary>
        /// This method is used to get Detection by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="DetectionAttachedDocPath">Get attached doc path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <returns>The data of detection by id.</returns>
        public DetectionDetails GetDetectionByIdDetection_V2140(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2140", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }

                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2140(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }

        /// <summary>
        /// This method is used to get All Detection Groups with detections.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions.</returns>
        public List<SpareParts> GetAllSparepartsWithGroups(string PCMConnectionString)
        {
            List<SpareParts> sparepartsGroups = new List<SpareParts>();
            try
            {
                sparepartsGroups = GetSparepartsGroups(PCMConnectionString, 4);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts sparepartsGroup = new SpareParts();

                            sparepartsGroup.Key = Convert.ToString(reader["IdDetection"]);

                            sparepartsGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                sparepartsGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                sparepartsGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                sparepartsGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                sparepartsGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            sparepartsGroups.Add(sparepartsGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllSparepartsWithGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return sparepartsGroups;
        }

        /// <summary>
        /// This method is used to get Detection Groups.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups.</returns>
        public List<SpareParts> GetSparepartsGroups(string PCMConnectionString, UInt32 IdDetectionType)
        {
            List<SpareParts> SpareParts = new List<SpareParts>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsWithDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePart = new SpareParts();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                SparePart.Key = Convert.ToString(reader["KeyName"]);
                            }

                            SparePart.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePart.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePart.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePart.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SpareParts.Add(SparePart);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSparepartsGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SpareParts;
        }


        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType_V2140(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.Jangra][Geos2-4072][13/12/2022]
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType(PCMConnectionString, productTypes.IdCPType);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2140(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }


        /// <summary>
        /// This method is used to insert Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType_V2140(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, productType.CreatedBy);
                        AddSitesByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        /// <summary>
        /// This method is used to update Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2140(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddDeleteWaysByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, productType.ModifiedBy);
                    AddDeleteSitesByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, PCMConnectionString);
                    AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public bool AddDeletePCMArticle_V2140(string MainServerConnectionString, uint IdPCMArticleCategory, List<Articles> ArticleList, int IdUser, string PCMArticleImagePath)
        {
            bool isUpdated = false;
            string IdDeletedArticles = string.Join(",", ArticleList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).Select(a => a.IdArticle));
            GetPCMImagesAndDeleteByIdArticle(MainServerConnectionString, IdDeletedArticles, PCMArticleImagePath);

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (ArticleList != null)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            foreach (Articles Article in ArticleList)
                            {
                                if (Article.IdArticle > 0)
                                {
                                    if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticles_Delete_V2120", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                    else if (Article.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_pcmArticles_Insert_V2140", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", IdUser);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDeletePCMArticle_V2140().  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public List<ProductTypes> GetProductTypesByDetection(string PCMConnectionString, UInt32 IdDetection, UInt32 IdDetectionType)
        {
            List<ProductTypes> productTypesList = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetProductTypesByIdDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes productTypes = new ProductTypes();

                            if (reader["ProductCode"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(reader["ProductCode"]);
                            }
                            if (reader["ProductTemplate"] != DBNull.Value)
                            {
                                productTypes.Template = new Template();
                                productTypes.Template.Name = Convert.ToString(reader["ProductTemplate"]);
                            }
                            if (reader["ProductName"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(reader["ProductName"]);
                            }
                            if (reader["ProductDescription"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(reader["ProductDescription"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["ProductStatus"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(reader["ProductStatus"]);
                                }
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                productTypes.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt32(reader["IdTemplate"]);
                            }

                            productTypesList.Add(productTypes);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypesByDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypesList;
        }

        public DetectionDetails GetDetectionByIdDetection_V2160(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2160", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }

                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2160(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }


        public List<DetectionDetails> GetAllDetectionsWaysOptionsSpareParts_V2160(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllDetections_V2160", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionsWaysOptionsSpareParts_V2160().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }


        /// <summary>
        /// This method is used to insert ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public DetectionDetails AddDetection_V2160(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2160", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }

        /// <summary>
        /// This method is used to update ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateDetection_V2160(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2160", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error PCM_Detections_Update_V2160(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public bool IsUpdatePCM_DetectionECOSVisibility_Update_V2160(string MainServerConnectionString, DetectionDetails detectionDetails)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (detectionDetails.IdDetections >= 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionECOSVisibility_Update_V2160", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                            mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                            mySqlCommand.ExecuteNonQuery();
                            mySqlConnection.Close();

                            isUpdated = true;
                        }
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_DetectionECOSVisibility_Update_V2160(). IdArticle- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public List<DetectionDetails> PCM_GetshortDetectionDetails_V2160(string PCMConnectionString)
        {
            List<DetectionDetails> detectionDetailsList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetshortDetection_V2160", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    // DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                            }
                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            detectionDetailsList.Add(detectionDetails);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error PCM_GetshortDetectionDetails_V2160(). ErrorMessage- {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetailsList;
        }


        /// <summary>
        /// This method is used to update MicroSiga Information
        /// </summary>
        /// <param name="MicroSigainformation">MicroSiga Information.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// 
        public bool IsUpdatePCM_MicroSigaInformation(List<MicroSigainformation> MicroSigainformation, string MainServerConnectionString)
        {
            List<MicroSiga_Article_taxes> article_taxesList = GetAllArticle_taxes(MainServerConnectionString);
            List<MicroSiga_Article> articleList = GetAllArticle(MainServerConnectionString);
            bool isUpdated = true;
            bool flag = true;
            string comments_IPI = string.Empty;
            string comment_NCM = string.Empty;
            try
            {
                foreach (List<MicroSigainformation> itemGroup in MicroSigainformation.GroupBy(g => g.Reference).Select(grp => grp.ToList()))
                {
                    MicroSigainformation item = itemGroup.LastOrDefault();
                    if (item != null)
                    {
                        MicroSigainformation TempmicroSigainformationList = new MicroSigainformation();
                        try
                        {
                            MicroSiga_Article oldarticle = articleList.Where(a => a.Reference.Equals(item.Reference)).FirstOrDefault();
                            if (oldarticle != null)
                            {
                                MicroSiga_Article_taxes oldarticle_taxes = article_taxesList.Where(at => at.IdArticle == oldarticle.IdArticle).DefaultIfEmpty(null).FirstOrDefault();
                                if (oldarticle_taxes != null)
                                {

                                    if (item.IPI.Equals(oldarticle_taxes.Value.ToString()))
                                    {
                                        TempmicroSigainformationList.IPI = oldarticle_taxes.Value.ToString();
                                        //comments_IPI = "";
                                        comments_IPI = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.IPI = item.IPI;
                                        comments_IPI = "Modified IPI tax from " + Convert.ToDouble(oldarticle_taxes.Value) + "% to " + Convert.ToDouble(item.IPI) + "%";
                                    }
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                                else
                                {
                                    TempmicroSigainformationList.IPI = item.IPI;
                                    comments_IPI = "Added IPI tax " + Convert.ToDouble(item.IPI) + "%";
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                            }
                            if (comment_NCM != null || comments_IPI != null)
                            {
                                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                                {
                                    try
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticlesNCMCodeUpdate", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.Clear();
                                        if (TempmicroSigainformationList.Reference != null)
                                        {
                                            mySqlCommand.Parameters.AddWithValue("_Reference", TempmicroSigainformationList.Reference);
                                            mySqlCommand.Parameters.AddWithValue("_IPI", TempmicroSigainformationList.IPI);
                                            //mySqlCommand.Parameters.AddWithValue("_IPI", string.IsNullOrEmpty(TempmicroSigainformationList.IPI) ? "0" :TempmicroSigainformationList.IPI);                                      
                                            mySqlCommand.Parameters.AddWithValue("_NCM_Code", TempmicroSigainformationList.NCM);
                                            mySqlCommand.Parameters.AddWithValue("_IdTaxType", 1522);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", 20);
                                            mySqlCommand.Parameters.AddWithValue("_comment_IPI", comments_IPI);
                                            mySqlCommand.Parameters.AddWithValue("_comment_NCM", comment_NCM);
                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();
                                            isUpdated = true;
                                        }
                                    }
                                    catch (Exception)
                                    {
                                        flag = false;
                                        mySqlConnection.Close();
                                    }

                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            flag = false;
                            Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        }

                    }

                }

            }
            catch (Exception ex)
            {

                flag = false;
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
            if (flag == false)
            {
                isUpdated = false;
            }
            return isUpdated;
        }


        /// <summary>
        /// This method is used to get all article_taxes
        /// </summary>
        /// <param name="ConnectionString">The main server connection string.</param>
        public List<MicroSiga_Article_taxes> GetAllArticle_taxes(string ConnectionString)
        {
            List<MicroSiga_Article_taxes> article_taxesList = new List<MicroSiga_Article_taxes>();
            try
            {
                using (MySqlConnection conn = new MySqlConnection(ConnectionString))
                {
                    conn.Open();

                    MySqlCommand Command = new MySqlCommand("PCM_GetAllArticle_Taxes", conn);
                    Command.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader Reader = Command.ExecuteReader())
                    {
                        while (Reader.Read())
                        {
                            MicroSiga_Article_taxes article_taxes = new MicroSiga_Article_taxes();
                            //  SELECT IdArticleTax,IdCompany,IdArticle,IdTaxType,Value from article_taxes;
                            if (Reader["IdArticleTax"] != DBNull.Value)
                            {
                                article_taxes.IdArticleTax = Convert.ToInt32(Reader["IdArticleTax"].ToString());
                            }
                            if (Reader["IdCompany"] != DBNull.Value)
                            {
                                article_taxes.IdCompany = Convert.ToInt32(Reader["IdCompany"].ToString());
                            }
                            if (Reader["IdArticle"] != DBNull.Value)
                            {
                                article_taxes.IdArticle = Convert.ToInt32(Reader["IdArticle"].ToString());
                            }
                            if (Reader["IdTaxType"] != DBNull.Value)
                            {
                                article_taxes.IdTaxType = Convert.ToInt32(Reader["IdTaxType"].ToString());
                            }
                            if (Reader["Value"] != DBNull.Value)
                            {
                                article_taxes.Value = Convert.ToDouble(Reader["Value"].ToString());
                            }
                            article_taxesList.Add(article_taxes);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllArticle_taxes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article_taxesList;
        }


        /// <summary>
        /// This method is used to get all Article
        /// </summary>
        /// <param name="ConnectionString">The main server connection string.</param>
        public List<MicroSiga_Article> GetAllArticle(string ConnectionString)
        {
            List<MicroSiga_Article> articleList = new List<MicroSiga_Article>();
            try
            {
                using (MySqlConnection conn = new MySqlConnection(ConnectionString))
                {
                    conn.Open();

                    MySqlCommand Command = new MySqlCommand("PCM_GetAllArticle", conn);
                    Command.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader Reader = Command.ExecuteReader())
                    {
                        while (Reader.Read())
                        {
                            MicroSiga_Article article = new MicroSiga_Article();
                            if (Reader["IdArticle"] != DBNull.Value)
                            {
                                article.IdArticle = Convert.ToInt32(Reader["IdArticle"].ToString());
                            }
                            if (Reader["Reference"] != DBNull.Value)
                            {
                                article.Reference = Convert.ToString(Reader["Reference"].ToString());
                            }
                            if (Reader["NCM_Code"] != DBNull.Value)
                            {
                                article.NCM_Code = Convert.ToString(Reader["NCM_Code"].ToString());
                            }
                            articleList.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllArticle_taxes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleList;
        }


        #region V2170
        public List<PLMArticlePrice> GetIncudedPLMArticlePrices(string PCMConnectionString, UInt32 IdArticle, string currencyIconFilePath)
        {
            List<PLMArticlePrice> PLMArticlePrices = new List<PLMArticlePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByArticle", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMArticlePrice PLMArticlePrice = new PLMArticlePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMArticlePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMArticlePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMArticlePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMArticlePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMArticlePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMArticlePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMArticlePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMArticlePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMArticlePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMArticlePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMArticlePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMArticlePrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMArticlePrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMArticlePrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMArticlePrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMArticlePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }

                            if (PLMArticlePrice.MaxCost == null)
                            {
                                PLMArticlePrice.MaxCost = 0;
                            }
                            if (PLMArticlePrice.RuleValue == null)
                            {
                                PLMArticlePrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMArticlePrice.IdRule == 307)
                            {
                                PLMArticlePrice.SellPrice = Convert.ToDouble(PLMArticlePrice.MaxCost) + ((Convert.ToDouble(PLMArticlePrice.MaxCost) * (Convert.ToDouble(PLMArticlePrice.RuleValue) / 100)));
                            }
                            else if (PLMArticlePrice.IdRule == 308)
                            {
                                if (PLMArticlePrice.RuleValue == null)
                                {
                                    PLMArticlePrice.RuleValue = null;
                                    PLMArticlePrice.SellPrice = null;
                                }
                                else if (PLMArticlePrice.RuleValue != null && Convert.ToDouble(PLMArticlePrice.RuleValue) <= 0)
                                {
                                    PLMArticlePrice.RuleValue = null;
                                    PLMArticlePrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMArticlePrice.SellPrice = PLMArticlePrice.RuleValue;
                                }
                            }
                            else if (PLMArticlePrice.IdRule == 1518)
                            {
                                PLMArticlePrice.RuleValue = 0;
                                PLMArticlePrice.SellPrice = 0;
                            }
                            else if (PLMArticlePrice.IdRule == 309)
                            {
                                PLMArticlePrice.SellPrice = Convert.ToDouble(PLMArticlePrice.MaxCost) + (Convert.ToDouble(PLMArticlePrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMArticlePrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMArticlePrice.SellPrice);

                            if (PLMArticlePrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMArticlePrice.MaxCost);

                            PLMArticlePrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                            PLMArticlePrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));

                            PLMArticlePrices.Add(PLMArticlePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncudedPLMArticlePrices(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMArticlePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMArticlePrices;
        }

        private double CalculateBasePriceProfitValue(double MaxCost, double SellPriceValue)
        {
            double Profit = 0;
            try
            {
                if ((SellPriceValue == 0 && MaxCost == 0) || (SellPriceValue == MaxCost) || (SellPriceValue == 0 && MaxCost > 0))
                    Profit = 0.00;
                else
                    Profit = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (SellPriceValue)) * 100));

                Profit = Math.Round(Profit, 2);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error CalculateBasePriceProfitValue(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return Profit;
        }

        private double CalculateBasePriceCostMarginValue(double MaxCost, double SellPriceValue)
        {
            double CostMargin = 0;
            try
            {
                if ((MaxCost == 0 && SellPriceValue == 0) || (MaxCost == SellPriceValue) || (MaxCost == 0 && SellPriceValue > 0))
                    CostMargin = 0.00;
                else
                    CostMargin = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (MaxCost)) * 100));

                CostMargin = Math.Round(CostMargin, 2);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error CalculateBasePriceCostMarginValue(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
            return CostMargin;
        }

        public List<PLMArticlePrice> GetNotIncudedPLMArticlePrices(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated, string currencyIconFilePath, UInt64 IdArticle)
        {
            List<PLMArticlePrice> PLMArticlePrices = new List<PLMArticlePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByArticle", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMArticlePrice PLMArticlePrice = new PLMArticlePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMArticlePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMArticlePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMArticlePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMArticlePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMArticlePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMArticlePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMArticlePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMArticlePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMArticlePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMArticlePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMArticlePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMArticlePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            PLMArticlePrices.Add(PLMArticlePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncudedPLMArticlePrices(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMArticlePrices.Any(oi => oi.Currency.Name == item))
                    PLMArticlePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMArticlePrices;
        }

        public byte[] GetCurrencyIconFileInBytes(string currencyName, string filepath)
        {
            byte[] bytes = null;
            try
            {
                string filenamepng = currencyName + ".png";
                string filenamejpg = currencyName + ".jpg";
                string filepathjpg = Path.Combine(filepath, filenamejpg);
                string filepathpng = Path.Combine(filepath, filenamepng);

                if (File.Exists(filepathjpg))
                {

                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathjpg, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                else if (File.Exists(filepathpng))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathpng, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                return bytes;

            }
            catch (FileNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (DirectoryNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public Articles GetArticleByIdArticle_V2170(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath, string currencyIconFilePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices(PCMConnectionString, IdArticle, currencyIconFilePath);

                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2170(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        public void AddUpdateDeletePLMArticlePrices(string MainServerConnectionString, List<PLMArticlePrice> PLMArticlePriceList, UInt32 IdArticle, UInt32? IdModifier)
        {
            try
            {
                if (PLMArticlePriceList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PLMArticlePrice pLMArticlePrice in PLMArticlePriceList)
                        {
                            if (pLMArticlePrice.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (pLMArticlePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_base_price_list_by_articles_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMArticlePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMArticlePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customer_price_list_by_articles_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMArticlePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMArticlePrice.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (pLMArticlePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_base_price_list_by_articles_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMArticlePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMArticlePrice.IdRule);
                                    pLMArticlePrice.RuleValue = pLMArticlePrice.RuleValue;
                                    if (pLMArticlePrice.IdRule == 1518)
                                    {
                                        pLMArticlePrice.RuleValue = 0;
                                    }
                                    else if (pLMArticlePrice.IdRule == 308)
                                    {
                                        if (pLMArticlePrice.RuleValue == 0)
                                        {
                                            pLMArticlePrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMArticlePrice.IdRule == 0)
                                        {
                                            pLMArticlePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMArticlePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMArticlePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customer_price_list_by_articles_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMArticlePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMArticlePrice.IdRule);
                                    pLMArticlePrice.RuleValue = pLMArticlePrice.RuleValue;
                                    if (pLMArticlePrice.IdRule == 1518)
                                    {
                                        pLMArticlePrice.RuleValue = 0;
                                    }
                                    else if (pLMArticlePrice.IdRule == 308)
                                    {
                                        if (pLMArticlePrice.RuleValue == 0)
                                        {
                                            pLMArticlePrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMArticlePrice.IdRule == 0)
                                        {
                                            pLMArticlePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMArticlePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMArticlePrice.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (pLMArticlePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_base_price_list_by_articles_Insert", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMArticlePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                    pLMArticlePrice.RuleValue = pLMArticlePrice.RuleValue;
                                    if (pLMArticlePrice.IdRule == 1518)
                                    {
                                        pLMArticlePrice.RuleValue = 0;
                                    }
                                    else if (pLMArticlePrice.IdRule == 308)
                                    {
                                        if (pLMArticlePrice.RuleValue == 0)
                                        {
                                            pLMArticlePrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMArticlePrice.IdRule == 0)
                                        {
                                            pLMArticlePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMArticlePrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMArticlePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", 0);
                                    mySqlCommand.Parameters.AddWithValue("_Royalty", 0);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMArticlePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customer_price_list_by_articles_Insert", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMArticlePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                    pLMArticlePrice.RuleValue = pLMArticlePrice.RuleValue;
                                    if (pLMArticlePrice.IdRule == 1518)
                                    {
                                        pLMArticlePrice.RuleValue = 0;
                                    }
                                    else if (pLMArticlePrice.IdRule == 308)
                                    {
                                        if (pLMArticlePrice.RuleValue == 0)
                                        {
                                            pLMArticlePrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMArticlePrice.IdRule == 0)
                                        {
                                            pLMArticlePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMArticlePrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMArticlePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePLMArticlePrices(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public bool IsUpdatePCMArticle_V2170(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath, string PCMArticleDocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_PCMArticle_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                            mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_es", Article.PCMDescription_es);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_fr", Article.PCMDescription_fr);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ro", Article.PCMDescription_ro);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_zh", Article.PCMDescription_zh);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_pt", Article.PCMDescription_pt);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ru", Article.PCMDescription_ru);

                            mySqlCommand.ExecuteNonQuery();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                        AddUpdateDeletePCMArticleDocs(MainServerConnectionString, Article.IdArticle, Article.PCMArticleAttachmentList, PCMArticleDocPath, Article.Reference);
                        AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);
                        UpdateWarehouseArticle(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticle, Article.IdModifier);
                        AddUpdateDeletePLMArticlePrices(MainServerConnectionString, Article.ModifiedPLMArticleList, Article.IdArticle, Article.IdModifier);
                        AddBasePriceListLogEntry(MainServerConnectionString, Article.BasePriceLogEntryList);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, Article.CustomerPriceLogEntryList);
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticle_V2170(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddBasePriceListLogEntry(string MainServerConnectionString, List<BasePriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BasePriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByBasePriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", logList.IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddBasePriceListLogEntry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddCustomerPriceListLogEntry(string MainServerConnectionString, List<CustomerPriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CustomerPriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByCustomerPriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", logList.IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPriceListLogEntry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        #endregion
        #endregion

        /// <summary>
        /// This method is used to update MicroSiga Information
        /// </summary>
        /// <param name="MicroSigainformation">MicroSiga Information.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// 
        public bool IsUpdatePCM_MicroSigaInformation_V2180(List<MicroSigainformation> MicroSigainformation, string MainServerConnectionString)
        {
            List<MicroSiga_Article_taxes> article_taxesList = GetAllArticle_taxes(MainServerConnectionString);
            List<MicroSiga_Article> articleList = GetAllArticle(MainServerConnectionString);
            bool isUpdated = true;
            bool flag = true;
            string comments_IPI = string.Empty;
            string comment_NCM = string.Empty;
            try
            {
                foreach (List<MicroSigainformation> itemGroup in MicroSigainformation.GroupBy(g => g.Reference).Select(grp => grp.ToList()))
                {
                    MicroSigainformation item = itemGroup.LastOrDefault();
                    if (item != null)
                    {
                        MicroSigainformation TempmicroSigainformationList = new MicroSigainformation();
                        try
                        {
                            MicroSiga_Article oldarticle = articleList.Where(a => a.Reference.Equals(item.Reference)).FirstOrDefault();
                            if (oldarticle != null)
                            {
                                MicroSiga_Article_taxes oldarticle_taxes = article_taxesList.Where(at => at.IdArticle == oldarticle.IdArticle).DefaultIfEmpty(null).FirstOrDefault();
                                if (oldarticle_taxes != null)
                                {

                                    if (item.IPI.Equals(oldarticle_taxes.Value.ToString()))
                                    {
                                        TempmicroSigainformationList.IPI = oldarticle_taxes.Value.ToString();
                                        //comments_IPI = "";
                                        comments_IPI = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.IPI = item.IPI;
                                        comments_IPI = "Modified IPI tax from " + Convert.ToDouble(oldarticle_taxes.Value) + "% to " + Convert.ToDouble(item.IPI) + "%";
                                    }
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                                else
                                {
                                    TempmicroSigainformationList.IPI = item.IPI;
                                    comments_IPI = "Added IPI tax " + Convert.ToDouble(item.IPI) + "%";
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                            }
                            if (comment_NCM != null || comments_IPI != null)
                            {
                                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                                {
                                    try
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticlesNCMCodeUpdate_2180", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.Clear();
                                        if (TempmicroSigainformationList.Reference != null)
                                        {
                                            mySqlCommand.Parameters.AddWithValue("_Reference", TempmicroSigainformationList.Reference);
                                            mySqlCommand.Parameters.AddWithValue("_IPI", TempmicroSigainformationList.IPI);
                                            //mySqlCommand.Parameters.AddWithValue("_IPI", string.IsNullOrEmpty(TempmicroSigainformationList.IPI) ? "0" :TempmicroSigainformationList.IPI);                                      
                                            mySqlCommand.Parameters.AddWithValue("_NCM_Code", TempmicroSigainformationList.NCM);
                                            mySqlCommand.Parameters.AddWithValue("_IdTaxType", 1522);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", 20);
                                            mySqlCommand.Parameters.AddWithValue("_comment_IPI", comments_IPI);
                                            mySqlCommand.Parameters.AddWithValue("_comment_NCM", comment_NCM);
                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();
                                            isUpdated = true;
                                        }
                                    }
                                    catch (Exception)
                                    {
                                        flag = false;
                                        mySqlConnection.Close();
                                    }

                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            flag = false;
                            Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation_V2180(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        }

                    }

                }

            }
            catch (Exception ex)
            {

                flag = false;
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation_V2180(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
            if (flag == false)
            {
                isUpdated = false;
            }
            return isUpdated;
        }

        #region V2180 GEOS2-3199 DOWS (PRICE Grid)

        public List<PLMDetectionPrice> GetIncludedPLMDetectionPrices(
            string PCMConnectionString, UInt32 IdDetection, string currencyIconFilePath)
        {
            List<PLMDetectionPrice> PLMDetectionPrices = new List<PLMDetectionPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMDetectionPrice PLMDetectionPrice = new PLMDetectionPrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMDetectionPrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMDetectionPrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMDetectionPrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMDetectionPrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMDetectionPrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMDetectionPrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMDetectionPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMDetectionPrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMDetectionPrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMDetectionPrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMDetectionPrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMDetectionPrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }

                            if (PLMDetectionPrice.MaxCost == null)
                            {
                                PLMDetectionPrice.MaxCost = 0;
                            }
                            if (PLMDetectionPrice.RuleValue == null)
                            {
                                PLMDetectionPrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMDetectionPrice.IdRule == 307)
                            {
                                PLMDetectionPrice.SellPrice = Convert.ToDouble(PLMDetectionPrice.MaxCost) +
                                    ((Convert.ToDouble(PLMDetectionPrice.MaxCost) *
                                    (Convert.ToDouble(PLMDetectionPrice.RuleValue) / 100)));
                            }
                            else if (PLMDetectionPrice.IdRule == 308)
                            {
                                if (PLMDetectionPrice.RuleValue == null)
                                {
                                    PLMDetectionPrice.RuleValue = null;
                                    PLMDetectionPrice.SellPrice = null;
                                }
                                else if (PLMDetectionPrice.RuleValue != null && Convert.ToDouble(PLMDetectionPrice.RuleValue) <= 0)
                                {
                                    PLMDetectionPrice.RuleValue = null;
                                    PLMDetectionPrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMDetectionPrice.SellPrice = PLMDetectionPrice.RuleValue;
                                }
                            }
                            else if (PLMDetectionPrice.IdRule == 1518)
                            {
                                PLMDetectionPrice.RuleValue = 0;
                                PLMDetectionPrice.SellPrice = 0;
                            }
                            else if (PLMDetectionPrice.IdRule == 309)
                            {
                                PLMDetectionPrice.SellPrice = Convert.ToDouble(PLMDetectionPrice.MaxCost) +
                                    (Convert.ToDouble(PLMDetectionPrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMDetectionPrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMDetectionPrice.SellPrice);

                            if (PLMDetectionPrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMDetectionPrice.MaxCost);

                            PLMDetectionPrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(
                                MaxCost, SellPriceValue));
                            PLMDetectionPrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(
                                MaxCost, SellPriceValue));

                            PLMDetectionPrices.Add(PLMDetectionPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncudedPLMArticlePrices(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMDetectionPrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMDetectionPrices;
        }

        //private double CalculateBasePriceProfitValue(double MaxCost, double SellPriceValue)
        //{
        //    double Profit = 0;
        //    try
        //    {
        //        if ((SellPriceValue == 0 && MaxCost == 0) || (SellPriceValue == MaxCost) || (SellPriceValue == 0 && MaxCost > 0))
        //            Profit = 0.00;
        //        else
        //            Profit = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (SellPriceValue)) * 100));

        //        Profit = Math.Round(Profit, 2);
        //    }
        //    catch (Exception ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error CalculateBasePriceProfitValue(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //        throw;
        //    }
        //    return Profit;
        //}

        //private double CalculateBasePriceCostMarginValue(double MaxCost, double SellPriceValue)
        //{
        //    double CostMargin = 0;
        //    try
        //    {
        //        if ((MaxCost == 0 && SellPriceValue == 0) || (MaxCost == SellPriceValue) || (MaxCost == 0 && SellPriceValue > 0))
        //            CostMargin = 0.00;
        //        else
        //            CostMargin = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (MaxCost)) * 100));

        //        CostMargin = Math.Round(CostMargin, 2);
        //    }
        //    catch (Exception ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error CalculateBasePriceCostMarginValue(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //    }
        //    return CostMargin;
        //}

        public List<PLMDetectionPrice> GetNotIncludedPLMDetectionPrices(string PCMConnectionString,
            string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated,
            string currencyIconFilePath, UInt64 IdDetection)
        {
            List<PLMDetectionPrice> PLMDetectionPrices = new List<PLMDetectionPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByDetection", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMDetectionPrice PLMDetectionPrice = new PLMDetectionPrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMDetectionPrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMDetectionPrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMDetectionPrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMDetectionPrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMDetectionPrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMDetectionPrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMDetectionPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMDetectionPrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            //if (reader["MaxCost"] != DBNull.Value)
                            //{
                            //    PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            //}
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            PLMDetectionPrices.Add(PLMDetectionPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncludedPLMDetectionPrices(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMDetectionPrices.Any(oi => oi.Currency.Name == item))
                    PLMDetectionPrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMDetectionPrices;
        }

        //public byte[] GetCurrencyIconFileInBytes(string currencyName, string filepath)
        //{
        //    byte[] bytes = null;
        //    try
        //    {
        //        string filenamepng = currencyName + ".png";
        //        string filenamejpg = currencyName + ".jpg";
        //        string filepathjpg = Path.Combine(filepath, filenamejpg);
        //        string filepathpng = Path.Combine(filepath, filenamepng);

        //        if (File.Exists(filepathjpg))
        //        {

        //            using (System.IO.FileStream stream = new System.IO.FileStream(filepathjpg, System.IO.FileMode.Open, System.IO.FileAccess.Read))
        //            {
        //                bytes = new byte[stream.Length];
        //                int numBytesToRead = (int)stream.Length;
        //                int numBytesRead = 0;
        //                while (numBytesToRead > 0)
        //                {
        //                    // Read may return anything from 0 to numBytesToRead.
        //                    int n = stream.Read(bytes, numBytesRead, numBytesToRead);

        //                    // Break when the end of the file is reached.
        //                    if (n == 0)
        //                        break;

        //                    numBytesRead += n;
        //                    numBytesToRead -= n;
        //                }
        //            }
        //        }
        //        else if (File.Exists(filepathpng))
        //        {
        //            using (System.IO.FileStream stream = new System.IO.FileStream(filepathpng, System.IO.FileMode.Open, System.IO.FileAccess.Read))
        //            {
        //                bytes = new byte[stream.Length];
        //                int numBytesToRead = (int)stream.Length;
        //                int numBytesRead = 0;
        //                while (numBytesToRead > 0)
        //                {
        //                    // Read may return anything from 0 to numBytesToRead.
        //                    int n = stream.Read(bytes, numBytesRead, numBytesToRead);

        //                    // Break when the end of the file is reached.
        //                    if (n == 0)
        //                        break;

        //                    numBytesRead += n;
        //                    numBytesToRead -= n;
        //                }
        //            }
        //        }
        //        return bytes;

        //    }
        //    catch (FileNotFoundException ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
        //        throw;
        //    }
        //    catch (DirectoryNotFoundException ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
        //        throw;
        //    }
        //    catch (Exception ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
        //        throw;
        //    }
        //}

        public DetectionDetails GetDetectionByIdDetection_V2180(string PCMConnectionString,
            UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath,
            string currencyIconFilePath)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2180", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }

                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.IncludedPLMDetectionList = GetIncludedPLMDetectionPrices(PCMConnectionString, detectionDetails.IdDetections, currencyIconFilePath);

                string IdBasePriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                detectionDetails.NotIncludedPLMDetectionList = GetNotIncludedPLMDetectionPrices(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, detectionDetails.IdDetections);

                // detectionDetails.UpdateAllMaxCostFromNullToZero();
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2180(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }

        public void AddUpdateDeletePLMDetectionPrices(string MainServerConnectionString,
            List<PLMDetectionPrice> PLMDetectionPriceList,
            UInt32 IdDetection, UInt32? IdModifier)
        {
            try
            {
                if (PLMDetectionPriceList != null)
                {
                    DetectionDetails.UpdateAllMaxCostFromNullToZero(PLMDetectionPriceList);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PLMDetectionPrice pLMDetectionPrice in PLMDetectionPriceList)
                        {
                            if (pLMDetectionPrice.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (pLMDetectionPrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_base_price_list_by_detections_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMDetectionPrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMDetectionPrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customer_price_list_by_detections_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMDetectionPrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMDetectionPrice.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (pLMDetectionPrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_base_price_list_by_detections_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMDetectionPrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMDetectionPrice.IdRule);
                                    pLMDetectionPrice.RuleValue = pLMDetectionPrice.RuleValue;
                                    if (pLMDetectionPrice.IdRule == 1518)
                                    {
                                        pLMDetectionPrice.RuleValue = 0;
                                    }
                                    else if (pLMDetectionPrice.IdRule == 308)
                                    {
                                        if (pLMDetectionPrice.RuleValue == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMDetectionPrice.IdRule == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMDetectionPrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", pLMDetectionPrice.MaxCost);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMDetectionPrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customer_price_list_by_detections_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMDetectionPrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMDetectionPrice.IdRule);
                                    pLMDetectionPrice.RuleValue = pLMDetectionPrice.RuleValue;
                                    if (pLMDetectionPrice.IdRule == 1518)
                                    {
                                        pLMDetectionPrice.RuleValue = 0;
                                    }
                                    else if (pLMDetectionPrice.IdRule == 308)
                                    {
                                        if (pLMDetectionPrice.RuleValue == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMDetectionPrice.IdRule == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMDetectionPrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMDetectionPrice.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (pLMDetectionPrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_base_price_list_by_detections_Insert", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMDetectionPrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                    pLMDetectionPrice.RuleValue = pLMDetectionPrice.RuleValue;
                                    if (pLMDetectionPrice.IdRule == 1518)
                                    {
                                        pLMDetectionPrice.RuleValue = 0;
                                    }
                                    else if (pLMDetectionPrice.IdRule == 308)
                                    {
                                        if (pLMDetectionPrice.RuleValue == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMDetectionPrice.IdRule == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMDetectionPrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMDetectionPrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", pLMDetectionPrice.MaxCost);
                                    mySqlCommand.Parameters.AddWithValue("_Royalty", 0);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMDetectionPrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customer_price_list_by_detections_Insert", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMDetectionPrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                    pLMDetectionPrice.RuleValue = pLMDetectionPrice.RuleValue;
                                    if (pLMDetectionPrice.IdRule == 1518)
                                    {
                                        pLMDetectionPrice.RuleValue = 0;
                                    }
                                    else if (pLMDetectionPrice.IdRule == 308)
                                    {
                                        if (pLMDetectionPrice.RuleValue == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMDetectionPrice.IdRule == 0)
                                        {
                                            pLMDetectionPrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMDetectionPrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMDetectionPrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePLMDetectionPrices(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to update ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateDetection_V2180(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2180", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    //
                    AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.ModifiedBy);
                    AddBasePriceListLogEntry(MainServerConnectionString, detectionDetails.BasePriceLogEntryList);
                    AddCustomerPriceListLogEntry(MainServerConnectionString, detectionDetails.CustomerPriceLogEntryList);
                    //
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error PCM_Detections_Update_V2180(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //public void AddBasePriceListLogEntry(string MainServerConnectionString, List<BasePriceLogEntry> LogList)
        //{
        //    try
        //    {
        //        if (LogList != null)
        //        {
        //            using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
        //            {
        //                mySqlConnection.Open();

        //                foreach (BasePriceLogEntry logList in LogList)
        //                {
        //                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByBasePriceList_Insert", mySqlConnection);
        //                    mySqlCommand.CommandType = CommandType.StoredProcedure;

        //                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", logList.IdBasePriceList);
        //                    mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
        //                    mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
        //                    mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

        //                    mySqlCommand.ExecuteNonQuery();
        //                }
        //                mySqlConnection.Close();
        //            }
        //        }
        //    }
        //    catch (Exception ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error AddBasePriceListLogEntry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //        throw;
        //    }
        //}


        //public void AddCustomerPriceListLogEntry(string MainServerConnectionString, List<CustomerPriceLogEntry> LogList)
        //{
        //    try
        //    {
        //        if (LogList != null)
        //        {
        //            using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
        //            {
        //                mySqlConnection.Open();

        //                foreach (CustomerPriceLogEntry logList in LogList)
        //                {
        //                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByCustomerPriceList_Insert", mySqlConnection);
        //                    mySqlCommand.CommandType = CommandType.StoredProcedure;

        //                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", logList.IdCustomerPriceList);
        //                    mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
        //                    mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
        //                    mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

        //                    mySqlCommand.ExecuteNonQuery();
        //                }
        //                mySqlConnection.Close();
        //            }
        //        }
        //    }
        //    catch (Exception ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPriceListLogEntry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //        throw;
        //    }
        //}
        //#endregion

        /// <summary>
        /// This method is used to insert ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public DetectionDetails AddDetection_V2180(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2160", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerList, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        //
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                        //AddBasePriceListLogEntry(MainServerConnectionString, Article.BasePriceLogEntryList);
                        //AddCustomerPriceListLogEntry(MainServerConnectionString, Article.CustomerPriceLogEntryList);
                        //
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2180(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }

        #endregion


        public IList<Company> GetEmdepSitesCompanies(string connectionstring)
        {
            IList<Company> companies = new List<Company>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("emdepsites_GetEmdepSitesDetail", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        string connstr = "Data Source = " + sitereader["DatabaseIP"].ToString() + "; Database = geos; User ID = GeosUsr; Password = GEOS;Convert Zero Datetime=True";
                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {
                            Company company = new Company();

                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            company.Name = sitereader["Name"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }

        /// <summary>
        /// This method is used to get all article.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Article.</returns>
        public List<Articles> GetAllStatusPCMArticles(string connectionString)
        {
            List<Articles> articles = new List<Articles>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllStatusPCMArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["IdPCMArticle"] != DBNull.Value)
                                article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllStatusPCMArticles(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articles;
        }


        public async Task<List<ErrorDetails>> IsPCMArticlesSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBPLPlantCurrency, Articles UpdatedArticle)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {
                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {
                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;


                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);
                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 57))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?references={1}", GeosAppSettingList.Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue, UpdatedArticle.Reference.Trim()), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();
                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                }

                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {

                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = "None";
                                        errorDetails.CurrencyName = "None";
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = "None";
                                        errorDetails.CurrencyName = "None";
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                }
                            }
                            if (UpdatedArticle.ModifiedPLMArticleList.Any(i => i.IdStatus == 223) && GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                            {
                                if (!string.IsNullOrEmpty((GeosAppSettingList[2].DefaultValue)))
                                {
                                    if (GeosAppSettingList.Any(i => i.IdAppSetting == 61) && itemBPLPlantCurrency != null)
                                    {
                                        string linkURL = null;
                                        linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName, UpdatedArticle.Reference.Trim());

                                        StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");

                                        using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                        {
                                            responseProduct.EnsureSuccessStatusCode();
                                            string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                            if (responseBody.Contains("false"))
                                                valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                            else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                                values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                            else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                                valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                            else if (responseBody.Contains("true"))
                                                values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                            else
                                                valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                        }
                                        if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                        {
                                            errorMessage = "Synchronization is Done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = string.Empty;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                        else
                                        {
                                            if (values != null && values.Message != null)
                                            {
                                                ErrorDetails errorDetails = new ErrorDetails();
                                                errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                                errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                                errorDetails.Error = values.Message._Message;
                                                LstErrorDetail.Add(errorDetails);
                                            }
                                            else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                            {
                                                ErrorDetails errorDetails = new ErrorDetails();
                                                errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                                errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                                errorDetails.Error = valuesErrorFalse.Message;
                                                LstErrorDetail.Add(errorDetails);

                                            }
                                        }
                                    }
                                }
                            }
                        }


                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = response.ReasonPhrase;
                            LstErrorDetail.Add(errorDetails);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }

            return LstErrorDetail;
        }
        public async Task<List<ErrorDetails>> IsPCMAddDetectionSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBPLPlantCurrency, DetectionDetails NewDetection)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {
                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {
                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {

                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);
                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 58))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}", GeosAppSettingList.Where(i => i.IdAppSetting == 58).FirstOrDefault().DefaultValue), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                }

                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = "None";
                                        errorDetails.CurrencyName = "None";
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = "None";
                                        errorDetails.CurrencyName = "None";
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                }
                            }
                            if (NewDetection.ModifiedPLMDetectionList.Any(i => i.IdStatus == 223))
                            {
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 60) && itemBPLPlantCurrency != null)
                                {
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName), httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }
                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        errorMessage = "Synchronization is Done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                    }




                                }
                            }
                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = response.ReasonPhrase;
                            LstErrorDetail.Add(errorDetails);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }

            return LstErrorDetail;
        }
        public async Task<APIErrorDetailForErrorFalse> IsPCMDetectionSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
            try
            {
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {
                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);
                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 58))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}", GeosAppSettingList.Where(i => i.IdAppSetting == 58).FirstOrDefault().DefaultValue), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                }


                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {

                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        if (valuesErrorFalse == null)
                                        {
                                            valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                        }
                                        valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Message = response.ReasonPhrase;

                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        if (valuesErrorFalse == null)
                                        {
                                            valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                        }
                                        valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Message = response.ReasonPhrase;
                                    }
                                }

                            }
                        }
                        else
                        {

                            if (valuesErrorFalse == null)
                            {
                                valuesErrorFalse = new APIErrorDetailForErrorFalse();
                            }
                            valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                            valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                            valuesErrorFalse.Message = response.ReasonPhrase;

                        }
                    }

                }

            }
            catch (Exception ex)
            {
                if (valuesErrorFalse == null)
                {
                    valuesErrorFalse = new APIErrorDetailForErrorFalse();
                }
                valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                valuesErrorFalse.Message = ex.Message.ToString();
            }

            return valuesErrorFalse;
        }
        public async Task<List<ErrorDetails>> IsPCMEditDetectionSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBPLPlantCurrency, DetectionDetails UpdatedItem)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {
                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {
                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;
                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);
                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 58))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}", GeosAppSettingList.Where(i => i.IdAppSetting == 58).FirstOrDefault().DefaultValue), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                }


                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {

                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = "None";
                                        errorDetails.CurrencyName = "None";
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = "None";
                                        errorDetails.CurrencyName = "None";
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                }
                            }
                            if (UpdatedItem.ModifiedPLMDetectionList.Any(i => i.IdStatus == 223))
                            {



                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 60) && itemBPLPlantCurrency != null)
                                {
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName), httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    }
                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        errorMessage = "Synchronization is Done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                    }
                                }
                            }

                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = response.ReasonPhrase;
                            LstErrorDetail.Add(errorDetails);

                        }
                    }

                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }

            return LstErrorDetail;
        }

        public async Task<APIErrorDetailForErrorFalse> IsPCMAddEditCategorySynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
            try
            {
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {
                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);
                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 56))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}", GeosAppSettingList.Where(i => i.IdAppSetting == 56).FirstOrDefault().DefaultValue), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();
                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                }

                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {

                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        if (valuesErrorFalse == null)
                                        {
                                            valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                        }
                                        valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Message = response.ReasonPhrase;

                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        if (valuesErrorFalse == null)
                                        {
                                            valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                        }
                                        valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Message = response.ReasonPhrase;
                                    }
                                }

                            }
                            else
                            {
                                if (valuesErrorFalse == null)
                                {
                                    valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                }
                                valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                                valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                                valuesErrorFalse.Message = response.ReasonPhrase;


                            }
                        }

                    }
                }
            }
            catch (Exception ex)
            {
                if (valuesErrorFalse == null)
                {
                    valuesErrorFalse = new APIErrorDetailForErrorFalse();
                }
                valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                valuesErrorFalse.Message = ex.Message.ToString();
            }

            return valuesErrorFalse;
        }

        public async Task<APIErrorDetailForErrorFalse> IsPCMProductTypeArticleSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, Articles[] foundRow)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
            try
            {
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {
                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);
                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 57))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                string references = string.Join(",", foundRow.Select(i => i.Reference.Trim()).ToList());
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?references={1}", GeosAppSettingList.Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue, references.Trim()), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();
                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                }

                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {

                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        if (valuesErrorFalse == null)
                                        {
                                            valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                        }
                                        valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Message = response.ReasonPhrase;

                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        if (valuesErrorFalse == null)
                                        {
                                            valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                        }
                                        valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                                        valuesErrorFalse.Message = response.ReasonPhrase;
                                    }
                                }

                            }


                        }
                        else
                        {
                            if (valuesErrorFalse == null)
                            {
                                valuesErrorFalse = new APIErrorDetailForErrorFalse();
                            }
                            valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                            valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                            valuesErrorFalse.Message = response.ReasonPhrase;


                        }
                    }

                }
            }
            catch (Exception ex)
            {
                if (valuesErrorFalse == null)
                {
                    valuesErrorFalse = new APIErrorDetailForErrorFalse();
                }
                valuesErrorFalse.Code = "ECOSSynchronizationFailed";
                valuesErrorFalse.Error = "ECOSSynchronizationFailed";
                valuesErrorFalse.Message = ex.Message.ToString();
            }

            return valuesErrorFalse;
        }

        public async Task<List<ErrorDetails>> IsPCMSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBPLPlantCurrency, string Details, string Name)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {

                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {

                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);

                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);

                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);
                            if (Name.ToUpper() == "CATEGORIES")
                            {
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 56))
                                {
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");

                                    using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}", GeosAppSettingList.Where(i => i.IdAppSetting == 56).FirstOrDefault().DefaultValue), httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }

                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);

                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                    }

                                }
                            }
                            else if (Name.ToUpper() == "ARTICLES")
                            {
                                string linkURL = null;
                                if (!string.IsNullOrEmpty(Details.Trim()))
                                {
                                    linkURL = string.Format("{0}?references={1}", GeosAppSettingList.Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue, Details.Trim());
                                }
                                else
                                {
                                    linkURL = string.Format("{0}", GeosAppSettingList.Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue);
                                }
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 57))
                                {
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");

                                    using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }



                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);

                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                    }


                                }


                            }
                            else if (Name.ToUpper() == "COMPONENTS")
                            {
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 58))
                                {
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}", GeosAppSettingList.Where(i => i.IdAppSetting == 58).FirstOrDefault().DefaultValue), httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }

                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);

                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                    }

                                }
                            }
                            else if (Name.ToUpper() == "PRODUCT PRICES")
                            {
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 61) && itemBPLPlantCurrency != null)
                                {
                                    string linkURL = null;
                                    if (string.IsNullOrEmpty(Details.Trim()))
                                    {

                                        linkURL = string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName);
                                    }
                                    else
                                    {

                                        linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName, Details.Trim());
                                    }
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");

                                    using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }

                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {

                                        errorMessage = "Synchronization is Done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {

                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);

                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {

                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);

                                        }
                                    }




                                }
                            }
                            else if (Name.ToUpper() == "DETECTION PRICES")
                            {


                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 60) && itemBPLPlantCurrency != null)
                                {

                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName), httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }

                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {


                                        errorMessage = "Synchronization is done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {

                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);
                                            Details = string.Empty;

                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {

                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                            Details = string.Empty;


                                        }
                                    }



                                }
                            }

                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = values.Message._Message;
                            LstErrorDetail.Add(errorDetails);

                        }
                    }
                    else
                    {
                        ErrorDetails errorDetails = new ErrorDetails();
                        errorDetails.CompanyName = null;
                        errorDetails.CurrencyName = null;
                        errorDetails.Error = "Wrong Token Information";
                        LstErrorDetail.Add(errorDetails);
                        Details = string.Empty;
                    }

                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }

            return LstErrorDetail;
        }


        public Articles GetArticleByIdArticle_V2240(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath, string currencyIconFilePath)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2240(PCMConnectionString, IdArticle, currencyIconFilePath);

                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2240(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2240(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }



        public List<PLMArticlePrice> GetNotIncudedPLMArticlePrices_V2240(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated, string currencyIconFilePath, UInt64 IdArticle)
        {
            List<PLMArticlePrice> PLMArticlePrices = new List<PLMArticlePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByArticle_V2240", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMArticlePrice PLMArticlePrice = new PLMArticlePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMArticlePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMArticlePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMArticlePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMArticlePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMArticlePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMArticlePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMArticlePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMArticlePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMArticlePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMArticlePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMArticlePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMArticlePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMArticlePrice.Country = PLMArticlePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMArticlePrice.Country = "ALL";
                                }
                            }
                            PLMArticlePrices.Add(PLMArticlePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetNotIncudedPLMArticlePrices_V2240(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMArticlePrices.Any(oi => oi.Currency.Name == item))
                    PLMArticlePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMArticlePrices;
        }





        public List<PLMArticlePrice> GetIncudedPLMArticlePrices_V2240(string PCMConnectionString, UInt32 IdArticle, string currencyIconFilePath)
        {
            List<PLMArticlePrice> PLMArticlePrices = new List<PLMArticlePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByArticle_V2240", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMArticlePrice PLMArticlePrice = new PLMArticlePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMArticlePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMArticlePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMArticlePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMArticlePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMArticlePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMArticlePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMArticlePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMArticlePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMArticlePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMArticlePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMArticlePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMArticlePrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMArticlePrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMArticlePrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMArticlePrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMArticlePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMArticlePrice.Country = PLMArticlePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMArticlePrice.Country = "ALL";
                                }
                            }


                            if (PLMArticlePrice.MaxCost == null)
                            {
                                PLMArticlePrice.MaxCost = 0;
                            }
                            if (PLMArticlePrice.RuleValue == null)
                            {
                                PLMArticlePrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMArticlePrice.IdRule == 307)
                            {
                                PLMArticlePrice.SellPrice = Convert.ToDouble(PLMArticlePrice.MaxCost) + ((Convert.ToDouble(PLMArticlePrice.MaxCost) * (Convert.ToDouble(PLMArticlePrice.RuleValue) / 100)));
                            }
                            else if (PLMArticlePrice.IdRule == 308)
                            {
                                if (PLMArticlePrice.RuleValue == null)
                                {
                                    PLMArticlePrice.RuleValue = null;
                                    PLMArticlePrice.SellPrice = null;
                                }
                                else if (PLMArticlePrice.RuleValue != null && Convert.ToDouble(PLMArticlePrice.RuleValue) <= 0)
                                {
                                    PLMArticlePrice.RuleValue = null;
                                    PLMArticlePrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMArticlePrice.SellPrice = PLMArticlePrice.RuleValue;
                                }
                            }
                            else if (PLMArticlePrice.IdRule == 1518)
                            {
                                PLMArticlePrice.RuleValue = 0;
                                PLMArticlePrice.SellPrice = 0;
                            }
                            else if (PLMArticlePrice.IdRule == 309)
                            {
                                PLMArticlePrice.SellPrice = Convert.ToDouble(PLMArticlePrice.MaxCost) + (Convert.ToDouble(PLMArticlePrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMArticlePrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMArticlePrice.SellPrice);

                            if (PLMArticlePrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMArticlePrice.MaxCost);

                            PLMArticlePrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                            PLMArticlePrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));

                            PLMArticlePrices.Add(PLMArticlePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncudedPLMArticlePrices_V2240(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMArticlePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMArticlePrices;
        }









        public DetectionDetails GetDetectionByIdDetection_V2240(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath, string currencyIconFilePath)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2180", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }

                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.IncludedPLMDetectionList = GetIncludedPLMDetectionPrices_V2240(PCMConnectionString, detectionDetails.IdDetections, currencyIconFilePath);

                string IdBasePriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                detectionDetails.NotIncludedPLMDetectionList = GetNotIncludedPLMDetectionPrices_V2240(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, detectionDetails.IdDetections);

                // detectionDetails.UpdateAllMaxCostFromNullToZero();
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2240(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }






        public List<PLMDetectionPrice> GetNotIncludedPLMDetectionPrices_V2240(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated, string currencyIconFilePath, UInt64 IdDetection)
        {
            List<PLMDetectionPrice> PLMDetectionPrices = new List<PLMDetectionPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByDetection_V2240", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMDetectionPrice PLMDetectionPrice = new PLMDetectionPrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMDetectionPrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMDetectionPrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMDetectionPrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMDetectionPrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMDetectionPrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMDetectionPrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMDetectionPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMDetectionPrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            //if (reader["MaxCost"] != DBNull.Value)
                            //{
                            //    PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            //}
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMDetectionPrice.Country = PLMDetectionPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMDetectionPrice.Country = "ALL";
                                }
                            }
                            PLMDetectionPrices.Add(PLMDetectionPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncludedPLMDetectionPrices_V2240(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMDetectionPrices.Any(oi => oi.Currency.Name == item))
                    PLMDetectionPrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMDetectionPrices;
        }






        public List<PLMDetectionPrice> GetIncludedPLMDetectionPrices_V2240(string PCMConnectionString, UInt32 IdDetection, string currencyIconFilePath)
        {
            List<PLMDetectionPrice> PLMDetectionPrices = new List<PLMDetectionPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByDetection_V2240", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMDetectionPrice PLMDetectionPrice = new PLMDetectionPrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMDetectionPrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMDetectionPrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMDetectionPrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMDetectionPrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMDetectionPrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMDetectionPrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMDetectionPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMDetectionPrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMDetectionPrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMDetectionPrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMDetectionPrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMDetectionPrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMDetectionPrice.Country = PLMDetectionPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMDetectionPrice.Country = "ALL";
                                }
                            }
                            if (PLMDetectionPrice.MaxCost == null)
                            {
                                PLMDetectionPrice.MaxCost = 0;
                            }
                            if (PLMDetectionPrice.RuleValue == null)
                            {
                                PLMDetectionPrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMDetectionPrice.IdRule == 307)
                            {
                                PLMDetectionPrice.SellPrice = Convert.ToDouble(PLMDetectionPrice.MaxCost) +
                                    ((Convert.ToDouble(PLMDetectionPrice.MaxCost) *
                                    (Convert.ToDouble(PLMDetectionPrice.RuleValue) / 100)));
                            }
                            else if (PLMDetectionPrice.IdRule == 308)
                            {
                                if (PLMDetectionPrice.RuleValue == null)
                                {
                                    PLMDetectionPrice.RuleValue = null;
                                    PLMDetectionPrice.SellPrice = null;
                                }
                                else if (PLMDetectionPrice.RuleValue != null && Convert.ToDouble(PLMDetectionPrice.RuleValue) <= 0)
                                {
                                    PLMDetectionPrice.RuleValue = null;
                                    PLMDetectionPrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMDetectionPrice.SellPrice = PLMDetectionPrice.RuleValue;
                                }
                            }
                            else if (PLMDetectionPrice.IdRule == 1518)
                            {
                                PLMDetectionPrice.RuleValue = 0;
                                PLMDetectionPrice.SellPrice = 0;
                            }
                            else if (PLMDetectionPrice.IdRule == 309)
                            {
                                PLMDetectionPrice.SellPrice = Convert.ToDouble(PLMDetectionPrice.MaxCost) +
                                    (Convert.ToDouble(PLMDetectionPrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMDetectionPrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMDetectionPrice.SellPrice);

                            if (PLMDetectionPrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMDetectionPrice.MaxCost);

                            PLMDetectionPrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(
                                MaxCost, SellPriceValue));
                            PLMDetectionPrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(
                                MaxCost, SellPriceValue));

                            PLMDetectionPrices.Add(PLMDetectionPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncudedPLMArticlePrices_V2240(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMDetectionPrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMDetectionPrices;
        }


        /// <summary>
        /// This method is used to insert ways by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="WayList">Get way list details.</param>
        public void AddWaysByProductType_V2250(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Ways> WayList)
        {
            try
            {
                if (WayList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WayList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                            mySqlCommand.Parameters.AddWithValue("_OrderNumber", wayList.OrderNumber);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddWaysByProductType_V2250(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }



        /// <summary>
        /// This method is used to Add Update Delete ways by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="WaysList">The list of ways.</param>
        public void AddUpdateDeleteWaysByProductType_V2250(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Ways> WaysList)
        {
            try
            {
                if (WaysList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WaysList)
                        {
                            if (wayList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (wayList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", wayList.OrderNumber);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (wayList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", wayList.OrderNumber);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteWaysByProductType_V2250(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }



        /// <summary>
        /// This method is used to get ways
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of ways.</returns>
        public List<Ways> GetWaysByCpType_V2250(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                Way.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Way.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Way.OrderNumber = Convert.ToUInt32(reader["OrderNumber"]);
                            }
                            Ways.Add(Way);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWaysByCpType_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }




        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType_V2250(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType(PCMConnectionString, productTypes.IdCPType);
                // productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.WayList = GetWaysByCpType_V2250(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType(PCMConnectionString, productTypes.IdCPType);
                // productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.jangra][GEOS2-4072][13/12/2022]
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType(PCMConnectionString, productTypes.IdCPType);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2250(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }




        /// <summary>
        /// This method is used to insert Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType_V2250(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, productType.CreatedBy);
                        AddSitesByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }






        /// <summary>
        /// This method is used to update Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2250(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, productType.ModifiedBy);
                    AddDeleteSitesByProductType(MainServerConnectionString, productType.IdCPType, productType.CustomerList, PCMConnectionString);
                    AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2250(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public Articles GetArticleByIdArticle_V2250(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath, string currencyIconFilePath, int IdUser)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2250(PCMConnectionString, IdArticle, currencyIconFilePath, IdUser);

                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle, IdUser);


            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }
        public List<PLMArticlePrice> GetIncudedPLMArticlePrices_V2250(string PCMConnectionString, UInt32 IdArticle, string currencyIconFilePath, int IdUser)
        {
            List<PLMArticlePrice> PLMArticlePrices = new List<PLMArticlePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByArticle_V2250", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMArticlePrice PLMArticlePrice = new PLMArticlePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMArticlePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMArticlePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMArticlePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMArticlePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMArticlePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMArticlePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMArticlePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMArticlePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMArticlePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMArticlePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMArticlePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMArticlePrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMArticlePrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMArticlePrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMArticlePrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMArticlePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }



                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMArticlePrice.Country = PLMArticlePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMArticlePrice.Country = "ALL";
                                }
                            }

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMArticlePrice.IdPermission.Equals("62"))
                                {
                                    PLMArticlePrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMArticlePrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMArticlePrice.IsEnabledPermission = false;
                            }

                            if (PLMArticlePrice.MaxCost == null)
                            {
                                PLMArticlePrice.MaxCost = 0;
                            }
                            if (PLMArticlePrice.RuleValue == null)
                            {
                                PLMArticlePrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMArticlePrice.IdRule == 307)
                            {
                                PLMArticlePrice.SellPrice = Convert.ToDouble(PLMArticlePrice.MaxCost) + ((Convert.ToDouble(PLMArticlePrice.MaxCost) * (Convert.ToDouble(PLMArticlePrice.RuleValue) / 100)));
                            }
                            else if (PLMArticlePrice.IdRule == 308)
                            {
                                if (PLMArticlePrice.RuleValue == null)
                                {
                                    PLMArticlePrice.RuleValue = null;
                                    PLMArticlePrice.SellPrice = null;
                                }
                                else if (PLMArticlePrice.RuleValue != null && Convert.ToDouble(PLMArticlePrice.RuleValue) <= 0)
                                {
                                    PLMArticlePrice.RuleValue = null;
                                    PLMArticlePrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMArticlePrice.SellPrice = PLMArticlePrice.RuleValue;
                                }
                            }
                            else if (PLMArticlePrice.IdRule == 1518)
                            {
                                PLMArticlePrice.RuleValue = 0;
                                PLMArticlePrice.SellPrice = 0;
                            }
                            else if (PLMArticlePrice.IdRule == 309)
                            {
                                PLMArticlePrice.SellPrice = Convert.ToDouble(PLMArticlePrice.MaxCost) + (Convert.ToDouble(PLMArticlePrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMArticlePrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMArticlePrice.SellPrice);

                            if (PLMArticlePrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMArticlePrice.MaxCost);

                            PLMArticlePrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                            PLMArticlePrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));

                            PLMArticlePrices.Add(PLMArticlePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncudedPLMArticlePrices_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMArticlePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMArticlePrices;
        }
        public List<PLMArticlePrice> GetNotIncudedPLMArticlePrices_V2250(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated,
            string currencyIconFilePath, UInt64 IdArticle, int IdUser)
        {
            List<PLMArticlePrice> PLMArticlePrices = new List<PLMArticlePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByArticle_V2250", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMArticlePrice PLMArticlePrice = new PLMArticlePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMArticlePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMArticlePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMArticlePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMArticlePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMArticlePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMArticlePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMArticlePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMArticlePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMArticlePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMArticlePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMArticlePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMArticlePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMArticlePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMArticlePrice.Country = PLMArticlePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMArticlePrice.Country = "ALL";
                                }
                            }
                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMArticlePrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMArticlePrice.IdPermission.Equals("62"))
                                {
                                    PLMArticlePrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMArticlePrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMArticlePrice.IsEnabledPermission = false;
                            }
                            PLMArticlePrices.Add(PLMArticlePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetNotIncudedPLMArticlePrices_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMArticlePrices.Any(oi => oi.Currency.Name == item))
                    PLMArticlePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMArticlePrices;
        }

        public DetectionDetails GetDetectionByIdDetection_V2250(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath, string currencyIconFilePath, int IdUser)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2180", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    DetectionDetailCommand.Parameters.AddWithValue("_IdUser", IdUser);

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }

                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.IncludedPLMDetectionList = GetIncludedPLMDetectionPrices_V2250(PCMConnectionString, detectionDetails.IdDetections, currencyIconFilePath, IdUser);

                string IdBasePriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                detectionDetails.NotIncludedPLMDetectionList = GetNotIncludedPLMDetectionPrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                    detectionDetails.IdDetections, IdUser);

                // detectionDetails.UpdateAllMaxCostFromNullToZero();
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2250(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }
        public List<PLMDetectionPrice> GetNotIncludedPLMDetectionPrices_V2250(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated, string currencyIconFilePath, UInt64 IdDetection, int IdUser)
        {
            List<PLMDetectionPrice> PLMDetectionPrices = new List<PLMDetectionPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByDetection_V2250", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMDetectionPrice PLMDetectionPrice = new PLMDetectionPrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMDetectionPrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMDetectionPrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMDetectionPrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMDetectionPrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMDetectionPrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMDetectionPrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMDetectionPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMDetectionPrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            //if (reader["MaxCost"] != DBNull.Value)
                            //{
                            //    PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            //}
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMDetectionPrice.Country = PLMDetectionPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMDetectionPrice.Country = "ALL";
                                }
                            }

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMDetectionPrice.IdPermission.Equals("62"))
                                {
                                    PLMDetectionPrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMDetectionPrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMDetectionPrice.IsEnabledPermission = false;
                            }
                            PLMDetectionPrices.Add(PLMDetectionPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetNotIncludedPLMDetectionPrices_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMDetectionPrices.Any(oi => oi.Currency.Name == item))
                    PLMDetectionPrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMDetectionPrices;
        }
        public List<PLMDetectionPrice> GetIncludedPLMDetectionPrices_V2250(string PCMConnectionString, UInt32 IdDetection, string currencyIconFilePath, int IdUser)
        {
            List<PLMDetectionPrice> PLMDetectionPrices = new List<PLMDetectionPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByDetection_V2250", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMDetectionPrice PLMDetectionPrice = new PLMDetectionPrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMDetectionPrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMDetectionPrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMDetectionPrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMDetectionPrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMDetectionPrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMDetectionPrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMDetectionPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMDetectionPrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMDetectionPrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMDetectionPrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMDetectionPrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMDetectionPrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMDetectionPrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMDetectionPrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMDetectionPrice.Country = PLMDetectionPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMDetectionPrice.Country = "ALL";
                                }
                            }
                            if (PLMDetectionPrice.MaxCost == null)
                            {
                                PLMDetectionPrice.MaxCost = 0;
                            }
                            if (PLMDetectionPrice.RuleValue == null)
                            {
                                PLMDetectionPrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMDetectionPrice.IdRule == 307)
                            {
                                PLMDetectionPrice.SellPrice = Convert.ToDouble(PLMDetectionPrice.MaxCost) +
                                    ((Convert.ToDouble(PLMDetectionPrice.MaxCost) *
                                    (Convert.ToDouble(PLMDetectionPrice.RuleValue) / 100)));
                            }
                            else if (PLMDetectionPrice.IdRule == 308)
                            {
                                if (PLMDetectionPrice.RuleValue == null)
                                {
                                    PLMDetectionPrice.RuleValue = null;
                                    PLMDetectionPrice.SellPrice = null;
                                }
                                else if (PLMDetectionPrice.RuleValue != null && Convert.ToDouble(PLMDetectionPrice.RuleValue) <= 0)
                                {
                                    PLMDetectionPrice.RuleValue = null;
                                    PLMDetectionPrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMDetectionPrice.SellPrice = PLMDetectionPrice.RuleValue;
                                }
                            }
                            else if (PLMDetectionPrice.IdRule == 1518)
                            {
                                PLMDetectionPrice.RuleValue = 0;
                                PLMDetectionPrice.SellPrice = 0;
                            }
                            else if (PLMDetectionPrice.IdRule == 309)
                            {
                                PLMDetectionPrice.SellPrice = Convert.ToDouble(PLMDetectionPrice.MaxCost) +
                                    (Convert.ToDouble(PLMDetectionPrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMDetectionPrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMDetectionPrice.SellPrice);

                            if (PLMDetectionPrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMDetectionPrice.MaxCost);

                            PLMDetectionPrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(
                                MaxCost, SellPriceValue));
                            PLMDetectionPrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(
                                MaxCost, SellPriceValue));

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMDetectionPrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMDetectionPrice.IdPermission.Equals("62"))
                                {
                                    PLMDetectionPrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMDetectionPrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMDetectionPrice.IsEnabledPermission = false;
                            }
                            PLMDetectionPrices.Add(PLMDetectionPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIncludedPLMDetectionPrices_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMDetectionPrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMDetectionPrices;
        }


        public bool IsUpdatePCMArticle_V2260(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath, string PCMArticleDocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_PCMArticle_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                            mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_es", Article.PCMDescription_es);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_fr", Article.PCMDescription_fr);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ro", Article.PCMDescription_ro);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_zh", Article.PCMDescription_zh);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_pt", Article.PCMDescription_pt);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ru", Article.PCMDescription_ru);

                            mySqlCommand.ExecuteNonQuery();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                        AddUpdateDeletePCMArticleDocs(MainServerConnectionString, Article.IdArticle, Article.PCMArticleAttachmentList, PCMArticleDocPath, Article.Reference);
                        AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);
                        UpdateWarehouseArticle_V2260(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticle, Article.IdModifier);
                        AddUpdateDeletePLMArticlePrices(MainServerConnectionString, Article.ModifiedPLMArticleList, Article.IdArticle, Article.IdModifier);
                        AddBasePriceListLogEntry(MainServerConnectionString, Article.BasePriceLogEntryList);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, Article.CustomerPriceLogEntryList);
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticle_V2260(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public void UpdateWarehouseArticle_V2260(string MainServerConnectionString, UInt32 IdArticle, Article WarehouseArticle, uint? IdModifier)
        {
            try
            {
                if (WarehouseArticle != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();


                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_WarehouseArticle_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_idArticle", WarehouseArticle.IdArticle);
                        mySqlCommand.Parameters.AddWithValue("_IdModifier", IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_ArticleName", WarehouseArticle.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", WarehouseArticle.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", WarehouseArticle.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", WarehouseArticle.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", WarehouseArticle.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", WarehouseArticle.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", WarehouseArticle.Description_ru);

                        mySqlCommand.ExecuteNonQuery();
                    }
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateWarehouseArticle(). IdArticle- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to insert Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType_V2260(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2260(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        int count = 0;
        public void AddSitesByProductType_V2260(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomersList, string PCMConnectionString)
        {
            count = count + 1;
            try
            {
                if (CustomersList != null)
                {
                    List<Site> SitesAddCustomerList = new List<Site>();

                    try
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegion_V2260", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            foreach (CPLCustomer customerList in CustomersList)
                            {
                                mySqlCommand.Parameters.Clear();
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                {
                                    while (reader.Read())
                                    {
                                        if (reader["IdSite"] != DBNull.Value)
                                        {
                                            Site site = new Site();
                                            site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                            SitesAddCustomerList.Add(site);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType_V2260 - PCM_GetSitesByCustomerAndRegion. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        throw;
                    }

                    if (SitesAddCustomerList != null && SitesAddCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesAddCustomerList = SitesAddCustomerList.Distinct().ToList();
                            foreach (Site site in SitesAddCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType_V2260 - PCM_SitesByCPType_Insert. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    //throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType_V2260(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void AddCustomersRegionsByProductType_V2260(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomerList, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customerList in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert_V2260", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            if (customerList.IdGroup == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                            }

                            mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersRegionsByProductType_V2260(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get customers with regions.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of customers with regions.</returns>
        public List<CPLCustomer> GetCustomersWithRegions_V2260(string PCMConnectionString, UInt64 IdCPType)
        {
            List<CPLCustomer> regionsByCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegions_V2260", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer customer = new CPLCustomer();
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                customer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                                if (reader["RegionName"] != DBNull.Value)
                                {
                                    customer.RegionName = Convert.ToString(reader["RegionName"]);
                                }
                            }
                            else
                            {
                                customer.RegionName = "ALL";
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                customer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                                if (reader["CustomerName"] != DBNull.Value)
                                {
                                    customer.GroupName = Convert.ToString(reader["CustomerName"]);
                                }
                            }
                            else
                            {
                                customer.GroupName = "ALL";
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                customer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdSite"] != DBNull.Value)
                            {
                                customer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                customer.Plant = new Site();
                                customer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    customer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                customer.Plant = new Site();
                                customer.Plant.Name = "ALL";
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                customer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                customer.Country = new Country();
                                customer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    customer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                customer.Country = new Country();
                                customer.Country.Name = "ALL";
                            }
                            if (reader["Idcustomers_regions_by_cptype"] != DBNull.Value)
                            {
                                customer.IdCustomerPriceListCustomer = Convert.ToUInt64(reader["Idcustomers_regions_by_cptype"]);
                            }
                            regionsByCustomerList.Add(customer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegions_V2260(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        /// <summary>
        /// This method is used to update Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2260(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2260(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to Add/Delete customers and regions by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        public void AddDeleteCustomersRegionsByProductType_V2260(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomersList, UInt32 IdCreator)
        {
            try
            {
                if (CustomersList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customersList in CustomersList)
                        {
                            if (customersList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Delete_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (customersList.IdCustomerPriceListCustomer > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Update_V2260", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_Idcustomers_regions_by_cptype", customersList.IdCustomerPriceListCustomer);
                                    if (customersList.IdGroup == 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }

                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersRegionsByProductType_V2260(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        /// <summary>
        /// This method is used to Add/Delete customers and regions by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        public void AddDeleteSitesByProductType_V2260(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomersList, string PCMConnectionString)
        {
            try
            {
                if (CustomersList != null)
                {
                    List<Site> SitesDeleteCustomerList = new List<Site>();
                    List<Site> SitesAddCustomerList = new List<Site>();
                    if (CustomersList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                    {
                        try
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                            {
                                mySqlConnection.Open();
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegion_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                foreach (CPLCustomer customerList in CustomersList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).ToList())
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                    {
                                        while (reader.Read())
                                        {
                                            if (reader["IdSite"] != DBNull.Value)
                                            {
                                                Site site = new Site();
                                                site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                                SitesDeleteCustomerList.Add(site);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_GetSitesByCustomerAndRegion. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (CustomersList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add))
                    {
                        try
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                            {
                                mySqlConnection.Open();
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegionByCPType_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                foreach (CPLCustomer customerList in CustomersList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList())
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                    {
                                        while (reader.Read())
                                        {
                                            if (reader["IdSite"] != DBNull.Value)
                                            {
                                                Site site = new Site();
                                                site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                                SitesAddCustomerList.Add(site);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_GetSitesByCustomerAndRegionByCPType. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (SitesDeleteCustomerList != null && SitesDeleteCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Delete", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesDeleteCustomerList = SitesDeleteCustomerList.Distinct().ToList();
                            foreach (Site site in SitesDeleteCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_SitesByCPType_Delete. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    //throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }


                    if (SitesAddCustomerList != null && SitesAddCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesAddCustomerList = SitesAddCustomerList.Distinct().ToList();
                            foreach (Site site in SitesAddCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();

                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_SitesByCPType_Insert. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    //throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to insert ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public DetectionDetails AddDetection_V2260(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2160", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2260(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2260(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }
        /// <summary>
        /// This method is used to insert customers and regions by detection
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="CustomerList">Get customer list details.</param>
        /// <param name="IdDetectiontype">Get detection type id.</param>
        public void AddCustomersRegionsByDetection_V2260(string MainServerConnectionString, UInt32 IdDetection, List<CPLCustomer> CustomerList, UInt32 IdDetectiontype, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customerList in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Insert_V2260", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            if (customerList.IdGroup == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersRegionsByDetection_V2260(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get customers with regions.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of customers with regions.</returns>
        public List<CPLCustomer> GetCustomersWithRegionsByIdDetection_V2260(string PCMConnectionString, UInt32 IdDetection)
        {
            List<CPLCustomer> regionsByCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegionsByIdDetection_V2260", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer customer = new CPLCustomer();
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                customer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                                if (reader["RegionName"] != DBNull.Value)
                                {
                                    customer.RegionName = Convert.ToString(reader["RegionName"]);
                                }
                            }
                            else
                            {
                                customer.RegionName = "ALL";
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                customer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                                if (reader["CustomerName"] != DBNull.Value)
                                {
                                    customer.GroupName = Convert.ToString(reader["CustomerName"]);
                                }
                            }
                            else
                            {
                                customer.GroupName = "ALL";
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                customer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdSite"] != DBNull.Value)
                            {
                                customer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                customer.Plant = new Site();
                                customer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    customer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                customer.Plant = new Site();
                                customer.Plant.Name = "ALL";
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                customer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                customer.Country = new Country();
                                customer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    customer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                customer.Country = new Country();
                                customer.Country.Name = "ALL";
                            }
                            if (reader["Idcustomers_regions_by_detection"] != DBNull.Value)
                            {
                                customer.IdCustomerPriceListCustomer = Convert.ToUInt64(reader["Idcustomers_regions_by_detection"]);
                            }
                            regionsByCustomerList.Add(customer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegionsByIdDetection_V2260(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        /// <summary>
        /// This method is used to update ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateDetection_V2260(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2180", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection_V2260(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    //
                    AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.ModifiedBy);
                    AddBasePriceListLogEntry(MainServerConnectionString, detectionDetails.BasePriceLogEntryList);
                    AddCustomerPriceListLogEntry(MainServerConnectionString, detectionDetails.CustomerPriceLogEntryList);
                    //
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection_V2260(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to Add/Delete customers and regions by detection
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        /// <param name="IdDetectiontype">Get detection type id.</param>
        public void AddDeleteCustomersRegionsByDetection_V2260(string MainServerConnectionString, UInt32 IdDetection, List<CPLCustomer> CustomersList, UInt32 IdDetectiontype, UInt32 IdCreator)
        {
            try
            {
                if (CustomersList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customersList in CustomersList)
                        {
                            if (customersList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Delete_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Insert_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersRegionsByDetection_V2260(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[cpatil][GEOS2-3525][11-05-2022]
        public Int64 GetDetectionTypeMaxWelOrder(string connectionstring)
        {
            Int64 maxWelOrder = 0;
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionTypeMaxWelOrder", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.Read())
                        {

                            if (reader["MaxWelOrder"] != DBNull.Value)
                                maxWelOrder = Convert.ToInt64(reader["MaxWelOrder"]);


                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionTypeMaxWelOrder(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return maxWelOrder;
        }



        //[cpatil][GEOS2-3525][11-05-2022]
        public bool IsExistDetectionTypeWelOrder(string connectionstring, UInt32 welOrder)
        {
            bool isExist = false;
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_IsExistDetectionTypeWelOrder", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_WeldOrder", welOrder);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.Read())
                        {

                            if (reader["IdDetection"] != DBNull.Value)
                                isExist = true;


                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsExistDetectionTypeWelOrder(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return isExist;
        }

        //[cpatil][GEOS2-3728][19-05-2022]
        public List<ProductTypes> GetAllProductTypes_V2270(string PCMConnectionString)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes_V2270", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }

                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    cpType.Status.HtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }

                            cpType.WayList = GetWayListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.DetectionList = GetDetectionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.OptionList = GetOptionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.SparePartList = GetSparePartListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes_V2270(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }


        /// <summary>
        /// This method is used to insert Product Type
        /// [cpatil][GEOS2-3728][19-05-2022]
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType_V2270(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        //if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        //{
                        //    mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        //}
                        //else
                        //{
                        //    mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        //}

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2270(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        /// <summary>
        /// This method is used to get customers with regions.
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of customers with regions.</returns>
        public List<CPLCustomer> GetCustomersWithRegions_V2280(string PCMConnectionString, UInt64 IdCPType)
        {
            List<CPLCustomer> regionsByCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegions_V2280", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer customer = new CPLCustomer();
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                customer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                                if (reader["RegionName"] != DBNull.Value)
                                {
                                    customer.RegionName = Convert.ToString(reader["RegionName"]);
                                }
                            }
                            else
                            {
                                customer.RegionName = "ALL";
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                customer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                                if (reader["CustomerName"] != DBNull.Value)
                                {
                                    customer.GroupName = Convert.ToString(reader["CustomerName"]);
                                }
                            }
                            else
                            {
                                customer.GroupName = "ALL";
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                customer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdSite"] != DBNull.Value)
                            {
                                customer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                customer.Plant = new Site();
                                customer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    customer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                customer.Plant = new Site();
                                customer.Plant.Name = "ALL";
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                customer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                customer.Country = new Country();
                                customer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    customer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                customer.Country = new Country();
                                customer.Country.Name = "ALL";
                            }
                            if (reader["Idcustomers_regions_by_cptype"] != DBNull.Value)
                            {
                                customer.IdCustomerPriceListCustomer = Convert.ToUInt64(reader["Idcustomers_regions_by_cptype"]);
                            }

                            if (reader["IsIncluded"] != DBNull.Value)
                            {
                                customer.IsIncluded = Convert.ToInt32(reader["IsIncluded"]);
                            }
                            regionsByCustomerList.Add(customer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegions_V2280(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        public void AddCustomersRegionsByProductType_V2280(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomerList, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customerList in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert_V2280", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            if (customerList.IdGroup == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                            }

                            mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_IsIncluded", customerList.IsIncluded);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersRegionsByProductType_V2280(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to insert Product Type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType_V2280(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2280(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }


        /// <summary>
        /// This method is used to update Product Type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2280(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2280(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        /// <summary>
        /// This method is used to Add/Delete customers and regions by product type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        public void AddDeleteCustomersRegionsByProductType_V2280(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomersList, UInt32 IdCreator)
        {
            try
            {
                if (CustomersList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customersList in CustomersList)
                        {
                            if (customersList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Delete_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (customersList.IdCustomerPriceListCustomer > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Update_V2280", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_Idcustomers_regions_by_cptype", customersList.IdCustomerPriceListCustomer);
                                    if (customersList.IdGroup == 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_IsIncluded", customersList.IsIncluded);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert_V2280", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }

                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_IsIncluded", customersList.IsIncluded);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersRegionsByProductType_V2280(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public List<CPLCustomer> GetCustomersWithRegionsByIdDetection_V2280(string PCMConnectionString, UInt32 IdDetection)
        {
            List<CPLCustomer> regionsByCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegionsByIdDetection_V2280", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer customer = new CPLCustomer();
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                customer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                                if (reader["RegionName"] != DBNull.Value)
                                {
                                    customer.RegionName = Convert.ToString(reader["RegionName"]);
                                }
                            }
                            else
                            {
                                customer.RegionName = "ALL";
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                customer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                                if (reader["CustomerName"] != DBNull.Value)
                                {
                                    customer.GroupName = Convert.ToString(reader["CustomerName"]);
                                }
                            }
                            else
                            {
                                customer.GroupName = "ALL";
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                customer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdSite"] != DBNull.Value)
                            {
                                customer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                customer.Plant = new Site();
                                customer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    customer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                customer.Plant = new Site();
                                customer.Plant.Name = "ALL";
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                customer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                customer.Country = new Country();
                                customer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    customer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                customer.Country = new Country();
                                customer.Country.Name = "ALL";
                            }
                            if (reader["Idcustomers_regions_by_detection"] != DBNull.Value)
                            {
                                customer.IdCustomerPriceListCustomer = Convert.ToUInt64(reader["Idcustomers_regions_by_detection"]);
                            }

                            if (reader["IsIncluded"] != DBNull.Value)
                            {
                                customer.IsIncluded = Convert.ToInt32(reader["IsIncluded"]);
                            }
                            regionsByCustomerList.Add(customer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegionsByIdDetection_V2280(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }
        /// <summary>
        /// This method is used to update ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateDetection_V2280(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2180", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    //
                    AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.ModifiedBy);
                    AddBasePriceListLogEntry(MainServerConnectionString, detectionDetails.BasePriceLogEntryList);
                    AddCustomerPriceListLogEntry(MainServerConnectionString, detectionDetails.CustomerPriceLogEntryList);
                    //
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection_V2280(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddDeleteCustomersRegionsByDetection_V2280(string MainServerConnectionString, UInt32 IdDetection, List<CPLCustomer> CustomersList, UInt32 IdDetectiontype, UInt32 IdCreator)
        {
            try
            {
                if (CustomersList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customersList in CustomersList)
                        {
                            if (customersList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Delete_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Insert_V2280", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_IsIncluded", customersList.IsIncluded);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersRegionsByDetection_V2280(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to insert ways, detections, options, spare parts
        /// </summary>
        /// <param name="detectionDetails">Get detection details.</param>
        /// <param name="DetectionAttachedDocPath">Get file path.</param>
        /// <param name="DetectionImagePath">Get image path.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public DetectionDetails AddDetection_V2280(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2160", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2280(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }
        public void AddCustomersRegionsByDetection_V2280(string MainServerConnectionString, UInt32 IdDetection, List<CPLCustomer> CustomerList, UInt32 IdDetectiontype, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customerList in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_detection_Insert_V2280", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            if (customerList.IdGroup == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectiontype);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_IsIncluded", customerList.IsIncluded);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersRegionsByDetection_V2280(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[rdixit][GEOS2- 2571][04.07.2022][added field pcmCategoryInUse]
        public List<PCMArticleCategory> GetPCMArticleCategories_V2290(string connectionstring)
        {
            List<PCMArticleCategory> pcmArticleCategory = new List<PCMArticleCategory>();
            try
            {
                int i = 0;
                int inusevalue;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticleCategories_V2290", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory PCMArticleCategory = new PCMArticleCategory();
                            PCMArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                PCMArticleCategory.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                PCMArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                PCMArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                PCMArticleCategory.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["KeyName"] != DBNull.Value)
                                PCMArticleCategory.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                PCMArticleCategory.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                PCMArticleCategory.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count = Convert.ToInt32(reader["Articles_Count"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count_original = Convert.ToInt32(reader["Articles_Count"]);

                            if (reader["pcmCategoryInUse"] != DBNull.Value)//[GEOS2-2571][04.07.2022][rdixit]
                            {
                                if (Convert.ToInt32(reader["pcmCategoryInUse"]) == 1)
                                {
                                    PCMArticleCategory.InUse = "YES";
                                }
                                else PCMArticleCategory.InUse = "NO";
                            }

                            pcmArticleCategory.Add(PCMArticleCategory);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategories_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return pcmArticleCategory;
        }

        //[rdixit][GEOS2-GEOS2-2571][06.07.2022]
        public List<Articles> GetAllPCMArticles_V2290(string connectionString, string ArticleVisualAidsPath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2290(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();

                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]).Trim();

                            if (reader["Description_es"] != DBNull.Value)
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                            if (reader["Description_fr"] != DBNull.Value)
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                            if (reader["Description_ro"] != DBNull.Value)
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                            if (reader["Description_zh"] != DBNull.Value)
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                            if (reader["Description_pt"] != DBNull.Value)
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                            if (reader["Description_ru"] != DBNull.Value)
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                            article.Visibility = "Hidden";

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                //if (article.ArticleImageInBytes != null)
                                //{
                                //    article.Visibility = "Visible";
                                //}
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    article.ArticleCategory = new ArticleCategories();
                                    article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (CategoryList != null)
                            {
                                article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                            }


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription"] != DBNull.Value)
                            {
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]);
                                if (!string.IsNullOrEmpty(article.PCMDescription))
                                {
                                    article.IsRichText = "Yes";
                                }
                                else
                                {
                                    article.IsRichText = "";
                                }
                            }
                            if (reader["IsRtfText"] != DBNull.Value)
                            {
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);
                            }
                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        /// <summary>
        /// This method is to get article decomposed related to id article
        /// </summary>
        /// <param name="connectionString">Get connection string (geos db)</param>
        /// <param name="idArticle">Get id article</param>
        /// <returns>List of article decomposed</returns>
        public List<ArticleDecomposition> GetArticleDeCompostionByIdArticle(string connectionString, UInt32 idArticle)
        {
            List<ArticleDecomposition> articleDecompositionLst = new List<ArticleDecomposition>();
            DataTable dtfinal = new DataTable();

            GetArticleDeCompostionByIdArticle(connectionString, idArticle.ToString(), dtfinal);

            if (DataTableArticleDecompostion != null && DataTableArticleDecompostion.Rows.Count > 0)
                DataTableArticleDecompostion = DataTableArticleDecompostion.AsEnumerable().OrderByDescending(c => c[2]).CopyToDataTable();

            foreach (DataRow item in DataTableArticleDecompostion.Rows)
            {
                ArticleDecomposition articleDecomposition = new ArticleDecomposition();

                try
                {
                    if (item["IdArticle"] != DBNull.Value)
                    {
                        articleDecomposition.IdArticle = Convert.ToInt64(item["IdArticle"]);

                        if (articleDecompositionLst != null && articleDecompositionLst.Count > 0 && articleDecompositionLst.Any(i => i.IdArticle == articleDecomposition.IdArticle))
                        {
                            articleDecomposition.KeyName = "Group_" + treeviewcount.ToString();
                        }
                        else
                        {
                            if (item["KeyName"] != DBNull.Value)
                            {
                                articleDecomposition.KeyName = Convert.ToString(item["KeyName"]);
                            }

                        }

                        articleDecomposition.Reference = Convert.ToString(item["Reference"]);
                        articleDecomposition.Description = Convert.ToString(item["Description"]);

                        if (item["articlebyarticle"] != DBNull.Value)
                        {
                            articleDecomposition.IdParent = Convert.ToInt64(item["articlebyarticle"]);
                        }
                    }
                    if (item["ParentName"] != DBNull.Value)
                    {
                        articleDecomposition.ParentName = Convert.ToString(item["ParentName"]);
                    }



                    if (item["PCMIdArticle"] != DBNull.Value)
                    {
                        articleDecomposition.PCMArticle = new Articles();
                        articleDecomposition.PCMArticle.IdPCMArticle = Convert.ToUInt32(item["PCMIdArticle"]);
                        articleDecomposition.PCMArticle.IdArticle = Convert.ToUInt32(item["IdArticle"]);
                        if (item["PurchaseQtyMin"] != DBNull.Value)
                            articleDecomposition.PCMArticle.PurchaseQtyMin = (float)item["PurchaseQtyMin"];

                        if (item["PurchaseQtyMax"] != DBNull.Value)
                            articleDecomposition.PCMArticle.PurchaseQtyMax = (float)item["PurchaseQtyMax"];


                        if (item["IsShareWithCustomer"] != DBNull.Value)
                            articleDecomposition.PCMArticle.IsShareWithCustomer = Convert.ToByte(item["IsShareWithCustomer"]);

                        if (item["IsSparePartOnly"] != DBNull.Value)
                            articleDecomposition.PCMArticle.IsSparePartOnly = Convert.ToByte(item["IsSparePartOnly"]);

                        if (item["IsShareWithCustomer"] != DBNull.Value && item["IsSparePartOnly"] != DBNull.Value)
                        {
                            if (articleDecomposition.PCMArticle.IsShareWithCustomer == 1)
                            {
                                articleDecomposition.PCMArticle.IdECOSVisibility = 323;
                            }
                            else if (articleDecomposition.PCMArticle.IsSparePartOnly == 1)
                            {
                                articleDecomposition.PCMArticle.IdECOSVisibility = 324;
                            }
                            else if (articleDecomposition.PCMArticle.IsShareWithCustomer == 0 && articleDecomposition.PCMArticle.PurchaseQtyMax > 0 && articleDecomposition.PCMArticle.PurchaseQtyMin > 0)
                            {
                                articleDecomposition.PCMArticle.IdECOSVisibility = 325;
                            }
                            else if (articleDecomposition.PCMArticle.IsShareWithCustomer == 0 && articleDecomposition.PCMArticle.PurchaseQtyMax == 0 && articleDecomposition.PCMArticle.PurchaseQtyMin == 0)
                            {
                                articleDecomposition.PCMArticle.IdECOSVisibility = 326;
                            }
                        }
                        if (item["IdPCMStatus"] != DBNull.Value)
                            articleDecomposition.PCMArticle.IdPCMStatus = Convert.ToInt32(item["IdPCMStatus"]);
                        if (item["PCMStatusValue"] != DBNull.Value)
                            articleDecomposition.PCMArticle.PCMStatus = Convert.ToString(item["PCMStatusValue"]);
                        if (item["PCMStatusHtmlColor"] != DBNull.Value)
                            articleDecomposition.PCMArticle.StatusHTMLColor = Convert.ToString(item["PCMStatusHtmlColor"]);

                    }


                    if (item["quantity"] != DBNull.Value)
                    {
                        articleDecomposition.Quantity = (float)(item["quantity"]);
                    }

                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetArticleDeCompostionByIdArticle(). Reference- {0} IdArticle-{1}  ErrorMessage- {2}", articleDecomposition.Reference, articleDecomposition.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }

                articleDecompositionLst.Add(articleDecomposition);
                treeviewcount++;
            }

            return articleDecompositionLst;
        }

        /// <summary>
        /// This method is to get article decompostion related to id article
        /// </summary>
        /// <param name="connectionString">Get connection string (geos db)</param>
        /// <param name="idArticle">Get selected id articles</param>
        /// <param name="dt">Datatable</param>
        public void GetArticleDeCompostionByIdArticle(string connectionString, string idArticle, DataTable dt)
        {

            List<ArticleDecomposition> articleDecompositionLst = new List<ArticleDecomposition>();
            DataTable dttemp = new DataTable();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSelectedArticleDeCompostionByIdArticle", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);

                MySqlDataAdapter da = new MySqlDataAdapter(mySqlCommand);

                da.Fill(dttemp);

            }

            if (dttemp == null || dttemp.Rows.Count == 0)
            {
                if (dt == null)
                {
                    dt = dttemp;
                }
                DataTableArticleDecompostion = new DataTable();
                DataTableArticleDecompostion = dt;
                return;
            }
            else
            {
                if (dt == null || dt.Rows.Count == 0)
                {
                    dt = dttemp;
                    //foreach (DataRow item in dt.Rows)
                    //{


                    //    item[14] = item[15] + "_Group_" + treeviewcount;

                    //    treeviewcount++;
                    //}
                    List<string> starticles = new List<string>();
                    foreach (DataRow item in dttemp.Rows)
                    {
                        starticles.Add(item[0].ToString());
                    }
                    idArticle = string.Join(",", starticles);
                }
                else
                {
                    List<string> starticles = new List<string>();

                    foreach (DataRow item in dttemp.Rows)
                    {

                        DataRow dr = dt.NewRow();

                        dr[0] = item[0];
                        dr[1] = item[1];
                        dr[2] = item[2];
                        dr[3] = item[3];
                        dr[4] = item[4];
                        dr[5] = item[5];
                        dr[6] = item[6];
                        dr[7] = item[7];
                        dr[8] = item[8];
                        dr[9] = item[9];
                        dr[10] = item[10];
                        dr[11] = item[11];
                        dr[12] = item[12];
                        dr[13] = item[13];
                        dr[14] = item[14];
                        dr[15] = item[15];
                        dt.Rows.Add(dr);

                        starticles.Add(item[0].ToString());

                    }
                    idArticle = string.Join(",", starticles);
                }

                GetArticleDeCompostionByIdArticle(connectionString, idArticle, dt);
            }
        }

        public Articles GetArticleByIdArticle_V2290(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath, string currencyIconFilePath, int IdUser)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2250(PCMConnectionString, IdArticle, currencyIconFilePath, IdUser);
                article.ArticleDecompostionList = GetArticleDeCompostionByIdArticle(PCMConnectionString, IdArticle);
                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle, IdUser);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReference_V2290(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories_V2290(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Compatibility_GetAllPCMArticles_V2060", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryForReference_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        public List<PCMArticleCategory> GetPCMArticlesWithCategory_V2290(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories_V2290(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Compatibility_GetAllPCMArticles_V2060", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        //[rdixit][27.07.2022][GEOS2-2571]
        public PCMArticleCategory GetPCMArticleCategoryById_V2290(string PCMConnectionString, uint idPCMArticleCategory, string ImagePath)
        {
            PCMArticleCategory pcmArticleCategory = new PCMArticleCategory();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetPCMArticleCategoryByIdPCMArticleCategory_V2290", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", idPCMArticleCategory);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            pcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                pcmArticleCategory.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                pcmArticleCategory.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                pcmArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);
                            }
                            if (reader["IsLeaf"] != DBNull.Value)
                            {
                                pcmArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                pcmArticleCategory.Position = Convert.ToUInt32(reader["Position"]);
                            }
                            if (reader["IdArticleCategory"] != DBNull.Value)
                            {
                                pcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                pcmArticleCategory.ArticleCategory = new ArticleCategories();
                                pcmArticleCategory.ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                                if (reader["ArticleCategoryParent"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.Parent = Convert.ToUInt64(reader["ArticleCategoryParent"]);
                                }
                                if (reader["ArticleCategoryIsLeaf"] != DBNull.Value)
                                {
                                    pcmArticleCategory.ArticleCategory.IsLeaf = Convert.ToInt64(reader["ArticleCategoryIsLeaf"]);
                                }
                            }
                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                pcmArticleCategory.ImagePath = Convert.ToString(reader["ImagePath"]);
                                pcmArticleCategory.PCMArticleCategoryImageInByte = GetPCMArticleCategoryImageInBytes(pcmArticleCategory, ImagePath);
                            }
                            if (reader["pcmCategoryInUse"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["pcmCategoryInUse"]) == 1)
                                {
                                    pcmArticleCategory.InUse = "YES";
                                }
                                else pcmArticleCategory.InUse = "NO";
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategoryById_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticleCategory;
        }
        //[rdixit][27.07.2022][GEOS2-2571]
        public PCMArticleCategory AddPCMArticleCategory_V2290(string MainServerConnectionString, PCMArticleCategory pcmArticleCategory, List<PCMArticleCategory> pcmArticleCategoryList, string ImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Category_Insert_V2290", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", pcmArticleCategory.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", pcmArticleCategory.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", pcmArticleCategory.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", pcmArticleCategory.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", pcmArticleCategory.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", pcmArticleCategory.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", pcmArticleCategory.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", pcmArticleCategory.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", pcmArticleCategory.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", pcmArticleCategory.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", pcmArticleCategory.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", pcmArticleCategory.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", pcmArticleCategory.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", pcmArticleCategory.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                        mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", pcmArticleCategory.IdArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Parent", pcmArticleCategory.Parent);
                        mySqlCommand.Parameters.AddWithValue("_IsLeaf", pcmArticleCategory.IsLeaf);
                        mySqlCommand.Parameters.AddWithValue("_IdCreator", pcmArticleCategory.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_ImagePath", pcmArticleCategory.ImagePath);
                        if (pcmArticleCategory.InUse.ToUpper() == "YES")
                            mySqlCommand.Parameters.AddWithValue("_pcmCategoryInUse", 1);
                        else
                            mySqlCommand.Parameters.AddWithValue("_pcmCategoryInUse", 0);
                        pcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    //update position of pcm article categories
                    UpdatePCMArticleCategoryPosition(MainServerConnectionString, pcmArticleCategoryList, pcmArticleCategory.IdCreator);
                    AddPCMArticleCategoryImageToPath(pcmArticleCategory, ImagePath);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPCMArticleCategory_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return pcmArticleCategory;
        }
        //[rdixit][27.07.2022][GEOS2-2571]
        public bool IsUpdatePCMArticleCategory_V2290(string MainServerConnectionString, PCMArticleCategory pcmArticleCategory, List<PCMArticleCategory> pcmArticleCategoryList, string ImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Article_Category_Update_V2290", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", pcmArticleCategory.IdPCMArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Name", pcmArticleCategory.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", pcmArticleCategory.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", pcmArticleCategory.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", pcmArticleCategory.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", pcmArticleCategory.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", pcmArticleCategory.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", pcmArticleCategory.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", pcmArticleCategory.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", pcmArticleCategory.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", pcmArticleCategory.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", pcmArticleCategory.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", pcmArticleCategory.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", pcmArticleCategory.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", pcmArticleCategory.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_Position", pcmArticleCategory.Position);
                        mySqlCommand.Parameters.AddWithValue("_IdArticleCategory", pcmArticleCategory.IdArticleCategory);
                        mySqlCommand.Parameters.AddWithValue("_Parent", pcmArticleCategory.Parent);
                        mySqlCommand.Parameters.AddWithValue("_IsLeaf", pcmArticleCategory.IsLeaf);
                        mySqlCommand.Parameters.AddWithValue("_IdModifier", pcmArticleCategory.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_ImagePath", pcmArticleCategory.ImagePath);
                        if (pcmArticleCategory.InUse.ToUpper() == "YES")
                            mySqlCommand.Parameters.AddWithValue("_pcmCategoryInUse", 1);
                        else
                            mySqlCommand.Parameters.AddWithValue("_pcmCategoryInUse", 0);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    //update position of pcm article categories
                    UpdatePCMArticleCategoryPosition(MainServerConnectionString, pcmArticleCategoryList, pcmArticleCategory.IdModifier);
                    AddPCMArticleCategoryImageToPath(pcmArticleCategory, ImagePath);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticleCategory_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update MicroSiga Information
        /// </summary>
        /// <param name="MicroSigainformation">MicroSiga Information.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// 
        public bool IsUpdatePCM_MicroSigaInformation_V2260(List<MicroSigainformation> MicroSigainformation, string MainServerConnectionString)
        {
            List<MicroSiga_Article_taxes> article_taxesList = GetAllArticle_taxes(MainServerConnectionString);
            List<MicroSiga_Article> articleList = GetAllArticle(MainServerConnectionString);
            bool isUpdated = true;
            bool flag = true;
            string comments_IPI = string.Empty;
            string comment_NCM = string.Empty;
            try
            {
                foreach (List<MicroSigainformation> itemGroup in MicroSigainformation.GroupBy(g => g.Reference).Select(grp => grp.ToList()))
                {
                    MicroSigainformation item = itemGroup.LastOrDefault();
                    if (item != null)
                    {
                        MicroSigainformation TempmicroSigainformationList = new MicroSigainformation();
                        try
                        {
                            MicroSiga_Article oldarticle = articleList.Where(a => a.Reference.Equals(item.Reference)).FirstOrDefault();
                            if (oldarticle != null)
                            {
                                MicroSiga_Article_taxes oldarticle_taxes = article_taxesList.Where(at => at.IdArticle == oldarticle.IdArticle).DefaultIfEmpty(null).FirstOrDefault();
                                if (oldarticle_taxes != null)
                                {

                                    if (item.IPI.Equals(oldarticle_taxes.Value.ToString()))
                                    {
                                        TempmicroSigainformationList.IPI = oldarticle_taxes.Value.ToString();
                                        //comments_IPI = "";
                                        comments_IPI = null;
                                    }
                                    else
                                    {
                                        //TempmicroSigainformationList.IPI = item.IPI;
                                        //comments_IPI = "Modified IPI tax from " + Convert.ToDouble(oldarticle_taxes.Value) + "% to " + TempmicroSigainformationList.IPI + "%";

                                        TempmicroSigainformationList.IPI = item.IPI;
                                        comments_IPI = "Modified IPI tax from " + Convert.ToDouble(oldarticle_taxes.Value) + "% to " + item.IPI.Replace(",", ".") + "%";
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260(). Message- {0}", item.IPI), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260(). Message- {0}", TempmicroSigainformationList.IPI), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260(). ReplaceMessage- {0}", item.IPI.Replace(",", ".")), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260(). ReplaceMessage- {0}", TempmicroSigainformationList.IPI.Replace(",", ".")), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260(). ReplaceMessage  ToString()- {0}", item.IPI.ToString().Replace(',', '.')), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260(). ReplaceMessage  ToString() - {0}", TempmicroSigainformationList.IPI.ToString().Replace(',', '.')), category: Category.Info, priority: Priority.Low);

                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260().oldarticle_taxes Message- {0}", oldarticle_taxes.Value), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2260().oldarticle_taxes Message- {0}", oldarticle_taxes.Value.ToString().Replace(',', '.')), category: Category.Info, priority: Priority.Low);

                                    }
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                                else
                                {
                                    TempmicroSigainformationList.IPI = item.IPI;
                                    comments_IPI = "Added IPI tax " + Convert.ToDouble(item.IPI) + "%";
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                            }
                            if (comment_NCM != null || comments_IPI != null)
                            {
                                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                                {
                                    try
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticlesNCMCodeUpdate_2180", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.Clear();
                                        if (TempmicroSigainformationList.Reference != null)
                                        {
                                            mySqlCommand.Parameters.AddWithValue("_Reference", TempmicroSigainformationList.Reference);
                                            mySqlCommand.Parameters.AddWithValue("_IPI", TempmicroSigainformationList.IPI);
                                            //mySqlCommand.Parameters.AddWithValue("_IPI", string.IsNullOrEmpty(TempmicroSigainformationList.IPI) ? "0" :TempmicroSigainformationList.IPI);                                      
                                            mySqlCommand.Parameters.AddWithValue("_NCM_Code", TempmicroSigainformationList.NCM);
                                            mySqlCommand.Parameters.AddWithValue("_IdTaxType", 1522);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", 20);
                                            mySqlCommand.Parameters.AddWithValue("_comment_IPI", comments_IPI);
                                            mySqlCommand.Parameters.AddWithValue("_comment_NCM", comment_NCM);
                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();
                                            isUpdated = true;
                                        }
                                    }
                                    catch (Exception)
                                    {
                                        flag = false;
                                        mySqlConnection.Close();
                                    }

                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            flag = false;
                            Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation_V2260(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        }

                    }

                }

            }
            catch (Exception ex)
            {

                flag = false;
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation_V2260(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
            if (flag == false)
            {
                isUpdated = false;
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to update MicroSiga Information
        /// </summary>
        /// <param name="MicroSigainformation">MicroSiga Information.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// 
        public bool IsUpdatePCM_MicroSigaInformation_V2300(List<MicroSigainformation> MicroSigainformation, string MainServerConnectionString)
        {
            List<MicroSiga_Article_taxes> article_taxesList = GetAllArticle_taxes(MainServerConnectionString);
            List<MicroSiga_Article> articleList = GetAllArticle(MainServerConnectionString);
            bool isUpdated = true;
            bool flag = true;
            string comments_IPI = string.Empty;
            string comment_NCM = string.Empty;
            try
            {
                foreach (List<MicroSigainformation> itemGroup in MicroSigainformation.GroupBy(g => g.Reference).Select(grp => grp.ToList()))
                {
                    MicroSigainformation item = itemGroup.LastOrDefault();
                    if (item != null)
                    {
                        MicroSigainformation TempmicroSigainformationList = new MicroSigainformation();
                        try
                        {
                            MicroSiga_Article oldarticle = articleList.Where(a => a.Reference.Equals(item.Reference)).FirstOrDefault();
                            if (oldarticle != null)
                            {
                                MicroSiga_Article_taxes oldarticle_taxes = article_taxesList.Where(at => at.IdArticle == oldarticle.IdArticle).DefaultIfEmpty(null).FirstOrDefault();
                                if (oldarticle_taxes != null)
                                {

                                    //if (item.IPI.Equals(oldarticle_taxes.Value.ToString()))
                                    if (Math.Round(Convert.ToDouble(item.IPI), 2) == Math.Round(Convert.ToDouble(oldarticle_taxes.Value.ToString().Replace(',', '.')), 2))
                                    {
                                        TempmicroSigainformationList.IPI = oldarticle_taxes.Value.ToString();
                                        //comments_IPI = "";
                                        comments_IPI = null;
                                    }
                                    else
                                    {
                                        //TempmicroSigainformationList.IPI = item.IPI;
                                        //comments_IPI = "Modified IPI tax from " + Convert.ToDouble(oldarticle_taxes.Value) + "% to " + TempmicroSigainformationList.IPI + "%";

                                        double IPIValue = Math.Round(Convert.ToDouble(item.IPI), 2);
                                        TempmicroSigainformationList.IPI = item.IPI;
                                        comments_IPI = "Modified IPI tax from " + Convert.ToDouble(oldarticle_taxes.Value) + "% to " + item.IPI.Replace(".", ",") + "%";

                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. Message- {0}", item.IPI), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. Message- {0}", TempmicroSigainformationList.IPI), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage- {0}", item.IPI.Replace(",", ".")), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage- {0}", TempmicroSigainformationList.IPI.Replace(",", ".")), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage  ToString()- {0}", item.IPI.ToString().Replace(',', '.')), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage  ToString() - {0}", TempmicroSigainformationList.IPI.ToString().Replace(',', '.')), category: Category.Info, priority: Priority.Low);


                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ******"), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage- {0}", item.IPI.Replace(".", ",")), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage- {0}", TempmicroSigainformationList.IPI.Replace(".", ",")), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage  ToString()- {0}", item.IPI.ToString().Replace('.', ',')), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ReplaceMessage  ToString() - {0}", TempmicroSigainformationList.IPI.ToString().Replace('.', ',')), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300. ******"), category: Category.Info, priority: Priority.Low);

                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300.oldarticle_taxes Message- {0}", oldarticle_taxes.Value), category: Category.Info, priority: Priority.Low);
                                        Log4NetLogger.Logger.Log(string.Format("INFO IsUpdatePCM_MicroSigaInformation_V2300.oldarticle_taxes Message- {0}", oldarticle_taxes.Value.ToString().Replace(',', '.')), category: Category.Info, priority: Priority.Low);

                                    }
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                                else
                                {
                                    TempmicroSigainformationList.IPI = item.IPI;
                                    comments_IPI = "Added IPI tax " + Convert.ToDouble(item.IPI) + "%";
                                    if (oldarticle.NCM_Code == null || oldarticle.NCM_Code.Equals(string.Empty))
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Added NCM code " + item.NCM;
                                    }
                                    else if (item.NCM.Equals(oldarticle.NCM_Code))
                                    {
                                        TempmicroSigainformationList.Reference = oldarticle.Reference;
                                        TempmicroSigainformationList.NCM = oldarticle.NCM_Code;
                                        //comment_NCM = "";
                                        comment_NCM = null;
                                    }
                                    else
                                    {
                                        TempmicroSigainformationList.Reference = item.Reference;
                                        TempmicroSigainformationList.NCM = item.NCM;
                                        comment_NCM = "Modified NCM code from " + oldarticle.NCM_Code + " to " + item.NCM;
                                    }
                                }
                            }
                            if (comment_NCM != null || comments_IPI != null)
                            {
                                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                                {
                                    try
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_ArticlesNCMCodeUpdate_2180", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.Clear();
                                        if (TempmicroSigainformationList.Reference != null)
                                        {
                                            mySqlCommand.Parameters.AddWithValue("_Reference", TempmicroSigainformationList.Reference);
                                            mySqlCommand.Parameters.AddWithValue("_IPI", TempmicroSigainformationList.IPI);
                                            //mySqlCommand.Parameters.AddWithValue("_IPI", string.IsNullOrEmpty(TempmicroSigainformationList.IPI) ? "0" :TempmicroSigainformationList.IPI);                                      
                                            mySqlCommand.Parameters.AddWithValue("_NCM_Code", TempmicroSigainformationList.NCM);
                                            mySqlCommand.Parameters.AddWithValue("_IdTaxType", 1522);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", 20);
                                            mySqlCommand.Parameters.AddWithValue("_comment_IPI", comments_IPI);
                                            mySqlCommand.Parameters.AddWithValue("_comment_NCM", comment_NCM);
                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();
                                            isUpdated = true;
                                        }
                                    }
                                    catch (Exception)
                                    {
                                        flag = false;
                                        mySqlConnection.Close();
                                    }

                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            flag = false;
                            Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        }

                    }

                }

            }
            catch (Exception ex)
            {

                flag = false;
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_MicroSigaInformation_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
            if (flag == false)
            {
                isUpdated = false;
            }
            return isUpdated;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get Option type</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<Options> GetAllOptionsWithGroups_V2300(string PCMConnectionString)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                OptionGroups = GetOptionGroups(PCMConnectionString, 3);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType_V2300", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }

                            OptionGroups.Add(OptionGroup);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllOptionsWithGroups_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }

        /// <summary>
        /// This method is used to get Way List.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Ways.</returns>
        public List<Ways> GetAllWayList_V2300(string PCMConnectionString)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType_V2300", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1); //Detetction type: 1 for ways. 

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }

                            Ways.Add(Way);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWayList_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }

        /// <summary>
        /// This method is used to get All Detection Groups with detections.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions.</returns>
        public List<Detections> GetAllDetectionsWithGroups_V2300(string PCMConnectionString)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                detectionGroups = GetDetectionGroups(PCMConnectionString, 2);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType_V2300", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionsWithGroups_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        /// <summary>
        /// This method is used to get All Detection Groups with detections.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions.</returns>
        public List<SpareParts> GetAllSparepartsWithGroups_V2300(string PCMConnectionString)
        {
            List<SpareParts> sparepartsGroups = new List<SpareParts>();
            try
            {
                sparepartsGroups = GetSparepartsGroups(PCMConnectionString, 4);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType_V2300", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts sparepartsGroup = new SpareParts();

                            sparepartsGroup.Key = Convert.ToString(reader["IdDetection"]);

                            sparepartsGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                sparepartsGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                sparepartsGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                sparepartsGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                sparepartsGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            sparepartsGroups.Add(sparepartsGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllSparepartsWithGroups_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return sparepartsGroups;
        }

        /// <summary>
        /// This method is used to get Discounts.
        /// [rdixit][17.08.2022][GEOS2-3099] 
        /// </summary>
        /// <param name="PCMConnectionString"></param>
        /// <returns></returns>
        public List<Discounts> GetDiscounts(string PCMConnectionString)
        {
            List<Discounts> Discounts = new List<Discounts>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDiscounts", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.CommandTimeout = 6000;
                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Discounts Discount = new Discounts();
                        try
                        {
                            if (reader["Id"] != DBNull.Value)
                            {
                                Discount.Id = Convert.ToInt32(reader["Id"].ToString());

                                if (reader["Name"] != DBNull.Value)
                                {
                                    Discount.Name = Convert.ToString(reader["Name"]);
                                }
                                if (reader["Description"] != DBNull.Value)
                                {
                                    Discount.Description = Convert.ToString(reader["Description"]);
                                }
                                if (reader["Scope"] != DBNull.Value)
                                {
                                    Discount.Scope = Convert.ToString(reader["Scope"]);
                                }
                                if (reader["Platform"] != DBNull.Value)
                                {
                                    Discount.Platform = Convert.ToString(reader["Platform"]);
                                }
                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    Discount.StartDate = Convert.ToDateTime(reader["StartDate"]).ToString("dd-MM-yyyy");
                                }

                                if (reader["ModifiedIn"] != DBNull.Value)
                                {
                                    Discount.LastUpdate = Convert.ToDateTime(reader["ModifiedIn"]).ToString("dd-MM-yyyy");
                                }
                                if (reader["Value"] != DBNull.Value)
                                {
                                    Discount.Value = Convert.ToDecimal(reader["Value"]);
                                }
                                if (reader["InUse"] != DBNull.Value)
                                {
                                    int inuse;
                                    inuse = Convert.ToInt32(reader["InUse"]);
                                    if (inuse == 1)
                                        Discount.InUse = "YES";
                                    else
                                        Discount.InUse = "NO";
                                }
                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    DateTime endDate;
                                    endDate = Convert.ToDateTime(reader["EndDate"]);
                                    Discount.EndDate = endDate.ToString("dd-MM-yyyy");
                                    if (endDate.Date < DateTime.Now.Date && Discount.InUse.ToUpper() == "YES")
                                        Discount.OverdueEndDate = true;
                                    else
                                        Discount.OverdueEndDate = false;
                                }
                                if (reader["IsReadOnly"] != DBNull.Value)
                                {
                                    int isReadOnly;
                                    isReadOnly = Convert.ToInt32(reader["IsReadOnly"]);
                                    if (isReadOnly == 1)
                                        Discount.IsReadOnly = true;
                                    else
                                        Discount.IsReadOnly = false;
                                }
                                if (reader["CreatedBy"] != DBNull.Value)
                                {
                                    Discount.Creator = Convert.ToString(reader["CreatedBy"]);
                                }
                                if (reader["plants"] != DBNull.Value)
                                {
                                    Discount.Plants = Convert.ToString(reader["plants"]);
                                    if (Discount.Plants != null)
                                    {
                                        string[] plants = Discount.Plants.Split(',');
                                        Discount.Plants = string.Join("\n", plants.Distinct());
                                    }
                                }
                                if (reader["Group"] != DBNull.Value)
                                {
                                    Discount.Group = Convert.ToString(reader["Group"]);
                                }
                                if (reader["Country"] != DBNull.Value)
                                {
                                    Discount.Country = Convert.ToString(reader["Country"]);
                                }
                                if (reader["Region"] != DBNull.Value)
                                {
                                    Discount.Region = Convert.ToString(reader["Region"]);
                                }
                                if (reader["Plant"] != DBNull.Value)
                                {
                                    Discount.Plant = Convert.ToString(reader["Plant"]);
                                }

                            }
                            Discounts.Add(Discount);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetDiscounts().  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return Discounts;
        }

        //[rdixit][12.09.2022][GEOS2-3100]
        public Discounts AddDiscount(Discounts discount, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_AddDiscounts", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Name", discount.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", discount.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", discount.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", discount.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", discount.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", discount.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", discount.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", discount.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", discount.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", discount.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", discount.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", discount.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", discount.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", discount.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_StartDate", discount.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", discount.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", discount.IdScope);
                        mySqlCommand.Parameters.AddWithValue("_IdPlatform", discount.IdPlatform);
                        mySqlCommand.Parameters.AddWithValue("_Value", discount.Value);
                        if (discount.IsReadOnly == true)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 1);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 0);
                        }
                        if (discount.InUse.ToLower() == "no")
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 0);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 1);
                        }
                        mySqlCommand.Parameters.AddWithValue("_createdBy", discount.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        discount.Id = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }
                    if (discount.DiscountArticles != null)
                    {
                        AddDiscountArticles(MainServerConnectionString, discount);
                    }
                    if (discount.PlantList != null)
                    {
                        AddDiscountPlants(MainServerConnectionString, discount);
                    }
                    if (discount.DiscountLogEntryList != null)
                    {
                        AddDiscountChangeLog(discount, MainServerConnectionString);
                    }
                    if (discount.NewDiscountCustomer != null)
                    {
                        AddCustomersByCustomerDiscount(MainServerConnectionString, discount.Id, discount.NewDiscountCustomer, discount.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();

                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDiscount(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return discount;
        }

        //[rdixit][12.09.2022][GEOS2-3100]
        public void AddDiscountArticles(string MainServerConnectionString, Discounts discount)
        {
            try
            {
                if (discount.DiscountArticles != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (DiscountArticles DiscountArticles in discount.DiscountArticles)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_AddDiscountArticles", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", DiscountArticles.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_Value", DiscountArticles.Value);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDiscountArticles(). IdCustomerDiscount- {0} ErrorMessage- {1}", discount.Id, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[rdixit][12.09.2022][GEOS2-3100]
        public void AddDiscountPlants(string MainServerConnectionString, Discounts discount)
        {
            try
            {
                if (discount.PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Site Plant in discount.PlantList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_AddDiscountPlants", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", Plant.IdSite);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", discount.CreationDate);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", discount.IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_ModifiedBy", discount.IdModifier);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDiscountArticles(). IdCustomerDiscount- {0} ErrorMessage- {1}", discount.Id, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public async Task<List<ErrorDetails>> IsPCMArticlesSynchronization_V2310(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBPLPlantCurrency,
            Articles UpdatedArticle, bool IsArticleSynchronization)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {
                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {
                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        var client = new HttpClient();
                        client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);
                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);
                            #region ArticleSynchronization
                            if (IsArticleSynchronization)
                            {
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 57))
                                {
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?references={1}", GeosAppSettingList.Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue, UpdatedArticle.Reference.Trim()), httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();
                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                    }

                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {

                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = "None";
                                            errorDetails.CurrencyName = "None";
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = "None";
                                            errorDetails.CurrencyName = "None";
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);

                                        }
                                    }
                                }
                            }
                            #endregion
                            #region SynchronizationForPlant&Currency
                            if (UpdatedArticle.ModifiedPLMArticleList.Any(i => i.IdStatus == 223) && GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                            {
                                if (!string.IsNullOrEmpty((GeosAppSettingList[2].DefaultValue)))
                                {
                                    if (GeosAppSettingList.Any(i => i.IdAppSetting == 61) && itemBPLPlantCurrency != null)
                                    {
                                        string linkURL = null;
                                        linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName, UpdatedArticle.Reference.Trim());

                                        StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");

                                        using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                        {
                                            responseProduct.EnsureSuccessStatusCode();
                                            string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                            if (responseBody.Contains("false"))
                                                valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                            else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                                values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                            else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                                valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                            else if (responseBody.Contains("true"))
                                                values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                            else
                                                valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);

                                        }
                                        if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                        {
                                            errorMessage = "Synchronization is Done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = string.Empty;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                        else
                                        {
                                            if (values != null && values.Message != null)
                                            {
                                                ErrorDetails errorDetails = new ErrorDetails();
                                                errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                                errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                                errorDetails.Error = values.Message._Message;
                                                LstErrorDetail.Add(errorDetails);
                                            }
                                            else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                            {
                                                ErrorDetails errorDetails = new ErrorDetails();
                                                errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                                errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                                errorDetails.Error = valuesErrorFalse.Message;
                                                LstErrorDetail.Add(errorDetails);

                                            }
                                        }
                                    }
                                }
                            }
                            #endregion
                        }


                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = response.ReasonPhrase;
                            LstErrorDetail.Add(errorDetails);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }

            return LstErrorDetail;
        }

        //[rdixit][28.09.2022][GEOS2-3101]
        public List<Discounts> GetDiscounts_V2320(string PCMConnectionString)
        {
            List<Discounts> Discounts = new List<Discounts>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDiscounts_V2320", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.CommandTimeout = 6000;
                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Discounts Discount = new Discounts();
                        try
                        {
                            if (reader["Id"] != DBNull.Value)
                            {
                                Discount.Id = Convert.ToInt32(reader["Id"].ToString());

                                if (reader["Name"] != DBNull.Value)
                                {
                                    Discount.Name = Convert.ToString(reader["Name"]);
                                }
                                if (reader["Name_es"] != DBNull.Value)
                                {
                                    Discount.Name_es = Convert.ToString(reader["Name_es"]);
                                }
                                if (reader["Name_fr"] != DBNull.Value)
                                {
                                    Discount.Name_fr = Convert.ToString(reader["Name_fr"]);
                                }
                                if (reader["Name_pt"] != DBNull.Value)
                                {
                                    Discount.Name_pt = Convert.ToString(reader["Name_pt"]);
                                }
                                if (reader["Name_zh"] != DBNull.Value)
                                {
                                    Discount.Name_zh = Convert.ToString(reader["Name_zh"]);
                                }
                                if (reader["Name_ro"] != DBNull.Value)
                                {
                                    Discount.Name_ro = Convert.ToString(reader["Name_ro"]);
                                }
                                if (reader["Name_ru"] != DBNull.Value)
                                {
                                    Discount.Name_ru = Convert.ToString(reader["Name_ru"]);
                                }
                                if (reader["Description"] != DBNull.Value)
                                {
                                    Discount.Description = Convert.ToString(reader["Description"]);
                                }
                                if (reader["Description_es"] != DBNull.Value)
                                {
                                    Discount.Description_es = Convert.ToString(reader["Description_es"]);
                                }
                                if (reader["Description_fr"] != DBNull.Value)
                                {
                                    Discount.Description_fr = Convert.ToString(reader["Description_fr"]);
                                }
                                if (reader["Description_pt"] != DBNull.Value)
                                {
                                    Discount.Description_pt = Convert.ToString(reader["Description_pt"]);
                                }
                                if (reader["Description_ro"] != DBNull.Value)
                                {
                                    Discount.Description_ro = Convert.ToString(reader["Description_ro"]);
                                }
                                if (reader["Description_zh"] != DBNull.Value)
                                {
                                    Discount.Description_zh = Convert.ToString(reader["Description_zh"]);
                                }
                                if (reader["Description_ru"] != DBNull.Value)
                                {
                                    Discount.Description_ru = Convert.ToString(reader["Description_ru"]);
                                }
                                if (reader["Scope"] != DBNull.Value)
                                {
                                    Discount.Scope = Convert.ToString(reader["Scope"]);
                                }
                                if (reader["Platform"] != DBNull.Value)
                                {
                                    Discount.Platform = Convert.ToString(reader["Platform"]);
                                }
                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    Discount.StartDateNew = Convert.ToDateTime(reader["StartDate"]);
                                }
                                if (reader["ModifiedIn"] != DBNull.Value)
                                {
                                    Discount.LastUpdateNew = Convert.ToDateTime(reader["ModifiedIn"]);
                                }
                                if (reader["Value"] != DBNull.Value)
                                {
                                    Discount.Value = Convert.ToDecimal(reader["Value"]);
                                }
                                if (reader["InUse"] != DBNull.Value)
                                {
                                    int inuse;
                                    inuse = Convert.ToInt32(reader["InUse"]);
                                    if (inuse == 1)
                                        Discount.InUse = "YES";
                                    else
                                        Discount.InUse = "NO";
                                }
                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    DateTime endDate;
                                    endDate = Convert.ToDateTime(reader["EndDate"]);
                                    Discount.EndDateNew = endDate;
                                    if (endDate.Date < DateTime.Now.Date && Discount.InUse.ToUpper() == "YES")
                                        Discount.OverdueEndDate = true;
                                    else
                                        Discount.OverdueEndDate = false;
                                }
                                if (reader["IsReadOnly"] != DBNull.Value)
                                {
                                    int isReadOnly;
                                    isReadOnly = Convert.ToInt32(reader["IsReadOnly"]);
                                    if (isReadOnly == 1)
                                        Discount.IsReadOnly = true;
                                    else
                                        Discount.IsReadOnly = false;
                                }
                                if (reader["CreatedBy"] != DBNull.Value)
                                {
                                    Discount.Creator = Convert.ToString(reader["CreatedBy"]);
                                }
                                if (reader["plants"] != DBNull.Value)
                                {
                                    Discount.Plants = Convert.ToString(reader["plants"]);
                                    if (Discount.Plants != null)
                                    {
                                        if (!(Discount.Plants == "ALL"))
                                        {
                                            string[] plants = Discount.Plants.Split(',');
                                            Discount.Plants = string.Join("\n", plants.Distinct());
                                        }
                                    }
                                }
                                if (reader["Group"] != DBNull.Value)
                                {
                                    Discount.Group = Convert.ToString(reader["Group"]);

                                    if (Discount.Group != null)
                                    {
                                        if (!(Discount.Group == "ALL"))
                                        {
                                            string[] Groups = Discount.Group.Split(',');
                                            Discount.Group = string.Join("\n", Groups.Distinct());
                                        }
                                    }
                                }
                                if (reader["Country"] != DBNull.Value)
                                {
                                    Discount.Country = Convert.ToString(reader["Country"]);
                                    if (Discount.Country != null)
                                    {
                                        if (!(Discount.Country == "ALL"))
                                        {
                                            string[] Countries = Discount.Country.Split(',');
                                            Discount.Country = string.Join("\n", Countries.Distinct());
                                        }
                                    }
                                }
                                if (reader["Region"] != DBNull.Value)
                                {
                                    Discount.Region = Convert.ToString(reader["Region"]);
                                    if (Discount.Region != null)
                                    {
                                        if (!(Discount.Region == "ALL"))
                                        {
                                            string[] Regions = Discount.Region.Split(',');
                                            Discount.Region = string.Join("\n", Regions.Distinct());
                                        }
                                    }
                                }
                                if (reader["Plant"] != DBNull.Value)
                                {
                                    Discount.Plant = Convert.ToString(reader["Plant"]);
                                    if (Discount.Plant != null)
                                    {
                                        if (!(Discount.Plant == "ALL"))
                                        {
                                            string[] Plants = Discount.Plant.Split(',');
                                            Discount.Plant = string.Join("\n", Plants.Distinct());
                                        }
                                    }
                                }
                            }
                            // Discount.DiscountLogEntryList = GetDiscountLogEntriesByDiscountstring(PCMConnectionString, Convert.ToInt32(Discount.Id));
                            Discounts.Add(Discount);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetDiscounts().  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            if (reader["IdCustomerDiscount"] != DBNull.Value)
                            {
                                Discounts DiscountsList = Discounts.Where(i => i.Id == Convert.ToInt32(reader["IdCustomerDiscount"].ToString())).FirstOrDefault();
                                if (DiscountsList != null)
                                {
                                    if (DiscountsList.DiscountArticles == null)
                                        DiscountsList.DiscountArticles = new List<DiscountArticles>();

                                    if (DiscountsList != null)
                                    {
                                        DiscountArticles DiscountArticle = new DiscountArticles();
                                        if (reader["IdCustomerDiscountArticle"] != DBNull.Value)
                                        {
                                            DiscountArticle.IdCustomerDiscountArticle = Convert.ToUInt64(reader["IdCustomerDiscountArticle"].ToString());
                                        }
                                        if (reader["IdCustomerDiscount"] != DBNull.Value)
                                        {
                                            DiscountArticle.IdCustomerDiscount = Convert.ToUInt64(reader["IdCustomerDiscount"].ToString());
                                        }
                                        if (reader["IdArticle"] != DBNull.Value)
                                        {
                                            DiscountArticle.IdArticle = Convert.ToUInt64(reader["IdArticle"].ToString());
                                        }
                                        if (reader["Value"] != DBNull.Value)
                                        {
                                            DiscountArticle.Value = Convert.ToDouble(reader["Value"].ToString());
                                        }
                                        DiscountsList.DiscountArticles.Add(DiscountArticle);
                                    }
                                }
                            }
                        }
                    }
                }
            }

            return Discounts;
        }
        //[rdixit][28.09.2022][GEOS2-3101]
        public Discounts UpdateDiscount(Discounts discount, Discounts prevDiscount, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_EditDiscounts", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                        mySqlCommand.Parameters.AddWithValue("_Name", discount.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", discount.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", discount.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", discount.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", discount.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", discount.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", discount.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", discount.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", discount.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", discount.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", discount.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", discount.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", discount.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", discount.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_StartDate", discount.StartDateNew);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", discount.EndDateNew);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", discount.IdScope);
                        mySqlCommand.Parameters.AddWithValue("_IdPlatform", discount.IdPlatform);
                        mySqlCommand.Parameters.AddWithValue("_Value", discount.Value);
                        if (discount.IsReadOnly == true)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 1);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 0);
                        }
                        if (discount.InUse.ToLower() == "no")
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 0);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 1);
                        }
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", discount.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        discount.Id = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }
                    if (discount.DiscountArticles == null && prevDiscount.DiscountArticles != null)//Scope has been changed from product to order
                    {
                        DeleteDiscountArticles(MainServerConnectionString, prevDiscount.Id, prevDiscount.DiscountArticles);
                    }
                    if (discount.DeletedPlantList != null || discount.AddedPlantList != null)//If some of the Plants are added or deleted
                    {
                        AddDeletePlants_Discounts(MainServerConnectionString, discount);
                    }
                    if (discount.DiscountArticles != null && prevDiscount.DiscountArticles != null)//Scope has NOt been changed from product to order
                    {
                        UpdateDiscountArticles(MainServerConnectionString, discount);
                        foreach (var item in prevDiscount.DiscountArticles)
                        {
                            if (!discount.DiscountArticles.Any(i => i.IdArticle == item.IdArticle))
                            {
                                if (discount.DeletedDiscountArticles == null)
                                    discount.DeletedDiscountArticles = new List<DiscountArticles>();
                                discount.DeletedDiscountArticles.Add(prevDiscount.DiscountArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault());
                            }
                        }
                        if (discount.DeletedDiscountArticles != null)
                            DeleteDiscountArticles(MainServerConnectionString, discount.Id, discount.DeletedDiscountArticles);
                    }
                    if (discount.DiscountArticles != null && prevDiscount.DiscountArticles == null)//Scope has been changed from order to product
                    {
                        AddDiscountArticles(MainServerConnectionString, discount);
                    }
                    if (discount.UpdateDiscountCustomer != null)
                        AddUpdateDeleteCustomersByDicountCustomer(MainServerConnectionString, discount.Id, discount.UpdateDiscountCustomer, discount.IdModifier);


                    if (discount.DiscountLogEntryList != null)
                    {
                        AddDiscountChangeLog(discount, MainServerConnectionString);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDiscount(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return discount;
        }
        //[rdixit][28.09.2022][GEOS2-3101]
        public void AddDeletePlants_Discounts(string MainServerConnectionString, Discounts discount)
        {
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    if (discount.DeletedPlantList != null)
                    {
                        foreach (Site site in discount.DeletedPlantList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_Delete_Discount_Plants", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                    if (discount.AddedPlantList != null)
                    {
                        foreach (Site site in discount.AddedPlantList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_Insert_Discount_Plants", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", discount.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.ExecuteNonQuery();

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeletePlants_Discounts(). IdCustomerDiscount- {0} ErrorMessage- {1}", discount.Id, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        //[rdixit][28.09.2022][GEOS2-3101]
        public void DeleteDiscountArticles(string MainServerConnectionString, int customer_DiscountId, List<DiscountArticles> discountArticles)
        {
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    foreach (DiscountArticles Article in discountArticles)
                    {
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Delete_Discount_articles", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", customer_DiscountId);
                        mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                        mySqlCommand.ExecuteNonQuery();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error Delete_Articles_Discounts(). IdCustomerDiscount- {0} ErrorMessage- {1}", customer_DiscountId, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        //[rdixit][28.09.2022][GEOS2-3101]
        public void UpdateDiscountArticles(string MainServerConnectionString, Discounts discount)
        {
            try
            {
                if (discount.DiscountArticles != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (DiscountArticles DiscountArticles in discount.DiscountArticles)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_EditDiscount_Articles", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", DiscountArticles.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_Value", DiscountArticles.Value);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateDiscountArticles(). IdCustomerDiscount- {0} ErrorMessage- {1}", discount.Id, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<DiscountCustomers> GetDiscountCustomers(string PCMConnectionString, int customer_DiscountId)
        {
            List<DiscountCustomers> DiscountCustomers = new List<DiscountCustomers>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("Get_customer_discount_customers", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", customer_DiscountId);
                mySqlCommand.CommandTimeout = 6000;
                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        DiscountCustomers DiscountCustomer = new DiscountCustomers();
                        try
                        {
                            if (reader["IdCustomerDiscountCustomer"] != DBNull.Value)
                            {
                                DiscountCustomer.IdCustomerDiscountCustomer = Convert.ToUInt32(reader["IdCustomerDiscountCustomer"].ToString());

                                if (reader["IdGroup"] != DBNull.Value)
                                {
                                    DiscountCustomer.IdGroup = Convert.ToUInt32(reader["IdGroup"].ToString());
                                }
                                if (reader["IdRegion"] != DBNull.Value)
                                {
                                    DiscountCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"].ToString());
                                }
                                if (reader["IdCountry"] != DBNull.Value)
                                {
                                    DiscountCustomer.IdCountry = Convert.ToUInt32(reader["IdCountry"].ToString());
                                }
                                if (reader["IdSite"] != DBNull.Value)
                                {
                                    DiscountCustomer.IdPlant = Convert.ToUInt32(reader["IdSite"].ToString());
                                }
                                if (reader["CreatedIn"] != DBNull.Value)
                                {
                                    DiscountCustomer.CreationDate = Convert.ToDateTime(reader["CreatedIn"].ToString());
                                }
                                if (reader["CreatedBy"] != DBNull.Value)
                                {
                                    DiscountCustomer.IdCreator = Convert.ToUInt32(reader["CreatedBy"].ToString());
                                }
                                if (reader["ModifiedIn"] != DBNull.Value)
                                {
                                    DiscountCustomer.ModificationDate = Convert.ToDateTime(reader["ModifiedIn"].ToString());
                                }
                                if (reader["ModifiedBy"] != DBNull.Value)
                                {
                                    DiscountCustomer.IdModifier = Convert.ToUInt32(reader["ModifiedBy"].ToString());
                                }
                                if (reader["Group"] != DBNull.Value)
                                {
                                    DiscountCustomer.GroupName = Convert.ToString(reader["Group"].ToString());
                                }
                                if (reader["Country"] != DBNull.Value)
                                {
                                    if (DiscountCustomer.Country == null)
                                        DiscountCustomer.Country = new Country();
                                    DiscountCustomer.Country.Name = Convert.ToString(reader["Country"].ToString());
                                }
                                if (reader["Region"] != DBNull.Value)
                                {
                                    DiscountCustomer.RegionName = Convert.ToString(reader["Region"].ToString());
                                }
                                if (reader["Plant"] != DBNull.Value)
                                {
                                    if (DiscountCustomer.Plant == null)
                                        DiscountCustomer.Plant = new Site();
                                    DiscountCustomer.Plant.Name = Convert.ToString(reader["Plant"].ToString());
                                }
                            }
                            // DiscountCustomer.DiscountLogEntryList = GetDiscountLogEntriesByDiscountstring(PCMConnectionString, IdCustomerDiscount);
                            DiscountCustomers.Add(DiscountCustomer);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetDiscountCustomers().  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return DiscountCustomers;
        }

        //[GEOS2-3102][03.10.2022][rdixit]
        public void AddCustomersByCustomerDiscount(string MainServerConnectionString, int customer_DiscountId, List<DiscountCustomers> CustomerList, uint IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DiscountCustomers Customer in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CustomerDiscountListCustomers_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", customer_DiscountId);
                            if (Customer.IdGroup == 0)
                            {
                                Customer.IdGroup = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            Customer.IdCustomerDiscountCustomer = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersByCustomerDiscount(). IdCustomerDiscount- {0} ErrorMessage- {1}", customer_DiscountId, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        //[GEOS2-3102][03.10.2022][rdixit]
        public void AddUpdateDeleteCustomersByDicountCustomer(string MainServerConnectionString, int customer_DiscountId, List<DiscountCustomers> CustomerList, uint? IdModifier)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DiscountCustomers Customer in CustomerList)
                        {
                            if (Customer.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CustomerDiscountListCustomers_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscountCustomer", Customer.IdCustomerDiscountCustomer);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", customer_DiscountId);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (Customer.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (Customer.IdCustomerDiscountCustomer > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CustomerDiscountListCustomers_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscountCustomer", Customer.IdCustomerDiscountCustomer);
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", customer_DiscountId);
                                    if (Customer.IdGroup == 0)
                                    {
                                        Customer.IdGroup = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (Customer.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CustomerDiscountListCustomers_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", customer_DiscountId);
                                if (Customer.IdGroup == 0)
                                {
                                    Customer.IdGroup = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                Customer.IdCustomerDiscountCustomer = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCustomersByDicountCustomer(). IdCustomerDiscount- {0} ErrorMessage- {1}", customer_DiscountId, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[GEOS2-3103][04.10.2022][pjadhav]
        public List<DiscountLogEntry> GetDiscountLogEntriesByDiscountstring(string PCMConnectionString, int IdCustomerDiscount)
        {
            List<DiscountLogEntry> DiscountLogEntries = new List<DiscountLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByDiscount", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", IdCustomerDiscount);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DiscountLogEntry DiscountLogEntry = new DiscountLogEntry();

                            DiscountLogEntry.IdLogEntryByDiscount = Convert.ToUInt32(reader["IdLogEntryByDiscount"]);

                            DiscountLogEntry.IdCustomerDiscount = Convert.ToUInt64(reader["IdCustomerDiscount"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                DiscountLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                DiscountLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                DiscountLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                DiscountLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            DiscountLogEntries.Add(DiscountLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeLogEntriesByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DiscountLogEntries;
        }

        public void AddDiscountChangeLog(Discounts discount, string MainServerConnectionString)
        {

            try
            {

                if (discount.DiscountLogEntryList != null)
                {
                    foreach (DiscountLogEntry DiscountLogEntry in discount.DiscountLogEntryList)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByDiscount_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", DiscountLogEntry.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", DiscountLogEntry.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", DiscountLogEntry.Comments);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDiscountChangeLog(). IdCustomerDiscount- {0} ErrorMessage- {1}", discount.Id, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }

        //[pjadhav][31.10.2022][GEOS2-3956]
        public DetectionDetails AddDetection_V2330(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2330", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (detectionDetails.IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", null);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2330(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }

        //[pjadhav][31.10.2022][GEOS2-3956]

        public bool UpdateDetection_V2330(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2330", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    //
                    AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.ModifiedBy);
                    AddBasePriceListLogEntry(MainServerConnectionString, detectionDetails.BasePriceLogEntryList);
                    AddCustomerPriceListLogEntry(MainServerConnectionString, detectionDetails.CustomerPriceLogEntryList);
                    //
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection_V2330(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        //[pjadhav][31.10.2022][GEOS2-3956]

        public List<DetectionDetails> GetAllDetectionsWaysOptionsSpareParts_V2330(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllDetections_V2330", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }

                            if (DetectionDetailReader["IdScope"] != DBNull.Value)
                            {
                                detectionDetails.IdScope = Convert.ToUInt64(DetectionDetailReader["IdScope"]);
                                detectionDetails.Scope = new LookupValue();
                                detectionDetails.Scope.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdScope"]);
                                if (DetectionDetailReader["Name"] != DBNull.Value)
                                {
                                    detectionDetails.Scope.Value = Convert.ToString(DetectionDetailReader["Name"]);
                                }
                            }

                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionsWaysOptionsSpareParts_V2330().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }


        public DetectionDetails GetDetectionByIdDetection_V2330(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath, string currencyIconFilePath, int IdUser)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2330", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);


                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }
                            if (DetectionDetailReader["IdScope"] != DBNull.Value)
                            {
                                detectionDetails.IdScope = Convert.ToUInt32(DetectionDetailReader["IdScope"]);
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.IncludedPLMDetectionList = GetIncludedPLMDetectionPrices_V2250(PCMConnectionString, detectionDetails.IdDetections, currencyIconFilePath, IdUser);

                string IdBasePriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                detectionDetails.NotIncludedPLMDetectionList = GetNotIncludedPLMDetectionPrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                    detectionDetails.IdDetections, IdUser);

                // detectionDetails.UpdateAllMaxCostFromNullToZero();
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2330(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }

        public List<DetectionDetails> GetAllModuleDetectionsWaysOptionsSpareParts_V2330(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllModuleDetections_V2330", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2330().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }


        public List<DetectionDetails> GetAllStructureDetectionsWaysOptionsSpareParts_V2330(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllStructureDetections_V2330", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllStructureDetectionsWaysOptionsSpareParts_V2330().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        //[pjadhav][24.11.2022][GEOS2-3970]
        public bool IsUpdatePCM_DetectionECOSVisibility_Update_V2340(string MainServerConnectionString, DetectionDetails detectionDetails)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (detectionDetails.IdDetections >= 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionECOSVisibility_Update__V2340", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                            mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                            mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description.Trim());
                            mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                            mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                            mySqlCommand.ExecuteNonQuery();
                            mySqlConnection.Close();

                            isUpdated = true;
                        }
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_DetectionECOSVisibility_Update_V2340(). IdArticle- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[rdixit][GEOS2-3970][01.12.2022] 
        public List<DetectionDetails> GetAllModuleDetectionsWaysOptionsSpareParts_V2340(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllModuleDetections_V2330", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            if (detectionDetails.DetectionAllGroupList == null)
                                detectionDetails.DetectionAllGroupList = new List<DetectionGroup>();
                            detectionDetails.DetectionAllGroupList = GetDetectionAllGroupsList(PCMConnectionString);
                            if (detectionDetails.DetectionAllGroupList != null && detectionDetails.IdDetectionType != 0)
                            {
                                if (detectionDetails.DetectionGroupList == null)
                                    detectionDetails.DetectionGroupList = new List<DetectionGroup>();
                                detectionDetails.DetectionGroupList = detectionDetails.DetectionAllGroupList.Where(i => i.IdDetectionType == detectionDetails.IdDetectionType).ToList();
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2340().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        //[rdixit][GEOS2-3970][01.12.2022] 
        public List<DetectionDetails> GetAllStructureDetectionsWaysOptionsSpareParts_V2340(string PCMConnectionString)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllStructureDetections_V2330", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            if (detectionDetails.DetectionAllGroupList == null)
                                detectionDetails.DetectionAllGroupList = new List<DetectionGroup>();
                            detectionDetails.DetectionAllGroupList = GetDetectionAllGroupsList(PCMConnectionString);
                            if (detectionDetails.DetectionAllGroupList != null && detectionDetails.IdDetectionType != 0)
                            {
                                if (detectionDetails.DetectionGroupList == null)
                                    detectionDetails.DetectionGroupList = new List<DetectionGroup>();
                                detectionDetails.DetectionGroupList = detectionDetails.DetectionAllGroupList.Where(i => i.IdDetectionType == detectionDetails.IdDetectionType).ToList();
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllStructureDetectionsWaysOptionsSpareParts_V2340().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        //[rdixit][GEOS2-3970][01.12.2022] 
        public List<DetectionGroup> GetDetectionAllGroupsList(string PCMConnectionString)
        {
            List<DetectionGroup> DetectionGroups = new List<DetectionGroup>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetDetectionGroups", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionGroup DetectionGroup = new DetectionGroup();

                            DetectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            DetectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                DetectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["OriginalName"] != DBNull.Value)
                            {
                                DetectionGroup.OriginalName = Convert.ToString(reader["OriginalName"]);
                            }
                            DetectionGroups.Add(DetectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionAllGroupsList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionGroups;
        }


        //[pjadhav][31.10.2022][GEOS2-3956]

        public bool UpdateDetection_V2340(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2340", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    //AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionFiles_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);//[GEOS2-4074][12.12.2022][rdixit]
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    //
                    AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.ModifiedBy);
                    AddBasePriceListLogEntry(MainServerConnectionString, detectionDetails.BasePriceLogEntryList);
                    AddCustomerPriceListLogEntry(MainServerConnectionString, detectionDetails.CustomerPriceLogEntryList);
                    //
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection_V2330(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public DetectionDetails GetDetectionByIdDetection_V2340(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath, string currencyIconFilePath, int IdUser)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2330", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);


                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }
                            if (DetectionDetailReader["IdScope"] != DBNull.Value)
                            {
                                detectionDetails.IdScope = Convert.ToUInt32(DetectionDetailReader["IdScope"]);
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection_V2340(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);//[rdixit][GEOS2-4074][12.12.2022]
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection_V2340(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                detectionDetails.IncludedPLMDetectionList = GetIncludedPLMDetectionPrices_V2250(PCMConnectionString, detectionDetails.IdDetections, currencyIconFilePath, IdUser);

                string IdBasePriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                detectionDetails.NotIncludedPLMDetectionList = GetNotIncludedPLMDetectionPrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                    detectionDetails.IdDetections, IdUser);

                // detectionDetails.UpdateAllMaxCostFromNullToZero();
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2340(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }


        /// <summary>
        /// This method is used to get log entries by detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get detection id</param>
        /// <param name="IdDetectionType">Get detection type id</param>
        /// <returns>The list of log by detection.</returns>
        public List<DetectionLogEntry> GetDetectionLogEntriesByDetection_V2340(string PCMConnectionString, UInt32 IdDetection, UInt32 IdDetectionType)
        {
            List<DetectionLogEntry> detectionLogEntryList = new List<DetectionLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByIdDetection_V2340", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionLogEntry detectionLogEntry = new DetectionLogEntry();

                            detectionLogEntry.IdLogEntryByDetection = Convert.ToUInt32(reader["IdLogEntryByDetection"]);

                            detectionLogEntry.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            detectionLogEntry.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                detectionLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                detectionLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                detectionLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                detectionLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            detectionLogEntryList.Add(detectionLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionLogEntriesByDetection_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionLogEntryList;
        }

        //[rdixit][GEOS2-4074][12.12.2022]
        public List<DetectionAttachedDoc> GetDetectionAttachedDocsByIdDetection_V2340(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath)
        {
            List<DetectionAttachedDoc> DetectionAttachedDocs = new List<DetectionAttachedDoc>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionAttachedDocsByIdDetection_V2340", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionAttachedDoc DetectionAttachedDoc = new DetectionAttachedDoc();

                            DetectionAttachedDoc.IdDetectionAttachedDoc = Convert.ToUInt32(reader["IdDetectionAttachedDoc"]);
                            DetectionAttachedDoc.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["IdDocType"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.IdDocType = Convert.ToUInt32(reader["IdDocType"]);
                                DetectionAttachedDoc.DocumentType = new DocumentType();
                                DetectionAttachedDoc.DocumentType.IdDocumentType = Convert.ToByte(reader["IdDocType"]);
                                if (reader["DocumentType"] != DBNull.Value)
                                {
                                    DetectionAttachedDoc.DocumentType.Name = Convert.ToString(reader["DocumentType"]);
                                }
                            }
                            if (reader["IdAttachmentType"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.AttachmentType = new LookupValue();
                                DetectionAttachedDoc.AttachmentType.IdLookupValue = Convert.ToInt32(reader["IdAttachmentType"]);
                                if (reader["AttachmentType"] != DBNull.Value)
                                {
                                    DetectionAttachedDoc.AttachmentType.Value = Convert.ToString(reader["AttachmentType"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                DetectionAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            DetectionAttachedDoc.DetectionAttachedDocInBytes = GetDetectionAttachedDoc(Convert.ToString(DetectionAttachedDoc.IdDetectionAttachedDoc), DetectionAttachedDocPath, DetectionAttachedDoc.SavedFileName);
                            DetectionAttachedDocs.Add(DetectionAttachedDoc);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionAttachedDocsByIdDetection_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionAttachedDocs;
        }

        //[rdixit][GEOS2-4074][12.12.2022]
        public void AddUpdateDeleteDetectionFiles_V2340(string MainServerConnectionString, UInt32 IdDetection, List<DetectionAttachedDoc> DetectionAttachedDocList, string DetectionAttachedDocPath)
        {
            try
            {
                if (DetectionAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionAttachedDoc detectionAttachedDocList in DetectionAttachedDocList)
                        {
                            if (detectionAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedDoc", detectionAttachedDocList.IdDetectionAttachedDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteDetectionAttachedDocFromPath(detectionAttachedDocList, DetectionAttachedDocPath);
                            }
                            else if (detectionAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (detectionAttachedDocList.IdDetectionAttachedDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Update_V2340", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdDetectionAttachedDoc", detectionAttachedDocList.IdDetectionAttachedDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionAttachedDocList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedDocList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionAttachedDocList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionAttachedDocList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_IdDocType", detectionAttachedDocList.IdDocType);
                                    mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", detectionAttachedDocList.AttachmentType.IdLookupValue);
                                    mySqlCommand.ExecuteNonQuery();

                                    AddDetectionAttachedDocToPath(detectionAttachedDocList, DetectionAttachedDocPath);
                                }
                            }
                            else if (detectionAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Insert_V2340", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionAttachedDocList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedDocList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionAttachedDocList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionAttachedDocList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_IdDocType", detectionAttachedDocList.IdDocType);
                                mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", detectionAttachedDocList.AttachmentType.IdLookupValue);

                                detectionAttachedDocList.IdDetectionAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (detectionAttachedDocList.IdDetectionAttachedDoc > 0)
                                {
                                    AddDetectionAttachedDocToPath(detectionAttachedDocList, DetectionAttachedDocPath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionFiles_V2340(). IdCatalogueItem- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[rdixit][GEOS2-4074][12.12.2022]
        public DetectionDetails AddDetection_V2340(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2330", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (detectionDetails.IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", null);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }

        //[rdixit][GEOS2-4074][12.12.2022]
        public void AddDetectionAttachedDocByDetection_V2340(string MainServerConnectionString, UInt32 IdDetection, List<DetectionAttachedDoc> DetectionAttachedDocList, string DetectionAttachedDocPath)
        {
            try
            {
                if (DetectionAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionAttachedDoc detectionAttachedDocList in DetectionAttachedDocList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionAttachedDocs_Insert_V2340", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", detectionAttachedDocList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", detectionAttachedDocList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", detectionAttachedDocList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", detectionAttachedDocList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IdDocType", detectionAttachedDocList.IdDocType);
                            mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", detectionAttachedDocList.AttachmentType.IdLookupValue);

                            detectionAttachedDocList.IdDetectionAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                            if (detectionAttachedDocList.IdDetectionAttachedDoc > 0)
                            {
                                AddDetectionAttachedDocToPath(detectionAttachedDocList, DetectionAttachedDocPath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionAttachedDocByDetection_V2340(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[Sudhir.Jangra][09/12/2022][GEOS2-4072]
        /// <summary>
        /// This method is used to insert Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType_V2340(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2280(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        //[Sudhir.Jangra][GEOS2-4072][09/12/2022]

        /// <summary>
        /// This method is used to insert product type Attached Doc
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="productTypeAttachedDoc">Get product Type Attached Doc details.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type Attached Doc Path.</param>
        public void AddProductTypeAttachedDocByProductType_V2340(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeAttachedDoc> ProductTypeAttachedDocList, string ProductTypeAttachedDocPath)
        {
            try
            {
                if (ProductTypeAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedDoc productTypeAttachedDocList in ProductTypeAttachedDocList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Insert_V2340", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", productTypeAttachedDocList.AttachmentType.IdLookupValue);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedDocList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            //mySqlCommand.Parameters.AddWithValue("_DocumentType", productTypeAttachedDocList.AttachmentType.Value);
                            // mySqlCommand.Parameters.AddWithValue("_IdDocType", productTypeAttachedDocList.IdDocType);
                            productTypeAttachedDocList.IdCPTypeAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                            if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                            {
                                AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeAttachedDocByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[Sudhir.Jangra][GEOS2-4072][09/12/2022]
        /// <summary>
        /// This method is used to update Product Type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2340(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2280(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[Sudhir.Jangra][GEOS2-4072][09/12/2022]

        /// <summary>
        /// This method is used to Add/Update/Delete product type Files
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeAttachedDocList">The list of files.</param>
        public void AddUpdateDeleteProductTypeFiles_V2340(string MainServerConnectionString, UInt64 IdCpType, List<ProductTypeAttachedDoc> ProductTypeAttachedDocList, string ProductTypeAttachedDocPath)
        {
            try
            {
                if (ProductTypeAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedDoc productTypeAttachedDocList in ProductTypeAttachedDocList)
                        {
                            if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Delete_V2340", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDocList.IdCPTypeAttachedDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteProductTypeAttachedDocFromPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                            }
                            else if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Update_V2340", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDocList.IdCPTypeAttachedDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", productTypeAttachedDocList.AttachmentType.IdLookupValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeAttachedDocList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));


                                    mySqlCommand.ExecuteNonQuery();

                                    AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                                }
                            }
                            else if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Insert_V2340", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", productTypeAttachedDocList.AttachmentType.IdLookupValue);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedDocList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                productTypeAttachedDocList.IdCPTypeAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                                {
                                    AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeFiles_V2340(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        //[Sudhir.Jangra][GEOS2-4072][13/12/2022]
        /// <summary>
        /// This method is used to get Product Type Attached Docs by id product type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductType">Get product type Attached Doc id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type attached doc path.</param>
        /// <returns>The list of Product Type Attached Doc by id product type.</returns>
        public List<ProductTypeAttachedDoc> GetProductTypeAttachedDocsByIdProductType_V2340(string PCMConnectionString, UInt64 IdProductType, string ProductTypeAttachedDocPath)
        {
            List<ProductTypeAttachedDoc> ProductTypeAttachedDocs = new List<ProductTypeAttachedDoc>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeAttachedDocsByIdCPType_V2340", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdProductType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeAttachedDoc ProductTypeAttachedDoc = new ProductTypeAttachedDoc();

                            ProductTypeAttachedDoc.IdCPTypeAttachedDoc = Convert.ToUInt32(reader["IdCPTypeAttachedDoc"]);
                            ProductTypeAttachedDoc.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["IdAttachmentType"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.AttachmentType = new LookupValue();
                                ProductTypeAttachedDoc.AttachmentType.IdLookupValue = Convert.ToInt32(reader["IdAttachmentType"]);
                                if (reader["AttachmentTypeValue"] != DBNull.Value)
                                {
                                    ProductTypeAttachedDoc.AttachmentType.Value = Convert.ToString(reader["AttachmentTypeValue"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            ProductTypeAttachedDoc.ProductTypeAttachedDocInBytes = GetProductTypeAttachedDoc(Convert.ToString(ProductTypeAttachedDoc.IdCPTypeAttachedDoc), ProductTypeAttachedDocPath, ProductTypeAttachedDoc.SavedFileName);
                            ProductTypeAttachedDocs.Add(ProductTypeAttachedDoc);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedDocsByIdProductType_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeAttachedDocs;
        }



        #region GEOS2-2596
        // GEOS2-2596 Add option in PCM to print a datasheet of a Module [1 of 3] 06 01 2023

        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType_V2350(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType_V2350(PCMConnectionString, productTypes.IdCPType);
                // productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.WayList = GetWaysByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType_V2350(PCMConnectionString, productTypes.IdCPType);
                // productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.jangra][GEOS2-4072][13/12/2022]
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType(PCMConnectionString, productTypes.IdCPType);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2350(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        /// <summary>
        /// This method is used to get all templates by product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of templates by product Type.</returns>
        public List<Template> GetTemplatesByProductType_V2350(string PCMConnectionString, UInt64 IdCPType)
        {
            List<Template> templates = new List<Template>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetTemplatesByProductType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Template template = new Template();
                            template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                template.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                template.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                template.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                template.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                template.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                template.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                template.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                template.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                template.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                template.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                template.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                template.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                template.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                template.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            templates.Add(template);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetTemplatesByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return templates;
        }

        /// <summary>
        /// This method is used to get ways
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of ways.</returns>
        public List<Ways> GetWaysByCpType_V2350(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                Way.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                Way.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                Way.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                Way.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                Way.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                Way.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                Way.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                Way.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                Way.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                Way.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                Way.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                Way.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                Way.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                Way.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Way.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Way.OrderNumber = Convert.ToUInt32(reader["OrderNumber"]);
                            }
                            Ways.Add(Way);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWaysByCpType_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }

        /// <summary>
        /// This method is used to get Families by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Families by Product Type.</returns>
        public List<ConnectorFamilies> GetFamiliesByProductType_V2350(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ConnectorFamilies> ConnectorFamilies = new List<ConnectorFamilies>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFamiliesByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ConnectorFamilies ConnectorFamily = new ConnectorFamilies();
                            ConnectorFamily.IdFamily = Convert.ToUInt64(reader["IdFamily"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                ConnectorFamily.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ConnectorFamily.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            ConnectorFamilies.Add(ConnectorFamily);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetFamiliesByProductType_V2350(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ConnectorFamilies;
        }

        /// <summary>
        /// This method is used to get Detection order Groups with detections by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions by cptype.</returns>
        public List<Detections> GetDetectionsWithGroupsByCpType_V2350(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                detectionGroups = GetDetectionGroupsByCPType(PCMConnectionString, 2, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                detectionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                detectionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                detectionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                detectionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                detectionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                detectionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detectionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                detectionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                detectionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                detectionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                detectionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                detectionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                detectionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                detectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<Options> GetOptionsWithGroupsByCpType_V2350(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                OptionGroups = GetOptionGroupsByCPType(PCMConnectionString, 3, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                OptionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                OptionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                OptionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                OptionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                OptionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                OptionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                OptionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                OptionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                OptionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                OptionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                OptionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                OptionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                OptionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                OptionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            OptionGroups.Add(OptionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }


        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<SpareParts> GetSparePartsWithGroupsByCpType_V2350(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SparePartGroups = new List<SpareParts>();
            try
            {
                SparePartGroups = GetSparePartsGroupsByCPType(PCMConnectionString, 4, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePartGroup = new SpareParts();

                            SparePartGroup.Key = Convert.ToString(reader["IdDetection"]);

                            SparePartGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                SparePartGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePartGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                SparePartGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                SparePartGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                SparePartGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                SparePartGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePartGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePartGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SparePartGroups.Add(SparePartGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SparePartGroups;
        }

        public List<DetectiontypesInformations> GetDetectionTypes(string PCMConnectionString)
        {
            List<DetectiontypesInformations> DetectiontypesInformations = new List<Common.PCM.DetectiontypesInformations>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllDetectionTypes_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectiontypesInformations detectiontypes = new DetectiontypesInformations();
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectiontypes.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                detectiontypes.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                detectiontypes.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                detectiontypes.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                detectiontypes.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                detectiontypes.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                detectiontypes.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                detectiontypes.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            DetectiontypesInformations.Add(detectiontypes);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionTypes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return DetectiontypesInformations;
        }
        #endregion

        //[pjadhav][GEOS2-4015][10-01-2023]

        public List<ArticleCustomer> GetCustomersByIdArticleCustomerReferences(string PLMConnectionString, UInt64 IdArticle, string CompanyIconFilePath)
        {
            List<ArticleCustomer> ArticleCustomerList = new List<ArticleCustomer>();
            List<string> countryISOs = new List<string>();
            Dictionary<string, byte[]> DictCompanies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersByIdArticleCustomerReferences", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCustomer ArticleCustomer = new ArticleCustomer();

                            if (reader["IdArticleCustomerReferences"] != DBNull.Value)
                            {
                                ArticleCustomer.IdArticleCustomerReferences = Convert.ToInt32(reader["IdArticleCustomerReferences"]);
                            }
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                ArticleCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                                if (reader["RegionName"] != DBNull.Value)
                                {
                                    ArticleCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                                }
                            }
                            else
                            {
                                ArticleCustomer.RegionName = "ALL";
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                ArticleCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                                if (reader["CustomerName"] != DBNull.Value)
                                {
                                    ArticleCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                                }
                            }
                            else
                            {
                                ArticleCustomer.GroupName = "ALL";
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                ArticleCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdSite"] != DBNull.Value)
                            {
                                ArticleCustomer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                ArticleCustomer.Plant = new Site();
                                ArticleCustomer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    ArticleCustomer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                ArticleCustomer.Plant = new Site();
                                ArticleCustomer.Plant.Name = "ALL";
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                ArticleCustomer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                ArticleCustomer.Country = new Country();
                                ArticleCustomer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    ArticleCustomer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                ArticleCustomer.Country = new Country();
                                ArticleCustomer.Country.Name = "ALL";
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                ArticleCustomer.IdArticleList = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["CustomerRefernce"] != DBNull.Value)
                            {
                                ArticleCustomer.ReferenceCustomer = Convert.ToString(reader["CustomerRefernce"]);
                            }
                            if (reader["CountryISO2"] != DBNull.Value)
                            {
                                ArticleCustomer.Iso = Convert.ToString(reader["CountryISO2"]);
                                if (!countryISOs.Any(co => co.ToString() == ArticleCustomer.Iso))
                                {
                                    countryISOs.Add(ArticleCustomer.Iso);
                                }
                            }

                            ArticleCustomerList.Add(ArticleCustomer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCPLCustomersByIdCustomerPriceList_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                if (DictCompanies.Any(i => i.Key == item))
                {
                    bytes = DictCompanies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetEnumeratedImageInBytes(item, CompanyIconFilePath);
                    DictCompanies.Add(item, bytes);
                }
                ArticleCustomerList.Where(ma => ma.Iso == item).ToList().ForEach(ma => ma.CountryIconBytes = bytes);
            }

            return ArticleCustomerList;
        }

        public List<ArticleSuppliers> GetArticleSuppliers(string PLMConnectionString, UInt64 IdArticle)
        {
            List<ArticleSuppliers> ArticleSuppliersList = new List<ArticleSuppliers>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSupplier", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            ArticleSuppliers ArticleSupplier = new ArticleSuppliers();
                            if (reader["idArticle"] != DBNull.Value)
                            {
                                ArticleSupplier.IdArticleList = Convert.ToUInt32(reader["idArticle"]);

                            }
                            if (reader["IdEnterpriseGroup"] != DBNull.Value)
                            {
                                ArticleSupplier.IdGroup = Convert.ToUInt32(reader["IdEnterpriseGroup"]);
                                ArticleSupplier.GroupName = Convert.ToString(reader["Name"]);

                            }
                            if (reader["Reference"] != DBNull.Value)
                            {
                                ArticleSupplier.Reference = Convert.ToString(reader["Reference"]);

                            }
                            ArticleSuppliersList.Add(ArticleSupplier);
                        }
                    }
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliers(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }


            return ArticleSuppliersList;
        }

        public Articles GetArticleByIdArticle_V2350(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath, string currencyIconFilePath, string countryImagePath, int IdUser)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2250(PCMConnectionString, IdArticle, currencyIconFilePath, IdUser);
                article.ArticleDecompostionList = GetArticleDeCompostionByIdArticle(PCMConnectionString, IdArticle);
                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle, IdUser);
                article.ArticleCustomerList = GetCustomersByIdArticleCustomerReferences(PCMConnectionString, IdArticle, countryImagePath);
                article.ArticleSuppliersList = GetArticleSuppliers(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2290(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }


        private byte[] GetEnumeratedImageInBytes(string LoginName, string filePath)
        {
            byte[] bytes = null;
            string fileUploadPath = "";

            if (File.Exists(filePath + LoginName + ".png"))
            {
                fileUploadPath = filePath + LoginName + ".png";
            }
            else if (File.Exists(filePath + LoginName))
            {
                fileUploadPath = filePath + LoginName;
            }
            else
            {
                fileUploadPath = filePath + LoginName + ".jpg";
            }
            if (File.Exists(fileUploadPath))
            {
                using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                {
                    bytes = new byte[stream.Length];
                    int numBytesToRead = (int)stream.Length;
                    int numBytesRead = 0;
                    while (numBytesToRead > 0)
                    {
                        // Read may return anything from 0 to numBytesToRead.
                        int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                        // Break when the end of the file is reached.
                        if (n == 0)
                            break;

                        numBytesRead += n;
                        numBytesToRead -= n;
                    }
                }

                return bytes;
            }
            else
            {
                return null;
            }
        }

        public List<ArticleCustomer> GetArticleCustomers(string PCMConnectionString, string CompanyIconFilePath)
        {
            Dictionary<string, byte[]> DictCompanies = new Dictionary<string, byte[]>();
            List<string> countryISOs = new List<string>();
            List<ArticleCustomer> ArticleCustomerList = new List<ArticleCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersByArticle", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCustomer ArticleCustomer = new ArticleCustomer();

                            ArticleCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            ArticleCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);

                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                ArticleCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                ArticleCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                ArticleCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdSite"] != DBNull.Value)
                            {
                                ArticleCustomer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                ArticleCustomer.Plant = new Site();
                                ArticleCustomer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    ArticleCustomer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }

                            if (reader["idCountry"] != DBNull.Value)
                            {
                                ArticleCustomer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                ArticleCustomer.Country = new Country();
                                ArticleCustomer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    ArticleCustomer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                                if (reader["iso"] != DBNull.Value)
                                {
                                    ArticleCustomer.Iso = Convert.ToString(reader["iso"]);
                                    if (!countryISOs.Any(co => co.ToString() == ArticleCustomer.Iso))
                                    {
                                        countryISOs.Add(ArticleCustomer.Iso);
                                    }
                                }
                            }
                            ArticleCustomerList.Add(ArticleCustomer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCustomers(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                if (DictCompanies.Any(i => i.Key == item))
                {
                    bytes = DictCompanies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetEnumeratedImageInBytes(item, CompanyIconFilePath);
                    DictCompanies.Add(item, bytes);
                }
                ArticleCustomerList.Where(ma => ma.Iso == item).ToList().ForEach(ma => ma.CountryIconBytes = bytes);
            }

            return ArticleCustomerList;
        }

        public bool IsUpdatePCMArticle_V2350(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath, string PCMArticleDocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_PCMArticle_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                            mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                            mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_es", Article.PCMDescription_es);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_fr", Article.PCMDescription_fr);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ro", Article.PCMDescription_ro);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_zh", Article.PCMDescription_zh);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_pt", Article.PCMDescription_pt);
                            mySqlCommand.Parameters.AddWithValue("_PCMDescription_ru", Article.PCMDescription_ru);

                            mySqlCommand.ExecuteNonQuery();

                            isUpdated = true;
                        }

                        AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                        AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                        AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                        AddUpdateDeletePCMArticleDocs(MainServerConnectionString, Article.IdArticle, Article.PCMArticleAttachmentList, PCMArticleDocPath, Article.Reference);
                        AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);
                        UpdateWarehouseArticle_V2260(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticle, Article.IdModifier);
                        AddUpdateDeletePLMArticlePrices(MainServerConnectionString, Article.ModifiedPLMArticleList, Article.IdArticle, Article.IdModifier);
                        AddBasePriceListLogEntry(MainServerConnectionString, Article.BasePriceLogEntryList);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, Article.CustomerPriceLogEntryList);
                        AddArticlesByCustomer_V2350(MainServerConnectionString, Article.IdCreator, Article.IdArticle, Article.ArticleCustomerList, Article.IdModifier);
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticle_V2260(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddArticlesByCustomer_V2350(string MainServerConnectionString, UInt32 IdCreator, UInt64 IdArticle, List<ArticleCustomer> ArticleList, uint? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (ArticleCustomer Article in ArticleList)
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_idArticle_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticleCustomerReferences", Article.IdArticleCustomerReferences);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (Article.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_idArticle_Insert_V2350", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                if (Article.IdGroup > 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", Article.IdGroup);

                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                if (Article.IdCountry > 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", Article.IdCountry);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", null);
                                }
                                //  mySqlCommand.Parameters.AddWithValue("_IdCustomer", Article.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", Article.IdRegion);
                                //  mySqlCommand.Parameters.AddWithValue("_IdCountry", Article.IdCountry);


                                mySqlCommand.Parameters.AddWithValue("_IdSite", Article.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Reference", Article.ReferenceCustomer.Trim());
                                //mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (Article.IdArticleList > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_idArticle_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdArticleCustomerReferences", Article.IdArticleCustomerReferences);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                                    if (Article.IdGroup > 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", Article.IdGroup);

                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                    }
                                    if (Article.IdCountry > 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCountry", Article.IdCountry);
                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCountry", null);
                                    }
                                    // mySqlCommand.Parameters.AddWithValue("_IdCustomer", Article.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", Article.IdRegion);
                                    //  mySqlCommand.Parameters.AddWithValue("_IdCountry", Article.IdCountry);


                                    mySqlCommand.Parameters.AddWithValue("_IdSite", Article.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_Reference", Article.ReferenceCustomer.Trim());
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByCustomer_V2350(). IdBasePriceList- {0} ErrorMessage- {1}", IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        //[sdeshpande][GEOS2-3759]
        public List<ProductTypes> GetAllProductTypes_V2360(string PCMConnectionString)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes_V2270", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }

                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    cpType.Status.HtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                cpType.Code = Convert.ToString(reader["Code"]);
                            }
                            cpType.WayList = GetWayListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.DetectionList = GetDetectionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.OptionList = GetOptionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.SparePartList = GetSparePartListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes_V2360(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }

        #region GEOS2-4091
        //Shubham[skadam] GEOS2-4091 Add option in PCM to print a datasheet of a Module [2 of 3]  06 02 2023
        public DetectionDetails GetDetectionByIdDetection_V2360(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath, string currencyIconFilePath, int IdUser)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2360", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);


                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }
                            if (DetectionDetailReader["IdScope"] != DBNull.Value)
                            {
                                detectionDetails.IdScope = Convert.ToUInt32(DetectionDetailReader["IdScope"]);
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection_V2340(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);//[rdixit][GEOS2-4074][12.12.2022]
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection_V2340(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                #region MyRegion
                try
                {
                    //detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                    detectionDetails.ProductTypesList = GetProductTypesByDetection_V2360(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                }
                catch (Exception ex) { }
                #endregion

                detectionDetails.IncludedPLMDetectionList = GetIncludedPLMDetectionPrices_V2250(PCMConnectionString, detectionDetails.IdDetections, currencyIconFilePath, IdUser);

                string IdBasePriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                detectionDetails.NotIncludedPLMDetectionList = GetNotIncludedPLMDetectionPrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                    detectionDetails.IdDetections, IdUser);

                // detectionDetails.UpdateAllMaxCostFromNullToZero();
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2360(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }
        public List<ProductTypes> GetProductTypesByDetection_V2360(string PCMConnectionString, UInt32 IdDetection, UInt32 IdDetectionType)
        {
            List<ProductTypes> productTypesList = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetProductTypesByIdDetection_V2360", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes productTypes = new ProductTypes();

                            if (reader["ProductCode"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(reader["ProductCode"]);
                            }
                            if (reader["ProductTemplate"] != DBNull.Value)
                            {
                                productTypes.Template = new Template();
                                productTypes.Template.Name = Convert.ToString(reader["ProductTemplate"]);
                            }
                            if (reader["ProductName"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(reader["ProductName"]);
                            }
                            if (reader["ProductDescription"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(reader["ProductDescription"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["ProductStatus"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(reader["ProductStatus"]);
                                }
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                productTypes.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt32(reader["IdTemplate"]);
                            }
                            #region GEOS2-4091&GEOS2-4092
                            try
                            {
                                if (reader["ProductName_es"] != DBNull.Value)
                                {
                                    productTypes.Name_es = Convert.ToString(reader["ProductName_es"]);
                                }
                                if (reader["ProductName_fr"] != DBNull.Value)
                                {
                                    productTypes.Name_fr = Convert.ToString(reader["ProductName_fr"]);
                                }
                                if (reader["ProductName_pt"] != DBNull.Value)
                                {
                                    productTypes.Name_pt = Convert.ToString(reader["ProductName_pt"]);
                                }
                                if (reader["ProductName_ro"] != DBNull.Value)
                                {
                                    productTypes.Name_ro = Convert.ToString(reader["ProductName_ro"]);
                                }
                                if (reader["ProductName_ru"] != DBNull.Value)
                                {
                                    productTypes.Name_ru = Convert.ToString(reader["ProductName_ru"]);
                                }
                                if (reader["ProductName_zh"] != DBNull.Value)
                                {
                                    productTypes.Name_zh = Convert.ToString(reader["ProductName_zh"]);
                                }
                                if (reader["ProductDescription_es"] != DBNull.Value)
                                {
                                    productTypes.Description_es = Convert.ToString(reader["ProductDescription_es"]);
                                }
                                if (reader["ProductDescription_fr"] != DBNull.Value)
                                {
                                    productTypes.Description_fr = Convert.ToString(reader["ProductDescription_fr"]);
                                }
                                if (reader["ProductDescription_pt"] != DBNull.Value)
                                {
                                    productTypes.Description_pt = Convert.ToString(reader["ProductDescription_pt"]);
                                }
                                if (reader["ProductDescription_ro"] != DBNull.Value)
                                {
                                    productTypes.Description_ro = Convert.ToString(reader["ProductDescription_ro"]);
                                }
                                if (reader["ProductDescription_ru"] != DBNull.Value)
                                {
                                    productTypes.Description_ru = Convert.ToString(reader["ProductDescription_ru"]);
                                }
                                if (reader["ProductDescription_zh"] != DBNull.Value)
                                {
                                    productTypes.Description_zh = Convert.ToString(reader["ProductDescription_zh"]);
                                }
                            }
                            catch (Exception) { }
                            #endregion
                            productTypesList.Add(productTypes);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypesByDetection_V2360(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypesList;
        }
        #endregion

        #region GEOS2-3890 
        //Shubham[skadam] GEOS2-3890 Add a new option to send "Announcement" email for new and reviewed modules in PCM - 2 23 02 2023
        public List<Department> GetAllEmployeesForOrganizationByIdCompany_V2330(string workbenchConnectionString, string employeesProfileImagePath, string idCompany)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);
            List<Employee> emp = new List<Employee>();
            List<Employee> employees = new List<Employee>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllEmployeesForOrganizationByIdCompany_V2360", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.CommandTimeout = 9000;
                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);
                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["JobDescriptionInUse"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                                    if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);
            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(o => o.EmployeeJobDescription.JobDescription.JobDescriptionCode).ThenBy(o => o.FullName).ToList());
            }
            departments.RemoveAll(x => x.Employees == null);
            return departments;
        }
        public List<Department> GetAllDepartments(string workbenchConnectionString)
        {
            List<Department> departments = new List<Department>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllDepartments", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Department department = new Department();

                            if (reader["IdDepartment"] != DBNull.Value)
                                department.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                            if (reader["DepartmentName"] != DBNull.Value)
                                department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                            if (reader["IdDepartmentParent"] != DBNull.Value)
                                department.IdDepartmentParent = Convert.ToUInt32(reader["IdDepartmentParent"]);

                            if (reader["DepartmentPosition"] != DBNull.Value)
                                department.DepartmentPosition = Convert.ToString(reader["DepartmentPosition"]);

                            if (reader["DepartmentInUse"] != DBNull.Value)
                                department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);

                            if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                            if (reader["DepartmentIsIsolated"] != DBNull.Value)
                                department.DepartmentIsIsolated = Convert.ToByte(reader["DepartmentIsIsolated"]);

                            departments.Add(department);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDepartments(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return departments;
        }

        #endregion

        #region GEOS2-2544
        //[plahange][GEOS2-2544][22.02.2022]
        public List<ConfigurationCategories> GetAllPCMCategories_V2360(string connectionString, string ArticleVisualAidsPath)
        {
            List<ConfigurationCategories> categories = new List<ConfigurationCategories>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMCategories_V2360", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ConfigurationCategories categori = new ConfigurationCategories();

                            categori.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            categori.IsAttachmentExistVisibility = Visibility.Hidden;

                            if (reader["Name"] != DBNull.Value)
                                categori.Name = Convert.ToString(reader["Name"]);

                            if (reader["Position"] != DBNull.Value)
                                categori.OrderNumber = Convert.ToUInt32(reader["Position"]);

                            if (reader["PositionName"] != DBNull.Value)
                                categori.PositionName = Convert.ToString(reader["PositionName"]);

                            if (reader["Parent_Name"] != DBNull.Value)
                                categori.ParentName = Convert.ToString(reader["Parent_Name"]);

                            if (reader["Description"] != DBNull.Value)
                                categori.Description = Convert.ToString(reader["Description"]).Trim();

                            //if (reader["ImagePath"] != DBNull.Value)
                            //{
                            //    categori.ImagePath = Convert.ToString(reader["ImagePath"]);
                            //    if (categori.ImagePath != null)
                            //    {
                            //        categori.IsAttachmentExist = true;
                            //        categori.IsAttachmentExistVisibility = Visibility.Visible;
                            //    }
                            //}
                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                categori.ImagePath = "Yes";
                                if (categori.ImagePath != null)
                                {
                                    categori.IsAttachmentExist = true;
                                    categori.IsAttachmentExistVisibility = Visibility.Visible;
                                }
                            }
                            else
                            {
                                categori.ImagePath = "No";
                            }

                            if (reader["pcmCategoryInUse"] != DBNull.Value)
                                categori.InUse = Convert.ToString(reader["pcmCategoryInUse"]);

                            categories.Add(categori);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMCategories_V2360(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return categories;
        }
        #endregion

        //[rdixit][22.02.2023][GEOS2-4176]
        public List<PCMArticleSynchronization> GetBPLPlantCurrencyDetailByIdBPLAndIdCPL(string connectionstring, Int32 IdArticle, string IdsBPL, string IdsCPL, string FilterString)
        {
            List<PCMArticleSynchronization> PCMArticleSynchronizationList = new List<PCMArticleSynchronization>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PCM_GetBPLPlantCurrencyDetailByIdBPLAndIdCPL_V2360", con);

                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                concommand.Parameters.AddWithValue("_IdsBPL", IdsBPL);
                concommand.Parameters.AddWithValue("_IdsCPL", IdsCPL);
                concommand.Parameters.AddWithValue("_filtertext", FilterString);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PCMArticleSynchronization PCMArticleSynchronization = new PCMArticleSynchronization();
                        if (reader["IdBasePriceList"] != DBNull.Value)
                        {
                            PCMArticleSynchronization.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                        }
                        if (reader["Code"] != DBNull.Value)
                        {
                            PCMArticleSynchronization.Code = Convert.ToString(reader["Code"]);
                        }
                        if (reader["CompanyName"] != DBNull.Value)
                        {
                            PCMArticleSynchronization.PricePlants = new System.Collections.ObjectModel.ObservableCollection<Site>();
                            List<string> tempCompany = Convert.ToString(reader["CompanyName"]).Split(',').ToList<string>();
                            foreach (var item in tempCompany)
                            {
                                PCMArticleSynchronization.PricePlants.Add(new Site() { Name = item });
                            }
                        }
                        if (reader["CurrencyName"] != DBNull.Value)
                        {
                            PCMArticleSynchronization.PriceCurrencies = new System.Collections.ObjectModel.ObservableCollection<Currency>();
                            List<string> tempCurrencies = Convert.ToString(reader["CurrencyName"]).Split(',').ToList<string>();
                            foreach (var item in tempCurrencies)
                            {
                                PCMArticleSynchronization.PriceCurrencies.Add(new Currency() { Name = item });
                            }
                        }
                        PCMArticleSynchronizationList.Add(PCMArticleSynchronization);
                    }
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            PCMArticleSynchronization PCMArticleSynchronization = new PCMArticleSynchronization();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                PCMArticleSynchronization.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PCMArticleSynchronization.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["CompanyName"] != DBNull.Value)
                            {
                                PCMArticleSynchronization.PricePlants = new System.Collections.ObjectModel.ObservableCollection<Site>();
                                List<string> tempCompany = Convert.ToString(reader["CompanyName"]).Split(',').ToList<string>();
                                foreach (var item in tempCompany)
                                {
                                    PCMArticleSynchronization.PricePlants.Add(new Site() { Name = item });
                                }
                            }
                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                PCMArticleSynchronization.PriceCurrencies = new System.Collections.ObjectModel.ObservableCollection<Currency>();
                                List<string> tempCurrencies = Convert.ToString(reader["CurrencyName"]).Split(',').ToList<string>();
                                foreach (var item in tempCurrencies)
                                {
                                    PCMArticleSynchronization.PriceCurrencies.Add(new Currency() { Name = item });
                                }
                            }
                            PCMArticleSynchronizationList.Add(PCMArticleSynchronization);
                        }
                    }
                }
            }
            return PCMArticleSynchronizationList;
        }
        #region Sudhir.Jangra GEOS2-3891 27/02/2023
        public PCMAnnouncementEmailDetails GetEmailForDows_V2360(DateTime startDate, DateTime endDate, string PCMConnectionString, string emailTemplatePath,
           string mailServerName, string mailServerPort, string commandTimeout, Boolean NewChangeType, Boolean UpdateChangeType,
           string PCMAnnouncementEmailTemplate, string EmployeeContactEmail)
        {
            PCMAnnouncementEmailDetails emailDetail = new PCMAnnouncementEmailDetails();
            DataSet dataSet = new DataSet();
            System.Globalization.Calendar cal = new System.Globalization.CultureInfo("en-US").Calendar;
            using (MySqlConnection connOtItem = new MySqlConnection(PCMConnectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("PCM_GetEmailForDOWS_V2360", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_StartDate", startDate);
                otItemCommand.Parameters.AddWithValue("_EndDate", endDate);
                otItemCommand.Parameters.AddWithValue("_NewChangeType", NewChangeType);
                otItemCommand.Parameters.AddWithValue("_UpdateChangeType", UpdateChangeType);

                otItemCommand.CommandTimeout = Convert.ToInt32(commandTimeout);
                using (MySqlDataAdapter adap = new MySqlDataAdapter(otItemCommand))
                {
                    adap.Fill(dataSet);
                }
            }
            if (dataSet != null && dataSet.Tables.Count > 0)
            {
                if (dataSet.Tables[0] != null && dataSet.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow ItemReader in dataSet.Tables[0].Rows)
                    {
                        try
                        {
                            try
                            {
                                if (emailDetail.DetectionEmailDetails == null)
                                {
                                    emailDetail.DetectionEmailDetails = new List<PCMDetectionEmailDetails>();
                                }
                                PCMDetectionEmailDetails pcmDetectionEmailDetails = new PCMDetectionEmailDetails();
                                if (ItemReader["DetectionCreatedIn"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionCreatedIn = Convert.ToDateTime(ItemReader["DetectionCreatedIn"]);
                                    int week = cal.GetWeekOfYear(pcmDetectionEmailDetails.DetectionCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                    pcmDetectionEmailDetails.Week = week;
                                }
                                if (ItemReader["DetectionModifiedIn"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionModifiedIn = Convert.ToDateTime(ItemReader["DetectionModifiedIn"]);
                                    if (pcmDetectionEmailDetails.Week == 0)
                                    {
                                        int week = cal.GetWeekOfYear(pcmDetectionEmailDetails.DetectionModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        pcmDetectionEmailDetails.Week = week;
                                    }
                                }
                                if (ItemReader["DetectionName"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionName = Convert.ToString(ItemReader["DetectionName"]);
                                }
                                if (ItemReader["DetectionType"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionType = Convert.ToInt16(ItemReader["DetectionType"]);
                                }
                                if (ItemReader["IdDetection"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.Id = Convert.ToInt16(ItemReader["IdDetection"]);
                                }
                                emailDetail.DetectionEmailDetails.Add(pcmDetectionEmailDetails);
                            }
                            catch (Exception)
                            {

                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error PCM_GetEmailForDOWS_V2360(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (dataSet.Tables[1] != null && dataSet.Tables[1].Rows.Count > 0)
                    {
                        foreach (DataRow ItemReader in dataSet.Tables[1].Rows)
                        {
                            try
                            {
                                try
                                {
                                    if (emailDetail.PCMCPTypesDetails == null)
                                    {
                                        emailDetail.PCMCPTypesDetails = new List<PCMCPTypesEmailDetails>();
                                    }
                                    PCMCPTypesEmailDetails pcmCPTypesEmailDetails = new PCMCPTypesEmailDetails();

                                    if (ItemReader["CPCreatedIn"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPCreatedIn = Convert.ToDateTime(ItemReader["CPCreatedIn"]);
                                        int week = cal.GetWeekOfYear(pcmCPTypesEmailDetails.CPCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        pcmCPTypesEmailDetails.Week = week;
                                    }
                                    if (ItemReader["CPModifiedIn"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPModifiedIn = Convert.ToDateTime(ItemReader["CPModifiedIn"]);
                                        if (pcmCPTypesEmailDetails.Week == 0)
                                        {
                                            int week = cal.GetWeekOfYear(pcmCPTypesEmailDetails.CPModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                            pcmCPTypesEmailDetails.Week = week;
                                        }
                                    }
                                    if (ItemReader["CPName"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPName = Convert.ToString(ItemReader["CPName"]);
                                    }
                                    if (ItemReader["CPCode"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPCode = Convert.ToString(ItemReader["CPCode"]);
                                    }
                                    if (ItemReader["CPType"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPType = Convert.ToInt32(ItemReader["CPType"]);
                                        pcmCPTypesEmailDetails.IdTemplate = Convert.ToUInt64(ItemReader["CPType"]);
                                    }
                                    if (ItemReader["IdCPType"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.IdCPType = Convert.ToUInt64(ItemReader["IdCPType"]);
                                    }

                                    emailDetail.PCMCPTypesDetails.Add(pcmCPTypesEmailDetails);
                                }
                                catch (Exception)
                                {
                                }

                            }

                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error PCM_GetEmailForDOWS_V2360(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (dataSet.Tables[2] != null && dataSet.Tables[2].Rows.Count > 0)
                    {

                        foreach (DataRow ItemReader in dataSet.Tables[2].Rows)
                        {
                            try
                            {
                                try
                                {
                                    if (emailDetail.PCMArticleDetails == null)
                                    {
                                        emailDetail.PCMArticleDetails = new List<PCMArticlesEmailDetails>();
                                    }
                                    PCMArticlesEmailDetails articles = new PCMArticlesEmailDetails();
                                    if (ItemReader["ArticleCreatedIn"] != DBNull.Value)
                                    {
                                        articles.ArticleCreatedIn = Convert.ToDateTime(ItemReader["ArticleCreatedIn"]);
                                        int week = cal.GetWeekOfYear(articles.ArticleCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        articles.Week = week;
                                    }
                                    if (ItemReader["ArticleModifiedIn"] != DBNull.Value)
                                    {
                                        articles.ArticleModifiedIn = Convert.ToDateTime(ItemReader["ArticleModifiedIn"]);
                                        if (articles.Week == 0)
                                        {
                                            int week = cal.GetWeekOfYear(articles.ArticleModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                            articles.Week = week;
                                        }
                                    }
                                    if (ItemReader["ArticleReference"] != DBNull.Value)
                                    {
                                        articles.ArticleReference = Convert.ToString(ItemReader["ArticleReference"]);
                                    }
                                    if (ItemReader["ArticleDescription"] != DBNull.Value)
                                    {
                                        articles.ArticleDescription = Convert.ToString(ItemReader["ArticleDescription"]);
                                    }

                                    emailDetail.PCMArticleDetails.Add(articles);
                                }
                                catch (Exception)
                                {
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error PCM_GetEmailForDOWS_V2360(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }

                }

            }
            return emailDetail;
        }
        #endregion
        #region GEOS2-3891
        public bool IsPCMAnnouncementEmailSend(string mailServerName, string mailServerPort, string commandTimeout, string PCMAnnouncementEmailTemplate,
            string EmployeeContactEmail)
        {
            bool isSend = false;
            try
            {
                //EmployeeContactEmail= "skadam@emdep.com";
                Utility.MailControl.SendHtmlMail("EMDEP - Latest changes in Commercial Catalogue", PCMAnnouncementEmailTemplate.ToString(), string.Join(";", EmployeeContactEmail), new List<string>(),
                    "PCM-noreply@emdep.com", mailServerName, mailServerPort, null);
                isSend = true;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsPCMAnnouncementEmailsend(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isSend;
        }

        public bool IsPCMAnnouncementEmailSend_V2360(string mailServerName, string mailServerPort, string commandTimeout, string PCMAnnouncementEmailTemplate,
           string EmployeeContactEmail, Dictionary<string, byte[]> AnnouncementFilebyte)
        {
            bool isSend = false;
            try
            {
                //EmployeeContactEmail= "skadam@emdep.com";
                //Utility.MailControl.SendHtmlMail("EMDEP - Latest changes in Commercial Catalogue", PCMAnnouncementEmailTemplate.ToString(), string.Join(";", EmployeeContactEmail), new List<string>(),
                //    "PCM-noreply@emdep.com", mailServerName, mailServerPort, null);
                Utility.MailControl.SendHtmlMailWithMultipleAttachment("EMDEP - Latest changes in Commercial Catalogue", PCMAnnouncementEmailTemplate.ToString(), string.Join(";", EmployeeContactEmail),
                   "PCM-noreply@emdep.com", mailServerName, mailServerPort, AnnouncementFilebyte);
                isSend = true;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsPCMAnnouncementEmailsend(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isSend;
        }
        //Shubham[skadam] GEOS2-3891 Add a new option to send "Announcement" email for new and reviewed modules in PCM - 3 01 03 2023
        public PCMAnnouncementEmailDetails GetEmailForDows_V2360New(DateTime startDate, DateTime endDate, string PCMConnectionString, string emailTemplatePath,
          string mailServerName, string mailServerPort, string commandTimeout, Boolean NewChangeType, Boolean UpdateChangeType,
          string PCMAnnouncementEmailTemplate, string EmployeeContactEmail)
        {
            PCMAnnouncementEmailDetails emailDetail = new PCMAnnouncementEmailDetails();
            DataSet dataSet = new DataSet();
            System.Globalization.Calendar cal = new System.Globalization.CultureInfo("en-US").Calendar;
            using (MySqlConnection connOtItem = new MySqlConnection(PCMConnectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("PCM_GetEmailForDOWS_V2360", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_StartDate", startDate);
                otItemCommand.Parameters.AddWithValue("_EndDate", endDate);
                otItemCommand.Parameters.AddWithValue("_NewChangeType", NewChangeType);
                otItemCommand.Parameters.AddWithValue("_UpdateChangeType", UpdateChangeType);

                otItemCommand.CommandTimeout = Convert.ToInt32(commandTimeout);
                using (MySqlDataAdapter adap = new MySqlDataAdapter(otItemCommand))
                {
                    adap.Fill(dataSet);
                }
            }
            if (dataSet != null && dataSet.Tables.Count > 0)
            {
                if (dataSet.Tables[0] != null && dataSet.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow ItemReader in dataSet.Tables[0].Rows)
                    {
                        try
                        {
                            try
                            {
                                if (emailDetail.DetectionEmailDetails == null)
                                {
                                    emailDetail.DetectionEmailDetails = new List<PCMDetectionEmailDetails>();
                                }
                                PCMDetectionEmailDetails pcmDetectionEmailDetails = new PCMDetectionEmailDetails();
                                if (ItemReader["DetectionCreatedIn"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionCreatedIn = Convert.ToDateTime(ItemReader["DetectionCreatedIn"]);
                                    int week = cal.GetWeekOfYear(pcmDetectionEmailDetails.DetectionCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                    pcmDetectionEmailDetails.Week = week;
                                }
                                if (ItemReader["DetectionModifiedIn"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionModifiedIn = Convert.ToDateTime(ItemReader["DetectionModifiedIn"]);
                                    if (pcmDetectionEmailDetails.Week == 0)
                                    {
                                        int week = cal.GetWeekOfYear(pcmDetectionEmailDetails.DetectionModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        pcmDetectionEmailDetails.Week = week;
                                    }
                                }
                                if (ItemReader["DetectionName"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionName = Convert.ToString(ItemReader["DetectionName"]);
                                }
                                if (ItemReader["DetectionType"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionType = Convert.ToInt16(ItemReader["DetectionType"]);
                                }
                                if (ItemReader["IdDetection"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.Id = Convert.ToInt16(ItemReader["IdDetection"]);
                                }
                                if (ItemReader["Type"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.Type = Convert.ToString(ItemReader["Type"]);
                                    if (pcmDetectionEmailDetails.Type.ToLower() == "new".ToLower())
                                    {
                                        pcmDetectionEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["DetectionCreatedIn"]);
                                    }
                                    else
                                    {
                                        pcmDetectionEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["DetectionModifiedIn"]);
                                    }
                                }
                                emailDetail.DetectionEmailDetails.Add(pcmDetectionEmailDetails);
                            }
                            catch (Exception)
                            {

                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmailForDows_V2360New(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (dataSet.Tables[1] != null && dataSet.Tables[1].Rows.Count > 0)
                    {
                        foreach (DataRow ItemReader in dataSet.Tables[1].Rows)
                        {
                            try
                            {
                                try
                                {
                                    if (emailDetail.PCMCPTypesDetails == null)
                                    {
                                        emailDetail.PCMCPTypesDetails = new List<PCMCPTypesEmailDetails>();
                                    }
                                    PCMCPTypesEmailDetails pcmCPTypesEmailDetails = new PCMCPTypesEmailDetails();

                                    if (ItemReader["CPCreatedIn"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPCreatedIn = Convert.ToDateTime(ItemReader["CPCreatedIn"]);
                                        int week = cal.GetWeekOfYear(pcmCPTypesEmailDetails.CPCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        pcmCPTypesEmailDetails.Week = week;
                                    }
                                    if (ItemReader["CPModifiedIn"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPModifiedIn = Convert.ToDateTime(ItemReader["CPModifiedIn"]);
                                        if (pcmCPTypesEmailDetails.Week == 0)
                                        {
                                            int week = cal.GetWeekOfYear(pcmCPTypesEmailDetails.CPModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                            pcmCPTypesEmailDetails.Week = week;
                                        }
                                    }
                                    if (ItemReader["CPName"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPName = Convert.ToString(ItemReader["CPName"]);
                                    }
                                    if (ItemReader["CPCode"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPCode = Convert.ToString(ItemReader["CPCode"]);
                                    }
                                    if (ItemReader["CPType"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPType = Convert.ToInt32(ItemReader["CPType"]);
                                        pcmCPTypesEmailDetails.IdTemplate = Convert.ToUInt64(ItemReader["CPType"]);
                                    }
                                    if (ItemReader["IdCPType"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.IdCPType = Convert.ToUInt64(ItemReader["IdCPType"]);
                                    }
                                    if (ItemReader["Type"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.Type = Convert.ToString(ItemReader["Type"]);
                                        if (pcmCPTypesEmailDetails.Type.ToLower() == "new".ToLower())
                                        {
                                            pcmCPTypesEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["CPCreatedIn"]);
                                        }
                                        else
                                        {
                                            pcmCPTypesEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["CPModifiedIn"]);
                                        }
                                    }
                                    emailDetail.PCMCPTypesDetails.Add(pcmCPTypesEmailDetails);
                                }
                                catch (Exception)
                                {
                                }

                            }

                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmailForDows_V2360New(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (dataSet.Tables[2] != null && dataSet.Tables[2].Rows.Count > 0)
                    {

                        foreach (DataRow ItemReader in dataSet.Tables[2].Rows)
                        {
                            try
                            {
                                try
                                {
                                    if (emailDetail.PCMArticleDetails == null)
                                    {
                                        emailDetail.PCMArticleDetails = new List<PCMArticlesEmailDetails>();
                                    }
                                    PCMArticlesEmailDetails articles = new PCMArticlesEmailDetails();
                                    if (ItemReader["ArticleCreatedIn"] != DBNull.Value)
                                    {
                                        articles.ArticleCreatedIn = Convert.ToDateTime(ItemReader["ArticleCreatedIn"]);
                                        int week = cal.GetWeekOfYear(articles.ArticleCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        articles.Week = week;
                                    }
                                    if (ItemReader["ArticleModifiedIn"] != DBNull.Value)
                                    {
                                        articles.ArticleModifiedIn = Convert.ToDateTime(ItemReader["ArticleModifiedIn"]);
                                        if (articles.Week == 0)
                                        {
                                            int week = cal.GetWeekOfYear(articles.ArticleModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                            articles.Week = week;
                                        }
                                    }
                                    if (ItemReader["ArticleReference"] != DBNull.Value)
                                    {
                                        articles.ArticleReference = Convert.ToString(ItemReader["ArticleReference"]);
                                    }
                                    if (ItemReader["ArticleDescription"] != DBNull.Value)
                                    {
                                        articles.ArticleDescription = Convert.ToString(ItemReader["ArticleDescription"]);
                                    }
                                    if (ItemReader["Type"] != DBNull.Value)
                                    {
                                        articles.Type = Convert.ToString(ItemReader["Type"]);
                                        if (articles.Type.ToLower() == "new".ToLower())
                                        {
                                            articles.ReportDate = Convert.ToDateTime(ItemReader["ArticleCreatedIn"]);
                                        }
                                        else
                                        {
                                            articles.ReportDate = Convert.ToDateTime(ItemReader["ArticleModifiedIn"]);
                                        }
                                    }
                                    emailDetail.PCMArticleDetails.Add(articles);
                                }
                                catch (Exception)
                                {
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmailForDows_V2360New(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }

                }

            }
            return emailDetail;
        }
        #endregion

        #region //Shubham[skadam]GetCountryIconFileInBytes
        public Dictionary<string, byte[]> GetCountryIconBytes(string CountryFilePath, string PCMConnectionString)
        {
            Dictionary<string, byte[]> countryIcon = new Dictionary<string, byte[]>();
            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllLanguagesWiseCountries", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                byte[] bytes = null;
                                bytes = GetCountryIconFileInBytes(Convert.ToString(reader["Iso"]), CountryFilePath);
                                countryIcon.Add(Convert.ToString(reader["Iso"]), bytes);
                            }
                            catch (Exception ex)
                            {
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountryIconFileInBytes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return countryIcon;
        }

        public byte[] GetCountryIconFileInBytes(string countryiso, string filepath)
        {
            byte[] bytes = null;
            try
            {
                string filenamepng = countryiso + ".png";
                string filenamejpg = countryiso + ".jpg";
                string filepathjpg = Path.Combine(filepath, filenamejpg);
                string filepathpng = Path.Combine(filepath, filenamepng);
                if (File.Exists(filepathjpg))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathjpg, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.	
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);
                            // Break when the end of the file is reached.	
                            if (n == 0)
                                break;
                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                else if (File.Exists(filepathpng))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathpng, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.	
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);
                            // Break when the end of the file is reached.	
                            if (n == 0)
                                break;
                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                return bytes;
            }
            catch (FileNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountryIconFileInBytes() ISO-{0}. ErrorMessage- {1}", countryiso, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (DirectoryNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountryIconFileInBytes() ISO-{0}. ErrorMessage- {1}", countryiso, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountryIconFileInBytes() ISO-{0}. ErrorMessage- {1}", countryiso, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        #endregion

        #region Sudhir.Jangra GEOS2-2922
        //[Sudhir.Jangra][GEOS2-2922][17/03/2023]
        public List<Articles> GetAllPCMArticles_V2370(string connectionString, string ArticleVisualAidsPath, string ImagePath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2290(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {




                        while (reader.Read())
                        {
                            Articles article = new Articles();
                            try
                            {
                                article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["Imagecount"] != DBNull.Value)
                                {
                                    article.ArticleImageCount = Convert.ToString(reader["Imagecount"]) + " " + "Image(s)"; ;
                                    article.IsImageButtonEnabled = true;
                                    article.IsImageVisible = Visibility.Visible;
                                }
                                else
                                {
                                    article.IsImageButtonEnabled = false;
                                    article.IsImageVisible = Visibility.Collapsed;
                                }
                                if (reader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(reader["Reference"]);

                                if (reader["Description"] != DBNull.Value)
                                    article.Description = Convert.ToString(reader["Description"]).Trim();

                                if (reader["Description_es"] != DBNull.Value)
                                    article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                                if (reader["Description_fr"] != DBNull.Value)
                                    article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                                if (reader["Description_ro"] != DBNull.Value)
                                    article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                                if (reader["Description_zh"] != DBNull.Value)
                                    article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                                if (reader["Description_pt"] != DBNull.Value)
                                    article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                                if (reader["Description_ru"] != DBNull.Value)
                                    article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                                article.Visibility = "Hidden";

                                if (reader["ImagePath"] != DBNull.Value)
                                {
                                    article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                    article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                    //if (article.ArticleImageInBytes != null)
                                    //{
                                    //    article.Visibility = "Visible";
                                    //}
                                }

                                if (reader["Length"] != DBNull.Value)
                                    article.Length = (float)reader["Length"];

                                if (reader["Width"] != DBNull.Value)
                                    article.Width = (float)reader["Width"];

                                if (reader["Height"] != DBNull.Value)
                                    article.Height = (float)reader["Height"];

                                if (reader["Weight"] != DBNull.Value)
                                    article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                    {
                                        article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                        article.ArticleCategory = new ArticleCategories();
                                        article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    }
                                }

                                if (reader["idArticleSupplier"] != DBNull.Value)
                                    article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                                if (reader["SupplierName"] != DBNull.Value)
                                    article.SupplierName = Convert.ToString(reader["SupplierName"]);

                                if (reader["IsObsolete"] != DBNull.Value)
                                    article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                                if (article.IsObsolete == 0)
                                {
                                    article.WarehouseStatus = WarehouseStatus.Active;
                                }
                                else
                                {
                                    article.WarehouseStatus = WarehouseStatus.Inactive;
                                }


                                if (reader["IdPCMStatus"] != DBNull.Value)
                                    article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                                if (reader["PCMStatus"] != DBNull.Value)
                                    article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                                if (CategoryList != null)
                                {
                                    article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                    article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                                }


                                if (reader["PurchaseQtyMin"] != DBNull.Value)
                                    article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                                if (reader["PurchaseQtyMax"] != DBNull.Value)
                                    article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                                if (reader["IsShareWithCustomer"] != DBNull.Value)
                                    article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                                if (reader["IsSparePartOnly"] != DBNull.Value)
                                    article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                                if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (article.IsShareWithCustomer == 1)
                                    {
                                        article.IdECOSVisibility = 323;
                                    }
                                    else if (article.IsSparePartOnly == 1)
                                    {
                                        article.IdECOSVisibility = 324;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                    {
                                        article.IdECOSVisibility = 325;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                    {
                                        article.IdECOSVisibility = 326;
                                    }
                                }

                                if (reader["PCMDescription"] != DBNull.Value)
                                {
                                    article.PCMDescription = Convert.ToString(reader["PCMDescription"]);
                                    if (!string.IsNullOrEmpty(article.PCMDescription))
                                    {
                                        article.IsRichText = "Yes";
                                    }
                                    else
                                    {
                                        article.IsRichText = "";
                                    }
                                }
                                if (reader["IsRtfText"] != DBNull.Value)
                                {
                                    article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                        #region 2nd ResultSet
                        //if (reader.NextResult())
                        //{
                        //    while (reader.Read())
                        //    {
                        //        try
                        //        {
                        //            if (reader["IdArticle"] != DBNull.Value)
                        //            {
                        //                Articles article = articles.Where(i => i.IdArticle == Convert.ToUInt32(reader["IdArticle"])).FirstOrDefault();

                        //                if (reader["PCMImageIdArticle"] != DBNull.Value)
                        //                {
                        //                    article.PCMImageIdArticle = Convert.ToUInt32(reader["PCMImageIdArticle"]);
                        //                }
                        //                if (reader["ImagePath"] != DBNull.Value)
                        //                {
                        //                    article.PCMImagePath = Convert.ToString(reader["ImagePath"]);
                        //                }
                        //                if (article.PCMImageIdArticle != null || article.PCMImagePath != string.Empty)
                        //                {
                        //                    article.IsImageButtonEnabled = true;
                        //                    article.IsImageVisible = Visibility.Visible;
                        //                    article.PCMImage = new PCMArticleImage();

                        //                    var Id = article.PCMImageIdArticle.HasValue ? article.PCMImageIdArticle.Value : 0;
                        //                    article.PCMArticleImage = new List<Articles>();
                        //                    article.PCMArticleImage = GetArticleImage_V2370(connectionString, ArticleVisualAidsPath, Id, ImagePath);
                        //                    // var imagecount = article.ImagePath.Count() + article.PCMArticleImageList.Count();

                        //                    if (article.PCMImagePath != string.Empty)
                        //                    {
                        //                        article.ArticleImageCount = (article.PCMArticleImage.Count() + 1 )+ " " + "Image(s)";
                        //                    }
                        //                    else
                        //                    {
                        //                        article.ArticleImageCount = article.PCMArticleImage.Count() + " " + "Image(s)";
                        //                    }
                        //                }
                        //                else
                        //                {
                        //                    article.IsImageButtonEnabled = false;
                        //                    article.IsImageVisible = Visibility.Collapsed;
                        //                }


                        //            }
                        //        }
                        //        catch (Exception ex)
                        //        {
                        //            Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        //            throw;
                        //        }
                        //    }
                        //}
                        #endregion
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        //[Sudhir.Jangra][GEOS2-2922][20/03/2023]
        public List<DetectionDetails> GetAllModuleDetectionsWaysOptionsSpareParts_V2370(string PCMConnectionString, string DetectionImagePath)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllModuleDetections_V2370", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            try
                            {
                                detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                                if (DetectionDetailReader["Name"] != DBNull.Value)
                                {
                                    detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                                }
                                if (DetectionDetailReader["ImageCount"] != DBNull.Value) //[rdixit][GEOS2 - 2922][31.03.2023]
                                {
                                    detectionDetails.ImageCount = Convert.ToString(DetectionDetailReader["ImageCount"]) + " " + "Image(s)";
                                    detectionDetails.IsImageExist = true;
                                    detectionDetails.IsImageVisible = Visibility.Visible;
                                }
                                if (DetectionDetailReader["Description"] != DBNull.Value)
                                {
                                    detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                                }
                                if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                                {
                                    detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                                }
                                if (DetectionDetailReader["Code"] != DBNull.Value)
                                {
                                    detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                                }
                                if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                                {
                                    detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                    detectionDetails.TestTypes = new TestTypes();
                                    detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                    if (DetectionDetailReader["TestName"] != DBNull.Value)
                                    {
                                        detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                    }
                                }
                                if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                                {
                                    detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                    detectionDetails.DetectionTypes = new DetectionTypes();
                                    detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                    if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                    {
                                        detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                    }
                                }
                                if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                                {
                                    detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                    detectionDetails.DetectionGroup = new DetectionGroup();
                                    detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                    if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                    {
                                        detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                    }
                                }
                                if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                                {
                                    detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                                }
                                if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                                {
                                    detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                    detectionDetails.Status = new LookupValue();
                                    detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                    if (DetectionDetailReader["Status"] != DBNull.Value)
                                    {
                                        detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                    }
                                    if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                    {
                                        detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                    }
                                }

                                if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                    detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                                if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                    detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                                if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                    detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                                if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                    detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                                if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 323;
                                    }
                                    else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 324;
                                    }
                                    else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 325;
                                    }
                                    else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                    {
                                        detectionDetails.IdECOSVisibility = 326;
                                    }
                                }
                                if (detectionDetails.DetectionAllGroupList == null)
                                    detectionDetails.DetectionAllGroupList = new List<DetectionGroup>();
                                detectionDetails.DetectionAllGroupList = GetDetectionAllGroupsList(PCMConnectionString);
                                if (detectionDetails.DetectionAllGroupList != null && detectionDetails.IdDetectionType != 0)
                                {
                                    if (detectionDetails.DetectionGroupList == null)
                                        detectionDetails.DetectionGroupList = new List<DetectionGroup>();
                                    detectionDetails.DetectionGroupList = detectionDetails.DetectionAllGroupList.Where(i => i.IdDetectionType == detectionDetails.IdDetectionType).ToList();
                                }
                                detectionList.Add(detectionDetails);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2370().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                        #region Commented [rdixit][GEOS2-2922][31.03.2023]
                        //if (DetectionDetailReader.NextResult())
                        //{
                        //    while (DetectionDetailReader.Read())
                        //    {
                        //        try
                        //        {
                        //            if (DetectionDetailReader["IdDetection"] != DBNull.Value)
                        //            {
                        //                DetectionDetails detectionImage = detectionList.Where(i => i.IdDetections == Convert.ToInt32(DetectionDetailReader["IdDetection"])).FirstOrDefault();

                        //                if (detectionImage != null)
                        //                {
                        //                    detectionImage.IsImageExist = true;
                        //                    detectionImage.IsImageVisible = Visibility.Visible;
                        //                    detectionImage.DetectionImage = new DetectionImage();
                        //                    detectionImage.DetectionImage.IdDetection = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);
                        //                    var Id = detectionImage.DetectionImage.IdDetection;
                        //                    detectionImage.DetectionImageCount = new ObservableCollection<DetectionImage>();
                        //                    detectionImage.DetectionImageCount = GetDetectionImagesByIdDetection_V2370(PCMConnectionString, Id, DetectionImagePath);
                        //                    detectionImage.ImageCount = detectionImage.DetectionImageCount.Count() + " " + "Image(s)";
                        //                }

                        //            }
                        //        }
                        //        catch (Exception ex)
                        //        {
                        //            Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2370().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        //            throw;
                        //        }
                        //    }
                        //}
                        #endregion
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2370().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        /// <summary>
        /// This method is used to get Detection Images by id Detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get Detection image id.</param>
        /// <param name="DetectionImagePath">Get Detection image path.</param>
        /// <returns>The list of Detection Image by id Detection.</returns>
        public ObservableCollection<DetectionImage> GetDetectionImagesByIdDetection_V2370(string PCMConnectionString, UInt32 IdDetection, string DetectionImagePath)
        {
            ObservableCollection<DetectionImage> DetectionImages = new ObservableCollection<DetectionImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllDetectionImages_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionImage DetectionImage = new DetectionImage();

                            DetectionImage.IdDetectionImage = Convert.ToUInt32(reader["IdDetectionImage"]);
                            DetectionImage.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                DetectionImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                DetectionImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                DetectionImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdateDate"] != DBNull.Value)
                            {
                                DetectionImage.UpdatedDate = Convert.ToDateTime(reader["UpdateDate"]);
                            }
                            DetectionImage.DetectionImageInBytes = GetDetectionImage(DetectionImage.IdDetectionImage.ToString(), DetectionImagePath, DetectionImage.SavedFileName);
                            DetectionImages.Add(DetectionImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionImagesByIdDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionImages;
        }

        public List<ProductTypes> GetAllProductTypes_V2370(string PCMConnectionString, string DetectionImagePath)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }

                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    cpType.Status.HtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                cpType.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["ImageCount"] != DBNull.Value)
                            {
                                cpType.ImageCount = Convert.ToString(reader["ImageCount"]) + " " + "Image(s)";
                                cpType.IsImageExist = true;
                                cpType.IsImageVisible = Visibility.Visible;
                            }
                            cpType.WayList = GetWayListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.DetectionList = GetDetectionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.OptionList = GetOptionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.SparePartList = GetSparePartListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpTypes.Add(cpType);
                        }
                        //if (reader.NextResult())
                        //{
                        //    while (reader.Read())
                        //    {
                        //        try
                        //        {
                        //            if (reader["IdCPType"] != DBNull.Value)
                        //            {
                        //                ProductTypes productType = cpTypes.Where(i => i.IdCPType == Convert.ToUInt32(reader["IdCPType"])).FirstOrDefault();
                        //                if (productType != null)
                        //                {
                        //                    productType.IsImageExist = true;
                        //                    productType.IsImageVisible = Visibility.Visible;
                        //                    productType.Image = new ProductTypeImage();
                        //                    productType.Image.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                        //                    var Id = Convert.ToUInt32(productType.Image.IdCPType);
                        //                    productType.ImageList = new List<ProductTypeImage>();
                        //                    productType.ImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, Id, DetectionImagePath);
                        //                    productType.ImageCount = productType.ImageList.Count() + " " + "Image(s)";
                        //                }
                        //            }
                        //        }
                        //        catch (Exception ex)
                        //        {
                        //            Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        //            throw;
                        //        }
                        //    }
                        //}
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }

        //[Sudhir.Jangra][GEOS2-2922][23/03/2023]
        public List<PCMArticleImage> GetArticleImage_V2370(string PCMConnectionString, string ArticleVisualAidsPath, UInt32 IdArticle, string articleReference, string ImagePath)
        {
            List<PCMArticleImage> PCMArticleImageList = new List<PCMArticleImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticleImage_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            PCMArticleImage PCMImage = new PCMArticleImage();
                            PCMImage.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                            if (reader["IdPCMArticleImage"] != DBNull.Value)
                            {
                                PCMImage.IdPCMArticleImage = Convert.ToUInt32(reader["IdPCMArticleImage"]);
                            }
                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                PCMImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                PCMImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                PCMImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                PCMImage.Position = Convert.ToUInt32(reader["Position"]);
                            }
                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                            {
                                PCMImage.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);
                            }
                            PCMImage.PCMArticleImageInBytes = GetPCMArticleImage(Convert.ToString(PCMImage.IdPCMArticleImage), ImagePath, PCMImage.SavedFileName, articleReference);
                            PCMArticleImageList.Add(PCMImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error PCM_GetAllPCMArticleImage_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return PCMArticleImageList;
        }
        #endregion

        #region GEOS2-2886
        /// <summary>
        /// This method is used to Get Product Types With Template.
        /// </summary>BPLModule
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Product Types With Template.</returns>
        public List<BPLModule> GetProductTypesWithTemplate_V2370(string PCMConnectionString)
        {
            List<BPLModule> templateList = new List<BPLModule>();
            try
            {
                templateList = GetTemplateList_V2370(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetProductTypesWithTemplate_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BPLModule template = new BPLModule();
                            template.Key = Convert.ToString(i);

                            template.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                            }
                            if (reader["TemplateName"] != DBNull.Value)
                            {
                                template.TemplateName = Convert.ToString(reader["TemplateName"]);
                            }
                            if (reader["ProductType"] != DBNull.Value)
                            {
                                template.Name = Convert.ToString(reader["ProductType"]);
                                template.ProductType = new ProductTypes();
                                template.ProductType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);
                                template.ProductType.Name = Convert.ToString(reader["ProductType"]);
                                template.ProductType.Reference = Convert.ToString(reader["Reference"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                template.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["StatusAbbreviation"] != DBNull.Value)
                            {
                                template.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                            }
                            if (reader["StatusHtmlColor"] != DBNull.Value)
                            {
                                template.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                            }
                            templateList.Add(template);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypesWithTemplate_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return templateList;
        }

        /// <summary>
        /// This method is used to get all Templates.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of Templates.</returns>
        public List<BPLModule> GetTemplateList_V2370(string PCMConnectionString)
        {
            List<BPLModule> Templates = new List<BPLModule>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllTemplates_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BPLModule Template = new BPLModule();
                            Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Template.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Template.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Templates.Add(Template);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetTemplateList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Templates;
        }


        #endregion

        //[Sudhir.jangra][GEOS2-2922][29/03/2023]
        public List<DetectionDetails> GetAllStructureDetectionsWaysOptionsSpareParts_V2370(string PCMConnectionString, string DetectionImagePath)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllStructureDetections_V2370", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["ImageCount"] != DBNull.Value)//[rdixit][GEOS2-2922][31.03.2023]
                            {
                                detectionDetails.ImageCount = Convert.ToString(DetectionDetailReader["ImageCount"]) + " " + "Image(s)";
                                detectionDetails.IsImageExist = true;
                                detectionDetails.IsImageVisible = Visibility.Visible;
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            if (detectionDetails.DetectionAllGroupList == null)
                                detectionDetails.DetectionAllGroupList = new List<DetectionGroup>();
                            detectionDetails.DetectionAllGroupList = GetDetectionAllGroupsList(PCMConnectionString);
                            if (detectionDetails.DetectionAllGroupList != null && detectionDetails.IdDetectionType != 0)
                            {
                                if (detectionDetails.DetectionGroupList == null)
                                    detectionDetails.DetectionGroupList = new List<DetectionGroup>();
                                detectionDetails.DetectionGroupList = detectionDetails.DetectionAllGroupList.Where(i => i.IdDetectionType == detectionDetails.IdDetectionType).ToList();
                            }
                            detectionList.Add(detectionDetails);

                        }
                        #region Commented [rdixit][GEOS2-2922][31.03.2023]
                        //if (DetectionDetailReader.NextResult())
                        //{
                        //    while (DetectionDetailReader.Read())
                        //    {
                        //        try
                        //        {
                        //            if (DetectionDetailReader["IdDetection"] != DBNull.Value)
                        //            {
                        //                DetectionDetails detectionImage = detectionList.Where(i => i.IdDetections == Convert.ToInt32(DetectionDetailReader["IdDetection"])).FirstOrDefault();

                        //                if (detectionImage != null)
                        //                {
                        //                    detectionImage.IsImageExist = true;
                        //                    detectionImage.IsImageVisible = Visibility.Visible;
                        //                    detectionImage.DetectionImage = new DetectionImage();
                        //                    detectionImage.DetectionImage.IdDetection = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);
                        //                    var Id = detectionImage.DetectionImage.IdDetection;
                        //                    detectionImage.DetectionImageCount = new ObservableCollection<DetectionImage>();
                        //                    detectionImage.DetectionImageCount = GetDetectionImagesByIdDetection_V2370(PCMConnectionString, Id, DetectionImagePath);
                        //                    detectionImage.ImageCount = detectionImage.DetectionImageCount.Count() + " " + "Image(s)";
                        //                }

                        //            }
                        //        }
                        //        catch (Exception ex)
                        //        {
                        //            Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2370().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        //            throw;
                        //        }
                        //    }
                        //}
                        #endregion
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllStructureDetectionsWaysOptionsSpareParts_V2340().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        //[Sudhir.Jangra][GEOS2-4468][01/06/2023]
        public DetectionDetails AddDetection_V2400(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2330", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (detectionDetails.IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", null);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                        AddRelatedModulesByDetection_V2400(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.ProductTypesList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }



        //[Sudhir.Jangra][GEOS2-4468][01/06/2023]

        public void AddRelatedModulesByDetection_V2400(string connectionString, UInt32 IdDetection,List<ProductTypes> productTypeList)
        {
            try
            {
                if (productTypeList!=null)
                {
                    using (MySqlConnection mySqlConnection =new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypes productTypes in productTypeList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_Related_Modules_By_Detection_Insert_V2400", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", productTypes.IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", productTypes.IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_OrderNumber", productTypes.OrderNumber);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddRelatedModulesByDetection(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        #region GEOS2-4460 Sudhir.Jangra 26/06/2023
        public List<ProductTypes> GetProductTypesByDetection_V2410(string PCMConnectionString)
        {
            List<ProductTypes> productTypesList = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetProductTypesByIdDetection_V2410", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes productTypes = new ProductTypes();

                            if (reader["ProductCode"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(reader["ProductCode"]);
                            }
                            if (reader["ProductTemplate"] != DBNull.Value)
                            {
                                productTypes.Template = new Template();
                                productTypes.Template.Name = Convert.ToString(reader["ProductTemplate"]);
                            }
                            if (reader["ProductName"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(reader["ProductName"]);
                            }
                            if (reader["ProductDescription"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(reader["ProductDescription"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["ProductStatus"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(reader["ProductStatus"]);
                                }
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                productTypes.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt32(reader["IdTemplate"]);
                            }
                            if (reader["Abbreviation"]!=DBNull.Value)
                            {
                                productTypes.Abbreviation = Convert.ToString(reader["Abbreviation"]);
                            }
                            #region GEOS2-4091&GEOS2-4092
                            try
                            {
                                if (reader["ProductName_es"] != DBNull.Value)
                                {
                                    productTypes.Name_es = Convert.ToString(reader["ProductName_es"]);
                                }
                                if (reader["ProductName_fr"] != DBNull.Value)
                                {
                                    productTypes.Name_fr = Convert.ToString(reader["ProductName_fr"]);
                                }
                                if (reader["ProductName_pt"] != DBNull.Value)
                                {
                                    productTypes.Name_pt = Convert.ToString(reader["ProductName_pt"]);
                                }
                                if (reader["ProductName_ro"] != DBNull.Value)
                                {
                                    productTypes.Name_ro = Convert.ToString(reader["ProductName_ro"]);
                                }
                                if (reader["ProductName_ru"] != DBNull.Value)
                                {
                                    productTypes.Name_ru = Convert.ToString(reader["ProductName_ru"]);
                                }
                                if (reader["ProductName_zh"] != DBNull.Value)
                                {
                                    productTypes.Name_zh = Convert.ToString(reader["ProductName_zh"]);
                                }
                                if (reader["ProductDescription_es"] != DBNull.Value)
                                {
                                    productTypes.Description_es = Convert.ToString(reader["ProductDescription_es"]);
                                }
                                if (reader["ProductDescription_fr"] != DBNull.Value)
                                {
                                    productTypes.Description_fr = Convert.ToString(reader["ProductDescription_fr"]);
                                }
                                if (reader["ProductDescription_pt"] != DBNull.Value)
                                {
                                    productTypes.Description_pt = Convert.ToString(reader["ProductDescription_pt"]);
                                }
                                if (reader["ProductDescription_ro"] != DBNull.Value)
                                {
                                    productTypes.Description_ro = Convert.ToString(reader["ProductDescription_ro"]);
                                }
                                if (reader["ProductDescription_ru"] != DBNull.Value)
                                {
                                    productTypes.Description_ru = Convert.ToString(reader["ProductDescription_ru"]);
                                }
                                if (reader["ProductDescription_zh"] != DBNull.Value)
                                {
                                    productTypes.Description_zh = Convert.ToString(reader["ProductDescription_zh"]);
                                }
                            }
                            catch (Exception) { }
                            #endregion
                            productTypesList.Add(productTypes);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypesByDetection_V2410(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypesList;
        }
        #endregion

        #region V2380
        #region [Sudhir.Jangra] [GEOS2-4221] [11/04/2023]
        /// <summary>
        /// This method is used to insert connector families by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="FamilyList">Get family list details.</param>
        public void AddConnectorFamiliesByProductType_V2380(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> FamilyList)
        {
            try
            {
                if (FamilyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in FamilyList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert_V2380", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                            mySqlCommand.Parameters.AddWithValue("_OrderNumber", familyList.OrderNumber);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddConnectorFamiliesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        //[Sudhir.Jangra][12/04/2023][GEOS2-4221]
        /// <summary>
        /// This method is used to insert Product Type
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public ProductTypes AddProductType_V2380(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType_V2380(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2280(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }
        /// <summary>
        /// This method is used to Add/Delete families by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="FamilyList">The list of family.</param>
        public void AddDeleteFamiliesByProductType_V2380(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> Families)
        {
            try
            {
                if (Families != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in Families)
                        {
                            if (familyList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (familyList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert_V2380", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", familyList.OrderNumber);
                                familyList.IdFamily = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                            else if (familyList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Update_V2380", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", familyList.OrderNumber);
                                familyList.IdFamily = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }

                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteFamiliesByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        /// <summary>
        /// This method is used to update Product Type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2380(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType_V2380(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddProductTypeLogEntry(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2280(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }
        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType_V2380(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType_V2350(PCMConnectionString, productTypes.IdCPType);
                // productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.WayList = GetWaysByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType_V2380(PCMConnectionString, productTypes.IdCPType);
                // productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.jangra][GEOS2-4072][13/12/2022]
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType(PCMConnectionString, productTypes.IdCPType);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2350(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }
        /// <summary>
        /// This method is used to get Families by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Families by Product Type.</returns>
        public List<ConnectorFamilies> GetFamiliesByProductType_V2380(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ConnectorFamilies> ConnectorFamilies = new List<ConnectorFamilies>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFamiliesByCPType_V2380", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ConnectorFamilies ConnectorFamily = new ConnectorFamilies();
                            ConnectorFamily.IdFamily = Convert.ToUInt64(reader["IdFamily"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                ConnectorFamily.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ConnectorFamily.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                ConnectorFamily.OrderNumber = Convert.ToUInt32(reader["OrderNumber"]);
                            }
                            ConnectorFamilies.Add(ConnectorFamily);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetFamiliesByProductType_V2350(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ConnectorFamilies;
        }

        #endregion

        //[rdixit][GEOS2-2922][24.04.2023]
        public List<Articles> GetAllPCMArticles_V2380(string connectionString, string ArticleVisualAidsPath, string ImagePath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2290(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2380", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {




                        while (reader.Read())
                        {
                            Articles article = new Articles();
                            try
                            {
                                article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["Imagecount"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["Imagecount"]) != 0)
                                    {
                                        article.ArticleImageCount = Convert.ToString(reader["Imagecount"]) + " " + "Image(s)"; ;
                                        article.IsImageButtonEnabled = true;
                                        article.IsImageVisible = Visibility.Visible;
                                    }
                                    else
                                    {
                                        article.IsImageButtonEnabled = false;
                                        article.IsImageVisible = Visibility.Collapsed;
                                    }
                                }
                                else
                                {
                                    article.IsImageButtonEnabled = false;
                                    article.IsImageVisible = Visibility.Collapsed;
                                }
                                if (reader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(reader["Reference"]);

                                if (reader["Description"] != DBNull.Value)
                                    article.Description = Convert.ToString(reader["Description"]).Trim();

                                if (reader["Description_es"] != DBNull.Value)
                                    article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                                if (reader["Description_fr"] != DBNull.Value)
                                    article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                                if (reader["Description_ro"] != DBNull.Value)
                                    article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                                if (reader["Description_zh"] != DBNull.Value)
                                    article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                                if (reader["Description_pt"] != DBNull.Value)
                                    article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                                if (reader["Description_ru"] != DBNull.Value)
                                    article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                                article.Visibility = "Hidden";

                                if (reader["ImagePath"] != DBNull.Value)
                                {
                                    article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                    //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                }

                                if (reader["Length"] != DBNull.Value)
                                    article.Length = (float)reader["Length"];

                                if (reader["Width"] != DBNull.Value)
                                    article.Width = (float)reader["Width"];

                                if (reader["Height"] != DBNull.Value)
                                    article.Height = (float)reader["Height"];

                                if (reader["Weight"] != DBNull.Value)
                                    article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                    {
                                        article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                        article.ArticleCategory = new ArticleCategories();
                                        article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    }
                                }

                                if (reader["idArticleSupplier"] != DBNull.Value)
                                    article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                                if (reader["SupplierName"] != DBNull.Value)
                                    article.SupplierName = Convert.ToString(reader["SupplierName"]);

                                if (reader["IsObsolete"] != DBNull.Value)
                                    article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                                if (article.IsObsolete == 0)
                                {
                                    article.WarehouseStatus = WarehouseStatus.Active;
                                }
                                else
                                {
                                    article.WarehouseStatus = WarehouseStatus.Inactive;
                                }


                                if (reader["IdPCMStatus"] != DBNull.Value)
                                    article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                                if (reader["PCMStatus"] != DBNull.Value)
                                    article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                                if (CategoryList != null)
                                {
                                    article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                    article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                                }


                                if (reader["PurchaseQtyMin"] != DBNull.Value)
                                    article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                                if (reader["PurchaseQtyMax"] != DBNull.Value)
                                    article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                                if (reader["IsShareWithCustomer"] != DBNull.Value)
                                    article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                                if (reader["IsSparePartOnly"] != DBNull.Value)
                                    article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                                if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (article.IsShareWithCustomer == 1)
                                    {
                                        article.IdECOSVisibility = 323;
                                    }
                                    else if (article.IsSparePartOnly == 1)
                                    {
                                        article.IdECOSVisibility = 324;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                    {
                                        article.IdECOSVisibility = 325;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                    {
                                        article.IdECOSVisibility = 326;
                                    }
                                }

                                if (reader["PCMDescription"] != DBNull.Value)
                                {
                                    article.PCMDescription = Convert.ToString(reader["PCMDescription"]);
                                    if (!string.IsNullOrEmpty(article.PCMDescription))
                                    {
                                        article.IsRichText = "Yes";
                                    }
                                    else
                                    {
                                        article.IsRichText = "";
                                    }
                                }
                                if (reader["IsRtfText"] != DBNull.Value)
                                {
                                    article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        //[rdixit][GEOS2-2922][24.04.2023]
        public List<DetectionDetails> GetAllStructureDetectionsWaysOptionsSpareParts_V2380(string PCMConnectionString, string DetectionImagePath)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllStructureDetections_V2380", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["ImageCount"] != DBNull.Value)//[rdixit][GEOS2-2922][31.03.2023]
                            {
                                if (Convert.ToInt32(DetectionDetailReader["Imagecount"]) != 0)
                                {
                                    detectionDetails.ImageCount = Convert.ToString(DetectionDetailReader["ImageCount"]) + " " + "Image(s)";
                                    detectionDetails.IsImageExist = true;
                                    detectionDetails.IsImageVisible = Visibility.Visible;
                                }
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                            {
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                            }
                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                                if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            if (detectionDetails.DetectionAllGroupList == null)
                                detectionDetails.DetectionAllGroupList = new List<DetectionGroup>();
                            detectionDetails.DetectionAllGroupList = GetDetectionAllGroupsList(PCMConnectionString);
                            if (detectionDetails.DetectionAllGroupList != null && detectionDetails.IdDetectionType != 0)
                            {
                                if (detectionDetails.DetectionGroupList == null)
                                    detectionDetails.DetectionGroupList = new List<DetectionGroup>();
                                detectionDetails.DetectionGroupList = detectionDetails.DetectionAllGroupList.Where(i => i.IdDetectionType == detectionDetails.IdDetectionType).ToList();
                            }
                            detectionList.Add(detectionDetails);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllStructureDetectionsWaysOptionsSpareParts_V2380().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        //[rdixit][GEOS2-2922][24.04.2023]
        public List<DetectionDetails> GetAllModuleDetectionsWaysOptionsSpareParts_V2380(string PCMConnectionString, string DetectionImagePath)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllModuleDetections_V2380", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            try
                            {
                                detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                                if (DetectionDetailReader["Name"] != DBNull.Value)
                                {
                                    detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                                }
                                if (DetectionDetailReader["ImageCount"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(DetectionDetailReader["Imagecount"]) != 0)
                                    {
                                        detectionDetails.ImageCount = Convert.ToString(DetectionDetailReader["ImageCount"]) + " " + "Image(s)";
                                        detectionDetails.IsImageExist = true;
                                        detectionDetails.IsImageVisible = Visibility.Visible;
                                    }
                                }
                                if (DetectionDetailReader["Description"] != DBNull.Value)
                                {
                                    detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                                }
                                if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                                {
                                    detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                                }
                                if (DetectionDetailReader["Code"] != DBNull.Value)
                                {
                                    detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                                }
                                if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                                {
                                    detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                    detectionDetails.TestTypes = new TestTypes();
                                    detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                    if (DetectionDetailReader["TestName"] != DBNull.Value)
                                    {
                                        detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                    }
                                }
                                if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                                {
                                    detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                    detectionDetails.DetectionTypes = new DetectionTypes();
                                    detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                    if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                    {
                                        detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                    }
                                }
                                if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                                {
                                    detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                    detectionDetails.DetectionGroup = new DetectionGroup();
                                    detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                    if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                    {
                                        detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                    }
                                }
                                if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                                {
                                    detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                                }
                                if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                                {
                                    detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                    detectionDetails.Status = new LookupValue();
                                    detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                    if (DetectionDetailReader["Status"] != DBNull.Value)
                                    {
                                        detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                    }
                                    if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                    {
                                        detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                    }
                                }

                                if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                    detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                                if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                    detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                                if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                    detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                                if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                    detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                                if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 323;
                                    }
                                    else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 324;
                                    }
                                    else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 325;
                                    }
                                    else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                    {
                                        detectionDetails.IdECOSVisibility = 326;
                                    }
                                }
                                if (detectionDetails.DetectionAllGroupList == null)
                                    detectionDetails.DetectionAllGroupList = new List<DetectionGroup>();
                                detectionDetails.DetectionAllGroupList = GetDetectionAllGroupsList(PCMConnectionString);
                                if (detectionDetails.DetectionAllGroupList != null && detectionDetails.IdDetectionType != 0)
                                {
                                    if (detectionDetails.DetectionGroupList == null)
                                        detectionDetails.DetectionGroupList = new List<DetectionGroup>();
                                    detectionDetails.DetectionGroupList = detectionDetails.DetectionAllGroupList.Where(i => i.IdDetectionType == detectionDetails.IdDetectionType).ToList();
                                }
                                detectionList.Add(detectionDetails);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2380().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2380().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        //[rdixit][GEOS2-2922][24.04.2023]
        public List<ProductTypes> GetAllProductTypes_V2380(string PCMConnectionString, string DetectionImagePath)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes_V2380", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }

                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    cpType.Status.HtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                cpType.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["ImageCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ImageCount"]) != 0)
                                {
                                    cpType.ImageCount = Convert.ToString(reader["ImageCount"]) + " " + "Image(s)";
                                    cpType.IsImageExist = true;
                                    cpType.IsImageVisible = Visibility.Visible;
                                }
                            }
                            //cpType.WayList = GetWayListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.WayList= GetWayListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);

                            //cpType.DetectionList = GetDetectionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.DetectionList = GetDetectionListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);


                            //cpType.OptionList = GetOptionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.OptionList = GetOptionListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);

                            //cpType.SparePartList = GetSparePartListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.SparePartList = GetSparePartListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }

        //[rdixit][GEOS2-2922][24.04.2023]
        public List<PCMArticleImage> GetArticleImage_V2380(string PCMConnectionString, string ArticleVisualAidsPath, Articles article)
        {
            List<PCMArticleImage> PCMArticleImageList = new List<PCMArticleImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticleImage_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            PCMArticleImage PCMImage = new PCMArticleImage();
                            PCMImage.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                            if (reader["IdPCMArticleImage"] != DBNull.Value)
                            {
                                PCMImage.IdPCMArticleImage = Convert.ToUInt32(reader["IdPCMArticleImage"]);
                            }
                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                PCMImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                PCMImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                PCMImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                PCMImage.Position = Convert.ToUInt32(reader["Position"]);
                            }
                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                            {
                                PCMImage.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);
                            }
                            if (PCMImage.IdPCMArticleImage == 0)
                                PCMImage.PCMArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            PCMArticleImageList.Add(PCMImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error PCM_GetAllPCMArticleImage_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return PCMArticleImageList;
        }

        //[rdixit][GEOS2-2922][24.04.2023]
        public ObservableCollection<DetectionImage> GetDetectionImagesByIdDetection_V2380(string PCMConnectionString, UInt32 IdDetection, string DetectionImagePath)
        {
            ObservableCollection<DetectionImage> DetectionImages = new ObservableCollection<DetectionImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllDetectionImages_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionImage DetectionImage = new DetectionImage();

                            DetectionImage.IdDetectionImage = Convert.ToUInt32(reader["IdDetectionImage"]);
                            DetectionImage.IdDetection = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                DetectionImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                DetectionImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                DetectionImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                DetectionImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdateDate"] != DBNull.Value)
                            {
                                DetectionImage.UpdatedDate = Convert.ToDateTime(reader["UpdateDate"]);
                            }
                            //DetectionImage.DetectionImageInBytes = GetDetectionImage(DetectionImage.IdDetectionImage.ToString(), DetectionImagePath, DetectionImage.SavedFileName);
                            DetectionImages.Add(DetectionImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionImagesByIdDetection_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionImages;
        }

        //[rdixit][GEOS2-2922][24.04.2023]
        public List<ProductTypeImage> GetProductTypeImagesByIdProductTypeForGrid_V2380(string PCMConnectionString, UInt64 IdProductType, string ProductTypeImagePath)
        {
            List<ProductTypeImage> ProductTypeImages = new List<ProductTypeImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeImagesByIdCPType", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdProductType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeImage ProductTypeImage = new ProductTypeImage();

                            ProductTypeImage.IdCPTypeImage = Convert.ToUInt64(reader["IdCPTypeImage"]);
                            ProductTypeImage.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                ProductTypeImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                ProductTypeImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                ProductTypeImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeImage.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            //ProductTypeImage.ProductTypeImageInBytes = GetProductTypeImage(Convert.ToString(ProductTypeImage.IdCPTypeImage), ProductTypeImagePath, ProductTypeImage.SavedFileName);
                            ProductTypeImages.Add(ProductTypeImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeImagesByIdProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeImages;
        }




        #region GEOS2-4221 Sudhir.Jangra 
        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType_V2390(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType_V2350(PCMConnectionString, productTypes.IdCPType);
                // productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.WayList = GetWaysByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType_V2380(PCMConnectionString, productTypes.IdCPType);
                // productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.jangra][GEOS2-4072][13/12/2022]
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType(PCMConnectionString, productTypes.IdCPType);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //Add new list for detection list withoutgroup
                productTypes.DetectionListWithoutGroup = GetDetectionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionListWithoutGroup = GetOptionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartListWithoutGroup = GetSparePartsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //Add new list for detection list withoutgroup END



                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2350(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        /// <summary>
        /// This method is used to get Detection order Groups with detections by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions by cptype.</returns>
        public List<Detections> GetDetectionsWithGroupsByCpType_V2390(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                //  detectionGroups = GetDetectionGroupsByCPType(PCMConnectionString, 2, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                detectionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                detectionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                detectionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                detectionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                detectionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                detectionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detectionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                detectionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                detectionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                detectionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                detectionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                detectionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                detectionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                detectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<Options> GetOptionsWithGroupsByCpType_V2390(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                // OptionGroups = GetOptionGroupsByCPType(PCMConnectionString, 3, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                OptionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                OptionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                OptionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                OptionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                OptionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                OptionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                OptionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                OptionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                OptionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                OptionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                OptionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                OptionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                OptionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                OptionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            OptionGroups.Add(OptionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }


        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<SpareParts> GetSparePartsWithGroupsByCpType_V2390(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SparePartGroups = new List<SpareParts>();
            try
            {
                // SparePartGroups = GetSparePartsGroupsByCPType(PCMConnectionString, 4, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePartGroup = new SpareParts();

                            SparePartGroup.Key = Convert.ToString(reader["IdDetection"]);

                            SparePartGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                SparePartGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePartGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                SparePartGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                SparePartGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                SparePartGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                SparePartGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePartGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePartGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SparePartGroups.Add(SparePartGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SparePartGroups;
        }

        #endregion

        //[Sudhir.Jangra][GEOS2-4460][28/06/2023]
        public bool UpdateDetection_V2410(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2340", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    //AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionFiles_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);//[GEOS2-4074][12.12.2022][rdixit]
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    AddUpdateDeleteDetectionRelatedModule(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.ProductTypesList);

                    //
                    AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.ModifiedBy);
                    AddBasePriceListLogEntry(MainServerConnectionString, detectionDetails.BasePriceLogEntryList);
                    AddCustomerPriceListLogEntry(MainServerConnectionString, detectionDetails.CustomerPriceLogEntryList);
                    if(detectionDetails.ProductTypesList.Count>0&& detectionDetails.ProductTypeChangeLogList.Count > 0)
                    {
                        List<ulong> IdCpTypeList = detectionDetails.ProductTypesList.Select(i=>i.IdCPType).Distinct().ToList();
                        foreach (var item in IdCpTypeList)
                        {
                            var ChangeLogList = detectionDetails.ProductTypeChangeLogList.Where(i => i.IdCPType == item).ToList();
                            AddProductTypeLogEntry(MainServerConnectionString, item, ChangeLogList);
                        }
                       
                    }
                    //
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection_V2410(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }



        //[Sudhir.Jangra][GEOS2-4460][28/06/2023]
        public void AddUpdateDeleteDetectionRelatedModule(string MainServerConnectionString,UInt32 IdDetection,List<ProductTypes>DetectionRelatedModuleList)
        {
            try
            {
                if (DetectionRelatedModuleList!=null)
                {
                    using (MySqlConnection mySqlConnection=new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypes detectionRelatedModuleList in DetectionRelatedModuleList)
                        {
                            if (detectionRelatedModuleList.TransactionOperation==ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_RelatedModules_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", detectionRelatedModuleList.IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdCpType", detectionRelatedModuleList.IdCPType);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (detectionRelatedModuleList.TransactionOperation==ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_RelatedModules_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", detectionRelatedModuleList.IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdCpType", detectionRelatedModuleList.IdCPType);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionRelatedModule(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        #endregion
        //Shubham[skadam]  GEOS2-4394 Modify some names in email about changes in Commercial Catalogue 28 07 2023 
        public bool IsPCMAnnouncementEmailSend_V2420(string mailServerName, string mailServerPort, string commandTimeout, string PCMAnnouncementEmailTemplate,
        string EmployeeContactEmail, Dictionary<string, byte[]> AnnouncementFilebyte)
        {
            bool isSend = false;
            try
            {
                Utility.MailControl.SendHtmlMailWithMultipleAttachment("[PCM] Latest changes in Commercial Catalogue", PCMAnnouncementEmailTemplate.ToString(),
                    string.Join(";", EmployeeContactEmail),"PCM-noreply@emdep.com", mailServerName, mailServerPort, AnnouncementFilebyte);
                isSend = true;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsPCMAnnouncementEmailsend(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isSend;
        }
        //Shubham[skadam]  GEOS2-4394 Modify some names in email about changes in Commercial Catalogue 28 07 2023 
        public PCMAnnouncementEmailDetails GetEmailForDows_V2420(DateTime startDate, DateTime endDate, string PCMConnectionString, string emailTemplatePath,
           string mailServerName, string mailServerPort, string commandTimeout, Boolean NewChangeType, Boolean UpdateChangeType,
           string PCMAnnouncementEmailTemplate, string EmployeeContactEmail)
        {
            PCMAnnouncementEmailDetails emailDetail = new PCMAnnouncementEmailDetails();
            DataSet dataSet = new DataSet();
            System.Globalization.Calendar cal = new System.Globalization.CultureInfo("en-US").Calendar;
            using (MySqlConnection connOtItem = new MySqlConnection(PCMConnectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("PCM_GetEmailForDOWS_V2420", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_StartDate", startDate);
                otItemCommand.Parameters.AddWithValue("_EndDate", endDate);
                otItemCommand.Parameters.AddWithValue("_NewChangeType", NewChangeType);
                otItemCommand.Parameters.AddWithValue("_UpdateChangeType", UpdateChangeType);

                otItemCommand.CommandTimeout = Convert.ToInt32(commandTimeout);
                using (MySqlDataAdapter adap = new MySqlDataAdapter(otItemCommand))
                {
                    adap.Fill(dataSet);
                }
            }
            if (dataSet != null && dataSet.Tables.Count > 0)
            {
                if (dataSet.Tables[0] != null && dataSet.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow ItemReader in dataSet.Tables[0].Rows)
                    {
                        try
                        {
                            try
                            {
                                if (emailDetail.DetectionEmailDetails == null)
                                {
                                    emailDetail.DetectionEmailDetails = new List<PCMDetectionEmailDetails>();
                                }
                                PCMDetectionEmailDetails pcmDetectionEmailDetails = new PCMDetectionEmailDetails();
                                if (ItemReader["DetectionCreatedIn"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionCreatedIn = Convert.ToDateTime(ItemReader["DetectionCreatedIn"]);
                                    int week = cal.GetWeekOfYear(pcmDetectionEmailDetails.DetectionCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                    pcmDetectionEmailDetails.Week = week;
                                }
                                if (ItemReader["DetectionModifiedIn"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionModifiedIn = Convert.ToDateTime(ItemReader["DetectionModifiedIn"]);
                                    if (pcmDetectionEmailDetails.Week == 0)
                                    {
                                        int week = cal.GetWeekOfYear(pcmDetectionEmailDetails.DetectionModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        pcmDetectionEmailDetails.Week = week;
                                    }
                                }
                                if (ItemReader["DetectionName"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionName = Convert.ToString(ItemReader["DetectionName"]);
                                }
                                if (ItemReader["DetectionType"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.DetectionType = Convert.ToInt16(ItemReader["DetectionType"]);
                                }
                                if (ItemReader["IdDetection"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.Id = Convert.ToInt16(ItemReader["IdDetection"]);
                                }
                                if (ItemReader["Type"] != DBNull.Value)
                                {
                                    pcmDetectionEmailDetails.Type = Convert.ToString(ItemReader["Type"]);
                                    if (pcmDetectionEmailDetails.Type.ToLower() == "new".ToLower())
                                    {
                                        pcmDetectionEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["DetectionCreatedIn"]);
                                    }
                                    else
                                    {
                                        pcmDetectionEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["DetectionModifiedIn"]);
                                    }
                                }
                                emailDetail.DetectionEmailDetails.Add(pcmDetectionEmailDetails);
                            }
                            catch (Exception)
                            {

                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmailForDows_V2420(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (dataSet.Tables[1] != null && dataSet.Tables[1].Rows.Count > 0)
                    {
                        foreach (DataRow ItemReader in dataSet.Tables[1].Rows)
                        {
                            try
                            {
                                try
                                {
                                    if (emailDetail.PCMCPTypesDetails == null)
                                    {
                                        emailDetail.PCMCPTypesDetails = new List<PCMCPTypesEmailDetails>();
                                    }
                                    PCMCPTypesEmailDetails pcmCPTypesEmailDetails = new PCMCPTypesEmailDetails();

                                    if (ItemReader["CPCreatedIn"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPCreatedIn = Convert.ToDateTime(ItemReader["CPCreatedIn"]);
                                        int week = cal.GetWeekOfYear(pcmCPTypesEmailDetails.CPCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        pcmCPTypesEmailDetails.Week = week;
                                    }
                                    if (ItemReader["CPModifiedIn"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPModifiedIn = Convert.ToDateTime(ItemReader["CPModifiedIn"]);
                                        if (pcmCPTypesEmailDetails.Week == 0)
                                        {
                                            int week = cal.GetWeekOfYear(pcmCPTypesEmailDetails.CPModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                            pcmCPTypesEmailDetails.Week = week;
                                        }
                                    }
                                    if (ItemReader["CPName"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPName = Convert.ToString(ItemReader["CPName"]);
                                    }
                                    if (ItemReader["CPCode"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPCode = Convert.ToString(ItemReader["CPCode"]);
                                    }
                                    if (ItemReader["CPType"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.CPType = Convert.ToInt32(ItemReader["CPType"]);
                                        pcmCPTypesEmailDetails.IdTemplate = Convert.ToUInt64(ItemReader["CPType"]);
                                    }
                                    if (ItemReader["IdCPType"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.IdCPType = Convert.ToUInt64(ItemReader["IdCPType"]);
                                    }
                                    if (ItemReader["Type"] != DBNull.Value)
                                    {
                                        pcmCPTypesEmailDetails.Type = Convert.ToString(ItemReader["Type"]);
                                        if (pcmCPTypesEmailDetails.Type.ToLower() == "new".ToLower())
                                        {
                                            pcmCPTypesEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["CPCreatedIn"]);
                                        }
                                        else
                                        {
                                            pcmCPTypesEmailDetails.ReportDate = Convert.ToDateTime(ItemReader["CPModifiedIn"]);
                                        }
                                    }
                                    emailDetail.PCMCPTypesDetails.Add(pcmCPTypesEmailDetails);
                                }
                                catch (Exception)
                                {
                                }

                            }

                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmailForDows_V2420(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (dataSet.Tables[2] != null && dataSet.Tables[2].Rows.Count > 0)
                    {

                        foreach (DataRow ItemReader in dataSet.Tables[2].Rows)
                        {
                            try
                            {
                                try
                                {
                                    if (emailDetail.PCMArticleDetails == null)
                                    {
                                        emailDetail.PCMArticleDetails = new List<PCMArticlesEmailDetails>();
                                    }
                                    PCMArticlesEmailDetails articles = new PCMArticlesEmailDetails();
                                    if (ItemReader["ArticleCreatedIn"] != DBNull.Value)
                                    {
                                        articles.ArticleCreatedIn = Convert.ToDateTime(ItemReader["ArticleCreatedIn"]);
                                        int week = cal.GetWeekOfYear(articles.ArticleCreatedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                        articles.Week = week;
                                    }
                                    if (ItemReader["ArticleModifiedIn"] != DBNull.Value)
                                    {
                                        articles.ArticleModifiedIn = Convert.ToDateTime(ItemReader["ArticleModifiedIn"]);
                                        if (articles.Week == 0)
                                        {
                                            int week = cal.GetWeekOfYear(articles.ArticleModifiedIn, System.Globalization.CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                            articles.Week = week;
                                        }
                                    }
                                    if (ItemReader["ArticleReference"] != DBNull.Value)
                                    {
                                        articles.ArticleReference = Convert.ToString(ItemReader["ArticleReference"]);
                                    }
                                    if (ItemReader["ArticleDescription"] != DBNull.Value)
                                    {
                                        articles.ArticleDescription = Convert.ToString(ItemReader["ArticleDescription"]);
                                    }
                                    if (ItemReader["Type"] != DBNull.Value)
                                    {
                                        articles.Type = Convert.ToString(ItemReader["Type"]);
                                        if (articles.Type.ToLower() == "new".ToLower())
                                        {
                                            articles.ReportDate = Convert.ToDateTime(ItemReader["ArticleCreatedIn"]);
                                        }
                                        else
                                        {
                                            articles.ReportDate = Convert.ToDateTime(ItemReader["ArticleModifiedIn"]);
                                        }
                                    }
                                    emailDetail.PCMArticleDetails.Add(articles);
                                }
                                catch (Exception)
                                {
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmailForDows_V2420(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }

                }

            }
            return emailDetail;
        }


        #region GEOS2-4733
        //[Sudhir.Jangra][GEOS2-4733][22/08/2023]
        public List<Options> GetAllOptionsWithGroups_V2430(string PCMConnectionString,int IdScope)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                OptionGroups = GetOptionGroups_V2430(PCMConnectionString, 3, IdScope);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdScope", IdScope);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }

                            OptionGroups.Add(OptionGroup);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllOptionsWithGroups_V2430(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }

        //[Sudhir.Jangra][GEOS2-4733][22/08/2023]
        public List<Detections> GetAllDetectionsWithGroups_V2430(string PCMConnectionString,int IdScope)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                detectionGroups = GetDetectionGroups_V2430(PCMConnectionString, 2, IdScope);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByType_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdScope", IdScope);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionsWithGroups_V2430(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }
        #endregion

        //[PRAMOD.MISAL][GEOS2-4442][29-08-2023]
        public List<FreePlugins> GetAllFreePlugins_byPermission(string PLMConnectionString)
        {
            List<FreePlugins> Obj = new List<FreePlugins>();
            List<string> CurrencyIcon = new List<string>();
            
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFreeplugins_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                  
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            FreePlugins freePlugins = new FreePlugins();

                            if (reader["IdPlugin"] != DBNull.Value)
                            {
                                freePlugins.IdPlugin = Convert.ToInt64(reader["IdPlugin"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                freePlugins.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Group"] != DBNull.Value)
                            {
                                freePlugins.Group = Convert.ToString(reader["Group"]).Trim();
                            }

                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                freePlugins.IdCustomer =Convert.ToInt64(reader["IdCustomer"]);
                            }
                            if (reader["IdRegion"]!=DBNull.Value)
                            {
                                freePlugins.IdRegion = Convert.ToInt32(reader["IdRegion"]);
                            }
                            if (reader["Region"] != DBNull.Value)
                            {
                                freePlugins.Region = Convert.ToString(reader["Region"]).Trim();
                            }
                            if (reader["iso"] != DBNull.Value)
                            {
                                freePlugins.Iso = Convert.ToString(reader["iso"]).Trim();
                            }
                            if (reader["iso3"] != DBNull.Value)
                            {
                                freePlugins.Iso3 = Convert.ToString(reader["iso3"]).Trim();
                            }
                            if (reader["Country"] != DBNull.Value)
                            {
                                freePlugins.Country = Convert.ToString(reader["Country"]);
                            }
                            if (reader["IdSite"]!=DBNull.Value)
                            {
                                freePlugins.IdSite = Convert.ToUInt32(reader["IdSite"]);
                            }
                            if (reader["Plant"] != DBNull.Value)
                            {
                                string input = Convert.ToString(reader["Plant"]);
                                string[] parts = input.Split('(');
                                freePlugins.Plant = parts[0];

                               // freePlugins.Plant
                            }

                            if (reader["IdCountry"] != DBNull.Value)
                            {
                                freePlugins.IdCountry = Convert.ToInt32(reader["IdCountry"]);
                                freePlugins.CountryforIcon = new Country();
                                freePlugins.CountryforIcon.Iso = Convert.ToString(reader["iso"]);

                                if (reader["iso"] != DBNull.Value)
                                {
                                    freePlugins.CountryforIcon.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + freePlugins.CountryforIcon.Iso + ".png";

                                }

                            }


                            Obj.Add(freePlugins);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllFreePlugins_byPermission(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
          
            return Obj;
        }

        //chitra[cgirigosavi][GEOS2-4443][15/09/2023]
        public FreePlugins AddUpdateFreePlugins(string PLMConnectionString, FreePlugins freePlugins)
        {
            try
            {
                int itemCount;
                if (freePlugins != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                    {
                        mySqlConnection.Open();
                        if (freePlugins.TransactionOperation == ModelBase.TransactionOperations.Add)
                        {
                            MySqlCommand command = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                            command.CommandType = CommandType.StoredProcedure;

                            command.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                            command.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);


                            List<int> selectedRegion = freePlugins.SelectedRegion;
                            List<int> selectedCountry = freePlugins.SelectedCountry;
                            List<UInt32> selectedPlant = freePlugins.SelectedPlant;

                            if (selectedRegion != null && selectedCountry != null && selectedPlant != null)
                            {
                                itemCount = Math.Max(selectedRegion.Count, Math.Max(selectedCountry.Count, selectedPlant.Count));

                                for (int i = 0; i < itemCount; i++)
                                {
                                    int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                    int country = i < selectedCountry.Count ? selectedCountry[i] : 0;
                                    UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                    MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                    subCommand.CommandType = CommandType.StoredProcedure;

                                    subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                    subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);

                                    subCommand.Parameters.AddWithValue("_IdRegion", region);
                                    subCommand.Parameters.AddWithValue("_IdCountry", country);
                                    subCommand.Parameters.AddWithValue("_IdSite", plant);

                                    subCommand.ExecuteNonQuery();
                                }

                            }
                            else
                            {  
                                if (selectedRegion == null && selectedCountry != null && selectedPlant != null)
                                {
                                    itemCount = Math.Max(selectedCountry.Count, selectedPlant.Count);
                                    for (int i = 0; i < itemCount; i++)
                                    {
                                     
                                        int country = i < selectedCountry.Count ? selectedCountry[i] : 0;
                                        UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                        subCommand.Parameters.AddWithValue("_IdRegion", null);
                                        subCommand.Parameters.AddWithValue("_IdCountry", country);
                                        subCommand.Parameters.AddWithValue("_IdSite", plant);

                                        subCommand.ExecuteNonQuery();
                                    }
                                }
                                else if (selectedRegion == null && selectedCountry == null && selectedPlant != null)
                                {
                                    itemCount = selectedPlant.Count; 
                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                        subCommand.Parameters.AddWithValue("_IdRegion", null);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", plant);

                                        subCommand.ExecuteNonQuery();
                                    }
                                }

                                else if (selectedRegion != null && selectedCountry == null && selectedPlant == null)
                                {
                                    itemCount = selectedRegion.Count;
                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                     

                                        MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", null);

                                        subCommand.ExecuteNonQuery();
                                    }
                                }

                                else if (selectedRegion != null && selectedCountry == null && selectedPlant != null)
                                {
                                    itemCount = Math.Max(selectedRegion.Count, selectedPlant.Count);

                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                     
                                        UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", plant);

                                        subCommand.ExecuteNonQuery();
                                    }
                                }

                                else if (selectedPlant == null && selectedCountry == null && selectedRegion != null)
                                {
                                    itemCount = selectedRegion.Count;

                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                      

                                        MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", null);

                                        subCommand.ExecuteNonQuery();
                                    }
                                }

                                else if (selectedRegion == null && selectedCountry == null && selectedPlant != null)
                                {
                                    itemCount = selectedPlant.Count;
                                    for (int i = 0; i < itemCount; i++)
                                    {
                                      
                                        UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                        subCommand.Parameters.AddWithValue("_IdRegion", null);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", plant);

                                        subCommand.ExecuteNonQuery();
                                    }
                                }

                                else if (selectedRegion == null && selectedCountry == null && selectedPlant == null)
                                {
                                    MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                    subCommand.CommandType = CommandType.StoredProcedure;

                                    subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                    subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);

                                    subCommand.Parameters.AddWithValue("_IdRegion", null);
                                    subCommand.Parameters.AddWithValue("_IdCountry", null);
                                    subCommand.Parameters.AddWithValue("_IdSite", null);

                                    subCommand.ExecuteNonQuery();
                                }

                                else if (selectedPlant == null && selectedCountry != null && selectedRegion != null)
                                {
                                    itemCount = Math.Max(selectedRegion.Count, selectedCountry.Count);

                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                        int country = i < selectedCountry.Count ? selectedCountry[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", country);
                                        subCommand.Parameters.AddWithValue("_IdSite", null);

                                        subCommand.ExecuteNonQuery();
                                    }
                                }






                            }




                        }

                        else if (freePlugins.TransactionOperation == ModelBase.TransactionOperations.Update)
                        {
                            MySqlCommand command1 = new MySqlCommand("PCM_DeleteFreePlugin_V2440", mySqlConnection);
                            command1.CommandType = CommandType.StoredProcedure;
                            command1.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                            command1.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                            if (freePlugins.IdRegion == 0)
                            {
                                command1.Parameters.AddWithValue("_IdRegion", null);
                            }
                            else
                            {
                                command1.Parameters.AddWithValue("_IdRegion", freePlugins.IdRegionPrevious);
                            }
                            if (freePlugins.IdCountry == 0)
                            {
                                command1.Parameters.AddWithValue("_IdCountry", null);
                            }
                            else
                            {
                                command1.Parameters.AddWithValue("_IdCountry", freePlugins.IdCountryPrevious);
                            }
                            if (freePlugins.IdSite == 0)
                            {
                                command1.Parameters.AddWithValue("_IdSite", null);
                            }
                            else
                            {
                                command1.Parameters.AddWithValue("_IdSite", freePlugins.IdPlantPrevious);
                            }

                            command1.ExecuteNonQuery();
                            mySqlConnection.Close();
                            mySqlConnection.Open();

                            MySqlCommand command = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                            command.CommandType = CommandType.StoredProcedure;
                    
                            command.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                            command.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                            List<int> selectedRegion = freePlugins.SelectedRegion;
                            List<int> selectedCountry = freePlugins.SelectedCountry;
                            List<UInt32> selectedPlant = freePlugins.SelectedPlant;

                            if (selectedRegion != null && selectedCountry != null && selectedPlant != null)
                            {
                                itemCount = Math.Max(selectedRegion.Count, Math.Max(selectedCountry.Count, selectedPlant.Count));

                                for (int i = 0; i < itemCount; i++)
                                {
                                    int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                    int country = i < selectedCountry.Count ? selectedCountry[i] : 0;
                                    UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                    MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                    subCommand.CommandType = CommandType.StoredProcedure;

                                    subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                    subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                    subCommand.Parameters.AddWithValue("_IdRegion", region);
                                    subCommand.Parameters.AddWithValue("_IdCountry", country);
                                    subCommand.Parameters.AddWithValue("_IdSite", plant);
                                  

                                    subCommand.ExecuteNonQuery();
                                }
                            }
                            else
                            {
                                if (selectedRegion == null && selectedCountry != null && selectedPlant != null)
                                {
                                    itemCount = Math.Max(selectedCountry.Count, selectedPlant.Count);
                                    for (int i = 0; i < itemCount; i++)
                                    {
                                       
                                        int country = i < selectedCountry.Count ? selectedCountry[i] : 0;
                                        UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                    
                                        subCommand.Parameters.AddWithValue("_IdRegion", null);
                                        subCommand.Parameters.AddWithValue("_IdCountry", country);
                                        subCommand.Parameters.AddWithValue("_IdSite", plant);
                                      

                                        subCommand.ExecuteNonQuery();
                                    }
                                }
                                else if (selectedRegion == null && selectedCountry == null && selectedPlant != null)
                                {
                                    itemCount = selectedPlant.Count;
                                    for (int i = 0; i < itemCount; i++)
                                    {
                                       
                                        UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                 
                                        subCommand.Parameters.AddWithValue("_IdRegion", null);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", plant);
                                      

                                        subCommand.ExecuteNonQuery();
                                    }
                                }
                                else if (selectedRegion != null && selectedCountry == null && selectedPlant == null)
                                {
                                    itemCount = selectedRegion.Count;

                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                       

                                        MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                     
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", null);
                                       

                                        subCommand.ExecuteNonQuery();
                                    }
                                }
                                else if (selectedRegion != null && selectedCountry == null && selectedPlant != null)
                                {
                                    itemCount = Math.Max(selectedRegion.Count, selectedPlant.Count);

                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                      
                                        UInt32 plant = i < selectedPlant.Count ? selectedPlant[i] : 0;

                                        MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                    
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", plant);
                                       

                                        subCommand.ExecuteNonQuery();
                                    }
                                }
                                else if (selectedPlant == null && selectedCountry != null && selectedRegion != null)
                                {
                                    itemCount = Math.Max(selectedRegion.Count, selectedCountry.Count);

                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                        int country = i < selectedCountry.Count ? selectedCountry[i] : 0;
                                     

                                        MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                   
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", country);
                                        subCommand.Parameters.AddWithValue("_IdSite", null);
                                      

                                        subCommand.ExecuteNonQuery();
                                    }
                                }
                                else if (selectedPlant == null && selectedCountry == null && selectedRegion != null)
                                {
                                    itemCount = selectedRegion.Count;
                                    for (int i = 0; i < itemCount; i++)
                                    {
                                        int region = i < selectedRegion.Count ? selectedRegion[i] : 0;
                                     

                                        MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                        subCommand.CommandType = CommandType.StoredProcedure;

                                        subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                        subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                    
                                        subCommand.Parameters.AddWithValue("_IdRegion", region);
                                        subCommand.Parameters.AddWithValue("_IdCountry", null);
                                        subCommand.Parameters.AddWithValue("_IdSite", null);
                                       

                                        subCommand.ExecuteNonQuery();
                                    }
                                }
                                else if (selectedRegion == null && selectedCountry == null && selectedPlant == null)
                                {
                                    MySqlCommand subCommand = new MySqlCommand("PCM_UpdateFreePlugin_V2430", mySqlConnection);
                                    subCommand.CommandType = CommandType.StoredProcedure;

                                    subCommand.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                    subCommand.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                 
                                    subCommand.Parameters.AddWithValue("_IdRegion", null);
                                    subCommand.Parameters.AddWithValue("_IdCountry", null);
                                    subCommand.Parameters.AddWithValue("_IdSite", null);

                                    subCommand.ExecuteNonQuery();
                                }

                               
                            }

                        }
                       else if (freePlugins.TransactionOperation == ModelBase.TransactionOperations.Delete)
                        {
                            MySqlCommand command = new MySqlCommand("PCM_DeleteFreePlugin_V2440", mySqlConnection);
                            command.CommandType = CommandType.StoredProcedure;
                            command.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                            command.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                            if (freePlugins.IdRegion==0)
                            {
                                command.Parameters.AddWithValue("_IdRegion", null);
                            }
                            else
                            {
                                command.Parameters.AddWithValue("_IdRegion", freePlugins.IdRegion);
                            }
                            if (freePlugins.IdCountry==0)
                            {
                                command.Parameters.AddWithValue("_IdCountry", null);
                            }
                            else
                            {
                                command.Parameters.AddWithValue("_IdCountry", freePlugins.IdCountry);
                            }
                            if (freePlugins.IdSite==0)
                            {
                                command.Parameters.AddWithValue("_IdSite", null);
                            }
                            else
                            {
                                command.Parameters.AddWithValue("_IdSite", freePlugins.IdSite);
                            }
                            
                            command.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateFreePlugins(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return freePlugins;
        }



        //[Sudhir.Jangra][GEOS2-4733]
        /// <summary>
        /// This method is used to get Options Groups.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get Options type</param>
        /// <returns>The list of option Groups.</returns>
        public List<Options> GetOptionGroups_V2430(string PCMConnectionString, UInt32 IdDetectionType,int idScope)
        {
            List<Options> Options = new List<Options>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsWithDetection_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdScope", idScope);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Option.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Option.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Option.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Option.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }

        //[Sudhir.Jangra][GEOS2-4733]
        /// <summary>
        /// This method is used to get Detection Groups.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups.</returns>
        public List<Detections> GetDetectionGroups_V2430(string PCMConnectionString, UInt32 IdDetectionType,int IdScope)
        {
            List<Detections> Detections = new List<Detections>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsWithDetection_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdScope", IdScope);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Detection.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Detection.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Detection.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }

        //chitra[cgirigosavi][GEOS2-4442][31-08-2023]
        public List<FreePlugins> GetAllHardLockPlugins_byPermission(string PLMConnectionString)
        {
            List<FreePlugins> Obj = new List<FreePlugins>();
            List<string> CurrencyIcon = new List<string>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFreePluginsName_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            FreePlugins hardlockPlugins = new FreePlugins();

                            if (reader["Name"] != DBNull.Value)
                            {
                                hardlockPlugins.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["IdPlugin"] != DBNull.Value)
                            {
                                hardlockPlugins.IdPlugin = Convert.ToInt64(reader["IdPlugin"]);
                            }
                            Obj.Add(hardlockPlugins);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllFreePlugins_byPermission(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Obj;
        }

        //[Sudhir.Jangra][GEOS2-4441][21/09/2023]
        public List<HardLockLicenses> GetAllHardLockLicenses_V2440(string connectionString)
        {
            List<HardLockLicenses> hardLockLicenses = new List<HardLockLicenses>();
            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticlesForHardLockPlugins_V2440", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader=mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            HardLockLicenses hardLock = new HardLockLicenses();

                            if (reader["IdArticle"]!=DBNull.Value)
                            {
                                hardLock.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                            }
                            if (reader["IdPCMArticle"] !=DBNull.Value)
                            {
                                hardLock.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            }
                            if (reader["Reference"]!=DBNull.Value)
                            {
                                hardLock.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] !=DBNull.Value)
                            {
                                hardLock.Description = Convert.ToString(reader["Description"]);
                            }
                            hardLock.HardLockPluginList = GetAllHardLockPlugins_V2440(connectionString, hardLock.IdArticle);

                            hardLockLicenses.Add(hardLock);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllHardLockLicenses_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return hardLockLicenses;
        }

        //[Sudhir.jangra][GEOS2-4441][21/09/2023]
        public List<HardLockPlugins> GetAllHardLockPlugins_V2440(string connectionString,UInt32 idArticle)
        {
            List<HardLockPlugins> Plugins = new List<HardLockPlugins>();
            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetPluginsForHardLockPlugins_V2440", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);

                    using (MySqlDataReader reader =mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            HardLockPlugins plug = new HardLockPlugins();
                            if (reader["IdPlugin"]!=DBNull.Value)
                            {
                                plug.IdPlugin = Convert.ToUInt32(reader["IdPlugin"]);
                            }
                            if (reader["Name"]!=DBNull.Value)
                            {
                                plug.Name = Convert.ToString(reader["Name"]);
                            }
                            Plugins.Add(plug);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllHardLockPlugins_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return Plugins;
        }


        //[Sudhir.Jangra][GEOS2-4441]
        public Articles GetArticleByIdArticle_V2440(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, uint IdPCMArticle, string ImagePath, string currencyIconFilePath, string countryImagePath, int IdUser)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2440", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdPCMArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = IdArticle;

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2250(PCMConnectionString, IdArticle, currencyIconFilePath, IdUser);
                article.ArticleDecompostionList = GetArticleDeCompostionByIdArticle(PCMConnectionString, IdArticle);
                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle, IdUser);
                article.ArticleCustomerList = GetCustomersByIdArticleCustomerReferences(PCMConnectionString, IdArticle, countryImagePath);
                article.ArticleSuppliersList = GetArticleSuppliers(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }





        //[Sudhir.Jangra][GEOS2-4809]
        public List<Articles> GetAllPCMArticles_V2440(string connectionString, string ArticleVisualAidsPath, string ImagePath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2290(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2440", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();
                            try
                            {
                                article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["Imagecount"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["Imagecount"]) != 0)
                                    {
                                        article.ArticleImageCount = Convert.ToString(reader["Imagecount"]) + " " + "Image(s)"; ;
                                        article.IsImageButtonEnabled = true;
                                        article.IsImageVisible = Visibility.Visible;
                                    }
                                    else
                                    {
                                        article.IsImageButtonEnabled = false;
                                        article.IsImageVisible = Visibility.Collapsed;
                                    }
                                }
                                else
                                {
                                    article.IsImageButtonEnabled = false;
                                    article.IsImageVisible = Visibility.Collapsed;
                                }
                                if (reader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(reader["Reference"]);

                                if (reader["Description"] != DBNull.Value)
                                    article.Description = Convert.ToString(reader["Description"]).Trim();

                                if (reader["Description_es"] != DBNull.Value)
                                    article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                                if (reader["Description_fr"] != DBNull.Value)
                                    article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                                if (reader["Description_ro"] != DBNull.Value)
                                    article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                                if (reader["Description_zh"] != DBNull.Value)
                                    article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                                if (reader["Description_pt"] != DBNull.Value)
                                    article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                                if (reader["Description_ru"] != DBNull.Value)
                                    article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                                article.Visibility = "Hidden";

                                if (reader["ImagePath"] != DBNull.Value)
                                {
                                    article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                    //article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                                }

                                if (reader["Length"] != DBNull.Value)
                                    article.Length = (float)reader["Length"];

                                if (reader["Width"] != DBNull.Value)
                                    article.Width = (float)reader["Width"];

                                if (reader["Height"] != DBNull.Value)
                                    article.Height = (float)reader["Height"];

                                if (reader["Weight"] != DBNull.Value)
                                    article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                    {
                                        article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                        article.ArticleCategory = new ArticleCategories();
                                        article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    }
                                }

                                if (reader["idArticleSupplier"] != DBNull.Value)
                                    article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                                if (reader["SupplierName"] != DBNull.Value)
                                    article.SupplierName = Convert.ToString(reader["SupplierName"]);

                                if (reader["IsObsolete"] != DBNull.Value)
                                    article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                                if (article.IsObsolete == 0)
                                {
                                    article.WarehouseStatus = WarehouseStatus.Active;
                                }
                                else
                                {
                                    article.WarehouseStatus = WarehouseStatus.Inactive;
                                }


                                if (reader["IdPCMStatus"] != DBNull.Value)
                                    article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                                if (reader["PCMStatus"] != DBNull.Value)
                                    article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                                if (CategoryList != null)
                                {
                                    article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                    article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                                }


                                if (reader["PurchaseQtyMin"] != DBNull.Value)
                                    article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                                if (reader["PurchaseQtyMax"] != DBNull.Value)
                                    article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                                if (reader["IsShareWithCustomer"] != DBNull.Value)
                                    article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                                if (reader["IsSparePartOnly"] != DBNull.Value)
                                    article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                                if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (article.IsShareWithCustomer == 1)
                                    {
                                        article.IdECOSVisibility = 323;
                                    }
                                    else if (article.IsSparePartOnly == 1)
                                    {
                                        article.IdECOSVisibility = 324;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                    {
                                        article.IdECOSVisibility = 325;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                    {
                                        article.IdECOSVisibility = 326;
                                    }
                                }

                                if (reader["PCMDescription"] != DBNull.Value)
                                {
                                    article.PCMDescription = Convert.ToString(reader["PCMDescription"]);
                                    if (!string.IsNullOrEmpty(article.PCMDescription))
                                    {
                                        article.IsRichText = "Yes";
                                    }
                                    else
                                    {
                                        article.IsRichText = "";
                                    }
                                }
                                if (reader["IsRtfText"] != DBNull.Value)
                                {
                                    article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                                }
                                if (reader["WarehouseCreationDate"] !=DBNull.Value)
                                {
                                    article.WarehouseCreationDate = Convert.ToDateTime(reader["WarehouseCreationDate"]);
                                }
                                if (reader["PCMCreationDate"] != DBNull.Value)
                                {
                                    article.PCMCreationDate = Convert.ToDateTime(reader["PCMCreationDate"]);
                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        public bool AddUpdateFreePlugins_V2440(string PLMConnectionString, List<FreePlugins> freePluginsList)
        {
            int itemCount;
            bool result = false;
            try
            {
                foreach (FreePlugins freePlugins in freePluginsList)
                {
                    if (freePlugins != null)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                        {
                            mySqlConnection.Open();
                            if (freePlugins.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand command = new MySqlCommand("PCM_InsertFreePlugins", mySqlConnection);
                                command.CommandType = CommandType.StoredProcedure;

                                command.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                command.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                if (freePlugins.IdRegion == 0)
                                {
                                    command.Parameters.AddWithValue("_IdRegion", null);
                                }
                                else
                                {
                                    command.Parameters.AddWithValue("_IdRegion", freePlugins.IdRegion);
                                }
                                if (freePlugins.IdCountry == 0)
                                {
                                    command.Parameters.AddWithValue("_IdCountry", null);
                                }
                                else
                                {
                                    command.Parameters.AddWithValue("_IdCountry", freePlugins.IdCountry);
                                }
                                if (freePlugins.IdSite == 0)
                                {
                                    command.Parameters.AddWithValue("_IdSite", null);
                                }
                                else
                                {
                                    command.Parameters.AddWithValue("_IdSite", freePlugins.IdSite);
                                }
                                command.ExecuteNonQuery();
                                result = true;
                            }
                            else if (freePlugins.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                //MySqlCommand command1 = new MySqlCommand("PCM_DeleteFreePlugin_V2440", mySqlConnection);
                                //command1.CommandType = CommandType.StoredProcedure;
                                //command1.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                //command1.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                //if (freePlugins.IdRegion == 0)
                                //{
                                //    command1.Parameters.AddWithValue("_IdRegion", null);
                                //}
                                //else
                                //{
                                //    command1.Parameters.AddWithValue("_IdRegion", freePlugins.IdRegionPrevious);
                                //}
                                //if (freePlugins.IdCountry == 0)
                                //{
                                //    command1.Parameters.AddWithValue("_IdCountry", null);
                                //}
                                //else
                                //{
                                //    command1.Parameters.AddWithValue("_IdCountry", freePlugins.IdCountryPrevious);
                                //}
                                //if (freePlugins.IdSite == 0)
                                //{
                                //    command1.Parameters.AddWithValue("_IdSite", null);
                                //}
                                //else
                                //{
                                //    command1.Parameters.AddWithValue("_IdSite", freePlugins.IdPlantPrevious);
                                //}

                                //command1.ExecuteNonQuery();
                                result = true;
                            }
                            else if (freePlugins.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand command = new MySqlCommand("PCM_DeleteFreePlugin_V2440", mySqlConnection);
                                command.CommandType = CommandType.StoredProcedure;
                                command.Parameters.AddWithValue("_IdPlugin", freePlugins.IdPlugin);
                                command.Parameters.AddWithValue("_IdCustomer", freePlugins.IdCustomer);
                                if (freePlugins.IdRegion == 0)
                                {
                                    command.Parameters.AddWithValue("_IdRegion", null);
                                }
                                else
                                {
                                    command.Parameters.AddWithValue("_IdRegion", freePlugins.IdRegion);
                                }
                                if (freePlugins.IdCountry == 0)
                                {
                                    command.Parameters.AddWithValue("_IdCountry", null);
                                }
                                else
                                {
                                    command.Parameters.AddWithValue("_IdCountry", freePlugins.IdCountry);
                                }
                                if (freePlugins.IdSite == 0)
                                {
                                    command.Parameters.AddWithValue("_IdSite", null);
                                }
                                else
                                {
                                    command.Parameters.AddWithValue("_IdSite", freePlugins.IdSite);
                                }
                                command.ExecuteNonQuery();
                                result = true;
                            }
                            
                            mySqlConnection.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateFreePlugins(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return result;
        }


        //[Sudhir.jangra][GEOS2-4901]
        public List<HardLockLicenses> GetArticlesForAddEditHardLockLicense_V2450(string connectionString)
        {
            List<HardLockLicenses> articles = new List<HardLockLicenses>();
            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticlesForAddEditHardLockLicense_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader rdr=mySqlCommand.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            HardLockLicenses article = new HardLockLicenses();

                            article.IdArticle = Convert.ToUInt32(rdr["IdArticle"]);

                            if (rdr["Reference"]!=DBNull.Value)
                            {
                                article.Reference = Convert.ToString(rdr["Reference"]);
                            }
                            if (rdr["IdPCMArticle"]!=DBNull.Value)
                            {
                                article.IdPCMArticle = Convert.ToUInt32(rdr["IdPCMArticle"]);
                            }
                            if (rdr["Description"]!=DBNull.Value)
                            {
                                article.Description = Convert.ToString(rdr["Description"]);
                            }
                            articles.Add(article);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticlesForAddEditHardLockLicense_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        //[Sudhir.jangra][GEOS2-4901]
        public List<HardLockPlugins> GetAllHardLockPluginForAddEditHardLockLicense_V2450(string connectionString)
        {
            List<HardLockPlugins> hardLockPlugins = new List<HardLockPlugins>();
            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("GetHardLockPluginsForAddEditHardLockLicense_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader rdr= mySqlCommand.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            HardLockPlugins plugin = new HardLockPlugins();

                            plugin.IdPlugin = Convert.ToUInt32(rdr["IdPlugin"]);

                            if (rdr["Name"]!=DBNull.Value)
                            {
                                plugin.Name = Convert.ToString(rdr["Name"]);
                            }

                            hardLockPlugins.Add(plugin);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllHardLockPluginForAddEditHardLockLicense_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return hardLockPlugins;
        } 


        //[Sudhir.Jangra][GEOS2-4901]
        public bool AddHardLockLicense_V2450(string connectionString,UInt32 IdArticle,List<HardLockPlugins> pluginList)
        {
            bool isAdded=false;
            try
            {
                if (pluginList!=null&& pluginList.Count>0)
                {
                    using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();
                        foreach (HardLockPlugins item in pluginList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("AddHardLockLicense_V2450", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdPlugin", item.IdPlugin);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                        isAdded = true;
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddHardLockLicense_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isAdded;
        }


        //[Sudhir.Jangra][GEOS2-4901]
        public List<HardLockPlugins> GetSupportedPluginByIdArticle_V2450(string connectionString,UInt32 idArticle)
        {
            List<HardLockPlugins> hardLockPlugins = new List<HardLockPlugins>();
            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSupportedHardLockPluginByIdArticle_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);
                    using (MySqlDataReader rdr=mySqlCommand.ExecuteReader())
                    {
                        while(rdr.Read())
                        {
                            HardLockPlugins plugin = new HardLockPlugins();
                            plugin.IdPlugin = Convert.ToUInt32(rdr["IdPlugin"]);

                            if (rdr["Name"]!=DBNull.Value)
                            {
                                plugin.Name = Convert.ToString(rdr["Name"]);
                            }
                            hardLockPlugins.Add(plugin);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSupportedPluginByIdArticle_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return hardLockPlugins;
        }

        //[Sudhir.jangra][GEOS2-4901]
        public bool DeleteSupportedPluginForHardLockLicense_V2450(string connectionString,UInt32 idPlugin,UInt32 idArticle)
        {
            bool isDeleted = false;

            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DeleteSupportedPluginForHardLockLicense_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);
                    mySqlCommand.Parameters.AddWithValue("_IdPlugin", idPlugin);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    isDeleted = true;
                }
              

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteSupportedPluginForHardLockLicense_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDeleted;
        }

        //[Sudhir.Jangra]
        public HardLockPlugins GetHardLockPluginId_V2450(string connectionString)
        {
            HardLockPlugins HardLockPlugins = new HardLockPlugins();
            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetHardLockPluginId_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader rdr=mySqlCommand.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            if (rdr["IdPlugin"]!=DBNull.Value)
                            {
                                HardLockPlugins.IdPlugin = Convert.ToUInt32(rdr["IdPlugin"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetHardLockPluginId_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return HardLockPlugins;
        }

        //[Sudhir.Jangra][GEOS2-4915]
        public bool AddHardLockPlugin_V2450(string connectionString,UInt32 idPlugin,string Name)
        {
            bool isAdded = false;
            try
            {
                using (MySqlConnection mySqlConnection=new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_AddHardLockPlugin_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    mySqlCommand.Parameters.AddWithValue("_IdPlugin", idPlugin);
                    mySqlCommand.Parameters.AddWithValue("_Name", Name);
                    mySqlCommand.ExecuteNonQuery();

                    mySqlConnection.Close();
                    isAdded = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddHardLockPlugin_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isAdded;
        }
        //[rdixit][GEOS2-4897][01.12.2023]
        public List<Articles> GetAllPCMArticles_V2460(string connectionString, string ArticleVisualAidsPath, string ImagePath, UInt32 idCurrency)
        {
            List<Articles> articles = new List<Articles>();
            List<ArticleCostPrice> AllCurrencyExchange = GetArticleCostPricesByCurrency_V2160(connectionString, idCurrency);
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2290(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2440", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();
                            try
                            {
                                article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                List<ArticleCostPrice> ArticleAllPrices = AllCurrencyExchange.Where(i => i.IdArticle == article.IdArticle).ToList();
                                if (reader["Imagecount"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["Imagecount"]) != 0)
                                    {
                                        article.ArticleImageCount = Convert.ToString(reader["Imagecount"]) + " " + "Image(s)"; ;
                                        article.IsImageButtonEnabled = true;
                                        article.IsImageVisible = Visibility.Visible;
                                    }
                                    else
                                    {
                                        article.IsImageButtonEnabled = false;
                                        article.IsImageVisible = Visibility.Collapsed;
                                    }
                                }
                                else
                                {
                                    article.IsImageButtonEnabled = false;
                                    article.IsImageVisible = Visibility.Collapsed;
                                }
                                if (reader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(reader["Reference"]);

                                if (reader["Description"] != DBNull.Value)
                                    article.Description = Convert.ToString(reader["Description"]).Trim();

                                if (reader["Description_es"] != DBNull.Value)
                                    article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                                if (reader["Description_fr"] != DBNull.Value)
                                    article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                                if (reader["Description_ro"] != DBNull.Value)
                                    article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                                if (reader["Description_zh"] != DBNull.Value)
                                    article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                                if (reader["Description_pt"] != DBNull.Value)
                                    article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                                if (reader["Description_ru"] != DBNull.Value)
                                    article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                                article.Visibility = "Hidden";

                                if (reader["ImagePath"] != DBNull.Value)
                                {
                                    article.ImagePath = Convert.ToString(reader["ImagePath"]);                            
                                }

                                if (reader["Length"] != DBNull.Value)
                                    article.Length = (float)reader["Length"];

                                if (reader["Width"] != DBNull.Value)
                                    article.Width = (float)reader["Width"];

                                if (reader["Height"] != DBNull.Value)
                                    article.Height = (float)reader["Height"];

                                if (reader["Weight"] != DBNull.Value)
                                    article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                    {
                                        article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                        article.ArticleCategory = new ArticleCategories();
                                        article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    }
                                }

                                if (reader["idArticleSupplier"] != DBNull.Value)
                                    article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                                if (reader["SupplierName"] != DBNull.Value)
                                    article.SupplierName = Convert.ToString(reader["SupplierName"]);

                                if (reader["IsObsolete"] != DBNull.Value)
                                    article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                                if (article.IsObsolete == 0)
                                {
                                    article.WarehouseStatus = WarehouseStatus.Active;
                                }
                                else
                                {
                                    article.WarehouseStatus = WarehouseStatus.Inactive;
                                }


                                if (reader["IdPCMStatus"] != DBNull.Value)
                                    article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                                if (reader["PCMStatus"] != DBNull.Value)
                                    article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                                if (CategoryList != null)
                                {
                                    article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                    article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                                }


                                if (reader["PurchaseQtyMin"] != DBNull.Value)
                                    article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                                if (reader["PurchaseQtyMax"] != DBNull.Value)
                                    article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                                if (reader["IsShareWithCustomer"] != DBNull.Value)
                                    article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                                if (reader["IsSparePartOnly"] != DBNull.Value)
                                    article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                                if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (article.IsShareWithCustomer == 1)
                                    {
                                        article.IdECOSVisibility = 323;
                                    }
                                    else if (article.IsSparePartOnly == 1)
                                    {
                                        article.IdECOSVisibility = 324;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                    {
                                        article.IdECOSVisibility = 325;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                    {
                                        article.IdECOSVisibility = 326;
                                    }
                                }

                                if (reader["PCMDescription"] != DBNull.Value)
                                {
                                    article.PCMDescription = Convert.ToString(reader["PCMDescription"]);
                                    if (!string.IsNullOrEmpty(article.PCMDescription))
                                    {
                                        article.IsRichText = "Yes";
                                    }
                                    else
                                    {
                                        article.IsRichText = "";
                                    }
                                }
                                if (reader["IsRtfText"] != DBNull.Value)
                                {
                                    article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                                }
                                if (reader["WarehouseCreationDate"] != DBNull.Value)
                                {
                                    article.WarehouseCreationDate = Convert.ToDateTime(reader["WarehouseCreationDate"]);
                                }
                                if (reader["PCMCreationDate"] != DBNull.Value)
                                {
                                    article.PCMCreationDate = Convert.ToDateTime(reader["PCMCreationDate"]);
                                }
                                if (ArticleAllPrices != null)
                                {
                                    article.EAESPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 18)?.ArticleCostValue), 2) }; 
                                    article.EAMXPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 11310)?.ArticleCostValue), 2) };
                                    article.EAROPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 11434)?.ArticleCostValue), 2) };                                   
                                    article.EBROPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 57)?.ArticleCostValue), 2) };                                     
                                    article.EEPYPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 917)?.ArticleCostValue), 2) };
                                    article.EIBRPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 20)?.ArticleCostValue), 2) }; 
                                    article.EJMX1Price = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 55)?.ArticleCostValue), 2) }; 
                                    article.EJMX2Price = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 1970)?.ArticleCostValue), 2) };
                                    article.ENRUPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 936)?.ArticleCostValue), 2) }; 
                                    article.EPINPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 559)?.ArticleCostValue), 2) }; 
                                    article.ESCNPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 370)?.ArticleCostValue), 2) }; 
                                    article.ESHNPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 199)?.ArticleCostValue), 2) }; 
                                    article.ESMA1Price = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 694)?.ArticleCostValue), 2) };
                                    article.ESMA2Price = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 4031)?.ArticleCostValue), 2) };
                                    article.ESMXPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 895)?.ArticleCostValue), 2) };
                                    article.ETCNPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 11633)?.ArticleCostValue), 2) };
                                    article.ETHQPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 11561)?.ArticleCostValue), 2) };
                                    article.ETMAPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 23)?.ArticleCostValue), 2) };
                                    article.ETTNPrice = new PlantPrice() { Price = Math.Round(Convert.ToDouble(ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == 58)?.ArticleCostValue), 2) };

                                    #region columns can be extended for  5 more companies
                                    List<uint> allCompanies = new List<uint>() { 18, 20, 23, 55, 57, 58, 199, 370, 559, 694, 895, 917, 936, 1970, 4031, 11310, 11434, 11561, 11633 };

                                    List<ArticleCostPrice> filteredPrices = ArticleAllPrices?
                                        .Where(s => !allCompanies.Contains(s.IdCompany))
                                        .ToList();

                                    List<uint> distinctCompanies = filteredPrices?
                                        .Select(s => s.IdCompany)
                                        .Distinct()
                                        .ToList();                                

                                    for (int c = 0; c < Math.Min(5, distinctCompanies.Count); c++)
                                    {
                                        uint companyId = distinctCompanies[c];
                                        double? articleCostValue = ArticleAllPrices?.FirstOrDefault(i => i.IdCompany == companyId)?.ArticleCostValue;
                                       
                                        switch (c)
                                        {
                                            case 0:
                                                article.C1.IdCompany = companyId; article.C1.Price = Math.Round(articleCostValue ?? 0, 2);
                                                break;
                                            case 1:
                                                article.C2.IdCompany = companyId; article.C2.Price = Math.Round(articleCostValue ?? 0, 2);
                                                break;
                                            case 2:
                                                article.C3.IdCompany = companyId; article.C3.Price = Math.Round(articleCostValue ?? 0, 2);
                                                break;
                                            case 3:
                                                article.C4.IdCompany = companyId; article.C4.Price = Math.Round(articleCostValue ?? 0, 2);
                                                break;
                                            case 4:
                                                article.C5.IdCompany = companyId; article.C5.Price = Math.Round(articleCostValue ?? 0, 2);
                                                break;
                                        }
                                    }
                                    #endregion

                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2460(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2460(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }
        //[rdixit][GEOS2-4897][01.12.2023]
        public List<ArticleCostPrice> GetArticleCostPricesByCurrency_V2160(string PLMConnectionString, UInt32 IdCurrency)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetArticleCostPricesByCurrency_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPricesByCurrency_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }
        //[rdixit][GEOS2-4897][01.12.2023]
        public List<Company> GetEmdepSites(string connectionstring)
        {
            List<Company> companies = new List<Company>();
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("emdepsites_GetEmdepSitesCompanies", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        Company company = new Company();
                        company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                        company.Name = sitereader["Name"].ToString();
                        company.ShortName = sitereader["ShortName"].ToString();
                        company.Alias = sitereader["ShortName"].ToString();
                        company.ConnectPlantId = sitereader["IdSite"].ToString();
                        company.Country = new Country();
                        company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                        company.Country.Name = sitereader["name"].ToString();
                        companies.Add(company);
                    }
                }
            }
            return companies;
        }
      
        //[pramod.misal][GEOS2-5134][18-12-2023]
        public List<HardLockPlugins> GetSupportedPluginByIdArticle_V2470(string connectionString, UInt32 idArticle)
        {
            List<HardLockPlugins> hardLockPlugins = new List<HardLockPlugins>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSupportedHardLockPluginByIdArticle_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);
                    using (MySqlDataReader rdr = mySqlCommand.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            HardLockPlugins plugin = new HardLockPlugins();
                            plugin.IdPlugin = Convert.ToUInt32(rdr["IdPlugin"]);

                            if (rdr["Name"] != DBNull.Value)
                            {
                                plugin.Name = Convert.ToString(rdr["Name"]);
                            }
                            if (rdr["IdPlugin"] != DBNull.Value)
                            {
                                plugin.IdPlugin =Convert.ToUInt32(rdr["IdPlugin"]);
                            }

                            hardLockPlugins.Add(plugin);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSupportedPluginByIdArticle_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return hardLockPlugins;
        }
        //Shubham[skadam] GEOS2-5133 Add flag in country column loaded through url service 20 12 2023
        public HardLockPlugins GetHardLockPluginId_V2470(string connectionString)
        {
            HardLockPlugins HardLockPlugins = new HardLockPlugins();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetHardLockPluginId_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader rdr = mySqlCommand.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            if (rdr["IdPlugin"] != DBNull.Value)
                            {
                                HardLockPlugins.IdPlugin = Convert.ToUInt32(rdr["IdPlugin"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetHardLockPluginId_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return HardLockPlugins;
        }


        //[Sudhir.jangra][GEOS2-4935]
        /// <summary>
        /// This method is used to update Product Type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2470(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddProductTypeLogEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeComments_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2460(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public void AddProductTypeLogEntry_V2470(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByCptype_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeLogEntry_V2470(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[Sudhir.jangra][GEOS2-4935]
        public void AddUpdateDeleteProductTypeComments_V2470(string connectionString, UInt64 idCpType, List<ProductTypeLogEntry> commentList)
        {
            try
            {
                if (commentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeLogEntry productType in commentList)
                        {
                            if (productType.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ProductType_Comments_Delete_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByCptype", productType.IdLogEntryByCptype);
                                mySqlCommand.ExecuteNonQuery();


                            }
                            else if (productType.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productType.IdLogEntryByCptype > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_ProductType_Comments_Update_V2470", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryByCptype", productType.IdLogEntryByCptype);
                                    mySqlCommand.Parameters.AddWithValue("_Comments", productType.Comments);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", productType.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", productType.Datetime);
                                    mySqlCommand.Parameters.AddWithValue("_Datetime", productType.Datetime);
                                    // mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (productType.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CommentsEntriesByCptype_Insert_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", idCpType);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", productType.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", productType.Datetime);
                                mySqlCommand.Parameters.AddWithValue("_Comments", productType.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeComments_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public ProductTypes AddProductType_V2470(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                        AddProductTypeCommentEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }


        //[Sudhir.jangra][GEOS2-4935]
        public void AddProductTypeCommentEntry_V2470(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeLogEntry> CommentList)
        {
            try
            {
                if (CommentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeLogEntry commentList in CommentList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CommentsEntriesByCptype_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", commentList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", commentList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", commentList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeCommentEntry_V2470(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[Sudhir.jangra][GEOS2-4935]

        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType_V2470(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType_V2350(PCMConnectionString, productTypes.IdCPType);
                // productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.WayList = GetWaysByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType_V2380(PCMConnectionString, productTypes.IdCPType);
                // productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.jangra][GEOS2-4072][13/12/2022]
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //Add new list for detection list withoutgroup
                productTypes.DetectionListWithoutGroup = GetDetectionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionListWithoutGroup = GetOptionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartListWithoutGroup = GetSparePartsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //Add new list for detection list withoutgroup END



                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);


                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType_V2470(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCommentList = GetProductTypeCommentsEntriesByProductType_V2470(PCMConnectionString, productTypes.IdCPType);

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2460(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public List<ProductTypeLogEntry> GetProductTypeCommentsEntriesByProductType_V2470(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ProductTypeLogEntry> CPTypeLogEntries = new List<ProductTypeLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCommentsEntriesByIdCptype_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeLogEntry ProductTypeLogEntry = new ProductTypeLogEntry();

                            ProductTypeLogEntry.IdLogEntryByCptype = Convert.ToUInt32(reader["IdLogEntryByCptype"]);

                            ProductTypeLogEntry.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.People = new People();
                                ProductTypeLogEntry.People.IdPerson = Convert.ToInt32(reader["IdPerson"].ToString());
                                ProductTypeLogEntry.People.Name = reader["Name"].ToString();
                                ProductTypeLogEntry.People.Surname = reader["Surname"].ToString();

                                if (reader["Login"] != DBNull.Value)
                                    ProductTypeLogEntry.People.Login = Convert.ToString(reader["Login"]);

                                if (reader["IdUserGender"] != DBNull.Value)
                                    ProductTypeLogEntry.People.IdPersonGender = Convert.ToByte(reader["IdUserGender"]);
                            }
                            CPTypeLogEntries.Add(ProductTypeLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeCommentsEntriesByProductType_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPTypeLogEntries;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public List<ProductTypeLogEntry> GetProductTypeLogEntriesByProductType_V2470(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ProductTypeLogEntry> CPTypeLogEntries = new List<ProductTypeLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByIdCptype_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeLogEntry ProductTypeLogEntry = new ProductTypeLogEntry();

                            ProductTypeLogEntry.IdLogEntryByCptype = Convert.ToUInt32(reader["IdLogEntryByCptype"]);

                            ProductTypeLogEntry.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            CPTypeLogEntries.Add(ProductTypeLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeLogEntriesByProductType_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPTypeLogEntries;
        }


        public List<ArticleCategory> GetWMSArticlesWithCategoryForReference(string connectionString)
        {
            List<ArticleCategory> wmsArticlesWithCategoryList = new List<ArticleCategory>();
            try
            {
                wmsArticlesWithCategoryList = GetWMSArticleCategories(connectionString);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWMSArticlesWithCategoryForReference(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return wmsArticlesWithCategoryList;
        }

        //[Sudhir.Jangra][GEOS2-4874]
        public List<ArticleCategory> GetWMSArticleCategories(string connectionstring)
        {
            List<ArticleCategory> wmsArticleCategory = new List<ArticleCategory>();
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("WMS_GetAllArticleCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCategory ArticleCategory = new ArticleCategory();
                            ArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                ArticleCategory.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                ArticleCategory.Parent = Convert.ToInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                ArticleCategory.IsLeaf = Convert.ToByte(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                ArticleCategory.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["KeyName"] != DBNull.Value)
                                ArticleCategory.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                ArticleCategory.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                ArticleCategory.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                ArticleCategory.Article_count = Convert.ToInt32(reader["Articles_Count"]);

                            wmsArticleCategory.Add(ArticleCategory);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWMSArticleCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return wmsArticleCategory;
        }

        //[rdixit][25.12.2023][GEOS2-4874]
        public List<ArticleCategorieMapping> GetWMS_PCMCategoryMapping(string connectionString)
        {
            List<ArticleCategorieMapping> wmsArticleCategory = new List<ArticleCategorieMapping>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("WMS_GetWMS_PCMCategoryMapping", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCategorieMapping ArticleCategorymapping = new ArticleCategorieMapping();

                            if (reader["IdWarehouseCategory"] != DBNull.Value)
                                ArticleCategorymapping.IdWMSArticleCategory = Convert.ToUInt32(reader["IdWarehouseCategory"]);
                            if (reader["IdPCMCategory"] != DBNull.Value)
                                ArticleCategorymapping.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMCategory"]);
                            if (reader["WMSName"] != DBNull.Value)
                                ArticleCategorymapping.WMSName = Convert.ToString(reader["WMSName"]);
                            if (reader["WMSparentName"] != DBNull.Value)
                                ArticleCategorymapping.WMSParent = Convert.ToString(reader["WMSparentName"]);
                            if (reader["PCMName"] != DBNull.Value)
                                ArticleCategorymapping.PCMName = Convert.ToString(reader["PCMName"]);
                            if (reader["PCMparentName"] != DBNull.Value)
                                ArticleCategorymapping.PCMParent = Convert.ToString(reader["PCMparentName"]);
                                                      
                            //ArticleCategorymapping.PCMArticleMapping = ArticleCategorymapping.PCMParent + " > " + ArticleCategorymapping.PCMName;
                            //ArticleCategorymapping.WMSArticleMapping = ArticleCategorymapping.WMSParent + " > " + ArticleCategorymapping.WMSName;

                            wmsArticleCategory.Add(ArticleCategorymapping);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWMSArticleCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return wmsArticleCategory;
        }
        //[rdixit][25.12.2023][GEOS2-4874]
        public bool AddDeleteArticleCategoryMapping(string connectionString, List<ArticleCategorieMapping> ArticleCategoryMappingList)
        {
            bool isUpdated = false;
            TransactionScope transactionScope = null;

            using (transactionScope = new TransactionScope())
            {
                try
                {
                    if (ArticleCategoryMappingList != null)
                    {
                        foreach (var item in ArticleCategoryMappingList)
                        {
                            if (item.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                                {
                                    mySqlConnection.Open();
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_AddCategoryMapping", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdWarehouseCategory", item.IdWMSArticleCategory);
                                    mySqlCommand.Parameters.AddWithValue("_IdPCMCategory", item.IdPCMArticleCategory);
                                    mySqlCommand.ExecuteNonQuery();
                                    mySqlConnection.Close();

                                }
                            }
                            if (item.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                                {
                                    mySqlConnection.Open();
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DeleteCategoryMapping", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdWarehouseCategory", item.IdWMSArticleCategory);
                                    mySqlCommand.Parameters.AddWithValue("_IdPCMCategory", item.IdPCMArticleCategory);
                                    mySqlCommand.ExecuteNonQuery();
                                    mySqlConnection.Close();

                                }
                            }
                        }
                    }
                    isUpdated = true;
                    transactionScope.Complete();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDeleteArticleCategoryMapping(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public Discounts AddDiscount_V2470(Discounts discount, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_AddDiscounts", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Name", discount.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", discount.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", discount.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", discount.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", discount.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", discount.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", discount.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", discount.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", discount.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", discount.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", discount.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", discount.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", discount.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", discount.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_StartDate", discount.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", discount.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", discount.IdScope);
                        mySqlCommand.Parameters.AddWithValue("_IdPlatform", discount.IdPlatform);
                        mySqlCommand.Parameters.AddWithValue("_Value", discount.Value);
                        if (discount.IsReadOnly == true)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 1);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 0);
                        }
                        if (discount.InUse.ToLower() == "no")
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 0);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 1);
                        }
                        mySqlCommand.Parameters.AddWithValue("_createdBy", discount.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        discount.Id = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }
                    if (discount.DiscountArticles != null)
                    {
                        AddDiscountArticles(MainServerConnectionString, discount);
                    }
                    if (discount.PlantList != null)
                    {
                        AddDiscountPlants(MainServerConnectionString, discount);
                    }
                    if (discount.DiscountLogEntryList != null)
                    {
                        AddDiscountChangeLog_V2470(discount, MainServerConnectionString);
                    }
                    if (discount.NewDiscountCustomer != null)
                    {
                        AddCustomersByCustomerDiscount(MainServerConnectionString, discount.Id, discount.NewDiscountCustomer, discount.IdCreator);
                    }
                    if (discount.DiscountCommentsList!=null)
                    {
                        AddDiscountCommentsList_V2470(discount, MainServerConnectionString);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();

                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDiscount_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return discount;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public void AddDiscountChangeLog_V2470(Discounts discount, string MainServerConnectionString)
        {

            try
            {

                if (discount.DiscountLogEntryList != null)
                {
                    foreach (DiscountLogEntry DiscountLogEntry in discount.DiscountLogEntryList)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByDiscount_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", DiscountLogEntry.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", DiscountLogEntry.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", DiscountLogEntry.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDiscountChangeLog_V2470(). IdCustomerDiscount- {0} ErrorMessage- {1}", discount.Id, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }

        //[Sudhir.Jangra][GEOS2-4935]
        public void AddDiscountCommentsList_V2470(Discounts discount, string MainServerConnectionString)
        {

            try
            {

                if (discount.DiscountLogEntryList != null)
                {
                    foreach (DiscountLogEntry DiscountLogEntry in discount.DiscountCommentsList)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByDiscount_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", DiscountLogEntry.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", DiscountLogEntry.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", DiscountLogEntry.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDiscountChangeLog_V2470(). IdCustomerDiscount- {0} ErrorMessage- {1}", discount.Id, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }


        //[Sudhir.Jangra][GEOS2-4935]
        public List<DiscountLogEntry> GetDiscountLogEntriesByDiscountstring_V2470(string PCMConnectionString, int IdCustomerDiscount)
        {
            List<DiscountLogEntry> DiscountLogEntries = new List<DiscountLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByDiscount_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", IdCustomerDiscount);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DiscountLogEntry DiscountLogEntry = new DiscountLogEntry();

                            DiscountLogEntry.IdLogEntryByDiscount = Convert.ToUInt32(reader["IdLogEntryByDiscount"]);

                            DiscountLogEntry.IdCustomerDiscount = Convert.ToUInt64(reader["IdCustomerDiscount"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                DiscountLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                DiscountLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                DiscountLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                DiscountLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            DiscountLogEntries.Add(DiscountLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDiscountLogEntriesByDiscountstring_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DiscountLogEntries;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public List<DiscountLogEntry> GetDiscountCommentsByDiscountstring_V2470(string PCMConnectionString, int IdCustomerDiscount)
        {
            List<DiscountLogEntry> DiscountLogEntries = new List<DiscountLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCommentsByDiscount_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", IdCustomerDiscount);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DiscountLogEntry DiscountLogEntry = new DiscountLogEntry();

                            DiscountLogEntry.IdLogEntryByDiscount = Convert.ToUInt32(reader["IdLogEntryByDiscount"]);

                            DiscountLogEntry.IdCustomerDiscount = Convert.ToUInt64(reader["IdCustomerDiscount"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                DiscountLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                DiscountLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                DiscountLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                DiscountLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                DiscountLogEntry.People = new People();
                                DiscountLogEntry.People.IdPerson = Convert.ToInt32(reader["IdPerson"].ToString());
                                DiscountLogEntry.People.Name = reader["Name"].ToString();
                                DiscountLogEntry.People.Surname = reader["Surname"].ToString();

                                if (reader["Login"] != DBNull.Value)
                                    DiscountLogEntry.People.Login = Convert.ToString(reader["Login"]);

                                if (reader["IdUserGender"] != DBNull.Value)
                                    DiscountLogEntry.People.IdPersonGender = Convert.ToByte(reader["IdUserGender"]);
                            }
                            DiscountLogEntries.Add(DiscountLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDiscountCommentsByDiscountstring_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DiscountLogEntries;
        }


        //[Sudhir.jangra][GEOs2-4935]
        public Discounts UpdateDiscount_V2470(Discounts discount, Discounts prevDiscount, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_EditDiscounts", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerDiscount", discount.Id);
                        mySqlCommand.Parameters.AddWithValue("_Name", discount.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", discount.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", discount.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", discount.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", discount.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", discount.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", discount.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", discount.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", discount.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", discount.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", discount.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", discount.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", discount.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", discount.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_StartDate", discount.StartDateNew);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", discount.EndDateNew);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", discount.IdScope);
                        mySqlCommand.Parameters.AddWithValue("_IdPlatform", discount.IdPlatform);
                        mySqlCommand.Parameters.AddWithValue("_Value", discount.Value);
                        if (discount.IsReadOnly == true)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 1);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IsReadOnly", 0);
                        }
                        if (discount.InUse.ToLower() == "no")
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 0);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_InUse", 1);
                        }
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", discount.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        discount.Id = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }
                    if (discount.DiscountArticles == null && prevDiscount.DiscountArticles != null)//Scope has been changed from product to order
                    {
                        DeleteDiscountArticles(MainServerConnectionString, prevDiscount.Id, prevDiscount.DiscountArticles);
                    }
                    if (discount.DeletedPlantList != null || discount.AddedPlantList != null)//If some of the Plants are added or deleted
                    {
                        AddDeletePlants_Discounts(MainServerConnectionString, discount);
                    }
                    if (discount.DiscountArticles != null && prevDiscount.DiscountArticles != null)//Scope has NOt been changed from product to order
                    {
                        UpdateDiscountArticles(MainServerConnectionString, discount);
                        foreach (var item in prevDiscount.DiscountArticles)
                        {
                            if (!discount.DiscountArticles.Any(i => i.IdArticle == item.IdArticle))
                            {
                                if (discount.DeletedDiscountArticles == null)
                                    discount.DeletedDiscountArticles = new List<DiscountArticles>();
                                discount.DeletedDiscountArticles.Add(prevDiscount.DiscountArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault());
                            }
                        }
                        if (discount.DeletedDiscountArticles != null)
                            DeleteDiscountArticles(MainServerConnectionString, discount.Id, discount.DeletedDiscountArticles);
                    }
                    if (discount.DiscountArticles != null && prevDiscount.DiscountArticles == null)//Scope has been changed from order to product
                    {
                        AddDiscountArticles(MainServerConnectionString, discount);
                    }
                    if (discount.UpdateDiscountCustomer != null)
                        AddUpdateDeleteCustomersByDicountCustomer(MainServerConnectionString, discount.Id, discount.UpdateDiscountCustomer, discount.IdModifier);


                    if (discount.DiscountLogEntryList != null)
                    {
                        AddDiscountChangeLog_V2470(discount, MainServerConnectionString);
                    }
                    if (discount.DiscountCommentsList!=null)
                    {
                        AddUpdateDeleteDiscountComments_V2470(MainServerConnectionString, discount.Id, discount.DiscountCommentsList);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDiscount_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return discount;
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public void AddUpdateDeleteDiscountComments_V2470(string connectionString, Int32 idDiscountPrice, List<DiscountLogEntry> commentList)
        {
            try
            {
                if (commentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DiscountLogEntry commentType in commentList)
                        {
                            if (commentType.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Discount_Comments_Delete_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByDiscount", commentType.IdLogEntryByDiscount);
                                mySqlCommand.ExecuteNonQuery();


                            }
                            else if (commentType.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (commentType.IdLogEntryByDiscount > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Discount_Comments_Update_V2470", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryByDiscount", commentType.IdLogEntryByDiscount);
                                    mySqlCommand.Parameters.AddWithValue("_Comments", commentType.Comments);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", commentType.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", commentType.Datetime);
                                    mySqlCommand.Parameters.AddWithValue("_Datetime", commentType.Datetime);
                                    // mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (commentType.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CommentsEntriesByDiscount_Insert_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdDiscountPrice", idDiscountPrice);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", commentType.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", commentType.Datetime);
                                mySqlCommand.Parameters.AddWithValue("_Comments", commentType.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCustomerPriceComments_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        //[rdixit][27.12.2023][GEOS2-4875][GEOS2-48756]
        public List<ArticleCategorieMapping> GetWMS_PCMCategoryMappingOfToday(string connectionString)
        {
            List<ArticleCategorieMapping> wmsArticleCategory = new List<ArticleCategorieMapping>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("WMS_GetTodaysWMS_PCMCategoryMapping", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCategorieMapping ArticleCategorymapping = new ArticleCategorieMapping();

                            if (reader["IdWarehouseCategory"] != DBNull.Value)
                                ArticleCategorymapping.IdWMSArticleCategory = Convert.ToUInt32(reader["IdWarehouseCategory"]);
                            if (reader["IdPCMCategory"] != DBNull.Value)
                                ArticleCategorymapping.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMCategory"]);
                            if (reader["PCMName"] != DBNull.Value)
                                ArticleCategorymapping.PCMName = Convert.ToString(reader["PCMName"]);
                            if (reader["WMSName"] != DBNull.Value)
                                ArticleCategorymapping.WMSName = Convert.ToString(reader["WMSName"]);
                            wmsArticleCategory.Add(ArticleCategorymapping);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWMSArticleCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return wmsArticleCategory;
        }
        //[rdixit][27.12.2023][GEOS2-4875][GEOS2-48756]
        public List<Articles> AddWMSTOPCMArticlesByCategories(string connectionString, string mainServerConnectionString, List<ArticleCategorieMapping> articleCategoryMappingList)
        {
            TransactionScope transactionScope = null;
            List<Articles> AllImportedArticles = new List<Articles>();
            using (transactionScope = new TransactionScope())
            {
                try
                {
                    if (articleCategoryMappingList != null)
                    {
                        List<Articles> WmsArticles = new List<Articles>();
                        foreach (var item in articleCategoryMappingList)
                        {
                           
                            #region Read All WMS Articles
                            using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                            {
                               
                                mySqlConnection.Open();
                                MySqlCommand mySqlCommand = new MySqlCommand("GetWmsArticlesToImportInPCMArticles", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdWarehouseCategory", item.IdWMSArticleCategory);
                                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                {
                                    while (reader.Read())
                                    {
                                        Articles WmsArticle = new Articles();
                                        WmsArticle.ArticleCategory = new ArticleCategories();
                                        WmsArticle.ArticleCategory.Name = item.WMSName;
                                        WmsArticle.ArticleCategory.IdArticleCategory = Convert.ToUInt32(item.IdWMSArticleCategory);

                                        WmsArticle.PcmArticleCategory = new PCMArticleCategory();
                                        WmsArticle.PcmArticleCategory.IdPCMArticleCategory = item.IdPCMArticleCategory;
                                        WmsArticle.PcmArticleCategory.Name = item.PCMName;

                                        if (reader["idArticle"] != DBNull.Value)
                                            WmsArticle.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                                        if (reader["Reference"] != DBNull.Value)
                                            WmsArticle.Reference = Convert.ToString(reader["Reference"]);

                                        if (reader["Description"] != DBNull.Value)
                                            WmsArticle.Description = Convert.ToString(reader["Description"]);

                                        if (reader["IdPCMStatus"] != DBNull.Value)
                                            WmsArticle.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                                        WmsArticles.Add(WmsArticle);

                                    }
                                }
                                mySqlConnection.Close();
                            }
                        }
                            #endregion

                            #region Update All WMS articles into PCM Articles
                            if (WmsArticles != null)
                            {
                               
                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("WMS_InsertWMSToPCMArticlesByCategory", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    foreach (var WmsArticle in WmsArticles)
                                    {
                                        mySqlCommand.Parameters.Clear();
                                        mySqlCommand.Parameters.AddWithValue("_idArticle", WmsArticle.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", WmsArticle.IdPCMStatus);
                                        mySqlCommand.Parameters.AddWithValue("_IdPCMCategory", WmsArticle.PcmArticleCategory.IdPCMArticleCategory);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                        mySqlConnection.Close();
                                    }
                                }
                            
                            #endregion

                            AllImportedArticles.AddRange(WmsArticles);
                       
                    }
                    transactionScope.Complete();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddWMSTOPCMArticlesByCategories(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return AllImportedArticles;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public DetectionDetails AddDetection_V2470(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2330", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (detectionDetails.IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", null);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry_V2470(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                        AddDetectionComments_V2470(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionCommentsList, detectionDetails.IdDetectionType);



                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }



        //[Sudhir.jangra][GEOS2-4935]
        /// <summary>
        /// This method is used to insert detection log entry
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="IdDetectionType">Get detection type id.</param>
        /// <param name="LogList">Get log list details.</param>
        public void AddDetectionLogEntry_V2470(string MainServerConnectionString, UInt32 IdDetection, List<DetectionLogEntry> LogList, UInt32 IdDetectionType)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByDetection_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionLogEntry_V2470(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        /// <summary>
        /// This method is used to insert detection log entry
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdDetection">Get detection id.</param>
        /// <param name="IdDetectionType">Get detection type id.</param>
        /// <param name="LogList">Get log list details.</param>
        public void AddDetectionComments_V2470(string MainServerConnectionString, UInt32 IdDetection, List<DetectionLogEntry> LogList, UInt32 IdDetectionType)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByDetection_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionComments_V2470(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public DetectionDetails GetDetectionByIdDetection_V2470(string PCMConnectionString, UInt32 IdDetection, string DetectionAttachedDocPath, string DetectionImagePath, string currencyIconFilePath, int IdUser)
        {
            DetectionDetails detectionDetails = new DetectionDetails();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetDetectionByIdDetection_V2360", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;
                    DetectionDetailCommand.Parameters.AddWithValue("_IdDetection", IdDetection);


                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                            if (DetectionDetailReader["Name"] != DBNull.Value)
                            {
                                detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                            }
                            if (DetectionDetailReader["Description"] != DBNull.Value)
                            {
                                detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                            }
                            if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                            {
                                detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                            }
                            if (DetectionDetailReader["Code"] != DBNull.Value)
                            {
                                detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                            }
                            if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                            {
                                detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                detectionDetails.TestTypes = new TestTypes();
                                detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                if (DetectionDetailReader["TestName"] != DBNull.Value)
                                {
                                    detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                }
                            }
                            if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                detectionDetails.DetectionTypes = new DetectionTypes();
                                detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                }
                            }
                            if (DetectionDetailReader["Name_es"] != DBNull.Value)
                            {
                                detectionDetails.Name_es = Convert.ToString(DetectionDetailReader["Name_es"]);
                            }
                            if (DetectionDetailReader["Name_fr"] != DBNull.Value)
                            {
                                detectionDetails.Name_fr = Convert.ToString(DetectionDetailReader["Name_fr"]);
                            }
                            if (DetectionDetailReader["Name_pt"] != DBNull.Value)
                            {
                                detectionDetails.Name_pt = Convert.ToString(DetectionDetailReader["Name_pt"]);
                            }
                            if (DetectionDetailReader["Name_ro"] != DBNull.Value)
                            {
                                detectionDetails.Name_ro = Convert.ToString(DetectionDetailReader["Name_ro"]);
                            }
                            if (DetectionDetailReader["Name_ru"] != DBNull.Value)
                            {
                                detectionDetails.Name_ru = Convert.ToString(DetectionDetailReader["Name_ru"]);
                            }
                            if (DetectionDetailReader["Name_zh"] != DBNull.Value)
                            {
                                detectionDetails.Name_zh = Convert.ToString(DetectionDetailReader["Name_zh"]);
                            }
                            if (DetectionDetailReader["Description_es"] != DBNull.Value)
                            {
                                detectionDetails.Description_es = Convert.ToString(DetectionDetailReader["Description_es"]);
                            }
                            if (DetectionDetailReader["Description_fr"] != DBNull.Value)
                            {
                                detectionDetails.Description_fr = Convert.ToString(DetectionDetailReader["Description_fr"]);
                            }
                            if (DetectionDetailReader["Description_pt"] != DBNull.Value)
                            {
                                detectionDetails.Description_pt = Convert.ToString(DetectionDetailReader["Description_pt"]);
                            }
                            if (DetectionDetailReader["Description_ro"] != DBNull.Value)
                            {
                                detectionDetails.Description_ro = Convert.ToString(DetectionDetailReader["Description_ro"]);
                            }
                            if (DetectionDetailReader["Description_ru"] != DBNull.Value)
                            {
                                detectionDetails.Description_ru = Convert.ToString(DetectionDetailReader["Description_ru"]);
                            }
                            if (DetectionDetailReader["Description_zh"] != DBNull.Value)
                            {
                                detectionDetails.Description_zh = Convert.ToString(DetectionDetailReader["Description_zh"]);
                            }

                            if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                            {
                                detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                detectionDetails.Status = new LookupValue();
                                detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                if (DetectionDetailReader["Status"] != DBNull.Value)
                                {
                                    detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                }
                            }
                            if (DetectionDetailReader["IdScope"] != DBNull.Value)
                            {
                                detectionDetails.IdScope = Convert.ToUInt32(DetectionDetailReader["IdScope"]);
                            }
                            if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                            {
                                detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                detectionDetails.DetectionGroup = new DetectionGroup();
                                detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                {
                                    detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                }
                            }

                            if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                            if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                            if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                            if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 323;
                                }
                                else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 324;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                {
                                    detectionDetails.IdECOSVisibility = 325;
                                }
                                else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                {
                                    detectionDetails.IdECOSVisibility = 326;
                                }
                            }
                            if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                                detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                        }
                    }
                }
                detectionDetails.DetectionAttachedDocList = GetDetectionAttachedDocsByIdDetection_V2340(PCMConnectionString, detectionDetails.IdDetections, DetectionAttachedDocPath);//[rdixit][GEOS2-4074][12.12.2022]
                detectionDetails.DetectionAttachedLinkList = GetDetectionAttachedLinksByIdDetection(PCMConnectionString, detectionDetails.IdDetections);
                detectionDetails.DetectionImageList = GetDetectionImagesByIdDetection(PCMConnectionString, detectionDetails.IdDetections, DetectionImagePath);
                //option and detection group list
                if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                {
                    detectionDetails.DetectionGroupList = GetDetectionGroupsByDetectionType(PCMConnectionString, detectionDetails.IdDetectionType);
                }

                detectionDetails.CustomerList = GetCustomersWithRegionsByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionLogEntryList = GetDetectionLogEntriesByDetection_V2470(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                detectionDetails.DetectionCommentsList = GetDetectionCommentsByDetection_V2470(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);

                #region MyRegion
                try
                {
                    //detectionDetails.ProductTypesList = GetProductTypesByDetection(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                    detectionDetails.ProductTypesList = GetProductTypesByDetection_V2360(PCMConnectionString, detectionDetails.IdDetections, detectionDetails.IdDetectionType);
                }
                catch (Exception ex) { }
                #endregion

                detectionDetails.IncludedPLMDetectionList = GetIncludedPLMDetectionPrices_V2250(PCMConnectionString, detectionDetails.IdDetections, currencyIconFilePath, IdUser);

                string IdBasePriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", detectionDetails.IncludedPLMDetectionList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                detectionDetails.NotIncludedPLMDetectionList = GetNotIncludedPLMDetectionPrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                    detectionDetails.IdDetections, IdUser);

                // detectionDetails.UpdateAllMaxCostFromNullToZero();
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionByIdDetection_V2470(). IdDetection- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionDetails;
        }

        //[Sudhir.Jangra][GEOS2-4935]
        /// <summary>
        /// This method is used to get log entries by detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get detection id</param>
        /// <param name="IdDetectionType">Get detection type id</param>
        /// <returns>The list of log by detection.</returns>
        public List<DetectionLogEntry> GetDetectionLogEntriesByDetection_V2470(string PCMConnectionString, UInt32 IdDetection, UInt32 IdDetectionType)
        {
            List<DetectionLogEntry> detectionLogEntryList = new List<DetectionLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByIdDetection_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionLogEntry detectionLogEntry = new DetectionLogEntry();

                            detectionLogEntry.IdLogEntryByDetection = Convert.ToUInt32(reader["IdLogEntryByDetection"]);

                            detectionLogEntry.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            detectionLogEntry.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                detectionLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                detectionLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                detectionLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                detectionLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            detectionLogEntryList.Add(detectionLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionLogEntriesByDetection_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionLogEntryList;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        /// <summary>
        /// This method is used to get log entries by detection.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetection">Get detection id</param>
        /// <param name="IdDetectionType">Get detection type id</param>
        /// <returns>The list of log by detection.</returns>
        public List<DetectionLogEntry> GetDetectionCommentsByDetection_V2470(string PCMConnectionString, UInt32 IdDetection, UInt32 IdDetectionType)
        {
            List<DetectionLogEntry> detectionLogEntryList = new List<DetectionLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCommentsByIdDetection_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionLogEntry detectionLogEntry = new DetectionLogEntry();

                            detectionLogEntry.IdLogEntryByDetection = Convert.ToUInt32(reader["IdLogEntryByDetection"]);

                            detectionLogEntry.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            detectionLogEntry.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                detectionLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                detectionLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                detectionLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                detectionLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                detectionLogEntry.People = new People();
                                detectionLogEntry.People.IdPerson = Convert.ToInt32(reader["IdPerson"].ToString());
                                detectionLogEntry.People.Name = reader["Name"].ToString();
                                detectionLogEntry.People.Surname = reader["Surname"].ToString();

                                if (reader["Login"] != DBNull.Value)
                                    detectionLogEntry.People.Login = Convert.ToString(reader["Login"]);

                                if (reader["IdUserGender"] != DBNull.Value)
                                    detectionLogEntry.People.IdPersonGender = Convert.ToByte(reader["IdUserGender"]);
                            }
                            detectionLogEntryList.Add(detectionLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionCommentsByDetection_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionLogEntryList;
        }



        //[Sudhir.jangra][GEOS2-4935]
        public bool UpdateDetection_V2470(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Update_V2340", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", detectionDetails.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        if (IdGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", IdGroup);
                        }

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add/update/delete ways, detections, options, spare parts
                    //AddUpdateDeleteDetectionFiles(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                    AddUpdateDeleteDetectionFiles_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);//[GEOS2-4074][12.12.2022][rdixit]
                    AddUpdateDeleteDetectionLinks(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                    AddUpdateDeleteDetectionImages(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                    AddDeleteCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.ModifiedBy);
                    AddDetectionLogEntry_V2470(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                    AddUpdateDeleteDetectionComments_V2470(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionCommentsList, detectionDetails.IdDetectionType);

                    AddUpdateDeleteDetectionRelatedModule(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.ProductTypesList);

                    //
                    AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.ModifiedBy);
                    AddBasePriceListLogEntry(MainServerConnectionString, detectionDetails.BasePriceLogEntryList);
                    AddCustomerPriceListLogEntry(MainServerConnectionString, detectionDetails.CustomerPriceLogEntryList);
                    if (detectionDetails.ProductTypesList.Count > 0 && detectionDetails.ProductTypeChangeLogList.Count > 0)
                    {
                        List<ulong> IdCpTypeList = detectionDetails.ProductTypesList.Select(i => i.IdCPType).Distinct().ToList();
                        foreach (var item in IdCpTypeList)
                        {
                            var ChangeLogList = detectionDetails.ProductTypeChangeLogList.Where(i => i.IdCPType == item).ToList();
                            AddProductTypeLogEntry(MainServerConnectionString, item, ChangeLogList);
                        }

                    }
                    //
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDetection_V2470(). IdDetection- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[Sudhir.jangra][GEOS2-4935]
        public void AddUpdateDeleteDetectionComments_V2470(string connectionString, UInt64 idDetection, List<DetectionLogEntry> commentList, UInt32 IdDetectionType)
        {
            try
            {
                if (commentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (DetectionLogEntry productType in commentList)
                        {
                            if (productType.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detection_Comments_Delete_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByDetection", productType.IdLogEntryByDetection);
                                mySqlCommand.ExecuteNonQuery();


                            }
                            else if (productType.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productType.IdLogEntryByDetection > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detection_Comments_Update_V2470", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryByDetection", productType.IdLogEntryByDetection);
                                    mySqlCommand.Parameters.AddWithValue("_Comments", productType.Comments);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", productType.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", productType.Datetime);
                                    mySqlCommand.Parameters.AddWithValue("_Datetime", productType.Datetime);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                    // mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (productType.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CommentsEntriesByDetection_Insert_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdDetection", idDetection);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", productType.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", productType.Datetime);
                                mySqlCommand.Parameters.AddWithValue("_Comments", productType.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionComments_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public IList<Company> GetEmdepSitesCompanies_V2490(string connectionstring)
        {
            IList<Company> companies = new List<Company>();
            // Parse the connection string
            MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionstring);

            // Extract components
            string ConnecteddataSource = builder.Server;
            string database = builder.Database;
            string userId = builder.UserID;
            string password = builder.Password;
            string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionstring);
            string dataSource = "";
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("emdepsites_GetEmdepSitesDetail", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {

                        Company company = new Company();
                        if (string.IsNullOrEmpty(connectedPlantName))
                        {
                            dataSource = ConnecteddataSource.Replace(ConnecteddataSource, sitereader["DatabaseIP"].ToString());
                        }
                        else
                        {
                            dataSource = ConnecteddataSource.Replace(connectedPlantName, sitereader["ShortName"].ToString());
                            //This will removed from code when we update everywhere logic to hit service through service provider url not from database connection string

                        }
                        string connstr = connectionstring.Replace(ConnecteddataSource, dataSource);

                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {
                            

                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            company.Name = sitereader["Name"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }


        private string GetConnectedPlantNameFromDataSource(string datasource, string connectionString)
        {
            string connectedPlantName = "";
            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();

                MySqlCommand command = new MySqlCommand("CRM_GetAllPlantNameToCheckDataSource", conn);
                command.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader itemRow = command.ExecuteReader())
                {
                    if (itemRow.HasRows)
                    {
                        while (itemRow.Read())
                        {
                            string plantShortName = itemRow["ShortName"].ToString();
                            if (datasource.Contains(plantShortName.ToUpper()))
                            {
                                connectedPlantName = plantShortName.ToUpper();
                            }

                        }
                    }
                }
            }

            return connectedPlantName;
        }

        //[Sudhir.Jangra][GEOS2-4935]
        //Shubham[skadam] GEOS2-5307 Modules Window 23 02 2024
        /// <summary>
        /// This method is used to get Product type by ID.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <returns>The data of product type by id.</returns>
        public ProductTypes GetProductTypeByIdCpType_V2490(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate, string currencyIconFilePath, int IdUser)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                    }
                    else
                    {
                        SP = "PCM_GetProductTypeByIdCpType";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType_V2350(PCMConnectionString, productTypes.IdCPType);
                // productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.WayList = GetWaysByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType_V2380(PCMConnectionString, productTypes.IdCPType);
                // productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.jangra][GEOS2-4072][13/12/2022]
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //Add new list for detection list withoutgroup
                productTypes.DetectionListWithoutGroup = GetDetectionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionListWithoutGroup = GetOptionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartListWithoutGroup = GetSparePartsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //Add new list for detection list withoutgroup END



                productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);


                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType_V2470(PCMConnectionString, productTypes.IdCPType);

                productTypes.ProductTypeCommentList = GetProductTypeCommentsEntriesByProductType_V2470(PCMConnectionString, productTypes.IdCPType);

                try
                {
                    productTypes.IncludedPLMModuleList = GetBaseAndCustomerPricesByIdCPType_V2490(PCMConnectionString, productTypes.IdCPType, currencyIconFilePath, IdUser);

                    string IdBasePriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                    string IdCustomerPriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                    productTypes.NotIncludedPLMModuleList = GetNotIncludedPLMModulePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                        productTypes.IdCPType, IdUser);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2490(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2490(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        public List<PLMModulePrice> GetBaseAndCustomerPricesByIdCPType_V2490(string PCMConnectionString, UInt64 IdCPType, string currencyIconFilePath, int IdUser)
        {
            List<PLMModulePrice> PLMModulePrices = new List<PLMModulePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByIdCPType_V2490", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMModulePrice PLMModulePrice = new PLMModulePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMModulePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMModulePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMModulePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMModulePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMModulePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMModulePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMModulePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMModulePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMModulePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMModulePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMModulePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMModulePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMModulePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMModulePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMModulePrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMModulePrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMModulePrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMModulePrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMModulePrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMModulePrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMModulePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMModulePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMModulePrice.Country = PLMModulePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMModulePrice.Country = "ALL";
                                }
                            }
                            if (PLMModulePrice.MaxCost == null)
                            {
                                PLMModulePrice.MaxCost = 0;
                            }
                            if (PLMModulePrice.RuleValue == null)
                            {
                                PLMModulePrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMModulePrice.IdRule == 307)
                            {
                                PLMModulePrice.SellPrice = Convert.ToDouble(PLMModulePrice.MaxCost) +
                                    ((Convert.ToDouble(PLMModulePrice.MaxCost) *
                                    (Convert.ToDouble(PLMModulePrice.RuleValue) / 100)));
                            }
                            else if (PLMModulePrice.IdRule == 308)
                            {
                                if (PLMModulePrice.RuleValue == null)
                                {
                                    PLMModulePrice.RuleValue = null;
                                    PLMModulePrice.SellPrice = null;
                                }
                                else if (PLMModulePrice.RuleValue != null && Convert.ToDouble(PLMModulePrice.RuleValue) <= 0)
                                {
                                    PLMModulePrice.RuleValue = null;
                                    PLMModulePrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMModulePrice.SellPrice = PLMModulePrice.RuleValue;
                                }
                            }
                            else if (PLMModulePrice.IdRule == 1518)
                            {
                                PLMModulePrice.RuleValue = 0;
                                PLMModulePrice.SellPrice = 0;
                            }
                            else if (PLMModulePrice.IdRule == 309)
                            {
                                PLMModulePrice.SellPrice = Convert.ToDouble(PLMModulePrice.MaxCost) +
                                    (Convert.ToDouble(PLMModulePrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMModulePrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMModulePrice.SellPrice);

                            if (PLMModulePrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMModulePrice.MaxCost);

                            PLMModulePrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(
                                MaxCost, SellPriceValue));
                            PLMModulePrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(
                                MaxCost, SellPriceValue));

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMModulePrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMModulePrice.IdPermission.Equals("62"))
                                {
                                    PLMModulePrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMModulePrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMModulePrice.IsEnabledPermission = false;
                            }
                            PLMModulePrices.Add(PLMModulePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBaseAndCustomerPricesByIdCPType_V2490(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMModulePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMModulePrices;
        }

        public List<PLMModulePrice> GetNotIncludedPLMModulePrices_V2250(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated, string currencyIconFilePath, UInt64 IdCPType, int IdUser)
        {
            List<PLMModulePrice> PLMModulePrices = new List<PLMModulePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByModule_V2490", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMModulePrice PLMModulePrice = new PLMModulePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMModulePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMModulePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMModulePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMModulePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMModulePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMModulePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMModulePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMModulePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMModulePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMModulePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMModulePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMModulePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMModulePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMModulePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            //if (reader["MaxCost"] != DBNull.Value)
                            //{
                            //    PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            //}
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMModulePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMModulePrice.Country = PLMModulePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMModulePrice.Country = "ALL";
                                }
                            }

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMModulePrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMModulePrice.IdPermission.Equals("62"))
                                {
                                    PLMModulePrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMModulePrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMModulePrice.IsEnabledPermission = false;
                            }
                            PLMModulePrices.Add(PLMModulePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBaseAndCustomerPricesByIdCPType_V2490(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMModulePrices.Any(oi => oi.Currency.Name == item))
                    PLMModulePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMModulePrices;
        }

        //[Sudhir.jangra][GEOS2-4935]
        //Shubham[skadam] GEOS2-5307 Modules Window 23 02 2024
        /// <summary>
        /// This method is used to update Product Type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="productType">Get product type details.</param>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        public bool UpdateProductType_V2490(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddUpdateDeleteProductTypeFiles_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddDeleteCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddProductTypeLogEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeComments_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);
                    AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);
                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }

                    try
                    {
                        AddUpdateDeletePLMModulePrices_V2490(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.ModifiedBy);
                        AddBasePriceListLogEntry_V2490(MainServerConnectionString, productType.BasePriceLogEntryList);
                        AddCustomerPriceListLogEntry_V2490(MainServerConnectionString, productType.CustomerPriceLogEntryList);
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2490(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2490(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        //[Sudhir.jangra][GEOS2-4935]
        //Shubham[skadam] GEOS2-5307 Modules Window 23 02 2024
        public ProductTypes AddProductType_V2490(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                        AddProductTypeCommentEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);

                        AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);

                        try
                        {
                            AddUpdateDeletePLMModulePrices_V2490(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.CreatedBy);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2490(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2490(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        public void AddUpdateDeletePLMModulePrices_V2490(string MainServerConnectionString, List<PLMModulePrice> PLMModulePriceList, UInt64 IdCPType, UInt32? IdModifier)
        {
            try
            {
                if (PLMModulePriceList != null)
                {
                    ProductTypes.UpdateAllMaxCostFromNullToZero(PLMModulePriceList);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PLMModulePrice pLMModulePrice in PLMModulePriceList)
                        {
                            if (pLMModulePrice.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (pLMModulePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMModulePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMModulePrice.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (pLMModulePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Update_V2490", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", pLMModulePrice.MaxCost);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMModulePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Update_V2490", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMModulePrice.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (pLMModulePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Insert_V2490", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", pLMModulePrice.MaxCost);
                                    mySqlCommand.Parameters.AddWithValue("_Royalty", 0);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMModulePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_Modules_Insert_V2490", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePLMModulePrices(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddBasePriceListLogEntry_V2490(string MainServerConnectionString, List<BasePriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BasePriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByBasePriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", logList.IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddBasePriceListLogEntry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddCustomerPriceListLogEntry_V2490(string MainServerConnectionString, List<CustomerPriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CustomerPriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByCustomerPriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", logList.IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPriceListLogEntry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<PLMModulePrice> GetNotIncludedPLMModulePrices_V2490(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated, string currencyIconFilePath, UInt64 IdCPType, int IdUser)
        {
            List<PLMModulePrice> PLMModulePrices = new List<PLMModulePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByModule_V2490", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMModulePrice PLMModulePrice = new PLMModulePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMModulePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMModulePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMModulePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMModulePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMModulePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMModulePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMModulePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMModulePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMModulePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMModulePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMModulePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMModulePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMModulePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMModulePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            //if (reader["MaxCost"] != DBNull.Value)
                            //{
                            //    PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            //}
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMModulePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMModulePrice.Country = PLMModulePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMModulePrice.Country = "ALL";
                                }
                            }

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMModulePrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMModulePrice.IdPermission.Equals("62"))
                                {
                                    PLMModulePrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMModulePrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMModulePrice.IsEnabledPermission = false;
                            }
                            PLMModulePrices.Add(PLMModulePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetNotIncludedPLMModulePrices_V2490(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMModulePrices.Any(oi => oi.Currency.Name == item))
                    PLMModulePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMModulePrices;
        }
        public bool IsDeletedDetection_V2500(UInt32 IdDetection, string detectionName, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (IdDetection > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Delete_V2500", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdDetection", IdDetection);
                        mySqlCommand.Parameters.AddWithValue("_DetectionName", detectionName);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedDetection_V2500(). IdProductType- {0} ErrorMessage- {1}", IdDetection, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        //[rdixit][27.03.2024][GEOS2-5556]
        public IList<Company> GetEmdepSitesCompanies_V2500(string connectionstring)
        {
            IList<Company> companies = new List<Company>();
            // Parse the connection string
            MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionstring);

            // Extract components
            string ConnecteddataSource = builder.Server.ToUpper();
            string database = builder.Database;
            string userId = builder.UserID;
            string password = builder.Password;
            string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionstring);
            string dataSource = "";
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("emdepsites_GetEmdepSitesDetail_V2500", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {

                        Company company = new Company();
                        if (string.IsNullOrEmpty(connectedPlantName))
                        {
                            dataSource = ConnecteddataSource.Replace(ConnecteddataSource, sitereader["DatabaseIP"].ToString());
                        }
                        else
                        {
                            dataSource = ConnecteddataSource.Replace(connectedPlantName, sitereader["ShortName"].ToString());
                            //This will removed from code when we update everywhere logic to hit service through service provider url not from database connection string
                        }
                        string connstr = connectionstring.Replace(builder.Server, dataSource);

                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {
                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            company.Name = sitereader["Name"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            company.ServiceProviderUrl = sitereader["ServiceProviderUrl"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }

        //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]
        public List<ProductTypeCompatibility> GetCompatibilitiesByProductType_V2530(string PCMConnectionString, long IdCPTypenew)
        {
            List<ProductTypeCompatibility> productTypeCompatibilityList = new List<ProductTypeCompatibility>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    //MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCPTypeCompatibilitiesByIdCPType", mySqlConnection);
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCPTypeCompatibilitiesByIdCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPTypenew);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeCompatibility productTypeCompatibility = new ProductTypeCompatibility();

                         // productTypeCompatibility.IdCPType = IdCPType;
                            productTypeCompatibility.IdCPTypenew = IdCPTypenew;
                            productTypeCompatibility.IdCompatibility = Convert.ToUInt32(reader["IdCompatibility"]);

                            if (reader["IdCPtypeCompatibility"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdCPtypeCompatibility = Convert.ToByte(reader["IdCPtypeCompatibility"]);
                                if (reader["CPTypeName"] != DBNull.Value)
                                {
                                    productTypeCompatibility.Name = Convert.ToString(reader["CPTypeName"]);
                                    productTypeCompatibility.ProductType = new ProductTypes();
                                    if (reader["CPTypeReference"] != DBNull.Value)
                                    {
                                        productTypeCompatibility.Code = Convert.ToString(reader["CPTypeReference"]);
                                        productTypeCompatibility.ProductType.Reference = Convert.ToString(reader["CPTypeReference"]);
                                    }
                                    productTypeCompatibility.ProductType.IdCPType = Convert.ToUInt64(reader["IdCPtypeCompatibility"]);
                                    productTypeCompatibility.ProductType.Name = Convert.ToString(reader["CPTypeName"]);
                                }
                            }
                            if (reader["IdArticleCompatibility"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdArticleCompatibility = Convert.ToUInt32(reader["IdArticleCompatibility"]);
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    productTypeCompatibility.Name = Convert.ToString(reader["ArticleDesc"]);
                                    productTypeCompatibility.Article = new Articles();
                                    if (reader["ArticleReference"] != DBNull.Value)
                                    {
                                        productTypeCompatibility.Code = Convert.ToString(reader["ArticleReference"]);
                                        productTypeCompatibility.Article.Reference = Convert.ToString(reader["ArticleReference"]);
                                    }
                                    productTypeCompatibility.Article.IdArticle = Convert.ToUInt32(reader["IdArticleCompatibility"]);
                                    productTypeCompatibility.Article.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                            }
                            if (reader["IdTypeCompatibility"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdTypeCompatibility = Convert.ToUInt32(reader["IdTypeCompatibility"]);
                            }
                            if (reader["MinimumElements"] != DBNull.Value)
                            {
                                productTypeCompatibility.MinimumElements = Convert.ToInt32(reader["MinimumElements"]);
                            }
                            if (reader["MaximumElements"] != DBNull.Value)
                            {
                                productTypeCompatibility.MaximumElements = Convert.ToInt32(reader["MaximumElements"]);
                            }
                            if (reader["Quantity"] != DBNull.Value)
                            {
                                productTypeCompatibility.Quantity = Convert.ToInt32(reader["Quantity"]);
                            }
                            if (reader["Remarks"] != DBNull.Value)
                            {
                                productTypeCompatibility.Remarks = Convert.ToString(reader["Remarks"]);
                            }
                            if (reader["IdRelationshipType"] != DBNull.Value)
                            {
                                productTypeCompatibility.IdRelationshipType = Convert.ToInt32(reader["IdRelationshipType"]);
                                if (reader["RelationshipType"] != DBNull.Value)
                                {
                                    productTypeCompatibility.RelationshipType = new LookupValue();
                                    productTypeCompatibility.RelationshipType.IdLookupValue = Convert.ToInt32(reader["IdRelationshipType"]);
                                    productTypeCompatibility.RelationshipType.Value = Convert.ToString(reader["RelationshipType"]);
                                }
                            }
                            productTypeCompatibilityList.Add(productTypeCompatibility);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompatibilitiesByProductType_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypeCompatibilityList;
        }

        //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]



        public ProductTypes GetProductTypeByIdCpType_V2530(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate, string currencyIconFilePath, int IdUser)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        //SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate_V2530";
                    }
                    else
                    {
                        //SP = "PCM_GetProductTypeByIdCpType";
                        SP = "PCM_GetProductTypeByIdCpType_V2530";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }

                #region old 
                //productTypes.TemplateList = GetTemplatesByProductType_V2350(PCMConnectionString, productTypes.IdCPType);
                //// productTypes.WayList = GetWayListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.WayList = GetWaysByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                ////productTypes.DetectionList = GetDetectionListByProductType(PCMConnectionString, productTypes.IdCPType);
                ////productTypes.OptionList = GetOptionListByProductType(PCMConnectionString, productTypes.IdCPType);
                ////productTypes.SparePartList = GetSparePartListByProductType(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.FamilyList = GetFamiliesByProductType_V2380(PCMConnectionString, productTypes.IdCPType);
                //// productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                //productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2340(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);//[Sudhir.jangra][GEOS2-4072][13/12/2022]
                //productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType(PCMConnectionString, productTypes.IdCPType);
                //productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);

                //productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2350(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                ////Add new list for detection list withoutgroup
                //productTypes.DetectionListWithoutGroup = GetDetectionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.OptionListWithoutGroup = GetOptionsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                //productTypes.SparePartListWithoutGroup = GetSparePartsWithGroupsByCpType_V2390(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                ////Add new list for detection list withoutgroup END



                //productTypes.CustomerList = GetCustomersWithRegionsByCPType(PCMConnectionString, productTypes.IdCPType);

                ////productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType(PCMConnectionString, (byte)productTypes.IdCPType);

                //productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType_V2530(PCMConnectionString, (long)productTypes.IdCPType); //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]


                //productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType_V2470(PCMConnectionString, productTypes.IdCPType);

                //productTypes.ProductTypeCommentList = GetProductTypeCommentsEntriesByProductType_V2470(PCMConnectionString, productTypes.IdCPType);

                //try
                //{
                //    productTypes.IncludedPLMModuleList = GetBaseAndCustomerPricesByIdCPType_V2490(PCMConnectionString, productTypes.IdCPType, currencyIconFilePath, IdUser);

                //    string IdBasePriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                //    string IdCustomerPriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                //    productTypes.NotIncludedPLMModuleList = GetNotIncludedPLMModulePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                //        productTypes.IdCPType, IdUser);
                //}
                //catch (Exception ex)
                //{
                //    Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                //}
                #endregion

                productTypes.TemplateList = GetTemplatesByProductType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.WayList = GetWaysByCpType_V2530(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.FamilyList = GetFamiliesByProductType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);

                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2530(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2530(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2530(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.DetectionListWithoutGroup = GetDetectionsWithoutGroupsByCpType_V2530(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.OptionListWithoutGroup = GetOptionsWithoutGroupsByCpType_V2530(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.SparePartListWithoutGroup = GetSparePartsWithoutGroupsByCpType_V2530(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);
                productTypes.CustomerList = GetCustomersWithRegionsByCPType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType_V2530(PCMConnectionString, (long)productTypes.IdCPType); //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeCommentList = GetProductTypeCommentsEntriesByProductType_V2530(PCMConnectionString, productTypes.IdCPType);

                try
                {
                    productTypes.IncludedPLMModuleList = GetBaseAndCustomerPricesByIdCPType_V2530(PCMConnectionString, productTypes.IdCPType, currencyIconFilePath, IdUser);

                    string IdBasePriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                    string IdCustomerPriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                    productTypes.NotIncludedPLMModuleList = GetNotIncludedPLMModulePrices_V2530(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,
                        productTypes.IdCPType, IdUser);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]

        public bool AddCompatibilitiesByProductType_V2530(string MainServerConnectionString, long IdCPType, List<ProductTypeCompatibility> CompatibilityList)
        {
            bool isSave = false;
            try
            {
                if (CompatibilityList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeCompatibility productTypeCompatibility in CompatibilityList)
                        {
                          //MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Insert", mySqlConnection);
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPtype", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdCPtypeCompatibility", productTypeCompatibility.IdCPtypeCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_IdArticleCompatibility", productTypeCompatibility.IdArticleCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_IdTypeCompatibility", productTypeCompatibility.IdTypeCompatibility);
                            mySqlCommand.Parameters.AddWithValue("_MinimumElements", productTypeCompatibility.MinimumElements);
                            mySqlCommand.Parameters.AddWithValue("_MaximumElements", productTypeCompatibility.MaximumElements);
                            if (productTypeCompatibility.IdRelationshipType == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", productTypeCompatibility.IdRelationshipType);
                            }
                            mySqlCommand.Parameters.AddWithValue("_Quantity", productTypeCompatibility.Quantity);
                            mySqlCommand.Parameters.AddWithValue("_Remarks", productTypeCompatibility.Remarks);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", productTypeCompatibility.IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                    isSave = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCompatibilitiesByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isSave;
        }

        //[rushikesh.gaikwad][GEOS2-5583][19.06.2023]
        public ProductTypes AddProductType_V2530(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        // AddProductTypeByTemplate(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);

                        AddProductTypeByTemplate_V2530(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);

                        // AddWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);

                        AddWaysByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);


                        // AddDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);

                        AddDetectionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);

                        // AddOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);

                        AddOptionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);

                        //AddSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);

                        AddSparePartsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);

                        //  AddConnectorFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);

                        AddConnectorFamiliesByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.FamilyList);

                        //  AddProductTypeAttachedDocByProductType_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);

                        AddProductTypeAttachedDocByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);

                        //  AddProductTypeAttachedLinkByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);

                        AddProductTypeAttachedLinkByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);

                        //  AddProductTypeImageByProductType(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);

                        AddProductTypeImageByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);

                        // AddCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);

                        AddCustomersRegionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);

                        // AddSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);

                        AddSitesByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);

                        //  AddProductTypeLogEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        AddProductTypeLogEntry_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);

                        //  AddProductTypeCommentEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);

                        AddProductTypeCommentEntry_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);


                        //  AddCompatibilitiesByProductType(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);


                        AddCompatibilitiesByProductType_V2530(MainServerConnectionString, (long)productType.IdCPType, productType.ProductTypeCompatibilityList);
                        try
                        {
                            //AddUpdateDeletePLMModulePrices_V2490(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.CreatedBy);

                            AddUpdateDeletePLMModulePrices_V2530(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.CreatedBy);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        //[rushikesh.gaikwad][GEOS2-5583][19.06.2023]
        public void AddUpdateDeleteProductTypeCompatibilities_V2530(string MainServerConnectionString, long IdCpType, List<ProductTypeCompatibility> CompatibilityList)
        {
            try
            {
                if (CompatibilityList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeCompatibility productTypeCompatibility in CompatibilityList)
                        {
                            if (productTypeCompatibility.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCompatibility", productTypeCompatibility.IdCompatibility);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (productTypeCompatibility.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeCompatibility.IdCompatibility > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCompatibility", productTypeCompatibility.IdCompatibility);
                                    mySqlCommand.Parameters.AddWithValue("_MinimumElements", productTypeCompatibility.MinimumElements);
                                    mySqlCommand.Parameters.AddWithValue("_MaximumElements", productTypeCompatibility.MaximumElements);
                                    if (productTypeCompatibility.IdRelationshipType == 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", productTypeCompatibility.IdRelationshipType);
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_Quantity", productTypeCompatibility.Quantity);
                                    mySqlCommand.Parameters.AddWithValue("_Remarks", productTypeCompatibility.Remarks);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", productTypeCompatibility.IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (productTypeCompatibility.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                               //MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Insert", mySqlConnection);
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_cptype_compatibilities_Insert_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPtype", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_IdCPtypeCompatibility", productTypeCompatibility.IdCPtypeCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_IdArticleCompatibility", productTypeCompatibility.IdArticleCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_IdTypeCompatibility", productTypeCompatibility.IdTypeCompatibility);
                                mySqlCommand.Parameters.AddWithValue("_MinimumElements", productTypeCompatibility.MinimumElements);
                                mySqlCommand.Parameters.AddWithValue("_MaximumElements", productTypeCompatibility.MaximumElements);
                                if (productTypeCompatibility.IdRelationshipType == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdRelationshipType", productTypeCompatibility.IdRelationshipType);
                                }
                                mySqlCommand.Parameters.AddWithValue("_Quantity", productTypeCompatibility.Quantity);
                                mySqlCommand.Parameters.AddWithValue("_Remarks", productTypeCompatibility.Remarks);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", productTypeCompatibility.IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeCompatibilities_V2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[rushikesh.gaikwad][GEOS2-5583][19.06.2023]
        public bool UpdateProductType_V2530(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                       // MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update", mySqlConnection);
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update_V2530", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    //AddDeleteTemplatesByProductType(MainServerConnectionString, productType.IdCPType, productType.TemplateList);

                    //IsUpdateTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    IsUpdateTemplateByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);

                    //AddUpdateDeleteWaysByProductType_V2250(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                    AddUpdateDeleteWaysByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);

                    //AddUpdateDeleteDetectionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteDetectionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);

                    //AddUpdateDeleteOptionsByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                    AddUpdateDeleteOptionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);

                    //AddUpdateDeleteSparePartsByProductType_V2140(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddUpdateDeleteSparePartsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);


                    //AddDeleteFamiliesByProductType(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                    AddDeleteFamiliesByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.FamilyList);

                    //AddUpdateDeleteProductTypeFiles_V2340(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeFiles_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);


                    //AddUpdateDeleteProductTypeLinks(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                    AddUpdateDeleteProductTypeLinks_2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);


                    //AddUpdateDeleteProductTypeImages(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                    AddUpdateDeleteProductTypeImages_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);

                    //AddDeleteCustomersRegionsByProductType_V2280(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteCustomersRegionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);


                    //AddDeleteSitesByProductType_V2260(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddDeleteSitesByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);

                    //AddProductTypeLogEntry_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddProductTypeLogEntry_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);


                    //AddUpdateDeleteProductTypeComments_V2470(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);
                    AddUpdateDeleteProductTypeComments_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);

                    // AddUpdateDeleteProductTypeCompatibilities(MainServerConnectionString, (byte)productType.IdCPType, productType.ProductTypeCompatibilityList);

                    AddUpdateDeleteProductTypeCompatibilities_V2530(MainServerConnectionString, (long)productType.IdCPType, productType.ProductTypeCompatibilityList); //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]

                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        //IsUpdateDWOSTemplateByProductType(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                        IsUpdateDWOSTemplateByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }

                    try
                    {
                        //AddUpdateDeletePLMModulePrices_V2490(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.ModifiedBy);
                        AddUpdateDeletePLMModulePrices_V2530(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.ModifiedBy);
                        AddBasePriceListLogEntry_V2490(MainServerConnectionString, productType.BasePriceLogEntryList);
                        AddCustomerPriceListLogEntry_V2490(MainServerConnectionString, productType.CustomerPriceLogEntryList);
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }





        /// <summary>
        /// This method is used to update template by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product Type Id.</param>
        /// <param name="IdTemplate">Get template Id.</param>
        public bool IsUpdateTemplateByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, UInt64 IdTemplate_Old)
        {
            bool isUpdated = false;
            try
            {
                if (IdTemplate > 0)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        if (IdTemplate_Old == 0)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        else
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Update_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate_old", IdTemplate_Old);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdateTemplateByProductType_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }


        /// <summary>
        /// This method is used to Add Update Delete ways by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="WaysList">The list of ways.</param>
        public void AddUpdateDeleteWaysByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Ways> WaysList)
        {
            try
            {
                if (WaysList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WaysList)
                        {
                            if (wayList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (wayList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Update_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", wayList.OrderNumber);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (wayList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", wayList.OrderNumber);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteWaysByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Add/Delete detections by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="DetectionsList">The list of detections.</param>
        public void AddUpdateDeleteDetectionsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Detections> DetectionsList)
        {
            try
            {
                if (DetectionsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Detections detectionList in DetectionsList)
                        {
                            if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (IdCPType > 0 && detectionList.IdDetections > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (IdCPType > 0 && detectionList.IdDetections > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("geos.PCM_DetectionsAndOptionsByCPType_Update_V2530;", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionList.OrderNumber);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (detectionList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (IdCPType > 0 && detectionList.IdDetections > 0 && IdTemplate > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionList.OrderNumber);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteDetectionsByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }





        /// <summary>
        /// This method is used to Add/Delete options by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="OptionsList">The list of options.</param>
        public void AddUpdateDeleteOptionsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Options> OptionsList)
        {
            try
            {
                Detections obj = new Detections();
                if (OptionsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Options optionList in OptionsList)
                        {
                            if (optionList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (IdCPType > 0 && optionList.IdOptions > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (optionList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (IdCPType > 0 && optionList.IdOptions > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Update_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", optionList.OrderNumber);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (optionList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (IdCPType > 0 && optionList.IdOptions > 0 && IdTemplate > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", optionList.OrderNumber);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteOptionsByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }



        /// <summary>
        /// This method is used to Add/Delete detections by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="IdTemplate">Get template id.</param>
        /// <param name="DetectionsList">The list of detections.</param>
        public void AddUpdateDeleteSparePartsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<SpareParts> SparePartsList)
        {
            try
            {
                if (SparePartsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartsList)
                        {
                            if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (IdCPType > 0 && sparePartsList.IdSpareParts > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsByCPType_Delete_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (IdCPType > 0 && sparePartsList.IdSpareParts > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Update_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", sparePartsList.OrderNumber);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (sparePartsList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (IdCPType > 0 && sparePartsList.IdSpareParts > 0 && IdTemplate > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                                    mySqlCommand.Parameters.AddWithValue("_OrderNumber", sparePartsList.OrderNumber);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeletesparePartsListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Add/Delete families by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="FamilyList">The list of family.</param>
        public void AddDeleteFamiliesByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> Families)
        {
            try
            {
                if (Families != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in Families)
                        {
                            if (familyList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Delete_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (familyList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);

                                familyList.IdFamily = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteFamiliesByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }




        /// <summary>
        /// This method is used to Add/Update/Delete product type Files
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get file path.</param>
        /// <param name="ProductTypeAttachedDocList">The list of files.</param>
        public void AddUpdateDeleteProductTypeFiles_V2530(string MainServerConnectionString, UInt64 IdCpType, List<ProductTypeAttachedDoc> ProductTypeAttachedDocList, string ProductTypeAttachedDocPath)
        {
            try
            {
                if (ProductTypeAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedDoc productTypeAttachedDocList in ProductTypeAttachedDocList)
                        {
                            if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Delete_V2340", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDocList.IdCPTypeAttachedDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteProductTypeAttachedDocFromPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                            }
                            else if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Update_V2340", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedDoc", productTypeAttachedDocList.IdCPTypeAttachedDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", productTypeAttachedDocList.AttachmentType.IdLookupValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeAttachedDocList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));


                                    mySqlCommand.ExecuteNonQuery();

                                    AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                                }
                            }
                            else if (productTypeAttachedDocList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Insert_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", productTypeAttachedDocList.AttachmentType.IdLookupValue);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedDocList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                productTypeAttachedDocList.IdCPTypeAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                                {
                                    AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeFiles_V2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Add/Update/Delete Product Type Links
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get Product Type id.</param>
        /// <param name="ProductTypeAttachedLinkList">The list of links.</param>
        public void AddUpdateDeleteProductTypeLinks_2530(string MainServerConnectionString, UInt64 IdCpType, List<ProductTypeAttachedLink> ProductTypeAttachedLinkList)
        {
            try
            {
                if (ProductTypeAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedLink productTypeAttachedLinkList in ProductTypeAttachedLinkList)
                        {
                            if (productTypeAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedLink", productTypeAttachedLinkList.IdCPTypeAttachedLink);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (productTypeAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeAttachedLinkList.IdCPTypeAttachedLink > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeAttachedLink", productTypeAttachedLinkList.IdCPTypeAttachedLink);
                                    mySqlCommand.Parameters.AddWithValue("_Name", productTypeAttachedLinkList.Name);
                                    mySqlCommand.Parameters.AddWithValue("_Address", productTypeAttachedLinkList.Address);
                                    mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedLinkList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeAttachedLinkList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (productTypeAttachedLinkList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Insert_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_Name", productTypeAttachedLinkList.Name);
                                mySqlCommand.Parameters.AddWithValue("_Address", productTypeAttachedLinkList.Address);
                                mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedLinkList.Description);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedLinkList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeLinks_2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Add/Update/Delete Product Type Images
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCpType">Get product type id.</param>
        /// <param name="ProductTypeImagePath">Get image path.</param>
        /// <param name="ProductTypeImageList">The list of images.</param>
        public void AddUpdateDeleteProductTypeImages_V2530(string MainServerConnectionString, UInt64 IdCpType, List<ProductTypeImage> ProductTypeImageList, string ProductTypeImagePath)
        {
            try
            {
                if (ProductTypeImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeImage productTypeImageList in ProductTypeImageList)
                        {
                            if (productTypeImageList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPTypeImage", productTypeImageList.IdCPTypeImage);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeleteProductTypeImageFromPath(productTypeImageList, ProductTypeImagePath);
                            }
                            else if (productTypeImageList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productTypeImageList.IdCPTypeImage > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCPTypeImage", productTypeImageList.IdCPTypeImage);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeImageList.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", productTypeImageList.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeImageList.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", productTypeImageList.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_Position", productTypeImageList.Position);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddProductTypeImageToPath(productTypeImageList, ProductTypeImagePath);
                                }
                            }
                            else if (productTypeImageList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Insert_2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeImageList.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", productTypeImageList.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeImageList.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeImageList.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Position", productTypeImageList.Position);

                                productTypeImageList.IdCPTypeImage = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (productTypeImageList.IdCPTypeImage > 0)
                                {
                                    AddProductTypeImageToPath(productTypeImageList, ProductTypeImagePath);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeImages(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }



        /// <summary>
        /// This method is used to Add/Delete customers and regions by product type
        /// [001][cpatil][20-06-2022][GEOS2-3787]
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        public void AddDeleteCustomersRegionsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomersList, UInt32 IdCreator)
        {
            try
            {
                if (CustomersList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customersList in CustomersList)
                        {
                            if (customersList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Delete_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (customersList.IdCustomerPriceListCustomer > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Update_V2280", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_Idcustomers_regions_by_cptype", customersList.IdCustomerPriceListCustomer);
                                    if (customersList.IdGroup == 0)
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                    }
                                    else
                                    {
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_IsIncluded", customersList.IsIncluded);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (customersList.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                if (customersList.IdGroup == 0)
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                }
                                else
                                {
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customersList.IdGroup);
                                }

                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customersList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customersList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customersList.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_IsIncluded", customersList.IsIncluded);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersRegionsByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to Add/Delete customers and regions by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product type id.</param>
        /// <param name="CustomersList">The list of customer.</param>
        public void AddDeleteSitesByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomersList, string PCMConnectionString)
        {
            try
            {
                if (CustomersList != null)
                {
                    List<Site> SitesDeleteCustomerList = new List<Site>();
                    List<Site> SitesAddCustomerList = new List<Site>();
                    if (CustomersList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                    {
                        try
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                            {
                                mySqlConnection.Open();
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegion_V2260", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                foreach (CPLCustomer customerList in CustomersList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).ToList())
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                    {
                                        while (reader.Read())
                                        {
                                            if (reader["IdSite"] != DBNull.Value)
                                            {
                                                Site site = new Site();
                                                site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                                SitesDeleteCustomerList.Add(site);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_GetSitesByCustomerAndRegion. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (CustomersList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add))
                    {
                        try
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                            {
                                mySqlConnection.Open();
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegionByCPType_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                foreach (CPLCustomer customerList in CustomersList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList())
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                    {
                                        while (reader.Read())
                                        {
                                            if (reader["IdSite"] != DBNull.Value)
                                            {
                                                Site site = new Site();
                                                site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                                SitesAddCustomerList.Add(site);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_GetSitesByCustomerAndRegionByCPType. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (SitesDeleteCustomerList != null && SitesDeleteCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Delete_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesDeleteCustomerList = SitesDeleteCustomerList.Distinct().ToList();
                            foreach (Site site in SitesDeleteCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_SitesByCPType_Delete. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    //throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }


                    if (SitesAddCustomerList != null && SitesAddCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesAddCustomerList = SitesAddCustomerList.Distinct().ToList();
                            foreach (Site site in SitesAddCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();

                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2260-PCM_SitesByCPType_Insert. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    //throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteSitesByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddProductTypeLogEntry_V2530(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_LogEntriesByCptype_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeLogEntry_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddUpdateDeleteProductTypeComments_V2530(string connectionString, UInt64 idCpType, List<ProductTypeLogEntry> commentList)
        {
            try
            {
                if (commentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeLogEntry productType in commentList)
                        {
                            if (productType.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ProductType_Comments_Delete_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByCptype", productType.IdLogEntryByCptype);
                                mySqlCommand.ExecuteNonQuery();


                            }
                            else if (productType.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (productType.IdLogEntryByCptype > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_ProductType_Comments_Update_V2470", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryByCptype", productType.IdLogEntryByCptype);
                                    mySqlCommand.Parameters.AddWithValue("_Comments", productType.Comments);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", productType.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", productType.Datetime);
                                    mySqlCommand.Parameters.AddWithValue("_Datetime", productType.Datetime);
                                    // mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (productType.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_CommentsEntriesByCptype_Insert_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", idCpType);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", productType.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", productType.Datetime);
                                mySqlCommand.Parameters.AddWithValue("_Comments", productType.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteProductTypeComments_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to update DWOS template by product type
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdCPType">Get product Type Id.</param>
        /// <param name="IdTemplate">Get template Id.</param>
        public bool IsUpdateDWOSTemplateByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            bool isUpdated = false;
            try
            {
                if (IdTemplate > 0)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_DWOSTemplateByCPType_Update_V2530", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsUpdateDWOSTemplateByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }


        public void AddUpdateDeletePLMModulePrices_V2530(string MainServerConnectionString, List<PLMModulePrice> PLMModulePriceList, UInt64 IdCPType, UInt32? IdModifier)
        {
            try
            {
                if (PLMModulePriceList != null)
                {
                    ProductTypes.UpdateAllMaxCostFromNullToZero(PLMModulePriceList);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (PLMModulePrice pLMModulePrice in PLMModulePriceList)
                        {
                            if (pLMModulePrice.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                if (pLMModulePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Delete_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMModulePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Delete_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMModulePrice.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (pLMModulePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Update_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", pLMModulePrice.MaxCost);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMModulePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Update_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (pLMModulePrice.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                if (pLMModulePrice.Type == "BPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("geos.PLM_base_price_list_by_modules_Insert_V2530;", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", pLMModulePrice.MaxCost);
                                    mySqlCommand.Parameters.AddWithValue("_Royalty", 0);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (pLMModulePrice.Type == "CPL")
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_Modules_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", pLMModulePrice.IdCustomerOrBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    pLMModulePrice.RuleValue = pLMModulePrice.RuleValue;
                                    if (pLMModulePrice.IdRule == 1518)
                                    {
                                        pLMModulePrice.RuleValue = 0;
                                    }
                                    else if (pLMModulePrice.IdRule == 308)
                                    {
                                        if (pLMModulePrice.RuleValue == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    else
                                    {
                                        if (pLMModulePrice.IdRule == 0)
                                        {
                                            pLMModulePrice.RuleValue = null;
                                        }
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", pLMModulePrice.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", pLMModulePrice.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePLMModulePrices(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }



        #region
        /// <summary>
        /// This method is used to get all templates by product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <returns>The list of templates by product Type.</returns>
        public List<Template> GetTemplatesByProductType_V2530(string PCMConnectionString, UInt64 IdCPType)
        {
            List<Template> templates = new List<Template>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetTemplatesByProductType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Template template = new Template();
                            template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                template.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                template.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                template.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                template.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                template.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                template.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                template.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                template.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                template.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                template.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                template.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                template.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                template.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                template.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            templates.Add(template);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetTemplatesByProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return templates;
        }

        /// <summary>
        /// This method is used to get ways
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of ways.</returns>
        public List<Ways> GetWaysByCpType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                Way.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                Way.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                Way.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                Way.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                Way.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                Way.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                Way.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                Way.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                Way.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                Way.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                Way.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                Way.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                Way.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                Way.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Way.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Way.OrderNumber = Convert.ToUInt32(reader["OrderNumber"]);
                            }
                            Ways.Add(Way);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWaysByCpType_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }

        /// <summary>
        /// This method is used to get Families by Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type id.</param>
        /// <returns>The list of Families by Product Type.</returns>
        public List<ConnectorFamilies> GetFamiliesByProductType_V2530(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ConnectorFamilies> ConnectorFamilies = new List<ConnectorFamilies>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFamiliesByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ConnectorFamilies ConnectorFamily = new ConnectorFamilies();
                            ConnectorFamily.IdFamily = Convert.ToUInt64(reader["IdFamily"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                ConnectorFamily.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ConnectorFamily.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                ConnectorFamily.OrderNumber = Convert.ToUInt32(reader["OrderNumber"]);
                            }
                            ConnectorFamilies.Add(ConnectorFamily);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetFamiliesByProductType_V2350(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ConnectorFamilies;
        }

        //[Sudhir.Jangra][GEOS2-4072][13/12/2022]
        /// <summary>
        /// This method is used to get Product Type Attached Docs by id product type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductType">Get product type Attached Doc id.</param>
        /// <param name="ProductTypeAttachedDocPath">Get product type attached doc path.</param>
        /// <returns>The list of Product Type Attached Doc by id product type.</returns>
        public List<ProductTypeAttachedDoc> GetProductTypeAttachedDocsByIdProductType_V2530(string PCMConnectionString, UInt64 IdProductType, string ProductTypeAttachedDocPath)
        {
            List<ProductTypeAttachedDoc> ProductTypeAttachedDocs = new List<ProductTypeAttachedDoc>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeAttachedDocsByIdCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdProductType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeAttachedDoc ProductTypeAttachedDoc = new ProductTypeAttachedDoc();

                            ProductTypeAttachedDoc.IdCPTypeAttachedDoc = Convert.ToUInt32(reader["IdCPTypeAttachedDoc"]);
                            ProductTypeAttachedDoc.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["IdAttachmentType"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.AttachmentType = new LookupValue();
                                ProductTypeAttachedDoc.AttachmentType.IdLookupValue = Convert.ToInt32(reader["IdAttachmentType"]);
                                if (reader["AttachmentTypeValue"] != DBNull.Value)
                                {
                                    ProductTypeAttachedDoc.AttachmentType.Value = Convert.ToString(reader["AttachmentTypeValue"]);
                                }
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeAttachedDoc.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            ProductTypeAttachedDoc.ProductTypeAttachedDocInBytes = GetProductTypeAttachedDoc(Convert.ToString(ProductTypeAttachedDoc.IdCPTypeAttachedDoc), ProductTypeAttachedDocPath, ProductTypeAttachedDoc.SavedFileName);
                            ProductTypeAttachedDocs.Add(ProductTypeAttachedDoc);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedDocsByIdProductType_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeAttachedDocs;
        }

        /// <summary>
        /// This method is used to get Product Type Attached Links by id Product Type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get Product Type Attached Link id.</param>
        /// <returns>The list of Product Type Attached Link by id Product Type.</returns>
        public List<ProductTypeAttachedLink> GetProductTypeAttachedLinksByIdProductType_V2530(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ProductTypeAttachedLink> ProductTypeAttachedLinks = new List<ProductTypeAttachedLink>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypesAttachedLinksByIdCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeAttachedLink ProductTypeAttachedLink = new ProductTypeAttachedLink();

                            ProductTypeAttachedLink.IdCPTypeAttachedLink = Convert.ToUInt32(reader["IdCPTypeAttachedLink"]);
                            ProductTypeAttachedLink.IdCPType = Convert.ToUInt32(reader["IdCPType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeAttachedLink.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            ProductTypeAttachedLinks.Add(ProductTypeAttachedLink);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedLinksByIdProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeAttachedLinks;
        }

        /// <summary>
        /// This method is used to get Product Type Images by id product type.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdProductType">Get product type image id.</param>
        /// <param name="ProductTypeImagePath">Get product type image path.</param>
        /// <returns>The list of Product Type Image by id product type.</returns>
        public List<ProductTypeImage> GetProductTypeImagesByIdProductType_V2530(string PCMConnectionString, UInt64 IdProductType, string ProductTypeImagePath)
        {
            List<ProductTypeImage> ProductTypeImages = new List<ProductTypeImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCptypeImagesByIdCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdProductType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeImage ProductTypeImage = new ProductTypeImage();

                            ProductTypeImage.IdCPTypeImage = Convert.ToUInt64(reader["IdCPTypeImage"]);
                            ProductTypeImage.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                ProductTypeImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ProductTypeImage.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                ProductTypeImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }
                            if (reader["Position"] != DBNull.Value)
                            {
                                ProductTypeImage.Position = Convert.ToUInt64(reader["Position"]);
                            }
                            if (reader["UpdatedDate"] != DBNull.Value)
                            {
                                ProductTypeImage.UpdatedDate = Convert.ToDateTime(reader["UpdatedDate"]);
                            }
                            ProductTypeImage.ProductTypeImageInBytes = GetProductTypeImage(Convert.ToString(ProductTypeImage.IdCPTypeImage), ProductTypeImagePath, ProductTypeImage.SavedFileName);
                            ProductTypeImages.Add(ProductTypeImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeImagesByIdProductType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ProductTypeImages;
        }

        /// <summary>
        /// This method is used to get Detection order Groups with detections by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions by cptype.</returns>
        public List<Detections> GetDetectionsWithGroupsByCpType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                //detectionGroups = GetDetectionGroupsByCPType(PCMConnectionString, 2, IdCPType, IdTemplate);
                detectionGroups = GetDetectionGroupsByCPType_V2530(PCMConnectionString, 2, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                detectionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                detectionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                detectionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                detectionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                detectionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                detectionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detectionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                detectionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                detectionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                detectionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                detectionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                detectionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                detectionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                detectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<Options> GetOptionsWithGroupsByCpType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                //OptionGroups = GetOptionGroupsByCPType(PCMConnectionString, 3, IdCPType, IdTemplate);
                OptionGroups = GetOptionGroupsByCPType_V2530(PCMConnectionString, 3, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                OptionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                OptionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                OptionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                OptionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                OptionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                OptionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                OptionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                OptionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                OptionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                OptionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                OptionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                OptionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                OptionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                OptionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            OptionGroups.Add(OptionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<SpareParts> GetSparePartsWithGroupsByCpType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SparePartGroups = new List<SpareParts>();
            try
            {
                //SparePartGroups = GetSparePartsGroupsByCPType(PCMConnectionString, 4, IdCPType, IdTemplate);
                SparePartGroups = GetSparePartsGroupsByCPType_V2530(PCMConnectionString, 4, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePartGroup = new SpareParts();

                            SparePartGroup.Key = Convert.ToString(reader["IdDetection"]);

                            SparePartGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                SparePartGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePartGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                SparePartGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                SparePartGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                SparePartGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                SparePartGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePartGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePartGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SparePartGroups.Add(SparePartGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SparePartGroups;
        }

        /// <summary>
        /// This method is used to get Detection order Groups with detections by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdDetectionType">Get detection type</param>
        /// <returns>The list of Detection Groups with detctions by cptype.</returns>
        public List<Detections> GetDetectionsWithoutGroupsByCpType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                //  detectionGroups = GetDetectionGroupsByCPType(PCMConnectionString, 2, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                detectionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                detectionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                detectionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                detectionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                detectionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                detectionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detectionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                detectionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                detectionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                detectionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                detectionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                detectionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                detectionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                detectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<Options> GetOptionsWithoutGroupsByCpType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                // OptionGroups = GetOptionGroupsByCPType(PCMConnectionString, 3, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                OptionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                OptionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                OptionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                OptionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                OptionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                OptionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                OptionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                OptionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                OptionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                OptionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                OptionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                OptionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                OptionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                OptionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            OptionGroups.Add(OptionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }

        /// <summary>
        /// This method is used to get Option order Groups with Options by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">Get product type id</param>
        /// <returns>The list of Option Groups with detctions by cptype.</returns>
        public List<SpareParts> GetSparePartsWithoutGroupsByCpType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SparePartGroups = new List<SpareParts>();
            try
            {
                // SparePartGroups = GetSparePartsGroupsByCPType(PCMConnectionString, 4, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePartGroup = new SpareParts();

                            SparePartGroup.Key = Convert.ToString(reader["IdDetection"]);

                            SparePartGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                SparePartGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePartGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                SparePartGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                SparePartGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                SparePartGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                SparePartGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePartGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePartGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SparePartGroups.Add(SparePartGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SparePartGroups;
        }

        /// <summary>
        /// This method is used to get customers with regions by cptype.
        /// </summary>
        /// <param name="PCMConnectionString">The pcm connection string.</param>
        /// <param name="IdCPType">CPType id.</param>
        /// <returns>The list of customers with regions by cptype.</returns>
        public List<RegionsByCustomer> GetCustomersWithRegionsByCPType_V2530(string PCMConnectionString, UInt64 IdCPType)
        {
            List<RegionsByCustomer> regionsByCustomerList = new List<RegionsByCustomer>();
            try
            {
                //regionsByCustomerList = GetAllCustomers(PCMConnectionString);
                //int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegionsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            RegionsByCustomer regionsByCustomer = new RegionsByCustomer();

                            //regionsByCustomer.Key = Convert.ToString(i);

                            regionsByCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            regionsByCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                regionsByCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }
                            if (reader["RegionName"] != DBNull.Value)
                            {
                                regionsByCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                regionsByCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                regionsByCustomer.IsChecked = true;
                            }
                            if (reader["UniqueId"] != DBNull.Value)
                            {
                                regionsByCustomer.UniqueId = Convert.ToString(reader["UniqueId"]);
                            }
                            regionsByCustomerList.Add(regionsByCustomer);

                            //i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegionsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        public List<ProductTypeLogEntry> GetProductTypeLogEntriesByProductType_V2530(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ProductTypeLogEntry> CPTypeLogEntries = new List<ProductTypeLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLogEntriesByIdCptype_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeLogEntry ProductTypeLogEntry = new ProductTypeLogEntry();

                            ProductTypeLogEntry.IdLogEntryByCptype = Convert.ToUInt32(reader["IdLogEntryByCptype"]);

                            ProductTypeLogEntry.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            CPTypeLogEntries.Add(ProductTypeLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeLogEntriesByProductType_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPTypeLogEntries;
        }

        public List<ProductTypeLogEntry> GetProductTypeCommentsEntriesByProductType_V2530(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ProductTypeLogEntry> CPTypeLogEntries = new List<ProductTypeLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCommentsEntriesByIdCptype_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypeLogEntry ProductTypeLogEntry = new ProductTypeLogEntry();

                            ProductTypeLogEntry.IdLogEntryByCptype = Convert.ToUInt32(reader["IdLogEntryByCptype"]);

                            ProductTypeLogEntry.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                ProductTypeLogEntry.People = new People();
                                ProductTypeLogEntry.People.IdPerson = Convert.ToInt32(reader["IdPerson"].ToString());
                                ProductTypeLogEntry.People.Name = reader["Name"].ToString();
                                ProductTypeLogEntry.People.Surname = reader["Surname"].ToString();

                                if (reader["Login"] != DBNull.Value)
                                    ProductTypeLogEntry.People.Login = Convert.ToString(reader["Login"]);

                                if (reader["IdUserGender"] != DBNull.Value)
                                    ProductTypeLogEntry.People.IdPersonGender = Convert.ToByte(reader["IdUserGender"]);
                            }
                            CPTypeLogEntries.Add(ProductTypeLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeCommentsEntriesByProductType_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPTypeLogEntries;
        }

        public List<PLMModulePrice> GetBaseAndCustomerPricesByIdCPType_V2530(string PCMConnectionString, UInt64 IdCPType, string currencyIconFilePath, int IdUser)
        {
            List<PLMModulePrice> PLMModulePrices = new List<PLMModulePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetBaseAndCustomerPricesByIdCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMModulePrice PLMModulePrice = new PLMModulePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMModulePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMModulePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMModulePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMModulePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMModulePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMModulePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMModulePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMModulePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMModulePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMModulePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMModulePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMModulePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMModulePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                PLMModulePrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                PLMModulePrice.IdRule = Convert.ToInt32(reader["IdRule"]);

                                PLMModulePrice.Rule = new LookupValue();
                                if (reader["Rule"] != DBNull.Value)
                                {
                                    PLMModulePrice.Rule.IdLookupValue = Convert.ToInt32(reader["IdRule"]);
                                    PLMModulePrice.Rule.Value = Convert.ToString(reader["Rule"]);
                                    PLMModulePrice.Rule.HtmlColor = Convert.ToString(reader["LogicHtmlCode"]);
                                }
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                PLMModulePrice.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }

                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMModulePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMModulePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMModulePrice.Country = PLMModulePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMModulePrice.Country = "ALL";
                                }
                            }
                            if (PLMModulePrice.MaxCost == null)
                            {
                                PLMModulePrice.MaxCost = 0;
                            }
                            if (PLMModulePrice.RuleValue == null)
                            {
                                PLMModulePrice.RuleValue = 0;
                            }
                            // calculate sellprice (common)
                            if (PLMModulePrice.IdRule == 307)
                            {
                                PLMModulePrice.SellPrice = Convert.ToDouble(PLMModulePrice.MaxCost) +
                                    ((Convert.ToDouble(PLMModulePrice.MaxCost) *
                                    (Convert.ToDouble(PLMModulePrice.RuleValue) / 100)));
                            }
                            else if (PLMModulePrice.IdRule == 308)
                            {
                                if (PLMModulePrice.RuleValue == null)
                                {
                                    PLMModulePrice.RuleValue = null;
                                    PLMModulePrice.SellPrice = null;
                                }
                                else if (PLMModulePrice.RuleValue != null && Convert.ToDouble(PLMModulePrice.RuleValue) <= 0)
                                {
                                    PLMModulePrice.RuleValue = null;
                                    PLMModulePrice.SellPrice = null;
                                }
                                else
                                {
                                    PLMModulePrice.SellPrice = PLMModulePrice.RuleValue;
                                }
                            }
                            else if (PLMModulePrice.IdRule == 1518)
                            {
                                PLMModulePrice.RuleValue = 0;
                                PLMModulePrice.SellPrice = 0;
                            }
                            else if (PLMModulePrice.IdRule == 309)
                            {
                                PLMModulePrice.SellPrice = Convert.ToDouble(PLMModulePrice.MaxCost) +
                                    (Convert.ToDouble(PLMModulePrice.RuleValue));
                            }

                            double SellPriceValue = 0;
                            double MaxCost = 0;

                            if (PLMModulePrice.SellPrice != null)
                                SellPriceValue = Convert.ToDouble(PLMModulePrice.SellPrice);

                            if (PLMModulePrice.MaxCost != null)
                                MaxCost = Convert.ToDouble(PLMModulePrice.MaxCost);

                            PLMModulePrice.Profit = Convert.ToDouble(CalculateBasePriceProfitValue(
                                MaxCost, SellPriceValue));
                            PLMModulePrice.CostMargin = Convert.ToDouble(CalculateBasePriceCostMarginValue(
                                MaxCost, SellPriceValue));

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMModulePrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMModulePrice.IdPermission.Equals("62"))
                                {
                                    PLMModulePrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMModulePrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMModulePrice.IsEnabledPermission = false;
                            }
                            PLMModulePrices.Add(PLMModulePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBaseAndCustomerPricesByIdCPType_V2490(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                PLMModulePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMModulePrices;
        }

        public List<PLMModulePrice> GetNotIncludedPLMModulePrices_V2530(string PCMConnectionString, string IdBasePriceListCommaSeparated, string IdCustomerPriceListCommaSeparated, string currencyIconFilePath, UInt64 IdCPType, int IdUser)
        {
            List<PLMModulePrice> PLMModulePrices = new List<PLMModulePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetNotIncludedBaseAndCustomerPricesByModule_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceListCommaSeparated", IdBasePriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCommaSeparated", IdCustomerPriceListCommaSeparated);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PLMModulePrice PLMModulePrice = new PLMModulePrice();

                            if (reader["ID"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCustomerOrBasePriceList = Convert.ToUInt64(reader["ID"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                PLMModulePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                PLMModulePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                PLMModulePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                PLMModulePrice.Status = new LookupValue();
                                if (reader["Status"] != DBNull.Value)
                                {
                                    PLMModulePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                    PLMModulePrice.Status.Value = Convert.ToString(reader["Status"]);
                                    PLMModulePrice.Status.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                }
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                PLMModulePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                PLMModulePrice.Currency = new Currency();
                                if (reader["CurrencyName"] != DBNull.Value)
                                {
                                    PLMModulePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                    PLMModulePrice.Currency.Name = Convert.ToString(reader["CurrencyName"]);
                                    PLMModulePrice.Currency.Symbol = Convert.ToString(reader["CurrencySymbol"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == PLMModulePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(PLMModulePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["Type"] != DBNull.Value)
                            {
                                PLMModulePrice.Type = Convert.ToString(reader["Type"].ToString());
                            }
                            //if (reader["MaxCost"] != DBNull.Value)
                            //{
                            //    PLMDetectionPrice.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            //}
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                PLMModulePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }


                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                PLMModulePrice.Country = PLMModulePrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        PLMModulePrice.Country = "ALL";
                                }
                            }

                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                PLMModulePrice.IdPermission = reader["IdPermission"].ToString();
                                if (PLMModulePrice.IdPermission.Equals("62"))
                                {
                                    PLMModulePrice.IsEnabledPermission = true;
                                }
                                else
                                {
                                    PLMModulePrice.IsEnabledPermission = false;
                                }
                            }
                            else
                            {
                                PLMModulePrice.IsEnabledPermission = false;
                            }
                            PLMModulePrices.Add(PLMModulePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBaseAndCustomerPricesByIdCPType_V2490(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                if (PLMModulePrices.Any(oi => oi.Currency.Name == item))
                    PLMModulePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);
            }
            return PLMModulePrices;
        }

        #endregion

        //[rushikesh.gaikwad][GEOS2-5583][24.06.2024]

        public void AddProductTypeByTemplate_V2530(string MainServerConnectionString, UInt64 IdTemplate, UInt64 IdCPType)
        {
            try
            {
                if (IdTemplate > 0)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        // MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Insert", mySqlConnection);

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypesByTemplate_Insert_V2530", mySqlConnection);

                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeByTemplate_V2530(). IdTemplate- {0} ErrorMessage- {1}", IdTemplate, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddWaysByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Ways> WayList)
        {
            try
            {
                if (WayList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Ways wayList in WayList)
                        {
                            //MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", wayList.IdWays);
                            mySqlCommand.Parameters.AddWithValue("_OrderNumber", wayList.OrderNumber);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddWaysByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDetectionsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Detections> DetectionList)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Detections detectionList in DetectionList)
                        {
                            if (detectionList.IdDetections > 0)
                            {
                                // MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);

                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);

                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionList.IdDetections);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionList.OrderNumber);

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddOptionsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<Options> OptionList)
        {
            try
            {
                if (OptionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Options optionList in OptionList)
                        {
                            if (optionList.IdOptions > 0)
                            {
                                //  MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);

                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);

                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", optionList.IdOptions);
                                mySqlCommand.Parameters.AddWithValue("_OrderNumber", optionList.OrderNumber);

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddOptionsByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddSparePartsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, UInt64 IdTemplate, List<SpareParts> SparePartList)
        {
            try
            {
                if (SparePartList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SpareParts sparePartsList in SparePartList)
                        {
                            // MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionsAndOptionsByCPType_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", sparePartsList.IdSpareParts);
                            mySqlCommand.Parameters.AddWithValue("_OrderNumber", sparePartsList.OrderNumber);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSparePartsByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddConnectorFamiliesByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> FamilyList)
        {
            try
            {
                if (FamilyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in FamilyList)
                        {
                            //MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddConnectorFamiliesByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddProductTypeAttachedDocByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeAttachedDoc> ProductTypeAttachedDocList, string ProductTypeAttachedDocPath)
        {
            try
            {
                if (ProductTypeAttachedDocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedDoc productTypeAttachedDocList in ProductTypeAttachedDocList)
                        {
                            //  MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Insert_V2340", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeAttachedDocs_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeAttachedDocList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedDocList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeAttachedDocList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", productTypeAttachedDocList.AttachmentType.IdLookupValue);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedDocList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            //mySqlCommand.Parameters.AddWithValue("_DocumentType", productTypeAttachedDocList.AttachmentType.Value);
                            // mySqlCommand.Parameters.AddWithValue("_IdDocType", productTypeAttachedDocList.IdDocType);
                            productTypeAttachedDocList.IdCPTypeAttachedDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                            if (productTypeAttachedDocList.IdCPTypeAttachedDoc > 0)
                            {
                                AddProductTypeAttachedDocToPath(productTypeAttachedDocList, ProductTypeAttachedDocPath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeAttachedDocByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddProductTypeAttachedLinkByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeAttachedLink> ProductTypeAttachedLinkList)
        {
            try
            {
                if (ProductTypeAttachedLinkList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeAttachedLink productTypeAttachedLinkList in ProductTypeAttachedLinkList)
                        {
                            // MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Insert", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_AttachedLinks_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_Name", productTypeAttachedLinkList.Name);
                            mySqlCommand.Parameters.AddWithValue("_Address", productTypeAttachedLinkList.Address);
                            mySqlCommand.Parameters.AddWithValue("_Description", productTypeAttachedLinkList.Description);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeAttachedLinkList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeAttachedLinkByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddProductTypeImageByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeImage> ProductTypeImageList, string ProductTypeImagePath)
        {
            try
            {
                if (ProductTypeImageList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeImage productTypeImageList in ProductTypeImageList)
                        {
                            //  MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Insert", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CptypeImages_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_SavedFileName", productTypeImageList.SavedFileName);
                            mySqlCommand.Parameters.AddWithValue("_Description", productTypeImageList.Description);
                            mySqlCommand.Parameters.AddWithValue("_OriginalFileName", productTypeImageList.OriginalFileName);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", productTypeImageList.CreatedBy);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Position", productTypeImageList.Position);

                            productTypeImageList.IdCPTypeImage = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                            if (productTypeImageList.IdCPTypeImage > 0)
                            {
                                AddProductTypeImageToPath(productTypeImageList, ProductTypeImagePath);
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeImageByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddCustomersRegionsByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomerList, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customerList in CustomerList)
                        {
                            //  MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert_V2280", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_customers_regions_by_cptype_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            if (customerList.IdGroup == 0)
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                            }

                            mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_IsIncluded", customerList.IsIncluded);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersRegionsByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddSitesByProductType_V2530(string MainServerConnectionString, UInt64 IdCPType, List<CPLCustomer> CustomersList, string PCMConnectionString)
        {
            count = count + 1;
            try
            {
                if (CustomersList != null)
                {
                    List<Site> SitesAddCustomerList = new List<Site>();

                    try
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSitesByCustomerAndRegion_V2260", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            foreach (CPLCustomer customerList in CustomersList)
                            {
                                mySqlCommand.Parameters.Clear();
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", customerList.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", customerList.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", customerList.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customerList.IdPlant);
                                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                                {
                                    while (reader.Read())
                                    {
                                        if (reader["IdSite"] != DBNull.Value)
                                        {
                                            Site site = new Site();
                                            site.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                            SitesAddCustomerList.Add(site);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType_V2530 - PCM_GetSitesByCustomerAndRegion. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        throw;
                    }

                    if (SitesAddCustomerList != null && SitesAddCustomerList.Count > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            //      MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Insert", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_SitesByCPType_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            SitesAddCustomerList = SitesAddCustomerList.Distinct().ToList();
                            foreach (Site site in SitesAddCustomerList)
                            {
                                try
                                {
                                    mySqlCommand.Parameters.Clear();
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType_V2530 - PCM_SitesByCPType_Insert. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    //throw;
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSitesByProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddProductTypeCommentEntry_V2530(string MainServerConnectionString, UInt64 IdCPType, List<ProductTypeLogEntry> CommentList)
        {
            try
            {
                if (CommentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ProductTypeLogEntry commentList in CommentList)
                        {
                            //   MySqlCommand mySqlCommand = new MySqlCommand("PCM_CommentsEntriesByCptype_Insert_V2470", mySqlConnection);

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_CommentsEntriesByCptype_Insert_V2530", mySqlConnection);

                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", commentList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", commentList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", commentList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddProductTypeLogEntry_V2530(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<Ways> GetWayListByProductType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1); //Detetction type: 1 for ways. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }

                            Ways.Add(Way);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWayListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }


        public List<Detections> GetDetectionListByProductType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> Detections = new List<Detections>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2); //Detetction type: 2 for detections. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                Detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }
                            if (reader["GroupName"] != DBNull.Value)
                            {
                                Detection.GroupName = Convert.ToString(reader["GroupName"]);
                            }
                            if (reader["GroupOrder"] != DBNull.Value)
                            {
                                Detection.OrderNumber = Convert.ToInt32(reader["GroupOrder"]);
                            }

                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }



        public List<SpareParts> GetSparePartListByProductType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SpareParts = new List<SpareParts>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4); //Detetction type: 4 for spare parts. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePart = new SpareParts();

                            SparePart.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePart.Name = Convert.ToString(reader["Name"]);
                            }

                            SpareParts.Add(SparePart);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSparePartListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SpareParts;
        }


        public List<Options> GetOptionListByProductType_V2530(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> Options = new List<Options>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3); //Detetction type: 3 for options. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            Option.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                Option.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }
                            if (reader["GroupName"] != DBNull.Value)
                            {
                                Option.GroupName = Convert.ToString(reader["GroupName"]);
                            }
                            if (reader["GroupOrder"] != DBNull.Value)
                            {
                                Option.OrderNumber = Convert.ToInt32(reader["GroupOrder"]);
                            }

                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionListByProductType(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }
        
        public List<Detections> GetDetectionGroupsByCPType_V2530(string PCMConnectionString, UInt32 IdDetectionType, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> Detections = new List<Detections>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections Detection = new Detections();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Detection.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Detection.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Detection.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Detection.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Detections.Add(Detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionGroupsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Detections;
        }
        public List<Options> GetOptionGroupsByCPType_V2530(string PCMConnectionString, UInt32 IdDetectionType, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> Options = new List<Options>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options Option = new Options();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                Option.Key = Convert.ToString(reader["KeyName"]);
                            }

                            Option.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Option.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Option.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Option.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            Options.Add(Option);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionGroupsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Options;
        }

        public List<SpareParts> GetSparePartsGroupsByCPType_V2530(string PCMConnectionString, UInt32 IdDetectionType, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SpareParts = new List<SpareParts>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetGroupsByCPType_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", IdDetectionType);
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePart = new SpareParts();

                            if (reader["KeyName"] != DBNull.Value)
                            {
                                SparePart.Key = Convert.ToString(reader["KeyName"]);
                            }

                            SparePart.IdGroup = Convert.ToUInt32(reader["IdGroup"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePart.Name = Convert.ToString(reader["Name"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePart.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePart.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SpareParts.Add(SparePart);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSparePartsGroupsByCPType(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SpareParts;
        }

        public List<CPLCustomer> GetCustomersWithRegions_V2530(string PCMConnectionString, UInt64 IdCPType)
        {
            List<CPLCustomer> regionsByCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                 //   MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegions_V2280", mySqlConnection);

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCustomersWithRegions_V2530", mySqlConnection);

                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer customer = new CPLCustomer();
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                customer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                                if (reader["RegionName"] != DBNull.Value)
                                {
                                    customer.RegionName = Convert.ToString(reader["RegionName"]);
                                }
                            }
                            else
                            {
                                customer.RegionName = "ALL";
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                customer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                                if (reader["CustomerName"] != DBNull.Value)
                                {
                                    customer.GroupName = Convert.ToString(reader["CustomerName"]);
                                }
                            }
                            else
                            {
                                customer.GroupName = "ALL";
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                customer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdSite"] != DBNull.Value)
                            {
                                customer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                customer.Plant = new Site();
                                customer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    customer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                customer.Plant = new Site();
                                customer.Plant.Name = "ALL";
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                customer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                customer.Country = new Country();
                                customer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    customer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                customer.Country = new Country();
                                customer.Country.Name = "ALL";
                            }
                            if (reader["Idcustomers_regions_by_cptype"] != DBNull.Value)
                            {
                                customer.IdCustomerPriceListCustomer = Convert.ToUInt64(reader["Idcustomers_regions_by_cptype"]);
                            }

                            if (reader["IsIncluded"] != DBNull.Value)
                            {
                                customer.IsIncluded = Convert.ToInt32(reader["IsIncluded"]);
                            }
                            regionsByCustomerList.Add(customer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomersWithRegions_V2280(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return regionsByCustomerList;
        }

        //[rdixit][15.07.2024][rdixit]
        public List<Articles> GetAllPCMArticles_V2540(string connectionString, string ArticleVisualAidsPath, string ImagePath)
        {
            List<Articles> articles = new List<Articles>();
            List<PCMArticleCategory> CategoryList = GetPCMArticleCategories_V2290(connectionString);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllPCMArticles_V2440", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Articles article = new Articles();
                            try
                            {
                                article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["Imagecount"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["Imagecount"]) != 0)
                                    {
                                        article.ArticleImageCount = Convert.ToString(reader["Imagecount"]) + " " + "Image(s)"; ;
                                        article.IsImageButtonEnabled = true;
                                        article.IsImageVisible = Visibility.Visible;
                                    }
                                    else
                                    {
                                        article.IsImageButtonEnabled = false;
                                        article.IsImageVisible = Visibility.Collapsed;
                                    }
                                }
                                else
                                {
                                    article.IsImageButtonEnabled = false;
                                    article.IsImageVisible = Visibility.Collapsed;
                                }
                                if (reader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(reader["Reference"]);

                                if (reader["Description"] != DBNull.Value)
                                    article.Description = Convert.ToString(reader["Description"]).Trim();

                                if (reader["Description_es"] != DBNull.Value)
                                    article.Description_es = Convert.ToString(reader["Description_es"]).Trim();

                                if (reader["Description_fr"] != DBNull.Value)
                                    article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();

                                if (reader["Description_ro"] != DBNull.Value)
                                    article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();

                                if (reader["Description_zh"] != DBNull.Value)
                                    article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();

                                if (reader["Description_pt"] != DBNull.Value)
                                    article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();

                                if (reader["Description_ru"] != DBNull.Value)
                                    article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();

                                article.Visibility = "Hidden";

                                if (reader["ImagePath"] != DBNull.Value)
                                {
                                    article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                }

                                if (reader["Length"] != DBNull.Value)
                                    article.Length = (float)reader["Length"];

                                if (reader["Width"] != DBNull.Value)
                                    article.Width = (float)reader["Width"];

                                if (reader["Height"] != DBNull.Value)
                                    article.Height = (float)reader["Height"];

                                if (reader["Weight"] != DBNull.Value)
                                    article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    article.PcmArticleCategory = new PCMArticleCategory();
                                    article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    if (reader["PCMArticleCategoryName"] != DBNull.Value)
                                    {
                                        article.PcmArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                        article.ArticleCategory = new ArticleCategories();
                                        article.ArticleCategory.Name = Convert.ToString(reader["PCMArticleCategoryName"]);
                                    }
                                }

                                if (reader["idArticleSupplier"] != DBNull.Value)
                                    article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                                if (reader["SupplierName"] != DBNull.Value)
                                    article.SupplierName = Convert.ToString(reader["SupplierName"]);

                                if (reader["IsObsolete"] != DBNull.Value)
                                    article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                                if (article.IsObsolete == 0)
                                {
                                    article.WarehouseStatus = WarehouseStatus.Active;
                                }
                                else
                                {
                                    article.WarehouseStatus = WarehouseStatus.Inactive;
                                }
                                if (reader["IdPCMStatus"] != DBNull.Value)
                                    article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                                if (reader["PCMStatus"] != DBNull.Value)
                                    article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                                if (CategoryList != null)
                                {
                                    article.CategoryMenulist = CategoryList.OrderBy(x => x.Position).ToList();
                                    article.PcmArticleCategory = CategoryList.FirstOrDefault(a => a.IdPCMArticleCategory == article.IdPCMArticleCategory);
                                }

                                if (reader["PurchaseQtyMin"] != DBNull.Value)
                                    article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                                if (reader["PurchaseQtyMax"] != DBNull.Value)
                                    article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];
                                if (reader["IsShareWithCustomer"] != DBNull.Value)
                                    article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                                if (reader["IsSparePartOnly"] != DBNull.Value)
                                    article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                                if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (article.IsShareWithCustomer == 1)
                                    {
                                        article.IdECOSVisibility = 323;
                                    }
                                    else if (article.IsSparePartOnly == 1)
                                    {
                                        article.IdECOSVisibility = 324;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                    {
                                        article.IdECOSVisibility = 325;
                                    }
                                    else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                    {
                                        article.IdECOSVisibility = 326;
                                    }
                                }

                                if (reader["PCMDescription"] != DBNull.Value)
                                {
                                    article.PCMDescription = Convert.ToString(reader["PCMDescription"]);
                                    if (!string.IsNullOrEmpty(article.PCMDescription))
                                    {
                                        article.IsRichText = "Yes";
                                    }
                                    else
                                    {
                                        article.IsRichText = "";
                                    }
                                }
                                if (reader["IsRtfText"] != DBNull.Value)
                                {
                                    article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                                }
                                if (reader["WarehouseCreationDate"] != DBNull.Value)
                                {
                                    article.WarehouseCreationDate = Convert.ToDateTime(reader["WarehouseCreationDate"]);
                                }
                                if (reader["PCMCreationDate"] != DBNull.Value)
                                {
                                    article.PCMCreationDate = Convert.ToDateTime(reader["PCMCreationDate"]);
                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2540(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticles_V2540(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }
        //[rdixit][15.07.2024][rdixit]
        public List<ArticleCostPrice> GetArticleCostPricesByCurrency_V2540(string pLMConnectionString, UInt32 idCurrency)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(pLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleCostPricesByCurrency_V2540", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", idCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["Alias"] != DBNull.Value)
                            {
                                articleCostPrice.Alias = Convert.ToString(reader["Alias"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPricesByCurrency_V2540(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }
        //[rdixit][15.07.2024][rdixit]
        public List<CurrencyConversion> GetCurrencyConversionsDetailsByLatestDate(string WorkbenchConnectionString)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCurrencyConversionsDetailsByLatestDate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsDetailsByLatestDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }
        //[rdixit][15.07.2024][rdixit]
        public List<BasePriceListByItem> GetSalesPriceForPCMArticleByBPL(string connectionString)
        {
            List<BasePriceListByItem> articles = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSalesPriceForPCMArticleByBPL", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 20000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem article = new BasePriceListByItem();
                            try
                            {
                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                                if (reader["IdBasePriceList"] != DBNull.Value)
                                {
                                    article.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                                    if (reader["MaxCost"] != DBNull.Value)
                                    {
                                        article.MaxCost = (float)Convert.ToDouble(reader["MaxCost"]);
                                    }
                                    if (reader["IdExchangeRateUpdateType"] != DBNull.Value)
                                    {
                                        article.IdExchangeRateUpdateType = Convert.ToInt32(reader["IdExchangeRateUpdateType"]);
                                    }
                                    if (reader["IdRule"] != DBNull.Value)
                                    {
                                        article.IdRule = Convert.ToInt32(reader["IdRule"]);
                                    }
                                    if (reader["RuleValue"] != DBNull.Value)
                                    {
                                        article.RuleValue = (float)Convert.ToDouble(reader["RuleValue"]);
                                    }
                                    if (reader["Name"] != DBNull.Value)
                                    {
                                        article.Name = Convert.ToString(reader["Name"]);
                                    }
                                    if (reader["IdCurrency"] != DBNull.Value)
                                    {
                                        article.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                                    }
                                    article.PlantList = GetPlantsByIdBasePrice(connectionString, article.IdBasePriceList);
                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceForPCMArticleByBPL(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceForPCMArticleByBPL(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }
        //[rdixit][15.07.2024][rdixit]
        public List<Site> GetPlantsByIdBasePrice(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePricePlantsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdPlant"]);
                            if (reader["ShortName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["ShortName"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPlantsByIdBasePrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }
        //[Rahul.Gadhave][GEOS2-5898][Date:21-08-2024]
        public List<DetectionChangeDetails> GetDailyUpdateChanges_V2550(string connectionString, DateTime date)
        {
            List<DetectionChangeDetails> detectionChangeDetailsList = new List<DetectionChangeDetails>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("GetUpdateChangeDetailsByDate_V2550", mySqlConnection);
                    mySqlCommand.Parameters.AddWithValue("_ChangeDate", date);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 20000;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionChangeDetails detection = new DetectionChangeDetails();

                            // Safely assign values using if conditions
                            if (reader["ChangeType"] != DBNull.Value)
                            {
                                detection.ChangeType = Convert.ToString(reader["ChangeType"]);
                            }

                            if (reader["FirstName"] != DBNull.Value)
                            {
                                detection.Employee = Convert.ToString(reader["FirstName"]);
                            }

                            if (reader["Code"] != DBNull.Value)
                            {
                                detection.Code = Convert.ToString(reader["Code"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detection.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Feilds"] != DBNull.Value)
                            {
                                detection.Field = Convert.ToString(reader["Feilds"]);
                            }
                            if (reader["OriginalValue"] != DBNull.Value)
                            {
                                detection.OriginalValue = Convert.ToString(reader["OriginalValue"]);
                            }

                            if (reader["NewValue"] != DBNull.Value)
                            {
                                detection.NewValue = Convert.ToString(reader["NewValue"]);
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                detection.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                detection.Date = Convert.ToDateTime(reader["Datetime"]);
                            }
                            detectionChangeDetailsList.Add(detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error in GetDailyUpdateChanges_V2550(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionChangeDetailsList;
        }

        public List<DetectionChangeDetails> GetDailyAddedChanges_V2550(string connectionString, DateTime date)
        {
            List<DetectionChangeDetails> detectionChangeDetailsList = new List<DetectionChangeDetails>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("GetAddChangeDetailsByDate_V2550", mySqlConnection);
                    mySqlCommand.Parameters.AddWithValue("_DateTime", date);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 20000;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DetectionChangeDetails detection = new DetectionChangeDetails();

                            // Safely assign values using if conditions
                            if (reader["ChangeType"] != DBNull.Value)
                            {
                                detection.ChangeType = Convert.ToString(reader["ChangeType"]);
                            }

                            if (reader["FirstName"] != DBNull.Value)
                            {
                                detection.Employee = Convert.ToString(reader["FirstName"]);
                            }

                            if (reader["Code"] != DBNull.Value)
                            {
                                detection.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["status"] != DBNull.Value)
                            {
                                detection.Status = Convert.ToString(reader["status"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                detection.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                detection.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                            }
                            detectionChangeDetailsList.Add(detection);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error in GetDailyAddedChanges_V2550(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }


            return detectionChangeDetailsList;
        }

        //[Rahul.Gadhave][GEOS2-5896][Date:29/08/2024]
        public DetectionDetails AddDetection_V2560(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2330", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        

                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                        AddRelatedModulesByDetection_V2400(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.ProductTypesList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetection_V2560(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }
        //[Rahul.Gadhave][GEOS2-5896][Date:05-09-2024]
        public DetectionDetails AddDetectionForAddDetectionViewModel_V2560(DetectionDetails detectionDetails, string MainServerConnectionString, string DetectionAttachedDocPath, string DetectionImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    UInt32 IdGroup = 0;
                    if (detectionDetails.IdDetectionType == 2 || detectionDetails.IdDetectionType == 3 || detectionDetails.IdDetectionType == 4)
                    {
                        IdGroup = AddUpdateDeleteDetectionGroup(MainServerConnectionString, detectionDetails.IdDetectionType, detectionDetails.DetectionGroupList, detectionDetails.DetectionOrderGroup);
                    }

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Detections_Insert_V2330", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_Name", detectionDetails.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", detectionDetails.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", detectionDetails.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", detectionDetails.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", detectionDetails.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", detectionDetails.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", detectionDetails.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", detectionDetails.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", detectionDetails.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", detectionDetails.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", detectionDetails.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", detectionDetails.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", detectionDetails.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", detectionDetails.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", detectionDetails.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_Family", detectionDetails.Family);
                        mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", detectionDetails.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                        mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                        mySqlCommand.Parameters.AddWithValue("_Orientation", detectionDetails.Orientation);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", detectionDetails.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsMandatoryVisualAid", detectionDetails.IsMandatoryVisualAid);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                        mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                        mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                        mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                        mySqlCommand.Parameters.AddWithValue("_IdScope", detectionDetails.IdScope);
                        mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                        detectionDetails.IdDetections = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (detectionDetails.IdDetections > 0)
                    {
                        AddDetectionAttachedDocByDetection_V2340(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedDocList, DetectionAttachedDocPath);
                        AddDetectionAttachedLinkByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionAttachedLinkList);
                        AddDetectionImageByDetection(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionImageList, DetectionImagePath);
                        AddCustomersRegionsByDetection_V2280(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.CustomerListByDetection, detectionDetails.IdDetectionType, detectionDetails.CreatedBy);
                        AddDetectionLogEntry_V2470(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);
                        AddUpdateDeletePLMDetectionPrices(MainServerConnectionString, detectionDetails.ModifiedPLMDetectionList, detectionDetails.IdDetections, detectionDetails.CreatedBy);
                        AddDetectionComments_V2470(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionCommentsList, detectionDetails.IdDetectionType);



                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDetectionForAddDetectionViewModel_V2560(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return detectionDetails;
        }
        //[RGadhave][GEOS2-5896][25.09.2024]
        public bool IsUpdatePCM_DetectionECOSVisibility_Update_V2560(string MainServerConnectionString, DetectionDetails detectionDetails)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (detectionDetails.IdDetections >= 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("PCM_DetectionECOSVisibility_Update_V2560", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", detectionDetails.PurchaseQtyMin);
                            mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", detectionDetails.PurchaseQtyMax);
                            mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", detectionDetails.IsShareWithCustomer);
                            mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", detectionDetails.IsSparePartOnly);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", detectionDetails.IdDetections);
                            mySqlCommand.Parameters.AddWithValue("_IdStatus", detectionDetails.IdStatus);
                            mySqlCommand.Parameters.AddWithValue("_Description", detectionDetails.Description.Trim());
                            mySqlCommand.Parameters.AddWithValue("_WeldOrder", detectionDetails.WeldOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdDetectionType", detectionDetails.IdDetectionType);
                            mySqlCommand.Parameters.AddWithValue("_IdTestType", detectionDetails.IdTestType);
                            mySqlCommand.Parameters.AddWithValue("_IdGroup", detectionDetails.IdGroup);
                            mySqlCommand.Parameters.AddWithValue("_Code", detectionDetails.Code);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", detectionDetails.LastUpdate);
                            mySqlCommand.ExecuteNonQuery();
                            mySqlConnection.Close();

                            isUpdated = true;
                        }
                        AddDetectionLogEntry(MainServerConnectionString, detectionDetails.IdDetections, detectionDetails.DetectionLogEntryList, detectionDetails.IdDetectionType);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCM_DetectionECOSVisibility_Update_V2340(). IdArticle- {0} ErrorMessage- {1}", detectionDetails.IdDetections, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public List<BasePriceListByItem> GetSalesPriceForPCMArticleByBPL_V2590(string connectionString)
        {
            List<BasePriceListByItem> articles = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSalesPriceForPCMArticleByBPL_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 20000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem article = new BasePriceListByItem();
                            try
                            {
                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                                if (reader["IdBasePriceList"] != DBNull.Value)
                                {
                                    article.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                                    if (reader["MaxCost"] != DBNull.Value)
                                    {
                                        article.MaxCost = (float)Convert.ToDouble(reader["MaxCost"]);
                                    }
                                    if (reader["IdExchangeRateUpdateType"] != DBNull.Value)
                                    {
                                        article.IdExchangeRateUpdateType = Convert.ToInt32(reader["IdExchangeRateUpdateType"]);
                                    }
                                    if (reader["IdRule"] != DBNull.Value)
                                    {
                                        article.IdRule = Convert.ToInt32(reader["IdRule"]);
                                    }
                                    if (reader["RuleValue"] != DBNull.Value)
                                    {
                                        article.RuleValue = (float)Convert.ToDouble(reader["RuleValue"]);
                                    }
                                    if (reader["Name"] != DBNull.Value)
                                    {
                                        article.Name = Convert.ToString(reader["Name"]);
                                    }
                                    if (reader["IdCurrency"] != DBNull.Value)
                                    {
                                        article.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                                    }
                                    if (reader["PlantIdList"] != DBNull.Value)
                                    {
                                        article.PlantIdList = Convert.ToString(reader["PlantIdList"]).Split(',')?.Select(i => Convert.ToUInt32(i))?.ToList();
                                    }
                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceForPCMArticleByBPL_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceForPCMArticleByBPL_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        //[rdixit][GEOS2-6522][29.11.2024]
        public List<Tuple<ulong, string>> GetArticleCostPricesPlantByCurrency_V2590(string pLMConnectionString)
        {
            List<Tuple<ulong, string>> articleCostPricesList = new List<Tuple<ulong, string>>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(pLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleCostPricesPlant_V2590", mySqlConnection)
                    {
                        CommandType = CommandType.StoredProcedure
                    };

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ulong idArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            string alias = reader["Alias"] != DBNull.Value ? Convert.ToString(reader["Alias"]) : string.Empty;

                            articleCostPricesList.Add(new Tuple<ulong, string>(idArticleCostPrice, alias));
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(
                    string.Format("Error GetArticleCostPricesPlantByCurrency_V2590(). ErrorMessage- {0}", ex.Message),
                    category: Category.Exception,
                    priority: Priority.Low
                );
                throw; 
            }

            return articleCostPricesList; 
        }

        //[rdixit][GEOS2-6522][29.11.2024]
        public List<Tuple<ulong, string, uint>> GetSalesPriceNameList_V2590(string connectionString)
        {
            List<Tuple<ulong, string, uint>> articles = new List<Tuple<ulong, string, uint>>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSalesPriceNameList_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 20000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem article = new BasePriceListByItem();
                            try
                            {
                                if (reader["IdBasePriceList"] != DBNull.Value)
                                {
                                    article.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);                                                                                                     
                                    if (reader["Name"] != DBNull.Value)
                                    {
                                        article.Name = Convert.ToString(reader["Name"]);
                                    }
                                    if (reader["IdCurrency"] != DBNull.Value)
                                    {
                                        article.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                                    }                                   
                                }
                                articles.Add(new Tuple<ulong, string, uint>(article.IdBasePriceList, article.Name, article.IdCurrency));
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceNameList_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceNameList_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        //[rdixit][GEOS2-6522][29.11.2024]
        public List<CurrencyConversion> GetCurrencyConversionsByLatestDate_V2590(string connectionString, string idCurrencyFrom, uint idCurrencyTo)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetCurrencyConversionsByLatestDate_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrencyFrom", idCurrencyFrom);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrencyTo", idCurrencyTo);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsByLatestDate_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }

        //[rdixit][GEOS2-6522][29.11.2024]
        public List<ArticleCostPrice> GetArticleCostPricesByCompany_V2590(string pLMConnectionString, string alias, uint idCountry)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(pLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleCostPricesByCompany_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_Alias", alias);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", idCountry);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["Alias"] != DBNull.Value)
                            {
                                articleCostPrice.Alias = Convert.ToString(reader["Alias"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPricesByCompany_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }

        //[rdixit][GEOS2-6522][29.11.2024]
        public List<BasePriceListByItem> GetSalesPriceforArticleByIdBasePrice_V2590(string connectionString, ulong idBasePrice)
        {
            List<BasePriceListByItem> articles = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetSalesPriceforArticleByIdBasePrice_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePrice", idBasePrice);
                    mySqlCommand.CommandTimeout = 20000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem article = new BasePriceListByItem();
                            try
                            {
                                if (reader["IdArticle"] != DBNull.Value)
                                    article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                                if (reader["IdBasePriceList"] != DBNull.Value)
                                {
                                    article.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                                    if (reader["MaxCost"] != DBNull.Value)
                                    {
                                        article.MaxCost = (float)Convert.ToDouble(reader["MaxCost"]);
                                    }
                                    if (reader["IdExchangeRateUpdateType"] != DBNull.Value)
                                    {
                                        article.IdExchangeRateUpdateType = Convert.ToInt32(reader["IdExchangeRateUpdateType"]);
                                    }
                                    if (reader["IdRule"] != DBNull.Value)
                                    {
                                        article.IdRule = Convert.ToInt32(reader["IdRule"]);
                                    }
                                    if (reader["RuleValue"] != DBNull.Value)
                                    {
                                        article.RuleValue = (float)Convert.ToDouble(reader["RuleValue"]);
                                    }
                                    if (reader["Name"] != DBNull.Value)
                                    {
                                        article.Name = Convert.ToString(reader["Name"]);
                                    }
                                    if (reader["IdCurrency"] != DBNull.Value)
                                    {
                                        article.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                                    }
                                    if (reader["PlantIdList"] != DBNull.Value)
                                    {
                                        article.PlantIdList = Convert.ToString(reader["PlantIdList"]).Split(',')?.Select(i => Convert.ToUInt32(i))?.ToList();
                                    }
                                }
                                articles.Add(article);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceforArticleByIdBasePrice_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSalesPriceforArticleByIdBasePrice_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articles;
        }

        //[rdixit][GEOS2-6624][10.12.2024]
        public ProductTypes GetProductTypeByIdCpType_V2590(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate, string currencyIconFilePath, int IdUser)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        //SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate_V2530";
                    }
                    else
                    {
                        //SP = "PCM_GetProductTypeByIdCpType";
                        SP = "PCM_GetProductTypeByIdCpType_V2530";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                productTypes.TemplateList = GetTemplatesByProductType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.WayList = GetWaysByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);//[rdixit][13.12.2024][GEOS2-6753]
                productTypes.FamilyList = GetFamiliesByProductType_V2590(PCMConnectionString, productTypes.IdCPType); //[rdixit][GEOS2-6624][10.12.2024]
                productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath);
                productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath);
                productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);//[rdixit][13.12.2024][GEOS2-6753]
                productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);//[rdixit][13.12.2024][GEOS2-6753]
                productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);//[rdixit][13.12.2024][GEOS2-6753]
                productTypes.DetectionListWithoutGroup = GetDetectionsWithoutGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);//[rdixit][13.12.2024][GEOS2-6753]
                productTypes.OptionListWithoutGroup = GetOptionsWithoutGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);//[rdixit][13.12.2024][GEOS2-6753]
                productTypes.SparePartListWithoutGroup = GetSparePartsWithoutGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate);//[rdixit][13.12.2024][GEOS2-6753]
                productTypes.CustomerList = GetCustomersWithRegionsByCPType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType_V2530(PCMConnectionString, (long)productTypes.IdCPType); //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]
                productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType_V2530(PCMConnectionString, productTypes.IdCPType);
                productTypes.ProductTypeCommentList = GetProductTypeCommentsEntriesByProductType_V2530(PCMConnectionString, productTypes.IdCPType);

                try
                {
                    productTypes.IncludedPLMModuleList = GetBaseAndCustomerPricesByIdCPType_V2530(PCMConnectionString, productTypes.IdCPType, currencyIconFilePath, IdUser);
                    string IdBasePriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                productTypes.NotIncludedPLMModuleList = GetNotIncludedPLMModulePrices_V2530(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath,productTypes.IdCPType, IdUser);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2530(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        //[rdixit][GEOS2-6624][10.12.2024]
        public List<ConnectorFamilies> GetFamiliesByProductType_V2590(string PCMConnectionString, UInt64 IdCPType)
        {
            List<ConnectorFamilies> ConnectorFamilies = new List<ConnectorFamilies>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetFamiliesByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            ConnectorFamilies ConnectorFamily = new ConnectorFamilies();
                            if (reader["KeyName"] != DBNull.Value)
                                ConnectorFamily.Key = Convert.ToString(reader["KeyName"]);

                            if (reader["SubfamilyID"] != DBNull.Value)
                                ConnectorFamily.IdSubFamilyConnector = Convert.ToInt32(reader["SubfamilyID"]);

                            if (reader["ParentFamilyID"] != DBNull.Value)
                                ConnectorFamily.IdFamily = Convert.ToUInt64(reader["ParentFamilyID"]);

                            if (reader["Parent_Category"] != DBNull.Value)
                                ConnectorFamily.Parent = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Parent_Category"] != DBNull.Value)
                                ConnectorFamily.IdFamily = Convert.ToUInt64(reader["IdFamily"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                ConnectorFamily.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                ConnectorFamily.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                ConnectorFamily.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                ConnectorFamily.OrderNumber = Convert.ToUInt32(reader["OrderNumber"]);
                            }
                            ConnectorFamilies.Add(ConnectorFamily);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetFamiliesByProductType_V2590(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return ConnectorFamilies;
        }

        //[rdixit][GEOS2-6624][10.12.2024]
        public List<ConnectorFamilies> GetAllFamiliesWithSubFamily_V2590(string MainServerConnectionString)
        {
            List<ConnectorFamilies> connector = new List<ConnectorFamilies>();
            List<int> IntList = new List<int>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetConnectorFamilies_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader rdr = mySqlCommand.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            ConnectorFamilies connectorFamilies = new ConnectorFamilies();
                            if (rdr["KeyName"] != DBNull.Value)
                                connectorFamilies.Key = Convert.ToString(rdr["KeyName"]);
                            if (rdr["SubfamilyID"] != DBNull.Value)
                                connectorFamilies.IdSubFamilyConnector = Convert.ToInt32(rdr["SubfamilyID"]);
                            if (rdr["ParentFamilyID"] != DBNull.Value)
                                connectorFamilies.IdFamily = Convert.ToUInt64(rdr["ParentFamilyID"]);
                            if (rdr["Parent_Category"] != DBNull.Value)
                                connectorFamilies.Parent = Convert.ToString(rdr["Parent_Category"]);
                            if (rdr["Name"] != DBNull.Value)
                                connectorFamilies.Name = Convert.ToString(rdr["Name"]);
                            if (rdr["Name_es"] != DBNull.Value)
                                connectorFamilies.Name_es = Convert.ToString(rdr["Name_es"]);
                            if (rdr["Name_fr"] != DBNull.Value)
                                connectorFamilies.Name_fr = Convert.ToString(rdr["Name_fr"]);
                            if (rdr["Name_pt"] != DBNull.Value)
                                connectorFamilies.Name_pt = Convert.ToString(rdr["Name_pt"]);
                            if (rdr["Name_ro"] != DBNull.Value)
                                connectorFamilies.Name_ro = Convert.ToString(rdr["Name_ro"]);
                            if (rdr["Name_ru"] != DBNull.Value)
                                connectorFamilies.Name_ru = Convert.ToString(rdr["Name_ru"]);
                            if (rdr["Name_zh"] != DBNull.Value)
                                connectorFamilies.Name_zh = Convert.ToString(rdr["Name_zh"]);
                            if (rdr["Description"] != DBNull.Value)
                                connectorFamilies.Description = Convert.ToString(rdr["Description"]);
                            if (rdr["Description_es"] != DBNull.Value)
                                connectorFamilies.Description_es = Convert.ToString(rdr["Description_es"]);
                            if (rdr["Description_fr"] != DBNull.Value)
                                connectorFamilies.Description_fr = Convert.ToString(rdr["Description_fr"]);
                            if (rdr["Description_pt"] != DBNull.Value)
                                connectorFamilies.Description_pt = Convert.ToString(rdr["Description_pt"]);
                            if (rdr["Description_ro"] != DBNull.Value)
                                connectorFamilies.Description_ro = Convert.ToString(rdr["Description_ro"]);
                            if (rdr["Description_ru"] != DBNull.Value)
                                connectorFamilies.Description_ru = Convert.ToString(rdr["Description_ru"]);
                            if (rdr["Description_zh"] != DBNull.Value)
                                connectorFamilies.Description_zh = Convert.ToString(rdr["Description_zh"]);
                            connector.Add(connectorFamilies);
                        }
                    }
                    mySqlConnection.Close();
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllFamiliesWithSubFamily_V2590().  ErrorMessage- {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return connector;
        }

        //[rdixit][GEOS2-6624][10.12.2024]
        public bool UpdateProductType_V2590(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();                       
                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Update_V2530", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCPType", productType.IdCPType);
                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_modifiedBy", productType.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_modifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    //add delete template, ways, detections, options, spare parts & families & log
                    IsUpdateTemplateByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.IdTemplate_old);
                    AddUpdateDeleteWaysByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);                    
                    AddUpdateDeleteDetectionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                    AddUpdateDeleteOptionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);                    
                    AddUpdateDeleteSparePartsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                    AddDeleteFamiliesByProductType_V2590(MainServerConnectionString, productType.IdCPType, productType.FamilyList);  //[rdixit][GEOS2-6624][10.12.2024]                  
                    AddUpdateDeleteProductTypeFiles_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                    AddUpdateDeleteProductTypeLinks_2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);                    
                    AddUpdateDeleteProductTypeImages_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);                    
                    AddDeleteCustomersRegionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.ModifiedBy);
                    AddDeleteSitesByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                    AddProductTypeLogEntry_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                    AddUpdateDeleteProductTypeComments_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);
                    AddUpdateDeleteProductTypeCompatibilities_V2530(MainServerConnectionString, (long)productType.IdCPType, productType.ProductTypeCompatibilityList); //[rushikesh.gaikwad][GEOS2-5583][19.06.2024]

                    if (productType.IdTemplate != productType.IdTemplate_old)
                    {
                        IsUpdateDWOSTemplateByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate);
                    }

                    try
                    {
                        AddUpdateDeletePLMModulePrices_V2530(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.ModifiedBy);
                        AddBasePriceListLogEntry_V2490(MainServerConnectionString, productType.BasePriceLogEntryList);
                        AddCustomerPriceListLogEntry_V2490(MainServerConnectionString, productType.CustomerPriceLogEntryList);
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateProductType_V2530(). IdCPType- {0} ErrorMessage- {1}", productType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[rdixit][GEOS2-6624][10.12.2024]
        public void AddDeleteFamiliesByProductType_V2590(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> Families)
        {
            try
            {
                if (Families != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in Families)
                        {
                            if (familyList.IdFamily > 0 && familyList.IdSubFamilyConnector == 0)
                            {
                                if (familyList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Delete_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (familyList.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert_V2590", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                    familyList.IdFamily = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                                }
                            }
                            else
                            {
                                if (familyList.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorSubFamiliesByCPType_Insert_V2590", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSubFamily", familyList.IdSubFamilyConnector);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (familyList.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorSubFamiliesByCPType_Delete_V2590", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdSubFamily", familyList.IdSubFamilyConnector);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteFamiliesByProductType_V2590(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[rdixit][GEOS2-6624][10.12.2024]
        public ProductTypes AddProductType_V2590(ProductTypes productType, string MainServerConnectionString, string ProductTypeImagePath, string ProductTypeAttachedDocPath, string PCMConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestProductTypeReference = "";
                    lastestProductTypeReference = GetLatestProuductTypeReference(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PCM_Cptypes_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestProductTypeReference) && lastestProductTypeReference != productType.Reference)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", lastestProductTypeReference);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Reference", productType.Reference);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", productType.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", productType.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", productType.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", productType.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", productType.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", productType.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", productType.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", productType.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", productType.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", productType.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", productType.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", productType.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", productType.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", productType.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_OrderNumber", productType.OrderNumber);
                        mySqlCommand.Parameters.AddWithValue("_NameToShow", productType.NameToShow);
                        mySqlCommand.Parameters.AddWithValue("_ExtraCost", productType.ExtraCost);
                        mySqlCommand.Parameters.AddWithValue("_MinimumTestPoints", productType.MinimumTestPoints);
                        mySqlCommand.Parameters.AddWithValue("_InfoLink", productType.InfoLink);
                        mySqlCommand.Parameters.AddWithValue("_IdDefaultWayType", productType.IdDefaultWayType);
                        mySqlCommand.Parameters.AddWithValue("_Standard", productType.Standard);
                        mySqlCommand.Parameters.AddWithValue("_Code", productType.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", productType.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", productType.CreatedBy);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", productType.IsEnabled);

                        productType.IdCPType = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (productType.IdCPType > 0)
                    {
                        AddProductTypeByTemplate_V2530(MainServerConnectionString, productType.IdTemplate, productType.IdCPType);
                        AddWaysByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.WayList);
                        AddDetectionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.DetectionList);
                        AddOptionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.OptionList);
                        AddSparePartsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.IdTemplate, productType.SparePartList);
                        AddConnectorFamiliesByProductType_V2590(MainServerConnectionString, productType.IdCPType, productType.FamilyList);
                        AddProductTypeAttachedDocByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedDocList, ProductTypeAttachedDocPath);
                        AddProductTypeAttachedLinkByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeAttachedLinkList);
                        AddProductTypeImageByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeImageList, ProductTypeImagePath);
                        AddCustomersRegionsByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, productType.CreatedBy);
                        AddSitesByProductType_V2530(MainServerConnectionString, productType.IdCPType, productType.CustomerListByCPType, PCMConnectionString);
                        AddProductTypeLogEntry_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeLogEntryList);
                        AddProductTypeCommentEntry_V2530(MainServerConnectionString, productType.IdCPType, productType.ProductTypeCommentList);
                        AddCompatibilitiesByProductType_V2530(MainServerConnectionString, (long)productType.IdCPType, productType.ProductTypeCompatibilityList);
                        try
                        {
                            AddUpdateDeletePLMModulePrices_V2530(MainServerConnectionString, productType.ModifiedPLMModuleList, productType.IdCPType, productType.CreatedBy);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddProductType_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return productType;
        }

        //[rdixit][GEOS2-6624][10.12.2024]
        public void AddConnectorFamiliesByProductType_V2590(string MainServerConnectionString, UInt64 IdCPType, List<ConnectorFamilies> FamilyList)
        {
            try
            {
                if (FamilyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (ConnectorFamilies familyList in FamilyList)
                        {                          
                            if (familyList.IdFamily > 0 && familyList.IdSubFamilyConnector == 0)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorFamiliesByCPType_Insert_V2590", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdFamily", familyList.IdFamily);
                                familyList.IdFamily = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                            else
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_ConnectorSubFamiliesByCPType_Insert_V2590", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_IdSubFamily", familyList.IdSubFamilyConnector);
                                mySqlCommand.ExecuteNonQuery();

                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddConnectorFamiliesByProductType_V2590(). IdCPType- {0} ErrorMessage- {1}", IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[rdixit][13.12.2024][GEOS2-6753] 
        public List<Ways> GetWaysByCpType_V2590(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Ways> Ways = new List<Ways>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 1);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ways Way = new Ways();

                            Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Way.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                Way.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                Way.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                Way.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                Way.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                Way.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                Way.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                Way.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                Way.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                Way.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                Way.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                Way.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                Way.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                Way.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                Way.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                            }
                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                Way.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                Way.OrderNumber = Convert.ToUInt32(reader["OrderNumber"]);
                            }
                            Ways.Add(Way);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWaysByCpType_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Ways;
        }

        //[rdixit][13.12.2024][GEOS2-6753]
        public List<Detections> GetDetectionsWithGroupsByCpType_V2590(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                //detectionGroups = GetDetectionGroupsByCPType(PCMConnectionString, 2, IdCPType, IdTemplate);
                detectionGroups = GetDetectionGroupsByCPType_V2530(PCMConnectionString, 2, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                detectionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                detectionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                detectionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                detectionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                detectionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                detectionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detectionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                detectionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                detectionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                detectionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                detectionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                detectionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                detectionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                detectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionsWithGroupsByCpType_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        //[rdixit][13.12.2024][GEOS2-6753]
        public List<Options> GetOptionsWithGroupsByCpType_V2590(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {
                OptionGroups = GetOptionGroupsByCPType_V2530(PCMConnectionString, 3, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                OptionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                OptionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                OptionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                OptionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                OptionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                OptionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                OptionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                OptionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                OptionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                OptionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                OptionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                OptionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                OptionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                OptionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            OptionGroups.Add(OptionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }

        //[rdixit][13.12.2024][GEOS2-6753]
        public List<SpareParts> GetSparePartsWithGroupsByCpType_V2590(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SparePartGroups = new List<SpareParts>();
            try
            {
                SparePartGroups = GetSparePartsGroupsByCPType_V2530(PCMConnectionString, 4, IdCPType, IdTemplate);

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePartGroup = new SpareParts();

                            SparePartGroup.Key = Convert.ToString(reader["IdDetection"]);

                            SparePartGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                SparePartGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePartGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                SparePartGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                SparePartGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                SparePartGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                SparePartGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePartGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePartGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SparePartGroups.Add(SparePartGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SparePartGroups;
        }

        //[rdixit][13.12.2024][GEOS2-6753]
        public List<Detections> GetDetectionsWithoutGroupsByCpType_V2590(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Detections> detectionGroups = new List<Detections>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Detections detectionGroup = new Detections();

                            detectionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            detectionGroup.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detectionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                detectionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                detectionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                detectionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                detectionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                detectionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                detectionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                detectionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detectionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                detectionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                detectionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                detectionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                detectionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                detectionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                detectionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                detectionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                detectionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                detectionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            detectionGroups.Add(detectionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetDetectionsWithGroupsByCpType_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionGroups;
        }

        //[rdixit][13.12.2024][GEOS2-6753]
        public List<Options> GetOptionsWithoutGroupsByCpType_V2590(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<Options> OptionGroups = new List<Options>();
            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 3);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Options OptionGroup = new Options();

                            OptionGroup.Key = Convert.ToString(reader["IdDetection"]);

                            OptionGroup.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                OptionGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                OptionGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                OptionGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                OptionGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                OptionGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                OptionGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                OptionGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                OptionGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                OptionGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                OptionGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                OptionGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                OptionGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                OptionGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                OptionGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                OptionGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                OptionGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                OptionGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                OptionGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            OptionGroups.Add(OptionGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOptionsWithGroupsByCpType_V2350(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return OptionGroups;
        }

        //[rdixit][13.12.2024][GEOS2-6753]
        public List<SpareParts> GetSparePartsWithoutGroupsByCpType_V2590(string PCMConnectionString, UInt64 IdCPType, UInt64 IdTemplate)
        {
            List<SpareParts> SparePartGroups = new List<SpareParts>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsWithGroupsByCPType_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 4);
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            SpareParts SparePartGroup = new SpareParts();

                            SparePartGroup.Key = Convert.ToString(reader["IdDetection"]);

                            SparePartGroup.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                SparePartGroup.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                            {
                                SparePartGroup.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Name_es"] != DBNull.Value)
                            {
                                SparePartGroup.Name_es = Convert.ToString(reader["Name_es"]);
                            }
                            if (reader["Name_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Name_fr = Convert.ToString(reader["Name_fr"]);
                            }
                            if (reader["Name_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Name_pt = Convert.ToString(reader["Name_pt"]);
                            }
                            if (reader["Name_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ro = Convert.ToString(reader["Name_ro"]);
                            }
                            if (reader["Name_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Name_ru = Convert.ToString(reader["Name_ru"]);
                            }
                            if (reader["Name_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Name_zh = Convert.ToString(reader["Name_zh"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                SparePartGroup.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Description_es"] != DBNull.Value)
                            {
                                SparePartGroup.Description_es = Convert.ToString(reader["Description_es"]);
                            }
                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                SparePartGroup.Description_fr = Convert.ToString(reader["Description_fr"]);
                            }
                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                SparePartGroup.Description_pt = Convert.ToString(reader["Description_pt"]);
                            }
                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ro = Convert.ToString(reader["Description_ro"]);
                            }
                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                SparePartGroup.Description_ru = Convert.ToString(reader["Description_ru"]);
                            }
                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                SparePartGroup.Description_zh = Convert.ToString(reader["Description_zh"]);
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                SparePartGroup.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["OrderNumber"] != DBNull.Value)
                            {
                                SparePartGroup.OrderNumber = Convert.ToInt32(reader["OrderNumber"]);
                            }

                            if (reader["IdDetectionType"] != DBNull.Value)
                            {
                                SparePartGroup.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            }
                            SparePartGroups.Add(SparePartGroup);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSparePartsWithoutGroupsByCpType_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return SparePartGroups;
        }

        //[rdixit][31.12.2024][GEOS2-6574][GEOS2-6575]
        public List<ProductTypes> GetAllProductTypes_V2590(string PCMConnectionString, string DetectionImagePath)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }

                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    cpType.Status.HtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                cpType.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["ImageCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ImageCount"]) != 0)
                                {
                                    cpType.ImageCount = Convert.ToString(reader["ImageCount"]) + " " + "Image(s)";
                                    cpType.IsImageExist = true;
                                    cpType.IsImageVisible = Visibility.Visible;
                                }
                            }
                            if (cpType.PCMCustomer == null)
                                cpType.PCMCustomer = new CPLCustomer();

                            if (reader["IsIncluded"] != DBNull.Value)
                                cpType.IncludedCustomer = Convert.ToInt32(reader["IsIncluded"]);
                            else
                                cpType.IncludedCustomer = 1;

                            cpType.PCMCustomer.Plant = new Site();
                            cpType.PCMCustomer.Country = new Country();

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["RegionName"]).Split(',').ToList<string>();
                                bool isValid = tempName.Count == 4 && new HashSet<string>(tempName).SetEquals(new[] { "APAC", "EMEA", "NAFTA", "MERSU" });
                                if (isValid)
                                    cpType.PCMCustomer.RegionName = "ALL";
                                else
                                    cpType.PCMCustomer.RegionName = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.RegionName = "ALL";
                            }
                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["CustomerName"]).Split(',').ToList<string>();
                                cpType.PCMCustomer.GroupName = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.GroupName = "ALL";
                            }
                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["PlantName"]).Split(',').ToList<string>();
                                cpType.PCMCustomer.Plant.Name = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.Plant.Name = "ALL";
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["CountryName"]).Split(',').ToList<string>();
                                cpType.PCMCustomer.Country.Name = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.Country.Name = "ALL";
                            }

                            //cpType.WayList = GetWayListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.WayList = GetWayListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);

                            //cpType.DetectionList = GetDetectionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.DetectionList = GetDetectionListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);


                            //cpType.OptionList = GetOptionListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.OptionList = GetOptionListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);

                            //cpType.SparePartList = GetSparePartListByProductType(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpType.SparePartList = GetSparePartListByProductType_V2530(PCMConnectionString, cpType.IdCPType, cpType.IdTemplate);
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes_V2590(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }

        //[rdixit][31.12.2024][GEOS2-6575]
        public List<DetectionDetails> GetAllModuleDetectionsWaysOptionsSpareParts_V2590(string PCMConnectionString, string DetectionImagePath)
        {
            List<DetectionDetails> detectionList = new List<DetectionDetails>();
            try
            {
                using (MySqlConnection connDetectionDetails = new MySqlConnection(PCMConnectionString))
                {
                    connDetectionDetails.Open();

                    MySqlCommand DetectionDetailCommand = new MySqlCommand("PCM_GetAllModuleDetections_V2590", connDetectionDetails);
                    DetectionDetailCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader DetectionDetailReader = DetectionDetailCommand.ExecuteReader())
                    {
                        while (DetectionDetailReader.Read())
                        {
                            DetectionDetails detectionDetails = new DetectionDetails();
                            try
                            {
                                detectionDetails.IdDetections = Convert.ToUInt32(DetectionDetailReader["IdDetection"]);

                                if (DetectionDetailReader["Name"] != DBNull.Value)
                                {
                                    detectionDetails.Name = Convert.ToString(DetectionDetailReader["Name"]);
                                }
                                if (DetectionDetailReader["ImageCount"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(DetectionDetailReader["Imagecount"]) != 0)
                                    {
                                        detectionDetails.ImageCount = Convert.ToString(DetectionDetailReader["ImageCount"]) + " " + "Image(s)";
                                        detectionDetails.IsImageExist = true;
                                        detectionDetails.IsImageVisible = Visibility.Visible;
                                    }
                                }
                                if (DetectionDetailReader["Description"] != DBNull.Value)
                                {
                                    detectionDetails.Description = Convert.ToString(DetectionDetailReader["Description"]);
                                }
                                if (DetectionDetailReader["WeldOrder"] != DBNull.Value)
                                {
                                    detectionDetails.WeldOrder = Convert.ToUInt32(DetectionDetailReader["WeldOrder"]);
                                }
                                if (DetectionDetailReader["Code"] != DBNull.Value)
                                {
                                    detectionDetails.Code = Convert.ToString(DetectionDetailReader["Code"]);
                                }
                                if (DetectionDetailReader["IdTestType"] != DBNull.Value)
                                {
                                    detectionDetails.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                    detectionDetails.TestTypes = new TestTypes();
                                    detectionDetails.TestTypes.IdTestType = Convert.ToUInt64(DetectionDetailReader["IdTestType"]);
                                    if (DetectionDetailReader["TestName"] != DBNull.Value)
                                    {
                                        detectionDetails.TestTypes.Name = Convert.ToString(DetectionDetailReader["TestName"]);
                                    }
                                }
                                if (DetectionDetailReader["IdDetectionType"] != DBNull.Value)
                                {
                                    detectionDetails.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                    detectionDetails.DetectionTypes = new DetectionTypes();
                                    detectionDetails.DetectionTypes.IdDetectionType = Convert.ToUInt32(DetectionDetailReader["IdDetectionType"]);
                                    if (DetectionDetailReader["DetectionName"] != DBNull.Value)
                                    {
                                        detectionDetails.DetectionTypes.Name = Convert.ToString(DetectionDetailReader["DetectionName"]);
                                    }
                                }
                                if (DetectionDetailReader["IdGroup"] != DBNull.Value)
                                {
                                    detectionDetails.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                    detectionDetails.DetectionGroup = new DetectionGroup();
                                    detectionDetails.DetectionGroup.IdGroup = Convert.ToUInt32(DetectionDetailReader["IdGroup"]);
                                    if (DetectionDetailReader["GroupName"] != DBNull.Value)
                                    {
                                        detectionDetails.DetectionGroup.Name = Convert.ToString(DetectionDetailReader["GroupName"]);
                                    }
                                }
                                if (DetectionDetailReader["LastUpdate"] != DBNull.Value)
                                {
                                    detectionDetails.LastUpdate = Convert.ToDateTime(DetectionDetailReader["LastUpdate"]);
                                }
                                if (DetectionDetailReader["IdStatus"] != DBNull.Value)
                                {
                                    detectionDetails.IdStatus = Convert.ToUInt32(DetectionDetailReader["IdStatus"]);
                                    detectionDetails.Status = new LookupValue();
                                    detectionDetails.Status.IdLookupValue = Convert.ToInt32(DetectionDetailReader["IdStatus"]);
                                    if (DetectionDetailReader["Status"] != DBNull.Value)
                                    {
                                        detectionDetails.Status.Value = Convert.ToString(DetectionDetailReader["Status"]);
                                    }
                                    if (DetectionDetailReader["StatusHtmlColor"] != DBNull.Value)
                                    {
                                        detectionDetails.Status.HtmlColor = Convert.ToString(DetectionDetailReader["StatusHtmlColor"]);
                                    }
                                }

                                if (DetectionDetailReader["PurchaseQtyMin"] != DBNull.Value)
                                    detectionDetails.PurchaseQtyMin = (float)DetectionDetailReader["PurchaseQtyMin"];

                                if (DetectionDetailReader["PurchaseQtyMax"] != DBNull.Value)
                                    detectionDetails.PurchaseQtyMax = (float)DetectionDetailReader["PurchaseQtyMax"];
                                if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value)
                                    detectionDetails.IsShareWithCustomer = Convert.ToByte(DetectionDetailReader["IsShareWithCustomer"]);

                                if (DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                    detectionDetails.IsSparePartOnly = Convert.ToByte(DetectionDetailReader["IsSparePartOnly"]);

                                if (DetectionDetailReader["IsShareWithCustomer"] != DBNull.Value && DetectionDetailReader["IsSparePartOnly"] != DBNull.Value)
                                {
                                    if (detectionDetails.IsShareWithCustomer == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 323;
                                    }
                                    else if (detectionDetails.IsSparePartOnly == 1 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 324;
                                    }
                                    else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax >= 1 && detectionDetails.PurchaseQtyMin >= 1)
                                    {
                                        detectionDetails.IdECOSVisibility = 325;
                                    }
                                    else if (detectionDetails.IsShareWithCustomer == 0 && detectionDetails.PurchaseQtyMax == 0 && detectionDetails.PurchaseQtyMin == 0)
                                    {
                                        detectionDetails.IdECOSVisibility = 326;
                                    }
                                }
                                detectionDetails.PCMCustomerInc.Country = new Country();
                                detectionDetails.PCMCustomerExc.Country = new Country();
                                detectionDetails.PCMCustomerInc.Plant = new Site();
                                detectionDetails.PCMCustomerExc.Plant = new Site();
                                if (DetectionDetailReader["IncRegionName"] != DBNull.Value)
                                {
                                    List<string> tempName = Convert.ToString(DetectionDetailReader["IncRegionName"]).Split(',').ToList<string>();
                                    bool isValid = tempName.Count == 4 && new HashSet<string>(tempName).SetEquals(new[] { "APAC", "EMEA", "NAFTA", "MERSU" });
                                    if (isValid)
                                        detectionDetails.PCMCustomerInc.RegionName = "ALL";
                                    else
                                        detectionDetails.PCMCustomerInc.RegionName = string.Join("\n", tempName.ToArray());
                                }
                                else
                                {
                                    detectionDetails.PCMCustomerInc.RegionName = "ALL";
                                }
                                if (DetectionDetailReader["IncCustomerName"] != DBNull.Value)
                                {
                                    List<string> tempName = Convert.ToString(DetectionDetailReader["IncCustomerName"]).Split(',').ToList<string>();
                                    detectionDetails.PCMCustomerInc.GroupName = string.Join("\n", tempName.ToArray());
                                }
                                else
                                {
                                    detectionDetails.PCMCustomerInc.GroupName = "ALL";
                                }
                                if (DetectionDetailReader["IncPlantName"] != DBNull.Value)
                                {
                                    List<string> tempName = Convert.ToString(DetectionDetailReader["IncPlantName"]).Split(',').ToList<string>();
                                    detectionDetails.PCMCustomerInc.Plant.Name = string.Join("\n", tempName.ToArray());
                                }
                                else
                                {
                                    detectionDetails.PCMCustomerInc.Plant.Name = "ALL";
                                }

                                if (DetectionDetailReader["IncCountryName"] != DBNull.Value)
                                {
                                    List<string> tempName = Convert.ToString(DetectionDetailReader["IncCountryName"]).Split(',').ToList<string>();
                                    detectionDetails.PCMCustomerInc.Country.Name = string.Join("\n", tempName.ToArray());
                                }
                                else
                                {
                                    detectionDetails.PCMCustomerInc.Country.Name = "ALL";
                                }
                                //Added if all fields are null then show empty
                                if (DetectionDetailReader["ExcRegionName"] == DBNull.Value && DetectionDetailReader["ExcCustomerName"] == DBNull.Value &&
                                    DetectionDetailReader["ExcPlantName"] == DBNull.Value && DetectionDetailReader["ExcCountryName"] == DBNull.Value)
                                {
                                    detectionDetails.PCMCustomerExc.RegionName = "";
                                    detectionDetails.PCMCustomerExc.GroupName = "";
                                    detectionDetails.PCMCustomerExc.Plant.Name = "";
                                    detectionDetails.PCMCustomerExc.Country.Name = "";
                                }
                                else
                                {
                                    if (DetectionDetailReader["ExcRegionName"] != DBNull.Value)
                                    {
                                        List<string> tempName = Convert.ToString(DetectionDetailReader["ExcRegionName"]).Split(',').ToList<string>();
                                        bool isValid = tempName.Count == 4 && new HashSet<string>(tempName).SetEquals(new[] { "APAC", "EMEA", "NAFTA", "MERSU" });
                                        if (isValid)
                                            detectionDetails.PCMCustomerExc.RegionName = "ALL";
                                        else
                                            detectionDetails.PCMCustomerExc.RegionName = string.Join("\n", tempName.ToArray());
                                    }
                                    else
                                    {
                                        detectionDetails.PCMCustomerExc.RegionName = "ALL";
                                    }
                                    if (DetectionDetailReader["ExcCustomerName"] != DBNull.Value)
                                    {
                                        List<string> tempName = Convert.ToString(DetectionDetailReader["ExcCustomerName"]).Split(',').ToList<string>();
                                        detectionDetails.PCMCustomerExc.GroupName = string.Join("\n", tempName.ToArray());
                                    }
                                    else
                                    {
                                        detectionDetails.PCMCustomerExc.GroupName = "ALL";
                                    }
                                    if (DetectionDetailReader["ExcPlantName"] != DBNull.Value)
                                    {
                                        List<string> tempName = Convert.ToString(DetectionDetailReader["ExcPlantName"]).Split(',').ToList<string>();
                                        detectionDetails.PCMCustomerExc.Plant.Name = string.Join("\n", tempName.ToArray());
                                    }
                                    else
                                    {
                                        detectionDetails.PCMCustomerExc.Plant.Name = "ALL";
                                    }

                                    if (DetectionDetailReader["ExcCountryName"] != DBNull.Value)
                                    {
                                        List<string> tempName = Convert.ToString(DetectionDetailReader["ExcCountryName"]).Split(',').ToList<string>();
                                        detectionDetails.PCMCustomerExc.Country.Name = string.Join("\n", tempName.ToArray());
                                    }
                                    else
                                    {
                                        detectionDetails.PCMCustomerExc.Country.Name = "ALL";
                                    }
                                }
                                if (detectionDetails.DetectionAllGroupList == null)
                                    detectionDetails.DetectionAllGroupList = new List<DetectionGroup>();
                                detectionDetails.DetectionAllGroupList = GetDetectionAllGroupsList(PCMConnectionString);
                                if (detectionDetails.DetectionAllGroupList != null && detectionDetails.IdDetectionType != 0)
                                {
                                    if (detectionDetails.DetectionGroupList == null)
                                        detectionDetails.DetectionGroupList = new List<DetectionGroup>();
                                    detectionDetails.DetectionGroupList = detectionDetails.DetectionAllGroupList.Where(i => i.IdDetectionType == detectionDetails.IdDetectionType).ToList();
                                }
                                detectionList.Add(detectionDetails);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2590().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllModuleDetectionsWaysOptionsSpareParts_V2590().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return detectionList;
        }

        //[nsatpute][19-05-2025][GEOS2-6691]
        public ProductTypes GetProductTypeByIdCpType_V2640(string PCMConnectionString, UInt64 IdCpType, string ProductTypeAttachedDocPath, string ProductTypeImagePath, UInt64 IdTemplate, string currencyIconFilePath, int IdUser)
        {
            ProductTypes productTypes = new ProductTypes();
            try
            {
                using (MySqlConnection connProductTypes = new MySqlConnection(PCMConnectionString))
                {
                    connProductTypes.Open();

                    string SP = "";
                    if (IdTemplate > 0)
                    {
                        //SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate";
                        SP = "PCM_GetProductTypeByIdCpTypeAndIdTemplate_V2530";
                    }
                    else
                    {
                        //SP = "PCM_GetProductTypeByIdCpType";
                        SP = "PCM_GetProductTypeByIdCpType_V2530";
                    }

                    MySqlCommand ProductTypeCommand = new MySqlCommand(SP, connProductTypes);
                    ProductTypeCommand.CommandType = CommandType.StoredProcedure;
                    if (IdTemplate > 0)
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                        ProductTypeCommand.Parameters.AddWithValue("_IdTemplate", IdTemplate);
                    }
                    else
                    {
                        ProductTypeCommand.Parameters.AddWithValue("_IdCPType", IdCpType);
                    }


                    using (MySqlDataReader ProductTypeReader = ProductTypeCommand.ExecuteReader())
                    {
                        while (ProductTypeReader.Read())
                        {
                            productTypes.IdCPType = Convert.ToUInt64(ProductTypeReader["IdCPType"]);

                            if (ProductTypeReader["Reference"] != DBNull.Value)
                            {
                                productTypes.Reference = Convert.ToString(ProductTypeReader["Reference"]);
                            }
                            if (ProductTypeReader["Name"] != DBNull.Value)
                            {
                                productTypes.Name = Convert.ToString(ProductTypeReader["Name"]);
                            }
                            if (ProductTypeReader["Name_es"] != DBNull.Value)
                            {
                                productTypes.Name_es = Convert.ToString(ProductTypeReader["Name_es"]);
                            }
                            if (ProductTypeReader["Name_fr"] != DBNull.Value)
                            {
                                productTypes.Name_fr = Convert.ToString(ProductTypeReader["Name_fr"]);
                            }
                            if (ProductTypeReader["Name_pt"] != DBNull.Value)
                            {
                                productTypes.Name_pt = Convert.ToString(ProductTypeReader["Name_pt"]);
                            }
                            if (ProductTypeReader["Name_ro"] != DBNull.Value)
                            {
                                productTypes.Name_ro = Convert.ToString(ProductTypeReader["Name_ro"]);
                            }
                            if (ProductTypeReader["Name_ru"] != DBNull.Value)
                            {
                                productTypes.Name_ru = Convert.ToString(ProductTypeReader["Name_ru"]);
                            }
                            if (ProductTypeReader["Name_zh"] != DBNull.Value)
                            {
                                productTypes.Name_zh = Convert.ToString(ProductTypeReader["Name_zh"]);
                            }
                            if (ProductTypeReader["Description"] != DBNull.Value)
                            {
                                productTypes.Description = Convert.ToString(ProductTypeReader["Description"]);
                            }
                            if (ProductTypeReader["Description_es"] != DBNull.Value)
                            {
                                productTypes.Description_es = Convert.ToString(ProductTypeReader["Description_es"]);
                            }
                            if (ProductTypeReader["Description_fr"] != DBNull.Value)
                            {
                                productTypes.Description_fr = Convert.ToString(ProductTypeReader["Description_fr"]);
                            }
                            if (ProductTypeReader["Description_pt"] != DBNull.Value)
                            {
                                productTypes.Description_pt = Convert.ToString(ProductTypeReader["Description_pt"]);
                            }
                            if (ProductTypeReader["Description_ro"] != DBNull.Value)
                            {
                                productTypes.Description_ro = Convert.ToString(ProductTypeReader["Description_ro"]);
                            }
                            if (ProductTypeReader["Description_ru"] != DBNull.Value)
                            {
                                productTypes.Description_ru = Convert.ToString(ProductTypeReader["Description_ru"]);
                            }
                            if (ProductTypeReader["Description_zh"] != DBNull.Value)
                            {
                                productTypes.Description_zh = Convert.ToString(ProductTypeReader["Description_zh"]);
                            }
                            if (ProductTypeReader["IdDefaultWayType"] != DBNull.Value)
                            {
                                productTypes.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                productTypes.DefaultWayType = new DefaultWayType();
                                productTypes.DefaultWayType.IdDefaultWayType = Convert.ToUInt32(ProductTypeReader["IdDefaultWayType"]);
                                if (ProductTypeReader["DefaultWayType"] != DBNull.Value)
                                {
                                    productTypes.DefaultWayType.Name = Convert.ToString(ProductTypeReader["DefaultWayType"]);
                                }
                            }
                            if (ProductTypeReader["Code"] != DBNull.Value)
                            {
                                productTypes.Code = Convert.ToString(ProductTypeReader["Code"]);
                            }
                            if (ProductTypeReader["Standard"] != DBNull.Value)
                            {
                                productTypes.Standard = Convert.ToUInt64(ProductTypeReader["Standard"]);
                            }
                            if (ProductTypeReader["IdTemplate"] != DBNull.Value)
                            {
                                productTypes.IdTemplate = Convert.ToUInt64(ProductTypeReader["IdTemplate"]);
                                productTypes.Template = new Template();
                                productTypes.Template.IdTemplate = Convert.ToByte(ProductTypeReader["IdTemplate"]);
                                if (ProductTypeReader["TemplateName"] != DBNull.Value)
                                {
                                    productTypes.Template.Name = Convert.ToString(ProductTypeReader["TemplateName"]);
                                }
                            }
                            if (ProductTypeReader["IdStatus"] != DBNull.Value)
                            {
                                productTypes.IdStatus = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                productTypes.Status = new LookupValue();
                                productTypes.Status.IdLookupValue = Convert.ToInt32(ProductTypeReader["IdStatus"]);
                                if (ProductTypeReader["Status"] != DBNull.Value)
                                {
                                    productTypes.Status.Value = Convert.ToString(ProductTypeReader["Status"]);
                                }
                            }
                            if (ProductTypeReader["createdIn"] != DBNull.Value)
                            {
                                productTypes.CreatedIn = Convert.ToDateTime(ProductTypeReader["createdIn"]);
                            }
                            if (ProductTypeReader["LastUpdate"] != DBNull.Value)
                            {
                                productTypes.LastUpdate = Convert.ToDateTime(ProductTypeReader["LastUpdate"]);
                            }
                        }
                    }
                }
                try
                {
                    productTypes.TemplateList = new List<Template>();
                    productTypes.WayList = new List<Ways>();
                    productTypes.FamilyList = new List<Common.PCM.ConnectorFamilies>();
                    productTypes.ProductTypeAttachedDocList = new List<ProductTypeAttachedDoc>();
                    productTypes.ProductTypeAttachedLinkList = new List<ProductTypeAttachedLink>();
                    productTypes.ProductTypeImageList = new List<ProductTypeImage>();
                    productTypes.DetectionList_Group = new List<Detections>();
                    productTypes.OptionList_Group = new List<Options>();
                    productTypes.SparePartsList_Group = new List<SpareParts>();
                    productTypes.DetectionListWithoutGroup = new List<Detections>();
                    productTypes.OptionListWithoutGroup = new List<Options>();
                    productTypes.SparePartListWithoutGroup = new List<SpareParts>();
                    productTypes.CustomerList = new List<RegionsByCustomer>();
                    productTypes.ProductTypeCompatibilityList = new List<ProductTypeCompatibility>();
                    productTypes.ProductTypeLogEntryList = new List<ProductTypeLogEntry>();
                    productTypes.ProductTypeCommentList = new List<ProductTypeLogEntry>();
                    productTypes.IncludedPLMModuleList = new List<PLMModulePrice>();
                    var tasks = new List<Task>();
                    tasks.Add(Task.Run(() => productTypes.TemplateList = GetTemplatesByProductType_V2530(PCMConnectionString, productTypes.IdCPType)));
                    tasks.Add(Task.Run(() => productTypes.WayList = GetWaysByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate)));
                    tasks.Add(Task.Run(() => productTypes.FamilyList = GetFamiliesByProductType_V2590(PCMConnectionString, productTypes.IdCPType)));
                    tasks.Add(Task.Run(() => productTypes.ProductTypeAttachedDocList = GetProductTypeAttachedDocsByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType, ProductTypeAttachedDocPath)));
                    tasks.Add(Task.Run(() => productTypes.ProductTypeAttachedLinkList = GetProductTypeAttachedLinksByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType)));
                    tasks.Add(Task.Run(() => productTypes.ProductTypeImageList = GetProductTypeImagesByIdProductType_V2530(PCMConnectionString, productTypes.IdCPType, ProductTypeImagePath)));
                    tasks.Add(Task.Run(() => productTypes.DetectionList_Group = GetDetectionsWithGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate)));
                    tasks.Add(Task.Run(() => productTypes.OptionList_Group = GetOptionsWithGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate)));
                    tasks.Add(Task.Run(() => productTypes.SparePartsList_Group = GetSparePartsWithGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate)));
                    tasks.Add(Task.Run(() => productTypes.DetectionListWithoutGroup = GetDetectionsWithoutGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate)));
                    tasks.Add(Task.Run(() => productTypes.OptionListWithoutGroup = GetOptionsWithoutGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate)));
                    tasks.Add(Task.Run(() => productTypes.SparePartListWithoutGroup = GetSparePartsWithoutGroupsByCpType_V2590(PCMConnectionString, productTypes.IdCPType, productTypes.IdTemplate)));
                    tasks.Add(Task.Run(() => productTypes.CustomerList = GetCustomersWithRegionsByCPType_V2530(PCMConnectionString, productTypes.IdCPType)));
                    tasks.Add(Task.Run(() => productTypes.ProductTypeCompatibilityList = GetCompatibilitiesByProductType_V2530(PCMConnectionString, (long)productTypes.IdCPType)));
                    tasks.Add(Task.Run(() => productTypes.ProductTypeLogEntryList = GetProductTypeLogEntriesByProductType_V2530(PCMConnectionString, productTypes.IdCPType)));
                    tasks.Add(Task.Run(() => productTypes.ProductTypeCommentList = GetProductTypeCommentsEntriesByProductType_V2530(PCMConnectionString, productTypes.IdCPType)));
                    tasks.Add(Task.Run(() => productTypes.IncludedPLMModuleList = GetBaseAndCustomerPricesByIdCPType_V2530(PCMConnectionString, productTypes.IdCPType, currencyIconFilePath, IdUser)));
                    Task.WaitAll(tasks.ToArray());

                    string IdBasePriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                    string IdCustomerPriceListCommaSeparated = string.Join(",", productTypes.IncludedPLMModuleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList));
                    productTypes.NotIncludedPLMModuleList = GetNotIncludedPLMModulePrices_V2530(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, productTypes.IdCPType, IdUser);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2640(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeByIdCpType_V2640(). IdCpType- {0} ErrorMessage- {1}", IdCpType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return productTypes;
        }

        /// <summary>
        /// [pooja.jadhav][GEOS2-6691][19-05-2025] 
        /// </summary>
        /// <param name="PCMConnectionString"></param>
        /// <param name="DetectionImagePath"></param>
        /// <returns></returns>
        public List<ProductTypes> GetAllProductTypes_V2640(string PCMConnectionString, string DetectionImagePath)
        {
            List<ProductTypes> cpTypes = new List<ProductTypes>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllProductTypes_V2590", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProductTypes cpType = new ProductTypes();
                            cpType.IdCPType = Convert.ToUInt64(reader["IdCPType"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                cpType.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                cpType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdTemplate"] != DBNull.Value)
                            {
                                cpType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                cpType.Template = new Template();
                                cpType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                if (reader["TemplateName"] != DBNull.Value)
                                {
                                    cpType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                cpType.IdStatus = Convert.ToInt32(reader["IdStatus"]);
                                cpType.Status = new LookupValue();
                                cpType.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    cpType.Status.Value = Convert.ToString(reader["Status"]);
                                }

                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    cpType.Status.HtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["createdIn"] != DBNull.Value)
                            {
                                cpType.CreatedIn = Convert.ToDateTime(reader["createdIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                cpType.LastUpdate = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                cpType.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                cpType.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["ImageCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ImageCount"]) != 0)
                                {
                                    cpType.ImageCount = Convert.ToString(reader["ImageCount"]) + " " + "Image(s)";
                                    cpType.IsImageExist = true;
                                    cpType.IsImageVisible = Visibility.Visible;
                                }
                            }
                            if (cpType.PCMCustomer == null)
                                cpType.PCMCustomer = new CPLCustomer();

                            if (reader["IsIncluded"] != DBNull.Value)
                                cpType.IncludedCustomer = Convert.ToInt32(reader["IsIncluded"]);
                            else
                                cpType.IncludedCustomer = 1;

                            cpType.PCMCustomer.Plant = new Site();
                            cpType.PCMCustomer.Country = new Country();

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["RegionName"]).Split(',').ToList<string>();
                                bool isValid = tempName.Count == 4 && new HashSet<string>(tempName).SetEquals(new[] { "APAC", "EMEA", "NAFTA", "MERSU" });
                                if (isValid)
                                    cpType.PCMCustomer.RegionName = "ALL";
                                else
                                    cpType.PCMCustomer.RegionName = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.RegionName = "ALL";
                            }
                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["CustomerName"]).Split(',').ToList<string>();
                                cpType.PCMCustomer.GroupName = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.GroupName = "ALL";
                            }
                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["PlantName"]).Split(',').ToList<string>();
                                cpType.PCMCustomer.Plant.Name = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.Plant.Name = "ALL";
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempName = Convert.ToString(reader["CountryName"]).Split(',').ToList<string>();
                                cpType.PCMCustomer.Country.Name = string.Join("\n", tempName.ToArray());
                            }
                            else
                            {
                                cpType.PCMCustomer.Country.Name = "ALL";
                            }

                            FillAllDetectionListForCpType(PCMConnectionString, cpType);
                            cpTypes.Add(cpType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllProductTypes_V2640(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cpTypes;
        }

        /// <summary>
        /// [pooja.jadhav][GEOS2-6691][19-05-2025]
        /// </summary>
        /// <param name="PCMConnectionString"></param>
        /// <param name="cpType"></param>
        public void FillAllDetectionListForCpType(string PCMConnectionString, ProductTypes cpType)
        {
            List<Ways> Ways = new List<Ways>();
            List<Detections> Detections = new List<Detections>();
            List<Options> Options = new List<Options>();
            List<SpareParts> SpareParts = new List<SpareParts>();
            int WayResultCount = 0;
            int DetectionResultCount = 0;
            int OptionsResultCount = 0;
            int SparePartsResultCount = 0;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetDetectionsByCPTypeWithCount_V2640", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCPType", cpType.IdCPType);
                    mySqlCommand.Parameters.AddWithValue("_WaysIdDetectionType", 1); //Detetction type: 1 for ways. 
                    mySqlCommand.Parameters.AddWithValue("_IdDetectionType", 2); //Detetction type: 2 for detections. 
                    mySqlCommand.Parameters.AddWithValue("_OptionIdDetectionType", 3); //Detetction type: 3 for options. 
                    mySqlCommand.Parameters.AddWithValue("_SparePartIdDetectionType", 4); //Detetction type: 4 for spare parts. 
                    mySqlCommand.Parameters.AddWithValue("_IdTemplate", cpType.IdTemplate);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            WayResultCount = Convert.ToInt32(reader["TotalRecords"]);
                        }

                        if (reader.NextResult() && WayResultCount > 0)
                        {
                            while (reader.Read())
                            {
                                Ways Way = new Ways();

                                Way.IdWays = Convert.ToUInt32(reader["IdDetection"]);

                                if (reader["Name"] != DBNull.Value)
                                {
                                    Way.Name = Convert.ToString(reader["Name"]);
                                }

                                Ways.Add(Way);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                DetectionResultCount = Convert.ToInt32(reader["TotalRecords"]);
                            }
                        }



                        if (reader.NextResult() && DetectionResultCount > 0)
                        {

                            while (reader.Read())
                            {
                                Detections Detection = new Detections();

                                Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);

                                if (reader["Name"] != DBNull.Value)
                                {
                                    Detection.Name = Convert.ToString(reader["Name"]);
                                }
                                if (reader["IdGroup"] != DBNull.Value)
                                {
                                    Detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                                }
                                if (reader["GroupName"] != DBNull.Value)
                                {
                                    Detection.GroupName = Convert.ToString(reader["GroupName"]);
                                }
                                if (reader["GroupOrder"] != DBNull.Value)
                                {
                                    Detection.OrderNumber = Convert.ToInt32(reader["GroupOrder"]);
                                }

                                Detections.Add(Detection);
                            }

                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                OptionsResultCount = Convert.ToInt32(reader["TotalRecords"]);
                            }
                        }

                        if (reader.NextResult() && OptionsResultCount > 0)
                        {
                            while (reader.Read())
                            {
                                Options Option = new Options();

                                Option.IdOptions = Convert.ToUInt32(reader["IdDetection"]);

                                if (reader["Name"] != DBNull.Value)
                                {
                                    Option.Name = Convert.ToString(reader["Name"]);
                                }
                                if (reader["IdGroup"] != DBNull.Value)
                                {
                                    Option.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                                }
                                if (reader["GroupName"] != DBNull.Value)
                                {
                                    Option.GroupName = Convert.ToString(reader["GroupName"]);
                                }
                                if (reader["GroupOrder"] != DBNull.Value)
                                {
                                    Option.OrderNumber = Convert.ToInt32(reader["GroupOrder"]);
                                }

                                Options.Add(Option);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                SparePartsResultCount = Convert.ToInt32(reader["TotalRecords"]);
                            }
                        }

                        if (reader.NextResult() && SparePartsResultCount > 0)
                        {
                            while (reader.Read())
                            {
                                SpareParts SparePart = new SpareParts();

                                SparePart.IdSpareParts = Convert.ToUInt32(reader["IdDetection"]);

                                if (reader["Name"] != DBNull.Value)
                                {
                                    SparePart.Name = Convert.ToString(reader["Name"]);
                                }

                                SpareParts.Add(SparePart);
                            }
                        }

                    }

                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error FillAllDetectionListForCpType(). IdCPType- {0} ErrorMessage- {1}", cpType.IdCPType, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }
        //[Rahul.Gadhave][GEOS2-8316][Date:27-06-2025]
        public Articles GetArticleByIdArticle_V2660(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, uint IdPCMArticle, string ImagePath, string currencyIconFilePath, string countryImagePath, int IdUser)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2440", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdPCMArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = IdArticle;

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2250(PCMConnectionString, IdArticle, currencyIconFilePath, IdUser);
                article.ArticleDecompostionList = GetArticleDeCompostionByIdArticle(PCMConnectionString, IdArticle);
                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle, IdUser);
                article.ArticleCustomerList = GetCustomersByIdArticleCustomerReferences(PCMConnectionString, IdArticle, countryImagePath);
                article.ArticleSuppliersList = GetArticleSuppliers(PCMConnectionString, IdArticle);
                //[Rahul.Gadhave][GEOS2-8316][Date:27-06-2025]
                article.LinkedArticleList = GetLinkedArticle(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2660(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        //[Rahul.Gadhave][GEOS2-8316][Date:27-06-2025]
        public List<LinkedArticle> GetLinkedArticle(string PLMConnectionString, UInt64 IdArticle)
        {
            List<LinkedArticle> LinkedArticleList = new List<LinkedArticle>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLinkedArticle_V2660", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            LinkedArticle LinkedArticles = new LinkedArticle();
                            if (reader["IdLinkedArticle"] != DBNull.Value)
                            {
                                LinkedArticles.IdArticle = Convert.ToInt32(reader["IdLinkedArticle"]);
                            }
                            if (reader["Reference"] != DBNull.Value)
                            {
                                LinkedArticles.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["IdLookupValue"] != DBNull.Value)
                            {
                                LinkedArticles.IdLookupValue = Convert.ToInt32(reader["IdLookupValue"]);
                            }
                            if (reader["Status"] != DBNull.Value)
                            {
                                LinkedArticles.Status = Convert.ToString(reader["Status"]);
                            }
                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                LinkedArticles.IdPCMArticleCategory = Convert.ToInt32(reader["IdPCMArticleCategory"]);
                            }
                            if (reader["Category"] != DBNull.Value)
                            {
                                LinkedArticles.Category = Convert.ToString(reader["Category"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                LinkedArticles.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["IdLinkType"] != DBNull.Value)
                            {
                                LinkedArticles.IdLinkType = Convert.ToInt32(reader["IdLinkType"]);
                            }
                            if (reader["LinkedTypeName"] != DBNull.Value)
                            {
                                LinkedArticles.LinkedTypeName = Convert.ToString(reader["LinkedTypeName"]);
                            }
                            if (reader["HtmlColor"] != DBNull.Value)
                            {
                                LinkedArticles.StatusHTMLColor = Convert.ToString(reader["HtmlColor"]);
                            }
                            if (reader["IdPCMArticle"] != DBNull.Value)
                            {
                                LinkedArticles.PCMArticle = new Articles();
                                LinkedArticles.PCMArticle.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            }
                            //if (reader["IdPCMArticleImage"] != DBNull.Value)
                            //{
                            //    LinkedArticles.IdPCMArticleImage = Convert.ToInt32(reader["IdPCMArticleImage"]);
                            //}
                            
                            LinkedArticleList.Add(LinkedArticles);
                        }
                    }
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLinkedArticle(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return LinkedArticleList;
        }
        //[Rahul.Gadhave][GEOS2-8316][Date:27-06-2025]

        public Articles GetArticleByIdArticle_V2660_temp(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath, string currencyIconFilePath, string countryImagePath, int IdUser)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2250(PCMConnectionString, IdArticle, currencyIconFilePath, IdUser);
                article.ArticleDecompostionList = GetArticleDeCompostionByIdArticle(PCMConnectionString, IdArticle);
                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle, IdUser);
                article.ArticleCustomerList = GetCustomersByIdArticleCustomerReferences(PCMConnectionString, IdArticle, countryImagePath);
                article.ArticleSuppliersList = GetArticleSuppliers(PCMConnectionString, IdArticle);
                //[Rahul.Gadhave][GEOS2-8316][Date:27-06-2025]
                article.LinkedArticleList = GetLinkedArticle(PCMConnectionString, IdArticle);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2660(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }

        //[pramod.misal][GEOS2-8321][Date:27-06-2025]
        public Articles GetPLMArticleByIdArticle_V2660(string PCMConnectionString, string ArticleVisualAidsPath, uint IdArticle, string ImagePath, string currencyIconFilePath, int IdUser)
        {
            Articles article = new Articles();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetArticleByIdArticle_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            article.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(reader["Reference"]);

                            article.WarehouseArticle = new Article();

                            if (reader["Description"] != DBNull.Value)
                            {
                                article.Description = Convert.ToString(reader["Description"]).Trim();
                                article.WarehouseArticle.Description = article.Description;
                            }

                            if (reader["Description_es"] != DBNull.Value)
                            {
                                article.Description_es = Convert.ToString(reader["Description_es"]).Trim();
                                article.WarehouseArticle.Description_es = article.Description_es;
                            }

                            if (reader["Description_fr"] != DBNull.Value)
                            {
                                article.Description_fr = Convert.ToString(reader["Description_fr"]).Trim();
                                article.WarehouseArticle.Description_fr = article.Description_fr;
                            }

                            if (reader["Description_ro"] != DBNull.Value)
                            {
                                article.Description_ro = Convert.ToString(reader["Description_ro"]).Trim();
                                article.WarehouseArticle.Description_ro = article.Description_ro;
                            }

                            if (reader["Description_zh"] != DBNull.Value)
                            {
                                article.Description_zh = Convert.ToString(reader["Description_zh"]).Trim();
                                article.WarehouseArticle.Description_zh = article.Description_zh;
                            }

                            if (reader["Description_pt"] != DBNull.Value)
                            {
                                article.Description_pt = Convert.ToString(reader["Description_pt"]).Trim();
                                article.WarehouseArticle.Description_pt = article.Description_pt;
                            }

                            if (reader["Description_ru"] != DBNull.Value)
                            {
                                article.Description_ru = Convert.ToString(reader["Description_ru"]).Trim();
                                article.WarehouseArticle.Description_ru = article.Description_ru;
                            }

                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);
                                article.ArticleImageInBytes = GetArticleImageInBytes(ArticleVisualAidsPath, article);
                            }

                            if (reader["Length"] != DBNull.Value)
                                article.Length = (float)reader["Length"];

                            if (reader["Width"] != DBNull.Value)
                                article.Width = (float)reader["Width"];

                            if (reader["Height"] != DBNull.Value)
                                article.Height = (float)reader["Height"];

                            if (reader["Weight"] != DBNull.Value)
                                article.Weight = Math.Round(Convert.ToDecimal(reader["Weight"]), 3);

                            if (reader["IdPCMArticleCategory"] != DBNull.Value)
                            {
                                article.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                article.PcmArticleCategory = new PCMArticleCategory();
                                article.PcmArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                if (reader["ArticleCategoryName"] != DBNull.Value)
                                {
                                    article.PcmArticleCategory.Name = Convert.ToString(reader["ArticleCategoryName"]);
                                }
                            }

                            if (reader["idArticleSupplier"] != DBNull.Value)
                                article.IdArticleSupplier = Convert.ToUInt32(reader["idArticleSupplier"]);

                            if (reader["SupplierName"] != DBNull.Value)
                                article.SupplierName = Convert.ToString(reader["SupplierName"]);

                            if (reader["IsObsolete"] != DBNull.Value)
                                article.IsObsolete = Convert.ToInt64(reader["IsObsolete"]);

                            if (article.IsObsolete == 0)
                            {
                                article.WarehouseStatus = WarehouseStatus.Active;
                            }
                            else
                            {
                                article.WarehouseStatus = WarehouseStatus.Inactive;
                            }


                            if (reader["IdPCMStatus"] != DBNull.Value)
                                article.IdPCMStatus = Convert.ToInt32(reader["IdPCMStatus"]);

                            if (reader["PCMStatus"] != DBNull.Value)
                                article.PCMStatus = Convert.ToString(reader["PCMStatus"]);

                            if (reader["IsRtfText"] != DBNull.Value)
                                article.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);


                            if (reader["PCMDescription"] != DBNull.Value)
                                article.PCMDescription = Convert.ToString(reader["PCMDescription"]).Trim();

                            if (reader["IsImageShareWithCustomer"] != DBNull.Value)
                                article.IsImageShareWithCustomer = Convert.ToByte(reader["IsImageShareWithCustomer"]);


                            if (reader["PurchaseQtyMin"] != DBNull.Value)
                                article.PurchaseQtyMin = (float)reader["PurchaseQtyMin"];

                            if (reader["PurchaseQtyMax"] != DBNull.Value)
                                article.PurchaseQtyMax = (float)reader["PurchaseQtyMax"];


                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                article.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                            if (reader["IsSparePartOnly"] != DBNull.Value)
                                article.IsSparePartOnly = Convert.ToByte(reader["IsSparePartOnly"]);

                            if (reader["IsShareWithCustomer"] != DBNull.Value && reader["IsSparePartOnly"] != DBNull.Value)
                            {
                                if (article.IsShareWithCustomer == 1)
                                {
                                    article.IdECOSVisibility = 323;
                                }
                                else if (article.IsSparePartOnly == 1)
                                {
                                    article.IdECOSVisibility = 324;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax > 0 && article.PurchaseQtyMin > 0)
                                {
                                    article.IdECOSVisibility = 325;
                                }
                                else if (article.IsShareWithCustomer == 0 && article.PurchaseQtyMax == 0 && article.PurchaseQtyMin == 0)
                                {
                                    article.IdECOSVisibility = 326;
                                }
                            }

                            if (reader["PCMDescription_es"] != DBNull.Value)
                                article.PCMDescription_es = Convert.ToString(reader["PCMDescription_es"]).Trim();

                            if (reader["PCMDescription_fr"] != DBNull.Value)
                                article.PCMDescription_fr = Convert.ToString(reader["PCMDescription_fr"]).Trim();

                            if (reader["PCMDescription_ro"] != DBNull.Value)
                                article.PCMDescription_ro = Convert.ToString(reader["PCMDescription_ro"]).Trim();

                            if (reader["PCMDescription_zh"] != DBNull.Value)
                                article.PCMDescription_zh = Convert.ToString(reader["PCMDescription_zh"]).Trim();

                            if (reader["PCMDescription_pt"] != DBNull.Value)
                                article.PCMDescription_pt = Convert.ToString(reader["PCMDescription_pt"]).Trim();

                            if (reader["PCMDescription_ru"] != DBNull.Value)
                                article.PCMDescription_ru = Convert.ToString(reader["PCMDescription_ru"]).Trim();

                        }
                    }
                }

                article.ArticleCompatibilityList = GetCompatibilitiesByArticle(PCMConnectionString, IdArticle);
                article.PCMArticleLogEntiryList = GetLogEntriesByIdPCMArticle(PCMConnectionString, IdArticle);
                article.PCMArticleImageList = GetPCMArticleImagesByIdPCMArticle_V2090(PCMConnectionString, IdArticle, ImagePath, article.Reference);
                article.PCMArticleAttachmentList = GetArticleAttachmentByIdArticle_V2100(PCMConnectionString, IdArticle);
                article.IncludedPLMArticleList = GetIncudedPLMArticlePrices_V2250(PCMConnectionString, IdArticle, currencyIconFilePath, IdUser);

                string IdBasePriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "BPL").Select(a => a.IdCustomerOrBasePriceList));
                string IdCustomerPriceListCommaSeparated = string.Join(",", article.IncludedPLMArticleList.Where(b => b.Type == "CPL").Select(a => a.IdCustomerOrBasePriceList)); ;
                article.NotIncludedPLMArticleList = GetNotIncudedPLMArticlePrices_V2250(PCMConnectionString, IdBasePriceListCommaSeparated, IdCustomerPriceListCommaSeparated, currencyIconFilePath, IdArticle, IdUser);

                //[pramod.misal][GEOS2-8321][Date:27-06-2025]
                article.LinkedArticleList = GetLinkedArticle(PCMConnectionString, IdArticle);

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleByIdArticle_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return article;
        }
        public bool IsUpdatePCMArticle_V2660(string MainServerConnectionString, uint IdPCMArticleCategory, Articles Article, string PCMArticleImagePath, string PCMArticleDocPath, bool IsDetailsChecked, bool IsPricesChecked)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (Article != null && Article.IdArticle > 0 && IdPCMArticleCategory > 0)
                    {
                        if (IsDetailsChecked == true)
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                            {
                                mySqlConnection.Open();

                                MySqlCommand mySqlCommand = new MySqlCommand("PCM_PCMArticle_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdPCMArticleCategory", IdPCMArticleCategory);
                                mySqlCommand.Parameters.AddWithValue("_idArticle", Article.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdPCMStatus", Article.IdPCMStatus);
                                mySqlCommand.Parameters.AddWithValue("_IdModifier", Article.IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_IsRtfText", Article.IsRtfText);
                                mySqlCommand.Parameters.AddWithValue("_PCMDescription", Article.PCMDescription);
                                mySqlCommand.Parameters.AddWithValue("_IsImageShareWithCustomer", Article.IsImageShareWithCustomer);
                                mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMin", Article.PurchaseQtyMin);
                                mySqlCommand.Parameters.AddWithValue("_PurchaseQtyMax", Article.PurchaseQtyMax);
                                mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", Article.IsShareWithCustomer);
                                mySqlCommand.Parameters.AddWithValue("_IsSparePartOnly", Article.IsSparePartOnly);
                                mySqlCommand.Parameters.AddWithValue("_PCMDescription_es", Article.PCMDescription_es);
                                mySqlCommand.Parameters.AddWithValue("_PCMDescription_fr", Article.PCMDescription_fr);
                                mySqlCommand.Parameters.AddWithValue("_PCMDescription_ro", Article.PCMDescription_ro);
                                mySqlCommand.Parameters.AddWithValue("_PCMDescription_zh", Article.PCMDescription_zh);
                                mySqlCommand.Parameters.AddWithValue("_PCMDescription_pt", Article.PCMDescription_pt);
                                mySqlCommand.Parameters.AddWithValue("_PCMDescription_ru", Article.PCMDescription_ru);

                                mySqlCommand.ExecuteNonQuery();

                                isUpdated = true;
                            }

                            AddUpdateDeleteArticleCompatibilities(MainServerConnectionString, Article.IdArticle, Article.ArticleCompatibilityList);
                            AddPCMArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.PCMArticleLogEntiryList);
                            AddUpdateDeletePCMArticleImages_V2090(MainServerConnectionString, Article.IdArticle, Article.PCMArticleImageList, PCMArticleImagePath, Article.Reference);
                            AddUpdateDeletePCMArticleDocs(MainServerConnectionString, Article.IdArticle, Article.PCMArticleAttachmentList, PCMArticleDocPath, Article.Reference);
                            AddWarehouseArticleLogEntry(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticleLogEntiryList);
                            UpdateWarehouseArticle_V2260(MainServerConnectionString, Article.IdArticle, Article.WarehouseArticle, Article.IdModifier);
                            AddArticlesByCustomer_V2350(MainServerConnectionString, Article.IdCreator, Article.IdArticle, Article.ArticleCustomerList, Article.IdModifier);
                        }
                        if (IsPricesChecked==true)
                        {
                            AddUpdateDeletePLMArticlePrices(MainServerConnectionString, Article.ModifiedPLMArticleList, Article.IdArticle, Article.IdModifier);
                            AddBasePriceListLogEntry(MainServerConnectionString, Article.BasePriceLogEntryList);
                            AddCustomerPriceListLogEntry(MainServerConnectionString, Article.CustomerPriceLogEntryList);
                        }
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdatePCMArticle_V2660(). IdArticle- {0} ErrorMessage- {1}", Article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[pramod.misal][30.07.2025][]
        public List<PCMArticleImage> GetLinkedArticleImage_V2660(string PCMConnectionString, uint IdArticle)
        {
            List<PCMArticleImage> PCMArticleImageList = new List<PCMArticleImage>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetLinkedArticleImages_V2660", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", IdArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            PCMArticleImage PCMImage = new PCMArticleImage();
                            PCMImage.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                            if (reader["IdPCMArticleImage"] != DBNull.Value)
                            {
                                PCMImage.IdPCMArticleImage = Convert.ToUInt32(reader["IdPCMArticleImage"]);
                            }
                            if (reader["SavedFileName"] != DBNull.Value)
                            {
                                PCMImage.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            }                          
                            if (reader["OriginalFileName"] != DBNull.Value)
                            {
                                PCMImage.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            }                        
                            PCMArticleImageList.Add(PCMImage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLinkedArticleImage_V2660(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return PCMArticleImageList;
        }
    }
}




