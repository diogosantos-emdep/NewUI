using Emdep.Geos.Data.BusinessLogic.Logging;
using Emdep.Geos.Data.Common;
using Emdep.Geos.Data.Common.Epc;
using Emdep.Geos.Data.Common.PCM;
using Emdep.Geos.Data.Common.PLM;
using Emdep.Geos.Data.Common.SynchronizationClass;
using Emdep.Geos.Data.DataAccess;
using MySql.Data.MySqlClient;
using Newtonsoft.Json;
using Prism.Logging;
using ServiceStack.Text;
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Threading.Tasks;
using System.Transactions;
using System.Xml.Linq;

namespace Emdep.Geos.Data.BusinessLogic
{

    public class PLMManager
    {
        double FinalArticleCostAvg;
        double FinalArticleCostValue;
        double FinalArticleAdditionalCost;
        Int32 IdCurrency;
        DateTime ExchangeRateDate;
        #region [GEOS2-5404][rdixit][13.08.2024]
        public PLMManager()
        {
            try
            {
                if (Log4NetLogger.Logger == null)
                {
                    string ApplicationLogFilePath = System.Web.Hosting.HostingEnvironment.MapPath("/") + "log4net.config";
                    CreateIfNotExists(ApplicationLogFilePath);
                    FileInfo file = new FileInfo(ApplicationLogFilePath);
                    Log4NetLogger.Logger = LoggerFactory.CreateLogger(LogType.Log4Net, file);
                    Log4NetLogger.Logger.Log(string.Format("PLMManager()..... Constructor Executed"), category: Category.Info, priority: Priority.Low);
                }
            }
            catch
            {
                throw;
            }
        }
        void CreateIfNotExists(string config_path)
        {
            string log4netConfig = @"<?xml version=""1.0"" encoding=""utf-8""?>
                                        <configuration>
                                          <configSections>
                                            <section name=""log4net"" type=""log4net.Config.Log4NetConfigurationSectionHandler, log4net"" />
                                          </configSections>
                                          <log4net debug=""true"">
                                            <appender name=""RollingLogFileAppender"" type=""log4net.Appender.RollingFileAppender"">
                                              <file value=""C:\Temp\LogsService.txt""/>
                                              <appendToFile value=""true"" />
                                              <rollingStyle value=""Size"" />
                                              <maxSizeRollBackups value=""10"" />
                                              <maximumFileSize value=""10MB"" />
                                              <staticLogFileName value=""true"" />
                                              <layout type=""log4net.Layout.PatternLayout"">
                                                <conversionPattern value=""%-5p %d %5rms - %m%n"" />
                                              </layout>
                                            </appender>
                                            <root>
                                              <level value=""Info"" />
                                              <appender-ref ref=""RollingLogFileAppender"" />
                                            </root>
                                          </log4net>
                                        </configuration>";

            if (!File.Exists(config_path))
            {
                File.WriteAllText(config_path, log4netConfig);
            }
        }
        #endregion

        public List<BasePrice> GetBasePrices(string PLMConnectionString)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                List<string> tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePrices(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return basePrices;
        }

        public bool IsDeletedBasePriceList(UInt64 idBasePriceList, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idBasePriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", idBasePriceList);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedBasePriceList(). idBasePriceList- {0} ErrorMessage- {1}", idBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public List<Language> GetLanguages(string PLMConnectionString)
        {
            List<Language> Languages = new List<Language>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetLanguages", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Language Language = new Language();
                            Language.IdLanguage = Convert.ToInt32(reader["IdLanguage"]);

                            if (reader["name"] != DBNull.Value)
                            {
                                Language.Name = Convert.ToString(reader["name"]);
                            }
                            if (reader["TwoLetterIsoLanguage"] != DBNull.Value)
                            {
                                Language.TwoLetterISOLanguage = Convert.ToString(reader["TwoLetterIsoLanguage"]);
                            }
                            Languages.Add(Language);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLanguages(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Languages;
        }

        public List<Site> GetPlants(string PLMConnectionString)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetPlants", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdSite"]);

                            if (reader["ShortName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["ShortName"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPlants(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public List<Currency> GetCurrencies(string PLMConnectionString)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencies", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["Name"]);
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencies(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public string GetLatestBasePriceCode(string PLMConnectionString)
        {
            UInt64 IdBasePriceList;
            string BasePriceCode;
            string Characters = "BPL";
            Int16 Year = 0;
            string Seperator = ".";
            Int16 Number = 0;

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetLatestBasePriceCode", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceCode"] != DBNull.Value)
                                BasePriceCode = Convert.ToString(reader["BasePriceCode"]);

                            if (reader["Characters"] != DBNull.Value)
                                Characters = Convert.ToString(reader["Characters"]);

                            if (reader["Year"] != DBNull.Value)
                                Year = Convert.ToInt16(reader["Year"]);

                            if (reader["Seperator"] != DBNull.Value)
                                Seperator = Convert.ToString(reader["Seperator"]);

                            if (reader["Number"] != DBNull.Value)
                                Number = Convert.ToInt16(reader["Number"]);
                        }
                    }
                }

                Int16 currentYear = Convert.ToInt16(DateTime.Now.ToString("yy"));

                if (Year == currentYear)
                {
                    Number += 1;
                    return string.Format("{0}{1}{2}{3}", Characters, currentYear, Seperator, Number.ToString("000"));
                }
                else if (currentYear > Year)
                {
                    return string.Format("{0}{1}{2}{3}", "BPL", currentYear, Seperator, 1.ToString("000"));
                }
                else
                {
                    return string.Format("{0}{1}{2}{3}", "BPL", currentYear, Seperator, 1.ToString("000"));
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestBasePriceCode(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public BasePrice AddBasePrice(BasePrice basePrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark);
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es);
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr);
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro);
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh);
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt);
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru);
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddbasePrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }

        public bool UpdateBasePrice(BasePrice basePrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name);
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es);
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr);
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt);
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro);
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh);
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru);
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description);
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es);
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr);
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro);
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh);
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt);
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru);
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark);
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es);
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr);
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro);
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh);
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt);
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru);
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddDeletePlantsByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.CurrencyList_Cloned, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.PlantList_Cloned, basePrice.IdModifier);
                        AddDeleteBasePriceListArticlePlantsByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.Article_CurrencyList_Cloned, basePrice.IdModifier, basePrice.BasePriceListItems_Cloned);
                        AddDeleteBasePriceListArticleCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.Article_PlantList_Cloned, basePrice.IdModifier, basePrice.BasePriceListItems_Cloned);
                        UpdateArticlesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems_Save, basePrice.IdModifier);
                        UpdateArticlesPlantsByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.Article_PlantList_Save, basePrice.IdModifier);
                        UpdateArticlesCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.Article_CurrencyList_Save, basePrice.IdModifier);


                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddPlantCurrenciesByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, List<Currency> CurrencyList, UInt32 IdCreator)
        {
            try
            {
                if (PlantList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Site plant in PlantList.Distinct())
                        {
                            foreach (Currency currency in CurrencyList.Distinct())
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", plant.IdSite);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                                mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddPlantCurrenciesByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeletePlantsByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Site site in PlantList)
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlant_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                foreach (Currency currency in CurrencyList.Distinct())
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }

                                foreach (Currency currency in CurrencyList_Cloned.Distinct())
                                {
                                    if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeletePlantsByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeleteCurrenciesByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Currency currency in CurrencyList)
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByCurrency_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                foreach (Site site in PlantList.Distinct())
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }

                                foreach (Site site in PlantList_Cloned.Distinct())
                                {
                                    if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCurrenciesByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public BasePrice GetBasePriceDetailById(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceListItemsCurrenciesById(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<Currency> GetCurrenciesByIdBasePrice(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["Name"]);
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrenciesByIdBasePrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public List<Site> GetPlantsByIdBasePrice(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePricePlantsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdPlant"]);
                            if (reader["ShortName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["ShortName"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPlantsByIdBasePrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public List<PCMArticleCategory> GetPCMArticlesWithCategory(string PLMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PLMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        public List<PCMArticleCategory> GetPCMArticleCategories(string connectionstring)
        {
            List<PCMArticleCategory> pcmArticleCategory = new List<PCMArticleCategory>();
            try
            {
                int i = 0;
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticleCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory PCMArticleCategory = new PCMArticleCategory();
                            PCMArticleCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                PCMArticleCategory.Name = Convert.ToString(reader["Name"]);

                            if (reader["Parent"] != DBNull.Value)
                                PCMArticleCategory.Parent = Convert.ToUInt64(reader["Parent"]);

                            if (reader["IsLeaf"] != DBNull.Value)
                                PCMArticleCategory.IsLeaf = Convert.ToInt64(reader["IsLeaf"]);

                            if (reader["Position"] != DBNull.Value)
                                PCMArticleCategory.Position = Convert.ToUInt32(reader["Position"]);

                            if (reader["KeyName"] != DBNull.Value)
                                PCMArticleCategory.KeyName = Convert.ToString(reader["KeyName"]);
                            else
                            {
                                i++;
                                PCMArticleCategory.KeyName = Convert.ToString(i);
                            }

                            if (reader["Parent_Category"] != DBNull.Value)
                                PCMArticleCategory.ParentName = Convert.ToString(reader["Parent_Category"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count = Convert.ToInt32(reader["Articles_Count"]);

                            if (reader["Articles_Count"] != DBNull.Value)
                                PCMArticleCategory.Article_count_original = Convert.ToInt32(reader["Articles_Count"]);

                            pcmArticleCategory.Add(PCMArticleCategory);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticleCategories_V2060(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return pcmArticleCategory;
        }

        public List<ArticleCostPrice> GetArticleCostPrices(string PLMConnectionString)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetArticleCostPrices", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPrices(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }

        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReference(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryForReference_V2060(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        public List<ArticleCostPrice> GetArticleCostPricesByCurrency(string PLMConnectionString, UInt32 IdCurrency)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetArticleCostPricesByCurrency", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPricesByCurrency(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }


        public List<CurrencyConversion> GetCurrencyConversionsByCurrency(string WorkbenchConnectionString, UInt32 IdCurrency)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsByCurrency", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrencyConversionFrom", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsByCurrency(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }


        public List<BasePriceListByItem> GetBasePriceListItemsById(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();
                            BasePriceListByItem.IdBasePriceListByItems = Convert.ToUInt64(reader["IdBasePriceListByItems"]);

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                BasePriceListByItem.ArticleData = new Articles();
                                BasePriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }


        public List<Site> GetBasePriceListItemsPlantsById(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsPlantsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdPlant"]);

                            if (reader["SiteShortName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["SiteShortName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Site.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Site.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                Site.ArticleCostValue = float.Parse(reader["ArticleCostValue"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsPlantsById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public List<Currency> GetBasePriceListItemsCurrenciesById(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Currency.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Currency.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPrice = float.Parse(reader["SellPrice"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsCurrenciesById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }


        public void AddArticlesByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, UInt32 IdCreator)
        {
            try
            {
                if (ArticleList != null && PlantList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem Article in ArticleList.Distinct())
                        {
                            foreach (Site plant in PlantList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                                {
                                    //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", plant.IdSite);
                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", plant.ArticleCostValue);
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", plant.CurrencyConversionDate);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                    mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPrice);
                                    mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                                    mySqlCommand.Parameters.AddWithValue("_Royalty", Article.Royalty);
                                    mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                                    mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddDeleteBasePriceListArticlePlantsByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (ArticleList != null && PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Currency currency in CurrencyList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPrice);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Currency currency in CurrencyList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPrice);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticlePlantsByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddDeleteBasePriceListArticleCurrenciesByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Site site in PlantList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPrice);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Site site in PlantList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPrice);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticleCurrenciesByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void UpdateArticlesByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, UInt32? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem Article in ArticleList.Distinct())
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesPlantsByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, UInt32? IdModifier)
        {
            try
            {
                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Site site in PlantList.Distinct())
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", site.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesPlantsByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesCurrenciesByBasePrice(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", currency.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPrice);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesPlantsByBasePrice(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<CustomerPrice> GetCustomerPrices(string PLMConnectionString)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]);
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }
                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPrices(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPrices;
        }

        public bool IsDeletedCustomerPriceList(UInt64 idCustomerPriceList, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idCustomerPriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCustomerPriceList(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public CustomerPrice GetCustomerPricesById(string PLMConnectionString, UInt64 idCustomerPriceList)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);

                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_CurrencyList = GetCustomerPriceListItemsCurrenciesById(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_PlantList = GetCustomerPriceListItemsPlantsById(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPrice;
        }

        public string GetLatestCustomerPriceCode(string PLMConnectionString)
        {
            UInt64 IdBasePriceList;
            string CustomerPriceCode;
            string Characters = "CPL";
            Int16 Year = 0;
            string Seperator = ".";
            Int16 Number = 0;

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetLatestCustomerPriceCode", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                IdBasePriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);

                            if (reader["CustomerPriceCode"] != DBNull.Value)
                                CustomerPriceCode = Convert.ToString(reader["CustomerPriceCode"]);

                            if (reader["Characters"] != DBNull.Value)
                                Characters = Convert.ToString(reader["Characters"]);

                            if (reader["Year"] != DBNull.Value)
                                Year = Convert.ToInt16(reader["Year"]);

                            if (reader["Seperator"] != DBNull.Value)
                                Seperator = Convert.ToString(reader["Seperator"]);

                            if (reader["Number"] != DBNull.Value)
                                Number = Convert.ToInt16(reader["Number"]);
                        }
                    }
                }

                Int16 currentYear = Convert.ToInt16(DateTime.Now.ToString("yy"));

                if (Year == currentYear)
                {
                    Number += 1;
                    return string.Format("{0}{1}{2}{3}", Characters, currentYear, Seperator, Number.ToString("000"));
                }
                else if (currentYear > Year)
                {
                    return string.Format("{0}{1}{2}{3}", "CPL", currentYear, Seperator, 1.ToString("000"));
                }
                else
                {
                    return string.Format("{0}{1}{2}{3}", "CPL", currentYear, Seperator, 1.ToString("000"));
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestCustomerPriceCode(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<BasePrice> GetBasePriceNames(string PLMConnectionString)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListNames", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceNames(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return basePrices;
        }
        public CustomerPrice AddCustomerPrice(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddCustomersByCustomerPriceList(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddArticlesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }

        public bool UpdateCustomerPrice(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceListItems(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.IdModifier);
                            AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        }
                        else
                        {

                            AddDeleteCustomersByCustomerPriceList(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                            AddDeleteCustomerPriceListArticlePlantsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.Article_CurrencyList_Cloned, customerPrice.IdModifier, customerPrice.CustomerPriceListItems_Cloned);
                            AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.Article_PlantList_Cloned, customerPrice.IdModifier, customerPrice.CustomerPriceListItems_Cloned);
                            UpdateArticlesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems_Save, customerPrice.IdModifier);
                            UpdateArticlesPlantsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.Article_PlantList_Save, customerPrice.IdModifier);
                            UpdateArticlesCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.Article_CurrencyList_Save, customerPrice.IdModifier);
                            AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddBasePriceListLogEntry(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BasePriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByBasePriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddBasePriceListLogEntry(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public List<BasePriceLogEntry> GetBasePriceLogEntriesByIdBasePriceList(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceLogEntry> basePriceLogEntryList = new List<BasePriceLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetLogEntriesByIdBasePriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceLogEntry basePriceLogEntry = new BasePriceLogEntry();

                            basePriceLogEntry.IdLogEntryByBasePriceList = Convert.ToUInt64(reader["IdLogEntryByBasePriceList"]);

                            basePriceLogEntry.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                basePriceLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                basePriceLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                basePriceLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                basePriceLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            basePriceLogEntryList.Add(basePriceLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceLogEntriesByIdBasePriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return basePriceLogEntryList;
        }

        public BasePrice AddBasePrice_V2090(BasePrice basePrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2090(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.IdCreator);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }

        public bool UpdateBasePrice_V2090(BasePrice basePrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddDeletePlantsByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.CurrencyList_Cloned, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.PlantList_Cloned, basePrice.IdModifier);
                        AddDeleteBasePriceListArticlePlantsByBasePrice_V2090(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.Article_CurrencyList_Cloned, basePrice.IdModifier, basePrice.BasePriceListItems_Cloned);
                        AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2090(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.Article_PlantList_Cloned, basePrice.IdModifier, basePrice.BasePriceListItems_Cloned);
                        UpdateArticlesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems_Save, basePrice.IdModifier);
                        UpdateArticlesPlantsByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.Article_PlantList_Save, basePrice.IdModifier);
                        UpdateArticlesCurrenciesByBasePrice_V2090(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.Article_CurrencyList_Save, basePrice.IdModifier);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }


        public BasePrice GetBasePriceDetailById_V2090(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceListItemsCurrenciesById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2090(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<CPLCustomer> GetCPLCustomers(string PCMConnectionString)
        {
            List<CPLCustomer> CPLCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomersByCPL", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer CPLCustomer = new CPLCustomer();

                            CPLCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            CPLCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);

                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                CPLCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                CPLCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                CPLCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdSite"] != DBNull.Value)
                            {
                                CPLCustomer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                CPLCustomer.Plant = new Site();
                                CPLCustomer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    CPLCustomer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }

                            if (reader["idCountry"] != DBNull.Value)
                            {
                                CPLCustomer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                CPLCustomer.Country = new Country();
                                CPLCustomer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    CPLCustomer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            CPLCustomerList.Add(CPLCustomer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCPLCustomers(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPLCustomerList;
        }

        public void AddCustomersByCustomerPriceList(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CPLCustomer> CustomerList, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customer in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_SitesByCustomerPriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", customer.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersByCustomerPriceList(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeleteCustomersByCustomerPriceList(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CPLCustomer> CustomerList, UInt32 IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer customer in CustomerList)
                        {
                            if (customer.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_SitesByCustomerPriceList_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customer.IdPlant);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (customer.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_SitesByCustomerPriceList_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", customer.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomersByCustomerPriceList(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public List<CPLCustomer> GetCPLCustomersByIdCustomerPriceList(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CPLCustomer> CPLCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomersByIdCustomerPriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer CPLCustomer = new CPLCustomer();

                            CPLCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            CPLCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);

                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                CPLCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                CPLCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                CPLCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdSite"] != DBNull.Value)
                            {
                                CPLCustomer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                CPLCustomer.Plant = new Site();
                                CPLCustomer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    CPLCustomer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }

                            if (reader["idCountry"] != DBNull.Value)
                            {
                                CPLCustomer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                CPLCustomer.Country = new Country();
                                CPLCustomer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    CPLCustomer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CPLCustomer.IsChecked = true;
                            }
                            if (reader["UniqueId"] != DBNull.Value)
                            {
                                CPLCustomer.UniqueId = Convert.ToString(reader["UniqueId"]);
                            }
                            CPLCustomerList.Add(CPLCustomer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCPLCustomersByIdCustomerPriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPLCustomerList;
        }

        public void AddCustomerPriceListLogEntry(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CustomerPriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByCustomerPriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPriceListLogEntry(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public List<CustomerPriceLogEntry> GetCustomerPriceLogEntriesByIdBasePriceList(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceLogEntry> customerPriceLogEntryList = new List<CustomerPriceLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetLogEntriesByIdCustomerPriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceLogEntry customerPriceLogEntry = new CustomerPriceLogEntry();

                            customerPriceLogEntry.IdLogEntryByCustomerPriceList = Convert.ToUInt64(reader["IdLogEntryByCustomerPriceList"]);

                            customerPriceLogEntry.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                customerPriceLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                customerPriceLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                customerPriceLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                customerPriceLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            customerPriceLogEntryList.Add(customerPriceLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceLogEntriesByIdCustomerPriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLogEntryList;
        }

        public void AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2090(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Site site in PlantList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add && a.IdArticle == currency.IdArticle))
                                        {
                                            if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                            {
                                                //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                                mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                                mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                                mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                                mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                                mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                                mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                                mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                                if (currency.SellPriceValue == 0)
                                                {
                                                    currency.SellPriceValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                                mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                                mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                                mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                                mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                                mySqlCommand.ExecuteNonQuery();
                                            }
                                        }
                                    }

                                    foreach (Site site in PlantList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2090(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<PCMArticleCategory> GetPCMArticlesWithCategory_V2090(string PLMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PLMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles_V2090", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReference_V2090(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles_V2090", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryForReference_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        public List<CustomerPrice> GetCustomerPrices_V2090(string PLMConnectionString)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceList_V2090", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]).Trim();

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                List<string> tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                customerPrice.SaleCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }

                            if (reader["CustGroup"] != DBNull.Value)
                            {
                                List<string> tempDifferentGroup = Convert.ToString(reader["CustGroup"]).Split('\n').ToList<string>();
                                tempDifferentGroup = tempDifferentGroup.Distinct().ToList();
                                customerPrice.Group = string.Join("\n", tempDifferentGroup.ToArray());
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                customerPrice.Country = customerPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempDifferentRegionName = Convert.ToString(reader["RegionName"]).Split('\n').ToList<string>();
                                tempDifferentRegionName = tempDifferentRegionName.Distinct().ToList();



                                customerPrice.Region = customerPrice.Region + string.Join("\n", tempDifferentRegionName.ToArray());
                            }

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlantName = Convert.ToString(reader["PlantName"]).Split('\n').ToList<string>();
                                tempDifferentPlantName = tempDifferentPlantName.Distinct().ToList();


                                customerPrice.Plant = customerPrice.Plant + string.Join("\n", tempDifferentPlantName.ToArray());
                            }
                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPrices_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPrices;
        }

        public List<BasePriceListByItem> GetBasePriceListItemsById_V2090(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsById_V2090", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();
                            BasePriceListByItem.IdBasePriceListByItems = Convert.ToUInt64(reader["IdBasePriceListByItems"]);

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                BasePriceListByItem.ArticleData = new Articles();
                                BasePriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsById_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }


        public List<PCMArticleCategory> GetPCMArticlesWithCategoryByIdBasePriceList(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PLMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticlesByIdBasePriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryByIdBasePriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReferenceByIdBasePriceList(string PCMConnectionString, UInt64 IdBasePriceList)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticlesByIdBasePriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryForReferenceByIdBasePriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        public BasePrice GetBasePriceDetailById_ForCPL(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CPLArticleList = GetPCMArticlesWithCategoryForReferenceByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                //BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceForCustomerPriceListById(PLMConnectionString, BasePrice.IdBasePriceList, BasePrice.IdCurrency);
                //BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }


        public List<Currency> GetBasePriceListItemsCurrenciesById_V2090(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Currency.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Currency.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsCurrenciesById_V2090(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public void AddArticlesByBasePrice_V2090(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, UInt32 IdCreator)
        {
            try
            {
                if (ArticleList != null && PlantList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem Article in ArticleList.Distinct())
                        {
                            foreach (Site plant in PlantList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                                {
                                    //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", plant.IdSite);
                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", plant.ArticleCostValue);
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", plant.CurrencyConversionDate);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                    if (currency.SellPriceValue == 0)
                                    {
                                        currency.SellPriceValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                    mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                                    mySqlCommand.Parameters.AddWithValue("_Royalty", Article.Royalty);
                                    mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                                    mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByBasePrice_V2090(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeleteBasePriceListArticlePlantsByBasePrice_V2090(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (ArticleList != null && PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Currency currency in CurrencyList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Currency currency in CurrencyList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticlePlantsByBasePrice_V2090(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesCurrenciesByBasePrice_V2090(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", currency.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                if (currency.SellPriceValue == 0)
                                {
                                    currency.SellPriceValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesCurrenciesByBasePrice_V2090(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddArticlesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, UInt32? IdCreator)
        {
            try
            {
                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            foreach (Site plant in PlantList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                                {
                                    // MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert", mySqlConnection);
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                                    mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                                    if (Article.BasePriceListValue == 0)
                                    {
                                        Article.BasePriceListValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", plant.IdSite);
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", plant.CurrencyConversionDate);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                    if (currency.SellPriceValue == 0)
                                    {
                                        currency.SellPriceValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                    mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                                    mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                                    mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddArticlesByCustomerPrice_V2100(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, UInt32? IdCreator)
        {
            try
            {
                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            foreach (Site plant in PlantList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                                {
                                    //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomersPriceListByItems_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                                    if (Article.ItemCustomerDescription != null)
                                        mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                                    else
                                        mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);

                                    mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                                    if (Article.BasePriceListValue == 0)
                                    {
                                        Article.BasePriceListValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", plant.IdSite);
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", plant.CurrencyConversionDate);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                    if (currency.SellPriceValue == 0)
                                    {
                                        currency.SellPriceValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                    mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                                    mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                                    mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Article.LinkedDescription);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByCustomerPrice_V2100(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<Currency> GetBasePriceForCustomerPriceListById(string PLMConnectionString, UInt64 IdBasePriceList, UInt32 IdCurrency)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceForCustomerPriceListById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Currency.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Currency.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceForCustomerPriceListById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public void AddDeleteCustomerPriceListArticlePlantsByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier, List<CustomerPriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (ArticleList != null && PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem article in ArticleList)
                        {
                            foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Currency currency in CurrencyList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //   MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Currency currency in CurrencyList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (CustomerPriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomerPriceListArticlePlantsByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier, List<CustomerPriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem article in ArticleList)
                        {
                            foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Site site in PlantList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add && a.IdArticle == currency.IdArticle))
                                        {
                                            if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                            {
                                                //  MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert", mySqlConnection);
                                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                                mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                                mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                                mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                                if (article.BasePriceListValue == 0)
                                                {
                                                    article.BasePriceListValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                                mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                                mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                                if (currency.SellPriceValue == 0)
                                                {
                                                    currency.SellPriceValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                                mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                                mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                                mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                                mySqlCommand.ExecuteNonQuery();
                                            }
                                        }
                                    }

                                    foreach (Site site in PlantList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                           // MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (CustomerPriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, UInt32? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);
                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                                if (Article.BasePriceListValue == 0)
                                {
                                    Article.BasePriceListValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesByCustomerPrice_V2100(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, UInt32? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Update_V2100", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                if (Article.ItemCustomerDescription != null)
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                                else
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);

                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                                if (Article.BasePriceListValue == 0)
                                {
                                    Article.BasePriceListValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);

                                mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Article.LinkedDescription);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesPlantsByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Site> PlantList, UInt32? IdModifier)
        {
            try
            {
                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Site site in PlantList.Distinct())
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", site.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesPlantsByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesCurrenciesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", currency.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                if (currency.SellPriceValue == 0)
                                {
                                    currency.SellPriceValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesCurrenciesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<CustomerPriceListByItem> GetCustomerPriceListItemsById(string WorkbenchConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            CustomerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(reader["IdCustomerPriceListByItems"]);

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                CustomerPriceListByItem.ArticleData = new Articles();
                                CustomerPriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["ItemCustomerDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.ItemCustomerDescription = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                                CustomerPriceListByItem.ItemCustomerDescription_Old = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                            }
                            if (reader["VisibleToCustomer"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.VisibleToCustomer = Convert.ToByte(reader["VisibleToCustomer"]);
                            }
                            if (reader["BasePriceListValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.BasePriceListValue = float.Parse(reader["BasePriceListValue"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }

        public List<CustomerPriceListByItem> GetCustomerPriceListItemsById_V2100(string WorkbenchConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsById_V2100", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            CustomerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(reader["IdCustomerPriceListByItems"]);

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                CustomerPriceListByItem.ArticleData = new Articles();
                                CustomerPriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["ItemCustomerDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.ItemCustomerDescription = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                                CustomerPriceListByItem.ItemCustomerDescription_Old = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                            }
                            if (reader["VisibleToCustomer"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.VisibleToCustomer = Convert.ToByte(reader["VisibleToCustomer"]);
                            }
                            if (reader["BasePriceListValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.BasePriceListValue = float.Parse(reader["BasePriceListValue"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["LinkedDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.LinkedDescription = Convert.ToByte(reader["LinkedDescription"]);
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsById_V2100(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }

        public List<Currency> GetCustomerPriceListItemsCurrenciesById(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["BasePriceListCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                Currency.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Currency.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsCurrenciesById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public void UpdateBasePriceListByPlantCurrency(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByPlantCurrency> PlantCurrencyList, uint? IdModifier)
        {
            try
            {
                if (PlantCurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BasePriceListByPlantCurrency PlantCurrency in PlantCurrencyList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", PlantCurrency.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", PlantCurrency.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", PlantCurrency.PlantbyCurrency);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePriceListByPlantCurrency(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<BasePriceListByPlantCurrency> GetPlantCurrencyByIdBasePrice(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByPlantCurrency> BasePriceListByPlantCurrencyList = new List<BasePriceListByPlantCurrency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetPlantCurrencyByIdBasePrice", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByPlantCurrency basePriceListByPlantCurrency = new BasePriceListByPlantCurrency();

                            basePriceListByPlantCurrency.IdBasePriceListByPlantCurrency = Convert.ToUInt64(reader["IdBasePriceListByPlantCurrency"]);

                            basePriceListByPlantCurrency.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["IdPlant"] != DBNull.Value)
                            {
                                basePriceListByPlantCurrency.IdPlant = Convert.ToInt64(reader["IdPlant"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePriceListByPlantCurrency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                            }
                            if (reader["PlantbyCurrency"] != DBNull.Value)
                            {
                                basePriceListByPlantCurrency.PlantbyCurrency = Convert.ToByte(reader["PlantbyCurrency"]);
                            }
                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                basePriceListByPlantCurrency.CurrencyName = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["PlantName"] != DBNull.Value)
                            {
                                basePriceListByPlantCurrency.PlantName = Convert.ToString(reader["PlantName"]);
                            }
                            BasePriceListByPlantCurrencyList.Add(basePriceListByPlantCurrency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPlantCurrencyByIdBasePrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByPlantCurrencyList;
        }

        public List<Site> GetCustomerPriceListItemsPlantsById(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsPlantsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdPlant"]);

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["PlantName"]);
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                Site.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Site.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsCurrenciesById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public bool IsDeletedCustomerPriceListItems(UInt64 idCustomerPriceList, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idCustomerPriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCustomerPriceListItems(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public bool IsBasePriceUsedInCustomerPrice(string PLMConnectionString, UInt64 idBasePriceList)
        {
            bool IsExist = false;
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand objMySqlCommand = new MySqlCommand("PLM_IsBasePriceUsedInCustomerPrice", connBasePrice);
                    objMySqlCommand.CommandType = CommandType.StoredProcedure;
                    objMySqlCommand.Parameters.AddWithValue("_IdBasePriceList", idBasePriceList);


                    using (MySqlDataReader objMySqlDataReader = objMySqlCommand.ExecuteReader())
                    {
                        while (objMySqlDataReader.Read())
                        {
                            if (objMySqlDataReader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                IsExist = true;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsBasePriceUsedInCustomerPrice(). idBasePriceList- {0} ErrorMessage- {1}", idBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return IsExist;
        }



        #region V2100

        public void AddCustomersByCPL(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CPLCustomer> CustomerList, uint IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer Customer in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            Customer.IdCustomerPriceListCustomer = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersByCPL(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddUpdateDeleteCustomersByCPL(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CPLCustomer> CustomerList, uint? IdModifier)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLCustomer Customer in CustomerList)
                        {
                            if (Customer.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCustomer", Customer.IdCustomerPriceListCustomer);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (Customer.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (Customer.IdCustomerPriceListCustomer > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCustomer", Customer.IdCustomerPriceListCustomer);
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (Customer.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                Customer.IdCustomerPriceListCustomer = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCustomersByCPL(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public CustomerPrice AddCustomerPrice_V2100(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddArticlesByCustomerPrice_V2100(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        AddCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice_V2100(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }

        public bool UpdateCustomerPrice_V2100(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceListItems(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice_V2100(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.IdModifier);
                            AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        }
                        else
                        {
                            AddDeleteCustomerPriceListArticlePlantsByCustomerPrice_V2100(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.Article_CurrencyList_Cloned, customerPrice.IdModifier, customerPrice.CustomerPriceListItems_Cloned);
                            AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice_V2100(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.Article_PlantList_Cloned, customerPrice.IdModifier, customerPrice.CustomerPriceListItems_Cloned);
                            UpdateArticlesByCustomerPrice_V2100(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems_Save, customerPrice.IdModifier);
                            UpdateArticlesPlantsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.Article_PlantList_Save, customerPrice.IdModifier);
                            UpdateArticlesCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.Article_CurrencyList_Save, customerPrice.IdModifier);
                            AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                            AddUpdateDeleteCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice_V2100(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public List<CPLCustomer> GetCPLCustomersByIdCustomerPriceList_V2100(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CPLCustomer> CPLCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomersByIdCustomerPriceList_V2100", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer CPLCustomer = new CPLCustomer();
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                CPLCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            }
                            CPLCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);

                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                CPLCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                CPLCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                            }
                            else
                            {
                                CPLCustomer.RegionName = "ALL";
                            }

                            if (reader["Parent"] != DBNull.Value)
                            {
                                CPLCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }

                            if (reader["IdSite"] != DBNull.Value)
                            {
                                CPLCustomer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                CPLCustomer.Plant = new Site();
                                CPLCustomer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    CPLCustomer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                CPLCustomer.Plant = new Site();
                                CPLCustomer.Plant.Name = "ALL";
                            }

                            if (reader["idCountry"] != DBNull.Value)
                            {
                                CPLCustomer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                CPLCustomer.Country = new Country();
                                CPLCustomer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    CPLCustomer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                CPLCustomer.Country = new Country();
                                CPLCustomer.Country.Name = "ALL";
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CPLCustomer.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }

                            if (reader["IdCustomerPriceListCustomer"] != DBNull.Value)
                            {
                                CPLCustomer.IdCustomerPriceListCustomer = Convert.ToUInt64(reader["IdCustomerPriceListCustomer"]);
                            }
                            CPLCustomerList.Add(CPLCustomer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCPLCustomersByIdCustomerPriceList_V2100(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPLCustomerList;
        }

        public CustomerPrice GetCustomerPricesById_V2100(string PLMConnectionString, UInt64 idCustomerPriceList)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2100(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);

                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2100(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_CurrencyList = GetCustomerPriceListItemsCurrenciesById(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_PlantList = GetCustomerPriceListItemsPlantsById(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2100(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPrice;
        }

        public List<Group> GetGroups(string PLMConnectionString)
        {
            List<Group> Groups = new List<Group>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetGroups", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Group Group = new Group();
                            Group.IdGroup = Convert.ToInt32(reader["IdCustomer"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Group.GroupName = Convert.ToString(reader["Name"]);
                            }
                            Groups.Add(Group);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Groups;
        }

        public List<Region> GetRegionsByGroupAndCountryAndSites(string PLMConnectionString, int IdGroup, string CountryNames, string SiteNames)
        {
            List<Region> Regions = new List<Region>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetRegionsByGroupAndCountryAndSites", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdGroup);
                    mySqlCommand.Parameters.AddWithValue("_CountryName", CountryNames);
                    mySqlCommand.Parameters.AddWithValue("_SiteName", SiteNames);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Region Region = new Region();
                            Region.IdRegion = Convert.ToInt32(reader["IdLookupValue"]);

                            if (reader["Value"] != DBNull.Value)
                            {
                                Region.RegionName = Convert.ToString(reader["Value"]);
                            }
                            Regions.Add(Region);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetRegionsByGroupAndCountryAndSites(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Regions;
        }

        public List<Country> GetCountriesByGroupAndRegionAndSites(string PLMConnectionString, int IdGroup, string RegionNames, string SiteNames)
        {
            List<Country> Countrys = new List<Country>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCountriesByGroupAndRegionAndSites", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdGroup);
                    mySqlCommand.Parameters.AddWithValue("_RegionName", RegionNames);
                    mySqlCommand.Parameters.AddWithValue("_SiteName", SiteNames);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Country Country = new Country();
                            Country.IdCountry = Convert.ToByte(reader["idCountry"]);

                            if (reader["name"] != DBNull.Value)
                            {
                                Country.Name = Convert.ToString(reader["name"]);
                            }

                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                Country.IdRegion = Convert.ToInt32(reader["IdRegion"]);
                            }

                            Countrys.Add(Country);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountriesByGroupAndRegionAndSites(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Countrys;
        }

        public List<Site> GetPlantsByGroupAndRegionAndCountry(string PLMConnectionString, int IdGroup, string RegionNames, string CountryNames)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetPlantsByGroupAndRegionAndCountry", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdGroup);
                    mySqlCommand.Parameters.AddWithValue("_RegionName", RegionNames);
                    mySqlCommand.Parameters.AddWithValue("_CountryName", CountryNames);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdSite"]);

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["PlantName"]);
                            }
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                Site.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                Site.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                            }
                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                Site.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                Site.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["idCountry"] != DBNull.Value)
                            {
                                Site.IdCountry = Convert.ToByte(reader["idCountry"]);
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                Site.CountryName = Convert.ToString(reader["CountryName"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPlantsByGroupAndRegionAndCountry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public void AddDeleteCustomerPriceListArticlePlantsByCustomerPrice_V2100(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier, List<CustomerPriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (ArticleList != null && PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem article in ArticleList)
                        {
                            foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Currency currency in CurrencyList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);

                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomersPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            if (article.ItemCustomerDescription != null)
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            else
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Currency currency in CurrencyList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);

                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomersPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            if (article.ItemCustomerDescription != null)
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            else
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (CustomerPriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomerPriceListArticlePlantsByCustomerPrice_V2100(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice_V2100(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier, List<CustomerPriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem article in ArticleList)
                        {
                            foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Site site in PlantList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add && a.IdArticle == currency.IdArticle))
                                        {
                                            if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                            {
                                                //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);

                                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomersPriceListByItems_Insert_V2530", mySqlConnection);
                                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                                mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                                mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                                mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                                if (article.ItemCustomerDescription != null)
                                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                                else
                                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                                if (article.BasePriceListValue == 0)
                                                {
                                                    article.BasePriceListValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                                mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                                mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                                if (currency.SellPriceValue == 0)
                                                {
                                                    currency.SellPriceValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                                mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                                mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                                mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                                mySqlCommand.ExecuteNonQuery();
                                            }
                                        }
                                    }

                                    foreach (Site site in PlantList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);

                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomersPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            if (article.ItemCustomerDescription != null)
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            else
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (CustomerPriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice_V2100(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public List<CurrencyConversion> GetCurrencyConversionsByCurrency_V2100(string WorkbenchConnectionString, UInt32 IdCurrency, DateTime CurrencyConversionDate)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsByCurrency_V2100", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrencyConversionFrom", IdCurrency);
                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", CurrencyConversionDate);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsByCurrency_V2100(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }

        #endregion


        #region V2110
        public BasePrice AddBasePrice_V2110(BasePrice basePrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            basePrice.Code = lastestBasePriceCode;
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2110(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.IdCreator);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }
        public void AddArticlesByBasePrice_V2110(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, UInt32 IdCreator)
        {
            try
            {
                if (ArticleList != null && PlantList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem Article in ArticleList.Distinct())
                        {
                            foreach (Site plant in PlantList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                                {
                                    // MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", plant.IdSite);
                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", plant.ArticleCostValue);
                                    mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", plant.CurrencyConversionDate_New);
                                    if (currency.CurrencyConversionRate_New == 0)
                                    {
                                        currency.CurrencyConversionRate_New = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                    if (currency.SellPriceValue == 0)
                                    {
                                        currency.SellPriceValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                    mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                                    mySqlCommand.Parameters.AddWithValue("_Royalty", Article.Royalty);
                                    mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                                    mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByBasePrice_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public bool UpdateBasePrice_V2110(BasePrice basePrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddDeletePlantsByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.CurrencyList_Cloned, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.PlantList_Cloned, basePrice.IdModifier);
                        AddDeleteBasePriceListArticlePlantsByBasePrice_V2110(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.Article_CurrencyList_Cloned, basePrice.IdModifier, basePrice.BasePriceListItems_Cloned);
                        AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2110(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.Article_PlantList, basePrice.Article_CurrencyList, basePrice.Article_PlantList_Cloned, basePrice.IdModifier, basePrice.BasePriceListItems_Cloned);
                        UpdateArticlesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems_Save, basePrice.IdModifier);
                        UpdateArticlesPlantsByBasePrice_V2110(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.Article_PlantList_Save, basePrice.IdModifier);
                        UpdateArticlesCurrenciesByBasePrice_V2110(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.Article_CurrencyList_Save, basePrice.IdModifier);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }



        public void AddCustomerPriceListLogEntryByDeleteBPLArticle(string MainServerConnectionString, List<CustomerPriceLogEntry> CPLLogList)
        {
            try
            {
                if (CPLLogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CustomerPriceLogEntry logList in CPLLogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByCustomerPriceList_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", logList.IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPriceListLogEntry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void AddDeleteBasePriceListArticlePlantsByBasePrice_V2110(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (ArticleList != null && PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Currency currency in CurrencyList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //  MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Currency currency in CurrencyList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticlePlantsByBasePrice_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2110(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Site site in PlantList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add && a.IdArticle == currency.IdArticle))
                                        {
                                            if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                            {
                                                // MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                                mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                                mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                                mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                                mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                                mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                                if (currency.CurrencyConversionRate_New == 0)
                                                {
                                                    currency.CurrencyConversionRate_New = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                                mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                                mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                                if (currency.SellPriceValue == 0)
                                                {
                                                    currency.SellPriceValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                                mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                                mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                                mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                                mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                                mySqlCommand.ExecuteNonQuery();
                                            }
                                        }
                                    }

                                    foreach (Site site in PlantList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            // MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void UpdateArticlesPlantsByBasePrice_V2110(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, UInt32? IdModifier)
        {
            try
            {
                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Site site in PlantList.Distinct())
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", site.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesPlantsByBasePrice_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void UpdateArticlesCurrenciesByBasePrice_V2110(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", currency.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                if (currency.CurrencyConversionRate_New == 0)
                                {
                                    currency.CurrencyConversionRate_New = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                if (currency.SellPriceValue == 0)
                                {
                                    currency.SellPriceValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesCurrenciesByBasePrice_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public BasePrice GetBasePriceDetailById_V2110(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceListItemsCurrenciesById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<Site> GetBasePriceListItemsPlantsById_V2110(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsPlantsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdPlant"]);

                            if (reader["SiteShortName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["SiteShortName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Site.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Site.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                Site.ArticleCostValue = float.Parse(reader["ArticleCostValue"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsPlantsById_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public List<Currency> GetBasePriceListItemsCurrenciesById_V2110(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Currency.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Currency.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate_New = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsCurrenciesById_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }


        public CustomerPrice AddCustomerPrice_V2110(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddArticlesByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        AddCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }

        public void AddArticlesByCustomerPrice_V2110(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, UInt32? IdCreator)
        {
            try
            {
                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            foreach (Site plant in PlantList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == Article.IdArticle).Distinct())
                                {
                                    // MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                                    mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                                    if (Article.ItemCustomerDescription != null)
                                        mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                                    else
                                        mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);

                                    mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                                    if (Article.BasePriceListValue == 0)
                                    {
                                        Article.BasePriceListValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", plant.IdSite);
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", plant.CurrencyConversionDate_New);
                                    if (currency.CurrencyConversionRate_New == 0)
                                    {
                                        currency.CurrencyConversionRate_New = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                    mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                    mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                    if (currency.SellPriceValue == 0)
                                    {
                                        currency.SellPriceValue = null;
                                    }
                                    mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                    mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                                    mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                                    mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Article.LinkedDescription);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByCustomerPrice_V2110(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public bool UpdateCustomerPrice_V2110(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceListItems(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.IdModifier);
                        }
                        else
                        {
                            AddDeleteCustomerPriceListArticlePlantsByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.Article_CurrencyList_Cloned, customerPrice.IdModifier, customerPrice.CustomerPriceListItems_Cloned);
                            AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.Article_PlantList, customerPrice.Article_CurrencyList, customerPrice.Article_PlantList_Cloned, customerPrice.IdModifier, customerPrice.CustomerPriceListItems_Cloned);
                            UpdateArticlesByCustomerPrice_V2100(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems_Save, customerPrice.IdModifier);
                            UpdateArticlesPlantsByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.Article_PlantList_Save, customerPrice.IdModifier);
                            UpdateArticlesCurrenciesByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.Article_CurrencyList_Save, customerPrice.IdModifier);
                        }
                        AddUpdateDeleteCustomersByCPL_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddDeleteCustomerPriceListArticlePlantsByCustomerPrice_V2110(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier, List<CustomerPriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (ArticleList != null && PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem article in ArticleList)
                        {
                            foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                               //   MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Currency currency in CurrencyList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            if (article.ItemCustomerDescription != null)
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            else
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Currency currency in CurrencyList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            // MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            if (article.ItemCustomerDescription != null)
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            else
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (CustomerPriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Site site in PlantList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomerPriceListArticlePlantsByCustomerPrice_V2110(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice_V2110(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier, List<CustomerPriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem article in ArticleList)
                        {
                            foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    foreach (Site site in PlantList.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add && a.IdArticle == currency.IdArticle))
                                        {
                                            if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                            {
                                                //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                                mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                                mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                                mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                                if (article.ItemCustomerDescription != null)
                                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                                else
                                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                                if (article.BasePriceListValue == 0)
                                                {
                                                    article.BasePriceListValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                                if (currency.CurrencyConversionRate_New == 0)
                                                {
                                                    currency.CurrencyConversionRate_New = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                                mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                                mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                                if (currency.SellPriceValue == 0)
                                                {
                                                    currency.SellPriceValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                                mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                                mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                                mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                                mySqlCommand.ExecuteNonQuery();
                                            }
                                        }
                                    }

                                    foreach (Site site in PlantList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            if (article.ItemCustomerDescription != null)
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription.Trim());
                                            else
                                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", article.ItemCustomerDescription);

                                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", article.VisibleToCustomer);
                                            if (article.BasePriceListValue == 0)
                                            {
                                                article.BasePriceListValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", article.BasePriceListValue);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", article.LinkedDescription);

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (CustomerPriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                foreach (Currency currency in CurrencyList.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCustomerPriceListArticleCurrenciesByCustomerPrice_V2110(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesPlantsByCustomerPrice_V2110(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Site> PlantList, UInt32? IdModifier)
        {
            try
            {
                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Site site in PlantList.Distinct())
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsPlants_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", site.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesPlantsByCustomerPrice_V2110(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesCurrenciesByCustomerPrice_V2110(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", currency.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                if (currency.CurrencyConversionRate_New == 0)
                                {
                                    currency.CurrencyConversionRate_New = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                if (currency.SellPriceValue == 0)
                                {
                                    currency.SellPriceValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesCurrenciesByCustomerPrice_V2110(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public CustomerPrice GetCustomerPricesById_V2110(string PLMConnectionString, UInt64 idCustomerPriceList)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2100(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_CurrencyList = GetCustomerPriceListItemsCurrenciesById_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_PlantList = GetCustomerPriceListItemsPlantsById_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2110(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }
        public List<Currency> GetCustomerPriceListItemsCurrenciesById_V2110(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["BasePriceListCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                Currency.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Currency.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate_New = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsCurrenciesById_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public List<Site> GetCustomerPriceListItemsPlantsById_V2110(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsPlantsById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdPlant"]);

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["PlantName"]);
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                Site.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Site.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsPlantsById_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }


        public BasePrice GetBasePriceDetailById_ForCPL_V2110(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CPLArticleList = GetPCMArticlesWithCategoryForReferenceByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                //BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceForCustomerPriceListById(PLMConnectionString, BasePrice.IdBasePriceList, BasePrice.IdCurrency);
                BasePrice.Article_CurrencyList_ForCPL = GetBasePriceListItemsCurrenciesById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                //BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }


        public List<CustomerPrice> GetCustomerPriceIFExistItem(string PLMConnectionString, UInt64 IdBasePriceList, UInt64 IdArticle)
        {
            List<CustomerPrice> customerPriceLst = new List<CustomerPrice>();
            try
            {
                using (MySqlConnection connCustomerPrice = new MySqlConnection(PLMConnectionString))
                {
                    connCustomerPrice.Open();

                    MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_GetCustomerPriceIFExistItem", connCustomerPrice);
                    CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                    CustomerPriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    CustomerPriceCommand.Parameters.AddWithValue("_IdArticle", IdArticle);


                    using (MySqlDataReader CustomerPriceReader = CustomerPriceCommand.ExecuteReader())
                    {
                        while (CustomerPriceReader.Read())
                        {
                            CustomerPrice customerPrice = new CustomerPrice();


                            if (CustomerPriceReader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(CustomerPriceReader["Code"]);
                            }
                            if (CustomerPriceReader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(CustomerPriceReader["Name"]);
                            }
                            if (CustomerPriceReader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceList"]);
                            }
                            if (CustomerPriceReader["IdCustomerPriceListByItems"] != DBNull.Value)
                            {
                                customerPrice.CustomerPriceListItems = new List<CustomerPriceListByItem>();
                                CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                customerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceListByItems"]);
                                customerPriceListByItem.IdArticle = IdArticle;
                                customerPrice.CustomerPriceListItems.Add(customerPriceListByItem);
                            }
                            customerPriceLst.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceIFExistItem(). IdBasePriceList- {0} IdArticle- {1}  ErrorMessage- {2}", IdBasePriceList, IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLst;
        }


        public bool DeleteCustomerPriceListItem(string MainServerConnectionString, List<CustomerPriceListByItem> customerPriceListByItem)
        {
            bool isDeleted = false;

            if (customerPriceListByItem != null)
                foreach (CustomerPriceListByItem item in customerPriceListByItem)
                {
                    try
                    {
                        using (MySqlConnection connCustomerPrice = new MySqlConnection(MainServerConnectionString))
                        {
                            connCustomerPrice.Open();

                            MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_DeleteCustomerPriceListItem", connCustomerPrice);
                            CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                            CustomerPriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", item.IdCustomerPriceList);
                            CustomerPriceCommand.Parameters.AddWithValue("_IdArticle", item.IdArticle);
                            CustomerPriceCommand.ExecuteNonQuery();
                            isDeleted = true;
                        }
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error DeleteCustomerPriceListItem(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        throw;
                    }
                }


            return isDeleted;
        }

        public IList<Company> GetEmdepSitesCompanies(string connectionstring)
        {
            IList<Company> companies = new List<Company>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("emdepsites_GetEmdepSitesDetail", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        string connstr = "Data Source = " + sitereader["DatabaseIP"].ToString() + "; Database = geos; User ID = GeosUsr; Password = GEOS;Convert Zero Datetime=True";
                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {
                            Company company = new Company();

                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            company.Name = sitereader["Name"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }

        public string GetEWHQDatabaseDetail_old(string connectionstring)
        {
            string connstr = null;

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("GetEWHQDatabaseDetail", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    if (sitereader.Read())
                    {
                        connstr = "Data Source = " + sitereader["DatabaseIP"].ToString() + "; Database = geos; User ID = GeosUsr; Password = GEOS;Convert Zero Datetime=True";
                    }
                }
            }
            return connstr;
        }
        public string GetEWHQDatabaseDetail(string connectionstring)
        {
            string connstr = null;
            // Parse the connection string
            MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionstring);
            // Extract components
            string ConnecteddataSource = builder.Server;
            string database = builder.Database;
            string userId = builder.UserID;
            string password = builder.Password;
            string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionstring);
            string dataSource = "";
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("GetEWHQDatabaseDetailWithPlantShortName_V2490", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    if (sitereader.Read())
                    {
                        if (string.IsNullOrEmpty(connectedPlantName))
                        {
                            dataSource = ConnecteddataSource.Replace(ConnecteddataSource, sitereader["DatabaseIP"].ToString());
                        }
                        else
                        {
                            dataSource = ConnecteddataSource.Replace(connectedPlantName, sitereader["ShortName"].ToString());

                        }

                        //This will removed from code when we update everywhere logic to hit service through service provider url not from database connection string
                        connstr = connectionstring.Replace(ConnecteddataSource, dataSource);
                        //connstr = "Data Source = " + sitereader["DatabaseIP"].ToString() + "; Database = geos; User ID = GeosUsr; Password = GEOS;Convert Zero Datetime=True";
                    }
                }
            }
            return connstr;
        }
        public List<UInt32> GetAllPCMIdArticles(string connectionstring)
        {
            List<UInt32> idsArticles = new List<UInt32>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PCM_GetAllPCMIdArticles", con);
                concommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        if (reader["IdArticle"] != DBNull.Value)
                            idsArticles.Add(Convert.ToUInt32(reader["IdArticle"]));
                    }
                }
            }
            return idsArticles;
        }

        public PODetail GetMaxPODeliveryDateDetail(string connectionstring, UInt64 idArticle)
        {
            PODetail poDetail = null;

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetMaxPODeliveryDateDetail", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", idArticle);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    if (reader.Read())
                    {
                        poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                    }
                }
            }
            return poDetail;
        }

        public List<PODetail> GetAllPCMArticleMaxPODeliveryDateDetail(string connectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetAllPCMArticleMaxPODeliveryDateDetail", con);
                concommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PODetail poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                        poDetailLst.Add(poDetail);
                    }
                }
            }
            return poDetailLst;
        }


        public List<PODetail> GetPCMArticleMaxPODeliveryDateDetail(string connectionstring,UInt64 idArticle)
        {
            List<PODetail> poDetailLst = new List<PODetail>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PCM_GetPCMArticleMaxPODeliveryDateDetail", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", idArticle);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PODetail poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                        poDetailLst.Add(poDetail);
                    }
                }
            }
            return poDetailLst;
        }

        public List<PODetail> GetAllArticlesByArticleComponentMaxPOFromPlant(string connectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetAllArticlesByArticleComponentMaxPOFromPlant", con);
                concommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PODetail poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                        poDetailLst.Add(poDetail);
                    }
                }
            }
            return poDetailLst;
        }

        public List<PODetail> GetAllPCMArticleMaxPODeliveryDateDetailFromEWHQ(string connectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetAllPCMArticleMaxPODeliveryDateDetailFromEWHQ", con);
                concommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PODetail poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                        poDetailLst.Add(poDetail);
                    }
                }
            }
            return poDetailLst;


        }


        public List<PODetail> GetAllArticleMaxPODeliveryDateDetailFromEWHQ(string plantconnectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();
            string connectionstring = GetEWHQDatabaseDetail(plantconnectionstring);
            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetAllPCMArticleMaxPODeliveryDateDetailFromEWHQ", con);
                concommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PODetail poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                        poDetailLst.Add(poDetail);
                    }
                }
            }
            return poDetailLst;
        }

        public List<PODetail> GetAllArticlesByArticleComponentMaxPOFromEWHQ(string plantconnectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();
            /*
            string connectionstring = GetEWHQDatabaseDetail(plantconnectionstring);
            */
            string connectionstring = GetEWHQDatabaseDetail_V2490(plantconnectionstring);
            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetAllArticlesByArticleComponentMaxPOFromEWHQ", con);
                concommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PODetail poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                        poDetailLst.Add(poDetail);
                    }
                }
            }
            return poDetailLst;
        }


        public List<PODetail> GetArticleMaxPODeliveryDateDetailFromEWHQ(string plantconnectionstring, UInt64 itemArticle)
        {
            List<PODetail> poDetailLst = new List<PODetail>();
            string connectionstring = GetEWHQDatabaseDetail_V2490(plantconnectionstring);
            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PCM_GetPCMArticleMaxPODeliveryDateDetailFromEWHQ", con);
            
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", itemArticle);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        PODetail poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);

                        poDetailLst.Add(poDetail);
                    }
                }
            }
            return poDetailLst;
        }


        public bool IsExistRecord(string connectionstring, ArticleCostPrice articleCostPrice)
        {
            bool isExist = false;

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PLM_check_article_details_exists", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                concommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                concommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                concommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                concommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    if (reader.Read())
                    {

                        if (reader["IdArticleCostPrice"] != DBNull.Value)
                            isExist = true;
                    }
                }
            }
            return isExist;
        }

        public List<Currency> GetAllCurrency(string connectionstring)
        {
            List<Currency> currencyLst = new List<Currency>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("currency_GetAllCurrency", con);
                concommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Currency currency = new Currency();
                        if (reader["IdCurrency"] != DBNull.Value)
                            currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                        if (reader["Name"] != DBNull.Value)
                            currency.Name = Convert.ToString(reader["Name"]);
                        currencyLst.Add(currency);


                    }
                }
            }
            return currencyLst;
        }


        public List<DailyCurrencyConversion> GetCurrencyRateByDateAndId(string mainServerConnectionString, DateTime dtFrom, DateTime dtTo)
        {
            List<DailyCurrencyConversion> dailyCurrencyConversionLst = new List<DailyCurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand concommand = new MySqlCommand("currencyconversions_GetAllCurrencyRateByDate", mySqlConnection);
                    concommand.CommandType = CommandType.StoredProcedure;
                    concommand.Parameters.AddWithValue("_CurrencyConversionFromDate", dtFrom);
                    concommand.Parameters.AddWithValue("_CurrencyConversionToDate", dtTo);
                    concommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = concommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            DailyCurrencyConversion dailyCurrencyConversiontemp = new DailyCurrencyConversion();
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                                dailyCurrencyConversiontemp.CurrencyConversationRate = float.Parse(reader["CurrencyConversionRate"].ToString());

                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                                dailyCurrencyConversiontemp.IdCurrencyConversionTo = Convert.ToByte(reader["IdCurrencyConversionTo"].ToString());

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                                dailyCurrencyConversiontemp.IdCurrencyConversionFrom = Convert.ToByte(reader["IdCurrencyConversionFrom"].ToString());

                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                                dailyCurrencyConversiontemp.CurrencyConversionDate = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());

                            dailyCurrencyConversionLst.Add(dailyCurrencyConversiontemp);
                        }
                    }

                    mySqlConnection.Close();
                }

            }
            catch (Exception ex)
            {
                throw;
            }

            return dailyCurrencyConversionLst;
        }


        public bool CalculateArticleCostPrice(string connectionstring, string mainServerConnectionString, string WorkbenchContext)
        {
            bool isCalculated = false;
            List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
            List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
            IList<Company> allPlants = GetEmdepSitesCompanies(connectionstring);
            List<Currency> allCurrency = GetAllCurrency(connectionstring);
            List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);


            string EWHQConnStr = GetEWHQDatabaseDetail(connectionstring);
            List<PODetail> EWHQpoDetailLst = GetAllPCMArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr);

            foreach (Company itemCompany in allPlants)
            {
                List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail(itemCompany.ConnectPlantConstr);
                foreach (UInt64 itemArticle in allPCMidsArticles)
                {
                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                    PODetail poDetail = null;
                    try
                    {
                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
                        poDetail = null;
                    }

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {

                        }
                        else
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                articleCostPriceLst.Add(articleCostPrice);

                            }
                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                articleCostPriceLst.Add(articleCostPrice);

                            }
                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {

                            }
                            else
                            {
                                articleCostPrice.IdArticle = itemArticle;
                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                                if (!IsExistRecord(connectionstring, articleCostPrice))
                                {
                                    articleCostPriceLst.Add(articleCostPrice);

                                }
                            }
                        }
                    }
                }
            }


            if (articleCostPriceLst != null && articleCostPriceLst.Count > 0)
            {
                foreach (ArticleCostPrice item in articleCostPriceLst)
                {

                    try
                    {

                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                        {
                            mySqlConnection.Open();
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.CommandTimeout = 3000;

                            mySqlCommand.Parameters.AddWithValue("_IdArticle", item.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", item.ArticleCostValue);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                            mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", item.ExchangeRateDate);
                            mySqlCommand.Parameters.AddWithValue("_IdCompany", item.IdCompany);
                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", item.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                            mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                            mySqlCommand.ExecuteNonQuery();
                            mySqlConnection.Close();

                        }

                        isCalculated = true;
                    }
                    catch (Exception ex)
                    {

                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        isCalculated = false;
                        throw;
                    }

                }

            }
            return isCalculated;
        }

        public List<Region> GetRegionsByGroupAndCountryAndSites_V2110(string PLMConnectionString, int IdGroup, string CountryNames, string SiteNames)
        {
            List<Region> Regions = new List<Region>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetRegionsByGroupAndCountryAndSites_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdGroup);
                    mySqlCommand.Parameters.AddWithValue("_CountryName", CountryNames);
                    mySqlCommand.Parameters.AddWithValue("_SiteName", SiteNames);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Region Region = new Region();
                            Region.IdRegion = Convert.ToInt32(reader["IdLookupValue"]);

                            if (reader["Value"] != DBNull.Value)
                            {
                                Region.RegionName = Convert.ToString(reader["Value"]);
                            }
                            Regions.Add(Region);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetRegionsByGroupAndCountryAndSites_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Regions;
        }



        public List<Site> GetPlantsByGroupAndRegionAndCountry_V2110(string PLMConnectionString, int IdGroup, string RegionNames, string CountryNames)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetPlantsByGroupAndRegionAndCountry_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdGroup);
                    mySqlCommand.Parameters.AddWithValue("_RegionName", RegionNames);
                    mySqlCommand.Parameters.AddWithValue("_CountryName", CountryNames);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdSite"]);

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["PlantName"]);
                            }
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                Site.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                Site.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                            }
                            if (reader["CustomerName"] != DBNull.Value)
                            {
                                Site.GroupName = Convert.ToString(reader["CustomerName"]);
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                Site.RegionName = Convert.ToString(reader["RegionName"]);
                            }

                            if (reader["idCountry"] != DBNull.Value)
                            {
                                Site.IdCountry = Convert.ToByte(reader["idCountry"]);
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                Site.CountryName = Convert.ToString(reader["CountryName"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPlantsByGroupAndRegionAndCountry_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }


        public List<Country> GetCountriesByGroupAndRegionAndSites_V2110(string PLMConnectionString, int IdGroup, string RegionNames, string SiteNames)
        {
            List<Country> Countrys = new List<Country>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCountriesByGroupAndRegionAndSites_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdGroup);
                    mySqlCommand.Parameters.AddWithValue("_RegionName", RegionNames);
                    mySqlCommand.Parameters.AddWithValue("_SiteName", SiteNames);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Country Country = new Country();
                            Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                            if (reader["name"] != DBNull.Value)
                            {
                                Country.Name = Convert.ToString(reader["name"]);
                            }
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                Country.IdRegion = Convert.ToInt32(reader["IdRegion"]);
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                Country.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                            }
                            Countrys.Add(Country);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountriesByGroupAndRegionAndSites_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return Countrys;
        }


        public void AddCustomersByCPL_V2110(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CPLCustomer> CustomerList, uint IdCreator)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CPLCustomer Customer in CustomerList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            if (Customer.IdGroup == 0)
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                            mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            Customer.IdCustomerPriceListCustomer = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomersByCPL_V2110(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void AddUpdateDeleteCustomersByCPL_V2110(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CPLCustomer> CustomerList, uint? IdModifier)
        {
            try
            {
                if (CustomerList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CPLCustomer Customer in CustomerList)
                        {
                            if (Customer.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCustomer", Customer.IdCustomerPriceListCustomer);
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (Customer.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (Customer.IdCustomerPriceListCustomer > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListCustomer", Customer.IdCustomerPriceListCustomer);
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                    if (Customer.IdGroup == 0)
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                    else
                                        mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                                    mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (Customer.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListCustomers_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                if (Customer.IdGroup == 0)
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", null);
                                else
                                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", Customer.IdGroup);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", Customer.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", Customer.IdCountry);
                                mySqlCommand.Parameters.AddWithValue("_IdSite", Customer.IdPlant);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                Customer.IdCustomerPriceListCustomer = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCustomersByCPL_V2110(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public List<CPLCustomer> GetCPLCustomersByIdCustomerPriceList_V2110(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CPLCustomer> CPLCustomerList = new List<CPLCustomer>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomersByIdCustomerPriceList_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CPLCustomer CPLCustomer = new CPLCustomer();
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                CPLCustomer.IdRegion = Convert.ToUInt32(reader["IdRegion"]);
                                if (reader["RegionName"] != DBNull.Value)
                                {
                                    CPLCustomer.RegionName = Convert.ToString(reader["RegionName"]);
                                }
                            }
                            else
                            {
                                CPLCustomer.RegionName = "ALL";
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                CPLCustomer.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                                if (reader["CustomerName"] != DBNull.Value)
                                {
                                    CPLCustomer.GroupName = Convert.ToString(reader["CustomerName"]);
                                }
                            }
                            else
                            {
                                CPLCustomer.GroupName = "ALL";
                            }
                            if (reader["Parent"] != DBNull.Value)
                            {
                                CPLCustomer.Parent = Convert.ToString(reader["Parent"]);
                            }
                            if (reader["IdSite"] != DBNull.Value)
                            {
                                CPLCustomer.IdPlant = Convert.ToUInt32(reader["IdSite"]);
                                CPLCustomer.Plant = new Site();
                                CPLCustomer.Plant.IdSite = Convert.ToUInt32(reader["IdSite"]);
                                if (reader["PlantName"] != DBNull.Value)
                                {
                                    CPLCustomer.Plant.Name = Convert.ToString(reader["PlantName"]);
                                }
                            }
                            else
                            {
                                CPLCustomer.Plant = new Site();
                                CPLCustomer.Plant.Name = "ALL";
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                CPLCustomer.IdCountry = Convert.ToByte(reader["idCountry"]);
                                CPLCustomer.Country = new Country();
                                CPLCustomer.Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                {
                                    CPLCustomer.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                            }
                            else
                            {
                                CPLCustomer.Country = new Country();
                                CPLCustomer.Country.Name = "ALL";
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CPLCustomer.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdCustomerPriceListCustomer"] != DBNull.Value)
                            {
                                CPLCustomer.IdCustomerPriceListCustomer = Convert.ToUInt64(reader["IdCustomerPriceListCustomer"]);
                            }
                            CPLCustomerList.Add(CPLCustomer);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCPLCustomersByIdCustomerPriceList_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CPLCustomerList;
        }
        public List<CustomerPrice> GetCustomerPrices_V2110(string PLMConnectionString)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceList_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]).Trim();

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                List<string> tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                customerPrice.SaleCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }

                            if (reader["CustGroup"] != DBNull.Value)
                            {
                                List<string> tempDifferentGroup = Convert.ToString(reader["CustGroup"]).Split('\n').ToList<string>();
                                tempDifferentGroup = tempDifferentGroup.Distinct().ToList();
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        tempDifferentGroup.Add("ALL");
                                }
                                customerPrice.Group = string.Join("\n", tempDifferentGroup.ToArray());
                            }
                            else
                            {
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        customerPrice.Group = "ALL";
                                }
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                customerPrice.Country = customerPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        customerPrice.Country = "ALL";
                                }
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempDifferentRegionName = Convert.ToString(reader["RegionName"]).Split('\n').ToList<string>();
                                tempDifferentRegionName = tempDifferentRegionName.Distinct().ToList();

                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        tempDifferentRegionName.Add("ALL");
                                }

                                customerPrice.Region = customerPrice.Region + string.Join("\n", tempDifferentRegionName.ToArray());
                            }
                            else
                            {
                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        customerPrice.Region = "ALL";
                                }
                            }

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlantName = Convert.ToString(reader["PlantName"]).Split('\n').ToList<string>();
                                tempDifferentPlantName = tempDifferentPlantName.Distinct().ToList();
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        tempDifferentPlantName.Add("ALL");
                                }
                                customerPrice.Plant = customerPrice.Plant + string.Join("\n", tempDifferentPlantName.ToArray());
                            }
                            else
                            {
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        customerPrice.Plant = "ALL";
                                }
                            }

                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPrices_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPrices;
        }


        public List<CurrencyConversion> GetCurrencyConversionsMaxRate(string WorkbenchConnectionString)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsMaxRate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsMaxRate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }

        public List<CurrencyConversion> GetCurrencyConversionsMaxRate_V2110(string WorkbenchConnectionString, DateTime MinDate, DateTime MaxDate)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsMaxRate_V2110", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_MinExchangeDate", MinDate);
                    mySqlCommand.Parameters.AddWithValue("_MaxExchangeDate", MaxDate);
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsMaxRate_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }


        public List<DateTime> GetMinMaxArticleExchangeRateDate(string WorkbenchConnectionString)
        {
            List<DateTime> MinMaxDates = new List<DateTime>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetMinMaxArticleExchangeRateDate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["MinDate"] != DBNull.Value)
                            {
                                MinMaxDates.Add(Convert.ToDateTime(reader["MinDate"]));
                            }
                            if (reader["MaxDate"] != DBNull.Value)
                            {
                                MinMaxDates.Add(Convert.ToDateTime(reader["MaxDate"]));
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetMinMaxArticleExchangeRateDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return MinMaxDates;
        }



        #endregion


        #region V2120



        public List<BPLDetection> GetAllDetectionTypes(string PCMConnectionString)
        {
            List<BPLDetection> DetectionTypes = new List<BPLDetection>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllDetectionTypes", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BPLDetection DetectionType = new BPLDetection();

                            DetectionType.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                DetectionType.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["KeyName"] != DBNull.Value)
                            {
                                DetectionType.KeyName = Convert.ToString(reader["KeyName"]);
                            }
                            DetectionTypes.Add(DetectionType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionTypes(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return DetectionTypes;
        }

        public List<BPLDetection> GetAllDetectionGroups(string PCMConnectionString)
        {
            List<BPLDetection> DetectionTypes = new List<BPLDetection>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetDetectionGroups", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BPLDetection DetectionType = new BPLDetection();

                            DetectionType.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);

                            if (reader["OriginalName"] != DBNull.Value)
                            {
                                DetectionType.Name = Convert.ToString(reader["OriginalName"]);
                            }
                            if (reader["KeyName"] != DBNull.Value)
                            {
                                DetectionType.KeyName = Convert.ToString(reader["KeyName"]);
                            }
                            if (reader["ParentName"] != DBNull.Value)
                            {
                                DetectionType.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            DetectionTypes.Add(DetectionType);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetectionGroups(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return DetectionTypes;
        }

        public BasePrice AddBasePrice_V2120(BasePrice basePrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            basePrice.Code = lastestBasePriceCode;
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.IdCreator);
                        AddDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, basePrice.IdCreator);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    //Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }

        public void AddArticlesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, UInt32 IdCreator)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem Article in ArticleList)
                        {
                            //  MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", Article.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", Article.ArticleCostValue);
                            mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", Article.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Article.CurrencyConversionDate_New);
                            if (Article.CurrencyConversionRate_New == 0)
                            {
                                Article.CurrencyConversionRate_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", Article.CurrencyConversionRate_New);
                            mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                            if (Article.SellPrice_New == 0)
                            {
                                Article.SellPrice_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_SellPrice", Article.SellPrice_New);
                            mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                            mySqlCommand.Parameters.AddWithValue("_Royalty", Article.Royalty);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByBasePrice_V2110(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeletePlantsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        PlantList = PlantList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete || a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList();

                        foreach (Site site in PlantList)
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlant_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                List<Currency> CurrencyList_Save = new List<Currency>(CurrencyList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList());
                                foreach (Currency currency in CurrencyList_Save.Distinct())
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }

                                foreach (Currency currency in CurrencyList_Cloned.Distinct())
                                {
                                    if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeletePlantsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeleteCurrenciesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        CurrencyList = CurrencyList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete || a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList();
                        foreach (Currency currency in CurrencyList)
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByCurrency_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                List<Site> PlantList_Save = new List<Site>(PlantList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList());

                                foreach (Site site in PlantList_Save.Distinct())
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }

                                foreach (Site site in PlantList_Cloned.Distinct())
                                {
                                    if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                                        mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCurrenciesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeleteBasePriceListArticlePlantsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Currency> CurrencyList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (CurrencyList_Cloned == null)
                    CurrencyList_Cloned = new List<Currency>();

                if (ArticleList != null && PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            List<Site> PlantList_Save = PlantList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete || a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList();

                            foreach (Site site in PlantList_Save.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    List<Currency> CurrencyList_Add = CurrencyList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList();

                                    foreach (Currency currency in CurrencyList_Add.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }

                                    foreach (Currency currency in CurrencyList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!CurrencyList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //   MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                List<Site> PlantList_Delete = PlantList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).ToList();

                                foreach (Site site in PlantList_Delete.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticlePlantsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, List<Site> PlantList, List<Currency> CurrencyList, List<Site> PlantList_Cloned, UInt32? IdModifier, List<BasePriceListByItem> ArticleList_Cloned)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (PlantList_Cloned == null)
                    PlantList_Cloned = new List<Site>();

                if (ArticleList != null && CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem article in ArticleList)
                        {
                            List<Currency> CurrencyList_Save = CurrencyList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete || a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList();

                            foreach (Currency currency in CurrencyList_Save.Where(a => a.IdArticle == article.IdArticle))
                            {
                                if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                    mySqlCommand.ExecuteNonQuery();
                                }
                                else if (currency.TransactionOperation == ModelBase.TransactionOperations.Add)
                                {
                                    List<Site> PlantList_Add = PlantList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).ToList();

                                    foreach (Site site in PlantList_Add.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Add && a.IdArticle == currency.IdArticle))
                                        {
                                            if (site.TransactionOperation == ModelBase.TransactionOperations.Add)
                                            {
                                                //  MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                                mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                                mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                                mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                                mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                                mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                                if (currency.CurrencyConversionRate_New == 0)
                                                {
                                                    currency.CurrencyConversionRate_New = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                                mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                                mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                                if (currency.SellPriceValue == 0)
                                                {
                                                    currency.SellPriceValue = null;
                                                }
                                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                                mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                                mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                                mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                                mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                                mySqlCommand.ExecuteNonQuery();
                                            }
                                        }
                                    }

                                    foreach (Site site in PlantList_Cloned.Distinct().Where(a => a.IdArticle == article.IdArticle))
                                    {
                                        if (!PlantList.Any(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete))
                                        {
                                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_IdCPType", article.IdCPType);
                                            mySqlCommand.Parameters.AddWithValue("_IdDetection", article.IdDetection);
                                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_MaxCost", article.MaxCost);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                            if (currency.CurrencyConversionRate_New == 0)
                                            {
                                                currency.CurrencyConversionRate_New = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                            mySqlCommand.Parameters.AddWithValue("_IdRule", article.IdRule);
                                            mySqlCommand.Parameters.AddWithValue("_RuleValue", article.RuleValue);
                                            if (currency.SellPriceValue == 0)
                                            {
                                                currency.SellPriceValue = null;
                                            }
                                            mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                            mySqlCommand.Parameters.AddWithValue("_Version", article.Version);
                                            mySqlCommand.Parameters.AddWithValue("_Royalty", article.Royalty);
                                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                            mySqlCommand.ExecuteNonQuery();
                                        }
                                    }
                                }
                            }
                        }
                        foreach (BasePriceListByItem article in ArticleList_Cloned)
                        {
                            if (!ArticleList.Any(a => a.IdArticle == article.IdArticle))
                            {
                                List<Currency> CurrencyList_Delete = CurrencyList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).ToList();

                                foreach (Currency currency in CurrencyList_Delete.Where(a => a.IdArticle == article.IdArticle))
                                {
                                    if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", article.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteBasePriceListArticleCurrenciesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, UInt32? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        ArticleList = ArticleList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (BasePriceListByItem Article in ArticleList.Distinct())
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesPlantsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, UInt32? IdModifier)
        {
            try
            {
                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        PlantList = PlantList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (Site site in PlantList.Distinct())
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", site.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", site.ArticleCostValue);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", site.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesPlantsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesCurrenciesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        CurrencyList = CurrencyList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", currency.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                if (currency.CurrencyConversionRate_New == 0)
                                {
                                    currency.CurrencyConversionRate_New = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                if (currency.SellPriceValue == 0)
                                {
                                    currency.SellPriceValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesCurrenciesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //10-03-21
        public void DeleteArticlePlantsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList)
        {
            try
            {
                if (PlantList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Site site in PlantList)
                        {
                            if (site.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsPlants_Delete_V2120", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteArticlePlantsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void DeleteArticleCurrenciesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency Currency in CurrencyList)
                        {
                            if (Currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Delete_V2120", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", Currency.IdCurrency);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteArticleCurrenciesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void DeleteArticlesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Articles> ArticleList)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Articles Article in ArticleList)
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListArticles_Delete_V2120", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticlesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //for bpl detection
        public void AddDetectionsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> DetectionList, UInt32 IdCreator)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem detection in DetectionList)
                        {
                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert", mySqlConnection);
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", detection.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", detection.IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", detection.IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", detection.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", detection.ArticleCostValue);
                            mySqlCommand.Parameters.AddWithValue("_MaxCost", detection.MaxCost);
                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", detection.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", detection.CurrencyConversionDate_New);
                            if (detection.CurrencyConversionRate_New == 0)
                            {
                                detection.CurrencyConversionRate_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", detection.CurrencyConversionRate_New);
                            mySqlCommand.Parameters.AddWithValue("_IdRule", detection.IdRule);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", detection.RuleValue);
                            if (detection.SellPrice_New == 0)
                            {
                                detection.SellPrice_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_SellPrice", detection.SellPrice_New);
                            mySqlCommand.Parameters.AddWithValue("_Version", detection.Version);
                            mySqlCommand.Parameters.AddWithValue("_Royalty", detection.Royalty);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void DeleteDetectionsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Detections> DetectionList)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Detections Detection in DetectionList)
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListDetections_Delete_V2120", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetections);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void DeleteDetectionCurrenciesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency Currency in CurrencyList)
                        {
                            if (Currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Detection_Delete_V2120", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", Currency.IdCurrency);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionCurrenciesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void UpdateDetectionsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> DetectionList, UInt32? IdModifier)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        DetectionList = DetectionList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (BasePriceListByItem Detection in DetectionList.Distinct())
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Detection_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_MaxCost", Detection.MaxCost);
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Detection.IdRule);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Detection.RuleValue);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Detection.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateDetectionsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void UpdateDetectionCurrenciesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        CurrencyList = CurrencyList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListItemsCurrencies_Detection_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", currency.IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                                if (currency.CurrencyConversionRate_New == 0)
                                {
                                    currency.CurrencyConversionRate_New = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                if (currency.SellPriceValue == 0)
                                {
                                    currency.SellPriceValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateDetectionsCurrenciesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public BasePrice GetBasePriceDetailById_V2120(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceListItemsCurrenciesById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Detection_CurrencyList = GetBasePriceListDetectionCurrenciesById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<BasePriceListByItem> GetBasePriceListDetectionsById(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItems_Detection_ById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();
                            BasePriceListByItem.IdBasePriceListByItems = Convert.ToUInt64(reader["IdBasePriceListByItems"]);

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                BasePriceListByItem.Detection = new Detections();
                                BasePriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionCode"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.Code = Convert.ToString(reader["DetectionCode"]);
                                }
                                if (reader["DetectionName"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.Name = Convert.ToString(reader["DetectionName"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    BasePriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                BasePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListDetectionsById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }

        public List<Currency> GetBasePriceListDetectionCurrenciesById(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItems_Detection_CurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Currency.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                Currency.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate_New = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListDetectionCurrenciesById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public List<Site> GetPlants_V2120(string ConnectionString)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(ConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetPlants", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdSite"]);

                            if (reader["ShortName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["ShortName"]);
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPlants_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public List<PCMArticleCategory> GetPCMArticlesWithCategory_V2120(string PLMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PLMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReference_V2120(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryForReference_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }

        public BasePrice GetBasePriceDetailById_ForCPL_V2120(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                //BasePrice.CPLArticleList = GetPCMArticlesWithCategoryForReferenceByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                //BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceForCustomerPriceListById(PLMConnectionString, BasePrice.IdBasePriceList, BasePrice.IdCurrency);
                BasePrice.Article_CurrencyList_ForCPL = GetBasePriceListItemsCurrenciesById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                //BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Detection_CurrencyList = GetBasePriceListDetectionCurrenciesById(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }


        public List<CurrencyConversion> GetCurrencyConversionsMaxRate_ByPreviousDate(string WorkbenchConnectionString)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsMaxRate_ByPreviousDate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsMaxRate_ByPreviousDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }

        public List<BasePrice> GetBasePrices_V2120(string PLMConnectionString)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceList_V2120", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                List<string> tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePrices_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return basePrices;
        }

        public List<CustomerPrice> GetCustomerPriceIFExistItem_V2120(string PLMConnectionString, UInt64 IdBasePriceList, string IdArticles)
        {
            List<CustomerPrice> customerPriceLst = new List<CustomerPrice>();
            try
            {
                if (!string.IsNullOrEmpty(IdArticles))
                {
                    using (MySqlConnection connCustomerPrice = new MySqlConnection(PLMConnectionString))
                    {
                        connCustomerPrice.Open();

                        MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_GetCustomerPriceIFExistItem_V2120", connCustomerPrice);
                        CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                        CustomerPriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                        CustomerPriceCommand.Parameters.AddWithValue("_IdArticles", IdArticles);


                        using (MySqlDataReader CustomerPriceReader = CustomerPriceCommand.ExecuteReader())
                        {
                            while (CustomerPriceReader.Read())
                            {
                                CustomerPrice customerPrice = new CustomerPrice();


                                if (CustomerPriceReader["Code"] != DBNull.Value)
                                {
                                    customerPrice.Code = Convert.ToString(CustomerPriceReader["Code"]);
                                }
                                if (CustomerPriceReader["Name"] != DBNull.Value)
                                {
                                    customerPrice.Name = Convert.ToString(CustomerPriceReader["Name"]);
                                }
                                if (CustomerPriceReader["IdCustomerPriceList"] != DBNull.Value)
                                {
                                    customerPrice.IdCustomerPriceList = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceList"]);
                                }
                                if (CustomerPriceReader["IdCustomerPriceListByItems"] != DBNull.Value)
                                {
                                    customerPrice.CustomerPriceListItems = new List<CustomerPriceListByItem>();
                                    CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                    customerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceListByItems"]);
                                    customerPriceListByItem.IdArticle = Convert.ToUInt64(CustomerPriceReader["IdArticle"]); ;
                                    customerPrice.CustomerPriceListItems.Add(customerPriceListByItem);
                                }
                                customerPriceLst.Add(customerPrice);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceIFExistItem_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLst;
        }


        public void AddDeletePlantsByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Currency> CurrencyList, List<Site> DeletePlantList, List<Site> AddPlantList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList == null)
                    CurrencyList = new List<Currency>();

                if (DeletePlantList == null)
                    DeletePlantList = new List<Site>();

                if (AddPlantList == null)
                    AddPlantList = new List<Site>();

                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();

                    foreach (Site site in DeletePlantList)
                    {
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlant_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                        mySqlCommand.ExecuteNonQuery();
                    }

                    foreach (Site site in AddPlantList)
                    {
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeletePlantsByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDeleteCurrenciesByBasePrice_V2120(string MainServerConnectionString, UInt64 IdBasePriceList, List<Site> PlantList, List<Currency> AddCurrencyList, List<Currency> DeleteCurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (PlantList == null)
                    PlantList = new List<Site>();

                if (AddCurrencyList == null)
                    AddCurrencyList = new List<Currency>();

                if (DeleteCurrencyList == null)
                    DeleteCurrencyList = new List<Currency>();

                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    foreach (Currency currency in DeleteCurrencyList)
                    {
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByCurrency_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                        mySqlCommand.ExecuteNonQuery();
                    }

                    foreach (Currency currency in AddCurrencyList)
                    {
                        foreach (Site site in PlantList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByPlantCurrency_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", site.IdSite);
                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_PlantbyCurrency", 0);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteCurrenciesByBasePrice_V2120(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }



        public List<BPLDetection> GetAllDetections(string PLMConnectionString)
        {
            List<BPLDetection> DetectionList = new List<BPLDetection>();
            try
            {
                DetectionList.AddRange(GetAllDetectionTypes(PLMConnectionString));
                DetectionList.AddRange(GetAllDetectionGroups(PLMConnectionString));

                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllDetections", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BPLDetection detection = new BPLDetection();
                            detection.KeyName = Convert.ToString(i);
                            detection.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            detection.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                detection.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detection.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                detection.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }
                            if (reader["DetectionTypeName"] != DBNull.Value)
                            {
                                detection.DetectionTypeName = Convert.ToString(reader["DetectionTypeName"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                detection.Code = Convert.ToString(reader["Code"]);
                            }

                            DetectionList.Add(detection);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetections(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionList;
        }


        public bool UpdateBasePrice_V2120(BasePrice basePrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        //information plant and currency
                        AddDeletePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.CurrencyList, basePrice.DeletePlantList, basePrice.AddPlantList, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.AddCurrencyList, basePrice.DeleteCurrencyList, basePrice.IdModifier);
                        //articles
                        DeleteArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteArticleList);
                        DeleteArticlePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeletePlantList);
                        DeleteArticleCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteCurrencyList);
                        UpdateArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateArticleList, basePrice.IdModifier);
                        UpdateArticlesPlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdatePlantList, basePrice.IdModifier);
                        UpdateArticlesCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateCurrencyList, basePrice.IdModifier);
                        AddArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddArticleList, (uint)basePrice.IdModifier);
                        //detections
                        DeleteDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteDetectionList);
                        DeleteDetectionCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteCurrencyList);
                        UpdateDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionList, basePrice.IdModifier);
                        UpdateDetectionCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionCurrencyList, basePrice.IdModifier);
                        AddDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, (uint)basePrice.IdModifier);
                        //change log/plantcurrency/cpl log/delete cpl items
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2120(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }

        #endregion


        #region V2130

        public BasePrice GetBasePriceDetailById_ForCPL_V2130(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceForCustomerPriceListById(PLMConnectionString, BasePrice.IdBasePriceList, BasePrice.IdCurrency);
                BasePrice.Article_CurrencyList_ForCPL = GetBasePriceListItemsCurrenciesById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems_ForCPL = GetBasePriceListItemsById_ForCPL(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections_ForCPL = GetBasePriceListDetectionsById_ForCPL(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Detection_CurrencyList = GetBasePriceOfDetectionForCustomerPriceListById(PLMConnectionString, BasePrice.IdBasePriceList, BasePrice.IdCurrency);
                BasePrice.Detection_CurrencyList_ForCPL = GetBasePriceListDetectionCurrenciesById(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2130(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<CustomerPriceListByItem> GetBasePriceListItemsById_ForCPL(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItemsById_V2090", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                CustomerPriceListByItem.ArticleData = new Articles();
                                CustomerPriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                    CustomerPriceListByItem.ArticleData.Description_es = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsById_ForCPL(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }


        public List<CustomerPriceListByItem> GetBasePriceListDetectionsById_ForCPL(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItems_Detection_ById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                CustomerPriceListByItem.Detection = new Detections();
                                CustomerPriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionCode"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Code = Convert.ToString(reader["DetectionCode"]);
                                }
                                if (reader["DetectionName"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Name = Convert.ToString(reader["DetectionName"]);
                                    CustomerPriceListByItem.Detection.Name_es = Convert.ToString(reader["DetectionName"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    CustomerPriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListDetectionsById_ForCPL(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }


        public CustomerPrice AddCustomerPrice_V2130(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddArticlesByCustomerPrice_V2130(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdCreator);
                        AddDetectionsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        AddCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice_V2130(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }

        public void AddArticlesByCustomerPrice_V2130(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, UInt32? IdCreator)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            // MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceListByItems_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", Article.IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", Article.IdDetection);
                            if (Article.ItemCustomerDescription != null)
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                            else
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);

                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                            if (Article.BasePriceListValue == 0)
                            {
                                Article.BasePriceListValue = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", Article.IdPlant);
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", Article.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Article.CurrencyConversionDate_New);
                            if (Article.CurrencyConversionRate_New == 0)
                            {
                                Article.CurrencyConversionRate_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", Article.CurrencyConversionRate_New);
                            if (Article.IdRule_New == 0)
                            {
                                Article.IdRule_New = null;
                                Article.RuleValue_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule_New);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue_New);
                            if (Article.SellPrice_New == 0)
                            {
                                Article.SellPrice_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_SellPrice", Article.SellPrice_New);
                            mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Article.LinkedDescription);
                            mySqlCommand.ExecuteNonQuery();

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByCustomerPrice_V2130(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDetectionsByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> DetectionList, UInt32? IdCreator)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Detection in DetectionList.Distinct())
                        {
                            // MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2100", mySqlConnection);
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", Detection.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", Detection.IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetection);
                            if (Detection.ItemCustomerDescription != null)
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription.Trim());
                            else
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription);

                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Detection.VisibleToCustomer);
                            if (Detection.BasePriceListValue == 0)
                            {
                                Detection.BasePriceListValue = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Detection.BasePriceListValue);
                            mySqlCommand.Parameters.AddWithValue("_IdPlant", 0);
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", Detection.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Detection.CurrencyConversionDate_New);
                            if (Detection.CurrencyConversionRate_New == 0)
                            {
                                Detection.CurrencyConversionRate_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", Detection.CurrencyConversionRate_New);
                            if (Detection.IdRule_New == 0)
                            {
                                Detection.IdRule_New = null;
                                Detection.RuleValue_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRule", Detection.IdRule_New);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", Detection.RuleValue_New);
                            if (Detection.SellPrice_New == 0)
                            {
                                Detection.SellPrice_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_SellPrice", Detection.SellPrice_New);
                            mySqlCommand.Parameters.AddWithValue("_Version", Detection.Version);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Detection.LinkedDescription);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public CustomerPrice GetCustomerPricesById_V2130(string PLMConnectionString, UInt64 idCustomerPriceList)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CurrencyList = GetCurrenciesByIdCustomerPrice(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2130(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_CurrencyList = GetCustomerPriceListItemsCurrenciesById_V2130(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Article_PlantList = GetCustomerPriceListItemsPlantsById_V2130(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListDetections = GetCustomerPriceListDetectionsById(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.Detection_CurrencyList = GetCustomerPriceListDetectionCurrenciesById(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2130(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }

        public List<CustomerPriceListByItem> GetCustomerPriceListItemsById_V2130(string WorkbenchConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsById_V2130", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            CustomerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(reader["IdCustomerPriceListByItems"]);

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                CustomerPriceListByItem.ArticleData = new Articles();
                                CustomerPriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                    CustomerPriceListByItem.ArticleData.Description_es = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["ItemCustomerDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.ItemCustomerDescription = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                                CustomerPriceListByItem.ItemCustomerDescription_Old = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                            }
                            if (reader["VisibleToCustomer"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.VisibleToCustomer = Convert.ToByte(reader["VisibleToCustomer"]);
                            }
                            if (reader["BasePriceListValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.BasePriceListValue = float.Parse(reader["BasePriceListValue"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                                CustomerPriceListByItem.IdRule_New = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                                CustomerPriceListByItem.RuleValue_New = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["LinkedDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.LinkedDescription = Convert.ToByte(reader["LinkedDescription"]);
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsById_V2130(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }


        public List<CustomerPriceListByItem> GetCustomerPriceListDetectionsById(string WorkbenchConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItems_Detection_ById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            CustomerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(reader["IdCustomerPriceListByItems"]);

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                CustomerPriceListByItem.Detection = new Detections();
                                CustomerPriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Code = Convert.ToString(reader["DetectionRef"]);
                                }
                                if (reader["DetectionDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Description = Convert.ToString(reader["DetectionDesc"]);
                                    CustomerPriceListByItem.Detection.Description_es = Convert.ToString(reader["DetectionDesc"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    CustomerPriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                            }
                            if (reader["ItemCustomerDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.ItemCustomerDescription = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                                CustomerPriceListByItem.ItemCustomerDescription_Old = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                            }
                            if (reader["VisibleToCustomer"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.VisibleToCustomer = Convert.ToByte(reader["VisibleToCustomer"]);
                            }
                            if (reader["BasePriceListValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.BasePriceListValue = float.Parse(reader["BasePriceListValue"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["LinkedDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.LinkedDescription = Convert.ToByte(reader["LinkedDescription"]);
                            }

                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListDetectionsById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }


        public List<Currency> GetCustomerPriceListItemsCurrenciesById_V2130(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsCurrenciesById_V2130", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["BasePriceListCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                Currency.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Currency.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate_New = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsCurrenciesById_V2130(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public List<Site> GetCustomerPriceListItemsPlantsById_V2130(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Site> Sites = new List<Site>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItemsPlantsById_V2130", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Site Site = new Site();
                            Site.IdSite = Convert.ToUInt32(reader["IdPlant"]);

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                Site.Name = Convert.ToString(reader["PlantName"]);
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                Site.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Site.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                Site.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            Sites.Add(Site);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsPlantsById_V2130(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Sites;
        }

        public List<Currency> GetCustomerPriceListDetectionCurrenciesById(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItems_Detection_CurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["BasePriceListCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                Currency.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                Currency.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate_New = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListDetectionCurrenciesById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public bool UpdateCustomerPrice_V2130(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceListItems(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice_V2130(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdModifier);
                            AddDetectionsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdModifier);
                        }
                        else
                        {
                            //articles
                            DeleteArticlesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteArticleList);
                            DeleteArticleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteCurrencyList);
                            AddArticlesByCustomerPrice_V2130(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddArticleList, (uint)customerPrice.IdModifier);
                            UpdateArticlesByCustomerPrice_V2130(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateArticleList, customerPrice.IdModifier);
                            //UpdateArticlesPlantsByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdatePlantList, customerPrice.IdModifier);
                            UpdateArticlesCurrenciesByCustomerPrice_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateCurrencyList, customerPrice.IdModifier);

                            //detections
                            DeleteDetectionsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteDetectionList);
                            DeleteDetectionCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteCurrencyList);
                            AddDetectionsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddDetectionList, (uint)customerPrice.IdModifier);
                            UpdateDetectionsByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateDetectionList, customerPrice.IdModifier);
                            UpdateDetectionCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateDetectionCurrencyList, customerPrice.IdModifier);
                        }
                        AddUpdateDeleteCustomersByCPL_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice_V2130(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void DeleteArticlesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Articles> ArticleList)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Articles Article in ArticleList)
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListArticles_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticlesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void DeleteArticleCurrenciesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Currency> CurrencyList)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency Currency in CurrencyList)
                        {
                            if (Currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Delete_V2130", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", Currency.IdCurrency);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticleCurrenciesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void DeleteDetectionsByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Detections> DetectionList)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Detections Detection in DetectionList)
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListDetections_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetections);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionsByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void DeleteDetectionCurrenciesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Currency> CurrencyList)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency Currency in CurrencyList)
                        {
                            if (Currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Detection_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCurrency", Currency.IdCurrency);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionCurrenciesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateDetectionsByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> DetectionList, UInt32? IdModifier)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Detection in DetectionList.Distinct())
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Detection_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetection);
                                if (Detection.ItemCustomerDescription != null)
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription.Trim());
                                else
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription);

                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Detection.VisibleToCustomer);
                                if (Detection.BasePriceListValue == 0)
                                {
                                    Detection.BasePriceListValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Detection.BasePriceListValue);
                                if (Detection.IdRule_New == 0)
                                {
                                    Detection.IdRule_New = null;
                                    Detection.RuleValue_New = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Detection.IdRule_New);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Detection.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Detection.LinkedDescription);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Detection.CurrencyConversionDate_New);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateDetectionCurrenciesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Currency> CurrencyList, UInt32? IdModifier)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListItemsCurrencies_Detection_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", currency.IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                if (currency.CurrencyConversionRate_New == 0)
                                {
                                    currency.CurrencyConversionRate_New = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionRate", currency.CurrencyConversionRate_New);
                                if (currency.SellPriceValue == 0)
                                {
                                    currency.SellPriceValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_SellPrice", currency.SellPriceValue);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateDetectionCurrenciesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void UpdateArticlesByCustomerPrice_V2130(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, UInt32? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceListByItems_Update_V2100", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                if (Article.ItemCustomerDescription != null)
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                                else
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);

                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                                if (Article.BasePriceListValue == 0)
                                {
                                    Article.BasePriceListValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);

                                if (Article.IdRule_New == 0)
                                {
                                    Article.IdRule_New = null;
                                    Article.RuleValue_New = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule_New);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Article.LinkedDescription);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByCustomerPrice_V2130(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<Currency> GetBasePriceOfDetectionForCustomerPriceListById(string PLMConnectionString, UInt64 IdBasePriceList, UInt32 IdCurrency)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceOfDetectionForCustomerPriceListById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["CurrencyName"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["CurrencyName"]);
                            }
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                Currency.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                Currency.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            }

                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                Currency.CurrencyConversionRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["SellPrice"] != DBNull.Value)
                            {
                                Currency.SellPriceValue = float.Parse(reader["SellPrice"].ToString());
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceOfDetectionForCustomerPriceListById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }


        public List<Currency> GetCurrenciesByIdCustomerPrice(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["Name"]);
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrenciesByIdCustomerPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }
        #endregion


        public BasePrice AddBasePrice_V2140(BasePrice basePrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            basePrice.Code = lastestBasePriceCode;
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.IdCreator);
                        AddDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, basePrice.IdCreator);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2140(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }


        public bool UpdateBasePrice_V2140(BasePrice basePrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        //information plant and currency
                        AddDeletePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.CurrencyList, basePrice.DeletePlantList, basePrice.AddPlantList, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.AddCurrencyList, basePrice.DeleteCurrencyList, basePrice.IdModifier);
                        //articles
                        DeleteArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteArticleList);
                        DeleteArticlePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeletePlantList);
                        DeleteArticleCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteCurrencyList);
                        UpdateArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateArticleList, basePrice.IdModifier);
                        UpdateArticlesPlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdatePlantList, basePrice.IdModifier);
                        UpdateArticlesCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateCurrencyList, basePrice.IdModifier);
                        AddArticlesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddArticleList, (uint)basePrice.IdModifier);
                        //detections
                        DeleteDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteDetectionList);
                        DeleteDetectionCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteCurrencyList);
                        UpdateDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionList, basePrice.IdModifier);
                        UpdateDetectionCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionCurrencyList, basePrice.IdModifier);
                        AddDetectionsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, (uint)basePrice.IdModifier);
                        //change log/plantcurrency/cpl log/delete cpl items
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2140(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }


        public BasePrice GetBasePriceDetailById_V2140(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2090(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceListItemsCurrenciesById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Detection_CurrencyList = GetBasePriceListDetectionCurrenciesById(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2140(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<CurrencyConversion> GetCurrencyConversionsByCurrency_V2140(string WorkbenchConnectionString, UInt32 IdCurrency, DateTime CurrencyConversionDate)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsByCurrency_V2140", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrencyConversionFrom", IdCurrency);
                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", CurrencyConversionDate);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsByCurrency_V2140(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }

        public BasePrice GetBasePriceDetailById_ForCPL_V2140(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }

                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_PlantList = GetBasePriceListItemsPlantsById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Article_CurrencyList = GetBasePriceForCustomerPriceListById(PLMConnectionString, BasePrice.IdBasePriceList, BasePrice.IdCurrency);
                BasePrice.Article_CurrencyList_ForCPL = GetBasePriceListItemsCurrenciesById_V2110(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems_ForCPL = GetBasePriceListItemsById_ForCPL(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections_ForCPL = GetBasePriceListDetectionsById_ForCPL(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.Detection_CurrencyList = GetBasePriceOfDetectionForCustomerPriceListById(PLMConnectionString, BasePrice.IdBasePriceList, BasePrice.IdCurrency);
                BasePrice.Detection_CurrencyList_ForCPL = GetBasePriceListDetectionCurrenciesById(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2140(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }


        public List<CurrencyConversion> GetCurrencyConversionsMaxRate_V2140(string WorkbenchConnectionString)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsMaxRate_V2140", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsMaxRate_V2140(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }


        public List<CurrencyConversion> GetCurrencyConversionsMaxRate_ByPreviousDate_V2140(string WorkbenchConnectionString)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsMaxRate_ByPreviousDate_V2140", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsMaxRate_ByPreviousDate_V2140(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }

        public List<CurrencyConversion> GetCurrencyConversionsDetailsByDate(string WorkbenchConnectionString, DateTime dtCurrencyConversionDate)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsDetailsByDate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", dtCurrencyConversionDate);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsMaxRate_ByPreviousDate_V2140(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }

        //public bool CalculateArticleCostPrice_V2150(string connectionstring, string mainServerConnectionString, string WorkbenchContext)
        //{
        //    bool isCalculated = false;
        //    List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
        //    List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
        //    IList<Company> allPlants = GetEmdepSitesCompanies(connectionstring);
        //    List<Currency> allCurrency = GetAllCurrency(connectionstring);
        //    List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);

        //    List<Tuple<DateTime?, uint>> articleDateLst = null;
        //    string EWHQConnStr = GetEWHQDatabaseDetail(connectionstring);
        //    List<PODetail> EWHQpoDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail(EWHQConnStr);
        //    List<AdditionalArticleCost> additionalArticleCostLst = GetAdditionalArticleCostDetail(connectionstring);
        //    foreach (Company itemCompany in allPlants)
        //    {
        //        List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail(itemCompany.ConnectPlantConstr);
        //        foreach (UInt64 itemArticle in allPCMidsArticles)
        //        {
        //            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
        //            PODetail poDetail = null;
        //            try
        //            {
        //                poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
        //            }
        //            catch (Exception ex)
        //            {
        //                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
        //                poDetail = null;
        //            }

        //            if (poDetail == null)
        //            {
        //                PODetail poDetailEWHQ = null;
        //                try
        //                {
        //                    poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
        //                }
        //                catch (Exception ex)
        //                {
        //                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //                    poDetailEWHQ = null;
        //                }
        //                if (poDetailEWHQ == null)
        //                {

        //                }
        //                else
        //                {
        //                    articleCostPrice.IdArticle = itemArticle;
        //                    articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                    articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
        //                    articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
        //                    articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
        //                    if (!IsExistRecord(connectionstring, articleCostPrice))
        //                    {
        //                        if (additionalArticleCostLst != null && additionalArticleCostLst.Count > 0)
        //                        {
        //                            AdditionalArticleCost additionalArticleCost = additionalArticleCostLst.Where(aacl => aacl.IdSite == articleCostPrice.IdCompany).FirstOrDefault();
        //                            if (additionalArticleCost != null)
        //                            {
        //                                articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport + additionalArticleCost.Customs;
        //                                float transport = additionalArticleCost.Transport / 100;
        //                                float customs = additionalArticleCost.Customs / 100;

        //                                articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
        //                            }
        //                        }
        //                        articleCostPriceLst.Add(articleCostPrice);
        //                        if (articleDateLst == null)
        //                        {
        //                            articleDateLst = new List<Tuple<DateTime?, uint>>();
        //                        }
        //                        if (!articleDateLst.Any(adl => adl.Item1 == articleCostPrice.ExchangeRateDate && adl.Item2 == articleCostPrice.IdCurrency))
        //                        {
        //                            Tuple<DateTime?, uint> articleDates = new Tuple<DateTime?, uint>(articleCostPrice.ExchangeRateDate, articleCostPrice.IdCurrency);
        //                            articleDateLst.Add(articleDates);
        //                        }
        //                    }
        //                }
        //            }
        //            else
        //            {
        //                if (poDetail.IsEmdep != 1)
        //                {
        //                    articleCostPrice.IdArticle = itemArticle;
        //                    articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                    articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
        //                    articleCostPrice.IdCurrency = poDetail.IdCurrency;
        //                    articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
        //                    if (!IsExistRecord(connectionstring, articleCostPrice))
        //                    {
        //                        articleCostPriceLst.Add(articleCostPrice);
        //                        if (articleDateLst == null)
        //                        {
        //                            articleDateLst = new List<Tuple<DateTime?, uint>>();
        //                        }
        //                        if (!articleDateLst.Any(adl => adl.Item1 == articleCostPrice.ExchangeRateDate && adl.Item2 == articleCostPrice.IdCurrency))
        //                        {
        //                            Tuple<DateTime?, uint> articleDates = new Tuple<DateTime?, uint>(articleCostPrice.ExchangeRateDate, articleCostPrice.IdCurrency);
        //                            articleDateLst.Add(articleDates);
        //                        }
        //                    }
        //                }
        //                else
        //                {
        //                    PODetail poDetailEWHQ = null;
        //                    try
        //                    {
        //                        poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
        //                    }
        //                    catch (Exception ex)
        //                    {
        //                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //                        poDetailEWHQ = null;
        //                    }

        //                    if (poDetailEWHQ == null)
        //                    {

        //                    }
        //                    else
        //                    {
        //                        articleCostPrice.IdArticle = itemArticle;
        //                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                        articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
        //                        articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
        //                        articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
        //                        if (!IsExistRecord(connectionstring, articleCostPrice))
        //                        {
        //                            articleCostPriceLst.Add(articleCostPrice);
        //                            if (articleDateLst == null)
        //                            {
        //                                articleDateLst = new List<Tuple<DateTime?, uint>>();
        //                            }
        //                            if (!articleDateLst.Any(adl => adl.Item1 == articleCostPrice.ExchangeRateDate && adl.Item2 == articleCostPrice.IdCurrency))
        //                            {
        //                                Tuple<DateTime?, uint> articleDates = new Tuple<DateTime?, uint>(articleCostPrice.ExchangeRateDate, articleCostPrice.IdCurrency);
        //                                articleDateLst.Add(articleDates);
        //                            }
        //                        }
        //                    }
        //                }
        //            }
        //        }
        //    }

        //    List<DailyCurrencyConversion> dailyCurrencyConversionLst = new List<DailyCurrencyConversion>();
        //    if (articleDateLst == null && articleDateLst.Count > 0)
        //    {
        //        List<DailyCurrencyConversion> allDailyCurrencyConversionLst = new List<DailyCurrencyConversion>();
        //        allDailyCurrencyConversionLst = GetCurrencyRateByDateAndId(WorkbenchContext, articleDateLst.Min(adl => adl.Item1.Value), articleDateLst.Max(adl => adl.Item1.Value));
        //        foreach (Tuple<DateTime?, uint> item in articleDateLst)
        //        {
        //            dailyCurrencyConversionLst.AddRange(allDailyCurrencyConversionLst.Where(adccl => adccl.CurrencyConversionDate.Date == item.Item1.Value.Date && adccl.IdCurrencyConversionFrom == Convert.ToByte(item.Item2)).ToList());
        //        }

        //    }

        //    if (articleDateLst == null && articleDateLst.Count > 0)
        //        foreach (ArticleCostPrice item in articleCostPriceLst)
        //        {
        //            foreach (Currency itemCurrency in allCurrency.Where(a => a.IdCurrency != item.IdCurrency))
        //            {
        //                DailyCurrencyConversion dailyCurrencyConversionTO = dailyCurrencyConversionLst.Where(dcc => dcc.IdCurrencyConversionTo == itemCurrency.IdCurrency && dcc.IdCurrencyConversionFrom == item.IdCurrency && dcc.CurrencyConversionDate.Date == item.ExchangeRateDate.Value.Date).FirstOrDefault();
        //                if (dailyCurrencyConversionTO != null)
        //                {
        //                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
        //                    articleCostPrice.IdArticle = item.IdArticle;
        //                    articleCostPrice.ExchangeRateDate = item.ExchangeRateDate;
        //                    articleCostPrice.IdCompany = Convert.ToUInt32(item.IdCompany);
        //                    articleCostPrice.ArticleCostValue = item.ArticleCostValue * dailyCurrencyConversionTO.CurrencyConversationRate;
        //                    articleCostPrice.IdCurrency = itemCurrency.IdCurrency;
        //                    articleCostPriceLstForAllCompanies.Add(articleCostPrice);
        //                }
        //            }
        //        }

        //    if (articleCostPriceLstForAllCompanies.Count > 0)
        //        articleCostPriceLst.AddRange(articleCostPriceLstForAllCompanies);


        //    //  List<ArticleCostPrice> finalarticleCostPrice = articleCostPriceLst;
        //    //   int lstCnt = articleCostPriceLst.Count();

        //    if (articleCostPriceLst != null && articleCostPriceLst.Count > 0)
        //    {
        //        foreach (ArticleCostPrice item in articleCostPriceLst)
        //        {
        //            //for (int i = 1000; i <= lstCnt;)
        //            //{
        //            //    lstCnt = lstCnt - 1000;
        //            //    articleCostPriceLst = finalarticleCostPrice.Take(i).ToList();



        //            //var xEle = new XElement("ArticleCostPrices",
        //            //  from articleCostPrice in articleCostPriceLst
        //            //  select new XElement("article_cost_price",
        //            //               new XElement("IdArticle", articleCostPrice.IdArticle),
        //            //                 new XElement("IdCompany", articleCostPrice.IdCompany),
        //            //                 new XElement("IdCurrency", articleCostPrice.IdCurrency),
        //            //                 new XElement("ArticleCostValue", articleCostPrice.ArticleCostValue),
        //            //                 new XElement("ExchangeRateDate", articleCostPrice.ExchangeRateDate)));




        //            try
        //            {
        //                //using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
        //                //{
        //                //    mySqlConnection.Open();
        //                //    MySqlCommand mySqlCommand = new MySqlCommand("PLM_insertupdateArticleCostPrice", mySqlConnection);
        //                //    mySqlCommand.CommandType = CommandType.StoredProcedure;
        //                //    mySqlCommand.CommandTimeout = 3000;

        //                //    mySqlCommand.Parameters.AddWithValue("ArticleCostPricedetailxml", xEle);

        //                //    mySqlCommand.ExecuteNonQuery();
        //                //    mySqlConnection.Close();

        //                //}
        //                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
        //                {
        //                    mySqlConnection.Open();
        //                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice", mySqlConnection);
        //                    mySqlCommand.CommandType = CommandType.StoredProcedure;
        //                    mySqlCommand.CommandTimeout = 3000;

        //                    mySqlCommand.Parameters.AddWithValue("_IdArticle", item.IdArticle);
        //                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", item.ArticleCostValue);
        //                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
        //                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
        //                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", item.ExchangeRateDate);
        //                    mySqlCommand.Parameters.AddWithValue("_IdCompany", item.IdCompany);
        //                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", item.IdCurrency);
        //                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
        //                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

        //                    mySqlCommand.ExecuteNonQuery();
        //                    mySqlConnection.Close();

        //                }

        //                isCalculated = true;
        //            }
        //            catch (Exception ex)
        //            {

        //                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

        //                isCalculated = false;
        //                throw;
        //            }
        //            //if(finalarticleCostPrice.Count>=1000)
        //            //finalarticleCostPrice.RemoveRange(0, 1000);
        //            //else
        //            //{
        //            //    finalarticleCostPrice.RemoveRange(0, finalarticleCostPrice.Count()-1);
        //            //}
        //            //i = 1000;
        //            //if (i > lstCnt)
        //            //{
        //            //    i = lstCnt;
        //            //}
        //        }

        //    }
        //    return isCalculated;
        //}


        public List<AdditionalArticleCost> GetAdditionalArticleCostDetail(string connectionstring)
        {
            List<AdditionalArticleCost> LstAdditionalArticleCost = new List<AdditionalArticleCost>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("PLM_GetAdditionalArticleCost", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader reader = consitecommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        AdditionalArticleCost additionalArticleCost = new AdditionalArticleCost();
                        if (reader["IdSite"] != DBNull.Value)
                            additionalArticleCost.IdSite = Convert.ToInt32(reader["IdSite"]);
                        if (reader["Transport"] != DBNull.Value)
                            additionalArticleCost.Transport = (float)reader["Transport"];
                        if (reader["Customs"] != DBNull.Value)
                            additionalArticleCost.Customs = (float)reader["Customs"];

                        LstAdditionalArticleCost.Add(additionalArticleCost);
                    }
                }
            }
            return LstAdditionalArticleCost;
        }




        #region V2150
        public BasePrice AddBasePrice_V2150(BasePrice basePrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            basePrice.Code = lastestBasePriceCode;
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.IdCreator);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, basePrice.IdCreator);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }




        public bool UpdateBasePrice_V2150(BasePrice basePrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        //information plant and currency
                        AddDeletePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.CurrencyList, basePrice.DeletePlantList, basePrice.AddPlantList, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.AddCurrencyList, basePrice.DeleteCurrencyList, basePrice.IdModifier);
                        //articles
                        DeleteArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteArticleList);
                        UpdateArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateArticleList, basePrice.IdModifier);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddArticleList, (uint)basePrice.IdModifier);
                        //detections
                        DeleteDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteDetectionList);
                        UpdateDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionList, basePrice.IdModifier);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, (uint)basePrice.IdModifier);
                        //change log/plantcurrency/cpl log/delete cpl items
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2140(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }

        public void DeleteArticlesByBasePrice_V2150(string MainServerConnectionString, UInt64 IdBasePriceList, List<Articles> ArticleList)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Articles Article in ArticleList)
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_articles_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticlesByBasePrice_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesByBasePrice_V2150(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, UInt32? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        ArticleList = ArticleList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (BasePriceListByItem Article in ArticleList.Distinct())
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_articles_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Article.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                                Article.RuleValue_New = Article.RuleValue;
                                if (Article.IdRule == 1518)
                                {
                                    Article.RuleValue_New = 0;
                                }
                                else if (Article.IdRule == 308)
                                {
                                    if (Article.RuleValue_New == 0)
                                    {
                                        Article.RuleValue_New = 0;
                                    }
                                }
                                else
                                {
                                    if (Article.IdRule == 0)
                                    {
                                        Article.RuleValue_New = null;
                                    }
                                }
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_version", Article.Version);
                                mySqlCommand.Parameters.AddWithValue("_Royalty", Article.Royalty);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByBasePrice_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void DeleteDetectionsByBasePrice_V2150(string MainServerConnectionString, UInt64 IdBasePriceList, List<Detections> DetectionList)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Detections Detection in DetectionList)
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_detections_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetections);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionsByBasePrice_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void UpdateDetectionsByBasePrice_V2150(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> DetectionList, UInt32? IdModifier)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        DetectionList = DetectionList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (BasePriceListByItem Detection in DetectionList.Distinct())
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_detections_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetection);
                                mySqlCommand.Parameters.AddWithValue("_MaxCost", Detection.MaxCost);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Detection.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Detection.IdRule);
                                Detection.RuleValue_New = Detection.RuleValue;
                                if (Detection.IdRule == 1518)
                                {
                                    Detection.RuleValue_New = 0;
                                }
                                else if (Detection.IdRule == 308)
                                {
                                    if (Detection.RuleValue_New == 0)
                                    {
                                        Detection.RuleValue_New = 0;
                                    }
                                }
                                else
                                {
                                    if (Detection.IdRule == 0)
                                    {
                                        Detection.RuleValue_New = null;
                                    }
                                }
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Detection.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_version", Detection.Version);
                                mySqlCommand.Parameters.AddWithValue("_Royalty", Detection.Royalty);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateDetectionsByBasePrice_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public BasePrice GetBasePriceDetailById_V2150(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2150(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById_V2150(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.ArticleCostPriceListForSavedBPL = GetBPLArticleCostPricesByCurrency(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<ArticleCostPrice> GetBPLArticleCostPricesByCurrency(string PLMConnectionString, UInt32 IdCurrency, UInt64 IdBasePriceList)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBPLArticleCostPricesByCurrency", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBPLArticleCostPricesByCurrency(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }


        public List<ArticleCostPrice> GetCPLArticleCostPricesByCurrency(string PLMConnectionString, UInt32 IdCurrency, UInt64 IdCustomerPriceList)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCPLArticleCostPricesByCurrency", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCPLArticleCostPricesByCurrency(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }

        public List<BasePriceListByItem> GetBasePriceListItemsById_V2150(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_articles_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                BasePriceListByItem.ArticleData = new Articles();
                                BasePriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                BasePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsById_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }


        public List<BasePriceListByItem> GetBasePriceListDetectionsById_V2150(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_detections_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                BasePriceListByItem.Detection = new Detections();
                                BasePriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionCode"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.Code = Convert.ToString(reader["DetectionCode"]);
                                }
                                if (reader["DetectionName"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.Name = Convert.ToString(reader["DetectionName"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    BasePriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                BasePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListDetectionsById_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }


        public List<BasePrice> GetBasePrices_V2150(string PLMConnectionString)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceList_V2150", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                List<string> tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePrices_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return basePrices;
        }


        public CustomerPrice AddCustomerPrice_V2150(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdCreator);
                        AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        AddCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, customerPrice.IdCreator);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }




        public void AddSaleCurrenciesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Currency> CurrencyList, UInt32? IdCreator)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList.Distinct())
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_currency_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.ExecuteNonQuery();

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSaleCurrenciesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }



        public bool IsDeletedCustomerPriceList_Articles(UInt64 idCustomerPriceList, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idCustomerPriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_articles_AllDelete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCustomerPriceList_Articles(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public bool IsDeletedCustomerPriceList_Detections(UInt64 idCustomerPriceList, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idCustomerPriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_detections_AllDelete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCustomerPriceList_Detections(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public bool IsDeletedCustomerPriceList_Currencies(UInt64 idCustomerPriceList, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idCustomerPriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_currency_AllDelete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCustomerPriceList_Currencies(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }
        public void DeleteSaleCurrenciesByCustomerPrice(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Currency> CurrencyList)
        {
            try
            {
                if (CurrencyList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Currency currency in CurrencyList)
                        {
                            if (currency.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_currency_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListCurrency", currency.IdCurrency);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteSaleCurrenciesByCustomerPrice(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void DeleteArticlesByCustomerPrice_V2150(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Articles> ArticleList)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Articles Article in ArticleList)
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_articles_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticlesByCustomerPrice_V2150(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateArticlesByCustomerPrice_V2150(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, UInt32? IdModifier)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            if (Article.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_articles_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                                if (Article.ItemCustomerDescription != null)
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                                else
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);

                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                                if (Article.BasePriceListValue == 0)
                                {
                                    Article.BasePriceListValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);

                                if (Article.IdRule_New == 1518)
                                {
                                    Article.RuleValue_New = 0;
                                }
                                else if (Article.IdRule_New == 308)
                                {
                                    if (Article.RuleValue_New == 0)
                                    {
                                        Article.RuleValue_New = 0;
                                    }
                                }
                                else
                                {
                                    if (Article.IdRule_New == 0)
                                    {
                                        Article.IdRule_New = null;
                                        Article.RuleValue_New = null;
                                    }
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule_New);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Article.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Article.LinkedDescription);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticlesByCustomerPrice_V2150(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void DeleteDetectionsByCustomerPrice_V2150(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<Detections> DetectionList)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Detections Detection in DetectionList)
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_detections_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetections);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionsByCustomerPrice_V2150(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateDetectionsByCustomerPrice_V2150(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> DetectionList, UInt32? IdModifier)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Detection in DetectionList.Distinct())
                        {
                            if (Detection.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_detections_Update", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetection);
                                if (Detection.ItemCustomerDescription != null)
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription.Trim());
                                else
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription);

                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Detection.VisibleToCustomer);
                                if (Detection.BasePriceListValue == 0)
                                {
                                    Detection.BasePriceListValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Detection.BasePriceListValue);
                                if (Detection.IdRule_New == 1518)
                                {
                                    Detection.RuleValue_New = 0;
                                }
                                else if (Detection.IdRule_New == 308)
                                {
                                    if (Detection.RuleValue_New == 0)
                                    {
                                        Detection.RuleValue_New = 0;
                                    }
                                }
                                else
                                {
                                    if (Detection.IdRule_New == 0)
                                    {
                                        Detection.IdRule_New = null;
                                        Detection.RuleValue_New = null;
                                    }
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Detection.IdRule_New);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Detection.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Detection.LinkedDescription);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Detection.CurrencyConversionDate_New);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateDetectionsByCustomerPrice_V2150(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public CustomerPrice GetCustomerPricesById_V2150(string PLMConnectionString, UInt64 idCustomerPriceList)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CurrencyList = GetCurrenciesByIdCustomerPrice_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListDetections = GetCustomerPriceListDetectionsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.ArticleCostPriceListForSavedCPL = GetCPLArticleCostPricesByCurrency(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2150(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }

        public List<Currency> GetCurrenciesByIdCustomerPrice_V2150(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<Currency> Currencies = new List<Currency>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_currency_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["BasePriceListCurrency"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["Name"]);
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrenciesByIdCustomerPrice_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return Currencies;
        }

        public List<CustomerPriceListByItem> GetCustomerPriceListItemsById_V2150(string WorkbenchConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_articles_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                CustomerPriceListByItem.ArticleData = new Articles();
                                CustomerPriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                    CustomerPriceListByItem.ArticleData.Description_es = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["ItemCustomerDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.ItemCustomerDescription = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                                CustomerPriceListByItem.ItemCustomerDescription_Old = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                            }
                            if (reader["VisibleToCustomer"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.VisibleToCustomer = Convert.ToByte(reader["VisibleToCustomer"]);
                            }
                            if (reader["BasePriceListValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.BasePriceListValue = float.Parse(reader["BasePriceListValue"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                                CustomerPriceListByItem.IdRule_New = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                                CustomerPriceListByItem.RuleValue_New = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["LinkedDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.LinkedDescription = Convert.ToByte(reader["LinkedDescription"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItemsById_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }

        public List<CustomerPriceListByItem> GetCustomerPriceListDetectionsById_V2150(string WorkbenchConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_detections_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                CustomerPriceListByItem.Detection = new Detections();
                                CustomerPriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Code = Convert.ToString(reader["DetectionRef"]);
                                }
                                if (reader["DetectionDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Description = Convert.ToString(reader["DetectionDesc"]);
                                    CustomerPriceListByItem.Detection.Description_es = Convert.ToString(reader["DetectionDesc"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    CustomerPriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                            }
                            if (reader["ItemCustomerDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.ItemCustomerDescription = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                                CustomerPriceListByItem.ItemCustomerDescription_Old = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                            }
                            if (reader["VisibleToCustomer"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.VisibleToCustomer = Convert.ToByte(reader["VisibleToCustomer"]);
                            }
                            if (reader["BasePriceListValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.BasePriceListValue = float.Parse(reader["BasePriceListValue"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["LinkedDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.LinkedDescription = Convert.ToByte(reader["LinkedDescription"]);
                            }

                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListDetectionsById_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }


        public List<CustomerPriceListByItem> GetBasePriceListItemsById_ForCPL_V2150(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_articles_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                CustomerPriceListByItem.ArticleData = new Articles();
                                CustomerPriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                    CustomerPriceListByItem.ArticleData.Description_es = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }

                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsById_ForCPL_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }


        public List<CustomerPriceListByItem> GetBasePriceListDetectionsById_ForCPL_V2150(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_detections_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                CustomerPriceListByItem.Detection = new Detections();
                                CustomerPriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionCode"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Code = Convert.ToString(reader["DetectionCode"]);
                                }
                                if (reader["DetectionName"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Name = Convert.ToString(reader["DetectionName"]);
                                    CustomerPriceListByItem.Detection.Name_es = Convert.ToString(reader["DetectionName"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    CustomerPriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListDetectionsById_ForCPL_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }
        public BasePrice GetBasePriceDetailById_ForCPL_V2150(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            BasePrice BasePrice = new BasePrice();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }

                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListItems_ForCPL = GetBasePriceListItemsById_ForCPL_V2150(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections_ForCPL = GetBasePriceListDetectionsById_ForCPL_V2150(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.ArticleCostPriceListForSavedBPL = GetBPLArticleCostPricesByCurrency(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }




        public bool UpdateCustomerPrice_V2150(CustomerPrice customerPrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceList_Articles(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Detections(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Currencies(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdModifier);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdModifier);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, (uint)customerPrice.IdModifier);
                        }
                        else
                        {
                            //Sale currencies
                            DeleteSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteCurrencyList);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddCurrencyList, (uint)customerPrice.IdModifier);

                            //articles
                            DeleteArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteArticleList);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddArticleList, (uint)customerPrice.IdModifier);
                            UpdateArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateArticleList, customerPrice.IdModifier);

                            //detections
                            DeleteDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteDetectionList);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddDetectionList, (uint)customerPrice.IdModifier);
                            UpdateDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateDetectionList, customerPrice.IdModifier);
                        }
                        AddUpdateDeleteCustomersByCPL_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }


        public List<CustomerPrice> GetCustomerPrices_V2150(string PLMConnectionString)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceList_V2150", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]).Trim();

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                List<string> tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                customerPrice.SaleCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }

                            if (reader["CustGroup"] != DBNull.Value)
                            {
                                List<string> tempDifferentGroup = Convert.ToString(reader["CustGroup"]).Split('\n').ToList<string>();
                                tempDifferentGroup = tempDifferentGroup.Distinct().ToList();
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        tempDifferentGroup.Add("ALL");
                                }
                                customerPrice.Group = string.Join("\n", tempDifferentGroup.ToArray());
                            }
                            else
                            {
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        customerPrice.Group = "ALL";
                                }
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                customerPrice.Country = customerPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        customerPrice.Country = "ALL";
                                }
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempDifferentRegionName = Convert.ToString(reader["RegionName"]).Split('\n').ToList<string>();
                                tempDifferentRegionName = tempDifferentRegionName.Distinct().ToList();

                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        tempDifferentRegionName.Add("ALL");
                                }

                                customerPrice.Region = customerPrice.Region + string.Join("\n", tempDifferentRegionName.ToArray());
                            }
                            else
                            {
                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        customerPrice.Region = "ALL";
                                }
                            }

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlantName = Convert.ToString(reader["PlantName"]).Split('\n').ToList<string>();
                                tempDifferentPlantName = tempDifferentPlantName.Distinct().ToList();
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        tempDifferentPlantName.Add("ALL");
                                }
                                customerPrice.Plant = customerPrice.Plant + string.Join("\n", tempDifferentPlantName.ToArray());
                            }
                            else
                            {
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        customerPrice.Plant = "ALL";
                                }
                            }

                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPrices_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPrices;
        }



        public void AddArticlesByBasePrice_V2150(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ArticleList, UInt32 IdCreator)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem Article in ArticleList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_articles_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                            mySqlCommand.Parameters.AddWithValue("_MaxCost", Article.MaxCost);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Article.CurrencyConversionDate_New);
                            Article.RuleValue_New = Article.RuleValue;
                            if (Article.IdRule == 1518)
                            {
                                Article.RuleValue_New = 0;
                            }
                            else if (Article.IdRule == 308)
                            {
                                if (Article.RuleValue_New == 0)
                                {
                                    Article.RuleValue_New = null;
                                }
                            }
                            else
                            {
                                if (Article.IdRule == 0)
                                {
                                    Article.RuleValue_New = null;
                                }
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue_New);
                            mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                            mySqlCommand.Parameters.AddWithValue("_Royalty", Article.Royalty);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByBasePrice_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDetectionsByBasePrice_V2150(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> DetectionList, UInt32 IdCreator)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem detection in DetectionList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_detections_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", detection.IdDetection);
                            mySqlCommand.Parameters.AddWithValue("_MaxCost", detection.MaxCost);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", detection.CurrencyConversionDate_New);
                            mySqlCommand.Parameters.AddWithValue("_IdRule", detection.IdRule);
                            detection.RuleValue_New = detection.RuleValue;
                            if (detection.IdRule == 1518)
                            {
                                detection.RuleValue_New = 0;
                            }
                            else if (detection.IdRule == 308)
                            {
                                if (detection.RuleValue_New == 0)
                                {
                                    detection.RuleValue_New = null;
                                }
                            }
                            else
                            {
                                if (detection.IdRule == 0)
                                {
                                    detection.RuleValue_New = null;
                                }
                            }
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", detection.RuleValue_New);
                            mySqlCommand.Parameters.AddWithValue("_Version", detection.Version);
                            mySqlCommand.Parameters.AddWithValue("_Royalty", detection.Royalty);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByBasePrice_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddArticlesByCustomerPrice_V2150(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ArticleList, UInt32? IdCreator)
        {
            try
            {
                if (ArticleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Article in ArticleList.Distinct())
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_articles_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdArticle", Article.IdArticle);
                            if (Article.ItemCustomerDescription != null)
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription.Trim());
                            else
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Article.ItemCustomerDescription);

                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Article.VisibleToCustomer);
                            if (Article.BasePriceListValue == 0)
                            {
                                Article.BasePriceListValue = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Article.BasePriceListValue);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Article.CurrencyConversionDate_New);
                            if (Article.IdRule_New == 1518)
                            {
                                Article.RuleValue_New = 0;
                            }
                            else if (Article.IdRule_New == 308)
                            {
                                if (Article.RuleValue_New == 0)
                                {
                                    Article.RuleValue_New = null;
                                }
                            }
                            else
                            {
                                if (Article.IdRule_New == 0)
                                {
                                    Article.IdRule_New = null;
                                    Article.RuleValue_New = null;
                                }
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRule", Article.IdRule_New);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", Article.RuleValue_New);
                            if (Article.SellPrice_New == 0)
                            {
                                Article.SellPrice_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_Version", Article.Version);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Article.LinkedDescription);
                            mySqlCommand.ExecuteNonQuery();

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddArticlesByCustomerPrice_V2150(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddDetectionsByCustomerPrice_V2150(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> DetectionList, UInt32? IdCreator)
        {
            try
            {
                if (DetectionList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Detection in DetectionList.Distinct())
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_detections_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdDetection", Detection.IdDetection);
                            if (Detection.ItemCustomerDescription != null)
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription.Trim());
                            else
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Detection.ItemCustomerDescription);

                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Detection.VisibleToCustomer);
                            if (Detection.BasePriceListValue == 0)
                            {
                                Detection.BasePriceListValue = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Detection.BasePriceListValue);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Detection.CurrencyConversionDate_New);
                            if (Detection.IdRule_New == 1518)
                            {
                                Detection.RuleValue_New = 0;
                            }
                            else if (Detection.IdRule_New == 308)
                            {
                                if (Detection.RuleValue_New == 0)
                                {
                                    Detection.RuleValue_New = null;
                                }
                            }
                            else
                            {
                                if (Detection.IdRule_New == 0)
                                {
                                    Detection.IdRule_New = null;
                                    Detection.RuleValue_New = null;
                                }
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRule", Detection.IdRule_New);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", Detection.RuleValue_New);
                            if (Detection.SellPrice_New == 0)
                            {
                                Detection.SellPrice_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_Version", Detection.Version);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Detection.LinkedDescription);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByCustomerPrice_V2150(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        #endregion


        public List<PCMArticleCategory> GetPCMArticlesWithCategory_V2160(string PLMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PLMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Description"]);
                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            if (reader["StatusAbbreviation"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]); ;
                            }
                            if (reader["StatusHtmlColor"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]); ;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategory_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        public List<PCMArticleCategory> GetPCMArticlesWithCategoryForReference_V2160(string PCMConnectionString)
        {
            List<PCMArticleCategory> pcmArticlesWithCategoryList = new List<PCMArticleCategory>();
            try
            {
                pcmArticlesWithCategoryList = GetPCMArticleCategories(PCMConnectionString);
                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PCMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllPCMArticles_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PCMArticleCategory pcmArticlesWithCategory = new PCMArticleCategory();
                            pcmArticlesWithCategory.KeyName = Convert.ToString(i);
                            pcmArticlesWithCategory.IdPCMArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                            pcmArticlesWithCategory.CategoryName = Convert.ToString(reader["CategoryName"]);

                            pcmArticlesWithCategory.IdPCMArticle = Convert.ToUInt32(reader["IdPCMArticle"]);
                            pcmArticlesWithCategory.IdArticle = Convert.ToUInt32(reader["IdArticle"]);

                            if (reader["Reference"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.Reference = Convert.ToString(reader["Reference"]);
                                pcmArticlesWithCategory.Name = Convert.ToString(reader["Reference"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {

                                pcmArticlesWithCategory.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["BPL_IdArticle"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.IsBPLArticle = true;
                            }
                            if (reader["StatusAbbreviation"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]); ;
                            }
                            if (reader["StatusHtmlColor"] != DBNull.Value)
                            {
                                pcmArticlesWithCategory.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]); ;
                            }
                            pcmArticlesWithCategoryList.Add(pcmArticlesWithCategory);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPCMArticlesWithCategoryForReference_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return pcmArticlesWithCategoryList;
        }


        public List<BPLDetection> GetAllDetections_V2160(string PLMConnectionString)
        {
            List<BPLDetection> DetectionList = new List<BPLDetection>();
            try
            {
                DetectionList.AddRange(GetAllDetectionTypes(PLMConnectionString));
                DetectionList.AddRange(GetAllDetectionGroups(PLMConnectionString));

                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllDetections_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BPLDetection detection = new BPLDetection();
                            detection.KeyName = Convert.ToString(i);
                            detection.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            detection.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                detection.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detection.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                detection.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }
                            if (reader["DetectionTypeName"] != DBNull.Value)
                            {
                                detection.DetectionTypeName = Convert.ToString(reader["DetectionTypeName"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                detection.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["StatusAbbreviation"] != DBNull.Value)
                            {
                                detection.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                            }
                            if (reader["StatusHtmlColor"] != DBNull.Value)
                            {
                                detection.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                            }
                            DetectionList.Add(detection);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetections_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionList;
        }


        public BasePrice GetBasePriceDetailById_V2160(string PLMConnectionString, UInt64 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            string Icon = "";
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }

                                    // customerPrices.Where(cp => cp.Currency.Name == item).ToList().ForEach(cp => cp.Currency.CurrencyIconbytes = bytes);
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                //   BasePrice.CurrencyConversionsForBPLArticlesSaved = GetCurrencyConversionRatesByBPLArticleDates(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
                //    BasePrice.CurrencyConversionsForBPLDetectionsSaved = GetCurrencyConversionRatesByBPLDetectionDates(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
                //BasePrice.ArticleCostPriceListForSavedBPL = GetBPLArticleCostPricesByCurrency(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2160(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<Currency> GetCurrenciesByIdBasePrice_V2160(string PLMConnectionString, UInt64 IdBasePriceList, string currencyIconFilePath)
        {
            List<Currency> Currencies = new List<Currency>();
            List<string> CurrencyIcon = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceCurrenciesById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["Name"]);

                                if (!CurrencyIcon.Any(co => co.ToString() == Currency.Name))
                                {
                                    CurrencyIcon.Add(Currency.Name);
                                }
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrenciesByIdBasePrice_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }
                Currencies.Where(ma => ma.Name == item).ToList().ForEach(ma => ma.CurrencyIconbytes = bytes);
            }
            return Currencies;
        }

        public List<BasePriceListByItem> GetBasePriceListItemsById_V2160(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_articles_Get_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                BasePriceListByItem.ArticleData = new Articles();
                                BasePriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                                    BasePriceListByItem.ArticleData.PcmArticleCategory.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                BasePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsById_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }


        public List<BasePriceListByItem> GetBasePriceListDetectionsById_V2160(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_detections_Get_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                BasePriceListByItem.Detection = new Detections();
                                BasePriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionCode"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.Code = Convert.ToString(reader["DetectionCode"]);
                                }
                                if (reader["DetectionName"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.Name = Convert.ToString(reader["DetectionName"]);
                                }
                                if (reader["StatusAbbreviation"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                                }
                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    BasePriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    BasePriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                BasePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListDetectionsById_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }


        public BasePrice GetBasePriceDetailById_ForCPL_V2160(string PLMConnectionString, UInt64 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }

                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);

                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath);
                BasePrice.BasePriceListItems_ForCPL = GetBasePriceListItemsById_ForCPL_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections_ForCPL = GetBasePriceListDetectionsById_ForCPL_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                // BasePrice.CurrencyConversionsForBPLArticlesSaved = GetCurrencyConversionRatesByBPLArticleDates(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
                // BasePrice.CurrencyConversionsForBPLDetectionsSaved = GetCurrencyConversionRatesByBPLDetectionDates(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
                //BasePrice.ArticleCostPriceListForSavedBPL = GetBPLArticleCostPricesByCurrency(PLMConnectionString, BasePrice.IdCurrency, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2160(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<CustomerPriceListByItem> GetBasePriceListItemsById_ForCPL_V2160(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_articles_Get_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                                CustomerPriceListByItem.ArticleData = new Articles();
                                CustomerPriceListByItem.ArticleData.IdArticle = Convert.ToUInt32(reader["IdArticle"]);
                                if (reader["ArticleRef"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Reference = Convert.ToString(reader["ArticleRef"]);
                                }
                                if (reader["ArticleDesc"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.Description = Convert.ToString(reader["ArticleDesc"]);
                                    CustomerPriceListByItem.ArticleData.Description_es = Convert.ToString(reader["ArticleDesc"]);
                                }
                                if (reader["IdPCMArticleCategory"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory = new PCMArticleCategory();
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.IdArticleCategory = Convert.ToUInt32(reader["IdPCMArticleCategory"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.Name = Convert.ToString(reader["CategoryName"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                                    CustomerPriceListByItem.ArticleData.PcmArticleCategory.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }

                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItemsById_ForCPL_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }

        public List<CustomerPriceListByItem> GetBasePriceListDetectionsById_ForCPL_V2160(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_detections_Get_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();
                            if (reader["IdDetection"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                                CustomerPriceListByItem.Detection = new Detections();
                                CustomerPriceListByItem.Detection.IdDetections = Convert.ToUInt32(reader["IdDetection"]);
                                if (reader["DetectionCode"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Code = Convert.ToString(reader["DetectionCode"]);
                                }
                                if (reader["DetectionName"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.Name = Convert.ToString(reader["DetectionName"]);
                                    CustomerPriceListByItem.Detection.Name_es = Convert.ToString(reader["DetectionName"]);
                                }
                                if (reader["DetectionType"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.DetectionTypes = new DetectionTypes();
                                    CustomerPriceListByItem.Detection.DetectionTypes.Name = Convert.ToString(reader["DetectionType"]);
                                }
                                if (reader["StatusAbbreviation"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                                }
                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.Detection.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }
                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListDetectionsById_ForCPL_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CustomerPriceListByItems;
        }

        public List<ArticlesByArticle> GetAllArticlesByArticle(string connectionstring)
        {
            List<ArticlesByArticle> articlesByArticleLst = new List<ArticlesByArticle>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetAllArticlesByArticle", con);
                concommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticlesByArticle articlesByArticle = new ArticlesByArticle();
                        if (reader["idArticle"] != DBNull.Value)
                            articlesByArticle.IdArticle = Convert.ToInt32(reader["idArticle"]);

                        if (reader["idComponent"] != DBNull.Value)
                            articlesByArticle.IdComponent = Convert.ToInt32(reader["idComponent"]);
                        if (reader["Quantity"] != DBNull.Value)
                            articlesByArticle.Quantity = (float)reader["Quantity"];

                        articlesByArticleLst.Add(articlesByArticle);
                    }
                }
            }
            return articlesByArticleLst;
        }

        //public bool CalculateArticleCostPrice_V2160(string connectionstring, string mainServerConnectionString, string workbenchConnectionString)
        //{
        //    bool isCalculated = false;
        //    List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
        //    List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
        //    IList<Company> allPlants = GetEmdepSitesCompanies(connectionstring);
        //    //List<Currency> allCurrency = GetAllCurrency(connectionstring);
        //    List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);


        //    string EWHQConnStr = GetEWHQDatabaseDetail(connectionstring);
        //    List<PODetail> EWHQpoDetailLst = GetAllPCMArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr);
        //    List<PODetail> EWHQArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromEWHQ(EWHQConnStr);
        //    List<ArticlesByArticle> LstAllArticlesByArticle = GetAllArticlesByArticle(connectionstring);
        //    List<UInt64> idArticelNotHavingCost = new List<UInt64>();
        //    foreach (Company itemCompany in allPlants)
        //    {
        //        try
        //        {

        //            List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail(itemCompany.ConnectPlantConstr);
        //            List<PODetail> ArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromPlant(itemCompany.ConnectPlantConstr);
        //            // allPCMidsArticles.Where(pa => pa == 6951)
        //            foreach (UInt64 itemArticle in allPCMidsArticles)
        //            {
        //                try
        //                {

        //                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
        //                    PODetail poDetail = null;
        //                    try
        //                    {
        //                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
        //                    }
        //                    catch (Exception ex)
        //                    {
        //                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
        //                        poDetail = null;
        //                    }

        //                    if (poDetail == null)
        //                    {
        //                        PODetail poDetailEWHQ = null;
        //                        try
        //                        {
        //                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
        //                        }
        //                        catch (Exception ex)
        //                        {
        //                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //                            poDetailEWHQ = null;
        //                        }
        //                        if (poDetailEWHQ == null)
        //                        {
        //                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
        //                            {
        //                                //List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));
        //                                List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
        //                                FinalArticleCostValue = 0;
        //                                ExchangeRateDate = DateTime.MinValue;
        //                                IdCurrency = 0;
        //                                if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
        //                                {
        //                                    CalculateComponentArticleCost(LstArticlesByArticle, itemCompany, workbenchConnectionString, EWHQConnStr, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst);
        //                                    if (FinalArticleCostValue > 0)
        //                                    {
        //                                        articleCostPrice.IdArticle = itemArticle;
        //                                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                                        articleCostPrice.ArticleCostValue = FinalArticleCostValue;
        //                                        articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
        //                                        articleCostPrice.ExchangeRateDate = ExchangeRateDate;
        //                                        if (!IsExistRecord(connectionstring, articleCostPrice))
        //                                        {
        //                                            articleCostPriceLst.Add(articleCostPrice);

        //                                        }
        //                                    }
        //                                }
        //                            }
        //                        }
        //                        else
        //                        {
        //                            articleCostPrice.IdArticle = itemArticle;
        //                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
        //                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
        //                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
        //                            if (!IsExistRecord(connectionstring, articleCostPrice))
        //                            {
        //                                articleCostPriceLst.Add(articleCostPrice);

        //                            }
        //                        }
        //                    }
        //                    else
        //                    {
        //                        if (poDetail.IsEmdep != 1)
        //                        {
        //                            articleCostPrice.IdArticle = itemArticle;
        //                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
        //                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
        //                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
        //                            if (!IsExistRecord(connectionstring, articleCostPrice))
        //                            {
        //                                articleCostPriceLst.Add(articleCostPrice);

        //                            }
        //                        }
        //                        else
        //                        {
        //                            PODetail poDetailEWHQ = null;
        //                            try
        //                            {
        //                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
        //                            }
        //                            catch (Exception ex)
        //                            {
        //                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //                                poDetailEWHQ = null;
        //                            }

        //                            if (poDetailEWHQ == null)
        //                            {
        //                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
        //                                {
        //                                    // List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));

        //                                    List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
        //                                    FinalArticleCostValue = 0;
        //                                    ExchangeRateDate = DateTime.MinValue;
        //                                    IdCurrency = 0;
        //                                    if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
        //                                    {
        //                                        CalculateComponentArticleCost(LstArticlesByArticle, itemCompany, workbenchConnectionString, EWHQConnStr, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst);
        //                                        if (FinalArticleCostValue > 0)
        //                                        {
        //                                            articleCostPrice.IdArticle = itemArticle;
        //                                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                                            articleCostPrice.ArticleCostValue = FinalArticleCostValue;
        //                                            articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
        //                                            articleCostPrice.ExchangeRateDate = ExchangeRateDate;
        //                                            if (!IsExistRecord(connectionstring, articleCostPrice))
        //                                            {
        //                                                articleCostPriceLst.Add(articleCostPrice);

        //                                            }
        //                                        }
        //                                    }
        //                                }
        //                            }
        //                            else
        //                            {
        //                                articleCostPrice.IdArticle = itemArticle;
        //                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
        //                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
        //                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
        //                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
        //                                if (!IsExistRecord(connectionstring, articleCostPrice))
        //                                {
        //                                    articleCostPriceLst.Add(articleCostPrice);

        //                                }
        //                            }
        //                        }
        //                    }

        //                }
        //                catch (Exception ex)
        //                {
        //                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0} Company - {1} Article{2}", ex.Message, itemCompany.Alias, itemArticle), category: Category.Exception, priority: Priority.Low);
        //                    FinalArticleCostValue = 0;
        //                    ExchangeRateDate = DateTime.MinValue;
        //                    IdCurrency = 0;
        //                }
        //            }
        //        }
        //        catch (Exception ex)
        //        {
        //            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0} Company - {1} ", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
        //            FinalArticleCostValue = 0;
        //            ExchangeRateDate = DateTime.MinValue;
        //            IdCurrency = 0;
        //        }
        //    }



        //    if (articleCostPriceLst != null && articleCostPriceLst.Count > 0)
        //    {
        //        foreach (ArticleCostPrice item in articleCostPriceLst)
        //        {

        //            try
        //            {

        //                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
        //                {
        //                    mySqlConnection.Open();
        //                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
        //                    mySqlCommand.CommandType = CommandType.StoredProcedure;
        //                    mySqlCommand.CommandTimeout = 3000;

        //                    mySqlCommand.Parameters.AddWithValue("_IdArticle", item.IdArticle);
        //                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", item.ArticleCostValue);
        //                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
        //                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
        //                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", item.ExchangeRateDate);
        //                    mySqlCommand.Parameters.AddWithValue("_IdCompany", item.IdCompany);
        //                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", item.IdCurrency);
        //                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
        //                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

        //                    mySqlCommand.ExecuteNonQuery();
        //                    mySqlConnection.Close();

        //                }

        //                isCalculated = true;
        //            }
        //            catch (Exception ex)
        //            {

        //                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

        //                isCalculated = false;
        //                throw;
        //            }

        //        }

        //    }
        //    return isCalculated;
        //}


        public bool CalculateArticleCostPrice_V2160(Company itemCompany, string mainServerConnectionString, string workbenchConnectionString)
        {
            bool isCalculated = true;
            List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
            List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
            string connectionstring = itemCompany.ConnectPlantConstr;
            List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);

            List<PODetail> EWHQpoDetailLst = GetAllArticleMaxPODeliveryDateDetailFromEWHQ(connectionstring);
            List<PODetail> EWHQArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromEWHQ(connectionstring);
            List<ArticlesByArticle> LstAllArticlesByArticle = GetAllArticlesByArticle(connectionstring);

            List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail(itemCompany.ConnectPlantConstr);
            List<PODetail> ArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromPlant(itemCompany.ConnectPlantConstr);
            // allPCMidsArticles.Where(pa => pa == 6951)
            foreach (UInt64 itemArticle in allPCMidsArticles)
            {
                try
                {

                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                    PODetail poDetail = null;
                    try
                    {
                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
                        poDetail = null;
                    }

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                            {
                                //List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));
                                List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                FinalArticleCostValue = 0;
                                ExchangeRateDate = DateTime.MinValue;
                                IdCurrency = 0;
                                if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                {
                                    CalculateComponentArticleCost(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle));
                                    if (FinalArticleCostValue > 0)
                                    {
                                        articleCostPrice.IdArticle = itemArticle;
                                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                        articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                        articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                        articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                        if (!IsExistRecord(connectionstring, articleCostPrice))
                                        {
                                            try
                                            {

                                                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                {
                                                    mySqlConnection.Open();
                                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                    mySqlCommand.CommandTimeout = 3000;

                                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                                    mySqlCommand.ExecuteNonQuery();
                                                    mySqlConnection.Close();

                                                }

                                                isCalculated = true;
                                            }
                                            catch (Exception ex)
                                            {

                                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                isCalculated = false;

                                            }

                                        }
                                    }
                                }
                            }
                        }
                        else
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                                {
                                    List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                    FinalArticleCostValue = 0;
                                    ExchangeRateDate = DateTime.MinValue;
                                    IdCurrency = 0;
                                    if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                    {
                                        CalculateComponentArticleCost(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle));
                                        if (FinalArticleCostValue > 0)
                                        {
                                            articleCostPrice.IdArticle = itemArticle;
                                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                            articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                            articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                            articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                            if (!IsExistRecord(connectionstring, articleCostPrice))
                                            {
                                                try
                                                {

                                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                    {
                                                        mySqlConnection.Open();
                                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                        mySqlCommand.CommandTimeout = 3000;

                                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                                        mySqlCommand.ExecuteNonQuery();
                                                        mySqlConnection.Close();

                                                    }

                                                    isCalculated = true;
                                                }
                                                catch (Exception ex)
                                                {

                                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                    isCalculated = false;

                                                }

                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                articleCostPrice.IdArticle = itemArticle;
                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                                if (!IsExistRecord(connectionstring, articleCostPrice))
                                {
                                    try
                                    {

                                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                        {
                                            mySqlConnection.Open();
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                                            mySqlCommand.CommandTimeout = 3000;

                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                            mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();

                                        }

                                        isCalculated = true;
                                    }
                                    catch (Exception ex)
                                    {

                                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                        isCalculated = false;

                                    }

                                }
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    isCalculated = false;
                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0} Company - {1} Article{2}", ex.Message, itemCompany.Alias, itemArticle), category: Category.Exception, priority: Priority.Low);
                    FinalArticleCostValue = 0;
                    ExchangeRateDate = DateTime.MinValue;
                    IdCurrency = 0;
                }
            }








            return isCalculated;
        }
        public void CalculateComponentArticleCost(List<ArticlesByArticle> LstArticlesByArticle, Company plant, string workbenchConnectionString, List<ArticlesByArticle> LstAllArticlesByArticle, List<PODetail> ArticlesByArticleComponentpoDetailLst, List<PODetail> EWHQArticlesByArticleComponentpoDetailLst, Int32 idArticle)
        {
            if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
            {
                foreach (ArticlesByArticle item in LstArticlesByArticle)
                {
                    PODetail poDetail = ArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                    //GetArticleMaxPODeliveryDateDetail(plant.ConnectPlantConstr, item.IdComponent);

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                            // GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                            {
                                // CalculateComponentArticleCost(GetAllArticlesByArticle(plant.ConnectPlantConstr, item.IdComponent), plant, workbenchConnectionString, EWHQConnStr);
                                CalculateComponentArticleCost(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle);
                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }
                        }
                        else
                        {
                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetailEWHQ.CreationDate;
                                }

                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                {
                                    currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetailEWHQ.IdCurrency), poDetailEWHQ.CreationDate);

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);


                                }
                                else
                                {

                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                }


                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }



                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {

                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetail.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetail.CreationDate;
                                }
                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetail.IdCurrency))
                                {
                                    currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetail.IdCurrency), poDetail.CreationDate);

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                }
                                else
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity));
                                }

                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }


                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                                //GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                                {
                                    //  CalculateComponentArticleCost(GetAllArticlesByArticle(plant.ConnectPlantConstr, item.IdComponent), plant, workbenchConnectionString, EWHQConnStr);
                                    // CalculateComponentArticleCost(GetAllArticlesByArticle(plant.ConnectPlantConstr, item.IdComponent), plant, workbenchConnectionString, EWHQConnStr);
                                    CalculateComponentArticleCost(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle);
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }
                            }
                            else
                            {

                                float parentQty = 0;
                                bool isParentQty = false;
                                if (idArticle != item.IdArticle)
                                {
                                    isParentQty = true;
                                    if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                        parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                                }
                                if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                                {

                                    if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                    {
                                        ExchangeRateDate = poDetailEWHQ.CreationDate;
                                    }

                                    CurrencyConversion currencyConversion = null;
                                    if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                    {
                                        currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetailEWHQ.IdCurrency), poDetailEWHQ.CreationDate);
                                    }
                                    if (currencyConversion != null)
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                    }
                                    else
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }


                            }
                        }
                    }
                }
            }
            else
            {
                FinalArticleCostValue = 0;
                return;
            }

        }
        public List<ArticlesByArticle> GetAllArticlesByArticle(string connectionstring, Int32 idArticle)
        {
            List<ArticlesByArticle> articlesByArticleLst = new List<ArticlesByArticle>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PCM_GetAllArticlesByArticle", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_idArticle", idArticle);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticlesByArticle articlesByArticle = new ArticlesByArticle();
                        articlesByArticle.IdArticle = idArticle;
                        if (reader["idComponent"] != DBNull.Value)
                            articlesByArticle.IdComponent = Convert.ToInt32(reader["idComponent"]);
                        if (reader["Quantity"] != DBNull.Value)
                            articlesByArticle.Quantity = (float)reader["Quantity"];

                        articlesByArticleLst.Add(articlesByArticle);
                    }
                }
            }
            return articlesByArticleLst;
        }

        public PODetail GetArticleMaxPODeliveryDateDetail(string connectionstring, Int32 idarticle)
        {
            PODetail poDetail = null;

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetArticleMaxPODeliveryDateDetail", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", idarticle);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);


                    }
                }
            }
            return poDetail;
        }

        public CurrencyConversion GetCurrencyConversionByTOFROMDATE(string workbenchConnectionstring, byte idCurrencyConversionTo, byte idCurrencyConversionFrom, DateTime exchangeRateDate)
        {
            CurrencyConversion currencyConversion = null;

            using (MySqlConnection con = new MySqlConnection(workbenchConnectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PLM_GetCurrencyConversionByTOFROMDATE", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_idCurrencyConversionTo", idCurrencyConversionTo);
                concommand.Parameters.AddWithValue("_idCurrencyConversionFrom", idCurrencyConversionFrom);
                concommand.Parameters.AddWithValue("_ExchangeRateDate", exchangeRateDate);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    if (reader.Read())
                    {
                        currencyConversion = new CurrencyConversion();

                        if (reader["CurrencyConversionRate"] != DBNull.Value)
                            currencyConversion.ExchangeRate = (float)(reader["CurrencyConversionRate"]);
                    }
                }
            }
            return currencyConversion;
        }

        public PODetail GetArticleMaxPODeliveryDateDetailFromEWHQ(string connectionstring, Int32 idarticle)
        {
            PODetail poDetail = null;

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("GetArticleMaxPODeliveryDateDetailFromEWHQ", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", idarticle);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        poDetail = new PODetail();
                        if (reader["CreatedIn"] != DBNull.Value)
                            poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                        if (reader["idCurrency"] != DBNull.Value)
                            poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                        if (reader["unitPrice"] != DBNull.Value)
                            poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                        if (reader["IsEmdep"] != DBNull.Value)
                            poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                        if (reader["idArticle"] != DBNull.Value)
                            poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);


                    }
                }
            }
            return poDetail;
        }

        public List<ArticleCostPrice> GetArticleCostPricesByCurrency_V2160(string PLMConnectionString, UInt32 IdCurrency)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetArticleCostPricesByCurrency_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPricesByCurrency_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }
        //Shubham[skadam] GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL 14 05 2025
        public List<ArticleCostPrice> GetArticleCostPricesByCurrency_V2640New(string PLMConnectionString, UInt32 IdCurrency)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            DataSet dataSet = new DataSet();
            try
            {
                //var stopwatch = System.Diagnostics.Stopwatch.StartNew();
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetArticleCostPricesByCurrency_V2160", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataAdapter adap = new MySqlDataAdapter(mySqlCommand))
                    {
                        adap.Fill(dataSet);
                    }
                }
                if (dataSet.Tables.Count > 0)
                {
                    DataTable dt = dataSet.Tables[0];
                    articleCostPrices = dt.AsEnumerable().Select(row => new ArticleCostPrice
                    {
                        IdArticleCostPrice = row["IdArticleCostPrice"] != DBNull.Value ? Convert.ToUInt64(row["IdArticleCostPrice"]) : 0,
                        IdArticle = row["IdArticle"] != DBNull.Value ? Convert.ToUInt64(row["IdArticle"]) : 0,
                        IdCompany = row["IdCompany"] != DBNull.Value ? Convert.ToUInt32(row["IdCompany"]) : 0,
                        IdCurrency = row["IdCurrency"] != DBNull.Value ? Convert.ToUInt32(row["IdCurrency"]) : 0,
                        ArticleCostValue = row["ArticleCostValue"] != DBNull.Value ? Convert.ToDouble(row["ArticleCostValue"]) : 0,
                        ExchangeRateDate = row["ExchangeRateDate"] != DBNull.Value ? Convert.ToDateTime(row["ExchangeRateDate"]) : (DateTime?)null
                    }).ToList();
                }
                //stopwatch.Stop();
                //Console.WriteLine($"[Timer] Total time: {stopwatch.Elapsed.TotalSeconds:F2} sec");
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPricesByCurrency_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articleCostPrices;
        }
        //Shubham[skadam] GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL 14 05 2025
        public List<ArticleCostPrice> GetArticleCostPricesByCurrency_V2640(string PLMConnectionString, UInt32 IdCurrency)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                //var stopwatch = System.Diagnostics.Stopwatch.StartNew();
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    //Console.WriteLine($"[Timer] Connection opened: {stopwatch.ElapsedMilliseconds} ms");
                    using (MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetArticleCostPricesByCurrency_V2160", mySqlConnection))
                    {
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);

                        using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                        {
                            //Console.WriteLine($"[Timer] Reader executed: {stopwatch.ElapsedMilliseconds} ms");
                            // Cache column indexes
                            int idx_IdArticleCostPrice = reader.GetOrdinal("IdArticleCostPrice");
                            int idx_IdArticle = reader.GetOrdinal("IdArticle");
                            int idx_IdCompany = reader.GetOrdinal("IdCompany");
                            int idx_IdCurrency = reader.GetOrdinal("IdCurrency");
                            int idx_ArticleCostValue = reader.GetOrdinal("ArticleCostValue");
                            int idx_ExchangeRateDate = reader.GetOrdinal("ExchangeRateDate");

                            while (reader.Read())
                            {
                                try
                                {
                                    ArticleCostPrice articleCostPrice = new ArticleCostPrice
                                    {
                                        IdArticleCostPrice = (ulong)reader.GetUInt64(idx_IdArticleCostPrice),
                                        IdArticle = reader.IsDBNull(idx_IdArticle) ? 0 : (ulong)reader.GetUInt64(idx_IdArticle),
                                        IdCompany = reader.IsDBNull(idx_IdCompany) ? 0 : reader.GetUInt32(idx_IdCompany),
                                        IdCurrency = reader.IsDBNull(idx_IdCurrency) ? 0 : reader.GetUInt32(idx_IdCurrency),
                                        ArticleCostValue = reader.IsDBNull(idx_ArticleCostValue) ? 0 : reader.GetDouble(idx_ArticleCostValue),
                                        ExchangeRateDate = reader.IsDBNull(idx_ExchangeRateDate) ? (DateTime?)null : reader.GetDateTime(idx_ExchangeRateDate)
                                    };
                                    articleCostPrices.Add(articleCostPrice);
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log($"Error GetArticleCostPricesByCurrency_V2160(). ErrorMessage- {ex.Message}", category: Category.Exception, priority: Priority.Low);
                                }
                            }
                            //Console.WriteLine($"[Timer] Data reading completed: {stopwatch.ElapsedMilliseconds} ms");
                        }
                    }
                }
                //stopwatch.Stop();
                //Console.WriteLine($"[Timer] Total time: {stopwatch.Elapsed.TotalSeconds:F2} sec");
                //var t=GetArticleCostPricesByCurrency_V2160(PLMConnectionString, IdCurrency);
                //var t = GetArticleCostPricesByCurrency_V2640New(PLMConnectionString, IdCurrency);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log($"Error GetArticleCostPricesByCurrency_V2160(). ErrorMessage- {ex.Message}", category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return articleCostPrices;
        }




        #region GEOS2-3134
        public List<Currency> GetCurrencies_V2160(string PLMConnectionString, string currencyIconFilePath)
        {
            List<Currency> Currencies = new List<Currency>();
            List<string> CurrencyIcon = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencies", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["Name"]);
                                if (!CurrencyIcon.Any(co => co.ToString() == Currency.Name))
                                {
                                    CurrencyIcon.Add(Currency.Name);
                                }
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencies_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }
                Currencies.Where(ma => ma.Name == item).ToList().ForEach(ma => ma.CurrencyIconbytes = bytes);
            }
            return Currencies;
        }


        public List<BasePrice> GetBasePrices_V2160(string PLMConnectionString, string currencyIconFilePath)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceList_V2150", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == basePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(basePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            basePrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = item;
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                basePrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePrices_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                basePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);

            }
            return basePrices;
        }

        public List<CustomerPrice> GetCustomerPrices_V2160(string PLMConnectionString, string currencyIconFilePath)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceList_V2150", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]).Trim();

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == customerPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(customerPrice.Currency.Name);
                                    }
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                customerPrice.SaleCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }

                            if (reader["CustGroup"] != DBNull.Value)
                            {
                                List<string> tempDifferentGroup = Convert.ToString(reader["CustGroup"]).Split('\n').ToList<string>();
                                tempDifferentGroup = tempDifferentGroup.Distinct().ToList();
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        tempDifferentGroup.Add("ALL");
                                }
                                customerPrice.Group = string.Join("\n", tempDifferentGroup.ToArray());
                            }
                            else
                            {
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        customerPrice.Group = "ALL";
                                }
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                customerPrice.Country = customerPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        customerPrice.Country = "ALL";
                                }
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempDifferentRegionName = Convert.ToString(reader["RegionName"]).Split('\n').ToList<string>();
                                tempDifferentRegionName = tempDifferentRegionName.Distinct().ToList();

                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        tempDifferentRegionName.Add("ALL");
                                }

                                customerPrice.Region = customerPrice.Region + string.Join("\n", tempDifferentRegionName.ToArray());
                            }
                            else
                            {
                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        customerPrice.Region = "ALL";
                                }
                            }

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlantName = Convert.ToString(reader["PlantName"]).Split('\n').ToList<string>();
                                tempDifferentPlantName = tempDifferentPlantName.Distinct().ToList();
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        tempDifferentPlantName.Add("ALL");
                                }
                                customerPrice.Plant = customerPrice.Plant + string.Join("\n", tempDifferentPlantName.ToArray());
                            }
                            else
                            {
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        customerPrice.Plant = "ALL";
                                }
                            }
                            customerPrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = Convert.ToString(item);
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                customerPrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }

                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPrices_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                customerPrices.Where(cp => cp.Currency.Name == item).ToList().ForEach(cp => cp.Currency.CurrencyIconbytes = bytes);

            }
            return customerPrices;
        }



        public byte[] GetCurrencyIconFileInBytes(string currencyName, string filepath)
        {
            byte[] bytes = null;
            try
            {
                string filenamepng = currencyName + ".png";
                string filenamejpg = currencyName + ".jpg";
                string filepathjpg = Path.Combine(filepath, filenamejpg);
                string filepathpng = Path.Combine(filepath, filenamepng);

                if (File.Exists(filepathjpg))
                {

                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathjpg, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                else if (File.Exists(filepathpng))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathpng, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                return bytes;

            }
            catch (FileNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (DirectoryNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public List<BasePrice> GetBasePrices_V2180(string PLMConnectionString, string currencyIconFilePath)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceList_V2180", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == basePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(basePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["BPLInCPL"]) > 0)
                                    basePrice.IsBPLExistInCPL = true;
                            }

                            basePrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = item;
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                basePrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePrices_V2180(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                basePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);

            }
            return basePrices;
        }

        public bool IsDeletedBasePriceList_V2180(UInt64 idBasePriceList, string MainServerConnectionString, uint IdModifier)
        {
            bool isDeleted = false;
            if (idBasePriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Delete_V2180", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", idBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedBasePriceList_V2180(). idBasePriceList- {0} ErrorMessage- {1}", idBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public bool IsDeletedCustomerPriceList_V2180(UInt64 idCustomerPriceList, string MainServerConnectionString, uint IdModifier)
        {
            bool isDeleted = false;
            if (idCustomerPriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Delete_V2180", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCustomerPriceList_V2180(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        #endregion

        #region connection methods

        /// <summary>
        /// This method is used to get connection string name exists or not by name.
        /// </summary>
        public bool IsConnectionStringNameExist(string Name)
        {
            bool isExist = false;
            ConnectionStringSettingsCollection settings = ConfigurationManager.ConnectionStrings;
            if (settings != null)
            {
                foreach (ConnectionStringSettings cs in settings)
                {
                    if (cs.Name == Name)
                    {
                        isExist = true;
                        return isExist;
                    }
                }
            }
            return isExist;
        }


        public List<CurrencyConversion> GetCurrencyConversionRatesByBPLArticleDates(string PLMConnectionString, UInt32 IdCurrency, UInt64 IdBasePriceList)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionRatesByBPLArticleDates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionRatesByBPLArticleDates(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }


        public List<CurrencyConversion> GetCurrencyConversionRatesByBPLDetectionDates(string PLMConnectionString, UInt32 IdCurrency, UInt64 IdBasePriceList)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionRatesByBPLDetectionDates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionRatesByBPLDetectionDates(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }


        public CustomerPrice GetCustomerPricesById_V2160(string PLMConnectionString, UInt64 idCustomerPriceList, string currencyIconFilePath)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == CustomerPrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == CustomerPrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(CustomerPrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(CustomerPrice.Currency.Name, bytes);
                                    }

                                    CustomerPrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CurrencyList = GetCurrenciesByIdCustomerPrice_V2160(PLMConnectionString, CustomerPrice.IdCustomerPriceList, currencyIconFilePath);
                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListDetections = GetCustomerPriceListDetectionsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                //CustomerPrice.ArticleCostPriceListForSavedCPL = GetCPLArticleCostPricesByCurrency(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLArticlesSaved = GetCurrencyConversionRatesByCPLArticleDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLDetectionsSaved = GetCurrencyConversionRatesByCPLDetectionDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2160(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }

        public List<Currency> GetCurrenciesByIdCustomerPrice_V2160(string PLMConnectionString, UInt64 IdCustomerPriceList, string currencyIconFilePath)
        {
            List<Currency> Currencies = new List<Currency>();
            List<string> CurrencyIcon = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_currency_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Currency Currency = new Currency();
                            Currency.IdCurrency = Convert.ToByte(reader["BasePriceListCurrency"]);

                            if (reader["Name"] != DBNull.Value)
                            {
                                Currency.Name = Convert.ToString(reader["Name"]);
                                if (!CurrencyIcon.Any(co => co.ToString() == Currency.Name))
                                {
                                    CurrencyIcon.Add(Currency.Name);
                                }
                            }
                            Currencies.Add(Currency);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrenciesByIdCustomerPrice_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }
                Currencies.Where(ma => ma.Name == item).ToList().ForEach(ma => ma.CurrencyIconbytes = bytes);
            }
            return Currencies;
        }

        public List<CurrencyConversion> GetCurrencyConversionRatesByCPLArticleDates(string PLMConnectionString, UInt32 IdCurrency, UInt64 IdCustomerPriceList)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionRatesByCPLArticleDates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionRatesByCPLArticleDates(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }


        public List<CurrencyConversion> GetCurrencyConversionRatesByCPLDetectionDates(string PLMConnectionString, UInt32 IdCurrency, UInt64 IdCustomerPriceList)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionRatesByCPLDetectionDates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionRatesByCPLDetectionDates(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }


        public List<CurrencyConversion> GetCurrencyConversionsDetailsByLatestDate(string WorkbenchConnectionString)
        {
            List<CurrencyConversion> currencyConversions = new List<CurrencyConversion>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCurrencyConversionsDetailsByLatestDate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CurrencyConversion currencyConversion = new CurrencyConversion();
                            currencyConversion.Idcurrencyconversion = Convert.ToInt64(reader["IdCurrencyConversion"]);

                            if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyfrom = Convert.ToByte(reader["IdCurrencyConversionFrom"]);
                            }
                            if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            {
                                currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                            }
                            if (reader["CurrencyConversionRate"] != DBNull.Value)
                            {
                                currencyConversion.ExchangeRate = float.Parse(reader["CurrencyConversionRate"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                currencyConversion.LastUpdate = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                            }
                            if (reader["LastMonthAVGRate"] != DBNull.Value)
                            {
                                currencyConversion.LastMonthAVGRate = float.Parse(reader["LastMonthAVGRate"].ToString());
                            }
                            currencyConversions.Add(currencyConversion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyConversionsDetailsByLatestDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return currencyConversions;
        }





        #endregion

        public List<CustomerPrice> GetCustomerPriceIFExistDetections(string PLMConnectionString, UInt64 IdBasePriceList, string IdDetections)
        {
            List<CustomerPrice> customerPriceLst = new List<CustomerPrice>();
            try
            {
                if (!string.IsNullOrEmpty(IdDetections))
                {
                    using (MySqlConnection connCustomerPrice = new MySqlConnection(PLMConnectionString))
                    {
                        connCustomerPrice.Open();

                        MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_GetCustomerPriceIFExistDetections", connCustomerPrice);
                        CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                        CustomerPriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                        CustomerPriceCommand.Parameters.AddWithValue("_IdDetections", IdDetections);


                        using (MySqlDataReader CustomerPriceReader = CustomerPriceCommand.ExecuteReader())
                        {
                            while (CustomerPriceReader.Read())
                            {
                                CustomerPrice customerPrice = new CustomerPrice();


                                if (CustomerPriceReader["Code"] != DBNull.Value)
                                {
                                    customerPrice.Code = Convert.ToString(CustomerPriceReader["Code"]);
                                }
                                if (CustomerPriceReader["Name"] != DBNull.Value)
                                {
                                    customerPrice.Name = Convert.ToString(CustomerPriceReader["Name"]);
                                }
                                if (CustomerPriceReader["IdCustomerPriceList"] != DBNull.Value)
                                {
                                    customerPrice.IdCustomerPriceList = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceList"]);
                                }
                                if (CustomerPriceReader["IdCustomerPriceListByItems"] != DBNull.Value)
                                {
                                    customerPrice.CustomerPriceListItems = new List<CustomerPriceListByItem>();
                                    CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                    customerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceListByItems"]);
                                    customerPriceListByItem.IdDetection = Convert.ToUInt32(CustomerPriceReader["IdDetection"]); ;
                                    customerPrice.CustomerPriceListItems.Add(customerPriceListByItem);
                                }
                                customerPriceLst.Add(customerPrice);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceIFExistDetections(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLst;
        }


        public bool UpdateBasePrice_V2180(BasePrice basePrice, string MainServerConnectionString)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        //information plant and currency
                        AddDeletePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.CurrencyList, basePrice.DeletePlantList, basePrice.AddPlantList, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.AddCurrencyList, basePrice.DeleteCurrencyList, basePrice.IdModifier);
                        //articles
                        DeleteArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteArticleList);
                        UpdateArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateArticleList, basePrice.IdModifier);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddArticleList, (uint)basePrice.IdModifier);
                        //detections
                        DeleteDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteDetectionList);
                        UpdateDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionList, basePrice.IdModifier);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, (uint)basePrice.IdModifier);
                        //change log/plantcurrency/cpl log/delete cpl items
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                        DeleteCustomerPriceListDetection(MainServerConnectionString, basePrice.CustomerPriceListDetections);
                        DeleteCustomerPriceListSaleCurrency(MainServerConnectionString, basePrice.CustomerPriceListSaleCurrencies);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2180(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }


        public bool DeleteCustomerPriceListDetection(string MainServerConnectionString, List<CustomerPriceListByItem> customerPriceListByItem)
        {
            bool isDeleted = false;

            if (customerPriceListByItem != null)
                foreach (CustomerPriceListByItem item in customerPriceListByItem)
                {
                    try
                    {
                        using (MySqlConnection connCustomerPrice = new MySqlConnection(MainServerConnectionString))
                        {
                            connCustomerPrice.Open();

                            MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_DeleteCustomerPriceListDetection", connCustomerPrice);
                            CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                            CustomerPriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", item.IdCustomerPriceList);
                            CustomerPriceCommand.Parameters.AddWithValue("_IdDetection", item.IdDetection);
                            CustomerPriceCommand.ExecuteNonQuery();
                            isDeleted = true;
                        }
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error DeleteCustomerPriceListDetection(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        throw;
                    }
                }
            return isDeleted;
        }


        public BasePrice GetBasePriceDetailById_V2180(string PLMConnectionString, UInt64 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            string Icon = "";
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2180", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                            if (BasePriceReader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(BasePriceReader["BPLInCPL"]) > 0)
                                    BasePrice.IsBPLExistInCPL = true;
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2180(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }


        public string GetCustomerPriceCodesByBPL(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            string CPLCodes = "";
            try
            {
                using (MySqlConnection connCustomerPrice = new MySqlConnection(PLMConnectionString))
                {
                    connCustomerPrice.Open();

                    MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_GetCustomerPriceCodesByBPL", connCustomerPrice);
                    CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                    CustomerPriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader CustomerPriceReader = CustomerPriceCommand.ExecuteReader())
                    {
                        while (CustomerPriceReader.Read())
                        {
                            if (CustomerPriceReader["CPLCodes"] != DBNull.Value)
                            {
                                CPLCodes = Convert.ToString(CustomerPriceReader["CPLCodes"]).Trim();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceCodesByBPL(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return CPLCodes;
        }


        public List<CustomerPrice> GetCustomerPriceIFExistCurrencies(string PLMConnectionString, UInt64 IdBasePriceList, string IdCurrencies)
        {
            List<CustomerPrice> customerPriceLst = new List<CustomerPrice>();
            try
            {
                if (!string.IsNullOrEmpty(IdCurrencies))
                {
                    using (MySqlConnection connCustomerPrice = new MySqlConnection(PLMConnectionString))
                    {
                        connCustomerPrice.Open();

                        MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_GetCustomerPriceIFExistCurrencies", connCustomerPrice);
                        CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                        CustomerPriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                        CustomerPriceCommand.Parameters.AddWithValue("_IdCurrencies", IdCurrencies);

                        using (MySqlDataReader CustomerPriceReader = CustomerPriceCommand.ExecuteReader())
                        {
                            while (CustomerPriceReader.Read())
                            {
                                CustomerPrice customerPrice = new CustomerPrice();

                                if (CustomerPriceReader["Code"] != DBNull.Value)
                                {
                                    customerPrice.Code = Convert.ToString(CustomerPriceReader["Code"]);
                                }
                                if (CustomerPriceReader["Name"] != DBNull.Value)
                                {
                                    customerPrice.Name = Convert.ToString(CustomerPriceReader["Name"]);
                                }
                                if (CustomerPriceReader["IdCustomerPriceList"] != DBNull.Value)
                                {
                                    customerPrice.IdCustomerPriceList = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceList"]);
                                }
                                if (CustomerPriceReader["BasePriceListCurrency"] != DBNull.Value)
                                {
                                    customerPrice.CurrencyList = new List<Currency>();
                                    Currency currency = new Currency();
                                    currency.IdCurrency = Convert.ToByte(CustomerPriceReader["BasePriceListCurrency"]); ;
                                    customerPrice.CurrencyList.Add(currency);
                                }
                                customerPriceLst.Add(customerPrice);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceIFExistCurrencies(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLst;
        }

        public bool DeleteCustomerPriceListSaleCurrency(string MainServerConnectionString, List<CustomerPriceListByItem> customerPriceListByItem)
        {
            bool isDeleted = false;

            if (customerPriceListByItem != null)
                foreach (CustomerPriceListByItem item in customerPriceListByItem)
                {
                    try
                    {
                        using (MySqlConnection connCustomerPrice = new MySqlConnection(MainServerConnectionString))
                        {
                            connCustomerPrice.Open();

                            MySqlCommand CustomerPriceCommand = new MySqlCommand("PCM_customer_price_list_by_currency_Delete", connCustomerPrice);
                            CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                            CustomerPriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", item.IdCustomerPriceList);
                            CustomerPriceCommand.Parameters.AddWithValue("_BasePriceListCurrency", item.BasePriceListCurrency);
                            CustomerPriceCommand.ExecuteNonQuery();
                            isDeleted = true;
                        }
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error DeleteCustomerPriceListSaleCurrency(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        throw;
                    }
                }
            return isDeleted;
        }


        public bool ImportArticleCostPriceCalculate(Company itemCompany, string mainServerConnectionString, string workbenchConnectionString, UInt64 itemArticle,List<PODetail> EWHQArticlesByArticleComponentpoDetailLst, List<ArticlesByArticle> LstAllArticlesByArticle, List<PODetail> ArticlesByArticleComponentpoDetailLst)
        {
            bool isCalculated = false;
            List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
            List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
            string connectionstring = itemCompany.ConnectPlantConstr;
           

            List<PODetail> EWHQpoDetailLst = GetArticleMaxPODeliveryDateDetailFromEWHQ(connectionstring, itemArticle);
            //List<PODetail> EWHQArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromEWHQ(connectionstring);
            //List<ArticlesByArticle> LstAllArticlesByArticle = GetAllArticlesByArticle(connectionstring);

            List<PODetail> poDetailLst = GetPCMArticleMaxPODeliveryDateDetail(itemCompany.ConnectPlantConstr, itemArticle);
          //  List<PODetail> ArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromPlant(itemCompany.ConnectPlantConstr);
            // allPCMidsArticles.Where(pa => pa == 6951)
           
                try
                {

                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                    PODetail poDetail = null;
                    try
                    {
                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
                        poDetail = null;
                        throw ex;
                    }

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                            throw ex;
                    }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                            {
                                //List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));
                                List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                FinalArticleCostValue = 0;
                                ExchangeRateDate = DateTime.MinValue;
                                IdCurrency = 0;
                                if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                {
                                    CalculateComponentArticleCost(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle));
                                    if (FinalArticleCostValue > 0)
                                    {
                                        articleCostPrice.IdArticle = itemArticle;
                                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                        articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                        articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                        articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                        if (!IsExistRecord(connectionstring, articleCostPrice))
                                        {
                                            try
                                            {

                                                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                {
                                                    mySqlConnection.Open();
                                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                    mySqlCommand.CommandTimeout = 3000;

                                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                                    mySqlCommand.ExecuteNonQuery();
                                                    mySqlConnection.Close();

                                                }

                                                isCalculated = true;
                                            }
                                            catch (Exception ex)
                                            {

                                                Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                isCalculated = false;
                                                throw ex;

                                        }

                                        }
                                    }
                                }
                            }
                        }
                        else
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;
                                throw ex;

                            }

                            }
                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;
                                throw ex;

                            }

                            }
                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                                {
                                    List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                    FinalArticleCostValue = 0;
                                    ExchangeRateDate = DateTime.MinValue;
                                    IdCurrency = 0;
                                    if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                    {
                                        CalculateComponentArticleCost(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle));
                                        if (FinalArticleCostValue > 0)
                                        {
                                            articleCostPrice.IdArticle = itemArticle;
                                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                            articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                            articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                            articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                            if (!IsExistRecord(connectionstring, articleCostPrice))
                                            {
                                                try
                                                {

                                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                    {
                                                        mySqlConnection.Open();
                                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                        mySqlCommand.CommandTimeout = 3000;

                                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                                        mySqlCommand.ExecuteNonQuery();
                                                        mySqlConnection.Close();

                                                    }

                                                    isCalculated = true;
                                                }
                                                catch (Exception ex)
                                                {

                                                    Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                    isCalculated = false;
                                                throw ex;
                                            }

                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                articleCostPrice.IdArticle = itemArticle;
                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                                if (!IsExistRecord(connectionstring, articleCostPrice))
                                {
                                    try
                                    {

                                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                        {
                                            mySqlConnection.Open();
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                                            mySqlCommand.CommandTimeout = 3000;

                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                            mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();

                                        }

                                        isCalculated = true;
                                    }
                                    catch (Exception ex)
                                    {

                                        Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                        isCalculated = false;
                                    throw ex;
                                }

                                }
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    isCalculated = false;
                    Log4NetLogger.Logger.Log(string.Format("Error ImportArticleCostPriceCalculate(). ErrorMessage- {0} Company - {1} Article{2}", ex.Message, itemCompany.Alias, itemArticle), category: Category.Exception, priority: Priority.Low);
                    FinalArticleCostValue = 0;
                    ExchangeRateDate = DateTime.MinValue;
                    IdCurrency = 0;
                    throw ex;
               }
          








            return isCalculated;
        }

        public List<BPLPlantCurrencyDetail> GetBPLPlantCurrencyDetail(string connectionstring, string IdArticles,string filtertext)
        {
            List<BPLPlantCurrencyDetail> bplPlantCurrencyDetailLst = new List<BPLPlantCurrencyDetail>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PLM_GetBPLPlantCurrencyDetail", con);

                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticles", IdArticles);
                concommand.Parameters.AddWithValue("_filtertext", filtertext);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        BPLPlantCurrencyDetail bplPlantCurrencyDetail = new BPLPlantCurrencyDetail();
                        string ShortName="";
                        if (reader["ShortName"] != DBNull.Value)
                            ShortName = Convert.ToString(reader["ShortName"]);
                        string CurrencyName = "";
                        if (reader["CurrencyName"] != DBNull.Value)
                            CurrencyName = Convert.ToString(reader["CurrencyName"]);
                        if (!string.IsNullOrEmpty(ShortName) && !string.IsNullOrEmpty(CurrencyName))
                        {
                            bplPlantCurrencyDetail.CompanyName = ShortName;
                            bplPlantCurrencyDetail.CurrencyName = CurrencyName;
                            if (bplPlantCurrencyDetailLst == null)
                                bplPlantCurrencyDetailLst = new List<BPLPlantCurrencyDetail>();
                            if(!bplPlantCurrencyDetailLst.Any(bpl=>bpl.CompanyName == bplPlantCurrencyDetail.CompanyName && bpl.CurrencyName == bplPlantCurrencyDetail.CurrencyName))
                            bplPlantCurrencyDetailLst.Add(bplPlantCurrencyDetail);
                        }
                    }
                  }
            }
            return bplPlantCurrencyDetailLst;
        }

        public List<BPLPlantCurrencyDetail> GetBPLPlantCurrencyDetailByIdBPLAndIdCPL(string connectionstring, Int32 IdArticle,string IdsBPL,string IdsCPL, string filtertext)
        {
            List<BPLPlantCurrencyDetail> bplPlantCurrencyDetailLst = new List<BPLPlantCurrencyDetail>();

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PLM_GetBPLPlantCurrencyDetailByIdBPLAndIdCPL", con);

                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                concommand.Parameters.AddWithValue("_filtertext", filtertext);
                concommand.Parameters.AddWithValue("_IdsBPL", IdsBPL);
                concommand.Parameters.AddWithValue("_IdsCPL", IdsCPL);
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        BPLPlantCurrencyDetail bplPlantCurrencyDetail = new BPLPlantCurrencyDetail();
                        string ShortName = "";
                        if (reader["ShortName"] != DBNull.Value)
                            ShortName = Convert.ToString(reader["ShortName"]);
                        string CurrencyName = "";
                        if (reader["CurrencyName"] != DBNull.Value)
                            CurrencyName = Convert.ToString(reader["CurrencyName"]);
                        if (!string.IsNullOrEmpty(ShortName) && !string.IsNullOrEmpty(CurrencyName))
                        {
                            bplPlantCurrencyDetail.CompanyName = ShortName;
                            bplPlantCurrencyDetail.CurrencyName = CurrencyName;
                            if (bplPlantCurrencyDetailLst == null)
                                bplPlantCurrencyDetailLst = new List<BPLPlantCurrencyDetail>();
                            if (!bplPlantCurrencyDetailLst.Any(bpl => bpl.CompanyName == bplPlantCurrencyDetail.CompanyName && bpl.CurrencyName == bplPlantCurrencyDetail.CurrencyName))
                                bplPlantCurrencyDetailLst.Add(bplPlantCurrencyDetail);
                        }
                    }
                   
                }
            }
            return bplPlantCurrencyDetailLst;
        }


        public List<PODetail> GetAllArticlesByArticleComponentMaxPOFromEWHQ_V2210(string plantconnectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();
            string connectionstring = GetEWHQDatabaseDetail_V2490(plantconnectionstring);//[GEOS2-6450][rdixit][18.09.2024]
            try
            {
                using (MySqlConnection con = new MySqlConnection(connectionstring))
                {
                    con.Open();
                    MySqlCommand concommand = new MySqlCommand("GetAllArticlesByArticleComponentMaxPOFromEWHQ_V2210", con);
                    concommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = concommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            PODetail poDetail = new PODetail();
                            if (reader["CreatedIn"] != DBNull.Value)
                                poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            if (reader["idCurrency"] != DBNull.Value)
                                poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                            if (reader["discount"] != DBNull.Value)
                                poDetail.Discount = Convert.ToDouble(reader["discount"]);
                            if (poDetail.Discount > 0)
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = (Convert.ToDouble(reader["unitPrice"]) * (1 - (poDetail.Discount / 100)));
                            }
                            else
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                            }
                            if (reader["IsEmdep"] != DBNull.Value)
                                poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                            if (reader["idArticle"] != DBNull.Value)
                                poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);
                            poDetailLst.Add(poDetail);
                        }
                    }
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllArticlesByArticleComponentMaxPOFromEWHQ_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return poDetailLst;
        }
        public List<PODetail> GetAllArticleMaxPODeliveryDateDetailFromEWHQ_V2210(string plantconnectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();
            string connectionstring = GetEWHQDatabaseDetail_V2490(plantconnectionstring);//[GEOS2-6450][rdixit][18.09.2024]
            try
            {
                using (MySqlConnection con = new MySqlConnection(connectionstring))
                {
                    con.Open();
                    MySqlCommand concommand = new MySqlCommand("GetAllPCMArticleMaxPODeliveryDateDetailFromEWHQ_V2210", con);
                    concommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = concommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PODetail poDetail = new PODetail();
                            if (reader["CreatedIn"] != DBNull.Value)
                                poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            if (reader["idCurrency"] != DBNull.Value)
                                poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                            if (reader["discount"] != DBNull.Value)
                                poDetail.Discount = Convert.ToDouble(reader["discount"]);
                            if (poDetail.Discount > 0)
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = (Convert.ToDouble(reader["unitPrice"]) * (1 - (poDetail.Discount / 100)));
                            }
                            else
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                            }
                            if (reader["IsEmdep"] != DBNull.Value)
                                poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                            if (reader["idArticle"] != DBNull.Value)
                                poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);
                            poDetailLst.Add(poDetail);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllArticleMaxPODeliveryDateDetailFromEWHQ_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return poDetailLst;
        }

        public List<PODetail> GetAllPCMArticleMaxPODeliveryDateDetail_V2210(string connectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();
            try
            {
                using (MySqlConnection con = new MySqlConnection(connectionstring))
                {
                    con.Open();
                    MySqlCommand concommand = new MySqlCommand("GetAllPCMArticleMaxPODeliveryDateDetail_V2210", con);
                    concommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = concommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PODetail poDetail = new PODetail();
                            if (reader["CreatedIn"] != DBNull.Value)
                                poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            if (reader["idCurrency"] != DBNull.Value)
                                poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                            if (reader["discount"] != DBNull.Value)
                                poDetail.Discount = Convert.ToDouble(reader["discount"]);
                            if (poDetail.Discount > 0)
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = (Convert.ToDouble(reader["unitPrice"]) * (1 - (poDetail.Discount / 100)));
                            }
                            else
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                            }
                            if (reader["IsEmdep"] != DBNull.Value)
                                poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                            if (reader["idArticle"] != DBNull.Value)
                                poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);
                            poDetailLst.Add(poDetail);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllPCMArticleMaxPODeliveryDateDetail_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return poDetailLst;
        }

        public List<PODetail> GetAllArticlesByArticleComponentMaxPOFromPlant_V2210(string connectionstring)
        {
            List<PODetail> poDetailLst = new List<PODetail>();
            try
            {
                using (MySqlConnection con = new MySqlConnection(connectionstring))
                {
                    con.Open();
                    MySqlCommand concommand = new MySqlCommand("GetAllArticlesByArticleComponentMaxPOFromPlant_V2210", con);
                    concommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = concommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            PODetail poDetail = new PODetail();
                            if (reader["CreatedIn"] != DBNull.Value)
                                poDetail.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            if (reader["idCurrency"] != DBNull.Value)
                                poDetail.IdCurrency = Convert.ToUInt32(reader["idCurrency"]);
                            if (reader["discount"] != DBNull.Value)
                                poDetail.Discount = Convert.ToDouble(reader["discount"]);
                            if (poDetail.Discount > 0)
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = (Convert.ToDouble(reader["unitPrice"]) * (1 - (poDetail.Discount / 100)));
                            }
                            else
                            {
                                if (reader["unitPrice"] != DBNull.Value)
                                    poDetail.UnitPrice = Convert.ToDouble(reader["unitPrice"]);
                            }
                            if (reader["IsEmdep"] != DBNull.Value)
                                poDetail.IsEmdep = Convert.ToSByte(reader["IsEmdep"]);
                            if (reader["idArticle"] != DBNull.Value)
                                poDetail.IdArticle = Convert.ToUInt32(reader["idArticle"]);
                            poDetailLst.Add(poDetail);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllArticlesByArticleComponentMaxPOFromPlant_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return poDetailLst;
        }
        public bool CalculateArticleCostPrice_V2210(Company itemCompany, string mainServerConnectionString, string workbenchConnectionString)
        {
            bool isCalculated = true;
            List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
            List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
            string connectionstring = itemCompany.ConnectPlantConstr;
            List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);

            List<PODetail> EWHQpoDetailLst = GetAllArticleMaxPODeliveryDateDetailFromEWHQ_V2210(connectionstring);
            List<PODetail> EWHQArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromEWHQ_V2210(connectionstring);
            List<ArticlesByArticle> LstAllArticlesByArticle = GetAllArticlesByArticle(connectionstring);

            List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail_V2210(itemCompany.ConnectPlantConstr);
            List<PODetail> ArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromPlant_V2210(itemCompany.ConnectPlantConstr);
            // allPCMidsArticles.Where(pa => pa == 6951)
            foreach (UInt64 itemArticle in allPCMidsArticles)
            {
                try
                {
                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                    PODetail poDetail = null;
                    try
                    {
                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
                        poDetail = null;
                    }

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                            {
                                //List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));
                                List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                FinalArticleCostValue = 0;
                                ExchangeRateDate = DateTime.MinValue;
                                IdCurrency = 0;
                                if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                {
                                    CalculateComponentArticleCost_V2210(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle));
                                    if (FinalArticleCostValue > 0)
                                    {
                                        articleCostPrice.IdArticle = itemArticle;
                                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                        articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                        articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                        articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                        if (!IsExistRecord(connectionstring, articleCostPrice))
                                        {
                                            try
                                            {

                                                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                {
                                                    mySqlConnection.Open();
                                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                    mySqlCommand.CommandTimeout = 3000;

                                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                                    mySqlCommand.ExecuteNonQuery();
                                                    mySqlConnection.Close();

                                                }

                                                isCalculated = true;
                                            }
                                            catch (Exception ex)
                                            {

                                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                isCalculated = false;

                                            }

                                        }
                                    }
                                }
                            }
                        }
                        else
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
                            if (!IsExistRecord(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                                {
                                    List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                    FinalArticleCostValue = 0;
                                    ExchangeRateDate = DateTime.MinValue;
                                    IdCurrency = 0;
                                    if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                    {
                                        CalculateComponentArticleCost_V2210(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle));
                                        if (FinalArticleCostValue > 0)
                                        {
                                            articleCostPrice.IdArticle = itemArticle;
                                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                            articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                            articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                            articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                            if (!IsExistRecord(connectionstring, articleCostPrice))
                                            {
                                                try
                                                {

                                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                    {
                                                        mySqlConnection.Open();
                                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                        mySqlCommand.CommandTimeout = 3000;

                                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                                        mySqlCommand.ExecuteNonQuery();
                                                        mySqlConnection.Close();

                                                    }

                                                    isCalculated = true;
                                                }
                                                catch (Exception ex)
                                                {

                                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                    isCalculated = false;

                                                }

                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                articleCostPrice.IdArticle = itemArticle;
                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                                if (!IsExistRecord(connectionstring, articleCostPrice))
                                {
                                    try
                                    {

                                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                        {
                                            mySqlConnection.Open();
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2160", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                                            mySqlCommand.CommandTimeout = 3000;

                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                            mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);

                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();

                                        }

                                        isCalculated = true;
                                    }
                                    catch (Exception ex)
                                    {

                                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                        isCalculated = false;

                                    }

                                }
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    isCalculated = false;
                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2210(). ErrorMessage- {0} Company - {1} Article{2}", ex.Message, itemCompany.Alias, itemArticle), category: Category.Exception, priority: Priority.Low);
                    FinalArticleCostValue = 0;
                    ExchangeRateDate = DateTime.MinValue;
                    IdCurrency = 0;
                }
            }
            return isCalculated;
        }
        public void CalculateComponentArticleCost_V2210(List<ArticlesByArticle> LstArticlesByArticle, Company plant, string workbenchConnectionString, List<ArticlesByArticle> LstAllArticlesByArticle, List<PODetail> ArticlesByArticleComponentpoDetailLst, List<PODetail> EWHQArticlesByArticleComponentpoDetailLst, Int32 idArticle)
        {
            if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
            {
                foreach (ArticlesByArticle item in LstArticlesByArticle)
                {
                    PODetail poDetail = ArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                    //GetArticleMaxPODeliveryDateDetail(plant.ConnectPlantConstr, item.IdComponent);

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                            // GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateComponentArticleCost_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                            {
                                // CalculateComponentArticleCost(GetAllArticlesByArticle(plant.ConnectPlantConstr, item.IdComponent), plant, workbenchConnectionString, EWHQConnStr);
                                CalculateComponentArticleCost_V2210(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle);
                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }
                        }
                        else
                        {
                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetailEWHQ.CreationDate;
                                }

                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                {
                                    currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetailEWHQ.IdCurrency), poDetailEWHQ.CreationDate);

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);


                                }
                                else
                                {

                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                }


                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }



                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {

                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetail.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetail.CreationDate;
                                }
                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetail.IdCurrency))
                                {
                                    currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetail.IdCurrency), poDetail.CreationDate);

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                }
                                else
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity));
                                }

                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }


                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                                //GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateComponentArticleCost_V2210(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                                {
                                    CalculateComponentArticleCost_V2210(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle);
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }
                            }
                            else
                            {

                                float parentQty = 0;
                                bool isParentQty = false;
                                if (idArticle != item.IdArticle)
                                {
                                    isParentQty = true;
                                    if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                        parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                                }
                                if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                                {

                                    if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                    {
                                        ExchangeRateDate = poDetailEWHQ.CreationDate;
                                    }

                                    CurrencyConversion currencyConversion = null;
                                    if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                    {
                                        currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetailEWHQ.IdCurrency), poDetailEWHQ.CreationDate);
                                    }
                                    if (currencyConversion != null)
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                    }
                                    else
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }


                            }
                        }
                    }
                }
            }
            else
            {
                FinalArticleCostValue = 0;
                return;
            }

        }


        public List<BPLDetection> GetAllDetections_V2220(string PLMConnectionString)
        {
            List<BPLDetection> DetectionList = new List<BPLDetection>();
            try
            {
                DetectionList.AddRange(GetAllDetectionTypes(PLMConnectionString));
                DetectionList.AddRange(GetAllDetectionGroups(PLMConnectionString));

                int i = 1;

                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllDetections_V2220", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BPLDetection detection = new BPLDetection();
                            detection.KeyName = Convert.ToString(i);
                            detection.IdDetection = Convert.ToUInt32(reader["IdDetection"]);
                            detection.IdDetectionType = Convert.ToUInt32(reader["IdDetectionType"]);
                            if (reader["Name"] != DBNull.Value)
                            {
                                detection.Name = Convert.ToString(reader["Name"]);
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                detection.Description = Convert.ToString(reader["Description"]);
                            }

                            if (reader["ParentName"] != DBNull.Value)
                            {
                                detection.ParentName = Convert.ToString(reader["ParentName"]);
                            }
                            if (reader["IdGroup"] != DBNull.Value)
                            {
                                detection.IdGroup = Convert.ToUInt32(reader["IdGroup"]);
                            }
                            if (reader["DetectionTypeName"] != DBNull.Value)
                            {
                                detection.DetectionTypeName = Convert.ToString(reader["DetectionTypeName"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                detection.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["StatusAbbreviation"] != DBNull.Value)
                            {
                                detection.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                            }
                            if (reader["StatusHtmlColor"] != DBNull.Value)
                            {
                                detection.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                            }
                            DetectionList.Add(detection);

                            i++;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDetections_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return DetectionList;
        }


        public async Task<List<ErrorDetails>> IsPLMAddEditBasePriceSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BasePriceListByPlantCurrency itemPlantCurrency, DataTable DtArticle)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {
                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {

                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);

                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);
                            string references = string.Join(",", DtArticle.AsEnumerable().Select(s => s.Field<string>("Reference")).ToList());

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                            {
                                string linkURL = null;

                                linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemPlantCurrency.PlantName, itemPlantCurrency.CurrencyName, references.Trim());

                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");

                                using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                }

                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {
                                    errorMessage = "Articles Synchronization is Done for plant " + itemPlantCurrency.PlantName + " and currency " + itemPlantCurrency.CurrencyName + "";
                                    ErrorDetails errorDetails = new ErrorDetails();
                                    errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                    errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                    errorDetails.Error = string.Empty;
                                    LstErrorDetail.Add(errorDetails);
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                }
                            }


                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemPlantCurrency.PlantName, itemPlantCurrency.CurrencyName), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                }

                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {


                                    errorMessage = "Detections Synchronization is done for plant " + itemPlantCurrency.PlantName + " and currency " + itemPlantCurrency.CurrencyName + "";
                                    ErrorDetails errorDetails = new ErrorDetails();
                                    errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                    errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                    errorDetails.Error = string.Empty;
                                    LstErrorDetail.Add(errorDetails);
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {

                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {

                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                }
                            }
                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = "Wrong Token Information";
                            LstErrorDetail.Add(errorDetails);
                        }

                    }
                }

            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }
            return LstErrorDetail;
        }
        public async Task<List<ErrorDetails>> IsPLMUpdateEditBasePriceSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BasePriceListByPlantCurrency itemBasePriceListByPlantCurrency, List<Articles> LstArticles)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {

                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {

                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);

                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);
                            List<string> articlesSynchronization = new List<string>();
                            List<Site> plantSynchronization = new List<Site>();
                            List<Currency> currencySynchronization = new List<Currency>();
                            string references = string.Join(",", articlesSynchronization.ToArray());

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                            {
                                string linkURL = null;

                                linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBasePriceListByPlantCurrency.PlantName, itemBasePriceListByPlantCurrency.CurrencyName, references.Trim());

                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                }
                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {
                                    errorMessage = "Articles Synchronization is Done for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                    ErrorDetails errorDetails = new ErrorDetails();
                                    errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                    errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                    errorDetails.Error = string.Empty;
                                    LstErrorDetail.Add(errorDetails);
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                }



                            }

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemBasePriceListByPlantCurrency.PlantName, itemBasePriceListByPlantCurrency.CurrencyName), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                }

                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {
                                    errorMessage = "Detections Synchronization is done for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                    ErrorDetails errorDetails = new ErrorDetails();
                                    errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                    errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                    errorDetails.Error = string.Empty;
                                    LstErrorDetail.Add(errorDetails);
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                        errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                }




                            }


                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = "Wrong Token Information";
                            LstErrorDetail.Add(errorDetails);
                        }

                    }
                }

            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }
            return LstErrorDetail;
        }

        public async Task<List<ErrorDetails>> IsPLMAddEditCPLCustomerSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBPLPlantCurrencyDetail, DataColumn[] columns, DataTable DtArticle)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {
                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {

                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);

                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);
                            string references = string.Join(",", DtArticle.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() != "0")).Select(s => s.Field<string>("Reference")).ToList());

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                            {
                                string linkURL = null;

                                linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBPLPlantCurrencyDetail.CompanyName, itemBPLPlantCurrencyDetail.CurrencyName, references.Trim());

                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                }
                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {
                                    errorMessage = "Articles Synchronization is Done for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";
                                    ErrorDetails errorDetails = new ErrorDetails();
                                    errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                    errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                    errorDetails.Error = string.Empty;
                                    LstErrorDetail.Add(errorDetails);
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                }

                            }

                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemBPLPlantCurrencyDetail.CompanyName, itemBPLPlantCurrencyDetail.CurrencyName), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                }


                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {
                                    errorMessage = "Detections Synchronization is done for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";
                                    ErrorDetails errorDetails = new ErrorDetails();
                                    errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                    errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                    errorDetails.Error = string.Empty;
                                    LstErrorDetail.Add(errorDetails);
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                }




                            }




                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = "Wrong Token Information";
                            LstErrorDetail.Add(errorDetails);

                        }

                    }
                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }
            return LstErrorDetail;
        }

        public async Task<List<ErrorDetails>> IsPLMUpdateEditCPLCustomerSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBasePriceListByPlantCurrency, List<Articles> LstArticles)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {


                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {

                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {
                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);

                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);
                            List<string> articlesSynchronization = new List<string>();
                            if (articlesSynchronization != null && articlesSynchronization.Count > 0 && itemBasePriceListByPlantCurrency != null)
                            {

                                string references = string.Join(",", articlesSynchronization.ToArray());

                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                                {
                                    string linkURL = null;

                                    linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBasePriceListByPlantCurrency.CompanyName, itemBasePriceListByPlantCurrency.CurrencyName, references.Trim());

                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }
                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        errorMessage = "Articles Synchronization is Done for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                    }






                                }
                            }
                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                            {
                                StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemBasePriceListByPlantCurrency.CompanyName, itemBasePriceListByPlantCurrency.CurrencyName), httpContent))
                                {
                                    responseProduct.EnsureSuccessStatusCode();
                                    string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                    if (responseBody.Contains("false"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    else if (responseBody.Contains("true"))
                                        values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                    else
                                        valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                }


                                if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                {
                                    errorMessage = "Detections Synchronization is done for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                    ErrorDetails errorDetails = new ErrorDetails();
                                    errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                    errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                    errorDetails.Error = string.Empty;
                                    LstErrorDetail.Add(errorDetails);
                                }
                                else
                                {
                                    if (values != null && values.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                        errorDetails.Error = values.Message._Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                    else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                    {
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                        errorDetails.Error = valuesErrorFalse.Message;
                                        LstErrorDetail.Add(errorDetails);

                                    }
                                }
                            }



                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = "Wrong Token Information";
                            LstErrorDetail.Add(errorDetails);

                        }

                    }
                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }
            return LstErrorDetail;
        }

        public async Task<List<ErrorDetails>> IsPLMSynchronization(string connectionString, List<GeosAppSetting> GeosAppSettingList, BPLPlantCurrencyDetail itemBPLPlantCurrency, string Details, string Name)
        {
            ITokenService tokenService;
            string errorMessage = string.Empty;
            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
            try
            {
                APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                APIErrorDetail values = new APIErrorDetail();
                tokenService = new AuthTokenService();
                if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                {

                    string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                    if (tokeninformations.Count() >= 2)
                    {

                        // Set to use TLS 1.2 or higher
                        System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12; // Use TLS 1.2 (supported in .NET Framework)
                        HttpClientHandler handler = new HttpClientHandler();
                        handler.ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true;

                        var token = new AuthToken();
                        //var client = new HttpClient();
                        var client = new HttpClient(handler);
                        client.Timeout = TimeSpan.FromMinutes(20);
                        var client_id = tokeninformations[1];
                        var client_secret = tokeninformations[2];
                        var clientCreds = System.Text.Encoding.UTF8.GetBytes($"{client_id}:{client_secret}");
                        client.DefaultRequestHeaders.Authorization =
                            new AuthenticationHeaderValue("Basic", System.Convert.ToBase64String(clientCreds));

                        var postMessage = new Dictionary<string, string>();
                        postMessage.Add("grant_type", "client_credentials");

                        var request = new HttpRequestMessage(HttpMethod.Post, tokeninformations[0])
                        {
                            Content = new FormUrlEncodedContent(postMessage)
                        };

                        var response = await client.SendAsync(request);
                        if (response.IsSuccessStatusCode)
                        {
                            var json = await response.Content.ReadAsStringAsync();
                            token = JsonConvert.DeserializeObject<AuthToken>(json);
                            token.ExpiresAt = DateTime.UtcNow.AddSeconds(token.ExpiresIn);

                            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token.AccessToken);

                            if (Name.ToUpper() == "PRODUCT PRICES")
                            {
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 61) && itemBPLPlantCurrency != null)
                                {
                                    string linkURL = null;
                                    if (string.IsNullOrEmpty(Details.Trim()))
                                    {

                                        linkURL = string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName);
                                    }
                                    else
                                    {

                                        linkURL = string.Format("{0}?plant={1}&currency={2}&references={3}", GeosAppSettingList.Where(i => i.IdAppSetting == 61).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName, Details.Trim());
                                    }
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(linkURL, httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);


                                    }
                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        errorMessage = "Synchronization is Done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                        }
                                    }
                                }
                            }
                            else if (Name.ToUpper() == "DETECTION PRICES")
                            {
                                if (GeosAppSettingList.Any(i => i.IdAppSetting == 60) && itemBPLPlantCurrency != null)
                                {
                                    StringContent httpContent = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                                    using (HttpResponseMessage responseProduct = await client.PostAsync(string.Format("{0}?plant={1}&currency={2}", GeosAppSettingList.Where(i => i.IdAppSetting == 60).FirstOrDefault().DefaultValue, itemBPLPlantCurrency.CompanyName, itemBPLPlantCurrency.CurrencyName), httpContent))
                                    {
                                        responseProduct.EnsureSuccessStatusCode();
                                        string responseBody = await responseProduct.Content.ReadAsStringAsync();

                                        if (responseBody.Contains("false"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("461"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else if (responseBody.Contains("true") && responseBody.Contains("500"))
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                        else if (responseBody.Contains("true"))
                                            values = JsonConvert.DeserializeObject<APIErrorDetail>(responseBody);
                                        else
                                            valuesErrorFalse = JsonConvert.DeserializeObject<APIErrorDetailForErrorFalse>(responseBody);
                                    }
                                    if (valuesErrorFalse != null && valuesErrorFalse.Error == "false")
                                    {
                                        errorMessage = "Synchronization is done for plant " + itemBPLPlantCurrency.CompanyName + " and currency " + itemBPLPlantCurrency.CurrencyName + "";
                                        ErrorDetails errorDetails = new ErrorDetails();
                                        errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                        errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                        errorDetails.Error = string.Empty;
                                        LstErrorDetail.Add(errorDetails);
                                    }
                                    else
                                    {
                                        if (values != null && values.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = values.Message._Message;
                                            LstErrorDetail.Add(errorDetails);
                                            Details = string.Empty;
                                        }
                                        else if (valuesErrorFalse != null && valuesErrorFalse.Message != null)
                                        {
                                            ErrorDetails errorDetails = new ErrorDetails();
                                            errorDetails.CompanyName = itemBPLPlantCurrency.CompanyName;
                                            errorDetails.CurrencyName = itemBPLPlantCurrency.CurrencyName;
                                            errorDetails.Error = valuesErrorFalse.Message;
                                            LstErrorDetail.Add(errorDetails);
                                            Details = string.Empty;
                                        }
                                    }


                                }
                            }
                            else
                            {

                                ErrorDetails errorDetails = new ErrorDetails();
                                errorDetails.CompanyName = null;
                                errorDetails.CurrencyName = null;
                                errorDetails.Error = values.Message._Message;
                                LstErrorDetail.Add(errorDetails);
                            }

                        }
                        else
                        {
                            ErrorDetails errorDetails = new ErrorDetails();
                            errorDetails.CompanyName = null;
                            errorDetails.CurrencyName = null;
                            errorDetails.Error = "Wrong Token Information";
                            LstErrorDetail.Add(errorDetails);
                        }

                    }
                }
            }
            catch (Exception ex)
            {
                errorMessage = "ECOSSynchronizationFailed";
                ErrorDetails errorDetails = new ErrorDetails();
                errorDetails.Error = ex.Message;
                LstErrorDetail.Add(errorDetails);
            }
            return LstErrorDetail;
        }





        public List<AdditionalArticleCost> GetAllAddtionalArticleCost(string connectionString)
        {
            List<AdditionalArticleCost> additionalArticleCosts = new List<AdditionalArticleCost>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllCompanies", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            AdditionalArticleCost additionalArticleCost = new AdditionalArticleCost();

                            additionalArticleCost.IdSite = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Alias"] != DBNull.Value)
                                additionalArticleCost.SiteName = Convert.ToString(reader["Alias"]);

                            additionalArticleCosts.Add(additionalArticleCost);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error  GetAllAddtionalArticleCost(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return additionalArticleCosts;
        }

        public List<AdditionalArticleCost> GetAllAddedAdditionalArticleCost(string workbenchConnectionString, string connectionString)
        {
            List<AdditionalArticleCost> additionalArticleCosts = new List<AdditionalArticleCost>();
            try
            {
                additionalArticleCosts = GetAllAddtionalArticleCost(workbenchConnectionString);

                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllArticleAdditionalCost", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (additionalArticleCosts.Any(x => x.IdSite == Convert.ToInt32(reader["IdCompany"])))
                            {
                                AdditionalArticleCost additionalArticleCost = additionalArticleCosts.Where(x => x.IdSite == Convert.ToInt32(reader["IdCompany"])).FirstOrDefault();

                                if (reader["TransportCostValue"] != DBNull.Value)
                                    additionalArticleCost.Transport = (float)reader["TransportCostValue"];

                                if (reader["CustomsCostValue"] != DBNull.Value)
                                    additionalArticleCost.Customs = (float)reader["CustomsCostValue"];
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error  GetAllAddedAdditionalArticleCost(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return additionalArticleCosts;
        }


        //[GEOS2-2999]
        public bool CalculateArticleCostPrice_V2220(Company itemCompany, string mainServerConnectionString, string workbenchConnectionString)
        {
            UserManager userManager = new UserManager();
            List<GeosAppSetting> GeosAppSettingList;
            bool isCalculated = true;
            int NumberPOAvg = 0;
            List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
            List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
            string connectionstring = itemCompany.ConnectPlantConstr;
            List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);

            List<PODetail> EWHQpoDetailLst = GetAllArticleMaxPODeliveryDateDetailFromEWHQ_V2210(connectionstring);
            List<PODetail> EWHQArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromEWHQ_V2210(connectionstring);
            List<ArticlesByArticle> LstAllArticlesByArticle = GetAllArticlesByArticle(connectionstring);

            List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail_V2210(itemCompany.ConnectPlantConstr);
            List<PODetail> ArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromPlant_V2210(itemCompany.ConnectPlantConstr);
            // allPCMidsArticles.Where(pa => pa == 6951)

            GeosAppSettingList = userManager.GetSelectedGeosAppSettings(workbenchConnectionString, "63");
            if (GeosAppSettingList != null && GeosAppSettingList.Count > 0)
            {
                NumberPOAvg = Convert.ToInt32(GeosAppSettingList.FirstOrDefault().DefaultValue);
            }

            AdditionalArticleCost additionalArticleCost = GetAdditionalArticleCostDetail_V2220(connectionstring, itemCompany.IdCompany);

            foreach (UInt64 itemArticle in allPCMidsArticles)
            {
              
                try
                {
                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                    PODetail poDetail = null;
                    try
                    {
                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
                        poDetail = null;
                    }

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                            {
                                //List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));
                                List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                FinalArticleCostValue = 0;
                                FinalArticleAdditionalCost = 0;
                                FinalArticleCostAvg = 0;
                                ExchangeRateDate = DateTime.MinValue;
                                IdCurrency = 0;
                                if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                {
                                    CalculateComponentArticleCost_V2220(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle), NumberPOAvg, additionalArticleCost);
                                    if (FinalArticleCostValue > 0)
                                    {
                                        articleCostPrice.IdArticle = itemArticle;
                                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                            articleCostPrice.ArticleAdditionalCost = FinalArticleAdditionalCost;
                                        if (FinalArticleAdditionalCost != 0)
                                        {
                                            FinalArticleCostValue = FinalArticleCostValue * (FinalArticleAdditionalCost / 100);
                                        }
                                        articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                        articleCostPrice.ArticleCostValueAVG = FinalArticleCostAvg;
                                        articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                        articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                        if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                        {
                                            try
                                            {

                                                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                {
                                                    mySqlConnection.Open();
                                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2220", mySqlConnection);
                                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                    mySqlCommand.CommandTimeout = 3000;

                                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                                    mySqlCommand.ExecuteNonQuery();
                                                    mySqlConnection.Close();

                                                }

                                                isCalculated = true;
                                            }
                                            catch (Exception ex)
                                            {

                                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                isCalculated = false;

                                            }

                                        }
                                    }
                                }
                            }
                        }
                        else
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;

                            if (additionalArticleCost != null)
                            {
                                float transport = 0;
                                float customs = 0;
                               
                                articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                if (additionalArticleCost.Transport.Value > 0)
                                {
                                    transport = additionalArticleCost.Transport.Value / 100;
                                }
                                if (additionalArticleCost.Customs.Value > 0)
                                {
                                    customs = additionalArticleCost.Customs.Value / 100;
                                }
                                if (transport != 0 || customs != 0)
                                {
                                    articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                }

                            }
                            articleCostPrice.ArticleCostValueAVG = GetPOAverageByIdArticleEWHQ(connectionstring, itemArticle, NumberPOAvg);
                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2220", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
                            if (additionalArticleCost != null)
                            {
                                float transport = 0;
                                float customs = 0;
                                articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                if (additionalArticleCost.Transport.Value > 0)
                                {
                                    transport = additionalArticleCost.Transport.Value / 100;
                                }
                                if (additionalArticleCost.Customs.Value > 0)
                                {
                                    customs = additionalArticleCost.Customs.Value / 100;
                                }
                                if (transport != 0 || customs != 0)
                                {
                                    articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                }

                            }
                            articleCostPrice.ArticleCostValueAVG = GetPOAverageByIdArticle(connectionstring, Convert.ToInt32(itemArticle), NumberPOAvg);
                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2220", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                                {
                                    List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                    FinalArticleCostValue = 0;
                                    
                                    FinalArticleAdditionalCost = 0;
                                    FinalArticleCostAvg = 0;
                                    ExchangeRateDate = DateTime.MinValue;
                                    IdCurrency = 0;
                                    if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                    {
                                        CalculateComponentArticleCost_V2220(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle), NumberPOAvg, additionalArticleCost);
                                        if (FinalArticleCostValue > 0)
                                        {
                                            articleCostPrice.IdArticle = itemArticle;
                                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                            
                                            articleCostPrice.ArticleAdditionalCost = FinalArticleAdditionalCost;
                                            if (FinalArticleAdditionalCost != 0)
                                            {
                                                FinalArticleCostValue = FinalArticleCostValue * (FinalArticleAdditionalCost / 100);
                                            }
                                            articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                            articleCostPrice.ArticleCostValueAVG = FinalArticleCostAvg;
                                            articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                            articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                            {
                                                try
                                                {

                                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                    {
                                                        mySqlConnection.Open();
                                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2220", mySqlConnection);
                                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                        mySqlCommand.CommandTimeout = 3000;

                                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                                        mySqlCommand.ExecuteNonQuery();
                                                        mySqlConnection.Close();

                                                    }

                                                    isCalculated = true;
                                                }
                                                catch (Exception ex)
                                                {

                                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                    isCalculated = false;

                                                }

                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                articleCostPrice.IdArticle = itemArticle;
                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                                if (additionalArticleCost != null)
                                {
                                    float transport = 0;
                                    float customs = 0;
                                    articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                    if (additionalArticleCost.Transport.Value > 0)
                                    {
                                        transport = additionalArticleCost.Transport.Value / 100;
                                    }
                                    if (additionalArticleCost.Customs.Value > 0)
                                    {
                                        customs = additionalArticleCost.Customs.Value / 100;
                                    }
                                    if (transport != 0 || customs != 0)
                                    {
                                        articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                    }

                                }
                                articleCostPrice.ArticleCostValueAVG = GetPOAverageByIdArticleEWHQ(connectionstring, itemArticle, NumberPOAvg);
                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                                if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                {
                                    try
                                    {

                                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                        {
                                            mySqlConnection.Open();
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2220", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                                            mySqlCommand.CommandTimeout = 3000;

                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                            mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();

                                        }

                                        isCalculated = true;
                                    }
                                    catch (Exception ex)
                                    {

                                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                        isCalculated = false;

                                    }

                                }
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    isCalculated = false;
                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2220(). ErrorMessage- {0} Company - {1} Article{2}", ex.Message, itemCompany.Alias, itemArticle), category: Category.Exception, priority: Priority.Low);
                    FinalArticleCostValue = 0;
                    ExchangeRateDate = DateTime.MinValue;
                    IdCurrency = 0;
                }
            }
            return isCalculated;
        }


        //[GEOS2-2999]
        public double GetPOAverageByIdArticle(string connectionstring, Int32 IdArticle, int NumberPOAvg)
        {
            double POAvg = 0;
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("PLM_GetPOAverageByIdArticle", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                consitecommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                consitecommand.Parameters.AddWithValue("_NoPOAvg", NumberPOAvg);
                using (MySqlDataReader reader = consitecommand.ExecuteReader())
                {
                    if (reader.Read())
                    {

                        if (reader["POAvg"] != DBNull.Value)
                            POAvg = Convert.ToDouble(reader["POAvg"]);

                    }
                }
            }
            return POAvg;
        }
        //[GEOS2-2999]
        public double GetPOAverageByIdArticleEWHQ(string plantconnectionstring, ulong IdArticle, int NumberPOAvg)
        {
            double POAvg = 0;
            string connectionstring = GetEWHQDatabaseDetail(plantconnectionstring);
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("PLM_GetPOAverageByIdArticleEWHQ", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                consitecommand.Parameters.AddWithValue("_IdArticle", IdArticle);
                consitecommand.Parameters.AddWithValue("_NoPOAvg", NumberPOAvg);
                using (MySqlDataReader reader = consitecommand.ExecuteReader())
                {
                    if (reader.Read())
                    {

                        if (reader["POAvg"] != DBNull.Value)
                            POAvg = Convert.ToDouble(reader["POAvg"]);

                    }
                }
            }
            return POAvg;
        }
        //[GEOS2-2999]
        public bool IsExistRecord_V2220(string connectionstring, ArticleCostPrice articleCostPrice)
        {
            bool isExist = false;

            using (MySqlConnection con = new MySqlConnection(connectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("PLM_check_article_details_exists_V2220", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                concommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                concommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                concommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                concommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                concommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                concommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    if (reader.Read())
                    {

                        if (reader["IdArticleCostPrice"] != DBNull.Value)
                            isExist = true;
                    }
                }
            }
            return isExist;
        }
        //GEOS2-2999
        public void CalculateComponentArticleCost_V2220(List<ArticlesByArticle> LstArticlesByArticle, Company plant, string workbenchConnectionString, List<ArticlesByArticle> LstAllArticlesByArticle, List<PODetail> ArticlesByArticleComponentpoDetailLst, List<PODetail> EWHQArticlesByArticleComponentpoDetailLst, Int32 idArticle, Int32 NumberPOAvg, AdditionalArticleCost additionalArticleCost)
        {
            if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
            {
                foreach (ArticlesByArticle item in LstArticlesByArticle)
                {
                    PODetail poDetail = ArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                    //GetArticleMaxPODeliveryDateDetail(plant.ConnectPlantConstr, item.IdComponent);

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                            // GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateComponentArticleCost_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                            {
                                // CalculateComponentArticleCost(GetAllArticlesByArticle(plant.ConnectPlantConstr, item.IdComponent), plant, workbenchConnectionString, EWHQConnStr);
                                CalculateComponentArticleCost_V2220(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle, NumberPOAvg, additionalArticleCost);
                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }
                        }
                        else
                        {
                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetailEWHQ.CreationDate;
                                }

                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                {
                                    currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetailEWHQ.IdCurrency), poDetailEWHQ.CreationDate);

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByIdArticleEWHQ(plant.ConnectPlantConstr, poDetailEWHQ.IdArticle, NumberPOAvg);
                                    if (additionalArticleCost != null)
                                    {
                                       
                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);
                                       

                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByIdArticleEWHQ(plant.ConnectPlantConstr, poDetailEWHQ.IdArticle, NumberPOAvg);

                                    if (additionalArticleCost != null)
                                    {
                                      
                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);
                                      

                                    }
                                }


                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }



                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {

                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetail.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetail.CreationDate;
                                }
                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetail.IdCurrency))
                                {
                                    currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetail.IdCurrency), poDetail.CreationDate);

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByIdArticle(plant.ConnectPlantConstr, Convert.ToInt32(poDetail.IdArticle), NumberPOAvg);
                                    if (additionalArticleCost != null)
                                    {
                                       
                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);
                                      

                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity));
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByIdArticle(plant.ConnectPlantConstr, Convert.ToInt32(poDetail.IdArticle), NumberPOAvg);
                                    if (additionalArticleCost != null)
                                    {
                                       
                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);
                                       

                                    }
                                }

                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }


                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                                //GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateComponentArticleCost_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                                {
                                    CalculateComponentArticleCost_V2220(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle, NumberPOAvg, additionalArticleCost);
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }
                            }
                            else
                            {

                                float parentQty = 0;
                                bool isParentQty = false;
                                if (idArticle != item.IdArticle)
                                {
                                    isParentQty = true;
                                    if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                        parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                                }
                                if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                                {

                                    if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                    {
                                        ExchangeRateDate = poDetailEWHQ.CreationDate;
                                    }

                                    CurrencyConversion currencyConversion = null;
                                    if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                    {
                                        currencyConversion = GetCurrencyConversionByTOFROMDATE(workbenchConnectionString, Convert.ToByte(plant.IdCurrency), Convert.ToByte(poDetailEWHQ.IdCurrency), poDetailEWHQ.CreationDate);
                                    }
                                    if (currencyConversion != null)
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                        FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByIdArticleEWHQ(plant.ConnectPlantConstr, poDetailEWHQ.IdArticle, NumberPOAvg);
                                        if (additionalArticleCost != null)
                                        {
                                           
                                            FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);
                                           

                                        }
                                    }
                                    else
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                        FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByIdArticleEWHQ(plant.ConnectPlantConstr, poDetailEWHQ.IdArticle, NumberPOAvg);
                                        if (additionalArticleCost != null)
                                        {
                                           
                                            FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);
                                           

                                        }
                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }


                            }
                        }
                    }
                }
            }
            else
            {
                FinalArticleCostValue = 0;
                return;
            }

        }

        //[GEOS2-2999]
        public AdditionalArticleCost GetAdditionalArticleCostDetail_V2220(string connectionstring, Int32 IdCompany)
        {
            AdditionalArticleCost additionalArticleCost = null;
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("PLM_GetAdditionalArticleCost_V2220", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                consitecommand.Parameters.AddWithValue("_IdSite", IdCompany);
                using (MySqlDataReader reader = consitecommand.ExecuteReader())
                {
                    if (reader.Read())
                    {
                        additionalArticleCost = new AdditionalArticleCost();
                        if (reader["IdCompany"] != DBNull.Value)
                            additionalArticleCost.IdSite = Convert.ToInt32(reader["IdCompany"]);
                        if (reader["Transport"] != DBNull.Value)
                            additionalArticleCost.Transport = (float)reader["Transport"];
                        if (reader["Customs"] != DBNull.Value)
                            additionalArticleCost.Customs = (float)reader["Customs"];

                    }
                }
            }
            return additionalArticleCost;
        }

           

        //GEOS2-3511
        //GEOS2-3511

        public List<Users> GetAllUsersList(string workbenchConnectionString)
        {
            List<Users> users = new List<Users>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PCM_GetAllUser", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Users user = new Users();
                            if (reader["IdUser"] != DBNull.Value)
                                user.IdUser = Convert.ToInt32(reader["IdUser"]);
                            if (reader["Name"] != DBNull.Value)
                                user.Name = reader["Name"].ToString();

                            users.Add(user);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllUsers(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return users;
        }
            
        

        public bool InsertUpdateUserPermissionByBPLForParticularColumn(UserPermissionByBPLPriceList userPermissionByBPLPriceList, string PLMConnectionString)
        {
            bool isupdated = false;
            userPermissionByBPLPriceList.IdUserPermissionByBPLPriceList = 0;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    using (MySqlTransaction trans = mySqlConnection.BeginTransaction())
                    {
                        try
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_UserPermissionByBPLPriceList_Insert_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdUser_permission_by_BPL_Price_List", userPermissionByBPLPriceList.IdUserPermissionByBPLPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdPermission", userPermissionByBPLPriceList.Permission.IdPermission);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", userPermissionByBPLPriceList.User.IdUser);
                            if (userPermissionByBPLPriceList.BasePrice.IdBasePriceList != 0)
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", userPermissionByBPLPriceList.BasePrice.IdBasePriceList);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", DBNull.Value);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", userPermissionByBPLPriceList.IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", userPermissionByBPLPriceList.CreationDate);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedBy", userPermissionByBPLPriceList.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", userPermissionByBPLPriceList.ModificationDate);
                            mySqlCommand.Transaction = trans;
                            mySqlCommand.ExecuteNonQuery();
                            isupdated = true;
                            trans.Commit();
                        }
                        catch (Exception ex)
                        {
                            trans.Rollback();
                            throw;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateUserPermissionByBPLForParticularColumn(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isupdated;
        }

        public bool InsertUpdateUserPermissionByCPLForParticularColumn(UserPermissionByCPLPriceList userPermissionByCPLPriceList, string PLMConnectionString)
        {
            bool isupdated = false;
            userPermissionByCPLPriceList.IdUserPermissionByCPLPriceList = 0;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    using (MySqlTransaction trans = mySqlConnection.BeginTransaction())
                    {
                        try
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_UserPermissionByCPLPriceList_Insert_Update", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdUser_permission_by_CPL_Price_List", userPermissionByCPLPriceList.IdUserPermissionByCPLPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdPermission", userPermissionByCPLPriceList.Permission.IdPermission);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", userPermissionByCPLPriceList.User.IdUser);
                            if (userPermissionByCPLPriceList.CustomerPrice.IdCustomerPriceList != 0)
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", userPermissionByCPLPriceList.CustomerPrice.IdCustomerPriceList);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", DBNull.Value);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", userPermissionByCPLPriceList.IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", userPermissionByCPLPriceList.CreationDate);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedBy", userPermissionByCPLPriceList.IdModifier);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", userPermissionByCPLPriceList.ModificationDate);
                            mySqlCommand.Transaction = trans;
                            mySqlCommand.ExecuteNonQuery();
                            isupdated = true;
                            trans.Commit();
                        }
                        catch (Exception ex)
                        {
                            trans.Rollback();
                            throw;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateUserPermissionByCPLForParticularColumn(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isupdated;
        }

        //GEOS2-3511


        public List<BasePrice> GetBasePriceListItem_User_ById(string PLMConnectionString, int IdUser, string currencyIconFilePath)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItem_User_ById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                basePrice.IdPermission = reader["IdPermission"].ToString();
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == basePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(basePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["BPLInCPL"]) > 0)
                                    basePrice.IsBPLExistInCPL = true;
                            }

                            basePrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = item;
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                basePrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItem_User_ById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                basePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);

            }
            return basePrices;
        }


        public List<CustomerPrice> GetCustomerPriceListItem_User_ById(string PLMConnectionString, int IdUser, string currencyIconFilePath)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItem_User_Id", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]).Trim();

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                customerPrice.IdPermission = reader["IdPermission"].ToString();
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == customerPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(customerPrice.Currency.Name);
                                    }
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                customerPrice.SaleCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }

                            if (reader["CustGroup"] != DBNull.Value)
                            {
                                List<string> tempDifferentGroup = Convert.ToString(reader["CustGroup"]).Split('\n').ToList<string>();
                                tempDifferentGroup = tempDifferentGroup.Distinct().ToList();
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        tempDifferentGroup.Add("ALL");
                                }
                                customerPrice.Group = string.Join("\n", tempDifferentGroup.ToArray());
                            }
                            else
                            {
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        customerPrice.Group = "ALL";
                                }
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                customerPrice.Country = customerPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        customerPrice.Country = "ALL";
                                }
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempDifferentRegionName = Convert.ToString(reader["RegionName"]).Split('\n').ToList<string>();
                                tempDifferentRegionName = tempDifferentRegionName.Distinct().ToList();

                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        tempDifferentRegionName.Add("ALL");
                                }

                                customerPrice.Region = customerPrice.Region + string.Join("\n", tempDifferentRegionName.ToArray());
                            }
                            else
                            {
                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        customerPrice.Region = "ALL";
                                }
                            }

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlantName = Convert.ToString(reader["PlantName"]).Split('\n').ToList<string>();
                                tempDifferentPlantName = tempDifferentPlantName.Distinct().ToList();
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        tempDifferentPlantName.Add("ALL");
                                }
                                customerPrice.Plant = customerPrice.Plant + string.Join("\n", tempDifferentPlantName.ToArray());
                            }
                            else
                            {
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        customerPrice.Plant = "ALL";
                                }
                            }
                            customerPrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = Convert.ToString(item);
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                customerPrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }

                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesListItem_User_ById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                customerPrices.Where(cp => cp.Currency.Name == item).ToList().ForEach(cp => cp.Currency.CurrencyIconbytes = bytes);

            }
            return customerPrices;
        }

        //GEOS2-3511


        public List<BasePrice> GetBasePriceListByDates(string PLMConnectionString, string currencyIconFilePath, DateTime fromDate, DateTime toDate)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListByDates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_FromDate", fromDate);
                    mySqlCommand.Parameters.AddWithValue("_ToDate", toDate);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == basePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(basePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["BPLInCPL"]) > 0)
                                    basePrice.IsBPLExistInCPL = true;
                            }

                            basePrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = item;
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                basePrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListByDates(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                basePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);

            }
            return basePrices;
        }

        public List<CustomerPrice> GetCustomerPriceListByDates(string PLMConnectionString, string currencyIconFilePath, DateTime fromDate, DateTime toDate)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListByDates", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_FromDate", fromDate);
                    mySqlCommand.Parameters.AddWithValue("_ToDate", toDate);
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]).Trim();

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == customerPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(customerPrice.Currency.Name);
                                    }
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                customerPrice.SaleCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }

                            if (reader["CustGroup"] != DBNull.Value)
                            {
                                List<string> tempDifferentGroup = Convert.ToString(reader["CustGroup"]).Split('\n').ToList<string>();
                                tempDifferentGroup = tempDifferentGroup.Distinct().ToList();
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        tempDifferentGroup.Add("ALL");
                                }
                                customerPrice.Group = string.Join("\n", tempDifferentGroup.ToArray());
                            }
                            else
                            {
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        customerPrice.Group = "ALL";
                                }
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                customerPrice.Country = customerPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        customerPrice.Country = "ALL";
                                }
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempDifferentRegionName = Convert.ToString(reader["RegionName"]).Split('\n').ToList<string>();
                                tempDifferentRegionName = tempDifferentRegionName.Distinct().ToList();

                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        tempDifferentRegionName.Add("ALL");
                                }

                                customerPrice.Region = customerPrice.Region + string.Join("\n", tempDifferentRegionName.ToArray());
                            }
                            else
                            {
                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        customerPrice.Region = "ALL";
                                }
                            }

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlantName = Convert.ToString(reader["PlantName"]).Split('\n').ToList<string>();
                                tempDifferentPlantName = tempDifferentPlantName.Distinct().ToList();
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        tempDifferentPlantName.Add("ALL");
                                }
                                customerPrice.Plant = customerPrice.Plant + string.Join("\n", tempDifferentPlantName.ToArray());
                            }
                            else
                            {
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        customerPrice.Plant = "ALL";
                                }
                            }
                            customerPrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = Convert.ToString(item);
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                customerPrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }

                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListByDates(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                customerPrices.Where(cp => cp.Currency.Name == item).ToList().ForEach(cp => cp.Currency.CurrencyIconbytes = bytes);

            }
            return customerPrices;
        }


        //GEOS2-3511



        //GEOS2-3511

        //GEOS2-3511


        public List<UserPermissionByBPLPriceList> GetAllUserPermissionsByBPLPriceList(string PLMConnectionString, DateTime dtFrom, DateTime dtTo)
        {
            List<UserPermissionByBPLPriceList> allUserPermissionsByBPLPriceList = new List<UserPermissionByBPLPriceList>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllUserPermissionsByBPLPriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_PermissionsYearFrom", dtFrom);
                    mySqlCommand.Parameters.AddWithValue("_PermissionsYearTo", dtTo);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            UserPermissionByBPLPriceList userPermissionByBPLPriceList = new UserPermissionByBPLPriceList();

                            userPermissionByBPLPriceList.BasePrice = new BasePrice();
                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.BasePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.BasePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.BasePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }

                            userPermissionByBPLPriceList.User = new User();
                            userPermissionByBPLPriceList.User.IdUser = Convert.ToInt32(reader["IdUser"].ToString());

                            userPermissionByBPLPriceList.Permission = new Permission();
                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.Permission.IdPermission = Convert.ToInt32(reader["IdPermission"].ToString());
                            }

                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["ModifiedIn"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.ModificationDate = Convert.ToDateTime(reader["ModifiedIn"]);
                            }
                            if (reader["CreatedBy"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.IdCreator = uint.Parse(Convert.ToString(reader["CreatedBy"]));
                            }
                            if (reader["ModifiedBy"] != DBNull.Value)
                            {
                                userPermissionByBPLPriceList.IdModifier = uint.Parse(Convert.ToString(reader["ModifiedBy"]));
                            }

                            allUserPermissionsByBPLPriceList.Add(userPermissionByBPLPriceList);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllUserPermissionsByBPLPriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return allUserPermissionsByBPLPriceList;
        }

        public List<UserPermissionByCPLPriceList> GetAllUserPermissionsByCPLPriceList(string PLMConnectionString, DateTime dtFrom, DateTime dtTo)
        {
            List<UserPermissionByCPLPriceList> allUserPermissionsByCPLPriceList = new List<UserPermissionByCPLPriceList>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetAllUserPermissionsByCPLPriceList", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_PermissionsYearFrom", dtFrom);
                    mySqlCommand.Parameters.AddWithValue("_PermissionsYearTo", dtTo);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            UserPermissionByCPLPriceList userPermissionByCPLPriceList = new UserPermissionByCPLPriceList();
                            userPermissionByCPLPriceList.CustomerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.CustomerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["Code"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.CustomerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.CustomerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }

                            userPermissionByCPLPriceList.User = new User();
                            userPermissionByCPLPriceList.User.IdUser = Convert.ToInt32(reader["IdUser"].ToString());

                            userPermissionByCPLPriceList.Permission = new Permission();
                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.Permission.IdPermission = Convert.ToInt32(reader["IdPermission"].ToString());
                            }

                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["ModifiedIn"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.ModificationDate = Convert.ToDateTime(reader["ModifiedIn"]);
                            }
                            if (reader["CreatedBy"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.IdCreator = uint.Parse(Convert.ToString(reader["CreatedBy"]));
                            }
                            if (reader["ModifiedBy"] != DBNull.Value)
                            {
                                userPermissionByCPLPriceList.IdModifier = uint.Parse(Convert.ToString(reader["ModifiedBy"]));
                            }

                            allUserPermissionsByCPLPriceList.Add(userPermissionByCPLPriceList);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllUserPermissionsByCPLPriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return allUserPermissionsByCPLPriceList;
        }

        public bool DeleteUserPermissionByBPLForParticularColumn(string PLMConnectionString, Int32 idUser, UInt64 idBasePriceList)
        {
            bool isDelete = false;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    using (MySqlTransaction trans = mySqlConnection.BeginTransaction())
                    {
                        try
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_UserPermissionByBPLPriceList_Delete", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdUser", idUser);
                            if (idBasePriceList != 0)
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", idBasePriceList);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", DBNull.Value);

                            mySqlCommand.Transaction = trans;
                            mySqlCommand.ExecuteNonQuery();
                            trans.Commit();
                            isDelete = true;
                        }
                        catch (Exception ex)
                        {
                            trans.Rollback();
                            isDelete = false;
                            throw;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteUserPermissionByBPLForParticularColumn(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDelete;
        }

        public bool DeleteUserPermissionByCPLForParticularColumn(string PLMConnectionString, Int32 idUser, UInt64 idCustomerPriceList)
        {
            bool isDelete = false;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    using (MySqlTransaction trans = mySqlConnection.BeginTransaction())
                    {
                        try
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_UserPermissionByCPLPriceList_Delete", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdUser", idUser);
                            if (idCustomerPriceList != 0)
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", DBNull.Value);

                            mySqlCommand.Transaction = trans;
                            mySqlCommand.ExecuteNonQuery();
                            trans.Commit();
                            isDelete = true;
                        }
                        catch (Exception ex)
                        {
                            isDelete = false;
                            trans.Rollback();
                            throw;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteUserPermissionByCPLForParticularColumn(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDelete;
        }

        public bool DeleteUserPermissionByForParticularUser(string PLMConnectionString, Int32 idUser)
        {
            bool isDelete = false;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    using (MySqlTransaction trans = mySqlConnection.BeginTransaction())
                    {
                        try
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_UserPermissionByPriceList_Delete", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_IdUser", idUser);
                            mySqlCommand.Transaction = trans;
                            mySqlCommand.ExecuteNonQuery();
                            trans.Commit();
                            isDelete = true;
                        }
                        catch (Exception ex)
                        {
                            isDelete = false;
                            trans.Rollback();
                            throw;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteUserPermissionByForParticularUser(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isDelete;
        }

        // shubham[skadam] GEOS2-3851 Article_Cost_Price -> PK idarticle + idPlant  10 Aug 2022
        public bool CalculateArticleCostPrice_V2300(Company itemCompany, string mainServerConnectionString, string workbenchConnectionString)
        {
            UserManager userManager = new UserManager();
            List<GeosAppSetting> GeosAppSettingList;
            bool isCalculated = true;
            int NumberPOAvg = 0;
            List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
            List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
            string connectionstring = itemCompany.ConnectPlantConstr;
            List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);

            List<PODetail> EWHQpoDetailLst = GetAllArticleMaxPODeliveryDateDetailFromEWHQ_V2210(connectionstring);
            List<PODetail> EWHQArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromEWHQ_V2210(connectionstring);
            List<ArticlesByArticle> LstAllArticlesByArticle = GetAllArticlesByArticle(connectionstring);

            List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail_V2210(itemCompany.ConnectPlantConstr);
            List<PODetail> ArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromPlant_V2210(itemCompany.ConnectPlantConstr);
            // allPCMidsArticles.Where(pa => pa == 6951)

            GeosAppSettingList = userManager.GetSelectedGeosAppSettings(workbenchConnectionString, "63");
            if (GeosAppSettingList != null && GeosAppSettingList.Count > 0)
            {
                NumberPOAvg = Convert.ToInt32(GeosAppSettingList.FirstOrDefault().DefaultValue);
            }

            AdditionalArticleCost additionalArticleCost = GetAdditionalArticleCostDetail_V2220(connectionstring, itemCompany.IdCompany);

            foreach (UInt64 itemArticle in allPCMidsArticles)
            {

                try
                {
                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                    PODetail poDetail = null;
                    try
                    {
                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
                        poDetail = null;
                    }

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                            {
                                //List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));
                                List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                FinalArticleCostValue = 0;
                                FinalArticleAdditionalCost = 0;
                                FinalArticleCostAvg = 0;
                                ExchangeRateDate = DateTime.MinValue;
                                IdCurrency = 0;
                                if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                {
                                    CalculateComponentArticleCost_V2220(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle), NumberPOAvg, additionalArticleCost);
                                    if (FinalArticleCostValue > 0)
                                    {
                                        articleCostPrice.IdArticle = itemArticle;
                                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                        articleCostPrice.ArticleAdditionalCost = FinalArticleAdditionalCost;
                                        if (FinalArticleAdditionalCost != 0)
                                        {
                                            FinalArticleCostValue = FinalArticleCostValue * (FinalArticleAdditionalCost / 100);
                                        }
                                        articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                        articleCostPrice.ArticleCostValueAVG = FinalArticleCostAvg;
                                        articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                        articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                        if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                        {
                                            try
                                            {

                                                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                {
                                                    mySqlConnection.Open();
                                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                    mySqlCommand.CommandTimeout = 3000;

                                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                                    mySqlCommand.ExecuteNonQuery();
                                                    mySqlConnection.Close();

                                                }

                                                isCalculated = true;
                                            }
                                            catch (Exception ex)
                                            {

                                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                isCalculated = false;

                                            }

                                        }
                                    }
                                }
                            }
                        }
                        else
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;

                            if (additionalArticleCost != null)
                            {
                                float transport = 0;
                                float customs = 0;

                                articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                if (additionalArticleCost.Transport.Value > 0)
                                {
                                    transport = additionalArticleCost.Transport.Value / 100;
                                }
                                if (additionalArticleCost.Customs.Value > 0)
                                {
                                    customs = additionalArticleCost.Customs.Value / 100;
                                }
                                if (transport != 0 || customs != 0)
                                {
                                    articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                }

                            }
                            articleCostPrice.ArticleCostValueAVG = GetPOAverageByIdArticleEWHQ(connectionstring, itemArticle, NumberPOAvg);
                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
                            if (additionalArticleCost != null)
                            {
                                float transport = 0;
                                float customs = 0;
                                articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                if (additionalArticleCost.Transport.Value > 0)
                                {
                                    transport = additionalArticleCost.Transport.Value / 100;
                                }
                                if (additionalArticleCost.Customs.Value > 0)
                                {
                                    customs = additionalArticleCost.Customs.Value / 100;
                                }
                                if (transport != 0 || customs != 0)
                                {
                                    articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                }

                            }
                            articleCostPrice.ArticleCostValueAVG = GetPOAverageByIdArticle(connectionstring, Convert.ToInt32(itemArticle), NumberPOAvg);
                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                                {
                                    List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                    FinalArticleCostValue = 0;

                                    FinalArticleAdditionalCost = 0;
                                    FinalArticleCostAvg = 0;
                                    ExchangeRateDate = DateTime.MinValue;
                                    IdCurrency = 0;
                                    if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                    {
                                        CalculateComponentArticleCost_V2220(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle), NumberPOAvg, additionalArticleCost);
                                        if (FinalArticleCostValue > 0)
                                        {
                                            articleCostPrice.IdArticle = itemArticle;
                                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);

                                            articleCostPrice.ArticleAdditionalCost = FinalArticleAdditionalCost;
                                            if (FinalArticleAdditionalCost != 0)
                                            {
                                                FinalArticleCostValue = FinalArticleCostValue * (FinalArticleAdditionalCost / 100);
                                            }
                                            articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                            articleCostPrice.ArticleCostValueAVG = FinalArticleCostAvg;
                                            articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                            articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                            {
                                                try
                                                {

                                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                    {
                                                        mySqlConnection.Open();
                                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                        mySqlCommand.CommandTimeout = 3000;

                                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                                        mySqlCommand.ExecuteNonQuery();
                                                        mySqlConnection.Close();

                                                    }

                                                    isCalculated = true;
                                                }
                                                catch (Exception ex)
                                                {

                                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                    isCalculated = false;

                                                }

                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                articleCostPrice.IdArticle = itemArticle;
                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                                if (additionalArticleCost != null)
                                {
                                    float transport = 0;
                                    float customs = 0;
                                    articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                    if (additionalArticleCost.Transport.Value > 0)
                                    {
                                        transport = additionalArticleCost.Transport.Value / 100;
                                    }
                                    if (additionalArticleCost.Customs.Value > 0)
                                    {
                                        customs = additionalArticleCost.Customs.Value / 100;
                                    }
                                    if (transport != 0 || customs != 0)
                                    {
                                        articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                    }

                                }
                                articleCostPrice.ArticleCostValueAVG = GetPOAverageByIdArticleEWHQ(connectionstring, itemArticle, NumberPOAvg);
                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                                if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                {
                                    try
                                    {

                                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                        {
                                            mySqlConnection.Open();
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                                            mySqlCommand.CommandTimeout = 3000;

                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                            mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();

                                        }

                                        isCalculated = true;
                                    }
                                    catch (Exception ex)
                                    {

                                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                        isCalculated = false;

                                    }

                                }
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    isCalculated = false;
                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2300(). ErrorMessage- {0} Company - {1} Article{2}", ex.Message, itemCompany.Alias, itemArticle), category: Category.Exception, priority: Priority.Low);
                    FinalArticleCostValue = 0;
                    ExchangeRateDate = DateTime.MinValue;
                    IdCurrency = 0;
                }
            }
            return isCalculated;
        }

        public void AddUpdateDeletePLMArticleDocs(string MainServerConnectionString, ulong IdBasePriceList, List<BPLDocument> DocList, string DocPath, string Name)
        {
            try
            {
                if (DocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BPLDocument doc in DocList)
                        {
                            if (doc.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePrice_Docs_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasepricedoc", doc.IdBasepricedoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeletePLMArticleDocFromPath(doc, DocPath, Name);
                            }
                            else if (doc.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (doc.IdBasepricedoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePrice_Docs_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdBasepricedoc", doc.IdBasepricedoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", doc.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", doc.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", doc.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", doc.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", doc.IdAttachmentType);
                                    mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", doc.IsShareWithCustomer);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddPLMArticleDocToPath(doc, DocPath, Name);
                                }
                            }
                            else if (doc.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Docs_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", doc.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", doc.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", doc.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", doc.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", doc.IdAttachmentType);
                                mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", doc.IsShareWithCustomer);

                                doc.IdBasepricedoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (doc.IdBasepricedoc > 0)
                                {
                                    AddPLMArticleDocToPath(doc, DocPath, Name);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePCMArticleDocs(). IdArticle- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public bool IsDeletePLMArticleDocFromPath(BPLDocument doc, string DocPath, string Name)
        {
            try
            {
                if (DocPath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", DocPath, Name);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        completePath = completePath + "\\" + doc.SavedFileName;

                        if (File.Exists(completePath))
                        {
                            File.Delete(completePath);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePLMArticleDocFromPath()- Filename - {0}. ErrorMessage- {1}", doc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        public bool AddPLMArticleDocToPath(BPLDocument doc, string DocPath, string Name)
        {
            if (doc.PLMArticleFileInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", DocPath, Name);
                    string filePath = completePath + "\\" + doc.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    File.WriteAllBytes(filePath, doc.PLMArticleFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPLMArticleDocToPath()- Filename - {0}. ErrorMessage- {1}", doc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        //[pjadhav][GEOS2-2512][02-12-2022]
        public BasePrice AddBasePrice_V2340(BasePrice basePrice, string MainServerConnectionString, string DocPath)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert_V2340", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            basePrice.Code = lastestBasePriceCode;
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.IdCreator);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, basePrice.IdCreator);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                        AddUpdateDeletePLMArticleDocs(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PLMArticleAttachmentList, DocPath, basePrice.Name);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }

        public List<BPLDocument> GetBPLAttachmentByIdBasePriceList(string connectionString, UInt32 IdBasePriceList)
        {
            List<BPLDocument> bPLDocumentLst = new List<BPLDocument>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("basepricedocs_GetBasePriceAttachmentDetailsByIdBasePriceList", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        BPLDocument bPLDocument = new BPLDocument();
                        try
                        {
                            if (reader["IdBasepricedoc"] != DBNull.Value)
                            {
                                bPLDocument.IdBasepricedoc = Convert.ToInt64(reader["IdBasepricedoc"]);
                            }

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                bPLDocument.IdBasePriceList = Convert.ToInt32(reader["IdBasePriceList"]);
                            }

                            bPLDocument.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            bPLDocument.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            bPLDocument.Description = Convert.ToString(reader["Description"]);

                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                bPLDocument.CreatedIn = Convert.ToDateTime(reader["CreatedIn"]);
                            }

                            if (reader["ModifiedIn"] != DBNull.Value)
                            {
                                bPLDocument.ModifiedIn = Convert.ToDateTime(reader["ModifiedIn"]);
                            }

                            if (reader["ModifiedBy"] != DBNull.Value)
                            {
                                bPLDocument.ModifiedBy = Convert.ToInt32(reader["ModifiedBy"]);

                                bPLDocument.DocumentModifiedBy = new People();
                                bPLDocument.DocumentModifiedBy.IdPerson = Convert.ToInt32(reader["ModifiedBy"]);
                                bPLDocument.DocumentModifiedBy.Name = Convert.ToString(reader["ModifiedByName"]);
                                bPLDocument.DocumentModifiedBy.Surname = Convert.ToString(reader["ModifiedBySurname"]);

                                if (reader["ModifiedByIdSite"] != DBNull.Value)
                                {
                                    bPLDocument.DocumentModifiedBy.Company = new Company();
                                    bPLDocument.DocumentModifiedBy.Company.IdCompany = Convert.ToInt32(reader["ModifiedByIdSite"]);
                                    bPLDocument.DocumentModifiedBy.Company.Name = Convert.ToString(reader["ModifiedBySiteName"]);
                                }
                            }

                            if (reader["CreatedBy"] != DBNull.Value)
                            {
                                bPLDocument.CreatedBy = Convert.ToInt32(reader["CreatedBy"]);

                                bPLDocument.DocumentCreatedBy = new People();
                                bPLDocument.DocumentCreatedBy.IdPerson = Convert.ToInt32(reader["CreatedBy"]);
                                bPLDocument.DocumentCreatedBy.Name = Convert.ToString(reader["CreatedByName"]);
                                bPLDocument.DocumentCreatedBy.Surname = Convert.ToString(reader["CreatedBySurname"]);

                                if (reader["CreatedByIdSite"] != DBNull.Value)
                                {
                                    bPLDocument.DocumentCreatedBy.Company = new Company();
                                    bPLDocument.DocumentCreatedBy.Company.IdCompany = Convert.ToInt32(reader["CreatedByIdSite"]);
                                    bPLDocument.DocumentCreatedBy.Company.Name = Convert.ToString(reader["CreatedBySiteName"]);
                                }

                            }

                            if (reader["IdAttachmentType"] != DBNull.Value)
                            {
                                //bPLDocument.AttachmentType = new LookupValue();
                                //bPLDocument.AttachmentType.IdLookupValue = Convert.ToInt32(reader["IdAttachmentType"]);
                                //bPLDocument.AttachmentType.Value = Convert.ToString(reader["DocumentType"]);
                                bPLDocument.IdAttachmentType = Convert.ToInt64(reader["IdAttachmentType"]);
                                bPLDocument.ArticleDocumentType = new ArticleDocumentType();
                                bPLDocument.ArticleDocumentType.IdDocType = Convert.ToInt64(reader["IdAttachmentType"]);
                                bPLDocument.ArticleDocumentType.DocumentType = Convert.ToString(reader["DocumentType"]);
                            }

                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                bPLDocument.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetBPLAttachmentByIdArticle(). IdArticleDoc- {0} IdArticle-{1}  ErrorMessage- {2}", bPLDocument.IdBasepricedoc, bPLDocument.IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                        bPLDocumentLst.Add(bPLDocument);
                    }

                }
            }

            return bPLDocumentLst;
        }

        public BasePrice GetBasePriceDetailById_V2340(string PLMConnectionString, UInt32 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            string Icon = "";
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2340", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                            if (BasePriceReader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(BasePriceReader["BPLInCPL"]) > 0)
                                    BasePrice.IsBPLExistInCPL = true;
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PLMArticleAttachmentList=GetBPLAttachmentByIdBasePriceList(PLMConnectionString, Convert.ToUInt32(BasePrice.IdBasePriceList));
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2340(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public bool UpdateBasePrice_V2340(BasePrice basePrice, string MainServerConnectionString ,string DocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        //information plant and currency
                        AddDeletePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.CurrencyList, basePrice.DeletePlantList, basePrice.AddPlantList, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.AddCurrencyList, basePrice.DeleteCurrencyList, basePrice.IdModifier);
                        //articles
                        DeleteArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteArticleList);
                        UpdateArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateArticleList, basePrice.IdModifier);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddArticleList, (uint)basePrice.IdModifier);
                        //detections
                        DeleteDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteDetectionList);
                        UpdateDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionList, basePrice.IdModifier);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, (uint)basePrice.IdModifier);
                        //change log/plantcurrency/cpl log/delete cpl items
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                        DeleteCustomerPriceListDetection(MainServerConnectionString, basePrice.CustomerPriceListDetections);
                        DeleteCustomerPriceListSaleCurrency(MainServerConnectionString, basePrice.CustomerPriceListSaleCurrencies);
                        AddUpdateDeletePLMArticleDocs(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PLMArticleAttachmentList, DocPath, basePrice.Name);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2180(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }



        public void AddUpdateDeletePLMCustomerDocs(string MainServerConnectionString, ulong IdcutomerPriceList, List<CPLDocument> DocList, string DocPath, string Name)
        {
            try
            {
                if (DocList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CPLDocument doc in DocList)
                        {
                            if (doc.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customerpricedoc_Docs_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListDoc", doc.IdCustomerPriceListDoc);
                                mySqlCommand.ExecuteNonQuery();

                                IsDeletePLMCustomerDocFromPath(doc, DocPath, Name);
                            }
                            else if (doc.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (doc.IdCustomerPriceListDoc > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPrice_Docs_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceListDoc", doc.IdCustomerPriceListDoc);
                                    mySqlCommand.Parameters.AddWithValue("_SavedFileName", doc.SavedFileName);
                                    mySqlCommand.Parameters.AddWithValue("_Description", doc.Description);
                                    mySqlCommand.Parameters.AddWithValue("_OriginalFileName", doc.OriginalFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", doc.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                    mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", doc.IdAttachmentType);
                                    mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", doc.IsShareWithCustomer);

                                    mySqlCommand.ExecuteNonQuery();

                                    AddPLMCustomerDocToPath(doc, DocPath, Name);
                                }
                            }
                            else if (doc.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPrice_Docs_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdcutomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_SavedFileName", doc.SavedFileName);
                                mySqlCommand.Parameters.AddWithValue("_Description", doc.Description);
                                mySqlCommand.Parameters.AddWithValue("_OriginalFileName", doc.OriginalFileName);
                                mySqlCommand.Parameters.AddWithValue("_CreatedBy", doc.CreatedBy);
                                mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_IdAttachmentType", doc.IdAttachmentType);
                                mySqlCommand.Parameters.AddWithValue("_IsShareWithCustomer", doc.IsShareWithCustomer);

                                doc.IdCustomerPriceListDoc = Convert.ToUInt32(mySqlCommand.ExecuteScalar());

                                if (doc.IdCustomerPriceListDoc > 0)
                                {
                                    AddPLMCustomerDocToPath(doc, DocPath, Name);
                                }
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeletePCMArticleDocs(). IdArticle- {0} ErrorMessage- {1}", IdcutomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public bool IsDeletePLMCustomerDocFromPath(CPLDocument doc, string DocPath, string Name)
        {
            try
            {
                if (DocPath != null)
                {
                    string completePath = string.Format(@"{0}\{1}", DocPath, Name);

                    if (!Directory.Exists(completePath))
                    {
                        return false;
                    }
                    else
                    {
                        completePath = completePath + "\\" + doc.SavedFileName;

                        if (File.Exists(completePath))
                        {
                            File.Delete(completePath);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsDeletePLMArticleDocFromPath()- Filename - {0}. ErrorMessage- {1}", doc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        public bool AddPLMCustomerDocToPath(CPLDocument doc, string DocPath, string Name)
        {
            if (doc.PLMArticleFileInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", DocPath, Name);
                    string filePath = completePath + "\\" + doc.SavedFileName;

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }
                    File.WriteAllBytes(filePath, doc.PLMArticleFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddPLMArticleDocToPath()- Filename - {0}. ErrorMessage- {1}", doc.SavedFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        public CustomerPrice AddCustomerPrice_V2340(CustomerPrice customerPrice, string MainServerConnectionString, string DocPath)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdCreator);
                        AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        AddCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, customerPrice.IdCreator);
                        AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);


                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice_V2150(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }


        public bool UpdateCustomerPrice_V2340(CustomerPrice customerPrice, string MainServerConnectionString, string DocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceList_Articles(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Detections(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Currencies(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdModifier);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdModifier);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, (uint)customerPrice.IdModifier);
                            AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);

                        }
                        else
                        {
                            //Sale currencies
                            DeleteSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteCurrencyList);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddCurrencyList, (uint)customerPrice.IdModifier);

                            //articles
                            DeleteArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteArticleList);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddArticleList, (uint)customerPrice.IdModifier);
                            UpdateArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateArticleList, customerPrice.IdModifier);

                            //detections
                            DeleteDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteDetectionList);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddDetectionList, (uint)customerPrice.IdModifier);
                            UpdateDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateDetectionList, customerPrice.IdModifier);

                            //attachment
                            AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);


                        }
                        AddUpdateDeleteCustomersByCPL_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                       

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public CustomerPrice GetCustomerPricesById_V2340(string PLMConnectionString, UInt64 idCustomerPriceList, string currencyIconFilePath)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == CustomerPrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == CustomerPrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(CustomerPrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(CustomerPrice.Currency.Name, bytes);
                                    }

                                    CustomerPrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CurrencyList = GetCurrenciesByIdCustomerPrice_V2160(PLMConnectionString, CustomerPrice.IdCustomerPriceList, currencyIconFilePath);
                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListDetections = GetCustomerPriceListDetectionsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.PLMCustomerAttachmentList = GetCPLAttachmentByIdCustomerPriceList(PLMConnectionString, Convert.ToUInt32(CustomerPrice.IdCustomerPriceList));
                //BasePrice.PLMArticleAttachmentList = GetBPLAttachmentByIdBasePriceList(PLMConnectionString, Convert.ToUInt32(BasePrice.IdBasePriceList));
                //CustomerPrice.ArticleCostPriceListForSavedCPL = GetCPLArticleCostPricesByCurrency(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLArticlesSaved = GetCurrencyConversionRatesByCPLArticleDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLDetectionsSaved = GetCurrencyConversionRatesByCPLDetectionDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2160(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }
        public List<CPLDocument> GetCPLAttachmentByIdCustomerPriceList(string connectionString, UInt32 IdCustomerPriceList)
        {
            List<CPLDocument> cPLDocumentLst = new List<CPLDocument>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("GetCustomerPriceAttachmentDetailsByIdCustomerPriceList", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        CPLDocument cPLDocument = new CPLDocument();
                        try
                        {
                            if (reader["IdCustomerPriceListDoc"] != DBNull.Value)
                            {
                                cPLDocument.IdCustomerPriceListDoc = Convert.ToInt64(reader["IdCustomerPriceListDoc"]);
                            }

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                cPLDocument.IdCustomerPriceList = Convert.ToInt32(reader["IdCustomerPriceList"]);
                            }

                            cPLDocument.OriginalFileName = Convert.ToString(reader["OriginalFileName"]);
                            cPLDocument.SavedFileName = Convert.ToString(reader["SavedFileName"]);
                            cPLDocument.Description = Convert.ToString(reader["Description"]);

                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                cPLDocument.CreatedIn = Convert.ToDateTime(reader["CreatedIn"]);
                            }

                            if (reader["ModifiedIn"] != DBNull.Value)
                            {
                                cPLDocument.ModifiedIn = Convert.ToDateTime(reader["ModifiedIn"]);
                            }

                            if (reader["ModifiedBy"] != DBNull.Value)
                            {
                                cPLDocument.ModifiedBy = Convert.ToInt32(reader["ModifiedBy"]);

                                cPLDocument.DocumentModifiedBy = new People();
                                cPLDocument.DocumentModifiedBy.IdPerson = Convert.ToInt32(reader["ModifiedBy"]);
                                cPLDocument.DocumentModifiedBy.Name = Convert.ToString(reader["ModifiedByName"]);
                                cPLDocument.DocumentModifiedBy.Surname = Convert.ToString(reader["ModifiedBySurname"]);

                                if (reader["ModifiedByIdSite"] != DBNull.Value)
                                {
                                    cPLDocument.DocumentModifiedBy.Company = new Company();
                                    cPLDocument.DocumentModifiedBy.Company.IdCompany = Convert.ToInt32(reader["ModifiedByIdSite"]);
                                    cPLDocument.DocumentModifiedBy.Company.Name = Convert.ToString(reader["ModifiedBySiteName"]);
                                }
                            }

                            if (reader["CreatedBy"] != DBNull.Value)
                            {
                                cPLDocument.CreatedBy = Convert.ToInt32(reader["CreatedBy"]);

                                cPLDocument.DocumentCreatedBy = new People();
                                cPLDocument.DocumentCreatedBy.IdPerson = Convert.ToInt32(reader["CreatedBy"]);
                                cPLDocument.DocumentCreatedBy.Name = Convert.ToString(reader["CreatedByName"]);
                                cPLDocument.DocumentCreatedBy.Surname = Convert.ToString(reader["CreatedBySurname"]);

                                if (reader["CreatedByIdSite"] != DBNull.Value)
                                {
                                    cPLDocument.DocumentCreatedBy.Company = new Company();
                                    cPLDocument.DocumentCreatedBy.Company.IdCompany = Convert.ToInt32(reader["CreatedByIdSite"]);
                                    cPLDocument.DocumentCreatedBy.Company.Name = Convert.ToString(reader["CreatedBySiteName"]);
                                }

                            }

                            if (reader["IdAttachmentType"] != DBNull.Value)
                            {
                                cPLDocument.IdAttachmentType = Convert.ToInt64(reader["IdAttachmentType"]);
                                cPLDocument.ArticleDocumentType = new ArticleDocumentType();
                                cPLDocument.ArticleDocumentType.IdDocType = Convert.ToInt64(reader["IdAttachmentType"]);
                                cPLDocument.ArticleDocumentType.DocumentType = Convert.ToString(reader["DocumentType"]);
                            }
                            if (reader["IsShareWithCustomer"] != DBNull.Value)
                                cPLDocument.IsShareWithCustomer = Convert.ToByte(reader["IsShareWithCustomer"]);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetBPLAttachmentByIdArticle(). IdArticleDoc- {0} IdArticle-{1}  ErrorMessage- {2}", cPLDocument.IdCustomerPriceListDoc, cPLDocument.IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                        cPLDocumentLst.Add(cPLDocument);
                    }

                }
            }

            return cPLDocumentLst;
        }


        
        public List<Country> GetCountriesByGroupAndRegionAndSites_V2350(string PLMConnectionString, int IdGroup, string RegionNames, string SiteNames, string CompanyIconFilePath)
        {
            List<string> countryISOs = new List<string>();
            Dictionary<string, byte[]> DictCompanies = new Dictionary<string, byte[]>();
            List<Country> Countrys = new List<Country>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCountriesByGroupAndRegionAndSites_V2350", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomer", IdGroup);
                    mySqlCommand.Parameters.AddWithValue("_RegionName", RegionNames);
                    mySqlCommand.Parameters.AddWithValue("_SiteName", SiteNames);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Country Country = new Country();
                            Country.IdCountry = Convert.ToByte(reader["idCountry"]);
                            if (reader["name"] != DBNull.Value)
                            {
                                Country.Name = Convert.ToString(reader["name"]);
                            }
                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                Country.IdRegion = Convert.ToInt32(reader["IdRegion"]);
                            }
                            if (reader["IdCustomer"] != DBNull.Value)
                            {
                                Country.IdGroup = Convert.ToUInt32(reader["IdCustomer"]);
                            }
                            Country.Iso = Convert.ToString(reader["iso"]);
                            if (!countryISOs.Any(co => co.ToString() == Country.Iso))
                            {
                                countryISOs.Add(Country.Iso);
                            }
                            Countrys.Add(Country);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountriesByGroupAndRegionAndSites_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                if (DictCompanies.Any(i => i.Key == item))
                {
                    bytes = DictCompanies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetEnumeratedImageInBytes(item, CompanyIconFilePath);
                    DictCompanies.Add(item, bytes);
                }
                Countrys.Where(ma => ma.Iso == item).ToList().ForEach(ma => ma.CountryIconBytes = bytes);
            }

            return Countrys;
        }


        private byte[] GetEnumeratedImageInBytes(string LoginName, string filePath)
        {
            byte[] bytes = null;
            string fileUploadPath = "";

            if (File.Exists(filePath + LoginName + ".png"))
            {
                fileUploadPath = filePath + LoginName + ".png";
            }
            else if (File.Exists(filePath + LoginName))
            {
                fileUploadPath = filePath + LoginName;
            }
            else
            {
                fileUploadPath = filePath + LoginName + ".jpg";
            }
            if (File.Exists(fileUploadPath))
            {
                using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                {
                    bytes = new byte[stream.Length];
                    int numBytesToRead = (int)stream.Length;
                    int numBytesRead = 0;
                    while (numBytesToRead > 0)
                    {
                        // Read may return anything from 0 to numBytesToRead.
                        int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                        // Break when the end of the file is reached.
                        if (n == 0)
                            break;

                        numBytesRead += n;
                        numBytesToRead -= n;
                    }
                }

                return bytes;
            }
            else
            {
                return null;
            }
        }


        #region GEOS2-2886
        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 28 03 2023
        public List<CustomerPrice> GetCustomerPriceIFExistModules(string PLMConnectionString, UInt64 IdBasePriceList, string IdCPType)
        {
            List<CustomerPrice> customerPriceLst = new List<CustomerPrice>();
            try
            {
                if (!string.IsNullOrEmpty(IdCPType))
                {
                    using (MySqlConnection connCustomerPrice = new MySqlConnection(PLMConnectionString))
                    {
                        connCustomerPrice.Open();

                        MySqlCommand CustomerPriceCommand = new MySqlCommand("PLM_GetCustomerPriceIFExistModules_V2370", connCustomerPrice);
                        CustomerPriceCommand.CommandType = CommandType.StoredProcedure;
                        CustomerPriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                        CustomerPriceCommand.Parameters.AddWithValue("_IdCPType", IdCPType);


                        using (MySqlDataReader CustomerPriceReader = CustomerPriceCommand.ExecuteReader())
                        {
                            while (CustomerPriceReader.Read())
                            {
                                CustomerPrice customerPrice = new CustomerPrice();


                                if (CustomerPriceReader["Code"] != DBNull.Value)
                                {
                                    customerPrice.Code = Convert.ToString(CustomerPriceReader["Code"]);
                                }
                                if (CustomerPriceReader["Name"] != DBNull.Value)
                                {
                                    customerPrice.Name = Convert.ToString(CustomerPriceReader["Name"]);
                                }
                                if (CustomerPriceReader["IdCustomerPriceList"] != DBNull.Value)
                                {
                                    customerPrice.IdCustomerPriceList = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceList"]);
                                }
                                if (CustomerPriceReader["IdCustomerPriceListByItems"] != DBNull.Value)
                                {
                                    customerPrice.CustomerPriceListItems = new List<CustomerPriceListByItem>();
                                    CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                    customerPriceListByItem.IdCustomerPriceListByItems = Convert.ToUInt64(CustomerPriceReader["IdCustomerPriceListByItems"]);
                                    customerPriceListByItem.IdDetection = Convert.ToUInt32(CustomerPriceReader["IdDetection"]); ;
                                    customerPrice.CustomerPriceListItems.Add(customerPriceListByItem);
                                }
                                customerPriceLst.Add(customerPrice);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceIFExistModules(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLst;
        }

        public bool UpdateBasePrice_V2370(BasePrice basePrice, string MainServerConnectionString, string DocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        //information plant and currency
                        AddDeletePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.CurrencyList, basePrice.DeletePlantList, basePrice.AddPlantList, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.AddCurrencyList, basePrice.DeleteCurrencyList, basePrice.IdModifier);
                        //articles
                        DeleteArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteArticleList);
                        UpdateArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateArticleList, basePrice.IdModifier);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddArticleList, (uint)basePrice.IdModifier);
                        //detections
                        DeleteDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteDetectionList);
                        UpdateDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionList, basePrice.IdModifier);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, (uint)basePrice.IdModifier);

                        //Modules
                        DeleteModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteModuleList);
                        UpdateModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateModuleList, basePrice.IdModifier);
                        AddModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddModuleList, (uint)basePrice.IdModifier);

                        //change log/plantcurrency/cpl log/delete cpl items
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                        DeleteCustomerPriceListDetection(MainServerConnectionString, basePrice.CustomerPriceListDetections);
                        DeleteCustomerPriceListSaleCurrency(MainServerConnectionString, basePrice.CustomerPriceListSaleCurrencies);
                        AddUpdateDeletePLMArticleDocs(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PLMArticleAttachmentList, DocPath, basePrice.Name);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }

        public void DeleteModulesByBasePrice_V2370(string MainServerConnectionString, UInt64 IdBasePriceList, List<BPLModule> ModuleList)
        {
            try
            {
                if (ModuleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BPLModule Module in ModuleList)
                        {
                            if (Module.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                //MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Delete", mySqlConnection);
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Delete_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", Module.IdCPType);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteDetectionsByBasePrice_V2370(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void UpdateModulesByBasePrice_V2370(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ModuleList, UInt32? IdModifier)
        {
            try
            {
                if (ModuleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        ModuleList = ModuleList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Update).ToList();
                        foreach (BasePriceListByItem Module in ModuleList.Distinct())
                        {
                            if (Module.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                // MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Update", mySqlConnection);
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Update_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", Module.IdCPType);
                                mySqlCommand.Parameters.AddWithValue("_MaxCost", Module.MaxCost);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Module.CurrencyConversionDate_New);
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Module.IdRule);
                                Module.RuleValue_New = Module.RuleValue;
                                if (Module.IdRule == 1518)
                                {
                                    Module.RuleValue_New = 0;
                                }
                                else if (Module.IdRule == 308)
                                {
                                    if (Module.RuleValue_New == 0)
                                    {
                                        Module.RuleValue_New = 0;
                                    }
                                }
                                else
                                {
                                    if (Module.IdRule == 0)
                                    {
                                        Module.RuleValue_New = null;
                                    }
                                }
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Module.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_version", Module.Version);
                                mySqlCommand.Parameters.AddWithValue("_Royalty", Module.Royalty);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateDetectionsByBasePrice_V2370(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public void AddModulesByBasePrice_V2370(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceListByItem> ModuleList, UInt32 IdCreator)
        {
            try
            {
                if (ModuleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BasePriceListByItem module in ModuleList)
                        {
                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Insert", mySqlConnection);
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Insert_2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", module.IdCPType);
                            mySqlCommand.Parameters.AddWithValue("_MaxCost", module.MaxCost);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", module.CurrencyConversionDate_New);
                            mySqlCommand.Parameters.AddWithValue("_IdRule", module.IdRule);
                            module.RuleValue_New = module.RuleValue;
                            if (module.IdRule == 1518)
                            {
                                module.RuleValue_New = 0;
                            }
                            else if (module.IdRule == 308)
                            {
                                if (module.RuleValue_New == 0)
                                {
                                    module.RuleValue_New = null;
                                }
                            }
                            else
                            {
                                if (module.IdRule == 0)
                                {
                                    module.RuleValue_New = null;
                                }
                            }
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", module.RuleValue_New);
                            mySqlCommand.Parameters.AddWithValue("_Version", module.Version);
                            mySqlCommand.Parameters.AddWithValue("_Royalty", module.Royalty);
                            mySqlCommand.Parameters.AddWithValue("_CreatedBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDetectionsByBasePrice_V2150(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public BasePrice AddBasePrice_V2370(BasePrice basePrice, string MainServerConnectionString, string DocPath)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert_V2340", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            basePrice.Code = lastestBasePriceCode;
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.IdCreator);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, basePrice.IdCreator);
                        AddModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddModuleList, basePrice.IdCreator);
                        AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                        AddUpdateDeletePLMArticleDocs(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PLMArticleAttachmentList, DocPath, basePrice.Name);

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }

        public BasePrice GetBasePriceDetailById_V2370(string PLMConnectionString, UInt32 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            string Icon = "";
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2370", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                            if (BasePriceReader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(BasePriceReader["BPLInCPL"]) > 0)
                                    BasePrice.IsBPLExistInCPL = true;
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PLMArticleAttachmentList = GetBPLAttachmentByIdBasePriceList(PLMConnectionString, Convert.ToUInt32(BasePrice.IdBasePriceList));
                BasePrice.BasePriceListModules = GetBasePriceListModulesById_V2370(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2370(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<BasePriceListByItem> GetBasePriceListModulesById_V2370(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceListByItem> BasePriceListByItems = new List<BasePriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Get_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceListByItem BasePriceListByItem = new BasePriceListByItem();

                            if (reader["IdBasePriceList"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                                BasePriceListByItem.ProductType = new ProductTypes();
                                BasePriceListByItem.ProductType.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                                if (reader["Reference"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.Code = Convert.ToString(reader["Reference"]);
                                }
                                if (reader["ProductType"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.Name = Convert.ToString(reader["ProductType"]);
                                }
                                if (reader["StatusAbbreviation"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                                }
                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }

                                if (reader["IdTemplate"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                }
                                if (BasePriceListByItem.ProductType.Template==null)
                                {
                                    BasePriceListByItem.ProductType.Template = new Template();
                                }
                                if (reader["IdTemplate"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                    BasePriceListByItem.ProductType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }

                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["Royalty"] != DBNull.Value)
                            {
                                BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            }
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                BasePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListModulesById_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }

        public List<BasePrice> GetBasePriceListItem_User_ById_V2370(string PLMConnectionString, int IdUser, string currencyIconFilePath)
        {
            List<BasePrice> basePrices = new List<BasePrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetBasePriceListItem_User_ById_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            BasePrice basePrice = new BasePrice();
                            basePrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["Code"] != DBNull.Value)
                            {
                                basePrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                basePrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                basePrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                basePrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                basePrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                basePrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                basePrice.Status = new LookupValue();
                                basePrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    basePrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                basePrice.IdPermission = reader["IdPermission"].ToString();
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                basePrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                basePrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                basePrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                basePrice.Currency = new Currency();
                                basePrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    basePrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == basePrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(basePrice.Currency.Name);
                                    }
                                }
                            }
                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                basePrice.PVPCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }
                            if (reader["Plants"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlants = Convert.ToString(reader["Plants"]).Split(',').ToList<string>();
                                basePrice.Plants = string.Join("\n", tempDifferentPlants.ToArray());
                            }
                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    basePrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    basePrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    basePrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["BPLInCPL"]) > 0)
                                    basePrice.IsBPLExistInCPL = true;
                            }

                            basePrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = item;
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                basePrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }
                            basePrices.Add(basePrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListItem_User_ById_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                basePrices.Where(oi => oi.Currency.Name == item).ToList().ForEach(oi => oi.Currency.CurrencyIconbytes = bytes);

            }
            return basePrices;
        }
        #endregion
        #region GEOS2-4300 & GEOS2-3180
        public BasePrice GetBasePriceDetailById_ForCPL_V2380(string PLMConnectionString, UInt64 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }

                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);

                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath);
                BasePrice.BasePriceListItems_ForCPL = GetBasePriceListItemsById_ForCPL_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections_ForCPL = GetBasePriceListDetectionsById_ForCPL_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListModules_ForCPL = GetBasePriceListModulesById_ForCPL_V2380(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2380(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        public List<CustomerPriceListByItem> GetBasePriceListModulesById_ForCPL_V2380(string WorkbenchConnectionString, UInt64 IdBasePriceList)
        {
            List<CustomerPriceListByItem> BasePriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_base_price_list_by_modules_Get_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem BasePriceListByItem = new CustomerPriceListByItem();

                            //if (reader["IdBasePriceList"] != DBNull.Value)
                            //{
                            //    BasePriceListByItem.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);
                            //}
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                                BasePriceListByItem.ProductType = new ProductTypes();
                                BasePriceListByItem.ProductType.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                                if (reader["Reference"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.Code = Convert.ToString(reader["Reference"]);
                                }
                                if (reader["ProductType"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.Name = Convert.ToString(reader["ProductType"]);
                                }
                                if (reader["StatusAbbreviation"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                                }
                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }

                                if (reader["IdTemplate"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                }
                                if (BasePriceListByItem.ProductType.Template == null)
                                {
                                    BasePriceListByItem.ProductType.Template = new Template();
                                }
                                if (reader["IdTemplate"] != DBNull.Value)
                                {
                                    BasePriceListByItem.ProductType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                    BasePriceListByItem.ProductType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }

                            }
                            if (reader["MaxCost"] != DBNull.Value)
                            {
                                BasePriceListByItem.MaxCost = float.Parse(reader["MaxCost"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                BasePriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                BasePriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                BasePriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            //if (reader["Royalty"] != DBNull.Value)
                            //{
                            //    BasePriceListByItem.Royalty = float.Parse(reader["Royalty"].ToString());
                            //}
                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                BasePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            BasePriceListByItems.Add(BasePriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceListModulesById_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePriceListByItems;
        }

        public List<CustomerPrice> GetCustomerPriceListItem_User_ById_V2380(string PLMConnectionString, int IdUser, string currencyIconFilePath)
        {
            List<CustomerPrice> customerPrices = new List<CustomerPrice>();
            List<string> CurrencyIcon = new List<string>();
            List<string> tempDifferentPVPCurrency = new List<string>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCustomerPriceListItem_User_Id_V2380", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdUser", IdUser);
                    mySqlCommand.CommandTimeout = 3000;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            CustomerPrice customerPrice = new CustomerPrice();
                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                                customerPrice.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            if (reader["IdBasePriceList"] != DBNull.Value)
                                customerPrice.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["BasePriceName"] != DBNull.Value)
                                customerPrice.BasePriceName = Convert.ToString(reader["BasePriceName"]).Trim();

                            if (reader["Code"] != DBNull.Value)
                            {
                                customerPrice.Code = Convert.ToString(reader["Code"]);
                            }
                            if (reader["Name"] != DBNull.Value)
                            {
                                customerPrice.Name = Convert.ToString(reader["Name"]).Trim();
                            }
                            if (reader["Description"] != DBNull.Value)
                            {
                                customerPrice.Description = Convert.ToString(reader["Description"]).Trim();
                            }
                            if (reader["EffectiveDate"] != DBNull.Value)
                            {
                                customerPrice.EffectiveDate = Convert.ToDateTime(reader["EffectiveDate"]);
                            }
                            if (reader["ExpiryDate"] != DBNull.Value)
                            {
                                customerPrice.ExpiryDate = Convert.ToDateTime(reader["ExpiryDate"]);
                            }
                            if (reader["IdStatus"] != DBNull.Value)
                            {
                                customerPrice.IdStatus = Convert.ToUInt32(reader["IdStatus"]);
                                customerPrice.Status = new LookupValue();
                                customerPrice.Status.IdLookupValue = Convert.ToInt32(reader["IdStatus"]);
                                if (reader["Status"] != DBNull.Value)
                                {
                                    customerPrice.Status.Value = Convert.ToString(reader["Status"]);
                                }
                            }
                            if (reader["IdPermission"] != DBNull.Value)
                            {
                                customerPrice.IdPermission = reader["IdPermission"].ToString();
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                customerPrice.CreationDate = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["LastUpdate"] != DBNull.Value)
                            {
                                customerPrice.LastUpdated = Convert.ToDateTime(reader["LastUpdate"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                customerPrice.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                customerPrice.Currency = new Currency();
                                customerPrice.Currency.IdCurrency = Convert.ToByte(reader["IdCurrency"]);
                                if (reader["Currency"] != DBNull.Value)
                                {
                                    customerPrice.Currency.Name = Convert.ToString(reader["Currency"]);
                                    if (!CurrencyIcon.Any(co => co.ToString() == customerPrice.Currency.Name))
                                    {
                                        CurrencyIcon.Add(customerPrice.Currency.Name);
                                    }
                                }
                            }

                            if (reader["ArticleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ArticleCount"]) > 0)
                                    customerPrice.ArticleCount = Convert.ToInt32(reader["ArticleCount"]);
                            }
                            if (reader["ModuleCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["ModuleCount"]) > 0)
                                    customerPrice.ModuleCount = Convert.ToInt32(reader["ModuleCount"]);
                            }
                            if (reader["DetectionCount"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(reader["DetectionCount"]) > 0)
                                    customerPrice.DetectionCount = Convert.ToInt32(reader["DetectionCount"]);
                            }

                            if (reader["PVPCurrency"] != DBNull.Value)
                            {
                                tempDifferentPVPCurrency = Convert.ToString(reader["PVPCurrency"]).Split(',').ToList<string>();
                                customerPrice.SaleCurrencies = string.Join("\n", tempDifferentPVPCurrency.ToArray());
                            }

                            if (reader["CustGroup"] != DBNull.Value)
                            {
                                List<string> tempDifferentGroup = Convert.ToString(reader["CustGroup"]).Split('\n').ToList<string>();
                                tempDifferentGroup = tempDifferentGroup.Distinct().ToList();
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        tempDifferentGroup.Add("ALL");
                                }
                                customerPrice.Group = string.Join("\n", tempDifferentGroup.ToArray());
                            }
                            else
                            {
                                if (reader["IsCustomerNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCustomerNullExist"]) == 0)
                                        customerPrice.Group = "ALL";
                                }
                            }

                            if (reader["CountryName"] != DBNull.Value)
                            {
                                List<string> tempDifferentCountryName = Convert.ToString(reader["CountryName"]).Split('\n').ToList<string>();
                                tempDifferentCountryName = tempDifferentCountryName.Distinct().ToList();

                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        tempDifferentCountryName.Add("ALL");
                                }

                                customerPrice.Country = customerPrice.Country + string.Join("\n", tempDifferentCountryName.ToArray());
                            }
                            else
                            {
                                if (reader["IsCountryNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsCountryNullExist"]) == 0)
                                        customerPrice.Country = "ALL";
                                }
                            }

                            if (reader["RegionName"] != DBNull.Value)
                            {
                                List<string> tempDifferentRegionName = Convert.ToString(reader["RegionName"]).Split('\n').ToList<string>();
                                tempDifferentRegionName = tempDifferentRegionName.Distinct().ToList();

                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        tempDifferentRegionName.Add("ALL");
                                }

                                customerPrice.Region = customerPrice.Region + string.Join("\n", tempDifferentRegionName.ToArray());
                            }
                            else
                            {
                                if (reader["IsRegionNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsRegionNullExist"]) == 0)
                                        customerPrice.Region = "ALL";
                                }
                            }

                            if (reader["PlantName"] != DBNull.Value)
                            {
                                List<string> tempDifferentPlantName = Convert.ToString(reader["PlantName"]).Split('\n').ToList<string>();
                                tempDifferentPlantName = tempDifferentPlantName.Distinct().ToList();
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        tempDifferentPlantName.Add("ALL");
                                }
                                customerPrice.Plant = customerPrice.Plant + string.Join("\n", tempDifferentPlantName.ToArray());
                            }
                            else
                            {
                                if (reader["IsSiteNullExist"] != DBNull.Value)
                                {
                                    if (Convert.ToInt32(reader["IsSiteNullExist"]) == 0)
                                        customerPrice.Plant = "ALL";
                                }
                            }
                            customerPrice.PVPCurrencyWithBytes = new List<Currency>();
                            foreach (string item in tempDifferentPVPCurrency)
                            {
                                Currency pvpCurrency = new Currency();
                                pvpCurrency.Name = Convert.ToString(item);
                                byte[] bytes = null;
                                if (DictCurrencies.Any(i => i.Key == item))
                                {
                                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                                }
                                else
                                {
                                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                                    DictCurrencies.Add(item, bytes);
                                }

                                pvpCurrency.CurrencyIconbytes = bytes;
                                customerPrice.PVPCurrencyWithBytes.Add(pvpCurrency);
                            }

                            customerPrices.Add(customerPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListItem_User_ById_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in CurrencyIcon)
            {
                byte[] bytes = null;
                if (DictCurrencies.Any(i => i.Key == item))
                {
                    bytes = DictCurrencies.Where(i => i.Key == item).FirstOrDefault().Value;
                }
                else
                {
                    bytes = GetCurrencyIconFileInBytes(item, currencyIconFilePath);
                    DictCurrencies.Add(item, bytes);
                }

                customerPrices.Where(cp => cp.Currency.Name == item).ToList().ForEach(cp => cp.Currency.CurrencyIconbytes = bytes);

            }
            return customerPrices;
        }

        public bool UpdateCustomerPrice_V2380(CustomerPrice customerPrice, string MainServerConnectionString, string DocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceList_Articles(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Detections(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Currencies(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdModifier);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdModifier);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, (uint)customerPrice.IdModifier);
                            AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);

                            //Modules
                            try
                            {
                                IsDeletedCustomerPriceList_Modules(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                                AddModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListModules, customerPrice.IdModifier);


                            }
                            catch (Exception ex)
                            {
                            }
                        }
                        else
                        {
                            //Sale currencies
                            DeleteSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteCurrencyList);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddCurrencyList, (uint)customerPrice.IdModifier);

                            //articles
                            DeleteArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteArticleList);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddArticleList, (uint)customerPrice.IdModifier);
                            UpdateArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateArticleList, customerPrice.IdModifier);

                            //detections
                            DeleteDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteDetectionList);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddDetectionList, (uint)customerPrice.IdModifier);
                            UpdateDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateDetectionList, customerPrice.IdModifier);

                            try
                            {
                                //Modules
                                DeleteModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteModuleList);
                                AddModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddModuleList, (uint)customerPrice.IdModifier);
                                UpdateModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateModuleList, customerPrice.IdModifier);
                            }
                            catch (Exception ex)
                            {
                            }
                            //attachment
                            AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);
                        }
                        AddUpdateDeleteCustomersByCPL_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void DeleteModulesByCustomerPrice_V2380(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<BPLModule> ModuleList)
        {
            try
            {
                if (ModuleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (BPLModule Module in ModuleList)
                        {
                            if (Module.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                //MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Delete", mySqlConnection);
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Delete_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", Module.IdCPType);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteModulesByCustomerPrice_V2380(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void AddModulesByCustomerPrice_V2380(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ModuleList, UInt32? IdCreator)
        {
            try
            {
                if (ModuleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Module in ModuleList.Distinct())
                        {
                            //MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_Modules_Insert", mySqlConnection);
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_Modules_Insert_V2530", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdCPType", Module.IdCPType);
                            if (Module.ItemCustomerDescription != null)
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Module.ItemCustomerDescription.Trim());
                            else
                                mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Module.ItemCustomerDescription);

                            mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Module.VisibleToCustomer);
                            if (Module.BasePriceListValue == 0)
                            {
                                Module.BasePriceListValue = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Module.BasePriceListValue);
                            mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Module.CurrencyConversionDate_New);
                            if (Module.IdRule_New == 1518)
                            {
                                Module.RuleValue_New = 0;
                            }
                            else if (Module.IdRule_New == 308)
                            {
                                if (Module.RuleValue_New == 0)
                                {
                                    Module.RuleValue_New = null;
                                }
                            }
                            else
                            {
                                if (Module.IdRule_New == 0)
                                {
                                    Module.IdRule_New = null;
                                    Module.RuleValue_New = null;
                                }
                            }
                            mySqlCommand.Parameters.AddWithValue("_IdRule", Module.IdRule_New);
                            mySqlCommand.Parameters.AddWithValue("_RuleValue", Module.RuleValue_New);
                            if (Module.SellPrice_New == 0)
                            {
                                Module.SellPrice_New = null;
                            }
                            mySqlCommand.Parameters.AddWithValue("_Version", Module.Version);
                            mySqlCommand.Parameters.AddWithValue("_createdBy", IdCreator);
                            mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Module.LinkedDescription);
                            mySqlCommand.ExecuteNonQuery();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddModulesByCustomerPrice_V2380(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void UpdateModulesByCustomerPrice_V2380(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceListByItem> ModuleList, UInt32? IdModifier)
        {
            try
            {
                if (ModuleList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (CustomerPriceListByItem Module in ModuleList.Distinct())
                        {
                            if (Module.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                //MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Update", mySqlConnection);
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Update_V2530", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                                mySqlCommand.Parameters.AddWithValue("_IdCPType", Module.IdCPType);
                                if (Module.ItemCustomerDescription != null)
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Module.ItemCustomerDescription.Trim());
                                else
                                    mySqlCommand.Parameters.AddWithValue("_ItemCustomerDescription", Module.ItemCustomerDescription);

                                mySqlCommand.Parameters.AddWithValue("_VisibleToCustomer", Module.VisibleToCustomer);
                                if (Module.BasePriceListValue == 0)
                                {
                                    Module.BasePriceListValue = null;
                                }
                                mySqlCommand.Parameters.AddWithValue("_BasePriceListValue", Module.BasePriceListValue);
                                if (Module.IdRule_New == 1518)
                                {
                                    Module.RuleValue_New = 0;
                                }
                                else if (Module.IdRule_New == 308)
                                {
                                    if (Module.RuleValue_New == 0)
                                    {
                                        Module.RuleValue_New = 0;
                                    }
                                }
                                else
                                {
                                    if (Module.IdRule_New == 0)
                                    {
                                        Module.IdRule_New = null;
                                        Module.RuleValue_New = null;
                                    }
                                }
                                mySqlCommand.Parameters.AddWithValue("_IdRule", Module.IdRule_New);
                                mySqlCommand.Parameters.AddWithValue("_RuleValue", Module.RuleValue_New);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdModifier);
                                mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_LinkedDescription", Module.LinkedDescription);
                                mySqlCommand.Parameters.AddWithValue("_CurrencyConversionDate", Module.CurrencyConversionDate_New);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateModulesByCustomerPrice_V2380(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public bool IsDeletedCustomerPriceList_Modules(UInt64 idCustomerPriceList, string MainServerConnectionString)
        {
            bool isDeleted = false;
            if (idCustomerPriceList > 0)
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_AllDelete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        isDeleted = true;
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsDeletedCustomerPriceList_Modules(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return isDeleted;
        }

        public CustomerPrice AddCustomerPrice_V2380(CustomerPrice customerPrice, string MainServerConnectionString, string DocPath)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdCreator);
                        AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        AddCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, customerPrice.IdCreator);
                        AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);
                        try
                        {
                            AddModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListModules, customerPrice.IdCreator);
                        }
                        catch (Exception ex)
                        {
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }

        public CustomerPrice GetCustomerPricesById_V2380(string PLMConnectionString, UInt64 idCustomerPriceList, string currencyIconFilePath)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == CustomerPrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == CustomerPrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(CustomerPrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(CustomerPrice.Currency.Name, bytes);
                                    }

                                    CustomerPrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CurrencyList = GetCurrenciesByIdCustomerPrice_V2160(PLMConnectionString, CustomerPrice.IdCustomerPriceList, currencyIconFilePath);
                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListDetections = GetCustomerPriceListDetectionsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.PLMCustomerAttachmentList = GetCPLAttachmentByIdCustomerPriceList(PLMConnectionString, Convert.ToUInt32(CustomerPrice.IdCustomerPriceList));
                //BasePrice.PLMArticleAttachmentList = GetBPLAttachmentByIdBasePriceList(PLMConnectionString, Convert.ToUInt32(BasePrice.IdBasePriceList));
                //CustomerPrice.ArticleCostPriceListForSavedCPL = GetCPLArticleCostPricesByCurrency(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLArticlesSaved = GetCurrencyConversionRatesByCPLArticleDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLDetectionsSaved = GetCurrencyConversionRatesByCPLDetectionDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                try
                {
                    CustomerPrice.CustomerPriceListModules = GetCustomerPriceListModulesById_V2380(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                }
                catch (Exception ex)
                {
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2380(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }

        public List<CustomerPriceListByItem> GetCustomerPriceListModulesById_V2380(string WorkbenchConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceListByItem> CustomerPriceListByItems = new List<CustomerPriceListByItem>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(WorkbenchConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_customer_price_list_by_modules_Get", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceListByItem CustomerPriceListByItem = new CustomerPriceListByItem();

                            if (reader["IdCustomerPriceList"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);
                            }
                            if (reader["IdCPType"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                                CustomerPriceListByItem.ProductType = new ProductTypes();
                                CustomerPriceListByItem.ProductType.IdCPType = Convert.ToUInt32(reader["IdCPType"]);
                                if (reader["Reference"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ProductType.Code = Convert.ToString(reader["Reference"]);
                                }
                                if (reader["ProductType"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ProductType.Name = Convert.ToString(reader["ProductType"]);
                                    CustomerPriceListByItem.ProductType.Name_es = Convert.ToString(reader["ProductType"]);
                                    CustomerPriceListByItem.ProductType.Description = Convert.ToString(reader["ProductType"]);
                                    CustomerPriceListByItem.ProductType.Description_es = Convert.ToString(reader["ProductType"]);
                                }
                                if (reader["StatusAbbreviation"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ProductType.StatusAbbreviation = Convert.ToString(reader["StatusAbbreviation"]);
                                }
                                if (reader["StatusHtmlColor"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ProductType.StatusHtmlColor = Convert.ToString(reader["StatusHtmlColor"]);
                                }

                                if (reader["IdTemplate"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ProductType.IdTemplate = Convert.ToUInt64(reader["IdTemplate"]);
                                }
                                if (CustomerPriceListByItem.ProductType.Template == null)
                                {
                                    CustomerPriceListByItem.ProductType.Template = new Template();
                                }
                                if (reader["IdTemplate"] != DBNull.Value)
                                {
                                    CustomerPriceListByItem.ProductType.Template.IdTemplate = Convert.ToByte(reader["IdTemplate"]);
                                    CustomerPriceListByItem.ProductType.Template.Name = Convert.ToString(reader["TemplateName"]);
                                }
                            }
                            if (reader["ItemCustomerDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.ItemCustomerDescription = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                                CustomerPriceListByItem.ItemCustomerDescription_Old = Convert.ToString(reader["ItemCustomerDescription"].ToString());
                            }
                            if (reader["VisibleToCustomer"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.VisibleToCustomer = Convert.ToByte(reader["VisibleToCustomer"]);
                            }
                            if (reader["BasePriceListValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.BasePriceListValue = float.Parse(reader["BasePriceListValue"].ToString());
                            }
                            if (reader["IdRule"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.IdRule = Convert.ToInt32(reader["IdRule"]);
                            }
                            if (reader["RuleValue"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.RuleValue = float.Parse(reader["RuleValue"].ToString());
                            }
                            if (reader["Version"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.Version = Convert.ToInt32(reader["Version"]);
                            }
                            if (reader["LinkedDescription"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.LinkedDescription = Convert.ToByte(reader["LinkedDescription"]);
                            }

                            if (reader["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CustomerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(reader["CurrencyConversionDate"].ToString());
                            }
                            CustomerPriceListByItems.Add(CustomerPriceListByItem);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceListModulesById_V2380(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPriceListByItems;
        }
        #endregion


        public IList<Company> GetEmdepSitesCompaniesWithServiceURL(string connectionstring)
        {
            IList<Company> companies = new List<Company>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("PLM_GetEmdepSitesDetailWithURL", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        string connstr = "Data Source = " + sitereader["DatabaseIP"].ToString() + "; Database = geos; User ID = GeosUsr; Password = GEOS;Convert Zero Datetime=True";
                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {
                            Company company = new Company();

                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            company.Name = sitereader["Name"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            company.ServiceProviderUrl= sitereader["ServiceProviderUrl"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }

        //[rdixit][GEOS2-4474][19.06.2023]
        public bool CalculateArticleCostPrice_V2400(Company itemCompany, string mainServerConnectionString, string workbenchConnectionString, List<PODetail> EWHQpoDetailLst, List<PODetail> EWHQArticlesByArticleComponentpoDetailLst, List<ArticlePOAVG> GetPOAverageByAllPCMArticleEWHQLst)
        {
            UserManager userManager = new UserManager();
            List<GeosAppSetting> GeosAppSettingList;
            bool isCalculated = true;
            int NumberPOAvg = 0;
            List<ArticleCostPrice> articleCostPriceLst = new List<ArticleCostPrice>();
            List<ArticleCostPrice> articleCostPriceLstForAllCompanies = new List<ArticleCostPrice>();
            string connectionstring = itemCompany.ConnectPlantConstr;
            List<UInt32> allPCMidsArticles = GetAllPCMIdArticles(connectionstring);

            //List<PODetail> EWHQpoDetailLst = GetAllArticleMaxPODeliveryDateDetailFromEWHQ_V2210(connectionstring);
            //List<PODetail> EWHQArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromEWHQ_V2210(connectionstring);
           
            List<Tuple<Int32,UInt32,DateTime>> lstCurrencyConversion = new List<Tuple<int, UInt32, DateTime>>();
            if (EWHQArticlesByArticleComponentpoDetailLst != null)
            {
                foreach (PODetail item in EWHQArticlesByArticleComponentpoDetailLst)
                {
                    if (!lstCurrencyConversion.Any(x => x.Item1 == itemCompany.IdCurrency && x.Item2 == item.IdCurrency && x.Item3 == item.CreationDate))
                    {
                        Tuple<int, UInt32, DateTime> cctuple = new Tuple<int, UInt32, DateTime> ( itemCompany.IdCurrency, item.IdCurrency, item.CreationDate);
                        lstCurrencyConversion.Add(cctuple);
                    }
                }
            }
            List<ArticlesByArticle> LstAllArticlesByArticle = GetAllArticlesByArticle(connectionstring);

            List<PODetail> poDetailLst = GetAllPCMArticleMaxPODeliveryDateDetail_V2210(itemCompany.ConnectPlantConstr);
            List<PODetail> ArticlesByArticleComponentpoDetailLst = GetAllArticlesByArticleComponentMaxPOFromPlant_V2210(itemCompany.ConnectPlantConstr);
            if (ArticlesByArticleComponentpoDetailLst != null)
            {
                foreach (PODetail item in ArticlesByArticleComponentpoDetailLst)
                {
                    if (!lstCurrencyConversion.Any(x => x.Item1 == itemCompany.IdCurrency && x.Item2 == item.IdCurrency && x.Item3 == item.CreationDate))
                    {
                        Tuple<int, UInt32, DateTime> cctuple = new Tuple<int, UInt32, DateTime>(itemCompany.IdCurrency, item.IdCurrency, item.CreationDate);
                        lstCurrencyConversion.Add(cctuple);
                    }
                }
            }
            // allPCMidsArticles.Where(pa => pa == 6951)

            GeosAppSettingList = userManager.GetSelectedGeosAppSettings(workbenchConnectionString, "63");
            if (GeosAppSettingList != null && GeosAppSettingList.Count > 0)
            {
                NumberPOAvg = Convert.ToInt32(GeosAppSettingList.FirstOrDefault().DefaultValue);
            }

           // List<ArticlePOAVG> GetPOAverageByAllPCMArticleEWHQLst = WS_GetPOAverageByAllPCMArticleEWHQ(connectionstring, NumberPOAvg);
            List<ArticlePOAVG> GetPOAverageByAllPCMArticleLst = WS_GetPOAverageByAllPCMArticle(connectionstring, NumberPOAvg);
            List<CurrencyConversion> LstCurrencyConversion = new List<CurrencyConversion>();
            LstCurrencyConversion = GetALLCurrencyConversionByTOFROMDATE(workbenchConnectionString, lstCurrencyConversion);
            AdditionalArticleCost additionalArticleCost = GetAdditionalArticleCostDetail_V2220(connectionstring, itemCompany.IdCompany);

            foreach (UInt64 itemArticle in allPCMidsArticles)
            {

                try
                {
                    ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                    PODetail poDetail = null;
                    try
                    {
                        poDetail = poDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0} Company - {1}", ex.Message, itemCompany.Alias), category: Category.Exception, priority: Priority.Low);
                        poDetail = null;
                    }

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                            {
                                //List<ArticlesByArticle> LstArticlesByArticle = GetAllArticlesByArticle(itemCompany.ConnectPlantConstr, Convert.ToInt32(itemArticle));
                                List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                FinalArticleCostValue = 0;
                                FinalArticleAdditionalCost = 0;
                                FinalArticleCostAvg = 0;
                                ExchangeRateDate = DateTime.MinValue;
                                IdCurrency = 0;
                                if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                {
                                    CalculateComponentArticleCost_V2400(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle), NumberPOAvg, additionalArticleCost, GetPOAverageByAllPCMArticleEWHQLst, GetPOAverageByAllPCMArticleLst, LstCurrencyConversion);
                                    if (FinalArticleCostValue > 0)
                                    {
                                        articleCostPrice.IdArticle = itemArticle;
                                        articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                        articleCostPrice.ArticleAdditionalCost = FinalArticleAdditionalCost;
                                        if (FinalArticleAdditionalCost != 0)
                                        {
                                            FinalArticleCostValue = FinalArticleCostValue * (FinalArticleAdditionalCost / 100);
                                        }
                                        articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                        articleCostPrice.ArticleCostValueAVG = FinalArticleCostAvg;
                                        articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                        articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                        if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                        {
                                            try
                                            {

                                                using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                {
                                                    mySqlConnection.Open();
                                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                    mySqlCommand.CommandTimeout = 3000;

                                                    mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                    mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                    mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                                    mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                                    mySqlCommand.ExecuteNonQuery();
                                                    mySqlConnection.Close();

                                                }

                                                isCalculated = true;
                                            }
                                            catch (Exception ex)
                                            {

                                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                isCalculated = false;

                                            }

                                        }
                                    }
                                }
                            }
                        }
                        else
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;

                            if (additionalArticleCost != null)
                            {
                                float transport = 0;
                                float customs = 0;

                                articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                if (additionalArticleCost.Transport.Value > 0)
                                {
                                    transport = additionalArticleCost.Transport.Value / 100;
                                }
                                if (additionalArticleCost.Customs.Value > 0)
                                {
                                    customs = additionalArticleCost.Customs.Value / 100;
                                }
                                if (transport != 0 || customs != 0)
                                {
                                    articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                }

                            }
                            // GetPOAverageByIdArticleEWHQ(connectionstring, itemArticle, NumberPOAvg);
                            articleCostPrice.ArticleCostValueAVG = GetPOAverageByAllPCMArticleEWHQLst.Where(x => x.IdArticle == itemArticle).FirstOrDefault().POAVG; 
                            articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {
                            articleCostPrice.IdArticle = itemArticle;
                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                            articleCostPrice.ArticleCostValue = poDetail.UnitPrice;
                            if (additionalArticleCost != null)
                            {
                                float transport = 0;
                                float customs = 0;
                                articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                if (additionalArticleCost.Transport.Value > 0)
                                {
                                    transport = additionalArticleCost.Transport.Value / 100;
                                }
                                if (additionalArticleCost.Customs.Value > 0)
                                {
                                    customs = additionalArticleCost.Customs.Value / 100;
                                }
                                if (transport != 0 || customs != 0)
                                {
                                    articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                }

                            }
                            articleCostPrice.ArticleCostValueAVG = GetPOAverageByAllPCMArticleLst.Where(x => x.IdArticle == itemArticle).FirstOrDefault().POAVG;
                            articleCostPrice.IdCurrency = poDetail.IdCurrency;
                            articleCostPrice.ExchangeRateDate = poDetail.CreationDate;
                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                            {
                                try
                                {

                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                    {
                                        mySqlConnection.Open();
                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.CommandTimeout = 3000;

                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                        mySqlCommand.ExecuteNonQuery();
                                        mySqlConnection.Close();

                                    }

                                    isCalculated = true;
                                }
                                catch (Exception ex)
                                {

                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                    isCalculated = false;

                                }

                            }
                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQpoDetailLst.Where(pdl => pdl.IdArticle == itemArticle).FirstOrDefault();
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == Convert.ToInt32(itemArticle)))
                                {
                                    List<ArticlesByArticle> LstArticlesByArticle = LstAllArticlesByArticle.Where(a => a.IdArticle == Convert.ToInt32(itemArticle)).ToList();
                                    FinalArticleCostValue = 0;

                                    FinalArticleAdditionalCost = 0;
                                    FinalArticleCostAvg = 0;
                                    ExchangeRateDate = DateTime.MinValue;
                                    IdCurrency = 0;
                                    if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
                                    {
                                        CalculateComponentArticleCost_V2400(LstArticlesByArticle, itemCompany, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, Convert.ToInt32(itemArticle), NumberPOAvg, additionalArticleCost, GetPOAverageByAllPCMArticleEWHQLst, GetPOAverageByAllPCMArticleLst, LstCurrencyConversion);
                                        if (FinalArticleCostValue > 0)
                                        {
                                            articleCostPrice.IdArticle = itemArticle;
                                            articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);

                                            articleCostPrice.ArticleAdditionalCost = FinalArticleAdditionalCost;
                                            if (FinalArticleAdditionalCost != 0)
                                            {
                                                FinalArticleCostValue = FinalArticleCostValue * (FinalArticleAdditionalCost / 100);
                                            }
                                            articleCostPrice.ArticleCostValue = FinalArticleCostValue;
                                            articleCostPrice.ArticleCostValueAVG = FinalArticleCostAvg;
                                            articleCostPrice.IdCurrency = Convert.ToUInt32(itemCompany.IdCurrency);
                                            articleCostPrice.ExchangeRateDate = ExchangeRateDate;
                                            if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                            {
                                                try
                                                {

                                                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                                    {
                                                        mySqlConnection.Open();
                                                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                                        mySqlCommand.CommandTimeout = 3000;

                                                        mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                                        mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                                        mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                                        mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                                        mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                                        mySqlCommand.ExecuteNonQuery();
                                                        mySqlConnection.Close();

                                                    }

                                                    isCalculated = true;
                                                }
                                                catch (Exception ex)
                                                {

                                                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                                    isCalculated = false;

                                                }

                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                articleCostPrice.IdArticle = itemArticle;
                                articleCostPrice.IdCompany = Convert.ToUInt32(itemCompany.IdCompany);
                                articleCostPrice.ArticleCostValue = poDetailEWHQ.UnitPrice;
                                if (additionalArticleCost != null)
                                {
                                    float transport = 0;
                                    float customs = 0;
                                    articleCostPrice.ArticleAdditionalCost = additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value;
                                    if (additionalArticleCost.Transport.Value > 0)
                                    {
                                        transport = additionalArticleCost.Transport.Value / 100;
                                    }
                                    if (additionalArticleCost.Customs.Value > 0)
                                    {
                                        customs = additionalArticleCost.Customs.Value / 100;
                                    }
                                    if (transport != 0 || customs != 0)
                                    {
                                        articleCostPrice.ArticleCostValue = articleCostPrice.ArticleCostValue * (transport + customs);
                                    }

                                }
                                articleCostPrice.ArticleCostValueAVG = GetPOAverageByAllPCMArticleEWHQLst.Where(x => x.IdArticle == itemArticle).FirstOrDefault().POAVG;
                                articleCostPrice.IdCurrency = poDetailEWHQ.IdCurrency;
                                articleCostPrice.ExchangeRateDate = poDetailEWHQ.CreationDate;
                                if (!IsExistRecord_V2220(connectionstring, articleCostPrice))
                                {
                                    try
                                    {

                                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                                        {
                                            mySqlConnection.Open();
                                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_InsertArticleCostPrice_V2300", mySqlConnection);
                                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                                            mySqlCommand.CommandTimeout = 3000;

                                            mySqlCommand.Parameters.AddWithValue("_IdArticle", articleCostPrice.IdArticle);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValue", articleCostPrice.ArticleCostValue);
                                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now);
                                            mySqlCommand.Parameters.AddWithValue("_ExchangeRateDate", articleCostPrice.ExchangeRateDate);
                                            mySqlCommand.Parameters.AddWithValue("_IdCompany", articleCostPrice.IdCompany);
                                            mySqlCommand.Parameters.AddWithValue("_IdCurrency", articleCostPrice.IdCurrency);
                                            mySqlCommand.Parameters.AddWithValue("_IdModifier", 164);
                                            mySqlCommand.Parameters.AddWithValue("_IdCreator", 164);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleAdditionalCost", articleCostPrice.ArticleAdditionalCost);
                                            mySqlCommand.Parameters.AddWithValue("_ArticleCostValueAVG", articleCostPrice.ArticleCostValueAVG);

                                            mySqlCommand.ExecuteNonQuery();
                                            mySqlConnection.Close();

                                        }

                                        isCalculated = true;
                                    }
                                    catch (Exception ex)
                                    {

                                        Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                                        isCalculated = false;

                                    }

                                }
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    isCalculated = false;
                    Log4NetLogger.Logger.Log(string.Format("Error CalculateArticleCostPrice_V2400(). ErrorMessage- {0} Company - {1} Article{2}", ex.Message, itemCompany.Alias, itemArticle), category: Category.Exception, priority: Priority.Low);
                    FinalArticleCostValue = 0;
                    ExchangeRateDate = DateTime.MinValue;
                    IdCurrency = 0;
                }
            }
            return isCalculated;
        }


        public List<ArticlePOAVG>  WS_GetPOAverageByAllPCMArticleEWHQ(string plantconnectionstring, int NumberPOAvg)
        {
            List<ArticlePOAVG> lstArticlePOAVG = new List<ArticlePOAVG>();
            string connectionstring = GetEWHQDatabaseDetail_V2490(plantconnectionstring);//[GEOS2-6450][rdixit][18.09.2024]
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("WS_GetPOAverageByAllPCMArticleEWHQ", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                consitecommand.Parameters.AddWithValue("_NoPOAvg", NumberPOAvg);
                consitecommand.CommandTimeout = 8000;
                using (MySqlDataReader reader = consitecommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticlePOAVG articlePOAVG = new ArticlePOAVG();
                        if (reader["IdArticle"] != DBNull.Value)
                            articlePOAVG.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                        if (reader["POAvg"] != DBNull.Value)
                            articlePOAVG.POAVG = Convert.ToDouble(reader["POAvg"]);
                        lstArticlePOAVG.Add(articlePOAVG);
                    }
                }
            }
            return lstArticlePOAVG;
        }


        public List<ArticlePOAVG> WS_GetPOAverageByAllPCMArticle(string plantconnectionstring, int NumberPOAvg)
        {
            List<ArticlePOAVG> lstArticlePOAVG = new List<ArticlePOAVG>();
            using (MySqlConnection consite = new MySqlConnection(plantconnectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("WS_GetPOAverageByAllPCMArticle", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                consitecommand.Parameters.AddWithValue("_NoPOAvg", NumberPOAvg);
                consitecommand.CommandTimeout = 8000;
                using (MySqlDataReader reader = consitecommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticlePOAVG articlePOAVG = new ArticlePOAVG();
                        if (reader["IdArticle"] != DBNull.Value)
                            articlePOAVG.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                        if (reader["POAvg"] != DBNull.Value)
                            articlePOAVG.POAVG = Convert.ToDouble(reader["POAvg"]);
                        lstArticlePOAVG.Add(articlePOAVG);
                    }
                }
            }
            return lstArticlePOAVG;
        }



        public void CalculateComponentArticleCost_V2400(List<ArticlesByArticle> LstArticlesByArticle, Company plant, string workbenchConnectionString, List<ArticlesByArticle> LstAllArticlesByArticle, List<PODetail> ArticlesByArticleComponentpoDetailLst, List<PODetail> EWHQArticlesByArticleComponentpoDetailLst, Int32 idArticle, Int32 NumberPOAvg, AdditionalArticleCost additionalArticleCost,List<ArticlePOAVG> GetPOAverageByAllPCMArticleEWHQLst, List<ArticlePOAVG> GetPOAverageByAllPCMArticleLst,List<CurrencyConversion> LstCurrencyConversion)
        {
            if (LstArticlesByArticle != null && LstArticlesByArticle.Count > 0)
            {
                foreach (ArticlesByArticle item in LstArticlesByArticle)
                {
                    PODetail poDetail = ArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                    //GetArticleMaxPODeliveryDateDetail(plant.ConnectPlantConstr, item.IdComponent);

                    if (poDetail == null)
                    {
                        PODetail poDetailEWHQ = null;
                        try
                        {
                            poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                            // GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error CalculateComponentArticleCost_V2220(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            poDetailEWHQ = null;
                        }
                        if (poDetailEWHQ == null)
                        {
                            if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                            {
                                // CalculateComponentArticleCost(GetAllArticlesByArticle(plant.ConnectPlantConstr, item.IdComponent), plant, workbenchConnectionString, EWHQConnStr);
                                CalculateComponentArticleCost_V2400(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle, NumberPOAvg, additionalArticleCost,GetPOAverageByAllPCMArticleEWHQLst,GetPOAverageByAllPCMArticleLst, LstCurrencyConversion);
                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }
                        }
                        else
                        {
                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetailEWHQ.CreationDate;
                                }

                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                {
                                    currencyConversion = LstCurrencyConversion.Where(i => i.Idcurrencyto == plant.IdCurrency && i.Idcurrencyfrom == poDetailEWHQ.IdCurrency && i.LastUpdate.Date == poDetailEWHQ.CreationDate.Date).FirstOrDefault();

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByAllPCMArticleEWHQLst.Where(x => x.IdArticle == poDetailEWHQ.IdArticle).FirstOrDefault().POAVG;
                                    if (additionalArticleCost != null)
                                    {

                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);


                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByAllPCMArticleEWHQLst.Where(x => x.IdArticle == poDetailEWHQ.IdArticle).FirstOrDefault().POAVG;

                                    if (additionalArticleCost != null)
                                    {

                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);


                                    }
                                }


                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }



                        }
                    }
                    else
                    {
                        if (poDetail.IsEmdep != 1)
                        {

                            float parentQty = 0;
                            bool isParentQty = false;
                            if (idArticle != item.IdArticle)
                            {
                                isParentQty = true;
                                if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                    parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                            }
                            if ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) > 0)
                            {
                                if (ExchangeRateDate.Date < poDetail.CreationDate.Date)
                                {
                                    ExchangeRateDate = poDetail.CreationDate;
                                }
                                CurrencyConversion currencyConversion = null;
                                if (plant.IdCurrency != Convert.ToInt32(poDetail.IdCurrency))
                                {
                                    currencyConversion = LstCurrencyConversion.ToList().Where(lc => lc.Idcurrencyto == plant.IdCurrency && lc.Idcurrencyfrom == poDetail.IdCurrency && lc.LastUpdate.Date == poDetail.CreationDate.Date).FirstOrDefault();
                                   

                                }
                                if (currencyConversion != null)
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByAllPCMArticleLst.Where(x => x.IdArticle == poDetail.IdArticle).FirstOrDefault().POAVG;
                                    if (additionalArticleCost != null)
                                    {

                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);


                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetail.UnitPrice * item.Quantity) * parentQty) : (poDetail.UnitPrice * item.Quantity));
                                    FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByAllPCMArticleLst.Where(x => x.IdArticle == poDetail.IdArticle).FirstOrDefault().POAVG;
                                    if (additionalArticleCost != null)
                                    {

                                        FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);


                                    }
                                }

                            }
                            else
                            {
                                FinalArticleCostValue = 0;
                                return;
                            }


                        }
                        else
                        {
                            PODetail poDetailEWHQ = null;
                            try
                            {
                                poDetailEWHQ = EWHQArticlesByArticleComponentpoDetailLst.Where(i => i.IdArticle == item.IdComponent).FirstOrDefault();
                                //GetArticleMaxPODeliveryDateDetailFromEWHQ(EWHQConnStr, item.IdComponent);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error CalculateComponentArticleCost_V2400().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                poDetailEWHQ = null;
                            }

                            if (poDetailEWHQ == null)
                            {
                                if (LstAllArticlesByArticle != null && LstAllArticlesByArticle.Any(a => a.IdArticle == item.IdComponent))
                                {
                                    CalculateComponentArticleCost_V2400(LstAllArticlesByArticle.Where(a => a.IdArticle == item.IdComponent).ToList(), plant, workbenchConnectionString, LstAllArticlesByArticle, ArticlesByArticleComponentpoDetailLst, EWHQArticlesByArticleComponentpoDetailLst, item.IdArticle, NumberPOAvg, additionalArticleCost,GetPOAverageByAllPCMArticleEWHQLst,GetPOAverageByAllPCMArticleLst,LstCurrencyConversion);
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }
                            }
                            else
                            {

                                float parentQty = 0;
                                bool isParentQty = false;
                                if (idArticle != item.IdArticle)
                                {
                                    isParentQty = true;
                                    if (LstAllArticlesByArticle.Any(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle))
                                        parentQty = LstAllArticlesByArticle.Where(i => i.IdArticle == idArticle && i.IdComponent == item.IdArticle).FirstOrDefault().Quantity;
                                }
                                if ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) > 0)
                                {

                                    if (ExchangeRateDate.Date < poDetailEWHQ.CreationDate.Date)
                                    {
                                        ExchangeRateDate = poDetailEWHQ.CreationDate;
                                    }

                                    CurrencyConversion currencyConversion = null;
                                    if (plant.IdCurrency != Convert.ToInt32(poDetailEWHQ.IdCurrency))
                                    {
                                       
                                        currencyConversion = LstCurrencyConversion.Where(lc => lc.Idcurrencyto == plant.IdCurrency && lc.Idcurrencyfrom == poDetailEWHQ.IdCurrency && lc.LastUpdate.Date == poDetailEWHQ.CreationDate.Date).FirstOrDefault(); 
                                    }
                                    if (currencyConversion != null)
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + ((isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity)) * currencyConversion.ExchangeRate);
                                        FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByAllPCMArticleEWHQLst.Where(x => x.IdArticle == poDetailEWHQ.IdArticle).FirstOrDefault().POAVG;
                                        if (additionalArticleCost != null)
                                        {

                                            FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);


                                        }
                                    }
                                    else
                                    {
                                        FinalArticleCostValue = FinalArticleCostValue + (isParentQty ? ((poDetailEWHQ.UnitPrice * item.Quantity) * parentQty) : (poDetailEWHQ.UnitPrice * item.Quantity));
                                        FinalArticleCostAvg = FinalArticleCostAvg + GetPOAverageByAllPCMArticleEWHQLst.Where(x => x.IdArticle == poDetailEWHQ.IdArticle).FirstOrDefault().POAVG;
                                        if (additionalArticleCost != null)
                                        {

                                            FinalArticleAdditionalCost = FinalArticleAdditionalCost + (additionalArticleCost.Transport.Value + additionalArticleCost.Customs.Value);


                                        }
                                    }
                                }
                                else
                                {
                                    FinalArticleCostValue = 0;
                                    return;
                                }


                            }
                        }
                    }
                }
            }
            else
            {
                FinalArticleCostValue = 0;
                return;
            }

        }


        public List<CurrencyConversion> GetALLCurrencyConversionByTOFROMDATE(string workbenchConnectionstring, List<Tuple<int, UInt32, DateTime>> LstCurrencyConversionTuple)
        {
            List<CurrencyConversion> LstCurrencyConversion = new List<CurrencyConversion>();
           
            string IdsCurrencyConversionTo = string.Join(",", LstCurrencyConversionTuple.Select(i => i.Item1).Distinct().ToList());
            string IdsCurrencyConversionFrom = string.Join(",", LstCurrencyConversionTuple.Select(i => i.Item2).Distinct().ToList());
            DateTime minDate = LstCurrencyConversionTuple.Select(i => i.Item3.Date).Min();
            DateTime maxDate = LstCurrencyConversionTuple.Select(i => i.Item3.Date).Max();
           
            using (MySqlConnection con = new MySqlConnection(workbenchConnectionstring))
            {
                con.Open();
                MySqlCommand concommand = new MySqlCommand("WS_GetAllCurrencyConversionByTOFROMDATE", con);
                concommand.CommandType = CommandType.StoredProcedure;
                concommand.Parameters.AddWithValue("_IdsCurrencyConversionTo", IdsCurrencyConversionTo);
                concommand.Parameters.AddWithValue("_IdsCurrencyConversionFrom", IdsCurrencyConversionFrom);
                concommand.Parameters.AddWithValue("_MinExchangeRateDate", minDate);
                concommand.Parameters.AddWithValue("_MaxExchangeRateDate", maxDate);
                concommand.CommandTimeout = 8000;
                using (MySqlDataReader reader = concommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        CurrencyConversion currencyConversion = new CurrencyConversion();

                        if (reader["IdCurrencyConversionFrom"] != DBNull.Value)
                            currencyConversion.Idcurrencyfrom = Convert.ToByte( reader["IdCurrencyConversionFrom"]);
                        if (reader["IdCurrencyConversionTo"] != DBNull.Value)
                            currencyConversion.Idcurrencyto = Convert.ToByte(reader["IdCurrencyConversionTo"]);
                        if (reader["CurrencyConversionDate"] != DBNull.Value)
                            currencyConversion.LastUpdate  = Convert.ToDateTime(reader["CurrencyConversionDate"]);
                        if (reader["CurrencyConversionRate"] != DBNull.Value)
                            currencyConversion.ExchangeRate = (float)(reader["CurrencyConversionRate"]);

                        LstCurrencyConversion.Add(currencyConversion);
                    }
                }
            }
            return LstCurrencyConversion;
        }


        #region GEOS2-4935 Sudhir.Jangra
        public BasePrice AddBasePrice_V2470(BasePrice basePrice, string MainServerConnectionString, string DocPath)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestBasePriceCode = "";
                    lastestBasePriceCode = GetLatestBasePriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Insert_V2340", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestBasePriceCode) && lastestBasePriceCode != basePrice.Code)
                        {
                            basePrice.Code = lastestBasePriceCode;
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestBasePriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", basePrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", basePrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);

                        basePrice.IdBasePriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        AddPlantCurrenciesByBasePrice(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.CurrencyList, basePrice.IdCreator);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceListItems, basePrice.IdCreator);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, basePrice.IdCreator);
                        AddModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddModuleList, basePrice.IdCreator);
                        AddBasePriceListLogEntry_V2470(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdCreator);
                        AddUpdateDeletePLMArticleDocs(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PLMArticleAttachmentList, DocPath, basePrice.Name);


                        AddBasePriceCommentEntry_V2470(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceCommentsList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddBasePrice_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return basePrice;
        }


        //[Sudhir.jangra][GEOS2-4935]
        public void AddBasePriceCommentEntry_V2470(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceLogEntry> CommentList)
        {
            try
            {
                if (CommentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BasePriceLogEntry commentList in CommentList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_CommentsListByBasePriceList_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", commentList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", commentList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", commentList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddBasePriceCommentEntry_V2470(). IdCPType- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[Sudhir.Jangra][Geos2-4935]
        public void AddBasePriceListLogEntry_V2470(string MainServerConnectionString, UInt64 IdBasePriceList, List<BasePriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BasePriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByBasePriceList_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddBasePriceListLogEntry_V2470(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public BasePrice GetBasePriceDetailById_V2470(string PLMConnectionString, UInt32 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            string Icon = "";
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2370", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                            if (BasePriceReader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(BasePriceReader["BPLInCPL"]) > 0)
                                    BasePrice.IsBPLExistInCPL = true;
                            }
                        }
                    }
                }
                BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath);
                BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList_V2470(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList);
                BasePrice.PLMArticleAttachmentList = GetBPLAttachmentByIdBasePriceList(PLMConnectionString, Convert.ToUInt32(BasePrice.IdBasePriceList));
                BasePrice.BasePriceListModules = GetBasePriceListModulesById_V2370(PLMConnectionString, BasePrice.IdBasePriceList);

                BasePrice.BasePriceCommentsList= GetBasePriceCommentsByIdBasePriceList_V2470(PLMConnectionString, BasePrice.IdBasePriceList);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2470(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }
        
        //[Sudhir.Jangra][GEOS2-4935]
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        public BasePrice GetBasePriceDetailById_V2640(string PLMConnectionString, UInt32 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            string Icon = "";
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2370", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                            if (BasePriceReader["BPLInCPL"] != DBNull.Value)
                            {
                                if (Convert.ToInt32(BasePriceReader["BPLInCPL"]) > 0)
                                    BasePrice.IsBPLExistInCPL = true;
                            }
                        }
                    }
                }
                try
                {
                    BasePrice.PlantList = new List<Site>();
                    BasePrice.CurrencyList = new List<Currency>();
                    BasePrice.BasePriceListItems = new List<BasePriceListByItem>();
                    BasePrice.BasePriceListDetections = new List<BasePriceListByItem>();
                    BasePrice.LogList = new List<BasePriceLogEntry>();
                    BasePrice.PlantCurrencyList = new List<BasePriceListByPlantCurrency>();
                    BasePrice.PLMArticleAttachmentList = new List<BPLDocument>();
                    BasePrice.BasePriceListModules = new List<BasePriceListByItem>();
                    BasePrice.BasePriceCommentsList = new List<BasePriceLogEntry>();
                    var tasks = new List<Task>();
                    tasks.Add(Task.Run(() => BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList)));
                    tasks.Add(Task.Run(() => BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath)));
                    tasks.Add(Task.Run(() => BasePrice.BasePriceListItems = GetBasePriceListItemsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList)));
                    tasks.Add(Task.Run(() => BasePrice.BasePriceListDetections = GetBasePriceListDetectionsById_V2160(PLMConnectionString, BasePrice.IdBasePriceList)));
                    tasks.Add(Task.Run(() => BasePrice.LogList = GetBasePriceLogEntriesByIdBasePriceList_V2470(PLMConnectionString, BasePrice.IdBasePriceList)));
                    tasks.Add(Task.Run(() => BasePrice.PlantCurrencyList = GetPlantCurrencyByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList)));
                    tasks.Add(Task.Run(() => BasePrice.PLMArticleAttachmentList = GetBPLAttachmentByIdBasePriceList(PLMConnectionString, Convert.ToUInt32(BasePrice.IdBasePriceList))));
                    tasks.Add(Task.Run(() => BasePrice.BasePriceListModules = GetBasePriceListModulesById_V2370(PLMConnectionString, BasePrice.IdBasePriceList)));
                    tasks.Add(Task.Run(() => BasePrice.BasePriceCommentsList = GetBasePriceCommentsByIdBasePriceList_V2470(PLMConnectionString, BasePrice.IdBasePriceList)));
                    Task.WaitAll(tasks.ToArray());
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2640(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_V2640(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }

        //[Sudhir.Jangra][GEOS-4935]
        public List<BasePriceLogEntry> GetBasePriceLogEntriesByIdBasePriceList_V2470(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceLogEntry> basePriceLogEntryList = new List<BasePriceLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetLogEntriesByIdBasePriceList_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceLogEntry basePriceLogEntry = new BasePriceLogEntry();

                            basePriceLogEntry.IdLogEntryByBasePriceList = Convert.ToUInt64(reader["IdLogEntryByBasePriceList"]);

                            basePriceLogEntry.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                basePriceLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                basePriceLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                basePriceLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                basePriceLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            basePriceLogEntryList.Add(basePriceLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceLogEntriesByIdBasePriceList_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return basePriceLogEntryList;
        }


        //[Sudhir.Jangra][GEOS-4935]
        public List<BasePriceLogEntry> GetBasePriceCommentsByIdBasePriceList_V2470(string PLMConnectionString, UInt64 IdBasePriceList)
        {
            List<BasePriceLogEntry> basePriceLogEntryList = new List<BasePriceLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCommentsByIdBasePriceList_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            BasePriceLogEntry basePriceLogEntry = new BasePriceLogEntry();

                            basePriceLogEntry.IdLogEntryByBasePriceList = Convert.ToUInt64(reader["IdLogEntryByBasePriceList"]);

                            basePriceLogEntry.IdBasePriceList = Convert.ToUInt64(reader["IdBasePriceList"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                basePriceLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                basePriceLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                basePriceLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                basePriceLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                basePriceLogEntry.People = new People();
                                basePriceLogEntry.People.IdPerson = Convert.ToInt32(reader["IdPerson"].ToString());
                                basePriceLogEntry.People.Name = reader["Name"].ToString();
                                basePriceLogEntry.People.Surname = reader["Surname"].ToString();

                                if (reader["Login"] != DBNull.Value)
                                    basePriceLogEntry.People.Login = Convert.ToString(reader["Login"]);

                                if (reader["IdUserGender"] != DBNull.Value)
                                    basePriceLogEntry.People.IdPersonGender = Convert.ToByte(reader["IdUserGender"]);
                            }
                            basePriceLogEntryList.Add(basePriceLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceCommentsByIdBasePriceList_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return basePriceLogEntryList;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public bool UpdateBasePrice_V2470(BasePrice basePrice, string MainServerConnectionString, string DocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePriceList_Update_V2140", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", basePrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", basePrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", basePrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", basePrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", basePrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", basePrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", basePrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", basePrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", basePrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", basePrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", basePrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", basePrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", basePrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", basePrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", basePrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", basePrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", basePrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", basePrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", basePrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", basePrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", basePrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", basePrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", basePrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", basePrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", basePrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", basePrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", basePrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_IdExchangeRateUpdateType", basePrice.IdExchangeRateUpdateType);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    if (basePrice.IdBasePriceList > 0)
                    {
                        //information plant and currency
                        AddDeletePlantsByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.CurrencyList, basePrice.DeletePlantList, basePrice.AddPlantList, basePrice.IdModifier);
                        AddDeleteCurrenciesByBasePrice_V2120(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantList, basePrice.AddCurrencyList, basePrice.DeleteCurrencyList, basePrice.IdModifier);
                        //articles
                        DeleteArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteArticleList);
                        UpdateArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateArticleList, basePrice.IdModifier);
                        AddArticlesByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddArticleList, (uint)basePrice.IdModifier);
                        //detections
                        DeleteDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteDetectionList);
                        UpdateDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateDetectionList, basePrice.IdModifier);
                        AddDetectionsByBasePrice_V2150(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddDetectionList, (uint)basePrice.IdModifier);

                        //Modules
                        DeleteModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.DeleteModuleList);
                        UpdateModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.UpdateModuleList, basePrice.IdModifier);
                        AddModulesByBasePrice_V2370(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.AddModuleList, (uint)basePrice.IdModifier);

                        //change log/plantcurrency/cpl log/delete cpl items
                       // AddBasePriceListLogEntry(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        AddBasePriceListLogEntry_V2470(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.LogList);
                        UpdateBasePriceListByPlantCurrency(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PlantCurrencyList, basePrice.IdModifier);
                        AddCustomerPriceListLogEntryByDeleteBPLArticle(MainServerConnectionString, basePrice.CPLlogList);
                        DeleteCustomerPriceListItem(MainServerConnectionString, basePrice.CustomerPriceListItems);
                        DeleteCustomerPriceListDetection(MainServerConnectionString, basePrice.CustomerPriceListDetections);
                        DeleteCustomerPriceListSaleCurrency(MainServerConnectionString, basePrice.CustomerPriceListSaleCurrencies);
                        AddUpdateDeletePLMArticleDocs(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.PLMArticleAttachmentList, DocPath, basePrice.Name);

                        AddUpdateDeleteBasePriceComments_V2470(MainServerConnectionString, basePrice.IdBasePriceList, basePrice.BasePriceCommentsList);


                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateBasePrice_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();
                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }
            return isUpdated;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public void AddUpdateDeleteBasePriceComments_V2470(string connectionString, UInt64 idBasePrice, List<BasePriceLogEntry> commentList)
        {
            try
            {
                if (commentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (BasePriceLogEntry commentType in commentList)
                        {
                            if (commentType.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePrice_Comments_Delete_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByBasePriceList", commentType.IdLogEntryByBasePriceList);
                                mySqlCommand.ExecuteNonQuery();


                            }
                            else if (commentType.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (commentType.IdLogEntryByBasePriceList > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_BasePrice_Comments_Update_V2470", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryByBasePriceList", commentType.IdLogEntryByBasePriceList);
                                    mySqlCommand.Parameters.AddWithValue("_Comments", commentType.Comments);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", commentType.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", commentType.Datetime);
                                    mySqlCommand.Parameters.AddWithValue("_Datetime", commentType.Datetime);
                                    // mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (commentType.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CommentsEntriesByBasePrice_Insert_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", idBasePrice);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", commentType.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", commentType.Datetime);
                                mySqlCommand.Parameters.AddWithValue("_Comments", commentType.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteBasePriceComments_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public CustomerPrice AddCustomerPrice_V2470(CustomerPrice customerPrice, string MainServerConnectionString, string DocPath)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    string lastestCustomerPriceCode = "";
                    lastestCustomerPriceCode = GetLatestCustomerPriceCode(MainServerConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestCustomerPriceCode) && lastestCustomerPriceCode != customerPrice.Code)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", lastestCustomerPriceCode);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Code", customerPrice.Code);
                        }

                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_createdBy", customerPrice.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_createdIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                        customerPrice.IdCustomerPriceList = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdCreator);
                        AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdCreator);
                        AddCustomersByCPL(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, customerPrice.IdCreator);
                        AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);

                        AddCustomerPriceListLogEntry_V2470(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);

                        AddCustomerPriceCommentEntry_V2470(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceCommentsList);
                        try
                        {
                            AddModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListModules, customerPrice.IdCreator);
                        }
                        catch (Exception ex)
                        {
                        }


                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPrice_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return customerPrice;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public void AddCustomerPriceCommentEntry_V2470(string MainServerConnectionString, UInt64 IdCustomerPrice, List<CustomerPriceLogEntry> CommentList)
        {
            try
            {
                if (CommentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CustomerPriceLogEntry commentList in CommentList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByCustomerPriceList_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPrice);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", commentList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", commentList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", commentList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPriceCommentEntry_V2470(). IdCPType- {0} ErrorMessage- {1}", IdCustomerPrice, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public void AddCustomerPriceListLogEntry_V2470(string MainServerConnectionString, UInt64 IdCustomerPriceList, List<CustomerPriceLogEntry> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CustomerPriceLogEntry logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("PLM_LogEntriesByCustomerPriceList_Insert_V2470", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", logList.Datetime);
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);


                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCustomerPriceListLogEntry_V2470(). IdCustomerPriceList- {0} ErrorMessage- {1}", IdCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public CustomerPrice GetCustomerPricesById_V2470(string PLMConnectionString, UInt64 idCustomerPriceList, string currencyIconFilePath)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == CustomerPrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == CustomerPrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(CustomerPrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(CustomerPrice.Currency.Name, bytes);
                                    }

                                    CustomerPrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
               // CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CurrencyList = GetCurrenciesByIdCustomerPrice_V2160(PLMConnectionString, CustomerPrice.IdCustomerPriceList, currencyIconFilePath);
                CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.CustomerPriceListDetections = GetCustomerPriceListDetectionsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                CustomerPrice.PLMCustomerAttachmentList = GetCPLAttachmentByIdCustomerPriceList(PLMConnectionString, Convert.ToUInt32(CustomerPrice.IdCustomerPriceList));
                //BasePrice.PLMArticleAttachmentList = GetBPLAttachmentByIdBasePriceList(PLMConnectionString, Convert.ToUInt32(BasePrice.IdBasePriceList));
                //CustomerPrice.ArticleCostPriceListForSavedCPL = GetCPLArticleCostPricesByCurrency(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLArticlesSaved = GetCurrencyConversionRatesByCPLArticleDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);
                // CustomerPrice.CurrencyConversionsForCPLDetectionsSaved = GetCurrencyConversionRatesByCPLDetectionDates(PLMConnectionString, CustomerPrice.IdCurrency, CustomerPrice.IdCustomerPriceList);

                 CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList_V2470(PLMConnectionString, CustomerPrice.IdCustomerPriceList);

                CustomerPrice.CustomerPriceCommentsList = GetCustomerPriceCommentsByIdCustomerPriceList_V2470(PLMConnectionString, CustomerPrice.IdCustomerPriceList);

                try
                {
                    CustomerPrice.CustomerPriceListModules = GetCustomerPriceListModulesById_V2380(PLMConnectionString, CustomerPrice.IdCustomerPriceList);
                }
                catch (Exception ex)
                {
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2470(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public List<CustomerPriceLogEntry> GetCustomerPriceLogEntriesByIdBasePriceList_V2470(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceLogEntry> customerPriceLogEntryList = new List<CustomerPriceLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetLogEntriesByIdCustomerPriceList_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 258);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceLogEntry customerPriceLogEntry = new CustomerPriceLogEntry();

                            customerPriceLogEntry.IdLogEntryByCustomerPriceList = Convert.ToUInt64(reader["IdLogEntryByCustomerPriceList"]);

                            customerPriceLogEntry.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                customerPriceLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                customerPriceLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                customerPriceLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                customerPriceLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            customerPriceLogEntryList.Add(customerPriceLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceLogEntriesByIdCustomerPriceList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLogEntryList;
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public List<CustomerPriceLogEntry> GetCustomerPriceCommentsByIdCustomerPriceList_V2470(string PLMConnectionString, UInt64 IdCustomerPriceList)
        {
            List<CustomerPriceLogEntry> customerPriceLogEntryList = new List<CustomerPriceLogEntry>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetCommentsByIdCustomerPriceList_V2470", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", IdCustomerPriceList);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CustomerPriceLogEntry customerPriceLogEntry = new CustomerPriceLogEntry();

                            customerPriceLogEntry.IdLogEntryByCustomerPriceList = Convert.ToUInt64(reader["IdLogEntryByCustomerPriceList"]);

                            customerPriceLogEntry.IdCustomerPriceList = Convert.ToUInt64(reader["IdCustomerPriceList"]);

                            if (reader["IdUser"] != DBNull.Value)
                            {
                                customerPriceLogEntry.IdUser = Convert.ToUInt32(reader["IdUser"]);
                            }
                            if (reader["UserName"] != DBNull.Value)
                            {
                                customerPriceLogEntry.UserName = Convert.ToString(reader["UserName"]);
                            }
                            if (reader["Datetime"] != DBNull.Value)
                            {
                                customerPriceLogEntry.Datetime = Convert.ToDateTime(reader["Datetime"]);
                            }
                            if (reader["Comments"] != DBNull.Value)
                            {
                                customerPriceLogEntry.Comments = Convert.ToString(reader["Comments"]);
                            }
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                customerPriceLogEntry.People = new People();
                                customerPriceLogEntry.People.IdPerson = Convert.ToInt32(reader["IdPerson"].ToString());
                                customerPriceLogEntry.People.Name = reader["Name"].ToString();
                                customerPriceLogEntry.People.Surname = reader["Surname"].ToString();

                                if (reader["Login"] != DBNull.Value)
                                    customerPriceLogEntry.People.Login = Convert.ToString(reader["Login"]);

                                if (reader["IdUserGender"] != DBNull.Value)
                                    customerPriceLogEntry.People.IdPersonGender = Convert.ToByte(reader["IdUserGender"]);
                            }
                            customerPriceLogEntryList.Add(customerPriceLogEntry);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPriceCommentsByIdCustomerPriceList_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return customerPriceLogEntryList;
        }


        //[Sudhir.Jangra][GEOS2-4935]
        public bool UpdateCustomerPrice_V2470(CustomerPrice customerPrice, string MainServerConnectionString, string DocPath)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPriceList_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCustomerPriceList", customerPrice.IdCustomerPriceList);
                        mySqlCommand.Parameters.AddWithValue("_IdBasePriceList", customerPrice.IdBasePriceList);
                        mySqlCommand.Parameters.AddWithValue("_Name", customerPrice.Name.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_es", customerPrice.Name_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_fr", customerPrice.Name_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_pt", customerPrice.Name_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ro", customerPrice.Name_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_zh", customerPrice.Name_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Name_ru", customerPrice.Name_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description", customerPrice.Description.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_es", customerPrice.Description_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_fr", customerPrice.Description_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ro", customerPrice.Description_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_zh", customerPrice.Description_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_pt", customerPrice.Description_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Description_ru", customerPrice.Description_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_EffectiveDate", customerPrice.EffectiveDate);
                        mySqlCommand.Parameters.AddWithValue("_ExpiryDate", customerPrice.ExpiryDate);
                        mySqlCommand.Parameters.AddWithValue("_IdStatus", customerPrice.IdStatus);
                        mySqlCommand.Parameters.AddWithValue("_Remark", customerPrice.Remark.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_es", customerPrice.Remark_es.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_fr", customerPrice.Remark_fr.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ro", customerPrice.Remark_ro.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_zh", customerPrice.Remark_zh.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_pt", customerPrice.Remark_pt.Trim());
                        mySqlCommand.Parameters.AddWithValue("_Remark_ru", customerPrice.Remark_ru.Trim());
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", customerPrice.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", customerPrice.IdModifier);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }
                    if (customerPrice.IdCustomerPriceList > 0)
                    {
                        if (customerPrice.IdBasePriceList_Cloned != customerPrice.IdBasePriceList)
                        {
                            IsDeletedCustomerPriceList_Articles(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Detections(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            IsDeletedCustomerPriceList_Currencies(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListItems, customerPrice.IdModifier);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListDetections, customerPrice.IdModifier);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CurrencyList, (uint)customerPrice.IdModifier);
                            AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);

                            //Modules
                            try
                            {
                                IsDeletedCustomerPriceList_Modules(customerPrice.IdCustomerPriceList, MainServerConnectionString);
                                AddModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceListModules, customerPrice.IdModifier);


                            }
                            catch (Exception ex)
                            {
                            }
                        }
                        else
                        {
                            //Sale currencies
                            DeleteSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteCurrencyList);
                            AddSaleCurrenciesByCustomerPrice(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddCurrencyList, (uint)customerPrice.IdModifier);

                            //articles
                            DeleteArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteArticleList);
                            AddArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddArticleList, (uint)customerPrice.IdModifier);
                            UpdateArticlesByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateArticleList, customerPrice.IdModifier);

                            //detections
                            DeleteDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteDetectionList);
                            AddDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddDetectionList, (uint)customerPrice.IdModifier);
                            UpdateDetectionsByCustomerPrice_V2150(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateDetectionList, customerPrice.IdModifier);

                            try
                            {
                                //Modules
                                DeleteModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.DeleteModuleList);
                                AddModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.AddModuleList, (uint)customerPrice.IdModifier);
                                UpdateModulesByCustomerPrice_V2380(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.UpdateModuleList, customerPrice.IdModifier);
                            }
                            catch (Exception ex)
                            {
                            }
                            //attachment
                            AddUpdateDeletePLMCustomerDocs(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.PLMCustomerAttachmentList, DocPath, customerPrice.Name);
                        }
                        AddUpdateDeleteCustomersByCPL_V2110(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerList, customerPrice.IdCreator);
                        AddCustomerPriceListLogEntry_V2470(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.LogList);
                        AddUpdateDeleteCustomerPriceComments_V2470(MainServerConnectionString, customerPrice.IdCustomerPriceList, customerPrice.CustomerPriceCommentsList);
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomerPrice_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }



       
        //[Sudhir.Jangra][GEOS2-4935]
        public void AddUpdateDeleteCustomerPriceComments_V2470(string connectionString, UInt64 idCustomerPrice, List<CustomerPriceLogEntry> commentList)
        {
            try
            {
                if (commentList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CustomerPriceLogEntry commentType in commentList)
                        {
                            if (commentType.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPrice_Comments_Delete_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByCustomerPriceList", commentType.IdLogEntryByCustomerPriceList);
                                mySqlCommand.ExecuteNonQuery();


                            }
                            else if (commentType.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (commentType.IdLogEntryByCustomerPriceList > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_CustomerPrice_Comments_Update_V2470", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryByCustomerPriceList", commentType.IdLogEntryByCustomerPriceList);
                                    mySqlCommand.Parameters.AddWithValue("_Comments", commentType.Comments);
                                    mySqlCommand.Parameters.AddWithValue("_IdModifier", commentType.ModifiedBy);
                                    mySqlCommand.Parameters.AddWithValue("_ModificationDate", commentType.Datetime);
                                    mySqlCommand.Parameters.AddWithValue("_Datetime", commentType.Datetime);
                                    // mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (commentType.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("PLM_CommentsEntriesByCustomerPrice_Insert_V2470", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdCustomerPrice", idCustomerPrice);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", commentType.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", commentType.Datetime);
                                mySqlCommand.Parameters.AddWithValue("_Comments", commentType.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCustomerPriceComments_V2470(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        #endregion



        public IList<Company> GetEmdepSitesCompanies_V2490(string connectionstring)
        {
            IList<Company> companies = new List<Company>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("emdepsites_GetEmdepSitesDetail", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                // Parse the connection string
                MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionstring);

                // Extract components
                string ConnecteddataSource = builder.Server;
                string database = builder.Database;
                string userId = builder.UserID;
                string password = builder.Password;
                string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionstring);
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        Company company = new Company();
                        company.ShortName = sitereader["ShortName"].ToString();
                        string dataSource = ConnecteddataSource.Replace(connectedPlantName, sitereader["ShortName"].ToString());
                        //This will removed from code when we update everywhere logic to hit service through service provider url not from database connection string
                        string connstr = connectionstring.Replace(ConnecteddataSource, dataSource);
                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {
                           

                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            company.Name = sitereader["Name"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }

        public string GetEWHQDatabaseDetail_V2490(string connectionstring)
        {
            string connstr = null;
            // Parse the connection string
            MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionstring);

            // Extract components
            string ConnecteddataSource = builder.Server;
            string database = builder.Database;
            string userId = builder.UserID;
            string password = builder.Password;
            string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionstring);
            string dataSource = "";
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("GetEWHQDatabaseDetailWithPlantShortName_V2490", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    if (sitereader.Read())
                    {
                        if (string.IsNullOrEmpty(connectedPlantName))
                        {
                            dataSource = ConnecteddataSource.Replace(ConnecteddataSource, sitereader["DatabaseIP"].ToString());
                        }
                        else
                        {
                            dataSource = ConnecteddataSource.Replace(connectedPlantName, sitereader["ShortName"].ToString());
                          
                        }
                     
                        //This will removed from code when we update everywhere logic to hit service through service provider url not from database connection string
                         connstr = connectionstring.Replace(ConnecteddataSource, dataSource);
                        //connstr = "Data Source = " + sitereader["DatabaseIP"].ToString() + "; Database = geos; User ID = GeosUsr; Password = GEOS;Convert Zero Datetime=True";
                    }
                }
            }
            return connstr;
        }


        private string GetConnectedPlantNameFromDataSource(string datasource, string connectionString)
        {
            string connectedPlantName = "";
            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();

                MySqlCommand command = new MySqlCommand("CRM_GetAllPlantNameToCheckDataSource", conn);
                command.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader itemRow = command.ExecuteReader())
                {
                    if (itemRow.HasRows)
                    {
                        while (itemRow.Read())
                        {
                            string plantShortName = itemRow["ShortName"].ToString();
                            if (datasource.Contains(plantShortName.ToUpper()))
                            {
                                connectedPlantName = plantShortName.ToUpper();
                            }

                        }
                    }
                }
            }

            return connectedPlantName;
        }


        public List<ArticlePOAVG> WS_GetPOAverageByAllPCMArticleEWHQ_V2490(string plantconnectionstring, int NumberPOAvg)
        {
            List<ArticlePOAVG> lstArticlePOAVG = new List<ArticlePOAVG>();
            string connectionstring = GetEWHQDatabaseDetail_V2490(plantconnectionstring);
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("WS_GetPOAverageByAllPCMArticleEWHQ", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                consitecommand.Parameters.AddWithValue("_NoPOAvg", NumberPOAvg);
                consitecommand.CommandTimeout = 8000;
                using (MySqlDataReader reader = consitecommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticlePOAVG articlePOAVG = new ArticlePOAVG();
                        if (reader["IdArticle"] != DBNull.Value)
                            articlePOAVG.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                        if (reader["POAvg"] != DBNull.Value)
                            articlePOAVG.POAVG = Convert.ToDouble(reader["POAvg"]);
                        lstArticlePOAVG.Add(articlePOAVG);
                    }
                }
            }
            return lstArticlePOAVG;
        }


        public IList<Company> GetEmdepSitesCompaniesWithServiceURL_V2490(string connectionstring)
        {
            IList<Company> companies = new List<Company>();
            // Parse the connection string
            MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionstring);

            // Extract components
            string ConnecteddataSource = builder.Server;
            string database = builder.Database;
            string userId = builder.UserID;
            string password = builder.Password;
            string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionstring);
            string dataSource = "";
            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("PLM_GetEmdepSitesDetailWithURL", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        if (string.IsNullOrEmpty(connectedPlantName))
                        {
                            dataSource = ConnecteddataSource.Replace(ConnecteddataSource, sitereader["DatabaseIP"].ToString());
                        }
                        else
                        {
                            dataSource = ConnecteddataSource.Replace(connectedPlantName, sitereader["ShortName"].ToString());

                        }

                        //This will removed from code when we update everywhere logic to hit service through service provider url not from database connection string
                      string  connstr = connectionstring.Replace(ConnecteddataSource, dataSource);
                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {
                            Company company = new Company();

                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            company.Name = sitereader["Name"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            company.ServiceProviderUrl = sitereader["ServiceProviderUrl"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }

        //[rdixit][27.03.2024][GEOS2-5556]
        public IList<Company> GetEmdepSitesCompanies_V2500(string connectionstring)
        {
            IList<Company> companies = new List<Company>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("emdepsites_GetEmdepSitesDetail_V2500", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                // Parse the connection string
                MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionstring);

                // Extract components
                string ConnecteddataSource = builder.Server.ToUpper();
                string database = builder.Database;
                string userId = builder.UserID;
                string password = builder.Password;
                string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionstring);
                string dataSource = "";
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        Company company = new Company();
                        company.ShortName = sitereader["ShortName"].ToString();                     
                        if (string.IsNullOrEmpty(connectedPlantName))
                        {
                            dataSource = ConnecteddataSource.Replace(ConnecteddataSource, sitereader["DatabaseIP"].ToString());
                        }
                        else
                        {
                            dataSource = ConnecteddataSource.Replace(connectedPlantName, sitereader["ShortName"].ToString());                     
                        }                     
                        string connstr = connectionstring.Replace(builder.Server, dataSource);
                        if (companies.Any(co => co.ConnectPlantConstr == connstr))
                        {

                        }

                        else
                        {                            
                            company.Alias = sitereader["ShortName"].ToString();
                            company.ShortName = sitereader["ShortName"].ToString();
                            company.Name = sitereader["Name"].ToString();
                            company.IdCompany = Convert.ToInt32(sitereader["IdSite"].ToString());
                            if (sitereader["IdCurrency"] != DBNull.Value)
                                company.IdCurrency = Convert.ToInt32(sitereader["IdCurrency"].ToString());
                            company.Country = new Country();
                            company.Country.IdCountry = Convert.ToByte(sitereader["idCountry"].ToString());
                            company.Country.Name = sitereader["name"].ToString();
                            company.ConnectPlantId = sitereader["IdSite"].ToString();
                            company.ConnectPlantConstr = connstr;
                            company.ServiceProviderUrl = sitereader["ServiceProviderUrl"].ToString();
                            companies.Add(company);
                        }
                    }
                }
            }
            return companies;
        }
        //[nsatpute][28-05-2025][GEOS2-6689]
        public CustomerPrice GetCustomerPricesById_V2650(string PLMConnectionString, UInt64 idCustomerPriceList, string currencyIconFilePath)
        {
            CustomerPrice CustomerPrice = new CustomerPrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();
                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetCustomerPriceListById", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdCustomerPriceList", idCustomerPriceList);
                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            CustomerPrice.IdCustomerPriceList = idCustomerPriceList;
                            CustomerPrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);
                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                CustomerPrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                CustomerPrice.Name = Convert.ToString(BasePriceReader["Name"]).Trim();
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                CustomerPrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]).Trim();
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]).Trim();
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]).Trim();
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]).Trim();
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]).Trim();
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]).Trim();
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                CustomerPrice.Description = Convert.ToString(BasePriceReader["Description"]).Trim();
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                CustomerPrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]).Trim();
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]).Trim();
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]).Trim();
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]).Trim();
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]).Trim();
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]).Trim();
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                CustomerPrice.Remark = Convert.ToString(BasePriceReader["Remark"]).Trim();
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]).Trim();
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]).Trim();
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]).Trim();
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]).Trim();
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]).Trim();
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                CustomerPrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]).Trim();
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                CustomerPrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                CustomerPrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                CustomerPrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                CustomerPrice.Status = new LookupValue();
                                CustomerPrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    CustomerPrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                CustomerPrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                CustomerPrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                CustomerPrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                CustomerPrice.Currency = new Currency();
                                CustomerPrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    CustomerPrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);
                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == CustomerPrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == CustomerPrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(CustomerPrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(CustomerPrice.Currency.Name, bytes);
                                    }

                                    CustomerPrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }

                var tasks = new List<Task>{
                Task.Run(() =>CustomerPrice.CustomerList = GetCPLCustomersByIdCustomerPriceList_V2110(PLMConnectionString, CustomerPrice.IdCustomerPriceList)),
                Task.Run(() =>CustomerPrice.CurrencyList = GetCurrenciesByIdCustomerPrice_V2160(PLMConnectionString, CustomerPrice.IdCustomerPriceList, currencyIconFilePath)),
                Task.Run(() => CustomerPrice.CustomerPriceListItems = GetCustomerPriceListItemsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList)),
                Task.Run(() => CustomerPrice.CustomerPriceListDetections = GetCustomerPriceListDetectionsById_V2150(PLMConnectionString, CustomerPrice.IdCustomerPriceList)),
                Task.Run(() => CustomerPrice.PLMCustomerAttachmentList = GetCPLAttachmentByIdCustomerPriceList(PLMConnectionString, Convert.ToUInt32(CustomerPrice.IdCustomerPriceList))),
                Task.Run(() => CustomerPrice.LogList = GetCustomerPriceLogEntriesByIdBasePriceList_V2470(PLMConnectionString, CustomerPrice.IdCustomerPriceList)),
                Task.Run(() => CustomerPrice.CustomerPriceCommentsList = GetCustomerPriceCommentsByIdCustomerPriceList_V2470(PLMConnectionString, CustomerPrice.IdCustomerPriceList)),
                Task.Run(() =>{ try
                {
                    CustomerPrice.CustomerPriceListModules = GetCustomerPriceListModulesById_V2380(PLMConnectionString,
                        CustomerPrice.IdCustomerPriceList);
                }
                catch (Exception ex)
                {
                  Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2470(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);

                }})
                };

                Task.WaitAll(tasks.ToArray());

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCustomerPricesById_V2470(). idCustomerPriceList- {0} ErrorMessage- {1}", idCustomerPriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return CustomerPrice;
        }
        //[nsatpute][28-05-2025][GEOS2-6689]
        public List<ArticleCostPrice> GetArticleCostPricesByCurrency_V2650(string PLMConnectionString, UInt32 IdCurrency)
        {
            List<ArticleCostPrice> articleCostPrices = new List<ArticleCostPrice>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(PLMConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("PLM_GetArticleCostPricesByCurrency_V2650", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCurrency", IdCurrency);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticleCostPrice articleCostPrice = new ArticleCostPrice();
                            articleCostPrice.IdArticleCostPrice = Convert.ToUInt64(reader["IdArticleCostPrice"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                articleCostPrice.IdArticle = Convert.ToUInt64(reader["IdArticle"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                articleCostPrice.IdCompany = Convert.ToUInt32(reader["IdCompany"]);
                            }
                            if (reader["IdCurrency"] != DBNull.Value)
                            {
                                articleCostPrice.IdCurrency = Convert.ToUInt32(reader["IdCurrency"]);
                            }
                            if (reader["ArticleCostValue"] != DBNull.Value)
                            {
                                articleCostPrice.ArticleCostValue = Convert.ToDouble(reader["ArticleCostValue"]);
                            }
                            if (reader["ExchangeRateDate"] != DBNull.Value)
                            {
                                articleCostPrice.ExchangeRateDate = Convert.ToDateTime(reader["ExchangeRateDate"]);
                            }
                            articleCostPrices.Add(articleCostPrice);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetArticleCostPricesByCurrency_V2160(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return articleCostPrices;
        }
        //[nsatpute][28-05-2025][GEOS2-6689]
        public BasePrice GetBasePriceDetailById_ForCPL_V2650(string PLMConnectionString, UInt64 IdBasePriceList, string currencyIconFilePath)
        {
            BasePrice BasePrice = new BasePrice();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            try
            {
                using (MySqlConnection connBasePrice = new MySqlConnection(PLMConnectionString))
                {
                    connBasePrice.Open();

                    MySqlCommand BasePriceCommand = new MySqlCommand("PLM_GetBasePriceById_V2140", connBasePrice);
                    BasePriceCommand.CommandType = CommandType.StoredProcedure;
                    BasePriceCommand.Parameters.AddWithValue("_IdBasePriceList", IdBasePriceList);


                    using (MySqlDataReader BasePriceReader = BasePriceCommand.ExecuteReader())
                    {
                        while (BasePriceReader.Read())
                        {
                            BasePrice.IdBasePriceList = Convert.ToUInt64(BasePriceReader["IdBasePriceList"]);

                            if (BasePriceReader["Code"] != DBNull.Value)
                            {
                                BasePrice.Code = Convert.ToString(BasePriceReader["Code"]);
                            }
                            if (BasePriceReader["Name"] != DBNull.Value)
                            {
                                BasePrice.Name = Convert.ToString(BasePriceReader["Name"]);
                            }
                            if (BasePriceReader["Name_es"] != DBNull.Value)
                            {
                                BasePrice.Name_es = Convert.ToString(BasePriceReader["Name_es"]);
                            }
                            if (BasePriceReader["Name_fr"] != DBNull.Value)
                            {
                                BasePrice.Name_fr = Convert.ToString(BasePriceReader["Name_fr"]);
                            }
                            if (BasePriceReader["Name_pt"] != DBNull.Value)
                            {
                                BasePrice.Name_pt = Convert.ToString(BasePriceReader["Name_pt"]);
                            }
                            if (BasePriceReader["Name_ro"] != DBNull.Value)
                            {
                                BasePrice.Name_ro = Convert.ToString(BasePriceReader["Name_ro"]);
                            }
                            if (BasePriceReader["Name_ru"] != DBNull.Value)
                            {
                                BasePrice.Name_ru = Convert.ToString(BasePriceReader["Name_ru"]);
                            }
                            if (BasePriceReader["Name_zh"] != DBNull.Value)
                            {
                                BasePrice.Name_zh = Convert.ToString(BasePriceReader["Name_zh"]);
                            }
                            if (BasePriceReader["Description"] != DBNull.Value)
                            {
                                BasePrice.Description = Convert.ToString(BasePriceReader["Description"]);
                            }
                            if (BasePriceReader["Description_es"] != DBNull.Value)
                            {
                                BasePrice.Description_es = Convert.ToString(BasePriceReader["Description_es"]);
                            }
                            if (BasePriceReader["Description_fr"] != DBNull.Value)
                            {
                                BasePrice.Description_fr = Convert.ToString(BasePriceReader["Description_fr"]);
                            }
                            if (BasePriceReader["Description_pt"] != DBNull.Value)
                            {
                                BasePrice.Description_pt = Convert.ToString(BasePriceReader["Description_pt"]);
                            }
                            if (BasePriceReader["Description_ro"] != DBNull.Value)
                            {
                                BasePrice.Description_ro = Convert.ToString(BasePriceReader["Description_ro"]);
                            }
                            if (BasePriceReader["Description_ru"] != DBNull.Value)
                            {
                                BasePrice.Description_ru = Convert.ToString(BasePriceReader["Description_ru"]);
                            }
                            if (BasePriceReader["Description_zh"] != DBNull.Value)
                            {
                                BasePrice.Description_zh = Convert.ToString(BasePriceReader["Description_zh"]);
                            }
                            if (BasePriceReader["Remark"] != DBNull.Value)
                            {
                                BasePrice.Remark = Convert.ToString(BasePriceReader["Remark"]);
                            }
                            if (BasePriceReader["Remark_es"] != DBNull.Value)
                            {
                                BasePrice.Remark_es = Convert.ToString(BasePriceReader["Remark_es"]);
                            }
                            if (BasePriceReader["Remark_fr"] != DBNull.Value)
                            {
                                BasePrice.Remark_fr = Convert.ToString(BasePriceReader["Remark_fr"]);
                            }
                            if (BasePriceReader["Remark_pt"] != DBNull.Value)
                            {
                                BasePrice.Remark_pt = Convert.ToString(BasePriceReader["Remark_pt"]);
                            }
                            if (BasePriceReader["Remark_ro"] != DBNull.Value)
                            {
                                BasePrice.Remark_ro = Convert.ToString(BasePriceReader["Remark_ro"]);
                            }
                            if (BasePriceReader["Remark_ru"] != DBNull.Value)
                            {
                                BasePrice.Remark_ru = Convert.ToString(BasePriceReader["Remark_ru"]);
                            }
                            if (BasePriceReader["Remark_zh"] != DBNull.Value)
                            {
                                BasePrice.Remark_zh = Convert.ToString(BasePriceReader["Remark_zh"]);
                            }
                            if (BasePriceReader["EffectiveDate"] != DBNull.Value)
                            {
                                BasePrice.EffectiveDate = Convert.ToDateTime(BasePriceReader["EffectiveDate"]);
                            }
                            if (BasePriceReader["ExpiryDate"] != DBNull.Value)
                            {
                                BasePrice.ExpiryDate = Convert.ToDateTime(BasePriceReader["ExpiryDate"]);
                            }
                            if (BasePriceReader["IdStatus"] != DBNull.Value)
                            {
                                BasePrice.IdStatus = Convert.ToUInt32(BasePriceReader["IdStatus"]);
                                BasePrice.Status = new LookupValue();
                                BasePrice.Status.IdLookupValue = Convert.ToInt32(BasePriceReader["IdStatus"]);
                                if (BasePriceReader["Status"] != DBNull.Value)
                                {
                                    BasePrice.Status.Value = Convert.ToString(BasePriceReader["Status"]);
                                }
                            }

                            if (BasePriceReader["IdExchangeRateUpdateType"] != DBNull.Value)
                            {
                                BasePrice.IdExchangeRateUpdateType = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                BasePrice.ExchangeRateUpdateType = new LookupValue();
                                BasePrice.ExchangeRateUpdateType.IdLookupValue = Convert.ToInt32(BasePriceReader["IdExchangeRateUpdateType"]);
                                if (BasePriceReader["ExchangeRateUpdateType"] != DBNull.Value)
                                {
                                    BasePrice.ExchangeRateUpdateType.Value = Convert.ToString(BasePriceReader["ExchangeRateUpdateType"]);
                                }
                            }
                            if (BasePriceReader["CreatedIn"] != DBNull.Value)
                            {
                                BasePrice.CreationDate = Convert.ToDateTime(BasePriceReader["CreatedIn"]);
                            }
                            if (BasePriceReader["LastUpdate"] != DBNull.Value)
                            {
                                BasePrice.LastUpdated = Convert.ToDateTime(BasePriceReader["LastUpdate"]);
                            }
                            if (BasePriceReader["IdCurrency"] != DBNull.Value)
                            {
                                BasePrice.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                BasePrice.Currency = new Currency();
                                BasePrice.Currency.IdCurrency = Convert.ToByte(BasePriceReader["IdCurrency"]);
                                if (BasePriceReader["Currency"] != DBNull.Value)
                                {
                                    BasePrice.Currency.Name = Convert.ToString(BasePriceReader["Currency"]);

                                    byte[] bytes = null;
                                    if (DictCurrencies.Any(i => i.Key == BasePrice.Currency.Name))
                                    {
                                        bytes = DictCurrencies.Where(i => i.Key == BasePrice.Currency.Name).FirstOrDefault().Value;
                                    }
                                    else
                                    {
                                        bytes = GetCurrencyIconFileInBytes(BasePrice.Currency.Name, currencyIconFilePath);
                                        DictCurrencies.Add(BasePrice.Currency.Name, bytes);
                                    }
                                    BasePrice.Currency.CurrencyIconbytes = bytes;
                                }
                            }
                        }
                    }
                }
                var tasks = new List<Task>() {
                 Task.Run(()=>   BasePrice.PlantList = GetPlantsByIdBasePrice(PLMConnectionString, BasePrice.IdBasePriceList)),
                    Task.Run(()=>   BasePrice.CurrencyList = GetCurrenciesByIdBasePrice_V2160(PLMConnectionString, BasePrice.IdBasePriceList, currencyIconFilePath)),
                    Task.Run(()=>   BasePrice.BasePriceListItems_ForCPL = GetBasePriceListItemsById_ForCPL_V2160(PLMConnectionString, BasePrice.IdBasePriceList)),
                    Task.Run(()=>   BasePrice.BasePriceListDetections_ForCPL = GetBasePriceListDetectionsById_ForCPL_V2160(PLMConnectionString, BasePrice.IdBasePriceList)),
                    Task.Run(()=>   BasePrice.BasePriceListModules_ForCPL = GetBasePriceListModulesById_ForCPL_V2380(PLMConnectionString, BasePrice.IdBasePriceList))
                };
                Task.WaitAll(tasks.ToArray());
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBasePriceDetailById_ForCPL_V2650(). IdBasePriceList- {0} ErrorMessage- {1}", IdBasePriceList, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return BasePrice;
        }
    }
}