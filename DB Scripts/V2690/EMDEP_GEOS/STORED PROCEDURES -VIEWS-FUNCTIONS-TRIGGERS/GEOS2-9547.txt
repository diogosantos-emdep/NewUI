
DROP PROCEDURE IF EXISTS emdep_geos.APM_GetUnAuthorizedLocationListByIdCompany_V2690;
DELIMITER &&
CREATE PROCEDURE emdep_geos.APM_GetUnAuthorizedLocationListByIdCompany_V2690(
  IN _IdCompanies text)
 BEGIN
 -- [shweta.thube][GEOS2-9547][27-11-2025]
 -- call APM_GetUnAuthorizedLocationListByIdCompany_V2690("11976,18");
    SELECT sup.IdCompany,
                 comp.Name AS CompanyName,
                 comp.IdCountry,
                 comp.Alias,
                 co.Name AS CountryName,
                 comp.IsLocation,
                 comp.IsOrganization,
                 comp.IsCompany,
                 comp.IsStillActive,
                 cu.IdCurrency,
                 co.Iso AS CountryISO,
                 counRegion.Value as region,
                 counRegion.IdLookupValue as IdRegion
            FROM site_user_permission sup
                 INNER JOIN companies comp ON sup.IdCompany = comp.IdCompany
                 INNER JOIN countries co ON co.idCountry = comp.IdCountry
                 INNER JOIN geos.countries C ON C.IdCountry = comp.IdCountry
				 LEFT JOIN lookup_values counRegion ON counRegion.IdLookupValue = C.IdRegion
                 INNER JOIN currencies cu
                    ON cu.IdCurrency = co.IdOfficialCurrency
           WHERE 
           FIND_IN_SET(comp.IdCompany, _IdCompanies)
          GROUP BY sup.IdCompany
          ORDER BY comp.IdCountry;
  END &&
  DELIMITER ;
