using System;
using System.Collections.Generic;
using System.Linq;
using Emdep.Geos.Data.Common;
using Emdep.Geos.Data.Common.Hrm;
using Emdep.Geos.Data.BusinessLogic.Logging;
using System.IO;
using MySql.Data.MySqlClient;
using System.Data;
using Prism.Logging;
using Emdep.Geos.Data.Common.Epc;
using System.Transactions;
using ChinhDo.Transactions;
using System.Globalization;
using NodaTime;
using System.Windows;

namespace Emdep.Geos.Data.BusinessLogic
{
    public class HrmManager
    {
        TxFileManager fileMgr = new TxFileManager();
        CultureInfo currentCulture = CultureInfo.CurrentCulture;

        public HrmManager()
        {
            try
            {
                if (Log4NetLogger.Logger == null)
                {
                    string ApplicationLogFilePath = System.Web.Hosting.HostingEnvironment.MapPath("/") + "log4net.config";
                    FileInfo file = new FileInfo(ApplicationLogFilePath);
                    Log4NetLogger.Logger = LoggerFactory.CreateLogger(LogType.Log4Net, file);
                }
            }
            catch
            {
                throw;
            }
        }

        /// <summary>
        /// This method is used to get all employees.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <returns>The list of employees.</returns>
        public List<Employee> GetAllEmployees(string workbenchConnectionString, string employeesProfileImagePath)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployees", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["MobValue"] != DBNull.Value)
                                employee.EmployeeContactMobile = Convert.ToString(empReader["MobValue"]);

                            if (empReader["EmailValue"] != DBNull.Value)
                                employee.EmployeeContactEmail = Convert.ToString(empReader["EmailValue"]);

                            if (empReader["IdJobDescription"] != DBNull.Value)
                            {
                                EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                empJobDescription.JobDescription = new JobDescription();

                                if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                {
                                    empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);

                                    TimeSpan span = DateTime.Now - Convert.ToDateTime(empReader["HireDate"]);

                                    if (Convert.ToDateTime(empReader["HireDate"]) > DateTime.Now)
                                    {
                                        employee.LengthOfService = 0;
                                    }
                                    else
                                    {
                                        // because we start at year 1 for the Gregorian calendar, we must subtract a year here.
                                        employee.LengthOfService = (zeroTime + span).Year - 1;
                                    }

                                }

                                employee.EmployeeJobDescription = empJobDescription;
                            }

                            if (empReader["IdContractSituation"] != DBNull.Value)
                            {
                                employee.ContractSituation = new ContractSituation();
                                employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);


                                if (empReader["HireDate"] != DBNull.Value)
                                {
                                    employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);

                                    TimeSpan span = DateTime.Now - Convert.ToDateTime(empReader["HireDate"]);

                                    if (Convert.ToDateTime(empReader["HireDate"]) > DateTime.Now)
                                    {
                                        employee.LengthOfService = 0;
                                    }
                                    else
                                    {
                                        // because we start at year 1 for the Gregorian calendar, we must subtract a year here.
                                        employee.LengthOfService = (zeroTime + span).Year - 1;
                                    }
                                }
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployees(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetAllEmployees().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        /// <summary>
        /// This method is to get employee image
        /// </summary>
        /// <param name="employeeCode">Employee Code</param>
        /// <param name="employeesProfileImagePath">Employee Image Path</param>
        /// <returns>Employee Image in bytes</returns>
        public byte[] GetEmployeeImage(string employeeCode, string employeesProfileImagePath)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Empty;

            if (File.Exists(employeesProfileImagePath + employeeCode + ".png"))
            {
                fileUploadPath = string.Format("{0}{1}.png", employeesProfileImagePath, employeeCode);
            }
            else
            {
                fileUploadPath = string.Format("{0}{1}.jpg", employeesProfileImagePath, employeeCode);
            }

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeImage(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        #region Get employee details by idEmployee.


        /// <summary>
        /// This method is used to get employee details by idEmployee.
        /// </summary>
        /// <param name="workbenchConnectionString">Workbench connection string (emdep_geos database)</param>
        /// <param name="idEmployee">Get Employee Id</param>
        /// <param name="selectedPeriod">Get Selected period</param>
        /// <param name="idCompany">Get IdCompany</param>
        /// <returns>Employee details related to employee id,selectedperiod,idCompany</returns>
        public Employee GetEmployeeByIdEmployee(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                employee.EmployeeShifts = GetEmployeeShifts(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }



        /// <summary>
        /// This method is used to get all contacts of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">Employee Id</param>
        /// <param name="isCompanyUse">Is company use detail</param>
        /// <returns>The list of employee contacts.</returns>
        public List<EmployeeContact> GetEmployeeContactsByIdEmployee(string workbenchConnectionString, Int32 idEmployee, byte isCompanyUse)
        {
            List<EmployeeContact> employeeContacts = new List<EmployeeContact>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContactsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_IsCompanyUse", isCompanyUse);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeContact employeeContact = new EmployeeContact();
                            employeeContact.IdEmployee = idEmployee;

                            if (reader["IdEmployeeContact"] != DBNull.Value)
                                employeeContact.IdEmployeeContact = Convert.ToUInt64(reader["IdEmployeeContact"]);
                            if (reader["EmployeeContactIdType"] != DBNull.Value)
                                employeeContact.EmployeeContactIdType = Convert.ToInt32(reader["EmployeeContactIdType"]);

                            employeeContact.EmployeeContactType = new LookupValue();
                            employeeContact.EmployeeContactType.IdLookupValue = employeeContact.EmployeeContactIdType;

                            if (reader["Value"] != DBNull.Value)
                                employeeContact.EmployeeContactType.Value = Convert.ToString(reader["Value"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                employeeContact.EmployeeContactType.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            if (reader["InUse"] != DBNull.Value)
                                employeeContact.EmployeeContactType.InUse = Convert.ToBoolean(reader["InUse"]);

                            if (reader["EmployeeContactValue"] != DBNull.Value)
                            {
                                employeeContact.EmployeeContactValue = Convert.ToString(reader["EmployeeContactValue"]);
                            }

                            if (reader["EmployeeContactRemarks"] != DBNull.Value)
                                employeeContact.EmployeeContactRemarks = Convert.ToString(reader["EmployeeContactRemarks"]);

                            if (reader["IsCompanyUse"] != DBNull.Value)
                                employeeContact.IsCompanyUse = Convert.ToByte(reader["IsCompanyUse"]);

                            employeeContacts.Add(employeeContact);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeContactsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContacts;
        }

        /// <summary>
        /// This method is used to get all documents of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">The Employee Id.</param>
        /// <returns>The list of employee contacts.</returns>
        public List<EmployeeDocument> GetEmployeeDocumentsByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeDocument> employeeDocuments = new List<EmployeeDocument>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeDocumentsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeDocument employeeDocument = new EmployeeDocument();
                            employeeDocument.IdEmployee = idEmployee;
                            if (reader["IdEmployeeDocument"] != DBNull.Value)
                                employeeDocument.IdEmployeeDocument = Convert.ToUInt64(reader["IdEmployeeDocument"]);

                            employeeDocument.EmployeeDocumentName = Convert.ToString(reader["EmployeeDocumentName"]);

                            if (reader["EmployeeDocumentIdType"] != DBNull.Value)
                            {
                                employeeDocument.EmployeeDocumentIdType = Convert.ToInt32(reader["EmployeeDocumentIdType"]);
                                employeeDocument.EmployeeDocumentType = new LookupValue();
                                employeeDocument.EmployeeDocumentType.IdLookupValue = employeeDocument.EmployeeDocumentIdType;

                                if (reader["Value"] != DBNull.Value)
                                    employeeDocument.EmployeeDocumentType.Value = Convert.ToString(reader["Value"]);

                                if (reader["HtmlColor"] != DBNull.Value)
                                    employeeDocument.EmployeeDocumentType.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                if (reader["InUse"] != DBNull.Value)
                                    employeeDocument.EmployeeDocumentType.InUse = Convert.ToBoolean(reader["InUse"]);
                            }

                            if (reader["EmployeeDocumentNumber"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                            if (reader["EmployeeDocumentIssueDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentIssueDate = Convert.ToDateTime(reader["EmployeeDocumentIssueDate"]);

                            if (reader["EmployeeDocumentExpiryDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentExpiryDate = Convert.ToDateTime(reader["EmployeeDocumentExpiryDate"]);

                            if (reader["EmployeeDocumentFileName"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentFileName = Convert.ToString(reader["EmployeeDocumentFileName"]);

                            if (reader["EmployeeDocumentRemarks"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentRemarks = Convert.ToString(reader["EmployeeDocumentRemarks"]);

                            employeeDocuments.Add(employeeDocument);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDocumentsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeDocuments;
        }

        /// <summary>
        /// This method is used to get all languages of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">The Employee Id.</param>
        /// <returns>The list of employee languages.</returns>
        public List<EmployeeLanguage> GetEmployeeLanguagesByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeLanguage> employeeLanguages = new List<EmployeeLanguage>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLanguagesByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeLanguage employeeLanguage = new EmployeeLanguage();
                            employeeLanguage.IdEmployee = idEmployee;
                            if (reader["IdEmployeeLanguage"] != DBNull.Value)
                                employeeLanguage.IdEmployeeLanguage = Convert.ToUInt64(reader["IdEmployeeLanguage"]);

                            if (reader["IdLanguage"] != DBNull.Value)
                            {
                                employeeLanguage.IdLanguage = Convert.ToInt32(reader["IdLanguage"]);

                                employeeLanguage.Language = new LookupValue();
                                employeeLanguage.Language.IdLookupValue = employeeLanguage.IdLanguage;

                                if (reader["Language"] != DBNull.Value)
                                    employeeLanguage.Language.Value = Convert.ToString(reader["Language"]);
                            }

                            if (reader["UnderstandingIdLanguageLevel"] != DBNull.Value)
                            {
                                employeeLanguage.UnderstandingIdLanguageLevel = Convert.ToInt32(reader["UnderstandingIdLanguageLevel"]);

                                employeeLanguage.UnderstandingLevel = new LookupValue();
                                employeeLanguage.UnderstandingLevel.IdLookupValue = employeeLanguage.UnderstandingIdLanguageLevel;

                                if (reader["UnderstandingLevel"] != DBNull.Value)
                                    employeeLanguage.UnderstandingLevel.Value = Convert.ToString(reader["UnderstandingLevel"]);
                            }

                            if (reader["SpeakingIdLanguageLevel"] != DBNull.Value)
                            {
                                employeeLanguage.SpeakingIdLanguageLevel = Convert.ToInt32(reader["SpeakingIdLanguageLevel"]);

                                employeeLanguage.SpeakingLevel = new LookupValue();
                                employeeLanguage.SpeakingLevel.IdLookupValue = employeeLanguage.SpeakingIdLanguageLevel;

                                if (reader["SpeakingLevel"] != DBNull.Value)
                                    employeeLanguage.SpeakingLevel.Value = Convert.ToString(reader["SpeakingLevel"]);
                            }

                            if (reader["WritingIdLanguageLevel"] != DBNull.Value)
                            {
                                employeeLanguage.WritingIdLanguageLevel = Convert.ToInt32(reader["WritingIdLanguageLevel"]);

                                employeeLanguage.WritingLevel = new LookupValue();
                                employeeLanguage.WritingLevel.IdLookupValue = employeeLanguage.WritingIdLanguageLevel;

                                if (reader["WritingLevel"] != DBNull.Value)
                                    employeeLanguage.WritingLevel.Value = Convert.ToString(reader["WritingLevel"]);
                            }

                            if (reader["LanguageRemarks"] != DBNull.Value)
                                employeeLanguage.LanguageRemarks = Convert.ToString(reader["LanguageRemarks"]);

                            employeeLanguages.Add(employeeLanguage);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLanguagesByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLanguages;
        }

        /// <summary>
        /// This method is used to get all education qualifications of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">The Employee Id.</param>
        /// <returns>The list of employee education qualifications.</returns>
        public List<EmployeeEducationQualification> GetEmployeeEducationQualificationsByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeEducationQualification> employeeEducationQualifications = new List<EmployeeEducationQualification>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEducationQualificationsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeEducationQualification employeeEducationQualification = new EmployeeEducationQualification();
                            employeeEducationQualification.IdEmployee = idEmployee;
                            if (reader["IdEmployeeEducationQualification"] != DBNull.Value)
                                employeeEducationQualification.IdEmployeeEducationQualification = Convert.ToUInt64(reader["IdEmployeeEducationQualification"]);

                            if (reader["IdEducationQualification"] != DBNull.Value)
                            {
                                employeeEducationQualification.IdEducationQualification = Convert.ToUInt32(reader["IdEducationQualification"]);

                                employeeEducationQualification.EducationQualification = new EducationQualification();
                                employeeEducationQualification.EducationQualification.IdEducationQualification = employeeEducationQualification.IdEducationQualification;

                                if (reader["Name"] != DBNull.Value)
                                    employeeEducationQualification.EducationQualification.Name = Convert.ToString(reader["Name"]);

                                if (reader["QualificationLevel"] != DBNull.Value)
                                    employeeEducationQualification.EducationQualification.QualificationLevel = Convert.ToUInt32(reader["QualificationLevel"]);
                            }

                            if (reader["QualificationName"] != DBNull.Value)
                                employeeEducationQualification.QualificationName = Convert.ToString(reader["QualificationName"]);

                            if (reader["QualificationEntity"] != DBNull.Value)
                                employeeEducationQualification.QualificationEntity = Convert.ToString(reader["QualificationEntity"]);

                            if (reader["QualificationClassification"] != DBNull.Value)
                                employeeEducationQualification.QualificationClassification = Convert.ToString(reader["QualificationClassification"]);

                            if (reader["QualificationStartDate"] != DBNull.Value)
                                employeeEducationQualification.QualificationStartDate = Convert.ToDateTime(reader["QualificationStartDate"]);

                            if (reader["QualificationEndDate"] != DBNull.Value)
                                employeeEducationQualification.QualificationEndDate = Convert.ToDateTime(reader["QualificationEndDate"]);

                            if (reader["QualificationFileName"] != DBNull.Value)
                                employeeEducationQualification.QualificationFileName = Convert.ToString(reader["QualificationFileName"]);

                            if (reader["QualificationRemarks"] != DBNull.Value)
                                employeeEducationQualification.QualificationRemarks = Convert.ToString(reader["QualificationRemarks"]);

                            employeeEducationQualifications.Add(employeeEducationQualification);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEducationQualificationsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeEducationQualifications;
        }

        /// <summary>
        /// This method is used to get all contract situations of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">The Employee Id.</param>
        /// <returns>The list of employee education qualifications.</returns>
        public List<EmployeeContractSituation> GetEmployeeContractSituationsByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeContractSituation> employeeContractSituations = new List<EmployeeContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractSituationsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                            employeeContractSituation.IdEmployee = idEmployee;

                            if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);

                            if (reader["IdContractSituation"] != DBNull.Value)
                            {
                                employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);

                                employeeContractSituation.ContractSituation = new ContractSituation();
                                employeeContractSituation.ContractSituation.IdContractSituation = employeeContractSituation.IdContractSituation;
                                employeeContractSituation.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);
                            }

                            if (reader["IdProfessionalCategory"] != DBNull.Value)
                            {
                                employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                employeeContractSituation.ProfessionalCategory = new ProfessionalCategory();
                                employeeContractSituation.ProfessionalCategory.IdProfessionalCategory = employeeContractSituation.IdProfessionalCategory;
                                employeeContractSituation.ProfessionalCategory.Name = Convert.ToString(reader["ProfessionalCategory"]);
                            }

                            if (reader["ContractSituationStartDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                            if (reader["ContractSituationEndDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                            if (reader["ContractSituationFileName"] != DBNull.Value)
                                employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);

                            if (reader["ContractSituationRemarks"] != DBNull.Value)
                                employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);

                            employeeContractSituations.Add(employeeContractSituation);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeContractSituationsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContractSituations;
        }

        /// <summary>
        /// This method is used to get all family members of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">The Employee Id.</param>
        /// <returns>The list of employee family members.</returns>
        public List<EmployeeFamilyMember> GetEmployeeFamilyMembersByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeFamilyMember> employeeFamilyMembers = new List<EmployeeFamilyMember>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeFamilyMembersByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeFamilyMember employeeFamilyMember = new EmployeeFamilyMember();
                            employeeFamilyMember.IdEmployee = idEmployee;

                            if (reader["IdEmployeeFamilyMember"] != DBNull.Value)
                                employeeFamilyMember.IdEmployeeFamilyMember = Convert.ToUInt64(reader["IdEmployeeFamilyMember"]);

                            if (reader["FamilyMemberFirstName"] != DBNull.Value)
                                employeeFamilyMember.FamilyMemberFirstName = Convert.ToString(reader["FamilyMemberFirstName"]);

                            if (reader["FamilyMemberLastName"] != DBNull.Value)
                                employeeFamilyMember.FamilyMemberLastName = Convert.ToString(reader["FamilyMemberLastName"]);

                            if (reader["FamilyMemberNativeName"] != DBNull.Value)
                                employeeFamilyMember.FamilyMemberNativeName = Convert.ToString(reader["FamilyMemberNativeName"]);

                            if (reader["FamilyMemberBirthDate"] != DBNull.Value)
                                employeeFamilyMember.FamilyMemberBirthDate = Convert.ToDateTime(reader["FamilyMemberBirthDate"]);

                            if (reader["FamilyMemberIdNationality"] != DBNull.Value)
                            {
                                employeeFamilyMember.FamilyMemberIdNationality = Convert.ToUInt32(reader["FamilyMemberIdNationality"]);

                                employeeFamilyMember.FamilyMemberNationality = new Country();
                                employeeFamilyMember.FamilyMemberNationality.IdCountry = Convert.ToByte(employeeFamilyMember.FamilyMemberIdNationality);
                                employeeFamilyMember.FamilyMemberNationality.Name = Convert.ToString(reader["Nationality"]);
                            }

                            if (reader["FamilyMemberIdGender"] != DBNull.Value)
                            {
                                employeeFamilyMember.FamilyMemberIdGender = Convert.ToUInt32(reader["FamilyMemberIdGender"]);

                                employeeFamilyMember.FamilyMemberGender = new LookupValue();
                                employeeFamilyMember.FamilyMemberGender.IdLookupValue = Convert.ToInt32(employeeFamilyMember.FamilyMemberIdGender);
                                employeeFamilyMember.FamilyMemberGender.Value = Convert.ToString(reader["Gender"]);
                            }

                            if (reader["FamilyMemberIdRelationshipType"] != DBNull.Value)
                            {
                                employeeFamilyMember.FamilyMemberIdRelationshipType = Convert.ToUInt32(reader["FamilyMemberIdRelationshipType"]);

                                employeeFamilyMember.FamilyMemberRelationshipType = new LookupValue();
                                employeeFamilyMember.FamilyMemberRelationshipType.IdLookupValue = Convert.ToInt32(employeeFamilyMember.FamilyMemberIdRelationshipType);
                                employeeFamilyMember.FamilyMemberRelationshipType.Value = Convert.ToString(reader["RelationshipType"]);
                            }

                            if (reader["FamilyMemberDisability"] != DBNull.Value)
                                employeeFamilyMember.FamilyMemberDisability = Convert.ToUInt16(reader["FamilyMemberDisability"]);

                            if (reader["FamilyMemberIsDependent"] != DBNull.Value)
                                employeeFamilyMember.FamilyMemberIsDependent = Convert.ToByte(reader["FamilyMemberIsDependent"]);

                            if (reader["FamilyMemberRemarks"] != DBNull.Value)
                                employeeFamilyMember.FamilyMemberRemarks = Convert.ToString(reader["FamilyMemberRemarks"]);

                            employeeFamilyMembers.Add(employeeFamilyMember);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEmployeeFamilyMembersByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeFamilyMembers;
        }

        /// <summary>
        /// This method is used to get all job descriptions of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">The Employee Id.</param>
        /// <returns>The list of employee job descriptions.</returns>
        public List<EmployeeJobDescription> GetEmployeeJobDescriptionsByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeJobDescriptionsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeJobDescription.Company = new Company();
                                employeeJobDescription.Company.IdCompany = employeeJobDescription.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeeJobDescription.JobDescription = new JobDescription();
                                employeeJobDescription.JobDescription.IdJobDescription = employeeJobDescription.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeeJobDescription.JobDescription.Department = new Department();
                                    employeeJobDescription.JobDescription.Department.IdDepartment = employeeJobDescription.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                    if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                }
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                            if (reader["JobDescriptionStartDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["JobDescriptionStartDate"]);

                            if (reader["JobDescriptionEndDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionEndDate = Convert.ToDateTime(reader["JobDescriptionEndDate"]);

                            if (reader["JobDescriptionRemarks"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionRemarks = Convert.ToString(reader["JobDescriptionRemarks"]);

                            employeeJobDescriptions.Add(employeeJobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeJobDescriptionsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeJobDescriptions;
        }

        /// <summary>
        /// This method is used to get all change logs of employee by idemployee.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idEmployee">The Employee Id.</param>
        /// <returns>The list of employee change logs.</returns>
        public List<EmployeeChangelog> GetEmployeeChangeLogsByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeChangelog> employeeChangelogs = new List<EmployeeChangelog>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeChangelogsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeChangelog employeeChangelog = new EmployeeChangelog();
                            employeeChangelog.IdEmployee = idEmployee;

                            if (reader["IdEmployeeChangeLog"] != DBNull.Value)
                                employeeChangelog.IdEmployeeChangeLog = Convert.ToUInt64(reader["IdEmployeeChangeLog"]);

                            if (reader["ChangeLogDatetime"] != DBNull.Value)
                                employeeChangelog.ChangeLogDatetime = Convert.ToDateTime(reader["ChangeLogDatetime"]);

                            if (reader["ChangeLogIdUser"] != DBNull.Value)
                            {
                                employeeChangelog.ChangeLogIdUser = Convert.ToInt32(reader["ChangeLogIdUser"]);

                                employeeChangelog.ChangeLogUser = new User();
                                employeeChangelog.ChangeLogUser.IdUser = employeeChangelog.ChangeLogIdUser;
                                employeeChangelog.ChangeLogUser.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeChangelog.ChangeLogUser.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["ChangeLogChange"] != DBNull.Value)
                                employeeChangelog.ChangeLogChange = Convert.ToString(reader["ChangeLogChange"]);

                            employeeChangelogs.Add(employeeChangelog);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeChangeLogsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeChangelogs;
        }

        /// <summary>
        /// This method is to get employee professional eductaion details
        /// </summary>
        /// <param name="workbenchConnectionString">Get connection string of (emdep_geos database)</param>
        /// <param name="idEmployee">Get Employee Id</param>
        /// <returns>List of employee professional education</returns>
        public List<EmployeeProfessionalEducation> GetEmployeeProfessionalEducationsByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeProfessionalEducation> employeeProfessionalEducations = new List<EmployeeProfessionalEducation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeProfessionalEducationsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeProfessionalEducation employeeProfessionalEducation = new EmployeeProfessionalEducation();
                            employeeProfessionalEducation.IdEmployee = idEmployee;

                            if (reader["IdEmployeeProfessionalEducation"] != DBNull.Value)
                                employeeProfessionalEducation.IdEmployeeProfessionalEducation = Convert.ToUInt64(reader["IdEmployeeProfessionalEducation"]);

                            if (reader["IdType"] != DBNull.Value)
                            {
                                employeeProfessionalEducation.IdType = Convert.ToInt32(reader["IdType"]);

                                employeeProfessionalEducation.Type = new LookupValue();
                                employeeProfessionalEducation.Type.IdLookupValue = employeeProfessionalEducation.IdType;
                                employeeProfessionalEducation.Type.Value = Convert.ToString(reader["TypeValue"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                                employeeProfessionalEducation.Name = Convert.ToString(reader["Name"]);

                            if (reader["Entity"] != DBNull.Value)
                                employeeProfessionalEducation.Entity = Convert.ToString(reader["Entity"]);

                            if (reader["StartDate"] != DBNull.Value)
                                employeeProfessionalEducation.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeProfessionalEducation.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["DurationValue"] != DBNull.Value)
                                employeeProfessionalEducation.DurationValue = Convert.ToUInt16(reader["DurationValue"]);

                            if (reader["IdDurationUnit"] != DBNull.Value)
                            {
                                employeeProfessionalEducation.IdDurationUnit = Convert.ToInt32(reader["IdDurationUnit"]);

                                employeeProfessionalEducation.DurationUnit = new LookupValue();
                                employeeProfessionalEducation.DurationUnit.IdLookupValue = employeeProfessionalEducation.IdDurationUnit;
                                employeeProfessionalEducation.DurationUnit.Value = Convert.ToString(reader["DurationUnitValue"]);
                            }

                            if (reader["FileName"] != DBNull.Value)
                                employeeProfessionalEducation.FileName = Convert.ToString(reader["FileName"]);

                            if (reader["Remarks"] != DBNull.Value)
                                employeeProfessionalEducation.Remarks = Convert.ToString(reader["Remarks"]);

                            employeeProfessionalEducations.Add(employeeProfessionalEducation);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeChangeLogsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeProfessionalEducations;
        }

        #endregion

        #region Get all details from respective tables.

        /// <summary>
        /// This method is used to get all countries in emdep_geos db.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <returns>The List of countries.</returns>
        public List<Country> GetAllCountries(string workbenchConnectionString)
        {
            List<Country> countries = new List<Country>();

            try
            {
                using (MySqlConnection conCountry = new MySqlConnection(workbenchConnectionString))
                {
                    conCountry.Open();
                    MySqlCommand conCountrycommand = new MySqlCommand("countries_GetAllCountries", conCountry);
                    conCountrycommand.CommandType = CommandType.StoredProcedure;
                    using (MySqlDataReader countryreader = conCountrycommand.ExecuteReader())
                    {
                        while (countryreader.Read())
                        {
                            Country country = new Country();

                            if (countryreader["IdCountry"] != DBNull.Value)
                                country.IdCountry = Convert.ToByte(countryreader["IdCountry"]);

                            if (countryreader["Iso"] != DBNull.Value)
                                country.Iso = Convert.ToString(countryreader["Iso"]);

                            if (countryreader["Name"] != DBNull.Value)
                                country.Name = Convert.ToString(countryreader["Name"]);

                            if (countryreader["IdContinent"] != DBNull.Value)
                                country.IdContinent = Convert.ToInt16(countryreader["IdContinent"]);

                            countries.Add(country);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCountries(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return countries;
        }

        /// <summary>
        /// This method is used to get all education qualifications.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <returns>All education qualifications</returns>
        public List<EducationQualification> GetAllEducationQualifications(string workbenchConnectionString)
        {
            List<EducationQualification> educationQualifications = new List<EducationQualification>();

            try
            {
                using (MySqlConnection conCountry = new MySqlConnection(workbenchConnectionString))
                {
                    conCountry.Open();
                    MySqlCommand conCountrycommand = new MySqlCommand("Hrm_GetAllEducationQualifications", conCountry);
                    conCountrycommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = conCountrycommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EducationQualification educationQualification = new EducationQualification();

                            if (reader["IdEducationQualification"] != DBNull.Value)
                                educationQualification.IdEducationQualification = Convert.ToUInt32(reader["IdEducationQualification"]);

                            if (reader["Name"] != DBNull.Value)
                                educationQualification.Name = Convert.ToString(reader["Name"]);

                            if (reader["QualificationLevel"] != DBNull.Value)
                                educationQualification.QualificationLevel = Convert.ToUInt32(reader["QualificationLevel"]);

                            educationQualifications.Add(educationQualification);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEducationQualifications(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return educationQualifications;
        }

        /// <summary>
        /// This method is used to get all contract situations.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <returns>All contract situations.</returns>
        public List<ContractSituation> GetAllContractSituations(string workbenchConnectionString)
        {
            List<ContractSituation> contractSituations = new List<ContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllContractSituations", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ContractSituation contractSituation = new ContractSituation();

                            if (reader["IdContractSituation"] != DBNull.Value)
                                contractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);

                            if (reader["Name"] != DBNull.Value)
                                contractSituation.Name = Convert.ToString(reader["Name"]);

                            contractSituations.Add(contractSituation);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEducationQualifications(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contractSituations;
        }

        /// <summary>
        /// This method is used to get all professional categories.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <returns>All professional categories.</returns>
        public List<ProfessionalCategory> GetAllProfessionalCategories(string workbenchConnectionString)
        {
            List<ProfessionalCategory> professionalCategories = new List<ProfessionalCategory>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllProfessionalCategories", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ProfessionalCategory professionalCategory = new ProfessionalCategory();

                            if (reader["IdProfessionalCategory"] != DBNull.Value)
                                professionalCategory.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                            if (reader["Name"] != DBNull.Value)
                                professionalCategory.Name = Convert.ToString(reader["Name"]);

                            if (reader["IdProfessionalCategoryParent"] != DBNull.Value)
                                professionalCategory.IdProfessionalCategoryParent = Convert.ToUInt16(reader["IdProfessionalCategoryParent"]);

                            professionalCategories.Add(professionalCategory);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEducationQualifications(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return professionalCategories;
        }

        /// <summary>
        /// This method is to get list of all departments
        /// </summary>
        /// <returns>List of all departments</returns>
        public List<Department> GetAllDepartments(string workbenchConnectionString)
        {
            List<Department> departments = new List<Department>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllDepartments", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Department department = new Department();

                            if (reader["IdDepartment"] != DBNull.Value)
                                department.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                            if (reader["DepartmentName"] != DBNull.Value)
                                department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                            if (reader["IdDepartmentParent"] != DBNull.Value)
                                department.IdDepartmentParent = Convert.ToUInt32(reader["IdDepartmentParent"]);

                            if (reader["DepartmentPosition"] != DBNull.Value)
                                department.DepartmentPosition = Convert.ToString(reader["DepartmentPosition"]);

                            if (reader["DepartmentInUse"] != DBNull.Value)
                                department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);

                            if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                            if (reader["DepartmentIsIsolated"] != DBNull.Value)
                                department.DepartmentIsIsolated = Convert.ToByte(reader["DepartmentIsIsolated"]);

                            departments.Add(department);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllDepartments(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return departments;
        }

        /// <summary>
        /// This method is to get list of all job descriptions
        /// </summary>
        /// <returns>List of all job descriptions</returns>
        public List<JobDescription> GetAllJobDescriptions(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllJobDescriptions", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptions(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        #endregion

        #region Add Employee

        /// <summary>

        /// <summary>
        /// This method is used to Add employee details to main server emdep_geos db.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server workbench connection string(emdep_geos db).</param>
        /// <param name="workbenchConnectionString">The workbench connection string(emdep_geos db).</param>
        /// <param name="employee">Get Employee Details</param>
        /// <param name="employeeProfileImage">Get employee image path</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path</param>
        /// <param name="empProfessionalEducationFilesPath">Get employee professional education file path</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        /// <param name="employeeExitDocument">Get employee exit document</param>
        /// <returns>Employee details</returns>
        public Employee AddEmployee(string mainServerWorkbenchConnectionString, string workbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    string lastestEmployeeCode = "";
                    lastestEmployeeCode = GetLatestEmployeeCode(workbenchConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestEmployeeCode) && lastestEmployeeCode != employee.EmployeeCode)
                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", lastestEmployeeCode);
                        else
                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);


                        employee.IdEmployee = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (employee.IdEmployee > 0)
                    {
                        if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)   //Save employee profile image.
                            SaveEmployeeProfileImage(employeeProfileImage, employee);
                        else if (employee.IsProfileImageDeleted)                                       //Delete employee profile image.
                            DeleteEmployeeProfileImage(employeeProfileImage, employee);

                        //if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                        //    SaveEmployeeExitDocument(employeeExitDocument, employee);
                        //else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                        //    DeleteEmployeeExitDocument(employeeExitDocument, employee);

                        AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                        AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                        AddEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                        AddEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                        AddEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                        AddEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                        AddEmployeeContractSituations(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                        AddEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                        AddEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                        AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                        AddEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employee;
        }

        /// <summary>
        /// This method is used to add employee contacts details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeContacts">The list of employee contacts.</param>
        public void AddEmployeeContacts(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeContact> employeeContacts)
        {
            try
            {
                if (employeeContacts != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeContact employeeLanguage in employeeContacts)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContact_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeContactIdType", employeeLanguage.EmployeeContactIdType);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeContactValue", employeeLanguage.EmployeeContactValue);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeContactRemarks", employeeLanguage.EmployeeContactRemarks);
                            mySqlCommand.Parameters.AddWithValue("_IsCompanyUse", employeeLanguage.IsCompanyUse);

                            employeeLanguage.IdEmployeeContact = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeContacts(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is used to add employee documents details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeDocuments">Get employee document</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        public void AddEmployeeDocuments(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeDocument> employeeDocuments, string empIdentificationDocumentFilesPath)
        {
            try
            {
                if (employeeDocuments != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeDocument employeeDocument in employeeDocuments)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeDocument_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentName", employeeDocument.EmployeeDocumentName);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentIdType", employeeDocument.EmployeeDocumentIdType);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", employeeDocument.EmployeeDocumentNumber);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentIssueDate", employeeDocument.EmployeeDocumentIssueDate);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentExpiryDate", employeeDocument.EmployeeDocumentExpiryDate);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentFileName", employeeDocument.EmployeeDocumentFileName);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentRemarks", employeeDocument.EmployeeDocumentRemarks);

                            // Save a employee document file.
                            if (employeeDocument.EmployeeDocumentFileInBytes != null)
                                SaveEmployeeDocument(empIdentificationDocumentFilesPath, employee, employeeDocument);

                            employeeDocument.IdEmployeeDocument = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeDocuments(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add employee languages details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeLanguages">The list of employee languages.</param>
        public void AddEmployeeLanguages(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeLanguage> employeeLanguages)
        {
            try
            {
                if (employeeLanguages != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeLanguage employeeLanguage in employeeLanguages)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLanguage_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdLanguage", employeeLanguage.IdLanguage);
                            mySqlCommand.Parameters.AddWithValue("_UnderstandingIdLanguageLevel", employeeLanguage.UnderstandingIdLanguageLevel);
                            mySqlCommand.Parameters.AddWithValue("_SpeakingIdLanguageLevel", employeeLanguage.SpeakingIdLanguageLevel);
                            mySqlCommand.Parameters.AddWithValue("_WritingIdLanguageLevel", employeeLanguage.WritingIdLanguageLevel);
                            mySqlCommand.Parameters.AddWithValue("_LanguageRemarks", employeeLanguage.LanguageRemarks);

                            employeeLanguage.IdEmployeeLanguage = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeLanguages(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add employee education qualifications details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeEducationQualifications">The list of employee education qualifications.</param>
        public void AddEmployeeEducationQualifications(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeEducationQualification> employeeEducationQualifications, string empEducationQualificationFilesPath)
        {
            try
            {
                if (employeeEducationQualifications != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeEducationQualification employeeEducationQualification in employeeEducationQualifications)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeEducationQualification_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdEducationQualification", employeeEducationQualification.IdEducationQualification);
                            mySqlCommand.Parameters.AddWithValue("_QualificationName", employeeEducationQualification.QualificationName);
                            mySqlCommand.Parameters.AddWithValue("_QualificationEntity", employeeEducationQualification.QualificationEntity);
                            mySqlCommand.Parameters.AddWithValue("_QualificationClassification", employeeEducationQualification.QualificationClassification);
                            mySqlCommand.Parameters.AddWithValue("_QualificationStartDate", employeeEducationQualification.QualificationStartDate);
                            mySqlCommand.Parameters.AddWithValue("_QualificationEndDate", employeeEducationQualification.QualificationEndDate);
                            mySqlCommand.Parameters.AddWithValue("_QualificationFileName", employeeEducationQualification.QualificationFileName);
                            mySqlCommand.Parameters.AddWithValue("_QualificationRemarks", employeeEducationQualification.QualificationRemarks);

                            // Save a education document file.
                            if (employeeEducationQualification.QualificationFileInBytes != null)
                                SaveEmployeeEducationQualificationDocument(empEducationQualificationFilesPath, employee, employeeEducationQualification);

                            employeeEducationQualification.IdEmployeeEducationQualification = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeEducationQualifications(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add employee contract situations details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeContractSituations">Get employee contract situation</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        public void AddEmployeeContractSituations(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeContractSituation> employeeContractSituations, string empContractSituationFilesPath)
        {
            try
            {
                if (employeeContractSituations != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeContractSituation employeeContractSituation in employeeContractSituations)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdContractSituation", employeeContractSituation.IdContractSituation);
                            mySqlCommand.Parameters.AddWithValue("_IdProfessionalCategory", employeeContractSituation.IdProfessionalCategory);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationStartDate", employeeContractSituation.ContractSituationStartDate);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationEndDate", employeeContractSituation.ContractSituationEndDate);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationFileName", employeeContractSituation.ContractSituationFileName);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationRemarks", employeeContractSituation.ContractSituationRemarks);


                            // Save a contract situation document file.
                            if (employeeContractSituation.ContractSituationFileInBytes != null)
                                SaveEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeContractSituations(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add employee family members details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeFamilyMembers">The list of employee family members.</param>
        public void AddEmployeeFamilyMembers(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeFamilyMember> employeeFamilyMembers)
        {
            try
            {
                if (employeeFamilyMembers != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeFamilyMember employeeFamilyMember in employeeFamilyMembers)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeFamilyMember_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberFirstName", employeeFamilyMember.FamilyMemberFirstName);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberLastName", employeeFamilyMember.FamilyMemberLastName);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberNativeName", employeeFamilyMember.FamilyMemberNativeName);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberBirthDate", employeeFamilyMember.FamilyMemberBirthDate);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdNationality", employeeFamilyMember.FamilyMemberIdNationality);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdRelationshipType", employeeFamilyMember.FamilyMemberIdRelationshipType);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdGender", employeeFamilyMember.FamilyMemberIdGender);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberDisability", employeeFamilyMember.FamilyMemberDisability);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberIsDependent", employeeFamilyMember.FamilyMemberIsDependent);
                            mySqlCommand.Parameters.AddWithValue("_FamilyMemberRemarks", employeeFamilyMember.FamilyMemberRemarks);

                            employeeFamilyMember.IdEmployeeFamilyMember = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeFamilyMembers(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add employee job descriptions details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeJobDescriptions">The list of employee job descriptions.</param>
        public void AddEmployeeJobDescriptions(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeJobDescription> employeeJobDescriptions)
        {
            try
            {
                if (employeeJobDescriptions != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeJobDescription employeeJobDescription in employeeJobDescriptions)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                            mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);

                            employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeJobDescriptions(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add employee job descriptions details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeJobDescriptions">The list of employee job descriptions.</param>
        public void AddEmployeeJobDescriptions_V2042(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeJobDescription> employeeJobDescriptions)
        {
            try
            {
                if (employeeJobDescriptions != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeJobDescription employeeJobDescription in employeeJobDescriptions)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Insert_V2042", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                            mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);
                            mySqlCommand.Parameters.AddWithValue("_IsMainJobDescription", employeeJobDescription.IsMainJobDescription);

                            employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeJobDescriptions_V2042(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddEmployeeJobDescriptions_V2046(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeJobDescription> employeeJobDescriptions)
        {
            try
            {
                if (employeeJobDescriptions != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeJobDescription employeeJobDescription in employeeJobDescriptions)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Insert_V2046", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                            mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                            mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);
                            mySqlCommand.Parameters.AddWithValue("_IsMainJobDescription", employeeJobDescription.IsMainJobDescription);
                            mySqlCommand.Parameters.AddWithValue("_IdRegion", employeeJobDescription.IdRegion);
                            mySqlCommand.Parameters.AddWithValue("_IdCountry", employeeJobDescription.IdCountry);

                            employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeJobDescriptions_V2046(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to add employee change logs
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos database)</param>
        /// <param name="idEmployee">Get Employee Id</param>
        /// <param name="employeeChangelogs">Get employee change logs</param>
        public void AddEmployeeChangelogs(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeChangelog> employeeChangelogs)
        {
            try
            {
                if (employeeChangelogs != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeChangelog employeeChangelog in employeeChangelogs)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeChangelog_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_ChangeLogDatetime", employeeChangelog.ChangeLogDatetime);
                            mySqlCommand.Parameters.AddWithValue("_ChangeLogIdUser", employeeChangelog.ChangeLogIdUser);
                            mySqlCommand.Parameters.AddWithValue("_ChangeLogChange", employeeChangelog.ChangeLogChange);

                            employeeChangelog.IdEmployeeChangeLog = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeChangelogs(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to add employee professional education
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos database)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeProfessionalEducations">Get list employee professional education details to add</param>
        /// <param name="empProfessionalEducationFilePath">Get employee professional education file path</param>
        public void AddEmployeeProfessionalEducations(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeProfessionalEducation> employeeProfessionalEducations, string empProfessionalEducationFilePath)
        {
            try
            {
                if (employeeProfessionalEducations != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeProfessionalEducation employeeProfessionalEducation in employeeProfessionalEducations)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeProfessionalEducation_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdType", employeeProfessionalEducation.IdType);
                            mySqlCommand.Parameters.AddWithValue("_Name", employeeProfessionalEducation.Name);
                            mySqlCommand.Parameters.AddWithValue("_Entity", employeeProfessionalEducation.Entity);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", employeeProfessionalEducation.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", employeeProfessionalEducation.EndDate);
                            mySqlCommand.Parameters.AddWithValue("_DurationValue", employeeProfessionalEducation.DurationValue);
                            mySqlCommand.Parameters.AddWithValue("_IdDurationUnit", employeeProfessionalEducation.IdDurationUnit);
                            mySqlCommand.Parameters.AddWithValue("_EducationFileName", employeeProfessionalEducation.FileName);
                            mySqlCommand.Parameters.AddWithValue("_Remarks", employeeProfessionalEducation.Remarks);

                            // Save a professional education document file.
                            if (employeeProfessionalEducation.ProfessionalFileInBytes != null)
                                SaveEmployeeProfessionalEducationDocument(empProfessionalEducationFilePath, employee, employeeProfessionalEducation);

                            employeeProfessionalEducation.IdEmployeeProfessionalEducation = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeProfessionalEducations(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method to add employee annual leaves
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos database)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeAnnualLeaves">Get list of employee annual leaves to add</param>
        public void AddEmployeeAnnualLeaves(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeAnnualLeave> employeeAnnualLeaves)
        {
            try
            {
                if (employeeAnnualLeaves != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeAnnualLeave employeeAnnualLeave in employeeAnnualLeaves)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAnnualLeaves_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_Year", employeeAnnualLeave.Year);
                            mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeAnnualLeave.IdLeave);
                            mySqlCommand.Parameters.AddWithValue("_RegularHoursCount", employeeAnnualLeave.RegularHoursCount);
                            mySqlCommand.Parameters.AddWithValue("_AdditionalHoursCount", employeeAnnualLeave.AdditionalHoursCount);

                            employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeAnnualLeaves(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        #endregion

        #region Update Employee


        /// <summary>
        /// This method is used to update employee details to main server emdep_geos db.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos database)</param>
        /// <param name="employee">Get employee Id</param>
        /// <param name="employeeProfileImage">Get employee profile Image path</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path</param>
        /// <param name="empProfessionalEducationFilesPath">Get employee professional education file path</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        /// <param name="employeeExitDocument">Get employee exit document</param>
        /// <returns>True, if employee details updated else false.</returns>
        public bool UpdateEmployee(string mainServerWorkbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {
            bool isUpdatedEmployee = false;

            if (employee.IdEmployeeStatus == 136 || employee.IdEmployeeStatus == 137)
                employee.EmployeeCode = employee.EmployeeCode.Replace("D", "E");

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);
                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employee.ExitFileName);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)    //Save employee profile image.
                        SaveEmployeeProfileImage(employeeProfileImage, employee);
                    else if (employee.IsProfileImageDeleted)                                        //Delete employee profile image.
                        DeleteEmployeeProfileImage(employeeProfileImage, employee);

                    if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                        SaveEmployeeExitDocument(employeeExitDocument, employee);
                    else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                        DeleteEmployeeExitDocument(employeeExitDocument, employee);

                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                    AddUpdateDeleteEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                    AddUpdateDeleteEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                    AddUpdateDeleteEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                    AddUpdateDeleteEmployeeContractSituations(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                    AddUpdateDeleteEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                    AddUpdateDeleteEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                    AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                    AddUpdateDeleteEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                    AddUpdateDeleteEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployee(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }


        /// <summary>
        /// This method is used to add/update/delete employee contacts details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeContacts">The list of employee contacts.</param>
        public void AddUpdateDeleteEmployeeContacts(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeContact> employeeContacts)
        {
            try
            {
                if (employeeContacts != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeContact employeeContact in employeeContacts)
                        {
                            employeeContact.IdEmployee = idEmployee;

                            if (employeeContact.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContact_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeContact", employeeContact.IdEmployeeContact);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeContact.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeContact.IdEmployeeContact > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContact_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeContact", employeeContact.IdEmployeeContact);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeContactIdType", employeeContact.EmployeeContactIdType);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeContactValue", employeeContact.EmployeeContactValue);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeContactRemarks", employeeContact.EmployeeContactRemarks);
                                    mySqlCommand.Parameters.AddWithValue("_IsCompanyUse", employeeContact.IsCompanyUse);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeContact.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContact_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeContactIdType", employeeContact.EmployeeContactIdType);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeContactValue", employeeContact.EmployeeContactValue);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeContactRemarks", employeeContact.EmployeeContactRemarks);
                                mySqlCommand.Parameters.AddWithValue("_IsCompanyUse", employeeContact.IsCompanyUse);

                                employeeContact.IdEmployeeContact = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeContacts(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add/update/delete employee documents details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeDocuments">The list of employee documents.</param>
        /// 
        /// <summary>
        /// This method is used to add/update/delete employee documents details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos database)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeDocuments">Get employee document details to add/update/delete</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        public void AddUpdateDeleteEmployeeDocuments(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeDocument> employeeDocuments, string empIdentificationDocumentFilesPath)
        {
            try
            {
                if (employeeDocuments != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeDocument employeeDocument in employeeDocuments)
                        {
                            employeeDocument.IdEmployee = employee.IdEmployee;

                            if (employeeDocument.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeDocument_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeDocument", employeeDocument.IdEmployeeDocument);

                                DeleteEmployeeDocument(empIdentificationDocumentFilesPath, employee, employeeDocument);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeDocument.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeDocument.IdEmployeeDocument > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeDocument_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeDocument", employeeDocument.IdEmployeeDocument);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentName", employeeDocument.EmployeeDocumentName);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentIdType", employeeDocument.EmployeeDocumentIdType);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", employeeDocument.EmployeeDocumentNumber);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentIssueDate", employeeDocument.EmployeeDocumentIssueDate);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentExpiryDate", employeeDocument.EmployeeDocumentExpiryDate);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentFileName", employeeDocument.EmployeeDocumentFileName);
                                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentRemarks", employeeDocument.EmployeeDocumentRemarks);

                                    //Delete Old file of employee document 
                                    if (!string.IsNullOrEmpty(employeeDocument.OldFileName))
                                        DeleteEmployeeOldDocument(empIdentificationDocumentFilesPath, employee, employeeDocument);

                                    // Save a employee document file.
                                    if (employeeDocument.EmployeeDocumentFileInBytes != null)
                                        SaveEmployeeDocument(empIdentificationDocumentFilesPath, employee, employeeDocument);
                                    else if (employeeDocument.IsEmployeeDocumentFileDeleted)
                                        DeleteEmployeeDocument(empIdentificationDocumentFilesPath, employee, employeeDocument);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeDocument.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeDocument_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentName", employeeDocument.EmployeeDocumentName);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentIdType", employeeDocument.EmployeeDocumentIdType);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", employeeDocument.EmployeeDocumentNumber);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentIssueDate", employeeDocument.EmployeeDocumentIssueDate);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentExpiryDate", employeeDocument.EmployeeDocumentExpiryDate);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentFileName", employeeDocument.EmployeeDocumentFileName);
                                mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentRemarks", employeeDocument.EmployeeDocumentRemarks);

                                // Save a employee document file.
                                if (employeeDocument.EmployeeDocumentFileInBytes != null)
                                    SaveEmployeeDocument(empIdentificationDocumentFilesPath, employee, employeeDocument);

                                employeeDocument.IdEmployeeDocument = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeContacts(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add/update/delete employee languages details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeLanguages">The list of employee languages.</param>
        public void AddUpdateDeleteEmployeeLanguages(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeLanguage> employeeLanguages)
        {
            try
            {
                if (employeeLanguages != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeLanguage employeeLanguage in employeeLanguages)
                        {
                            employeeLanguage.IdEmployee = idEmployee;

                            if (employeeLanguage.TransactionOperation == ModelBase.TransactionOperations.Delete)                //if (employeeLanguage.IsDeleted)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLanguage_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeLanguage", employeeLanguage.IdEmployeeLanguage);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeLanguage.TransactionOperation == ModelBase.TransactionOperations.Update) // if (employeeLanguage.IsUpdated)
                            {
                                if (employeeLanguage.IdEmployeeLanguage > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLanguage_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeLanguage", employeeLanguage.IdEmployeeLanguage);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLanguage.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdLanguage", employeeLanguage.IdLanguage);
                                    mySqlCommand.Parameters.AddWithValue("_UnderstandingIdLanguageLevel", employeeLanguage.UnderstandingIdLanguageLevel);
                                    mySqlCommand.Parameters.AddWithValue("_SpeakingIdLanguageLevel", employeeLanguage.SpeakingIdLanguageLevel);
                                    mySqlCommand.Parameters.AddWithValue("_WritingIdLanguageLevel", employeeLanguage.WritingIdLanguageLevel);
                                    mySqlCommand.Parameters.AddWithValue("_LanguageRemarks", employeeLanguage.LanguageRemarks);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeLanguage.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLanguage_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLanguage.IdEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdLanguage", employeeLanguage.IdLanguage);
                                mySqlCommand.Parameters.AddWithValue("_UnderstandingIdLanguageLevel", employeeLanguage.UnderstandingIdLanguageLevel);
                                mySqlCommand.Parameters.AddWithValue("_SpeakingIdLanguageLevel", employeeLanguage.SpeakingIdLanguageLevel);
                                mySqlCommand.Parameters.AddWithValue("_WritingIdLanguageLevel", employeeLanguage.WritingIdLanguageLevel);
                                mySqlCommand.Parameters.AddWithValue("_LanguageRemarks", employeeLanguage.LanguageRemarks);

                                employeeLanguage.IdEmployeeLanguage = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeLanguages(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add/update/delete employee education qualifications details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeEducationQualifications">The list of employee education qualifications.</param>
        public void AddUpdateDeleteEmployeeEducationQualifications(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeEducationQualification> employeeEducationQualifications, string empEducationQualificationFilesPath)
        {
            try
            {
                if (employeeEducationQualifications != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeEducationQualification employeeEducationQualification in employeeEducationQualifications)
                        {
                            employeeEducationQualification.IdEmployee = employee.IdEmployee;

                            if (employeeEducationQualification.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeEducationQualification_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeEducationQualification", employeeEducationQualification.IdEmployeeEducationQualification);

                                DeleteEmployeeEducationQualificationDocument(empEducationQualificationFilesPath, employee, employeeEducationQualification);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeEducationQualification.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeEducationQualification.IdEmployeeEducationQualification > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeEducationQualification_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeEducationQualification", employeeEducationQualification.IdEmployeeEducationQualification);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdEducationQualification", employeeEducationQualification.IdEducationQualification);
                                    mySqlCommand.Parameters.AddWithValue("_QualificationName", employeeEducationQualification.QualificationName);
                                    mySqlCommand.Parameters.AddWithValue("_QualificationEntity", employeeEducationQualification.QualificationEntity);
                                    mySqlCommand.Parameters.AddWithValue("_QualificationClassification", employeeEducationQualification.QualificationClassification);
                                    mySqlCommand.Parameters.AddWithValue("_QualificationStartDate", employeeEducationQualification.QualificationStartDate);
                                    mySqlCommand.Parameters.AddWithValue("_QualificationEndDate", employeeEducationQualification.QualificationEndDate);
                                    mySqlCommand.Parameters.AddWithValue("_QualificationFileName", employeeEducationQualification.QualificationFileName);
                                    mySqlCommand.Parameters.AddWithValue("_QualificationRemarks", employeeEducationQualification.QualificationRemarks);

                                    //Delete Old file of education document 
                                    if (!string.IsNullOrEmpty(employeeEducationQualification.OldFileName))
                                        DeleteEmployeeEducationQualificationOldDocument(empEducationQualificationFilesPath, employee, employeeEducationQualification);

                                    // Save a education document file.
                                    if (employeeEducationQualification.QualificationFileInBytes != null)
                                        SaveEmployeeEducationQualificationDocument(empEducationQualificationFilesPath, employee, employeeEducationQualification);
                                    else if (employeeEducationQualification.IsQualificationFileDeleted)
                                        DeleteEmployeeEducationQualificationDocument(empEducationQualificationFilesPath, employee, employeeEducationQualification);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeEducationQualification.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeEducationQualification_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdEducationQualification", employeeEducationQualification.IdEducationQualification);
                                mySqlCommand.Parameters.AddWithValue("_QualificationName", employeeEducationQualification.QualificationName);
                                mySqlCommand.Parameters.AddWithValue("_QualificationEntity", employeeEducationQualification.QualificationEntity);
                                mySqlCommand.Parameters.AddWithValue("_QualificationClassification", employeeEducationQualification.QualificationClassification);
                                mySqlCommand.Parameters.AddWithValue("_QualificationStartDate", employeeEducationQualification.QualificationStartDate);
                                mySqlCommand.Parameters.AddWithValue("_QualificationEndDate", employeeEducationQualification.QualificationEndDate);
                                mySqlCommand.Parameters.AddWithValue("_QualificationFileName", employeeEducationQualification.QualificationFileName);
                                mySqlCommand.Parameters.AddWithValue("_QualificationRemarks", employeeEducationQualification.QualificationRemarks);

                                // Save a education document file.
                                if (employeeEducationQualification.QualificationFileInBytes != null)
                                    SaveEmployeeEducationQualificationDocument(empEducationQualificationFilesPath, employee, employeeEducationQualification);

                                employeeEducationQualification.IdEmployeeEducationQualification = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeLanguages(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add/update/delete employee contract situations details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeContractSituations">The list of employee contract situations.</param>
        public void AddUpdateDeleteEmployeeContractSituations(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeContractSituation> employeeContractSituations, string empContractSituationFilesPath)
        {
            try
            {
                if (employeeContractSituations != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeContractSituation employeeContractSituation in employeeContractSituations)
                        {
                            employeeContractSituation.IdEmployee = employee.IdEmployee;

                            if (employeeContractSituation.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeContractSituation", employeeContractSituation.IdEmployeeContractSituation);

                                DeleteEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeContractSituation.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeContractSituation.IdEmployeeContractSituation > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeContractSituation", employeeContractSituation.IdEmployeeContractSituation);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdContractSituation", employeeContractSituation.IdContractSituation);
                                    mySqlCommand.Parameters.AddWithValue("_IdProfessionalCategory", employeeContractSituation.IdProfessionalCategory);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationStartDate", employeeContractSituation.ContractSituationStartDate);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationEndDate", employeeContractSituation.ContractSituationEndDate);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationFileName", employeeContractSituation.ContractSituationFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationRemarks", employeeContractSituation.ContractSituationRemarks);

                                    //Delete Old file of contract situation document 
                                    if (!string.IsNullOrEmpty(employeeContractSituation.OldFileName))
                                        DeleteEmployeeContractSituationOldDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                    // Save a contract situation document file.
                                    if (employeeContractSituation.ContractSituationFileInBytes != null)
                                        SaveEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);
                                    else if (employeeContractSituation.IsContractSituationFileDeleted)
                                        DeleteEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeContractSituation.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdContractSituation", employeeContractSituation.IdContractSituation);
                                mySqlCommand.Parameters.AddWithValue("_IdProfessionalCategory", employeeContractSituation.IdProfessionalCategory);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationStartDate", employeeContractSituation.ContractSituationStartDate);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationEndDate", employeeContractSituation.ContractSituationEndDate);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationFileName", employeeContractSituation.ContractSituationFileName);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationRemarks", employeeContractSituation.ContractSituationRemarks);


                                // Save a contract Situation document file.
                                if (employeeContractSituation.ContractSituationFileInBytes != null)
                                    SaveEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeContractSituations(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add/update/delete employee family members details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeFamilyMembers">The list of employee family members.</param>
        public void AddUpdateDeleteEmployeeFamilyMembers(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeFamilyMember> employeeFamilyMembers)
        {
            try
            {
                if (employeeFamilyMembers != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeFamilyMember employeeFamilyMember in employeeFamilyMembers)
                        {
                            employeeFamilyMember.IdEmployee = idEmployee;

                            if (employeeFamilyMember.TransactionOperation == ModelBase.TransactionOperations.Delete)                //if (employeeLanguage.IsDeleted)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeFamilyMember_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeFamilyMember", employeeFamilyMember.IdEmployeeFamilyMember);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeFamilyMember.TransactionOperation == ModelBase.TransactionOperations.Update) // if (employeeLanguage.IsUpdated)
                            {
                                if (employeeFamilyMember.IdEmployeeFamilyMember > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeFamilyMember_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeFamilyMember", employeeFamilyMember.IdEmployeeFamilyMember);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberFirstName", employeeFamilyMember.FamilyMemberFirstName);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberLastName", employeeFamilyMember.FamilyMemberLastName);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberNativeName", employeeFamilyMember.FamilyMemberNativeName);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberBirthDate", employeeFamilyMember.FamilyMemberBirthDate);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdNationality", employeeFamilyMember.FamilyMemberIdNationality);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdRelationshipType", employeeFamilyMember.FamilyMemberIdRelationshipType);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdGender", employeeFamilyMember.FamilyMemberIdGender);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberDisability", employeeFamilyMember.FamilyMemberDisability);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberIsDependent", employeeFamilyMember.FamilyMemberIsDependent);
                                    mySqlCommand.Parameters.AddWithValue("_FamilyMemberRemarks", employeeFamilyMember.FamilyMemberRemarks);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeFamilyMember.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeFamilyMember_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberFirstName", employeeFamilyMember.FamilyMemberFirstName);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberLastName", employeeFamilyMember.FamilyMemberLastName);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberNativeName", employeeFamilyMember.FamilyMemberNativeName);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberBirthDate", employeeFamilyMember.FamilyMemberBirthDate);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdNationality", employeeFamilyMember.FamilyMemberIdNationality);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdRelationshipType", employeeFamilyMember.FamilyMemberIdRelationshipType);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberIdGender", employeeFamilyMember.FamilyMemberIdGender);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberDisability", employeeFamilyMember.FamilyMemberDisability);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberIsDependent", employeeFamilyMember.FamilyMemberIsDependent);
                                mySqlCommand.Parameters.AddWithValue("_FamilyMemberRemarks", employeeFamilyMember.FamilyMemberRemarks);

                                employeeFamilyMember.IdEmployeeFamilyMember = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeFamilyMembers(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add/update/delete employee job descriptions details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeJobDescriptions">The list of employee job descriptions.</param>
        public void AddUpdateDeleteEmployeeJobDescriptions(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeJobDescription> employeeJobDescriptions)
        {
            try
            {
                if (employeeJobDescriptions != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeJobDescription employeeJobDescription in employeeJobDescriptions)
                        {
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeJobDescription", employeeJobDescription.IdEmployeeJobDescription);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeJobDescription.IdEmployeeJobDescription > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeJobDescription", employeeJobDescription.IdEmployeeJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                                    mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                                mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);

                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeJobDescriptions(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to add/update/delete employee job descriptions details.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The main server emdep_geos db.</param>
        /// <param name="idEmployee">The idEmployee.</param>
        /// <param name="employeeJobDescriptions">The list of employee job descriptions.</param>
        public void AddUpdateDeleteEmployeeJobDescriptions_V2042(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeJobDescription> employeeJobDescriptions)
        {
            try
            {
                if (employeeJobDescriptions != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeJobDescription employeeJobDescription in employeeJobDescriptions)
                        {
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeJobDescription", employeeJobDescription.IdEmployeeJobDescription);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeJobDescription.IdEmployeeJobDescription > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Update_V2042", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeJobDescription", employeeJobDescription.IdEmployeeJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                                    mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);
                                    mySqlCommand.Parameters.AddWithValue("_IsMainJobDescription", employeeJobDescription.IsMainJobDescription);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Insert_V2042", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                                mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);
                                mySqlCommand.Parameters.AddWithValue("_IsMainJobDescription", employeeJobDescription.IsMainJobDescription);

                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeJobDescriptions_V2042(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public void AddUpdateDeleteEmployeeJobDescriptions_V2046(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeJobDescription> employeeJobDescriptions)
        {
            try
            {
                if (employeeJobDescriptions != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeJobDescription employeeJobDescription in employeeJobDescriptions)
                        {
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeJobDescription", employeeJobDescription.IdEmployeeJobDescription);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeJobDescription.IdEmployeeJobDescription > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Update_V2046", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeJobDescription", employeeJobDescription.IdEmployeeJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                                    mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                                    mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);
                                    mySqlCommand.Parameters.AddWithValue("_IsMainJobDescription", employeeJobDescription.IsMainJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_IdRegion", employeeJobDescription.IdRegion);
                                    mySqlCommand.Parameters.AddWithValue("_IdCountry", employeeJobDescription.IdCountry);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeJobDescription.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeJobDescription_Insert_V2046", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeJobDescription.IdCompany);
                                mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeeJobDescription.IdJobDescription);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionUsage", employeeJobDescription.JobDescriptionUsage);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionStartDate", employeeJobDescription.JobDescriptionStartDate);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionEndDate", employeeJobDescription.JobDescriptionEndDate);
                                mySqlCommand.Parameters.AddWithValue("_JobDescriptionRemarks", employeeJobDescription.JobDescriptionRemarks);
                                mySqlCommand.Parameters.AddWithValue("_IsMainJobDescription", employeeJobDescription.IsMainJobDescription);
                                mySqlCommand.Parameters.AddWithValue("_IdRegion", employeeJobDescription.IdRegion);
                                mySqlCommand.Parameters.AddWithValue("_IdCountry", employeeJobDescription.IdCountry);

                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeJobDescriptions_V2046(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to add/update/delete employee professional education
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos database)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeProfessionalEducations">Get employee professional education details to add/update/delete</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path details</param>

        public void AddUpdateDeleteEmployeeProfessionalEducations(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeProfessionalEducation> employeeProfessionalEducations, string empEducationQualificationFilesPath)
        {
            try
            {
                if (employeeProfessionalEducations != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeProfessionalEducation employeeProfessionalEducation in employeeProfessionalEducations)
                        {
                            employeeProfessionalEducation.IdEmployee = employee.IdEmployee;

                            if (employeeProfessionalEducation.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeProfessionalEducation_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeProfessionalEducation", employeeProfessionalEducation.IdEmployeeProfessionalEducation);

                                DeleteEmployeeProfessionalEducationDocument(empEducationQualificationFilesPath, employee, employeeProfessionalEducation);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeProfessionalEducation.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeProfessionalEducation.IdEmployeeProfessionalEducation > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeProfessionalEducation_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeProfessionalEducation", employeeProfessionalEducation.IdEmployeeProfessionalEducation);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeProfessionalEducation.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdType", employeeProfessionalEducation.IdType);
                                    mySqlCommand.Parameters.AddWithValue("_Name", employeeProfessionalEducation.Name);
                                    mySqlCommand.Parameters.AddWithValue("_Entity", employeeProfessionalEducation.Entity);
                                    mySqlCommand.Parameters.AddWithValue("_StartDate", employeeProfessionalEducation.StartDate);
                                    mySqlCommand.Parameters.AddWithValue("_EndDate", employeeProfessionalEducation.EndDate);
                                    mySqlCommand.Parameters.AddWithValue("_DurationValue", employeeProfessionalEducation.DurationValue);
                                    mySqlCommand.Parameters.AddWithValue("_IdDurationUnit", employeeProfessionalEducation.IdDurationUnit);
                                    mySqlCommand.Parameters.AddWithValue("_EducationFileName", employeeProfessionalEducation.FileName);
                                    mySqlCommand.Parameters.AddWithValue("_Remarks", employeeProfessionalEducation.Remarks);


                                    //Delete Old file of professional education document 
                                    if (!string.IsNullOrEmpty(employeeProfessionalEducation.OldFileName))
                                        DeleteEmployeeProfessionalEducationOldDocument(empEducationQualificationFilesPath, employee, employeeProfessionalEducation);

                                    // Save a professional education document file.
                                    if (employeeProfessionalEducation.ProfessionalFileInBytes != null)
                                        SaveEmployeeProfessionalEducationDocument(empEducationQualificationFilesPath, employee, employeeProfessionalEducation);
                                    else if (employeeProfessionalEducation.IsProfessionalFileDeleted)
                                        DeleteEmployeeProfessionalEducationDocument(empEducationQualificationFilesPath, employee, employeeProfessionalEducation);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeProfessionalEducation.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeProfessionalEducation_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeProfessionalEducation.IdEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdType", employeeProfessionalEducation.IdType);
                                mySqlCommand.Parameters.AddWithValue("_Name", employeeProfessionalEducation.Name);
                                mySqlCommand.Parameters.AddWithValue("_Entity", employeeProfessionalEducation.Entity);
                                mySqlCommand.Parameters.AddWithValue("_StartDate", employeeProfessionalEducation.StartDate);
                                mySqlCommand.Parameters.AddWithValue("_EndDate", employeeProfessionalEducation.EndDate);
                                mySqlCommand.Parameters.AddWithValue("_DurationValue", employeeProfessionalEducation.DurationValue);
                                mySqlCommand.Parameters.AddWithValue("_IdDurationUnit", employeeProfessionalEducation.IdDurationUnit);
                                mySqlCommand.Parameters.AddWithValue("_EducationFileName", employeeProfessionalEducation.FileName);
                                mySqlCommand.Parameters.AddWithValue("_Remarks", employeeProfessionalEducation.Remarks);

                                // Save a professional education document file.
                                if (employeeProfessionalEducation.ProfessionalFileInBytes != null)
                                    SaveEmployeeProfessionalEducationDocument(empEducationQualificationFilesPath, employee, employeeProfessionalEducation);

                                employeeProfessionalEducation.IdEmployeeProfessionalEducation = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeLanguages(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is to add/update/delete employee annual leaves
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos database)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeAnnualLeaves">Get list of employee annual leaves details to add/update/delete</param>
        public void AddUpdateDeleteEmployeeAnnualLeaves(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeAnnualLeave> employeeAnnualLeaves)
        {
            try
            {
                if (employeeAnnualLeaves != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeAnnualLeave employeeAnnualLeave in employeeAnnualLeaves)
                        {
                            employeeAnnualLeave.IdEmployee = employee.IdEmployee;

                            if (employeeAnnualLeave.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAnnualLeaves_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeAnnualLeave", employeeAnnualLeave.IdEmployeeAnnualLeave);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeAnnualLeave.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeAnnualLeave.IdEmployeeAnnualLeave > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAnnualLeaves_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeAnnualLeave", employeeAnnualLeave.IdEmployeeAnnualLeave);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeAnnualLeave.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_Year", employeeAnnualLeave.Year);
                                    mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeAnnualLeave.IdLeave);
                                    mySqlCommand.Parameters.AddWithValue("_RegularHoursCount", employeeAnnualLeave.RegularHoursCount);
                                    mySqlCommand.Parameters.AddWithValue("_AdditionalHoursCount", employeeAnnualLeave.AdditionalHoursCount);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeAnnualLeave.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAnnualLeaves_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeAnnualLeave.IdEmployee);
                                mySqlCommand.Parameters.AddWithValue("_Year", employeeAnnualLeave.Year);
                                mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeAnnualLeave.IdLeave);
                                mySqlCommand.Parameters.AddWithValue("_RegularHoursCount", employeeAnnualLeave.RegularHoursCount);
                                mySqlCommand.Parameters.AddWithValue("_AdditionalHoursCount", employeeAnnualLeave.AdditionalHoursCount);

                                employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeAnnualLeaves(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        #endregion

        /// <summary>
        /// This method is to get latest employee code
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string(emdp_geos db.)</param>
        /// <returns>latest employee code</returns>
        public string GetLatestEmployeeCode(string workbenchConnectionString)
        {
            Int32 IdEmployee;
            string EmployeeCode;
            Char Code;
            Int16 Year = 0;
            Int16 Number = 0;

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetLatestEmployeeCode", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["IdEmployee"] != DBNull.Value)
                                IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["Code"] != DBNull.Value)
                                Code = Convert.ToChar(reader["Code"]);

                            if (reader["Year"] != DBNull.Value)
                                Year = Convert.ToInt16(reader["Year"]);

                            if (reader["Number"] != DBNull.Value)
                                Number = Convert.ToInt16(reader["Number"]);
                        }
                    }
                }

                Int16 currentYear = Convert.ToInt16(DateTime.Now.ToString("yy"));

                if (Year == currentYear)
                {
                    Number += 1;
                    //if(idEmployeeStatus==138)
                    //    return string.Format("{0}{1}{2}", "D", currentYear, Number.ToString("000"));
                    //else
                    return string.Format("{0}{1}{2}", "E", currentYear, Number.ToString("000"));
                }
                else if (currentYear > Year)
                {
                    //if (idEmployeeStatus== 138)
                    //    return string.Format("{0}{1}{2}", "D", currentYear, 1.ToString("000"));
                    //else
                    return string.Format("{0}{1}{2}", "E", currentYear, 1.ToString("000"));
                }
                else
                {
                    //if (idEmployeeStatus == 138)
                    //    return string.Format("{0}{1}{2}", "D", currentYear, 1.ToString("000"));
                    //else
                    return string.Format("{0}{1}{2}", "E", currentYear, 1.ToString("000"));
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestEmployeeCode(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to add employee image in folder
        /// </summary>
        /// <param name="employeesProfileImage">Get employee image path</param>
        /// <param name="employee">Get employee details</param>
        /// <returns>true if saved / false if not</returns>
        public bool SaveEmployeeProfileImage(string employeesProfileImage, Employee employee)
        {
            if (employee.ProfileImageInBytes != null)
            {
                try
                {
                    if (!Directory.Exists(employeesProfileImage))
                    {
                        Directory.CreateDirectory(employeesProfileImage);
                    }

                    string imagePath = employeesProfileImage + "\\" + employee.EmployeeCode + ".png";

                    File.WriteAllBytes(imagePath, employee.ProfileImageInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeProfileImage()-Code - {0}. ErrorMessage- {1}", employee.EmployeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is to delete employee image
        /// </summary>
        /// <param name="employeesProfileImage">Get employee image path</param>
        /// <param name="employee">Get employee details</param>
        /// <returns>It true employee image deleted or false</returns>
        public bool DeleteEmployeeProfileImage(string employeesProfileImage, Employee employee)
        {
            try
            {
                if (!Directory.Exists(employeesProfileImage))
                {
                    return false;
                }
                else
                {
                    string imagePath = employeesProfileImage + "\\" + employee.EmployeeCode + ".png";
                    if (File.Exists(imagePath))
                    {
                        File.Delete(imagePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeProfileImage()-Code - {0}. ErrorMessage- {1}", employee.EmployeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to save employee education qualification document
        /// </summary>
        /// <param name="employeeEducationQualificationFilePath">Get employee education qualification file path </param>
        /// <param name="employee">Get employee</param>
        /// <param name="employeeEducationQualification">Get employee education qualification</param>
        /// <returns>If true the save employee education qualification document otherwise false.</returns>
        public bool SaveEmployeeEducationQualificationDocument(string employeeEducationQualificationFilePath, Employee employee, EmployeeEducationQualification employeeEducationQualification)
        {
            if (employeeEducationQualification.QualificationFileInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", employeeEducationQualificationFilePath, employee.EmployeeCode);

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }

                    string filePath = completePath + "\\" + employeeEducationQualification.QualificationFileName;
                    File.WriteAllBytes(filePath, employeeEducationQualification.QualificationFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeEducationQualificationDocument()-Filename - {0}. ErrorMessage- {1}", employeeEducationQualification.QualificationFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is to delete employee education qualification document
        /// </summary>
        /// <param name="employeeEducationQualificationFilePath">Get employee education qualification file path</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeEducationQualification">Get employee education qualification</param>
        /// <returns>If true deleted employeee education qualification document other wise false</returns>
        public bool DeleteEmployeeEducationQualificationDocument(string employeeEducationQualificationFilePath, Employee employee, EmployeeEducationQualification employeeEducationQualification)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeEducationQualificationFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))      //(!Directory.Exists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeEducationQualification.QualificationFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeEducationQualificationDocument()-Filename - {0}. ErrorMessage- {1}", employeeEducationQualification.QualificationFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is use to delete old employee education qualification document
        /// </summary>
        /// <param name="employeeEducationQualificationFilePath">Get employee education qualification file path</param>
        /// <param name="employee">Get employee</param>
        /// <param name="employeeEducationQualification">Get employee education qualification</param>
        /// <returns>if true when deleted employee education qualification otherwise false </returns>
        public bool DeleteEmployeeEducationQualificationOldDocument(string employeeEducationQualificationFilePath, Employee employee, EmployeeEducationQualification employeeEducationQualification)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeEducationQualificationFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeEducationQualification.OldFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeEducationQualificationOldDocument()-Filename - {0}. ErrorMessage- {1}", employeeEducationQualification.OldFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }


        /// <summary>
        /// This method is to save employee document
        /// </summary>
        /// <param name="employeeDocumentFilePath">Get employee document file path</param>
        /// <param name="employee">Get employee detail</param>
        /// <param name="employeeDocument">Get employee document to save employee document</param>
        /// <returns>If true save employee document otherwise false</returns>
        public bool SaveEmployeeDocument(string employeeDocumentFilePath, Employee employee, EmployeeDocument employeeDocument)
        {
            if (employeeDocument.EmployeeDocumentFileInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", employeeDocumentFilePath, employee.EmployeeCode);

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }

                    string filePath = completePath + "\\" + employeeDocument.EmployeeDocumentFileName;
                    File.WriteAllBytes(filePath, employeeDocument.EmployeeDocumentFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeDocument()-Filename - {0}. ErrorMessage- {1}", employeeDocument.EmployeeDocumentFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }


        /// <summary>
        /// This method is to delete employee document
        /// </summary>
        /// <param name="employeeDocumentFilePath">Get employee file path</param>
        /// <param name="employee">Get employee detail</param>
        /// <param name="employeeDocument">Get employee document</param>
        /// <returns></returns>
        public bool DeleteEmployeeDocument(string employeeDocumentFilePath, Employee employee, EmployeeDocument employeeDocument)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeDocumentFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeDocument.EmployeeDocumentFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeDocument()-Filename - {0}. ErrorMessage- {1}", employeeDocument.EmployeeDocumentFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to delete employee document
        /// </summary>
        /// <param name="employeeDocumentFilePath">Get employee file path</param>
        /// <param name="employee">Get employee detail</param>
        /// <param name="employeeDocument">Get employee document</param>
        /// <returns>If true when deleted employee old document otherwise false</returns>
        public bool DeleteEmployeeOldDocument(string employeeDocumentFilePath, Employee employee, EmployeeDocument employeeDocument)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeDocumentFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))  // (!Directory.Exists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeDocument.OldFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeOldDocument()-Filename - {0}. ErrorMessage- {1}", employeeDocument.OldFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to save employee contract situtaion document
        /// </summary>
        /// <param name="employeeContractSituationFilePath">Get employee contract situtation file path</param>
        /// <param name="employee">Get employee detail</param>
        /// <param name="employeeContractSituation">Get employee contract situation</param>
        /// <returns>If true saved employee contract situation document otherwise false</returns>
        public bool SaveEmployeeContractSituationDocument(string employeeContractSituationFilePath, Employee employee, EmployeeContractSituation employeeContractSituation)
        {
            if (employeeContractSituation.ContractSituationFileInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", employeeContractSituationFilePath, employee.EmployeeCode);

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }

                    string filePath = completePath + "\\" + employeeContractSituation.ContractSituationFileName;
                    File.WriteAllBytes(filePath, employeeContractSituation.ContractSituationFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeContractSituationDocument()-Filename - {0}. ErrorMessage- {1}", employeeContractSituation.ContractSituationFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is to delete employee contract situation document
        /// </summary>
        /// <param name="employeeContractSituationFilePath">Get employee contract situation file path</param>
        /// <param name="employee">Get employee</param>
        /// <param name="employeeContractSituation">Get employee contract situation</param>
        /// <returns>If true deleted employee contract situation document otherwise false</returns>
        public bool DeleteEmployeeContractSituationDocument(string employeeContractSituationFilePath, Employee employee, EmployeeContractSituation employeeContractSituation)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeContractSituationFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeContractSituation.ContractSituationFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeContractSituationDocument()-Filename - {0}. ErrorMessage- {1}", employeeContractSituation.ContractSituationFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to delete old employee contract situation document
        /// </summary>
        /// <param name="employeeContractSituationFilePath">Get employee contract situation file path</param>
        /// <param name="employee">Get employee</param>
        /// <param name="employeeContractSituation">Get employee contract situation</param>
        /// <returns>If true deleted old employee contract situation document</returns>
        public bool DeleteEmployeeContractSituationOldDocument(string employeeContractSituationFilePath, Employee employee, EmployeeContractSituation employeeContractSituation)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeContractSituationFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeContractSituation.OldFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeContractSituationOldDocument()-Filename - {0}. ErrorMessage- {1}", employeeContractSituation.OldFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to save employee professional education document
        /// </summary>
        /// <param name="employeeProfessionalEducationFilePath">Get employee professional education file path</param>
        /// <param name="employee">Get employee</param>
        /// <param name="employeeProfessionalEducation">Get employee professional education</param>
        /// <returns>If true saved employee professional education document otherwise false</returns>
        public bool SaveEmployeeProfessionalEducationDocument(string employeeProfessionalEducationFilePath, Employee employee, EmployeeProfessionalEducation employeeProfessionalEducation)
        {
            if (employeeProfessionalEducation.ProfessionalFileInBytes != null)
            {
                try
                {
                    string completePath = string.Format(@"{0}\{1}", employeeProfessionalEducationFilePath, employee.EmployeeCode);

                    if (!Directory.Exists(completePath))
                    {
                        Directory.CreateDirectory(completePath);
                    }

                    string filePath = completePath + "\\" + employeeProfessionalEducation.FileName;
                    File.WriteAllBytes(filePath, employeeProfessionalEducation.ProfessionalFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeProfessionalEducationDocument()-Filename - {0}. ErrorMessage- {1}", employeeProfessionalEducation.FileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is use to delete employee professional education document
        /// </summary>
        /// <param name="employeeProfessionalEducationFilePath">Get employee professional education file path</param>
        /// <param name="employee">Get employee</param>
        /// <param name="employeeProfessionalEducation">Get employee professional education</param>
        /// <returns>If true deleted employee professional education document otherwise false</returns>
        public bool DeleteEmployeeProfessionalEducationDocument(string employeeProfessionalEducationFilePath, Employee employee, EmployeeProfessionalEducation employeeProfessionalEducation)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeProfessionalEducationFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeProfessionalEducation.FileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeProfessionalEducationDocument()-Filename - {0}. ErrorMessage- {1}", employeeProfessionalEducation.FileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to use delete old employee professional education document.
        /// </summary>
        /// <param name="employeeProfessionalEducationFilePath">Get employee professional education file path</param>
        /// <param name="employee">Get employee</param>
        /// <param name="employeeProfessionalEducation">Get employee professional education</param>
        /// <returns>If true deleted old employee professional education document otherwise false</returns>
        public bool DeleteEmployeeProfessionalEducationOldDocument(string employeeProfessionalEducationFilePath, Employee employee, EmployeeProfessionalEducation employeeProfessionalEducation)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeProfessionalEducationFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))  // (!Directory.Exists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeProfessionalEducation.OldFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeProfessionalEducationOldDocument()-Filename - {0}. ErrorMessage- {1}", employeeProfessionalEducation.OldFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to get all country regions
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <returns>List of country regions</returns>
        public List<CountryRegion> GetAllCountryRegions(string workbenchConnectionString)
        {
            List<CountryRegion> countryRegions = new List<CountryRegion>();

            try
            {
                using (MySqlConnection conCountry = new MySqlConnection(workbenchConnectionString))
                {
                    conCountry.Open();
                    MySqlCommand conCountrycommand = new MySqlCommand("country_regions_GetAllCountryRegions", conCountry);
                    conCountrycommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = conCountrycommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CountryRegion countryRegion = new CountryRegion();

                            if (reader["IdCountryRegion"] != DBNull.Value)
                                countryRegion.IdCountryRegion = Convert.ToUInt64(reader["IdCountryRegion"]);

                            if (reader["Name"] != DBNull.Value)
                                countryRegion.Name = Convert.ToString(reader["Name"]);

                            if (reader["IdCountry"] != DBNull.Value)
                                countryRegion.IdCountry = Convert.ToUInt16(reader["IdCountry"]);

                            countryRegions.Add(countryRegion);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCountryRegions(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return countryRegions;
        }

        /// <summary>
        /// This method is to get employee education document file
        /// </summary>
        /// <param name="employeeCode">Get employee code</param>
        /// <param name="employeeEducationQualification">Get employee education qualification</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path </param>
        /// <returns>Get employee education qualification details</returns>
        public EmployeeEducationQualification GetEmployeeEducationDocumentFile(String employeeCode, EmployeeEducationQualification employeeEducationQualification, string empEducationQualificationFilesPath)
        {
            if (!string.IsNullOrEmpty(employeeCode) && employeeEducationQualification != null)
            {
                byte[] bytes = null;

                string fileUploadPath = string.Format(@"{0}\{1}\{2}", empEducationQualificationFilesPath, employeeCode, employeeEducationQualification.QualificationFileName);

                try
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }

                    employeeEducationQualification.QualificationFileInBytes = bytes;
                }
                catch (FileNotFoundException ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEducationDocumentFile() EmployeeCode-{0}. File-{1} ErrorMessage- {2}", employeeCode, employeeEducationQualification.QualificationFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
                catch (DirectoryNotFoundException ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEducationDocumentFile() EmployeeCode-{0}. File-{1} ErrorMessage- {2}", employeeCode, employeeEducationQualification.QualificationFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEducationDocumentFile() EmployeeCode-{0}. File-{1} ErrorMessage- {2}", employeeCode, employeeEducationQualification.QualificationFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return employeeEducationQualification;
        }

        /// <summary>
        /// This is common method is used to get respective file from respective filepath in bytes array.
        /// </summary>
        /// <param name="employeeCode">The employee code.</param>
        /// <param name="employeeSubObject">The object of type where file is present</param>
        /// <param name="empEducationQualificationFilesPath">The employee Education Qualification Files Path</param>
        /// <param name="empProfessionalEducationFilesPath">The employee ProfessionalEducationFilesPath</param>
        /// <param name="empContractSituationFilesPath">The employee ContractSituationFilesPath</param>
        /// <param name="empIdentificationDocumentFilesPath">The employee IdentificationDocumentFilesPath</param>
        /// <param name="empJobDescriptionsFilesPath">The employee JobDescriptionsFilesPath</param>
        /// <returns>The file in bytes array.</returns>
        public byte[] GetEmployeeDocumentFile(String employeeCode, object employeeSubObject, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string empJobDescriptionsFilesPath)
        {
            string fileUploadPath = string.Empty;

            if (employeeSubObject is EmployeeEducationQualification)
            {
                fileUploadPath = string.Format(@"{0}\{1}\{2}", empEducationQualificationFilesPath, employeeCode, ((EmployeeEducationQualification)employeeSubObject).QualificationFileName);
            }
            else if (employeeSubObject is EmployeeProfessionalEducation)
            {
                fileUploadPath = string.Format(@"{0}\{1}\{2}", empProfessionalEducationFilesPath, employeeCode, ((EmployeeProfessionalEducation)employeeSubObject).FileName);
            }
            else if (employeeSubObject is EmployeeContractSituation)
            {
                fileUploadPath = string.Format(@"{0}\{1}\{2}", empContractSituationFilesPath, employeeCode, ((EmployeeContractSituation)employeeSubObject).ContractSituationFileName);
            }
            else if (employeeSubObject is EmployeeDocument)
            {
                fileUploadPath = string.Format(@"{0}\{1}\{2}", empIdentificationDocumentFilesPath, employeeCode, ((EmployeeDocument)employeeSubObject).EmployeeDocumentFileName);
            }
            else if (employeeSubObject is JobDescription)
            {
                fileUploadPath = string.Format(@"{0}\{1}.pdf", empJobDescriptionsFilesPath, ((JobDescription)employeeSubObject).JobDescriptionCode);
            }

            byte[] bytes = null;

            try
            {
                using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                {
                    bytes = new byte[stream.Length];
                    int numBytesToRead = (int)stream.Length;
                    int numBytesRead = 0;

                    while (numBytesToRead > 0)
                    {
                        // Read may return anything from 0 to numBytesToRead.
                        int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                        // Break when the end of the file is reached.
                        if (n == 0)
                            break;

                        numBytesRead += n;
                        numBytesToRead -= n;
                    }
                }

                return bytes;
            }
            catch (FileNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDocumentFile() EmployeeCode-{0}. ErrorMessage- {2}", employeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (DirectoryNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDocumentFile() EmployeeCode-{0}. ErrorMessage- {2}", employeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDocumentFile() EmployeeCode-{0}. ErrorMessage- {2}", employeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return null;
        }

        /// <summary>
        /// This method is to get all employees for organization
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <returns>List of departments</returns>
        public List<Department> GetAllEmployeesForOrganization(string workbenchConnectionString, string employeesProfileImagePath)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForOrganization", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(reader["NativeName"]);

                            if (reader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            if (reader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);

                            if (reader["SkypeValue"] != DBNull.Value)
                                employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                            if (reader["emailValue"] != DBNull.Value)
                                employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                            if (reader["homePhoneValue"] != DBNull.Value)
                                employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                            if (reader["mobilePhoneValue"] != DBNull.Value)
                                employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                empJobDescription.JobDescription = new JobDescription();

                                empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                    empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                    empJobDescription.JobDescription.Department = new Department();
                                    empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                }

                                if (reader["HireDate"] != DBNull.Value)
                                {
                                    empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    TimeSpan span = DateTime.Now - Convert.ToDateTime(reader["HireDate"]);
                                    // because we start at year 1 for the Gregorian calendar, we must subtract a year here.
                                    if (Convert.ToDateTime(reader["HireDate"]) > DateTime.Now)
                                    {
                                        employee.LengthOfService = 0;
                                    }
                                    else
                                    {
                                        // because we start at year 1 for the Gregorian calendar, we must subtract a year here.
                                        employee.LengthOfService = (zeroTime + span).Year - 1;
                                    }
                                }

                                employee.EmployeeJobDescription = empJobDescription;
                            }

                            if (reader["IdContractSituation"] != DBNull.Value)
                            {
                                employee.ContractSituation = new ContractSituation();
                                employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);


                                if (reader["HireDate"] != DBNull.Value)
                                {
                                    employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    TimeSpan span = DateTime.Now - Convert.ToDateTime(reader["HireDate"]);

                                    if (Convert.ToDateTime(reader["HireDate"]) > DateTime.Now)
                                    {
                                        employee.LengthOfService = 0;
                                    }
                                    else
                                    {
                                        // because we start at year 1 for the Gregorian calendar, we must subtract a year here.
                                        employee.LengthOfService = (zeroTime + span).Year - 1;
                                    }
                                }
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganization(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);

            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.ToList());
            }

            return departments;
        }

        /// <summary>
        /// This method is to get company holidays related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get id company to get related company holidays</param>
        /// <returns>List of company holiday related to id company</returns>
        public List<CompanyHoliday> GetCompanyHolidaysByIdCompany(string workbenchConnectionString, Int32 idCompany)
        {
            List<CompanyHoliday> companyHolidays = new List<CompanyHoliday>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyHolidaysByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyHoliday companyHoliday = new CompanyHoliday();

                            if (reader["IdCompanyHoliday"] != DBNull.Value)
                                companyHoliday.IdCompanyHoliday = Convert.ToUInt64(reader["IdCompanyHoliday"]);

                            if (reader["IdCompany"] != DBNull.Value)
                                companyHoliday.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Name"] != DBNull.Value)
                                companyHoliday.Name = Convert.ToString(reader["Name"]);

                            if (reader["IdHoliday"] != DBNull.Value)
                            {
                                companyHoliday.IdHoliday = Convert.ToInt32(reader["IdHoliday"]);

                                companyHoliday.Holiday = new LookupValue();
                                companyHoliday.Holiday.IdLookupValue = companyHoliday.IdHoliday;
                                companyHoliday.Holiday.Value = Convert.ToString(reader["Value"]);

                                if (reader["HtmlColor"] != DBNull.Value)
                                    companyHoliday.Holiday.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                companyHoliday.Holiday.InUse = Convert.ToBoolean(reader["InUse"]);
                            }

                            if (reader["StartDate"] != DBNull.Value)
                                companyHoliday.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                companyHoliday.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsRecursive"] != DBNull.Value)
                                companyHoliday.IsRecursive = Convert.ToByte(reader["IsRecursive"]);

                            companyHolidays.Add(companyHoliday);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyHolidaysByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyHolidays;
        }

        /// <summary>
        /// This method is to get employee leaves related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <param name="idCompany">Get id company to get related employee leaves</param>
        /// <returns>List of employee leaves related to id company</returns>
        public List<EmployeeLeave> GetEmployeeLeavesByIdCompany(string workbenchConnectionString, Int32 idCompany)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeLeave.Employee = new Employee();
                                employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["IdGender"] != DBNull.Value)
                                    employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);
                            }

                            if (reader["IdLeave"] != DBNull.Value)
                            {
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                employeeLeave.CompanyLeave = new CompanyLeave();
                                employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);

                                employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);

                                employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                employeeLeave.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                employeeLeave.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                            }

                            if (reader["FileName"] != DBNull.Value)
                                employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        /// <summary>
        /// This method is to get all employees related to department
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <returns>List of department</returns>
        public List<Department> GetAllEmployeesByDepartment(string workbenchConnectionString, string employeesProfileImagePath)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByDepartment", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                            if (empReader["IdJobDescription"] != DBNull.Value)
                            {
                                EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                empJobDescription.JobDescription = new JobDescription();
                                empJobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);

                                if (empReader["IdDepartment"] != DBNull.Value)
                                {
                                    empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);
                                    empJobDescription.JobDescription.Department = new Department();
                                    empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                    if (empReader["DepartmentName"] != DBNull.Value)
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                }

                                employee.EmployeeJobDescription = empJobDescription;
                            }

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByDepartment(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);

            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.ToList());
            }

            return departments;
        }

        /// <summary>
        /// This method is to get company leaves
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string(emdep_geos db)</param>
        /// <returns>List of company leaves</returns>
        public List<CompanyLeave> GetAllCompanyLeaves(string workbenchConnectionString)
        {
            List<CompanyLeave> companyLeaves = new List<CompanyLeave>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyLeaves", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            CompanyLeave companyLeave = new CompanyLeave();

                            if (reader["IdCompanyLeave"] != DBNull.Value)
                                companyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdCompanyLeave"]);

                            companyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                            companyLeave.Name = Convert.ToString(reader["Name"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                companyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            companyLeaves.Add(companyLeave);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyLeaves(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return companyLeaves;
        }


        /// <summary>
        /// This method is to get employees related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employees</returns>
        public List<Employee> GetAllEmployeesByIdCompany(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByIdCompany", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["IdGender"] != DBNull.Value)
                                {
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                    employee.Gender = new LookupValue();
                                    employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                    employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                                }

                                if (empReader["IdMaritalStatus"] != DBNull.Value)
                                {
                                    employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                    employee.MaritalStatus = new LookupValue();
                                    employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                    employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                                }

                                if (empReader["IdNationality"] != DBNull.Value)
                                {
                                    employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                    employee.Nationality = new Country();
                                    employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                    employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                                }

                                if (empReader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (empReader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (empReader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(empReader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (empReader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (empReader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["CompanyMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(empReader["CompanyMobiles"]);
                                    employee.EmployeeContactCompanyMobileList = Convert.ToString(empReader["CompanyMobiles"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyMobileList != null && employee.EmployeeContactCompanyMobileList.Count > 0)
                                    {
                                        employee.EmployeeContactMobile = employee.EmployeeContactCompanyMobileList.First();
                                    }
                                }

                                if (empReader["CompanyEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyEmailList = Convert.ToString(empReader["CompanyEmails"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyEmailList != null && employee.EmployeeContactCompanyEmailList.Count > 0)
                                    {
                                        employee.EmployeeContactEmail = employee.EmployeeContactCompanyEmailList.First();
                                    }
                                }

                                if (empReader["PrivateMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateMobiles = Convert.ToString(empReader["PrivateMobiles"]);
                                    employee.EmployeeContactPrivateMobileList = Convert.ToString(empReader["PrivateMobiles"]).Split('\n').ToList<string>();
                                }

                                if (empReader["PrivateEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateEmailList = Convert.ToString(empReader["PrivateEmails"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }


                                if (empReader["Languages"] != DBNull.Value)
                                    employee.Languages = Convert.ToString(empReader["Languages"]);

                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["EmployeeDocumentNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocNationalId = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentName = Convert.ToString(empReader["EmployeeDocumentName"]);
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                }

                                if (empReader["DocPassportNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPassport = Convert.ToString(empReader["DocPassportNumber"]);
                                }

                                if (empReader["DocDrLicenseNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocDrLicense = Convert.ToString(empReader["DocDrLicenseNumber"]);
                                }

                                if (empReader["DocPubInsNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPubIns = Convert.ToString(empReader["DocPubInsNumber"]);
                                }

                                if (empReader["DocPriInsNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocPriIns = Convert.ToString(empReader["DocPriInsNumber"]);
                                }

                                if (empReader["DocVisaNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocVisa = Convert.ToString(empReader["DocVisaNumber"]);
                                }

                                if (empReader["DocOtherNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocOther = Convert.ToString(empReader["DocOtherNumber"]);
                                }

                                if (empReader["DocClockIdNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocClockId = Convert.ToString(empReader["DocClockIdNumber"]);
                                }

                                // Exit 
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                if (empReader["ExitIdReason"] != DBNull.Value)
                                {
                                    employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                    employee.ExitReason = new LookupValue();
                                    employee.ExitReason.IdLookupValue = (Int32)employee.ExitIdReason;
                                    employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                                }

                                if (empReader["ExitRemarks"] != DBNull.Value)
                                    employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                    empJobDescription.JobDescription = new JobDescription();

                                    if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);
                                    }



                                    if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);
                                    }

                                    if (empReader["JobCodeAndTitles"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitleAndCode = Convert.ToString(empReader["JobCodeAndTitles"]);
                                    }


                                    if (empReader["DepartmentName"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                    }



                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }

                                    empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["MaxJobDescriptionUsage"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (empReader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);

                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }
                                }

                                if (empReader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(empReader["LengthOfService"]);

                                }

                                if (empReader["IdEmployeeStatus"] != DBNull.Value)
                                {
                                    employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus = new LookupValue();
                                    employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus.Value = empReader["EmployeeStatus"].ToString();
                                    employee.EmployeeStatus.HtmlColor = empReader["EmployeeStatusColor"].ToString();

                                    if (empReader["EmployeeIdImage"] != DBNull.Value)
                                        employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["EmployeeIdImage"].ToString());

                                    if (empReader["EmployeeStatusPosition"] != DBNull.Value)
                                        employee.EmployeeStatus.Position = Convert.ToInt32(empReader["EmployeeStatusPosition"].ToString());
                                }

                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["CompanyShiftName"] != DBNull.Value)
                                        employee.CompanyShift.Name = Convert.ToString(empReader["CompanyShiftName"]);

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["WorkScheduleName"]);
                                    }

                                    if (empReader["StartTime1"] != DBNull.Value)
                                        employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                    if (empReader["EndTime1"] != DBNull.Value)
                                        employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                    if (empReader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];
                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    Employee emp = employees.Where(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])).FirstOrDefault();
                                    if (emp != null)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                        if (empReader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                        if (empReader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(empReader["ContractSituationFileName"]);
                                        if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);
                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);
                                        if (empReader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(empReader["ContractSituationRemarks"]);
                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);
                                        if (empReader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(empReader["IdProfessionalCategory"]);


                                        emp.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesByIdCompany().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        /// <summary>
        /// This method is to get employee job description related to idemployee and idCompany
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string(emdep_geos db.)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="idCompany">Get company Id</param>
        /// <returns>List of employee job description</returns>
        public List<EmployeeJobDescription> GetEmpJobDescByIdEmployeeAndIdCompany(string workbenchConnectionString, Int32 idEmployee, string idCompany)
        {
            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmpJobDescByIdEmployeeAndIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeJobDescription.Company = new Company();
                                employeeJobDescription.Company.IdCompany = employeeJobDescription.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeeJobDescription.JobDescription = new JobDescription();
                                employeeJobDescription.JobDescription.IdJobDescription = employeeJobDescription.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeeJobDescription.JobDescription.Department = new Department();
                                    employeeJobDescription.JobDescription.Department.IdDepartment = employeeJobDescription.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                }
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                            if (reader["JobDescriptionStartDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["JobDescriptionStartDate"]);

                            if (reader["JobDescriptionEndDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionEndDate = Convert.ToDateTime(reader["JobDescriptionEndDate"]);

                            if (reader["JobDescriptionRemarks"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionRemarks = Convert.ToString(reader["JobDescriptionRemarks"]);

                            employeeJobDescriptions.Add(employeeJobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpJobDescByIdEmployeeAndIdCompany(). IdEmployee- {0} IdCompany- {1} ErrorMessage- {2}", idEmployee, idCompany, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeJobDescriptions;
        }

        /// <summary>
        /// This method is to get employee details related to id employee and id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>Get employee details</returns>
        public Employee GetEmployeeByIdEmployeeAndIdCompany(string workbenchConnectionString, Int32 idEmployee, string idCompany)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmpJobDescByIdEmployeeAndIdCompany(workbenchConnectionString, idEmployee, idCompany);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployeeAndIdCompany(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }

        /// <summary>
        /// This method is to get all employees related to department and id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employees image path</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of department</returns>
        public List<Department> GetAllEmployeesByDepartmentByIdCompany(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByDepartmentByIdCompany", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);


                            if (empReader["IdJobDescription"] != DBNull.Value)
                            {
                                EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                empJobDescription.JobDescription = new JobDescription();

                                empJobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);

                                if (empReader["IdDepartment"] != DBNull.Value)
                                {
                                    empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);
                                    empJobDescription.JobDescription.Department = new Department();
                                    empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                    if (empReader["DepartmentName"] != DBNull.Value)
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                }

                                employee.EmployeeJobDescription = empJobDescription;
                            }

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByDepartmentByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);

            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(x => x.FullName).ToList());
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }

        /// <summary>
        /// This method is to get all employees for attendance related to idCompany
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List employee details</returns>
        public List<Employee> GetAllEmployeesForAttendanceByIdCompany(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                            if (empReader["IdEmployeeJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(empReader["IdEmployeeJobDescription"]);
                                if (empReader["IdCompany"] != DBNull.Value)
                                    employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);
                                    employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                    employee.EmployeeJobDescription.JobDescription.IdJobDescription = employee.EmployeeJobDescription.IdJobDescription;
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                    if (empReader["IdDepartment"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                                        employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employee.EmployeeJobDescription.JobDescription.Department.IdDepartment = employee.EmployeeJobDescription.JobDescription.IdDepartment;
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);
                                    }
                                }
                            }

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["Year"] != DBNull.Value)
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                    if (empReader["DailyHoursCount"] != DBNull.Value)
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                    if (empReader["WorkingDays"] != DBNull.Value)
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                }
                            }

                            employee.EmployeeContractSituation = new EmployeeContractSituation();

                            if (empReader["ContractStartDate"] != DBNull.Value)
                                employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractStartDate"]);

                            if (empReader["ContractEndDate"] != DBNull.Value)
                                employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractEndDate"]);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }

        //private string CalculateLengthOfService(List<EmployeeContractSituation> EmployeeContractSituations)
        //{
        //    string lengthOfService = "0";
        //    try
        //    {

        //        if (EmployeeContractSituations.Count > 0)
        //        {
        //            int year = 0;
        //            int month = 0;
        //            int day;
        //            int[] monthDay = new int[12] { 31, -1, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };
        //            int increment = 0;
        //            foreach (EmployeeContractSituation employeeContractSituation in EmployeeContractSituations)
        //            {
        //                if (employeeContractSituation.ContractSituationStartDate.Value.Date >= DateTime.Now.Date)
        //                {
        //                    lengthOfService += 0;
        //                }
        //                else if (employeeContractSituation.ContractSituationEndDate == null)
        //                {
        //                    if (employeeContractSituation.ContractSituationStartDate.Value.Day > DateTime.Now.Day)
        //                    {
        //                        increment = monthDay[employeeContractSituation.ContractSituationStartDate.Value.Month - 1];

        //                    }

        //                    if (increment == -1)
        //                    {
        //                        if (DateTime.IsLeapYear(employeeContractSituation.ContractSituationStartDate.Value.Year))
        //                        {
        //                            // leap year february contain 29 days
        //                            increment = 29;
        //                        }
        //                        else
        //                        {
        //                            increment = 28;
        //                        }
        //                    }

        //                    if (increment != 0)
        //                    {
        //                        day = (DateTime.Now.Day + increment) - employeeContractSituation.ContractSituationStartDate.Value.Day;
        //                        increment = 1;
        //                    }
        //                    else
        //                    {
        //                        day = (DateTime.Now.Day + increment) - employeeContractSituation.ContractSituationStartDate.Value.Day;
        //                    }

        //                    ///
        //                    ///month calculation
        //                    ///
        //                    if ((employeeContractSituation.ContractSituationStartDate.Value.Month + increment) > DateTime.Now.Month)
        //                    {
        //                        month += (DateTime.Now.Month + 12) - (employeeContractSituation.ContractSituationStartDate.Value.Month + increment);
        //                        increment = 1;
        //                    }
        //                    else
        //                    {
        //                        month += (DateTime.Now.Month) - (employeeContractSituation.ContractSituationStartDate.Value.Month + increment);
        //                        increment = 0;
        //                    }

        //                    ///
        //                    /// year calculation
        //                    ///
        //                    year += DateTime.Now.Year - (employeeContractSituation.ContractSituationStartDate.Value.Year + increment);
        //                }

        //                else
        //                {
        //                    if (employeeContractSituation.ContractSituationEndDate > DateTime.Now.Date)
        //                    {
        //                        if (employeeContractSituation.ContractSituationStartDate.Value.Day > DateTime.Now.Day)
        //                        {
        //                            increment = monthDay[employeeContractSituation.ContractSituationStartDate.Value.Month - 1];

        //                        }

        //                        if (increment == -1)
        //                        {
        //                            if (DateTime.IsLeapYear(employeeContractSituation.ContractSituationStartDate.Value.Year))
        //                            {
        //                                // leap year february contain 29 days
        //                                increment = 29;
        //                            }
        //                            else
        //                            {
        //                                increment = 28;
        //                            }
        //                        }

        //                        if (increment != 0)
        //                        {
        //                            day = (DateTime.Now.Day + increment) - employeeContractSituation.ContractSituationStartDate.Value.Day;
        //                            increment = 1;
        //                        }
        //                        else
        //                        {
        //                            day = (DateTime.Now.Day + increment) - employeeContractSituation.ContractSituationStartDate.Value.Day;
        //                        }

        //                        ///
        //                        ///month calculation
        //                        ///
        //                        if ((employeeContractSituation.ContractSituationStartDate.Value.Month + increment) > DateTime.Now.Month)
        //                        {
        //                            month += (DateTime.Now.Month + 12) - (employeeContractSituation.ContractSituationStartDate.Value.Month + increment);
        //                            increment = 1;
        //                        }
        //                        else
        //                        {
        //                            month += (DateTime.Now.Month) - (employeeContractSituation.ContractSituationStartDate.Value.Month + increment);
        //                            increment = 0;
        //                        }


        //                        /// year calculation                                
        //                        year += DateTime.Now.Year - (employeeContractSituation.ContractSituationStartDate.Value.Year + increment);

        //                    }
        //                    else
        //                    {
        //                        if (employeeContractSituation.ContractSituationStartDate.Value.Day > employeeContractSituation.ContractSituationEndDate.Value.Day)
        //                        {
        //                            increment = monthDay[employeeContractSituation.ContractSituationStartDate.Value.Month - 1];
        //                        }

        //                        if (increment == -1)
        //                        {
        //                            if (DateTime.IsLeapYear(employeeContractSituation.ContractSituationStartDate.Value.Year))
        //                            {
        //                                // leap year february contain 29 days
        //                                increment = 29;
        //                            }
        //                            else
        //                            {
        //                                increment = 28;
        //                            }
        //                        }

        //                        if (increment != 0)
        //                        {
        //                            day = (employeeContractSituation.ContractSituationEndDate.Value.Day + increment) - employeeContractSituation.ContractSituationStartDate.Value.Day;
        //                            increment = 1;
        //                        }
        //                        else
        //                        {
        //                            day = (employeeContractSituation.ContractSituationEndDate.Value.Day + increment) - employeeContractSituation.ContractSituationStartDate.Value.Day;
        //                        }

        //                        ///month calculation
        //                        if ((employeeContractSituation.ContractSituationStartDate.Value.Month + increment) > employeeContractSituation.ContractSituationEndDate.Value.Month)
        //                        {
        //                            month += (employeeContractSituation.ContractSituationEndDate.Value.Month + 12) - (employeeContractSituation.ContractSituationStartDate.Value.Month + increment);
        //                            increment = 1;
        //                        }
        //                        else
        //                        {
        //                            month += (employeeContractSituation.ContractSituationEndDate.Value.Month) - (employeeContractSituation.ContractSituationStartDate.Value.Month + increment);
        //                            increment = 0;
        //                        }

        //                        /// year calculation
        //                        year += employeeContractSituation.ContractSituationEndDate.Value.Year - (employeeContractSituation.ContractSituationStartDate.Value.Year + increment);
        //                    }
        //                }
        //            }

        //            if (month > 12)
        //            {
        //                year += month / 12;
        //                month = month % 12;
        //                year = year + month / 12;
        //            }

        //            lengthOfService = Convert.ToString(year) + "y  " + Convert.ToString(month) + "M";

        //        }

        //    }
        //    catch (Exception ex)
        //    {
        //        Log4NetLogger.Logger.Log(string.Format("Error CalculateLengthOfService(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //        throw;
        //    }
        //    return lengthOfService;
        //}


        /// <summary>
        /// This method is to calculate length of service
        /// </summary>
        /// <param name="EmployeeContractSituations">Get list of employee contract situations</param>
        /// <returns>Length of service</returns>
        private string CalculateLengthOfService(List<EmployeeContractSituation> EmployeeContractSituations)
        {
            string lengthOfService = "0";
            try
            {

                if (EmployeeContractSituations.Count > 0)
                {
                    int month = 0;
                    int year = 0;
                    foreach (EmployeeContractSituation employeeContractSituation in EmployeeContractSituations)
                    {
                        if (employeeContractSituation.ContractSituationStartDate.Value.Date >= DateTime.Now.Date)
                        {
                            lengthOfService += 0;
                        }
                        else if (employeeContractSituation.ContractSituationEndDate == null)
                        {

                            LocalDate start = new LocalDate(employeeContractSituation.ContractSituationStartDate.Value.Year, employeeContractSituation.ContractSituationStartDate.Value.Month, employeeContractSituation.ContractSituationStartDate.Value.Day);
                            LocalDate end = new LocalDate(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day).PlusDays(1);
                            Period period = Period.Between(start, end, PeriodUnits.Months);
                            month = month + period.Months;
                        }
                        else
                        {
                            if (employeeContractSituation.ContractSituationEndDate > DateTime.Now.Date)
                            {
                                LocalDate start = new LocalDate(employeeContractSituation.ContractSituationStartDate.Value.Year, employeeContractSituation.ContractSituationStartDate.Value.Month, employeeContractSituation.ContractSituationStartDate.Value.Day);
                                LocalDate end = new LocalDate(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day).PlusDays(1);
                                Period period = Period.Between(start, end, PeriodUnits.Months);
                                month = month + period.Months;
                            }
                            else
                            {
                                LocalDate start = new LocalDate(employeeContractSituation.ContractSituationStartDate.Value.Year, employeeContractSituation.ContractSituationStartDate.Value.Month, employeeContractSituation.ContractSituationStartDate.Value.Day);
                                LocalDate end = new LocalDate(employeeContractSituation.ContractSituationEndDate.Value.Year, employeeContractSituation.ContractSituationEndDate.Value.Month, employeeContractSituation.ContractSituationEndDate.Value.Day).PlusDays(1);
                                Period period = Period.Between(start, end, PeriodUnits.Months);
                                month = month + period.Months;
                            }
                        }

                    }

                    if (month >= 12)
                    {
                        year += month / 12;
                        month = month % 12;
                        year = year + month / 12;
                    }

                    lengthOfService = Convert.ToString(year) + "y  " + Convert.ToString(month) + "M";
                }


            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error CalculateLengthOfService(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return lengthOfService;
        }

        /// <summary>
        /// This method is to get all employee of job description
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <returns>List of employee</returns>
        public List<Employee> GetAllEmployeeOfJobDescription(string workbenchConnectionString, string idCompany, string employeesProfileImagePath)
        {
            List<Employee> employees = new List<Employee>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeeOfJobDescription", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                if (reader["IdParent"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);

                                employee.EmployeeJobDescription.JobDescription.Abbreviation = reader["Abbreviation"].ToString();

                                if (reader["ChildOrientation"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                            employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                }
            }

            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            return employees;
        }

        /// <summary>
        /// [001]This method is used to add employees in organization
        /// [002][2018-07-06][skhade][HRM-M042-23] Do not display empty departments in organization.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="employeesProfileImagePath">The employee image path.</param>
        /// <param name="idCompany">The id companies.</param>
        /// <param name="selectedPeriod">The selected period.</param>
        /// <returns>The list of departments.</returns>
        public List<Department> GetAllEmployeesForOrganizationByIdCompany(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<JobDescription> jobDescriptions = GetAllJobDescriptions(workbenchConnectionString);

            List<Employee> emp = new List<Employee>();
            emp = GetAllEmployeeOfJobDescription(workbenchConnectionString, idCompany, employeesProfileImagePath);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForOrganizationByIdCompany", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (reader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    }
                                }

                                if (reader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(reader["LengthOfService"]);
                                }

                                if (reader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmployeeJobCodes = Convert.ToString(reader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (reader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(reader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                    }

                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {

                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {

                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);

                                    }
                                }


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (Employee itememp in employees)
            {

                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            var grouppJD = emp.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdJobDescription);

            foreach (var item in grouppJD)
            {
                JobDescription jobDescription = jobDescriptions.Where(x => x.IdJobDescription == item.Key).FirstOrDefault();
                jobDescription.Employees = new List<Employee>();
                jobDescription.Employees.AddRange(item.ToList());
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);



            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(o => o.EmployeeJobDescription.JobDescription.JobDescriptionCode).ThenBy(o => o.FullName).ToList());
            }

            foreach (Department dept in departments)
            {
                dept.JobDescriptions = jobDescriptions.Where(x => x.IdDepartment == dept.IdDepartment).ToList();
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }

        /// <summary>
        /// This method is to get company holiday related to selected id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbecnh connection string (emdep_goes db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of company holiday</returns>
        public List<CompanyHoliday> GetCompanyHolidaysBySelectedIdCompany(string workbenchConnectionString, string idCompany, Int64 selectedPeriod = 0)
        {
            List<CompanyHoliday> companyHolidays = new List<CompanyHoliday>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyHolidaysBySelectedIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyHoliday companyHoliday = new CompanyHoliday();

                            if (reader["IdCompanyHoliday"] != DBNull.Value)
                                companyHoliday.IdCompanyHoliday = Convert.ToUInt64(reader["IdCompanyHoliday"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                companyHoliday.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                companyHoliday.Company = new Company();
                                companyHoliday.Company.IdCompany = companyHoliday.IdCompany;
                                companyHoliday.Company.Name = Convert.ToString(reader["CompanyName"]);
                                companyHoliday.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["Name"] != DBNull.Value)
                                companyHoliday.Name = Convert.ToString(reader["Name"]);

                            if (reader["IdHoliday"] != DBNull.Value)
                            {
                                companyHoliday.IdHoliday = Convert.ToInt32(reader["IdHoliday"]);

                                companyHoliday.Holiday = new LookupValue();
                                companyHoliday.Holiday.IdLookupValue = companyHoliday.IdHoliday;
                                companyHoliday.Holiday.Value = Convert.ToString(reader["Value"]);

                                if (reader["HtmlColor"] != DBNull.Value)
                                    companyHoliday.Holiday.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                companyHoliday.Holiday.InUse = Convert.ToBoolean(reader["InUse"]);
                            }

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                companyHoliday.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                companyHoliday.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                companyHoliday.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                companyHoliday.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                            }

                            if (reader["IsRecursive"] != DBNull.Value)
                                companyHoliday.IsRecursive = Convert.ToByte(reader["IsRecursive"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                companyHoliday.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                            companyHolidays.Add(companyHoliday);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyHolidaysBySelectedIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyHolidays;
        }

        /// <summary>
        /// This method is to get employee leaves related to selected id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee leaves</returns>
        public List<EmployeeLeave> GetEmployeeLeavesBySelectedIdCompany(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();


            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesBySelectedIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeLeave employeeLeave = new EmployeeLeave();

                                if (reader["IdEmployeeLeave"] != DBNull.Value)
                                    employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeLeave.Employee = new Employee();
                                    employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    if (reader["EmployeeCode"] != DBNull.Value)
                                        employeeLeave.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                    if (reader["FirstName"] != DBNull.Value)
                                        employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                    if (reader["LastName"] != DBNull.Value)
                                        employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                        employeeLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    if (reader["IdGender"] != DBNull.Value)
                                        employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                    if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeJobDescription = new EmployeeJobDescription();

                                        employeeLeave.Employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                    employeeLeave.CompanyLeave = new CompanyLeave();
                                    employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                    employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                    employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeLeave.CompanyLeave.Company = new Company();
                                        employeeLeave.CompanyLeave.Company.IdCompany = employeeLeave.CompanyLeave.IdCompany;

                                        if (reader["CompanyAlias"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.Alias = Convert.ToString(reader["CompanyAlias"]);

                                        if (reader["CompanyName"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.Name = Convert.ToString(reader["CompanyName"]);

                                        employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule = new CompanyAnnualSchedule();

                                        employeeLeave.CompanyLeave.Company.CompanySetting = new CompanySetting();

                                        if (reader["CompanySetting"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeLeave.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeLeave.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeLeave.StartDate.Value, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeLeave.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["FileName"] != DBNull.Value)
                                    employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                                if (reader["Remark"] != DBNull.Value)
                                    employeeLeave.Remark = Convert.ToString(reader["Remark"]);

                                if (reader["IsAllDayEvent"] != DBNull.Value)
                                    employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);



                                employeeLeaves.Add(employeeLeave);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesBySelectedIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }


        /// <summary>
        /// This method if to get selected id company leaves
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>List of company leaves</returns>
        public List<CompanyLeave> GetSelectedIdCompanyLeaves(string workbenchConnectionString, string idCompany)
        {
            List<CompanyLeave> companyLeaves = new List<CompanyLeave>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyLeaves", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            CompanyLeave companyLeave = new CompanyLeave();
                            if (reader["IdCompanyLeave"] != DBNull.Value)
                                companyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdCompanyLeave"]);

                            if (reader["IdCompany"] != DBNull.Value)
                                companyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            companyLeave.Name = Convert.ToString(reader["Name"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                companyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            companyLeaves.Add(companyLeave);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyLeaves(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return companyLeaves;
        }


        /// <summary>
        /// This methoid is to get employee attendance related by selected id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdpe_geos db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee attendance</returns>
        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                            if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                            }

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeAttendance.Employee = new Employee();
                                employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                employeeAttendance.Employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employeeAttendance.Employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["JDIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(reader["JDIdCompany"]);
                                    employeeAttendance.Employee.EmployeeJobDescription.Company = new Company();
                                    employeeAttendance.Employee.EmployeeJobDescription.Company.IdCompany = employeeAttendance.Employee.EmployeeJobDescription.IdCompany;

                                    if (reader["CompanyName"] != DBNull.Value)
                                        employeeAttendance.Employee.EmployeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                    if (reader["CompanyAlias"] != DBNull.Value)
                                        employeeAttendance.Employee.EmployeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                                }

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    employeeAttendance.Employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                    employeeAttendance.Employee.EmployeeJobDescription.JobDescription.IdJobDescription = employeeAttendance.Employee.EmployeeJobDescription.IdJobDescription;
                                    employeeAttendance.Employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.IdDepartment = employeeAttendance.Employee.EmployeeJobDescription.JobDescription.IdDepartment;
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                        if (reader["DepartmentInUse"] != DBNull.Value)
                                            employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);

                                        if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                            employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                    }
                                }

                                if (reader["TotalWorkedHours"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                    //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                    string span = employeeAttendance.Employee.TotalWorkedHours;
                                    employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                               int.Parse(span.Split(':')[1]),    // minutes
                                                               0);
                                }

                                if (reader["IdCompanyWork"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                    employeeAttendance.CompanyWork = new CompanyWork();
                                    employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                    employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                    employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeAttendance.CompanyShift = new CompanyShift();
                                    employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                    if (reader["DailyHoursCount"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                    if (reader["Year"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                    if (reader["WorkingDays"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                }
                            }

                            employeeAttendances.Add(employeeAttendance);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyLeaves(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employeeAttendances;
        }


        /// <summary>
        /// This method is to add employee leave
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos db.)</param>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeeLeave">Get employee eave details</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Employee leave details</returns>
        public EmployeeLeave AddEmployeeLeave(string mainServerWorkbenchConnectionString, string workbenchConnectionString, EmployeeLeave employeeLeave, long selectedPeriod)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLeave_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeLeave.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeLeave.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                        mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                        mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);

                        employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();

                        ///002
                        AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employeeLeave.IdEmployee, employeeLeave.EmployeeChangelogs);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();

                    if (employeeLeave.Employee == null)
                        employeeLeave.Employee = new Employee();

                    employeeLeave.Employee.CompanyShift = GetEmployeeShiftandDailyHoursByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee, selectedPeriod);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeLeave(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeLeave;
        }

        /// <summary>
        /// This method is to add employee leaves from list
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos db.)</param>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="empLeaveAttachment">Get employee leave attachmnent details</param>
        /// <param name="employeeLeaves">Get employee leaves details</param>
        /// <param name="fileInBytes">Get bytes of file</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee leaves</returns>
        public List<EmployeeLeave> AddEmployeeLeavesFromList(string mainServerWorkbenchConnectionString, string workbenchConnectionString, string empLeaveAttachment, List<EmployeeLeave> employeeLeaves, byte[] fileInBytes, long selectedPeriod)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLeave_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        MySqlCommand mySqlCommandChangelog = new MySqlCommand("Hrm_EmployeeChangelog_Insert", mySqlConnection);
                        mySqlCommandChangelog.CommandType = CommandType.StoredProcedure;

                        foreach (EmployeeLeave employeeLeave in employeeLeaves)
                        {
                            //List<Tuple<DateTime, DateTime>> dtSeperatedByYear =new List<Tuple<DateTime, DateTime>>(SeperateStartEndDateIfYearNotSame(new Tuple<DateTime, DateTime>(employeeLeave.StartDate.Value, employeeLeave.EndDate.Value)));
                            // if (dtSeperatedByYear != null)
                            // {
                            //     foreach (var item in dtSeperatedByYear)
                            //     {
                            //         mySqlCommand.Parameters.Clear();
                            //         mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                            //         mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                            //         mySqlCommand.Parameters.AddWithValue("_StartDate", item.Item1);
                            //         mySqlCommand.Parameters.AddWithValue("_EndDate", item.Item2);
                            //         mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                            //         mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                            //         mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);

                            //         employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                            //     }
                            // }
                            // else
                            // {
                            mySqlCommand.Parameters.Clear();
                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", employeeLeave.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", employeeLeave.EndDate);
                            mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                            mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                            mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);

                            employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            //}


                            //Employee Change logs.
                            if (employeeLeave.EmployeeChangelogs != null && employeeLeave.EmployeeChangelogs.Count > 0)
                                foreach (EmployeeChangelog employeeChangelog in employeeLeave.EmployeeChangelogs)
                                {
                                    mySqlCommandChangelog.Parameters.Clear();
                                    mySqlCommandChangelog.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                                    mySqlCommandChangelog.Parameters.AddWithValue("_ChangeLogDatetime", employeeChangelog.ChangeLogDatetime);
                                    mySqlCommandChangelog.Parameters.AddWithValue("_ChangeLogIdUser", employeeChangelog.ChangeLogIdUser);
                                    mySqlCommandChangelog.Parameters.AddWithValue("_ChangeLogChange", employeeChangelog.ChangeLogChange);
                                    mySqlCommandChangelog.ExecuteNonQuery();
                                }
                        }

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();

                    foreach (EmployeeLeave employeeLeave in employeeLeaves)
                    {
                        if (employeeLeave.Employee == null)
                            employeeLeave.Employee = new Employee();

                        employeeLeave.Employee.CompanyShift = GetEmployeeShiftandDailyHoursByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee, selectedPeriod);

                        if (fileInBytes != null)
                            SaveEmployeeLeaveAttachment(employeeLeave.Employee.EmployeeCode, employeeLeave.IdEmployeeLeave, employeeLeave.FileName, empLeaveAttachment, fileInBytes);

                        employeeLeave.Employee.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                        EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                        employeeJobDescription = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee).LastOrDefault();

                        if (employeeJobDescription != null)
                            employeeLeave.Employee.EmployeeJobDescriptions.Add(employeeJobDescription);

                        string idCompany = "";
                        if (employeeLeave.Employee.EmployeeJobDescriptions != null)
                        {
                            idCompany = employeeLeave.Employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                        }
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeLeavesFromList(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeLeaves;
        }



        private List<Tuple<DateTime, DateTime>> SeperateStartEndDateIfYearNotSame(Tuple<DateTime, DateTime> tupStartEnd)
        {
            List<Tuple<DateTime, DateTime>> ListTuple = new List<Tuple<DateTime, DateTime>>();

            if (tupStartEnd.Item1.Year != tupStartEnd.Item2.Year)
            {
                List<DateTime> dtStart = new List<DateTime>();
                for (DateTime i = tupStartEnd.Item1; i <= tupStartEnd.Item2;)
                {
                    dtStart.Add(i);
                    i = i.AddDays(1);
                    if (i.Year == tupStartEnd.Item2.Year)
                        break;
                }

                ListTuple.Add(new Tuple<DateTime, DateTime>(dtStart.FirstOrDefault(), dtStart.LastOrDefault()));
                ListTuple.Add(new Tuple<DateTime, DateTime>(dtStart.LastOrDefault().AddDays(1), tupStartEnd.Item2));

            }
            return ListTuple;
        }



        public CompanyShift GetEmployeeShiftandDailyHoursByIdEmployee(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod)
        {
            CompanyShift companyShift = new CompanyShift();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeShiftandDailyHoursByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    if (selectedPeriod == 0)
                        mySqlCommand.Parameters.AddWithValue("_Period", DateTime.Now.Year);
                    else
                        mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                companyShift.CompanyAnnualSchedule.IdCompanySchedule = companyShift.IdCompanySchedule;

                                if (reader["Year"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["DailyHoursCount"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                if (reader["WorkingDays"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);

                                if (reader["Value"] != DBNull.Value)
                                {
                                    companyShift.CompanyAnnualSchedule.CompanySetting = new CompanySetting();
                                    companyShift.CompanyAnnualSchedule.CompanySetting.Value = Convert.ToString(reader["Value"]);
                                }
                            }

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeShiftandDailyHoursByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShift;
        }




        /// <summary>
        /// Update employee leave
        /// [002][skhade][30-08-2018][HRM-M046-25] Changelog when managing employee leaves.
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">The mainserver workbench connection string</param>
        /// <param name="employeeLeave">The employee leave.</param>
        /// <returns>The employee leave with idemployee leave.</returns>
        public EmployeeLeave UpdateEmployeeLeave(string mainServerWorkbenchConnectionString, string workbenchConnectionString, EmployeeLeave employeeLeave, long selectedPeriod)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {

                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLeave_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        //List<Tuple<DateTime, DateTime>> dtSeperatedByYear = new List<Tuple<DateTime, DateTime>>(SeperateStartEndDateIfYearNotSame(new Tuple<DateTime, DateTime>(employeeLeave.StartDate.Value, employeeLeave.EndDate.Value)));
                        //if (dtSeperatedByYear != null)
                        //{
                        //    UInt64 IdEmployeeLeave = employeeLeave.IdEmployeeLeave;
                        //    foreach (var item in dtSeperatedByYear)
                        //    {
                        //        mySqlCommand.Parameters.Clear();
                        //        mySqlCommand.Parameters.AddWithValue("_IdEmployeeLeave", IdEmployeeLeave);
                        //        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                        //        mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                        //        mySqlCommand.Parameters.AddWithValue("_StartDate", item.Item1);
                        //        mySqlCommand.Parameters.AddWithValue("_EndDate", item.Item2);
                        //        mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                        //        mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                        //        mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);

                        //        employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        //        IdEmployeeLeave = 0;//For insert new entry in table for different year
                        //    }
                        //}
                        //else
                        //{
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeLeave", employeeLeave.IdEmployeeLeave);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeLeave.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeLeave.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                        mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                        mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);

                        employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        // }
                        mySqlConnection.Close();

                        ///002
                        AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employeeLeave.IdEmployee, employeeLeave.EmployeeChangelogs);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();

                    if (employeeLeave.Employee == null)
                        employeeLeave.Employee = new Employee();

                    employeeLeave.Employee.CompanyShift = GetEmployeeShiftandDailyHoursByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee, selectedPeriod);
                    employeeLeave.Employee.EmployeeAnnualLeaves = GetEmployeeAnnualLeavesHourCountByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee, selectedPeriod);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployeeLeave(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeLeave;
        }

        /// <summary>
        /// [001][24-09-2018][skhade][HRM-M048-06] Add new column File in Leaves grid
        /// </summary>
        /// <param name="EmpLeaveAttachmentPath">The employee leave attachment file path.</param>
        /// <param name="employeeLeave">The employee leave.</param>
        /// <returns>Bytes array if found file else null.</returns>
        public byte[] GetEmployeeLeaveAttachment(string EmpLeaveAttachmentPath, EmployeeLeave employeeLeave)
        {
            string fileUploadPath = string.Format(@"{0}/{1}/{2}/{3}", EmpLeaveAttachmentPath, employeeLeave.Employee.EmployeeCode, employeeLeave.IdEmployeeLeave, employeeLeave.FileName);
            byte[] bytes = null;

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }

                }

                return bytes;
            }
            catch (FileNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveAttachment() IdEmployeeLeave-{0}. ErrorMessage- {2}", employeeLeave.IdEmployeeLeave, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (DirectoryNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveAttachment() IdEmployeeLeave-{0}. ErrorMessage- {2}", employeeLeave.IdEmployeeLeave, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveAttachment() IdEmployeeLeave-{0}. ErrorMessage- {2}", employeeLeave.IdEmployeeLeave, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public bool SaveEmployeeLeaveAttachment(string employeeCode, UInt64 idEmployeeLeave, string fileName, string filePath, byte[] fileBytes)
        {
            if (fileBytes != null)
            {
                try
                {
                    string path = filePath + @"\" + employeeCode + @"\" + idEmployeeLeave;
                    if (!fileMgr.DirectoryExists(path))
                    {
                        fileMgr.CreateDirectory(path);
                    }

                    path = path + @"\" + fileName;
                    File.WriteAllBytes(path, fileBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeLeaveAttachment()-Code - {0}. ErrorMessage- {1}", employeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        public bool DeleteEmployeeLeaveAttachment(string filePath, string employeeCode, UInt64 idEmployeeLeave, string fileName)
        {
            try
            {
                string path = filePath + @"\" + employeeCode + @"\" + idEmployeeLeave;
                if (!Directory.Exists(path))
                {
                    return false;
                }
                else
                {
                    path = path + @"\" + fileName;

                    if (Directory.Exists(filePath + @"\" + employeeCode + @"\" + idEmployeeLeave))
                    {
                        Directory.Delete(filePath + @"\" + employeeCode + @"\" + idEmployeeLeave, true);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeLeaveAttachment()-Code - {0}. ErrorMessage- {1}", employeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        public Department AddDepartment(string mainServerWorkbenchConnectionString, Department department)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Department_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_DepartmentName", department.DepartmentName);
                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", department.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartmentParent", department.IdDepartmentParent);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentPosition", department.DepartmentPosition);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartmentArea", department.IdDepartmentArea);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentInUse", department.DepartmentInUse);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentHtmlColor", department.DepartmentHtmlColor);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentIsIsolated", department.DepartmentIsIsolated);

                        department.IdDepartment = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDepartment(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return department;
        }

        public Department UpdateDepartment(string mainServerWorkbenchConnectionString, Department department)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Department_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", department.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentName", department.DepartmentName);
                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", department.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartmentParent", department.IdDepartmentParent);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentPosition", department.DepartmentPosition);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartmentArea", department.IdDepartmentArea);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentInUse", department.DepartmentInUse);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentHtmlColor", department.DepartmentHtmlColor);
                        mySqlCommand.Parameters.AddWithValue("_DepartmentIsIsolated", department.DepartmentIsIsolated);

                        department.IdDepartment = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateDepartment(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return department;
        }

        public List<Department> GetAllDepartmentDetails(string workbenchConnectionString)
        {
            List<Department> departments = new List<Department>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Department_GetAllDepartmentDetails", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            Department department = new Department();
                            if (reader["IdDepartment"] != DBNull.Value)
                                department.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                            if (reader["DepartmentName"] != DBNull.Value)
                                department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                            if (reader["Abbreviation"] != DBNull.Value)
                                department.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["IdDepartmentParent"] != DBNull.Value)
                            {
                                department.IdDepartmentParent = Convert.ToUInt32(reader["IdDepartmentParent"]);
                                department.ParentDepartment = new Department();
                                department.ParentDepartment.IdDepartmentParent = Convert.ToUInt32(reader["IdDepartmentParent"]);
                                department.ParentDepartment.DepartmentName = reader["Parent"].ToString();
                            }

                            if (reader["DepartmentPosition"] != DBNull.Value)
                                department.DepartmentPosition = reader["DepartmentPosition"].ToString();

                            if (reader["IdDepartmentArea"] != DBNull.Value)
                            {
                                department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);
                                department.DepartmentArea = new LookupValue();
                                department.DepartmentArea.IdLookupValue = Convert.ToInt32(reader["IdDepartmentArea"]);
                                department.DepartmentArea.Value = reader["DepartmentArea"].ToString();

                                if (reader["DepartmentAreaHtmlColor"] != DBNull.Value)
                                    department.DepartmentArea.HtmlColor = Convert.ToString(reader["DepartmentAreaHtmlColor"]);
                            }

                            if (reader["DepartmentInUse"] != DBNull.Value)
                                department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);

                            if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                department.DepartmentHtmlColor = reader["DepartmentHtmlColor"].ToString();

                            if (reader["DepartmentIsIsolated"] != DBNull.Value)
                                department.DepartmentIsIsolated = Convert.ToByte(reader["DepartmentIsIsolated"]);

                            departments.Add(department);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllDepartmentDetails(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return departments;
        }

        public bool AddEmployeeAttendance(string mainServerWorkbenchConnectionString, List<EmployeeAttendance> employeeAttendanceList)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendance_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        foreach (EmployeeAttendance item in employeeAttendanceList)
                        {
                            mySqlCommand.Parameters.Clear();

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", item.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", item.IdCompanyWork);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", item.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", item.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", item.EndDate);

                            mySqlCommand.ExecuteNonQuery();
                        }

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeAttendance(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return true;
        }

        public EmployeeAttendance AddEmployeeAttendance(string mainServerWorkbenchConnectionString, EmployeeAttendance employeeAttendance)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendance_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeAttendance.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", employeeAttendance.IdCompanyWork);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeAttendance.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeAttendance.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeAttendance.EndDate);

                        employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeAttendance(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeAttendance;
        }

        public bool UpdateEmployeeAttendance(string mainServerWorkbenchConnectionString, EmployeeAttendance employeeAttendance)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendance_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeAttendance", employeeAttendance.IdEmployeeAttendance);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeAttendance.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", employeeAttendance.IdCompanyWork);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeAttendance.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeAttendance.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeAttendance.EndDate);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployeeAttendance(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// [001][24-09-2018][skhade][HRM-M048-10] Allow to remove entries in attendance.
        /// </summary>
        /// <param name="mainWorkbenchConnectionString">The main server workbench connection string.</param>
        /// <param name="idEmployeeAttendance">The id employee attendance.</param>
        /// <returns>True if deleted, else false</returns>
        public bool DeleteEmployeeAttendance(string mainWorkbenchConnectionString, Int64 idEmployeeAttendance)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendance_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeAttendance", idEmployeeAttendance);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();

                        transactionScope.Complete();
                        transactionScope.Dispose();
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeAttendance(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return true;
        }

        public List<Employee> GetUpcomingBirthdaysOfEmployees(string workbenchConnectionString, string employeesProfileImagePath, string idCompanies, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetUpcomingBirthdaysOfEmployees", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingBirthdaysOfEmployees(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employees;
        }

        public List<EmployeeLeave> GetUpcomingLeavesOfEmployees(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetUpcomingLeavesOfEmployees", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["StartDate"] != DBNull.Value && reader["EndDate"] != DBNull.Value)
                            {
                                DateTime start = Convert.ToDateTime(reader["StartDate"]).Date;
                                DateTime end = Convert.ToDateTime(reader["EndDate"]).Date;

                                for (var day = start.Date; day.Date <= end.Date; day = day.AddDays(1))
                                {
                                    int result = DateTime.Compare(day, DateTime.Now.Date);

                                    if (result < 0)        //day is the earlier than today
                                    {
                                        continue;
                                    }

                                    EmployeeLeave employeeLeave = new EmployeeLeave();

                                    if (reader["IdEmployeeLeave"] != DBNull.Value)
                                        employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                    if (reader["IdEmployee"] != DBNull.Value)
                                    {
                                        employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        employeeLeave.Employee = new Employee();
                                        employeeLeave.Employee.IdEmployee = employeeLeave.IdEmployee;

                                        if (reader["FirstName"] != DBNull.Value)
                                            employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                        if (reader["LastName"] != DBNull.Value)
                                            employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                        if (reader["IdGender"] != DBNull.Value)
                                            employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);
                                    }

                                    if (reader["IdLeave"] != DBNull.Value)
                                    {
                                        employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                        employeeLeave.CompanyLeave = new CompanyLeave();
                                        employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                        employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                        employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                                    }

                                    employeeLeave.StartDate = day;
                                    employeeLeave.EndDate = day;

                                    if (result == 0)        //day is the same time as today
                                    {
                                        employeeLeaves.Add(employeeLeave);
                                    }
                                    else if (result > 0 && (day - DateTime.Now.Date).TotalDays <= 7)    //day is later than today & <= 7 days
                                    {
                                        employeeLeaves.Add(employeeLeave);
                                    }
                                }
                            }

                            //EmployeeLeave employeeLeave = new EmployeeLeave();

                            //if (reader["IdEmployeeLeave"] != DBNull.Value)
                            //    employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            //if (reader["IdEmployee"] != DBNull.Value)
                            //{
                            //    employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            //    employeeLeave.Employee = new Employee();
                            //    employeeLeave.Employee.IdEmployee = employeeLeave.IdEmployee;

                            //    if (reader["FirstName"] != DBNull.Value)
                            //        employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                            //    if (reader["LastName"] != DBNull.Value)
                            //        employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                            //    if (reader["IdGender"] != DBNull.Value)
                            //        employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);
                            //}

                            //if (reader["IdLeave"] != DBNull.Value)
                            //{
                            //    employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                            //    employeeLeave.CompanyLeave = new CompanyLeave();
                            //    employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                            //    employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                            //    employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                            //    employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            //}

                            //if (reader["StartDate"] != DBNull.Value)
                            //    employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            //if (reader["EndDate"] != DBNull.Value)
                            //    employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            ////if (reader["FileName"] != DBNull.Value)
                            ////    employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                            //employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        public CompanyHoliday AddCompanyHoliday(string mainServerWorkbenchConnectionString, CompanyHoliday companyHoliday)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyHolidays_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCompany", companyHoliday.IdCompany);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyHoliday.Name);
                        mySqlCommand.Parameters.AddWithValue("_IdHoliday", companyHoliday.IdHoliday);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", companyHoliday.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", companyHoliday.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_IsRecursive", companyHoliday.IsRecursive);
                        mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", companyHoliday.IsAllDayEvent);

                        companyHoliday.IdCompanyHoliday = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddDepartment(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyHoliday;
        }

        public CompanyHoliday UpdateCompanyHoliday(string mainServerWorkbenchConnectionString, CompanyHoliday companyHoliday)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyHolidays_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdCompanyHoliday", companyHoliday.IdCompanyHoliday);
                        mySqlCommand.Parameters.AddWithValue("_IdCompany", companyHoliday.IdCompany);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyHoliday.Name);
                        mySqlCommand.Parameters.AddWithValue("_IdHoliday", companyHoliday.IdHoliday);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", companyHoliday.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", companyHoliday.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_IsRecursive", companyHoliday.IsRecursive);
                        mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", companyHoliday.IsAllDayEvent);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCompanyHoliday(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyHoliday;
        }

        /// <summary>
        /// This method is used to delete employee leave.
        /// [001][2018-06-21][skhade][HRM-M041-18] Enable to delete leaves
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString"></param>
        /// <param name="employeeCode"></param>
        /// <param name="idEmployeeLeave"></param>
        /// <param name="empLeaveFilesPath"></param>
        /// <returns>If true deleted employee leave otherwise false</returns>
        public bool DeleteEmployeeLeave(string mainServerWorkbenchConnectionString, string employeeCode, UInt64 idEmployeeLeave, string empLeaveFilesPath, EmployeeLeave employeeLeave = null)
        {
            //001 Added complete method.
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLeaves_Delete", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeLeave", idEmployeeLeave);

                        DeleteEmployeeLeaveAttachment(empLeaveFilesPath, employeeCode, idEmployeeLeave, "");

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();

                        if (employeeLeave != null)
                        {
                            ///002
                            AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employeeLeave.IdEmployee, employeeLeave.EmployeeChangelogs);
                        }

                        transactionScope.Complete();
                        transactionScope.Dispose();
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeLeave(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is to get employee head count related to department and company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get mutiple selected company Id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of departments</returns>
        public List<Department> GetEmployeesHeadCountByDepartmentByIdCompany(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<Department> departments = new List<Department>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpHeadcountByDeptByIdCompany", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Department department = new Department();

                                department.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                                if (empReader["DepartmentName"] != DBNull.Value)
                                    department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                                if (empReader["DepartmentHtmlColor"] != DBNull.Value)
                                    department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);

                                if (empReader["EmployeesRecordCount"] != DBNull.Value)
                                {
                                    department.EmployeesCount = Convert.ToUInt32(empReader["EmployeesRecordCount"]);
                                    department.EmployeesRecordCount = Convert.ToDecimal(empReader["EmployeesRecordCount"]);
                                }

                                departments.Add(department);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesHeadCountByDepartmentByIdCompany_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return departments;
        }


        /// <summary>
        /// This method is to get employee count related to gender and company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of count of gender</returns>
        public List<LookupValue> GetEmployeesCountByGenderByIdCompany(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<LookupValue> genderList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByGenderByIdCompany", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                LookupValue lvGender = new LookupValue();

                                lvGender.IdLookupValue = Convert.ToInt32(empReader["IdLookupValue"]);

                                if (empReader["Value"] != DBNull.Value)
                                    lvGender.Value = Convert.ToString(empReader["Value"]);

                                if (empReader["HtmlColor"] != DBNull.Value)
                                    lvGender.HtmlColor = Convert.ToString(empReader["HtmlColor"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                    lvGender.Count = Convert.ToUInt64(empReader["EmployeeCount"]);

                                genderList.Add(lvGender);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesHeadCountByDepartmentByIdCompany(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return genderList;
        }


        /// <summary>
        /// This method is to get employee count related to contract and company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <param name="idCompanies">Get selected companies id.</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of contract situation</returns>
        public List<ContractSituation> GetEmployeesCountByContractByIdCompany(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<ContractSituation> contractSituations = new List<ContractSituation>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByContractByIdCompany", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                ContractSituation contractSituation = new ContractSituation();

                                contractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);

                                if (empReader["Name"] != DBNull.Value)
                                    contractSituation.Name = Convert.ToString(empReader["Name"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                    contractSituation.EmployeeCount = Convert.ToUInt64(empReader["EmployeeCount"]);

                                contractSituations.Add(contractSituation);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByContractByIdCompany(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return contractSituations;
        }


        /// <summary>
        /// This method  is to get employees count related department area and companies
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <param name="idCompanies">Get selected companies</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of count in department related companies</returns>
        public List<LookupValue> GetEmployeesCountByDepartmentAreaByIdCompany(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByDeptAreaByIdCompany", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                LookupValue lvDepartmentArea = new LookupValue();

                                lvDepartmentArea.IdLookupValue = Convert.ToInt32(empReader["IdLookupValue"]);

                                if (empReader["Value"] != DBNull.Value)
                                    lvDepartmentArea.Value = Convert.ToString(empReader["Value"]);

                                if (empReader["HtmlColor"] != DBNull.Value)
                                    lvDepartmentArea.HtmlColor = Convert.ToString(empReader["HtmlColor"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                {
                                    lvDepartmentArea.Count = Convert.ToUInt64(empReader["EmployeeCount"]);
                                    lvDepartmentArea.CountValue = Convert.ToDecimal(empReader["EmployeeCount"]);
                                }

                                departmentAreaList.Add(lvDepartmentArea);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByDepartmentAreaByIdCompany(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return departmentAreaList;
        }

        /// <summary>
        /// This method is to get employees count related to job position and selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <param name="idCompanies">Get selected id companies</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of jobdescription with employee count</returns>
        public List<JobDescription> GetEmployeesCountByJobPositionByIdCompany(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpHeadcountByJobPositionByIdCompany", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                JobDescription jobDescription = new JobDescription();

                                jobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJd"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                {
                                    jobDescription.EmployeeCount = Convert.ToUInt64(empReader["EmployeeCount"]);
                                    jobDescription.EmployeeRecordCount = Convert.ToDecimal(empReader["EmployeeCount"]);
                                }

                                jobDescriptions.Add(jobDescription);

                                //jobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);

                                //if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                //    jobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                //if (empReader["EmployeeCount"] != DBNull.Value)
                                //    jobDescription.EmployeeCount = Convert.ToUInt64(empReader["EmployeeCount"]);

                                //jobDescriptions.Add(jobDescription);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByJobPositionByIdCompany(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            List<JobDescription> jdLengthOfService = GetLengthOfServiceByJobPosition(workbenchConnectionString, idCompanies, selectedPeriod);

            foreach (JobDescription jd in jobDescriptions)
            {
                if (jdLengthOfService.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.YearsCount = jdLengthOfService.FirstOrDefault(x => x.IdJobDescription == jd.IdJobDescription).YearsCount;
                    jdLengthOfService.Remove(jdLengthOfService.FirstOrDefault(x => x.IdJobDescription == jd.IdJobDescription));
                }
            }

            if (jdLengthOfService.Count > 0)
            {
                jobDescriptions.AddRange(jdLengthOfService);
            }

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get length of service related job position
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (edemp_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of job description with length of service</returns>
        public List<JobDescription> GetLengthOfServiceByJobPosition(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetLengthOfServiceByJobPosition", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            JobDescription jobDescription = new JobDescription();

                            jobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);

                            if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                jobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                            if (empReader["JobDescriptionCode"] != DBNull.Value)
                                jobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);

                            if (empReader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(empReader["Abbreviation"]);

                            if (empReader["Years"] != DBNull.Value)
                                jobDescription.YearsCount = Convert.ToDecimal(empReader["Years"]);

                            jobDescriptions.Add(jobDescription);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetLengthOfServiceByJobPosition(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return jobDescriptions;
        }


        /// <summary>
        /// This method is to get employees count related to selected id companies
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db.)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of companies with employee count</returns>
        public List<Company> GetEmployeesCountByIdCompany(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Company> companies = new List<Company>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByIdCompany", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                    {
                        while (empReader.Read())
                        {
                            try
                            {
                                Company company = new Company();

                                company.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                if (empReader["Name"] != DBNull.Value)
                                {
                                    company.Name = Convert.ToString(empReader["Name"]);
                                    company.Alias = Convert.ToString(empReader["Alias"]);
                                }

                                if (empReader["EmpCount"] != DBNull.Value)
                                    company.EmployeesCount = Convert.ToUInt32(empReader["EmpCount"]);

                                companies.Add(company);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByIdCompany(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }

            return companies;
        }

        /// <summary>
        /// This method is to get length of service related to department
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of department with length of service</returns>
        public List<Department> GetLengthOfServiceByDepartment(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Department> departments = new List<Department>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetLengthOfServiceByDepartment", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Department department = new Department();

                            department.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                            if (empReader["DepartmentName"] != DBNull.Value)
                                department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                            if (empReader["DepartmentHtmlColor"] != DBNull.Value)
                                department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);

                            if (empReader["Years"] != DBNull.Value)
                                department.YearsCount = Convert.ToDecimal(empReader["Years"]);

                            departments.Add(department);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetLengthOfServiceByDepartment(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            List<Department> EmpHeadCountByDept = GetEmployeesHeadCountByDepartmentByIdCompany(workbenchConnectionString, idCompanies, selectedPeriod);

            foreach (Department item in departments)
            {
                if (EmpHeadCountByDept.Any(x => x.IdDepartment == item.IdDepartment))
                {
                    item.EmployeesCount = EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment).EmployeesCount;
                    item.EmployeesRecordCount = EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment).EmployeesRecordCount;
                    EmpHeadCountByDept.Remove(EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment));
                }
            }

            if (EmpHeadCountByDept.Count > 0)
            {
                departments.AddRange(EmpHeadCountByDept);
            }

            return departments;
        }

        /// <summary>
        /// This method is to get all employees for leave related to selected id companies
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image file path</param>
        /// <param name="idCompany">Get selected id companies</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeesForLeaveByIdCompany(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForLeaveByIdCompany", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IdEmployeeJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(empReader["IdEmployeeJobDescription"]);

                                if (empReader["IdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);
                                    employee.EmployeeJobDescription.Company = new Company();
                                    employee.EmployeeJobDescription.Company.IdCompany = Convert.ToInt32(empReader["IdCompany"]);
                                    if (empReader["CompanyAlias"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobDescription.Company.Alias = Convert.ToString(empReader["CompanyAlias"]);
                                    }
                                }

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);
                                    employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                    employee.EmployeeJobDescription.JobDescription.IdJobDescription = employee.EmployeeJobDescription.IdJobDescription;
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                    if (empReader["IdDepartment"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                                        employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employee.EmployeeJobDescription.JobDescription.Department.IdDepartment = employee.EmployeeJobDescription.JobDescription.IdDepartment;
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);
                                    }
                                }
                            }

                            employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForLeaveByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employees;
        }

        /// <summary>
        /// This method is to add job description
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="EmpJobDescriptionsFilesPath">Get employee job description file path</param>
        /// <param name="jobDescription">Get job description details</param>
        /// <returns>Job description details</returns>
        public JobDescription AddJobDescription(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);

                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);

                        jobDescription.IdJobDescription = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddJobDescription(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        /// <summary>
        /// This method is to update job description details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="EmpJobDescriptionsFilesPath">Get employee job description file path</param>
        /// <param name="jobDescription">Get job description details</param>
        /// <returns>updated Job description details</returns>
        public JobDescription UpdateJobDescription(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdJobDescription", jobDescription.IdJobDescription);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);

                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (!string.IsNullOrEmpty(jobDescription.OldJobDescriptionCode) && !string.IsNullOrEmpty(jobDescription.JobDescriptionCode) && jobDescription.JobDescriptionCode != jobDescription.OldJobDescriptionCode)
                    {
                        string oldFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.OldJobDescriptionCode);
                        string newFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.JobDescriptionCode);

                        if (fileMgr.FileExists(oldFileName))
                            fileMgr.Move(oldFileName, newFileName);
                    }

                    if (jobDescription.IsJobDescriptionFileUpdated && jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateJobDescription(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        /// <summary>
        /// This method is to save job description file
        /// </summary>
        /// <param name="EmpJobDescriptionsFilesPath">Get employee job description file path</param>
        /// <param name="jobDescription">Get job description details</param>
        /// <returns>If true saved job description file otherwise false</returns>
        public bool SaveJobDescriptionFile(string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            if (jobDescription.JobDescriptionCode != null)
            {
                try
                {
                    if (!Directory.Exists(EmpJobDescriptionsFilesPath))
                    {
                        Directory.CreateDirectory(EmpJobDescriptionsFilesPath);
                    }

                    string filePath = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.JobDescriptionCode);
                    File.WriteAllBytes(filePath, jobDescription.JobDescriptionFileInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveJobDescriptionFile()-Filename - {0}. ErrorMessage- {1}", jobDescription.JobDescriptionCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }


        /// <summary>
        /// This method is to get all company works
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <returns>List of company work details</returns>
        public List<CompanyWork> GetAllCompanyWorks(string workbenchConnectionString)
        {
            List<CompanyWork> companyWorks = new List<CompanyWork>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyWorks", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyWork companyWork = new CompanyWork();

                            if (reader["IdCompanyWork"] != DBNull.Value)
                                companyWork.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"]);

                            if (reader["IdCompany"] != DBNull.Value)
                                companyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Name"] != DBNull.Value)
                                companyWork.Name = Convert.ToString(reader["Name"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                companyWork.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            companyWorks.Add(companyWork);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyWorks(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyWorks;
        }

        /// <summary>
        /// This method is to get all company work related to company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected id companies</param>
        /// <returns>List of company work details</returns>
        public List<CompanyWork> GetAllCompanyWorksByIdCompany(string workbenchConnectionString, string idCompanies)
        {
            List<CompanyWork> companyWorks = new List<CompanyWork>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyWorksByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompanies);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyWork companyWork = new CompanyWork();

                            if (reader["IdCompanyWork"] != DBNull.Value)
                                companyWork.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"]);

                            if (reader["IdCompany"] != DBNull.Value)
                                companyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Name"] != DBNull.Value)
                                companyWork.Name = Convert.ToString(reader["Name"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                companyWork.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            companyWorks.Add(companyWork);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyWorks(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyWorks;
        }


        /// <summary>
        /// This method is to get employee leave related to employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get selected company ids</param>
        /// <returns>List of employee annual leave details</returns>
        public List<EmployeeAnnualLeave> GetEmployeeLeaveByIdEmployee(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod, string idCompany)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();
            Dictionary<Int32, TimeSpan> leaveInHoilday = new Dictionary<Int32, TimeSpan>();

            if (idCompany != null)
                leaveInHoilday = GetAllEmpLeavesByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAnnualLeave.Employee = new Employee();
                                    employeeAnnualLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeAnnualLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAnnualLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAnnualLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAnnualLeave.Employee.CompanyShift = new CompanyShift();
                                        employeeAnnualLeave.Employee.CompanyShift.IdCompanyShift = employeeAnnualLeave.Employee.IdCompanyShift;

                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                        {
                                            employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule;

                                            if (reader["ScheduleYear"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["ScheduleYear"]);

                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);

                                            if (reader["WorkingDays"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        }
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave = new CompanyLeave();
                                    employeeAnnualLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave.Name = reader["Name"].ToString();
                                    employeeAnnualLeave.CompanyLeave.HtmlColor = reader["HtmlColor"].ToString();
                                    if (reader["Position"] != DBNull.Value)
                                        employeeAnnualLeave.CompanyLeave.Position = Convert.ToUInt64(reader["Position"]);
                                }

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeave.TotalHoursCount = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;
                                employeeAnnualLeaves.Add(employeeAnnualLeave);

                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave eal = employeeAnnualLeaves.FirstOrDefault(x => x.IdLeave == Convert.ToInt64(reader["IdLeave"]));

                                if (eal != null)
                                {

                                    if (leaveInHoilday != null)
                                    {
                                        if (leaveInHoilday.Any(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])))
                                        {
                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                            {
                                                TimeSpan ts = new TimeSpan();
                                                ts = leaveInHoilday.Where(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])).FirstOrDefault().Value;

                                                if (reader["EnjoyedHours"] != DBNull.Value)
                                                    eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]) - (Convert.ToDecimal(reader["DailyHoursCount"]) * Convert.ToDecimal(ts.Days));
                                                else
                                                    eal.Enjoyed = 0;
                                            }
                                        }
                                        else
                                        {
                                            if (reader["EnjoyedHours"] != DBNull.Value)
                                                eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                            else
                                                eal.Enjoyed = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (reader["EnjoyedHours"] != DBNull.Value)
                                            eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                        else
                                            eal.Enjoyed = 0;
                                    }

                                    eal.Remaining = (eal.RegularHoursCount + eal.AdditionalHoursCount) - eal.Enjoyed;
                                }
                            }
                        }

                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeaves;
        }

        /// <summary>
        /// This method is to get employee leave for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies id</param>
        /// <param name="selectedPeriod"> Get selected period</param>
        /// <returns>List of employee leaves details</returns>
        public List<EmployeeLeave> GetEmployeeLeavesForDashboard(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesForDashboard", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeLeave.Employee = new Employee();
                                employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["IdLeave"] != DBNull.Value)
                            {
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                employeeLeave.CompanyLeave = new CompanyLeave();
                                employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesForDashboard(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }


        /// <summary>
        /// This method is to get employee documents expiration for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee document details</returns>
        public List<EmployeeDocument> GetEmployeeDocumentsExpirationForDashboard(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<EmployeeDocument> employeeDocuments = new List<EmployeeDocument>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeDocumentsExpirationForDashboard", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeDocument employeeDocument = new EmployeeDocument();

                            if (reader["IdEmployeeDocument"] != DBNull.Value)
                                employeeDocument.IdEmployeeDocument = Convert.ToUInt64(reader["IdEmployeeDocument"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeDocument.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeDocument.Employee = new Employee();
                                employeeDocument.Employee.IdEmployee = employeeDocument.IdEmployee;
                                employeeDocument.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeDocument.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["EmployeeDocumentName"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentName = Convert.ToString(reader["EmployeeDocumentName"]);

                            if (reader["EmployeeDocumentIdType"] != DBNull.Value)
                            {
                                employeeDocument.EmployeeDocumentIdType = Convert.ToInt32(reader["EmployeeDocumentIdType"]);

                                employeeDocument.EmployeeDocumentType = new LookupValue();
                                employeeDocument.EmployeeDocumentType.IdLookupValue = employeeDocument.EmployeeDocumentIdType;
                                employeeDocument.EmployeeDocumentType.Value = Convert.ToString(reader["Value"]);
                                employeeDocument.EmployeeDocumentType.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            if (reader["EmployeeDocumentNumber"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                            if (reader["EmployeeDocumentIssueDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentIssueDate = Convert.ToDateTime(reader["EmployeeDocumentIssueDate"]);

                            if (reader["EmployeeDocumentExpiryDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentExpiryDate = Convert.ToDateTime(reader["EmployeeDocumentExpiryDate"]);

                            employeeDocuments.Add(employeeDocument);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDocumentsExpirationForDashboard(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeDocuments;
        }

        /// <summary>
        /// This method is to get latest contract expiration for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List employee contract situation details</returns>
        public List<EmployeeContractSituation> GetLatestContractExpirationForDashboard(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<EmployeeContractSituation> employeeContracts = new List<EmployeeContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithLatestContractExpiration", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeContractSituation employeeContract = new EmployeeContractSituation();

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeContract.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeContract.Employee = new Employee();
                                employeeContract.Employee.IdEmployee = employeeContract.IdEmployee;
                                employeeContract.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeContract.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["ExpirationDate"] != DBNull.Value)
                                employeeContract.ContractSituationEndDate = Convert.ToDateTime(reader["ExpirationDate"]);

                            employeeContracts.Add(employeeContract);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestContractExpirationForDashboard(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContracts;
        }

        /// <summary>
        /// Get employees with anniversarydate
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="idCompany">The idcompany</param>
        /// <param name="selectedPeriod">The selected period</param>
        /// <returns>The list of employees.</returns>
        public List<Employee> GetEmployeesWithAnniversaryDate(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithAnniversaryDate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            employee.FirstName = Convert.ToString(reader["FirstName"]);
                            employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["AnniversaryDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(reader["AnniversaryDate"]);
                                employee.DateOfBirth = employee.BirthDate;

                                employee.LengthOfService = Convert.ToInt32(reader["AnniversaryYear"]);
                            }

                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesWithAnniversaryDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// Get employees with exitdate for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="idCompany">The idcompany</param>
        /// <param name="selectedPeriod">The selected period</param>
        /// <returns>The list of employees</returns>
        public List<Employee> GetEmployeesWithExitDateForDashboard(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithExitDateForDashboard", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            employee.FirstName = Convert.ToString(reader["FirstName"]);
                            employee.LastName = Convert.ToString(reader["LastName"]);

                            employee.ExitDate = Convert.ToDateTime(reader["ExitDate"]);

                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesWithExitDateForDashboard(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// Get organization hierarchy
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="idCompany">The idcompany</param>
        /// <param name="selectedPeriod">The selected period.</param>
        /// <returns>The list of job descriptions</returns>
        public List<JobDescription> GetOrganizationHierarchy(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<JobDescription> jobDescriptions = GetAllJobDescriptionsHeirarchy(workbenchConnectionString);

            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesOrganizationHierarchy", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();

                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeJobDescription.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                if (reader["JobDescriptionUsage"] != DBNull.Value)
                                    employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                employeeJobDescription.Employee = new Employee();
                                employeeJobDescription.Employee.IdEmployee = employeeJobDescription.IdEmployee;
                                employeeJobDescription.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeJobDescription.Employee.LastName = Convert.ToString(reader["LastName"]);
                                employeeJobDescription.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                employeeJobDescriptions.Add(employeeJobDescription);
                            }
                        }
                        employeeJobDescriptions = employeeJobDescriptions.OrderBy(x => x.Employee.FullName).ToList();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOrganizationHierarchy(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (JobDescription jd in jobDescriptions)
            {
                if (employeeJobDescriptions.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    jd.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == jd.IdJobDescription));
                }

                if (jd.ChildJobDescriptions != null)
                {
                    foreach (var itemJD in jd.ChildJobDescriptions)
                    {
                        if (employeeJobDescriptions.Any(x => x.IdJobDescription == itemJD.IdJobDescription))
                        {
                            itemJD.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                            itemJD.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == itemJD.IdJobDescription));
                            jd.IsEmployeeExistInChildJD = true;
                        }
                    }
                }
            }

            jobDescriptions = IsChildJobDescriptionExistEmployee(jobDescriptions);

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get child job description exist employee
        /// </summary>
        /// <param name="jobDesc">Get job description details</param>
        /// <returns>List of job description details</returns>
        private List<JobDescription> IsChildJobDescriptionExistEmployee(List<JobDescription> jobDesc)
        {
            foreach (JobDescription jobDescription in jobDesc)
            {
                if (jobDescription.ChildJobDescriptions != null)
                {
                    if (jobDescription.ChildJobDescriptions.Count > 0)
                    {
                        jobDescription.IsEmployeeExistInChildJD = IsExistEmp(jobDescription.ChildJobDescriptions, jobDesc);
                    }
                }
            }

            return jobDesc;
        }


        /// <summary>
        /// This method is to check exist employee or not
        /// </summary>
        /// <param name="childJobDesc">List of child job description</param>
        /// <param name="finalJobDesc">List of final job description</param>
        /// <returns>IF TRUE EMPLOYEE EXIST OTHERWISE NO</returns>
        private bool IsExistEmp(List<JobDescription> childJobDesc, List<JobDescription> finalJobDesc)
        {
            if (childJobDesc != null)
            {
                foreach (JobDescription jobDescription in childJobDesc)
                {
                    if (jobDescription.EmployeeJobDescriptions != null)
                    {
                        if (jobDescription.EmployeeJobDescriptions.Count > 0)
                            return true;
                        else
                        {
                            if (finalJobDesc.Any(i => i.IdJobDescription == jobDescription.IdJobDescription))
                            {
                                JobDescription jobdesc = finalJobDesc.Where(i => i.IdJobDescription == jobDescription.IdJobDescription).FirstOrDefault();
                                if (jobdesc.ChildJobDescriptions != null)
                                {
                                    if (jobdesc.ChildJobDescriptions.Count > 0)
                                    {
                                        return IsExistEmp(jobdesc.ChildJobDescriptions, finalJobDesc);
                                    }

                                }
                            }
                        }
                    }
                    else
                    {
                        if (finalJobDesc.Any(i => i.IdJobDescription == jobDescription.IdJobDescription))
                        {
                            JobDescription jobdesc = finalJobDesc.Where(i => i.IdJobDescription == jobDescription.IdJobDescription).FirstOrDefault();
                            if (jobdesc.ChildJobDescriptions != null)
                            {
                                if (jobdesc.ChildJobDescriptions.Count > 0)
                                {
                                    return IsExistEmp(jobdesc.ChildJobDescriptions, finalJobDesc);
                                }
                            }
                        }
                    }
                }
            }
            return false;
        }

        /// <summary>
        /// This method is to get all job description heirarchy
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <returns>List of job description details</returns>
        public List<JobDescription> GetAllJobDescriptionsHeirarchy(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllJobDescriptionHeirarchy", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            jobDescription.ChildJobDescriptions = new List<JobDescription>();
                            jobDescriptions.Add(jobDescription);
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {

                                if (jobDescriptions.Any(i => i.IdJobDescription == Convert.ToUInt32(reader["IdParent"])))
                                {
                                    JobDescription JD = jobDescriptions.Where(i => i.IdJobDescription == Convert.ToUInt32(reader["IdParent"])).FirstOrDefault();

                                    JobDescription childJD = new JobDescription();
                                    if (reader["IdJobDescription"] != DBNull.Value)
                                        childJD.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                    childJD.JobDescriptionCode = reader["JobDescriptionCode"].ToString();
                                    childJD.JobDescriptionTitle = reader["JobDescriptionTitle"].ToString();
                                    if (reader["IdParent"] != DBNull.Value)
                                        childJD.IdParent = Convert.ToUInt32(reader["IdParent"]);

                                    JD.ChildJobDescriptions.Add(childJD);
                                }

                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptionsHeirarchy(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        /// <summary>
        /// [cpatil] Get cities by idcountry
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="idCountry">The idcountry</param>
        /// <returns>The list of city.</returns>
        public List<City> GetAllCitiesByIdCountry(string workbenchConnectionString, byte idCountry)
        {
            List<City> cities = new List<City>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCitiesByIdCountry", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCountry", idCountry);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            City city = new City();

                            if (reader["IdCity"] != DBNull.Value)
                                city.IdCity = Convert.ToInt64(reader["IdCity"]);

                            city.Name = Convert.ToString(reader["Name"]);

                            if (reader["IdCountry"] != DBNull.Value)
                                city.IdCountry = Convert.ToByte(reader["IdCountry"]);

                            cities.Add(city);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCitiesByIdCountry(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return cities;
        }

        /// <summary>
        /// Get all company shifts
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <returns>The list of company shift.</returns>
        public List<CompanyShift> GetAllCompanyShifts(string workbenchConnectionString, string idCompany = null)
        {
            List<CompanyShift> companyShifts = new List<CompanyShift>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyShifts", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyShift companyShift = new CompanyShift();

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanySchedule = new CompanySchedule();
                                companyShift.CompanySchedule.IdCompanySchedule = companyShift.IdCompanySchedule;
                                companyShift.CompanySchedule.Name = Convert.ToString(reader["Name"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                    companyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                            }

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                            companyShifts.Add(companyShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyShifts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShifts;
        }

        /// <summary>
        /// Get company schedule and company shifts.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <returns>The list of comapny schedules.</returns>
        public List<CompanySchedule> GetCompanyScheduleAndCompanyShifts(string workbenchConnectionString, string idCompany = null)
        {
            List<CompanySchedule> companyScheduleList = new List<CompanySchedule>();

            CompanySchedule companyScheduleDefault = new CompanySchedule();
            companyScheduleDefault.Name = "---";
            companyScheduleDefault.CompanyShifts = new List<CompanyShift>() { new CompanyShift() };
            companyScheduleList.Add(companyScheduleDefault);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyShifts", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanySchedule companySchedule = null;

                            if (!companyScheduleList.Any(x => x.IdCompanySchedule == Convert.ToInt32(reader["IdCompanySchedule"])))
                            {
                                companySchedule = new CompanySchedule();
                                companySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companySchedule.Name = Convert.ToString(reader["Name"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                    companySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                companyScheduleList.Add(companySchedule);
                            }
                            else
                            {
                                companySchedule = companyScheduleList.FirstOrDefault(x => x.IdCompanySchedule == Convert.ToInt32(reader["IdCompanySchedule"]));
                            }

                            if (companySchedule != null)
                            {
                                if (companySchedule.CompanyShifts == null)
                                    companySchedule.CompanyShifts = new List<CompanyShift>() { new CompanyShift() };

                                CompanyShift companyShift = new CompanyShift();
                                companyShift.IdCompanySchedule = companySchedule.IdCompanySchedule;

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                    companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                if (reader["CompanyShiftName"] != DBNull.Value)
                                    companyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                if (reader["StartTime1"] != DBNull.Value)
                                    companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                                if (reader["EndTime1"] != DBNull.Value)
                                    companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                                if (reader["BreakTime"] != DBNull.Value)
                                    companyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                companySchedule.CompanyShifts.Add(companyShift);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyScheduleAndCompanyShifts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyScheduleList;
        }

        /// <summary>
        /// [001][skhade][2018-08-22][HRM M045-13] Changes in Organization Print option.
        /// This is to get percentage of department area in company.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="idCompanies">The id companies</param>
        /// <param name="selectedPeriod">The selectedperiod</param>
        /// <returns>The list of dept area</returns>
        public List<LookupValue> GetOrganizationalChartDepartmentArea(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<LookupValue> departmentAreaList = GetEmployeesCountByDepartmentAreaByIdCompany(workbenchConnectionString, idCompanies, selectedPeriod);

            double total = departmentAreaList.Sum(y => Convert.ToDouble(y.Count));
            foreach (LookupValue item in departmentAreaList)
            {
                item.Percentage = Math.Round((item.Count / total) * 100);
            }

            List<LookupValue> departmentAreaAvgList = GetEmployeesAverageByDepartmentAreaByIdCompany(workbenchConnectionString, idCompanies, selectedPeriod);

            double totalAvg = Convert.ToDouble(departmentAreaAvgList.Sum(x => x.Average));
            foreach (LookupValue item in departmentAreaAvgList)
            {
                LookupValue lv = departmentAreaList.FirstOrDefault(x => x.IdLookupValue == item.IdLookupValue);

                if (lv != null)
                {
                    //lv.Average = item.Average;
                    lv.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                }
                else
                {
                    item.Percentage = 0;
                    item.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                    departmentAreaList.Add(item);
                }
            }

            return departmentAreaList;
        }

        /// <summary>
        /// [001][skhade][2018-08-22][HRM M045-13] Changes in Organization Print option.
        /// [001] Added avg and percentage for organization.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="idCompanies">The id companies</param>
        /// <param name="selectedPeriod">The selectedperiod</param>
        /// <returns>The list of dept area.</returns>
        public List<LookupValue> GetEmployeesAverageByDepartmentAreaByIdCompany(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpAvgByDeptAreaByIdCompany", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = empCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            LookupValue lvDepartmentArea = new LookupValue();

                            lvDepartmentArea.IdLookupValue = Convert.ToInt32(reader["IdLookupValue"]);

                            if (reader["Value"] != DBNull.Value)
                                lvDepartmentArea.Value = Convert.ToString(reader["Value"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                lvDepartmentArea.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            if (reader["AvgEmployees"] != DBNull.Value)
                                lvDepartmentArea.Average = Convert.ToDouble(reader["AvgEmployees"]);

                            departmentAreaList.Add(lvDepartmentArea);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesAverageByDepartmentAreaByIdCompany(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return departmentAreaList;
        }

        /// <summary>
        /// [001][skhade][2018-08-22] [HRM M045-14] Email notification to IT when some employee leave the company
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string.</param>
        /// <param name="idCompanies">The id companies</param>
        /// <param name="selectedPeriod">The selected period.</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetITEmployeeDetails(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetITEmployeeEmails", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = empCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            if (reader["IdEmployee"] != DBNull.Value)
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["CompanyPhone"] != DBNull.Value)
                                employee.EmployeeContactEmail = Convert.ToString(reader["CompanyPhone"]);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetITEmployeeDetails(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employees;
        }

        /// <summary>
        /// [001][skhade][2018-08-22][HRM M045-15] New automatic report for birthdays
        /// [001] This method is used to get today employees birthdays and send mail to employee and cc department employees
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="employeesProfileImagePath">The employees profile image path</param>
        /// <param name="selectedPeriod">The selected period</param>
        /// <returns>The list of employees.</returns>
        public List<Employee> GetTodayBirthdayOfEmployees(string workbenchConnectionString, string employeesProfileImagePath, long selectedPeriod = 0, DateTime? currentDate = null)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetTodayBirthdayOfEmployees", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeJDByIdEmployee", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                MySqlCommand emailMySqlCommand = new MySqlCommand("Hrm_GetDepartmentEmployeeEmailsByEmpId", mySqlConnection);
                emailMySqlCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);

                            if (empReader["Birthday"] != DBNull.Value)
                                employee.DateOfBirth = Convert.ToDateTime(empReader["Birthday"]);

                            if (empReader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                            if (empReader["CompanyEmails"] != DBNull.Value)
                                employee.EmployeeContactEmail = Convert.ToString(empReader["CompanyEmails"]);

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetTodayBirthdayOfEmployees(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }

                foreach (Employee employee in employees)
                {
                    employee.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    mySqlCommand.Parameters.Clear();
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeJobDescription ejd = new EmployeeJobDescription();

                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    ejd.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    ejd.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                {
                                    ejd.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    ejd.Company = new Company();
                                    ejd.Company.IdCompany = ejd.IdCompany;
                                    ejd.Company.Name = Convert.ToString(reader["Name"]);
                                    ejd.Company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);
                                }

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    ejd.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                    ejd.JobDescription = new JobDescription();
                                    ejd.JobDescription.IdJobDescription = ejd.IdJobDescription;
                                    ejd.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["IdJobDescription"] != DBNull.Value)
                                        ejd.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                }

                                employee.EmployeeJobDescriptions.Add(ejd);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetTodayBirthdayOfEmployees(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }

                    employee.EmployeeContactCompanyEmailList = new List<string>();

                    //List<string> emails = new List<string>();

                    //var Companies = employee.EmployeeJobDescriptions.GroupBy(x => x.IdCompany);
                    //string idCompanies = String.Join(",", Companies.ToList().Select(x => x.Key));

                    //var departments = employee.EmployeeJobDescriptions.GroupBy(x => x.JobDescription.IdDepartment);
                    //string idDepartments = String.Join(",", departments.ToList().Select(x => x.Key));

                    //emailMySqlCommand.Parameters.Clear();
                    //emailMySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                    //emailMySqlCommand.Parameters.AddWithValue("_IdDepartments", idDepartments);
                    //using (MySqlDataReader reader = emailMySqlCommand.ExecuteReader())
                    //{
                    //    while (reader.Read())
                    //    {
                    //        try
                    //        {
                    //            if (reader["Emails"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(reader["Emails"])))
                    //            {
                    //                emails.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                    //            }
                    //        }
                    //        catch (Exception ex)
                    //        {
                    //            Log4NetLogger.Logger.Log(string.Format("Error GetTodayBirthdayOfEmployees(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    //            throw;
                    //        }
                    //    }
                    //}

                    //employee.EmployeeContactCompanyEmailList = emails.Distinct().OrderBy(q => q).ToList();
                }
            }

            return employees;
        }

        /// <summary>
        /// [001][2018-08-22][skhade] HRM M045-16 New automatic report for company holidays
        /// [001] The upcoming company holidays.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="emails">The emails list.</param>
        /// <returns>The list of company holidays.</returns>
        public List<CompanyHoliday> GetUpcomingCompanyHolidays(string workbenchConnectionString, ref List<string> emails, DateTime? currentDate = null)
        {
            List<CompanyHoliday> companyHolidays = new List<CompanyHoliday>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetUpcomingCompanyHolidays", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["StartDate"] != DBNull.Value && reader["EndDate"] != DBNull.Value)
                                {
                                    DateTime start = Convert.ToDateTime(reader["StartDate"]).Date;
                                    DateTime end = Convert.ToDateTime(reader["EndDate"]).Date;

                                    for (var day = start.Date; day.Date <= end.Date; day = day.AddDays(1))
                                    {
                                        int result = DateTime.Compare(day, DateTime.Now.Date);

                                        if (result < 0)        //day is the earlier than today
                                        {
                                            continue;
                                        }

                                        CompanyHoliday companyHoliday = new CompanyHoliday();

                                        if (reader["IdCompanyHoliday"] != DBNull.Value)
                                            companyHoliday.IdCompanyHoliday = Convert.ToUInt64(reader["IdCompanyHoliday"]);

                                        if (reader["IdCompany"] != DBNull.Value)
                                        {
                                            companyHoliday.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                            companyHoliday.Company = new Company();
                                            companyHoliday.Company.IdCompany = companyHoliday.IdCompany;

                                            if (reader["CompanyName"] != DBNull.Value)
                                                companyHoliday.Company.Name = Convert.ToString(reader["CompanyName"]);

                                            if (reader["Alias"] != DBNull.Value)
                                                companyHoliday.Company.Alias = Convert.ToString(reader["Alias"]);

                                            if (reader["TimeZoneIdentifier"] != DBNull.Value)
                                                companyHoliday.Company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);
                                        }

                                        if (reader["HolidayName"] != DBNull.Value)
                                            companyHoliday.Name = Convert.ToString(reader["HolidayName"]);

                                        if (reader["IdHoliday"] != DBNull.Value)
                                            companyHoliday.IdHoliday = Convert.ToInt32(reader["IdHoliday"]);

                                        if (reader["IsRecursive"] != DBNull.Value)
                                            companyHoliday.IsRecursive = Convert.ToByte(reader["IsRecursive"]);

                                        companyHoliday.StartDate = day;
                                        companyHoliday.EndDate = day;

                                        if (result == 0)        //day is the same time as today
                                        {
                                            companyHolidays.Add(companyHoliday);
                                        }
                                        else if (result > 0 && (day - DateTime.Now.Date).TotalDays <= 7)    //day is later than today & <= 7 days
                                        {
                                            companyHolidays.Add(companyHoliday);
                                        }
                                    }
                                }
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                try
                                {
                                    if (reader["Emails"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(reader["Emails"])))
                                    {
                                        emails.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingCompanyHolidays(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }

                            emails = emails.Distinct().OrderBy(q => q).ToList();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingCompanyHolidays(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyHolidays;
        }

        /// <summary>
        /// This is used to get upcoming employee leaves for weekly mail.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbnech connection string</param>
        /// <param name="idCompany">The Idcompany</param>
        /// <param name="ToEmailList">The To emails list</param>
        /// <param name="ccEmailList">The CC emails list.</param>
        /// <returns>The list of employee list.</returns>
        public List<EmployeeLeave> GetUpcomingEmployeeLeaves(string workbenchConnectionString, Int32 idCompany, ref List<string> ToEmailList, ref List<string> ccEmailList, DateTime? currentDate = null)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetUpcomingEmployeeLeaves", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["StartDate"] != DBNull.Value && reader["EndDate"] != DBNull.Value)
                                {
                                    DateTime start = Convert.ToDateTime(reader["StartDate"]);
                                    DateTime end = Convert.ToDateTime(reader["EndDate"]);

                                    for (var day = start.Date; day.Date <= end.Date; day = day.AddDays(1))
                                    {
                                        int result = DateTime.Compare(day, DateTime.Now.Date);

                                        if (result < 0)        //day is the earlier than today
                                        {
                                            continue;
                                        }

                                        EmployeeLeave employeeLeave = new EmployeeLeave();

                                        if (reader["IdEmployeeLeave"] != DBNull.Value)
                                            employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                        if (reader["IdLeave"] != DBNull.Value)
                                        {
                                            employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                            employeeLeave.CompanyLeave = new CompanyLeave();
                                            employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                            employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                        }

                                        if (reader["IdEmployee"] != DBNull.Value)
                                        {
                                            employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                            employeeLeave.Employee = new Employee();
                                            employeeLeave.Employee.IdEmployee = employeeLeave.IdEmployee;
                                            employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                            employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);
                                        }

                                        TimeSpan startSpan = TimeSpan.Zero;
                                        TimeSpan endSpan = TimeSpan.Zero;

                                        if (reader["IsAllDayEvent"] != DBNull.Value)
                                        {
                                            employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                                            if (employeeLeave.IsAllDayEvent == 1)
                                            {
                                                if (reader["IdCompanyShift"] != DBNull.Value)
                                                {
                                                    if (reader["StartTime1"] != DBNull.Value)
                                                        startSpan = (TimeSpan)(reader["StartTime1"]);

                                                    if (reader["EndTime1"] != DBNull.Value)
                                                        endSpan = (TimeSpan)(reader["EndTime1"]);
                                                }
                                                else
                                                {
                                                    startSpan = start.TimeOfDay;
                                                    endSpan = end.TimeOfDay;
                                                }
                                            }
                                            else
                                            {
                                                startSpan = start.TimeOfDay;
                                                endSpan = end.TimeOfDay;
                                            }
                                        }

                                        employeeLeave.StartDate = day.Add(startSpan);
                                        employeeLeave.EndDate = day.Add(endSpan);

                                        if (employeeLeave.StartDate.Value.DayOfWeek == DayOfWeek.Saturday || employeeLeave.StartDate.Value.DayOfWeek == DayOfWeek.Sunday)
                                        {
                                            //No need to add SAT and SUN
                                        }
                                        else if (result == 0)        //day is the same time as today
                                        {
                                            employeeLeaves.Add(employeeLeave);
                                        }
                                        else if (result > 0 && (day - DateTime.Now.Date).TotalDays <= 6)    //day is later than today & <= 7 days
                                        {
                                            employeeLeaves.Add(employeeLeave);
                                        }
                                    }
                                }
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                try
                                {
                                    if (reader["Emails"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(reader["Emails"])))
                                    {
                                        if (Convert.ToUInt32(reader["IdJobDescription"]) == 21)
                                            ToEmailList.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                        else if (Convert.ToUInt32(reader["IdJobDescription"]) == 42)
                                            ccEmailList.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingEmployeeLeaves(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }

                            ToEmailList = ToEmailList.Distinct().OrderBy(q => q).ToList();
                            ccEmailList = ccEmailList.Distinct().OrderBy(q => q).ToList();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingEmployeeLeaves(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        /// <summary>
        /// This method is to add employee attendance from excel
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos db)</param>
        /// <param name="employeeAttendanceList">Get employee attendance details</param>
        /// <returns>If true  Added Employee Attendance From Excel otherwise false</returns>
        public bool AddEmployeeAttendanceFromExcel(string mainServerWorkbenchConnectionString, List<EmployeeAttendance> employeeAttendanceList)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendance_InsertFromExcel", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        foreach (EmployeeAttendance item in employeeAttendanceList)
                        {
                            mySqlCommand.Parameters.Clear();

                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", item.EmployeeCode);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", item.IdCompanyWork);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", item.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", item.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", item.EndDate);

                            mySqlCommand.ExecuteNonQuery();
                        }

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeAttendanceFromExcel(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return true;
        }


        /// <summary>
        /// This method is to get birthdays of employee related to year
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string(emdep_geos db)(</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetBirthdaysOfEmployeesByYear(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetBirthdaysOfEmployeesByYear", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(reader["NativeName"]);

                            if (reader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(reader["BirthDay"]);
                                employee.DateOfBirth = Convert.ToDateTime(reader["BirthDate"]);
                            }

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            //employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetBirthdaysOfEmployeesByYear(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employees;
        }

        /// <summary>
        /// This method is to get job description related to id job description
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idJobDescription">Get job description id</param>
        /// <returns>Get Job description details</returns>
        public JobDescription GetJobDescriptionById(string workbenchConnectionString, UInt32 idJobDescription)
        {
            JobDescription jobDescription = new JobDescription();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetJobDescriptionById", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdJobDescription", idJobDescription);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                            if (reader["IdDepartment"] != DBNull.Value)
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["IdParent"] != DBNull.Value)
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                                jobDescription.ChildOrientation = Convert.ToString(reader["ChildOrientation"]);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetJobDescriptionById(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescription;
        }

        /// <summary>
        /// This method is to check employee enjoyed all annual leave or not
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdpe_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="idEmployeeLeave">Get employee leave id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>If true employee enojyed all annual leaves otherwise false</returns>
        public bool IsEmployeeEnjoyedAllAnnualLeaves(string workbenchConnectionString, Int32 idEmployee, Int32 idEmployeeLeave, long selectedPeriod)
        {
            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEnjoyedLeaveHours", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idEmployeeLeave);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        double Total = 0;
                        double Enjoyed = 0;

                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["Total"] != DBNull.Value)
                                    Total = Total + Convert.ToDouble(reader["Total"]);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                if (reader["EnjoyedHours"] != DBNull.Value)
                                    Enjoyed = Enjoyed + Convert.ToDouble(reader["EnjoyedHours"]);
                            }
                        }

                        if (Enjoyed > Total)
                        {
                            return true;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsEmployeeEnjoyedAllAnnualLeaves(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return false;
        }


        /// <summary>
        /// This method is to get employee shift and daily hours
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="idCompanyShift">Get company shift id</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Company shift details</returns>
        public CompanyShift GetEmployeeShiftandDailyHours(string workbenchConnectionString, Int32 idEmployee, Int32 idCompanyShift, Int32 idCompany, long selectedPeriod)
        {
            CompanyShift companyShift = new CompanyShift();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeShiftandDailyHours", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", idCompanyShift);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                companyShift.CompanyAnnualSchedule.IdCompanySchedule = companyShift.IdCompanySchedule;

                                if (reader["Year"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["DailyHoursCount"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                if (reader["WorkingDays"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                            }

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeShiftandDailyHours(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShift;
        }

        /// <summary>
        /// This method is to get today employee company anniversaries
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image file path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="currentDate">Get current date</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetTodayEmployeeCompanyAnniversaries(string workbenchConnectionString, string employeesProfileImagePath, long selectedPeriod, DateTime? currentDate = null)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetTodayEmployeeCompanyAnniversaries", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["AnniversaryDate"] != DBNull.Value)
                            {
                                employee.EmployeeContractSituation = new EmployeeContractSituation();
                                employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["AnniversaryDate"]);
                            }

                            if (reader["AnniversaryYear"] != DBNull.Value)
                                employee.LengthOfService = Convert.ToInt32(reader["AnniversaryYear"]);

                            if (reader["CompanyEmails"] != DBNull.Value)
                                employee.EmployeeContactEmail = Convert.ToString(reader["CompanyEmails"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                employee.EmployeeJobDescription.Company = new Company();
                                employee.EmployeeJobDescription.Company.IdCompany = employee.EmployeeJobDescription.IdCompany;

                                if (reader["Name"] != DBNull.Value)
                                    employee.EmployeeJobDescription.Company.Name = Convert.ToString(reader["Name"]);

                                if (reader["Alias"] != DBNull.Value)
                                    employee.EmployeeJobDescription.Company.Alias = Convert.ToString(reader["Alias"]);

                                if (reader["TimeZoneIdentifier"] != DBNull.Value)
                                    employee.EmployeeJobDescription.Company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetTodayEmployeeCompanyAnniversaries(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employees;
        }

        /// <summary>
        /// This method is to get today employee company anniversaries
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image file path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="currentDate">Get current date</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetTodayEmployeeCompanyAnniversariesSprint60(string workbenchConnectionString, string employeesProfileImagePath, long selectedPeriod, DateTime? currentDate = null)
        {
            #region
            //List<Employee> employees = new List<Employee>();

            //using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            //{
            //    mySqlConnection.Open();

            //    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetTodayEmployeeCompanyAnniversaries", mySqlConnection);
            //    mySqlCommand.CommandType = CommandType.StoredProcedure;
            //    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
            //    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

            //    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
            //    {
            //        while (reader.Read())
            //        {
            //            try
            //            {
            //                Employee employee = new Employee();

            //                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

            //                if (reader["EmployeeCode"] != DBNull.Value)
            //                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

            //                if (reader["FirstName"] != DBNull.Value)
            //                    employee.FirstName = Convert.ToString(reader["FirstName"]);

            //                if (reader["LastName"] != DBNull.Value)
            //                    employee.LastName = Convert.ToString(reader["LastName"]);

            //                if (reader["AnniversaryDate"] != DBNull.Value)
            //                {
            //                    employee.EmployeeContractSituation = new EmployeeContractSituation();
            //                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["AnniversaryDate"]);
            //                }

            //                if (reader["AnniversaryYear"] != DBNull.Value)
            //                    employee.LengthOfService = Convert.ToInt32(reader["AnniversaryYear"]);

            //                if (reader["CompanyEmails"] != DBNull.Value)
            //                    employee.EmployeeContactEmail = Convert.ToString(reader["CompanyEmails"]);

            //                if (reader["IdCompany"] != DBNull.Value)
            //                {
            //                    employee.EmployeeJobDescription = new EmployeeJobDescription();
            //                    employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);
            //                    employee.EmployeeJobDescription.Company = new Company();
            //                    employee.EmployeeJobDescription.Company.IdCompany = employee.EmployeeJobDescription.IdCompany;

            //                    if (reader["Name"] != DBNull.Value)
            //                        employee.EmployeeJobDescription.Company.Name = Convert.ToString(reader["Name"]);

            //                    if (reader["Alias"] != DBNull.Value)
            //                        employee.EmployeeJobDescription.Company.Alias = Convert.ToString(reader["Alias"]);

            //                    if (reader["TimeZoneIdentifier"] != DBNull.Value)
            //                        employee.EmployeeJobDescription.Company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);
            //                }

            //                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

            //                employees.Add(employee);
            //            }
            //            catch (Exception ex)
            //            {
            //                Log4NetLogger.Logger.Log(string.Format("Error GetTodayEmployeeCompanyAnniversaries(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            //                throw;
            //            }
            //        }
            //    }
            //}

            //return employees;
            #endregion

            List<Employee> employees = new List<Employee>();
            List<Employee> employeesCompletedyears = new List<Employee>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractSituationsByDate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])))
                                    {
                                        employee = employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).FirstOrDefault();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                    }
                                    else
                                    {
                                        employee = new Employee();
                                        employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                        employees.Add(employee);
                                    }
                                }
                            }
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetTodayEmployeeCompanyAnniversariesSprint60(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (Employee employee in employees)
            {

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfServiceByDate(employee.EmployeeContractSituations, currentDate.Value);

                if (employee.LengthOfServiceString != null && Convert.ToInt64(employee.LengthOfServiceString) > 0)
                {
                    employee.LengthOfService = Convert.ToInt32(employee.LengthOfServiceString);
                    employeesCompletedyears.Add(employee);
                }

            }
            List<Employee> companyAnniversaryEmployees = new List<Employee>();
            companyAnniversaryEmployees = GetTodayEmployeeCompanyAnniversariesDetails(workbenchConnectionString, employeesProfileImagePath, employeesCompletedyears, currentDate.Value);
            return companyAnniversaryEmployees;
        }


        /// <summary>
        /// This method is to get employee enjoyed leave hours
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="idEmployeeLeave">Get employee leave id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>Employee annual leave details</returns>
        public EmployeeAnnualLeave GetEmployeeEnjoyedLeaveHours(string workbenchConnectionString, Int32 idEmployee, Int32 idEmployeeLeave, long selectedPeriod, Int32 idCompany = 0)
        {
            EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();
            Dictionary<Int32, TimeSpan> leaveInHoilday = new Dictionary<Int32, TimeSpan>();
            if (idCompany != 0)
                leaveInHoilday = GetAllEmpLeavesByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany.ToString());
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEnjoyedLeaveHours", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idEmployeeLeave);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);


                                if (reader["EnjoyedHours"] != DBNull.Value)
                                {
                                    if (leaveInHoilday != null)
                                    {
                                        if (leaveInHoilday.Any(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])))
                                        {
                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                            {
                                                TimeSpan ts = new TimeSpan();
                                                ts = leaveInHoilday.Where(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])).FirstOrDefault().Value;


                                                employeeAnnualLeave.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]) - (Convert.ToDecimal(reader["DailyHoursCount"]) * Convert.ToDecimal(ts.Days));

                                            }
                                        }
                                        else
                                        {
                                            employeeAnnualLeave.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                        }
                                    }
                                    else
                                    {
                                        employeeAnnualLeave.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                    }

                                    employeeAnnualLeave.Remaining = (employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount) - employeeAnnualLeave.Enjoyed;

                                }

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEnjoyedLeaveHours(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeave;
        }

        /// <summary>
        /// This method is to get all company shift related to company id
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <returns>List of company shift details</returns>
        public List<CompanyShift> GetAllCompanyShiftsByIdCompany(string workbenchConnectionString, string idCompanies = null)
        {
            List<CompanyShift> companyShifts = new List<CompanyShift>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyShiftsByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyShift companyShift = new CompanyShift();

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["ShiftName"] != DBNull.Value)
                                companyShift.Name = Convert.ToString(reader["ShiftName"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanySchedule = new CompanySchedule();
                                companyShift.CompanySchedule.IdCompanySchedule = companyShift.IdCompanySchedule;

                                if (reader["WorkSchedule"] != DBNull.Value)
                                    companyShift.CompanySchedule.Name = Convert.ToString(reader["WorkSchedule"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                {
                                    companyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    companyShift.CompanySchedule.Company = new Company();
                                    companyShift.CompanySchedule.Company.IdCompany = companyShift.CompanySchedule.IdCompany;
                                    companyShift.CompanySchedule.Company.Name = Convert.ToString(reader["CompanyName"]);
                                    companyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["Alias"]);
                                }
                            }

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                            if (reader["Mon"] != DBNull.Value)
                                companyShift.Mon = Convert.ToSByte(reader["Mon"]);

                            if (reader["Tue"] != DBNull.Value)
                                companyShift.Tue = Convert.ToSByte(reader["Tue"]);

                            if (reader["Wed"] != DBNull.Value)
                                companyShift.Wed = Convert.ToSByte(reader["Wed"]);

                            if (reader["Thu"] != DBNull.Value)
                                companyShift.Thu = Convert.ToSByte(reader["Thu"]);

                            if (reader["Fri"] != DBNull.Value)
                                companyShift.Fri = Convert.ToSByte(reader["Fri"]);

                            if (reader["Sat"] != DBNull.Value)
                                companyShift.Sat = Convert.ToSByte(reader["Sat"]);

                            if (reader["Sun"] != DBNull.Value)
                                companyShift.Sun = Convert.ToSByte(reader["Sun"]);

                            companyShifts.Add(companyShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyShiftsByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShifts;
        }


        /// <summary>
        /// This method is to get all company schedules related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected id companies</param>
        /// <returns>List of company schedule details</returns>
        public List<CompanySchedule> GetAllCompanySchedulesByIdCompany(string workbenchConnectionString, string idCompanies = null)
        {
            List<CompanySchedule> companyScheduleList = new List<CompanySchedule>();

            CompanySchedule companyScheduleDefault = new CompanySchedule();
            companyScheduleDefault.Name = "---";
            companyScheduleList.Add(companyScheduleDefault);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanySchedulesByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanySchedule companySchedule = new CompanySchedule();

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                                companySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);

                            if (reader["IdCompany"] != DBNull.Value)
                                companySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Name"] != DBNull.Value)
                                companySchedule.Name = Convert.ToString(reader["Name"]);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanySchedulesByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyScheduleList;
        }

        /// <summary>
        /// This method is to add company shift
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="companyShift">Get company shift details</param>
        /// <returns>Get company shift details</returns>
        public CompanyShift AddCompanyShift(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_StartTime1", companyShift.StartTime1);
                        mySqlCommand.Parameters.AddWithValue("_EndTime1", companyShift.EndTime1);
                        mySqlCommand.Parameters.AddWithValue("_StartTime2", companyShift.StartTime2);
                        mySqlCommand.Parameters.AddWithValue("_EndTime2", companyShift.EndTime2);
                        mySqlCommand.Parameters.AddWithValue("_BreakTime", companyShift.BreakTime);
                        mySqlCommand.Parameters.AddWithValue("_Mon", companyShift.Mon);
                        mySqlCommand.Parameters.AddWithValue("_Tue", companyShift.Tue);
                        mySqlCommand.Parameters.AddWithValue("_Wed", companyShift.Wed);
                        mySqlCommand.Parameters.AddWithValue("_Thu", companyShift.Thu);
                        mySqlCommand.Parameters.AddWithValue("_Fri", companyShift.Fri);
                        mySqlCommand.Parameters.AddWithValue("_Sat", companyShift.Sat);
                        mySqlCommand.Parameters.AddWithValue("_Sun", companyShift.Sun);

                        companyShift.IdCompanyShift = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCompanyShift(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }


        /// <summary>
        /// This methdo is to update company shift
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="companyShift">Get company shift details</param>
        /// <returns>Get company shift details</returns>
        public CompanyShift UpdateCompanyShift(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", companyShift.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_StartTime1", companyShift.StartTime1);
                        mySqlCommand.Parameters.AddWithValue("_EndTime1", companyShift.EndTime1);
                        mySqlCommand.Parameters.AddWithValue("_StartTime2", companyShift.StartTime2);
                        mySqlCommand.Parameters.AddWithValue("_EndTime2", companyShift.EndTime2);
                        mySqlCommand.Parameters.AddWithValue("_BreakTime", companyShift.BreakTime);
                        mySqlCommand.Parameters.AddWithValue("_Mon", companyShift.Mon);
                        mySqlCommand.Parameters.AddWithValue("_Tue", companyShift.Tue);
                        mySqlCommand.Parameters.AddWithValue("_Wed", companyShift.Wed);
                        mySqlCommand.Parameters.AddWithValue("_Thu", companyShift.Thu);
                        mySqlCommand.Parameters.AddWithValue("_Fri", companyShift.Fri);
                        mySqlCommand.Parameters.AddWithValue("_Sat", companyShift.Sat);
                        mySqlCommand.Parameters.AddWithValue("_Sun", companyShift.Sun);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCompanyShift(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }

        /// <summary>
        /// This method is to get employee related company shifts related to employee id
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <returns>List of company shift details</returns>
        public List<CompanyShift> GetEmployeeRelatedCompanyShifts(string workbenchConnectionString, Int32 idEmployee)
        {
            List<CompanyShift> companyShifts = new List<CompanyShift>();

            CompanyShift companyShiftDefault = new CompanyShift();
            companyShiftDefault.Name = "---";
            companyShifts.Add(companyShiftDefault);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeRelatedCompanyShifts", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyShift companyShift = new CompanyShift();

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);

                            if (reader["Name"] != DBNull.Value)
                                companyShift.Name = Convert.ToString(reader["Name"]);

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                            companyShifts.Add(companyShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeRelatedCompanyShifts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShifts;
        }

        /// <summary>
        /// This method is to save employee exit document
        /// </summary>
        /// <param name="employeesExitDocument">Get employee exit document path</param>
        /// <param name="employee">Get employee details</param>
        /// <returns>If true save employee exit document otherwise false</returns>
        public bool SaveEmployeeExitDocument(string employeesExitDocument, Employee employee)
        {
            if (employee.EmployeeExitDocInBytes != null)
            {
                try
                {
                    if (!Directory.Exists(employeesExitDocument + "\\" + employee.EmployeeCode))
                    {
                        Directory.CreateDirectory(employeesExitDocument + "\\" + employee.EmployeeCode);
                    }

                    string imagePath = employeesExitDocument + "\\" + employee.EmployeeCode + "\\" + employee.ExitFileName + ".png";

                    File.WriteAllBytes(imagePath, employee.EmployeeExitDocInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeExitDocument()-Code - {0}. ErrorMessage- {1}", employee.EmployeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is delete employee exit document
        /// </summary>
        /// <param name="employeesExitDocument">Get employee exit document path</param>
        /// <param name="employee">Get employee details</param>
        /// <returns>If true deleted employee exit document otherwise false</returns>
        public bool DeleteEmployeeExitDocument(string employeesExitDocument, Employee employee)
        {
            try
            {
                if (!Directory.Exists(employeesExitDocument + "\\" + employee.EmployeeCode))
                {
                    return false;
                }
                else
                {
                    string imagePath = employeesExitDocument + "\\" + employee.EmployeeCode + "\\" + employee.ExitFileName + ".png";
                    if (File.Exists(imagePath))
                    {
                        File.Delete(imagePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeExitDocument()-Code - {0}. ErrorMessage- {1}", employee.EmployeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }

        /// <summary>
        /// This method is to get employee annual leaves hour count related to id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee annual leave details</returns>
        public List<EmployeeAnnualLeave> GetEmployeeAnnualLeavesHourCountByIdEmployee(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesHourCountByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeaves.Add(employeeAnnualLeave);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave eal = employeeAnnualLeaves.FirstOrDefault(x => x.IdLeave == Convert.ToInt64(reader["IdLeave"]));

                                if (eal != null)
                                {
                                    eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                    eal.Remaining = (eal.RegularHoursCount + eal.AdditionalHoursCount) - eal.Enjoyed;
                                }
                            }
                        }

                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeAnnualLeavesHourCountByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeaves;
        }

        /// <summary>
        /// This method is to get company shift details related to id company shift
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanyShift">Get id company shift</param>
        /// <returns>Get company shift details</returns>
        public CompanyShift GetCompanyShiftDetailByIdCompanyShift(string workbenchConnectionString, Int32 idCompanyShift)
        {
            CompanyShift companyShift = new CompanyShift();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyShiftDetailByIdCompanyShift", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", idCompanyShift);



                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);

                            if (reader["Name"] != DBNull.Value)
                                companyShift.Name = Convert.ToString(reader["Name"]);

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["StartTime2"] != DBNull.Value)
                                companyShift.StartTime2 = (TimeSpan)reader["StartTime2"];

                            if (reader["EndTime2"] != DBNull.Value)
                                companyShift.EndTime2 = (TimeSpan)reader["EndTime2"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                            if (reader["Mon"] != DBNull.Value)
                                companyShift.Mon = Convert.ToSByte(reader["Mon"]);

                            if (reader["Tue"] != DBNull.Value)
                                companyShift.Tue = Convert.ToSByte(reader["Tue"]);

                            if (reader["Wed"] != DBNull.Value)
                                companyShift.Wed = Convert.ToSByte(reader["Wed"]);

                            if (reader["Thu"] != DBNull.Value)
                                companyShift.Thu = Convert.ToSByte(reader["Thu"]);

                            if (reader["Fri"] != DBNull.Value)
                                companyShift.Fri = Convert.ToSByte(reader["Fri"]);

                            if (reader["Sat"] != DBNull.Value)
                                companyShift.Sat = Convert.ToSByte(reader["Sat"]);

                            if (reader["Sun"] != DBNull.Value)
                                companyShift.Sun = Convert.ToSByte(reader["Sun"]);

                            companyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                                companyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);

                            if (reader["IdCompany"] != DBNull.Value)
                                companyShift.CompanyAnnualSchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Year"] != DBNull.Value)
                                companyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                            if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                companyShift.CompanyAnnualSchedule.IdCompanyAnnualSchedule = Convert.ToInt64(reader["IdCompanyAnnualSchedule"]);

                            if (reader["DailyHoursCount"] != DBNull.Value)
                                companyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                companyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);

                            if (reader["WorkingDays"] != DBNull.Value)
                                companyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                        }


                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyShiftDetailByIdCompanyShift(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShift;
        }


        /// <summary>
        /// This method is to update company details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="company">Get company details</param>
        /// <param name="ImagePath">Get image path</param>
        /// <returns>Get company details</returns>
        public Company UpdateCompany(string mainServerWorkbenchConnectionString, Company company, string ImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Companies_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Name", company.Name);
                        mySqlCommand.Parameters.AddWithValue("_RegisteredName", company.RegisteredName);
                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", company.Alias);
                        mySqlCommand.Parameters.AddWithValue("_FiscalName", company.CIF);
                        mySqlCommand.Parameters.AddWithValue("_Size", company.Size);
                        mySqlCommand.Parameters.AddWithValue("_EstablishmentDate", company.EstablishmentDate);
                        mySqlCommand.Parameters.AddWithValue("_Phone", company.Telephone);
                        mySqlCommand.Parameters.AddWithValue("_Email", company.Email);
                        mySqlCommand.Parameters.AddWithValue("_Fax", company.Fax);
                        mySqlCommand.Parameters.AddWithValue("_Website", company.Website);
                        mySqlCommand.Parameters.AddWithValue("_Address", company.Address);
                        mySqlCommand.Parameters.AddWithValue("_City", company.City);
                        mySqlCommand.Parameters.AddWithValue("_Region", company.Region);
                        mySqlCommand.Parameters.AddWithValue("_ZipCode", company.ZipCode);
                        mySqlCommand.Parameters.AddWithValue("_IdCountry", company.IdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", company.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", company.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", company.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                        mySqlCommand.Parameters.AddWithValue("_IdCompany", company.IdCompany);


                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    AddCompanyChangelogs(mainServerWorkbenchConnectionString, company.IdCompany, company.CompanyChangelogs);

                    if (company.ImageInBytes != null && !company.IsImageDeleted)
                        SaveCompanyImage(ImagePath, company);
                    else if (company.IsImageDeleted)
                        DeleteCompanyImage(ImagePath, company);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return company;
        }

        /// <summary>
        /// This method is to save company image
        /// </summary>
        /// <param name="ImagePath">Get image path details</param>
        /// <param name="company">Get company details</param>
        /// <returns>If true save image otherwise false</returns>
        public bool SaveCompanyImage(string ImagePath, Company company)
        {
            if (company.ImageInBytes != null)
            {

                try
                {
                    if (!Directory.Exists(ImagePath))
                    {
                        Directory.CreateDirectory(ImagePath);
                    }

                    string imagePath = ImagePath + company.IdCompany + company.FileExtension;
                    string filepathjpg = ImagePath + company.IdCompany + ".jpg";
                    string filepathpng = ImagePath + company.IdCompany + ".png";
                    if (File.Exists(filepathjpg))
                    {
                        File.Delete(filepathjpg);
                    }
                    if (File.Exists(filepathpng))
                    {
                        File.Delete(filepathpng);
                    }
                    File.WriteAllBytes(imagePath, company.ImageInBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveCompanyImage()-ID - {0}. ErrorMessage- {1}", company.IdCompany, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is to delete company image
        /// </summary>
        /// <param name="ImagePath">Get image path details</param>
        /// <param name="company">Get company details</param>
        /// <returns>If true deleted image otherwise false</returns>
        public bool DeleteCompanyImage(string ImagePath, Company company)
        {
            try
            {
                if (!Directory.Exists(ImagePath))
                {
                    return false;
                }
                else
                {
                    // string imagePath = ImagePath +  company.IdCompany + company.FileExtension;
                    string filepathjpg = ImagePath + company.IdCompany + ".jpg";
                    string filepathpng = ImagePath + company.IdCompany + ".png";
                    if (File.Exists(filepathjpg))
                    {
                        File.Delete(filepathjpg);
                    }
                    if (File.Exists(filepathpng))
                    {
                        File.Delete(filepathpng);
                    }
                    //if (File.Exists(imagePath))
                    //{
                    //    File.Delete(imagePath);
                    //}
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteCompanyImage()- ID - {0}. ErrorMessage- {1}", company.IdCompany, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }


        /// <summary>
        /// This method is to add company change logs
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="companyChangelogs">Get list of company change log details</param>
        public void AddCompanyChangelogs(string mainServerWorkbenchConnectionString, Int32 idCompany, List<CompanyChangelog> companyChangelogs)
        {
            try
            {
                if (companyChangelogs != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (CompanyChangelog companyChangelog in companyChangelogs)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyChangelog_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                            mySqlCommand.Parameters.AddWithValue("_ChangeLogDatetime", DateTime.Now);
                            mySqlCommand.Parameters.AddWithValue("_ChangeLogIdUser", companyChangelog.ChangeLogIdUser);
                            mySqlCommand.Parameters.AddWithValue("_ChangeLogChange", companyChangelog.ChangeLogChange);

                            companyChangelog.IdCompanyChangeLog = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCompanyChangelogs(). IdCompany- {0} ErrorMessage- {1}", idCompany, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to get all employee detail related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="employeeProfileImagePath">Get employee image path</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeeDetailsByIdCompany(string workbenchConnectionString, Int32 idCompany, string employeeProfileImagePath)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeeDetailsByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);



                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                Employee employee = new Employee();

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["MobValue"] != DBNull.Value)
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(reader["MobValue"]);

                                if (reader["EmailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["EmailValue"]);

                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.JobDescription = new JobDescription();

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                employee.EmployeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeeProfileImagePath);
                                employees.Add(employee);

                            }

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeDetailsByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            if (employees.Any(i => i.EmployeeJobDescription.JobDescription.IdJobDescription == 21))
            {
                List<Employee> finalEmployeeList = new List<Employee>();
                List<Employee> perviousEmployeeList = new List<Employee>();
                perviousEmployeeList = employees;
                foreach (Employee itemEmp in employees.Where(i => i.EmployeeJobDescription.JobDescription.IdJobDescription == 21).OrderBy(x => x.FirstName).OrderBy(x => x.LastName))
                {
                    finalEmployeeList.Add(itemEmp);
                    perviousEmployeeList.Remove(itemEmp);
                }
                foreach (Employee itemEmp in perviousEmployeeList.Where(i => i.EmployeeJobDescription.JobDescription.IdJobDescription != 21).OrderBy(x => x.FirstName).OrderBy(x => x.LastName))
                {
                    finalEmployeeList.Add(itemEmp);
                }
                employees = finalEmployeeList;
            }

            return employees;
        }


        /// <summary>
        /// This method is to get all change log related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>List of company change log details</returns>
        public List<CompanyChangelog> GetAllChangeLogByCompanyId(string workbenchConnectionString, Int32 idCompany)
        {
            List<CompanyChangelog> companyChangelogs = new List<CompanyChangelog>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllChangelogByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);



                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            CompanyChangelog companyChangelog = new CompanyChangelog();
                            if (reader["IdCompanyChangeLog"] != DBNull.Value)
                                companyChangelog.IdCompanyChangeLog = Convert.ToUInt64(reader["IdCompanyChangeLog"]);

                            if (reader["ChangeLogDatetime"] != DBNull.Value)
                                companyChangelog.ChangeLogDatetime = Convert.ToDateTime(reader["ChangeLogDatetime"]);

                            if (reader["ChangeLogIdUser"] != DBNull.Value)
                            {
                                companyChangelog.ChangeLogIdUser = Convert.ToInt32(reader["ChangeLogIdUser"]);
                                companyChangelog.ChangeLogUser = new User();
                                companyChangelog.ChangeLogUser.IdUser = Convert.ToInt32(reader["ChangeLogIdUser"]);
                                companyChangelog.ChangeLogUser.FirstName = Convert.ToString(reader["FirstName"]);
                                companyChangelog.ChangeLogUser.LastName = Convert.ToString(reader["LastName"]);
                            }


                            if (reader["ChangeLogChange"] != DBNull.Value)
                                companyChangelog.ChangeLogChange = Convert.ToString(reader["ChangeLogChange"]);



                            companyChangelogs.Add(companyChangelog);

                        }


                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllChangeLogByCompanyId(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyChangelogs;
        }


        /// <summary>
        /// This method is to get company details related company id
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="employeeProfileImagePath">Get employee image path</param>
        /// <returns>Get Company details</returns>
        public Company GetCompanyDetailsByCompanyId(string workbenchConnectionString, Int32 idCompany, string employeeProfileImagePath)
        {
            Company company = new Company();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyDetailsByCompanyId", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);



                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        if (reader.Read())
                        {

                            if (reader["IdCompany"] != DBNull.Value)
                                company.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Name"] != DBNull.Value)
                                company.Name = Convert.ToString(reader["Name"]);

                            if (reader["IdCountry"] != DBNull.Value)
                                company.IdCountry = Convert.ToByte(reader["IdCountry"]);

                            if (reader["City"] != DBNull.Value)
                                company.City = Convert.ToString(reader["City"]);

                            if (reader["CIF"] != DBNull.Value)
                                company.CIF = Convert.ToString(reader["CIF"]);

                            if (reader["Address"] != DBNull.Value)
                                company.Address = Convert.ToString(reader["Address"]);

                            if (reader["Telephone"] != DBNull.Value)
                                company.Telephone = Convert.ToString(reader["Telephone"]);

                            if (reader["Fax"] != DBNull.Value)
                                company.Fax = Convert.ToString(reader["Fax"]);

                            if (reader["Email"] != DBNull.Value)
                                company.Email = Convert.ToString(reader["Email"]);

                            if (reader["IsStillActive"] != DBNull.Value)
                                company.IsStillActive = Convert.ToByte(reader["IsStillActive"]);

                            if (reader["RegisteredName"] != DBNull.Value)
                                company.RegisteredName = Convert.ToString(reader["RegisteredName"]);

                            if (reader["ZipCode"] != DBNull.Value)
                                company.ZipCode = Convert.ToString(reader["ZipCode"]);

                            if (reader["Region"] != DBNull.Value)
                                company.Region = Convert.ToString(reader["Region"]);

                            if (reader["CreatedBy"] != DBNull.Value)
                                company.CreatedBy = Convert.ToInt32(reader["CreatedBy"]);

                            if (reader["CreatedIn"] != DBNull.Value)
                                company.CreatedIn = Convert.ToDateTime(reader["CreatedIn"]);

                            if (reader["ModifiedBy"] != DBNull.Value)
                                company.ModifiedBy = Convert.ToInt32(reader["ModifiedBy"]);

                            if (reader["ModifiedIn"] != DBNull.Value)
                                company.ModifiedIn = Convert.ToDateTime(reader["ModifiedIn"]);

                            if (reader["Website"] != DBNull.Value)
                                company.Website = Convert.ToString(reader["Website"]);

                            if (reader["Latitude"] != DBNull.Value)
                                company.Latitude = Convert.ToDouble(reader["Latitude"]);

                            if (reader["Longitude"] != DBNull.Value)
                                company.Longitude = Convert.ToDouble(reader["Longitude"]);

                            if (reader["Alias"] != DBNull.Value)
                                company.Alias = Convert.ToString(reader["Alias"]);

                            if (reader["Size"] != DBNull.Value)
                                company.Size = Convert.ToDouble(reader["Size"]);

                            if (reader["EstablishmentDate"] != DBNull.Value)
                                company.EstablishmentDate = Convert.ToDateTime(reader["EstablishmentDate"].ToString());

                            if (reader["IdEnterpriseGroup"] != DBNull.Value)
                            {
                                company.IdEnterpriseGroup = Convert.ToInt32(reader["IdEnterpriseGroup"]);
                                company.EnterpriseGroup = new EnterpriseGroup();
                                company.EnterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(reader["IdEnterpriseGroup"]);
                                company.EnterpriseGroup.Name = Convert.ToString(reader["EnterpriseGroup"]);
                            }


                            if (reader["TimeZoneIdentifier"] != DBNull.Value)
                                company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);



                        }


                    }
                }

                company.CompanyChangelogs = GetAllChangeLogByCompanyId(workbenchConnectionString, idCompany);
                company.Employees = GetAllEmployeeDetailsByIdCompany(workbenchConnectionString, idCompany, employeeProfileImagePath);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyDetailsByCompanyId(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return company;
        }

        /// <summary>
        /// This method is to get all enterprise group details
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <returns>List of enterprise group details</returns>
        public List<EnterpriseGroup> GetAllEnterpriseGroup(string workbenchConnectionString)
        {
            List<EnterpriseGroup> enterpriseGroups = new List<EnterpriseGroup>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEnterpriseGroup", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        EnterpriseGroup enterpriseGroup = new EnterpriseGroup();
                        while (reader.Read())
                        {

                            if (reader["IdEnterpriseGroup"] != DBNull.Value)
                                enterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(reader["IdEnterpriseGroup"]);

                            if (reader["Name"] != DBNull.Value)
                                enterpriseGroup.Name = Convert.ToString(reader["Name"]);


                            enterpriseGroups.Add(enterpriseGroup);

                        }


                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEnterpriseGroup(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return enterpriseGroups;
        }

        /// <summary>
        /// This method is to add employee attendance with clock id from excel
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="employeeAttendanceList">Get employee attendance list details</param>
        /// <returns>If true added employee attendance with clock from excel otherwise false</returns>
        public bool AddEmpAttendanceWithClockIdFromExcel(string mainServerWorkbenchConnectionString, List<EmployeeAttendance> employeeAttendanceList)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmpAttendanceInsertFromExcelByClockId", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        foreach (EmployeeAttendance item in employeeAttendanceList)
                        {
                            mySqlCommand.Parameters.Clear();

                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", item.ClockID);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", item.IdCompanyWork);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", item.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", item.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", item.EndDate);

                            mySqlCommand.ExecuteNonQuery();
                        }

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeAttendanceFromExcel(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is to get all employee details related to id company selected period
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="employeeProfileImagePath">Get employee image path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeeDetailsByIdCompanySelectedPeriod(string workbenchConnectionString, Int32 idCompany, string employeeProfileImagePath, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeeDetailsByIdCompanySelectedPeriod", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                Employee employee = new Employee();

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["MobValue"] != DBNull.Value)
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(reader["MobValue"]);

                                if (reader["EmailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["EmailValue"]);

                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.JobDescription = new JobDescription();

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                employee.EmployeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeeProfileImagePath);
                                employees.Add(employee);

                            }

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeDetailsByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            if (employees.Any(i => i.EmployeeJobDescription.JobDescription.IdJobDescription == 21))
            {
                List<Employee> finalEmployeeList = new List<Employee>();
                List<Employee> perviousEmployeeList = new List<Employee>();
                perviousEmployeeList = employees;
                foreach (Employee itemEmp in employees.Where(i => i.EmployeeJobDescription.JobDescription.IdJobDescription == 21).OrderBy(x => x.FirstName).OrderBy(x => x.LastName))
                {
                    finalEmployeeList.Add(itemEmp);
                    perviousEmployeeList.Remove(itemEmp);
                }
                foreach (Employee itemEmp in perviousEmployeeList.Where(i => i.EmployeeJobDescription.JobDescription.IdJobDescription != 21).OrderBy(x => x.FirstName).OrderBy(x => x.LastName))
                {
                    finalEmployeeList.Add(itemEmp);
                }
                employees = finalEmployeeList;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get company details related id company and selected period
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="employeeProfileImagePath">Get employee image path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get company details</returns>
        public Company GetCompanyDetailsByCompanyIdSelectedPeriod(string workbenchConnectionString, Int32 idCompany, string employeeProfileImagePath, Int64 selectedPeriod)
        {
            Company company = new Company();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyDetailsByCompanyId", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);



                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        if (reader.Read())
                        {

                            if (reader["IdCompany"] != DBNull.Value)
                                company.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["Name"] != DBNull.Value)
                                company.Name = Convert.ToString(reader["Name"]);

                            if (reader["IdCountry"] != DBNull.Value)
                                company.IdCountry = Convert.ToByte(reader["IdCountry"]);

                            if (reader["City"] != DBNull.Value)
                                company.City = Convert.ToString(reader["City"]);

                            if (reader["CIF"] != DBNull.Value)
                                company.CIF = Convert.ToString(reader["CIF"]);

                            if (reader["Address"] != DBNull.Value)
                                company.Address = Convert.ToString(reader["Address"]);

                            if (reader["Telephone"] != DBNull.Value)
                                company.Telephone = Convert.ToString(reader["Telephone"]);

                            if (reader["Fax"] != DBNull.Value)
                                company.Fax = Convert.ToString(reader["Fax"]);

                            if (reader["Email"] != DBNull.Value)
                                company.Email = Convert.ToString(reader["Email"]);

                            if (reader["IsStillActive"] != DBNull.Value)
                                company.IsStillActive = Convert.ToByte(reader["IsStillActive"]);

                            if (reader["RegisteredName"] != DBNull.Value)
                                company.RegisteredName = Convert.ToString(reader["RegisteredName"]);

                            if (reader["ZipCode"] != DBNull.Value)
                                company.ZipCode = Convert.ToString(reader["ZipCode"]);

                            if (reader["Region"] != DBNull.Value)
                                company.Region = Convert.ToString(reader["Region"]);

                            if (reader["CreatedBy"] != DBNull.Value)
                                company.CreatedBy = Convert.ToInt32(reader["CreatedBy"]);

                            if (reader["CreatedIn"] != DBNull.Value)
                                company.CreatedIn = Convert.ToDateTime(reader["CreatedIn"]);

                            if (reader["ModifiedBy"] != DBNull.Value)
                                company.ModifiedBy = Convert.ToInt32(reader["ModifiedBy"]);

                            if (reader["ModifiedIn"] != DBNull.Value)
                                company.ModifiedIn = Convert.ToDateTime(reader["ModifiedIn"]);

                            if (reader["Website"] != DBNull.Value)
                                company.Website = Convert.ToString(reader["Website"]);

                            if (reader["Latitude"] != DBNull.Value)
                                company.Latitude = Convert.ToDouble(reader["Latitude"]);

                            if (reader["Longitude"] != DBNull.Value)
                                company.Longitude = Convert.ToDouble(reader["Longitude"]);

                            if (reader["Alias"] != DBNull.Value)
                                company.Alias = Convert.ToString(reader["Alias"]);

                            if (reader["Size"] != DBNull.Value)
                                company.Size = Convert.ToDouble(reader["Size"]);

                            if (reader["EstablishmentDate"] != DBNull.Value)
                                company.EstablishmentDate = Convert.ToDateTime(reader["EstablishmentDate"].ToString());

                            if (reader["IdEnterpriseGroup"] != DBNull.Value)
                            {
                                company.IdEnterpriseGroup = Convert.ToInt32(reader["IdEnterpriseGroup"]);
                                company.EnterpriseGroup = new EnterpriseGroup();
                                company.EnterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(reader["IdEnterpriseGroup"]);
                                company.EnterpriseGroup.Name = Convert.ToString(reader["EnterpriseGroup"]);
                            }


                            if (reader["TimeZoneIdentifier"] != DBNull.Value)
                                company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);

                            if (reader["IdCountry"] != DBNull.Value)
                            {
                                company.Country = new Country();
                                company.Country.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                company.Country.Name = Convert.ToString(reader["Country"]);
                            }

                            if (reader["IsCompany"] != DBNull.Value)
                                company.IsCompany = Convert.ToByte(reader["IsCompany"]);

                            if (reader["IsOrganization"] != DBNull.Value)
                                company.IsOrganization = Convert.ToByte(reader["IsOrganization"]);

                            if (reader["IsLocation"] != DBNull.Value)
                                company.IsLocation = Convert.ToByte(reader["IsLocation"]);
                        }


                    }
                }

                company.CompanyChangelogs = GetAllChangeLogByCompanyId(workbenchConnectionString, idCompany);
                company.Employees = GetAllEmployeeDetailsByIdCompanySelectedPeriod(workbenchConnectionString, idCompany, employeeProfileImagePath, selectedPeriod);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyDetailsByCompanyId(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return company;
        }

        /// <summary>
        /// This method is to get job description count
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of job description details</returns>
        public List<JobDescription> GetJobDescriptionCount(string workbenchConnectionString, Int32 idCompany, Int64 selectedPeriod)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetJobDescriptionCount", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                JobDescription jobDescription = new JobDescription();

                                if (reader["IdJd"] != DBNull.Value)
                                    jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJd"]);

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["EmpCount"] != DBNull.Value)
                                    jobDescription.EmployeeRecordCount = Convert.ToDecimal(reader["EmpCount"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                }


                                jobDescriptions.Add(jobDescription);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetJobDescriptionCount(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get company department details
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get company id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of company department details</returns>
        public List<CompanyDepartment> GetCompanyDepartment(string workbenchConnectionString, Int32 idCompany, Int64 selectedPeriod)
        {
            List<CompanyDepartment> companyDepartments = new List<CompanyDepartment>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyDepartment", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            CompanyDepartment companyDepartment = new CompanyDepartment();

                            if (reader["IdCompanyDepartment"] != DBNull.Value)
                                companyDepartment.IdCompanyDepartment = Convert.ToInt64(reader["IdCompanyDepartment"]);

                            if (reader["IdCompany"] != DBNull.Value)
                                companyDepartment.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                companyDepartment.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                companyDepartment.Department = new Department();
                                companyDepartment.Department.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                companyDepartment.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                companyDepartment.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                companyDepartment.Department.DepartmentArea = new LookupValue();
                                companyDepartment.Department.DepartmentArea.HtmlColor = Convert.ToString(reader["AreaHtmlColor"]);

                            }


                            if (reader["Size"] != DBNull.Value)
                                companyDepartment.Size = Convert.ToDouble(reader["Size"]);

                            if (reader["NumberOfWorkstations"] != DBNull.Value)
                                companyDepartment.NumberOfWorkstations = Convert.ToInt64(reader["NumberOfWorkstations"]);


                            companyDepartments.Add(companyDepartment);

                        }


                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyDepartment(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            List<JobDescription> LstJobDescriptions = new List<JobDescription>();
            LstJobDescriptions = GetJobDescriptionCount(workbenchConnectionString, idCompany, selectedPeriod);
            foreach (CompanyDepartment itemcdept in companyDepartments)
            {
                itemcdept.JobDescriptions = new List<JobDescription>();

                itemcdept.JobDescriptions = LstJobDescriptions.Where(i => i.IdDepartment == itemcdept.IdDepartment).ToList();

                if (itemcdept.JobDescriptions.Count > 0)
                    itemcdept.EmployeesRecordCount = itemcdept.EmployeesRecordCount + itemcdept.JobDescriptions.Sum(i => i.EmployeeRecordCount);
            }

            return companyDepartments;
        }

        /// <summary>
        /// This method is to check employee exist or not
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="firstName">Get first name</param>
        /// <param name="lastName">Get last name</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <returns>List of employee details</returns>
        public List<Employee> IsEmployeeExists(string workbenchConnectionString, string firstName, string lastName, Int32 idEmployee)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employees_IsExists", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_FirstName", firstName);
                    mySqlCommand.Parameters.AddWithValue("_LastName", lastName);
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employee.LastName = Convert.ToString(reader["LastName"]);
                            }
                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsEmployeeExists(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get compoany annual schedule related to id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get employee details</returns>
        public Employee GetCompanyAnnualScheduleByIdEmployee(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod)
        {
            Employee employee = new Employee();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyAnnualScheduleByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        if (reader.Read())
                        {

                            if (reader["IdEmployee"] != DBNull.Value)
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                if (reader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    if (reader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanyAnnualSchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.CompanySetting = new CompanySetting();
                                        if (reader["CompanySetting"] != DBNull.Value)
                                        {
                                            employee.CompanyShift.CompanyAnnualSchedule.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyAnnualScheduleByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return employee;
        }


        /// <summary>
        /// This method is to get all employee leaves related to id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="selectedPeriod">Get selected peeriod</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>Get dictionary of id and time</returns>
        public Dictionary<Int32, TimeSpan> GetAllEmpLeavesByIdEmployee(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod, string idCompany)
        {
            Employee employee = null;
            CrmManager crmmanager = new CrmManager();
            GeosAppSetting Setting = crmmanager.GetGeosAppSettings(11, workbenchConnectionString);
            string[] employeeWorkingDays = null;
            if (Setting.DefaultValue == "Working")
            {
                employee = new Employee();
                employee = GetCompanyAnnualScheduleByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod);
                if (employee != null)
                    if (employee.CompanyShift != null)
                        if (employee.CompanyShift.CompanyAnnualSchedule != null)
                            employeeWorkingDays = employee.CompanyShift.CompanyAnnualSchedule.WorkingDays.Split(',');
            }
            Dictionary<Int32, TimeSpan> leaveInHolidayCount = new Dictionary<Int32, TimeSpan>();
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmpLeavesByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdLeave"] != DBNull.Value)
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmpLeavesByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            List<CompanyHoliday> comhol = GetCompanyHolidaysBySelectedIdCompany(workbenchConnectionString, idCompany, selectedPeriod);
            List<EmployeeLeave> leaves = new List<EmployeeLeave>();
            List<EmployeeLeave> leavesIgnore = new List<EmployeeLeave>();
            List<string> holidays = new List<string>();
            if (employee != null)
            {
                if (employee.CompanyShift != null)
                {


                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        if (employee.CompanyShift.CompanyAnnualSchedule.CompanySetting.Value == "Working")
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime i = item.StartDate.Value; i <= item.EndDate.Value;)
                                {

                                    if (!employeeWorkingDays.Any(x => x.Contains(i.DayOfWeek.ToString().Substring(0, 3))))
                                    {
                                        leavesIgnore.Add(new EmployeeLeave() { IdLeave = item.IdLeave, IdEmployeeLeave = item.IdEmployeeLeave, LeaveDate = i.ToString("dd-MM-yyyy") });
                                    }
                                    else
                                    {
                                        leaves.Add(new EmployeeLeave() { IdLeave = item.IdLeave, IdEmployeeLeave = item.IdEmployeeLeave, LeaveDate = i.ToString("dd-MM") });
                                    }
                                    i = i.AddDays(1);
                                }
                            }
                        }
                        else
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime i = item.StartDate.Value; i <= item.EndDate.Value;)
                                {

                                    leaves.Add(new EmployeeLeave() { IdLeave = item.IdLeave, IdEmployeeLeave = item.IdEmployeeLeave, LeaveDate = i.ToString("dd-MM") });
                                    i = i.AddDays(1);
                                }
                            }
                        }
                    }
                    else
                    {
                        foreach (EmployeeLeave item in employeeLeaves)
                        {
                            for (DateTime i = item.StartDate.Value; i <= item.EndDate.Value;)
                            {

                                leaves.Add(new EmployeeLeave() { IdLeave = item.IdLeave, IdEmployeeLeave = item.IdEmployeeLeave, LeaveDate = i.ToString("dd-MM") });
                                i = i.AddDays(1);
                            }
                        }
                    }
                }
                else
                {
                    foreach (EmployeeLeave item in employeeLeaves)
                    {
                        for (DateTime i = item.StartDate.Value; i <= item.EndDate.Value;)
                        {

                            leaves.Add(new EmployeeLeave() { IdLeave = item.IdLeave, IdEmployeeLeave = item.IdEmployeeLeave, LeaveDate = i.ToString("dd-MM") });
                            i = i.AddDays(1);
                        }
                    }
                }
            }
            else
            {
                foreach (EmployeeLeave item in employeeLeaves)
                {
                    for (DateTime i = item.StartDate.Value; i <= item.EndDate.Value;)
                    {
                        leaves.Add(new EmployeeLeave() { IdLeave = item.IdLeave, IdEmployeeLeave = item.IdEmployeeLeave, LeaveDate = i.ToString("dd-MM") });
                        i = i.AddDays(1);
                    }
                }
            }

            foreach (CompanyHoliday item in comhol)
            {
                for (DateTime i = item.StartDate.Value; i <= item.EndDate.Value;)
                {
                    holidays.Add(i.ToString("dd-MM"));
                    i = i.AddDays(1);
                }
            }


            foreach (var item in leaves.Where(i => holidays.Contains(i.LeaveDate)).GroupBy(i => i.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Count(), 0, 0, 0);

                leaveInHolidayCount.Add(item.Key, ts);
            }

            if (leavesIgnore != null)
            {
                foreach (var item in leavesIgnore.GroupBy(i => i.IdLeave))
                {
                    TimeSpan ts = new TimeSpan(item.ToList().Count(), 0, 0, 0);
                    if (leaveInHolidayCount != null)
                    {
                        if (leaveInHolidayCount.Any(LIHC => LIHC.Key == item.Key))
                        {
                            TimeSpan mergedts = new TimeSpan(leaveInHolidayCount.Where(LIHC => LIHC.Key == item.Key).FirstOrDefault().Value.Days + ts.Days, 0, 0, 0);
                            Int32 keyleave = leaveInHolidayCount.Where(LIHC => LIHC.Key == item.Key).FirstOrDefault().Key;
                            leaveInHolidayCount.Remove(item.Key);
                            leaveInHolidayCount.Add(keyleave, mergedts);
                        }
                        else
                        {
                            leaveInHolidayCount.Add(item.Key, ts);
                        }
                    }
                    else
                    {
                        leaveInHolidayCount.Add(item.Key, ts);
                    }

                }
            }

            #region
            //List<EmployeeLeave> tempLeave = leaves.Where(i => holidays.Contains(i.LeaveDate)).ToList();

            //foreach (EmployeeLeave item in tempLeave)
            //{
            //    EmployeeLeave empLeave = employeeLeaves.Where(i => i.IdEmployeeLeave == item.IdEmployeeLeave).FirstOrDefault();
            //    if (empLeave.StartDate.Value.ToString("dd-MM") == item.LeaveDate && empLeave.EndDate.Value.ToString("dd-MM") == item.LeaveDate)
            //    {
            //        TimeSpan ts = empLeave.EndDate.Value - empLeave.StartDate.Value;
            //        leaveInHolidayCount[item.IdLeave] = new TimeSpan(leaveInHolidayCount[item.IdLeave].Days - 1, ts.Hours, 0, 0);
            //    }
            //    else if (empLeave.StartDate.Value.ToString("dd-MM") == item.LeaveDate)
            //    {
            //        DateTime endDate = empLeave.StartDate.Value.AddDays(1).Date;
            //        TimeSpan ts = endDate - empLeave.StartDate.Value;
            //        leaveInHolidayCount[item.IdLeave] = new TimeSpan(leaveInHolidayCount[item.IdLeave].Days - 1, ts.Hours, 0, 0);
            //    }
            //    else if (empLeave.EndDate.Value.ToString("dd-MM") == item.LeaveDate)
            //    {
            //        DateTime startDate = empLeave.EndDate.Value.AddDays(-1).Date;
            //        TimeSpan ts = empLeave.EndDate.Value - startDate;
            //        leaveInHolidayCount[item.IdLeave] = new TimeSpan(leaveInHolidayCount[item.IdLeave].Days - 1, ts.Hours, 0, 0);
            //    }
            //}
            #endregion


            return leaveInHolidayCount;
        }

        /// <summary>
        /// This method is to get employee details related to employee document number
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="EmployeeDocumentNumber">Get employee document number</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetEmpDtlByEmpDocumentNumber(string workbenchConnectionString, string EmployeeDocumentNumber)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employees_GetEmpDtlByEmpDocumentNumber", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumber);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employee.LastName = Convert.ToString(reader["LastName"]);
                                employee.EmployeeDocument = new EmployeeDocument();
                                employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);
                            }
                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocumentNumber(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get employee shifts
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <returns>List of employee shift</returns>
        public List<EmployeeShift> GetEmployeeShifts(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeShift> employeeShifts = new List<EmployeeShift>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeShifts", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            EmployeeShift employeeShift = new EmployeeShift();
                            if (reader["IdEmployeeShift"] != DBNull.Value)
                                employeeShift.IdEmployeeShift = Convert.ToInt64(reader["IdEmployeeShift"]);
                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeShift.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            if (reader["IdCompanyShift"] != DBNull.Value)
                            {
                                employeeShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                employeeShift.CompanyShift = new CompanyShift();
                                employeeShift.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                employeeShift.CompanyShift.Name = Convert.ToString(reader["Name"]);
                                if (reader["StartTime1"] != DBNull.Value)
                                    employeeShift.CompanyShift.StartTime1 = (TimeSpan)reader["StartTime1"];
                                if (reader["EndTime1"] != DBNull.Value)
                                    employeeShift.CompanyShift.EndTime1 = (TimeSpan)reader["EndTime1"];
                                if (reader["StartTime2"] != DBNull.Value)
                                    employeeShift.CompanyShift.StartTime2 = (TimeSpan)reader["StartTime2"];
                                if (reader["EndTime2"] != DBNull.Value)
                                    employeeShift.CompanyShift.EndTime2 = (TimeSpan)reader["EndTime2"];
                                if (reader["BreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];
                                if (reader["Mon"] != DBNull.Value)
                                    employeeShift.CompanyShift.Mon = Convert.ToSByte(reader["Mon"]);
                                if (reader["Tue"] != DBNull.Value)
                                    employeeShift.CompanyShift.Tue = Convert.ToSByte(reader["Tue"]);
                                if (reader["Wed"] != DBNull.Value)
                                    employeeShift.CompanyShift.Wed = Convert.ToSByte(reader["Wed"]);
                                if (reader["Thu"] != DBNull.Value)
                                    employeeShift.CompanyShift.Thu = Convert.ToSByte(reader["Thu"]);
                                if (reader["Fri"] != DBNull.Value)
                                    employeeShift.CompanyShift.Fri = Convert.ToSByte(reader["Fri"]);
                                if (reader["Sat"] != DBNull.Value)
                                    employeeShift.CompanyShift.Sat = Convert.ToSByte(reader["Sat"]);
                                if (reader["Sun"] != DBNull.Value)
                                    employeeShift.CompanyShift.Sun = Convert.ToSByte(reader["Sun"]);
                            }

                            if (reader["StartDate"] != DBNull.Value)
                                employeeShift.StartDate = Convert.ToDateTime(reader["StartDate"]);
                            if (reader["EndDate"] != DBNull.Value)
                                employeeShift.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            employeeShifts.Add(employeeShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeShifts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeShifts;
        }

        /// <summary>
        /// This method is to get employee details related to employee document number and period
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="EmployeeDocumentNumbers">Get employee document number</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetEmpDtlByEmpDocNoAndPeriod(string workbenchConnectionString, string EmployeeDocumentNumbers, string idCompany, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employees_GetEmpDtlByEmpDocNoAndPeriod", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumbers);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employee.LastName = Convert.ToString(reader["LastName"]);
                                employee.EmployeeDocument = new EmployeeDocument();
                                employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["JDIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(reader["JDIdCompany"]);
                                    employee.EmployeeJobDescription.Company = new Company();
                                    employee.EmployeeJobDescription.Company.IdCompany = employee.EmployeeJobDescription.IdCompany;

                                    if (reader["CompanyName"] != DBNull.Value)
                                        employee.EmployeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                    if (reader["CompanyAlias"] != DBNull.Value)
                                        employee.EmployeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                                }

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                    employee.EmployeeJobDescription.JobDescription.IdJobDescription = employee.EmployeeJobDescription.IdJobDescription;
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employee.EmployeeJobDescription.JobDescription.Department.IdDepartment = employee.EmployeeJobDescription.JobDescription.IdDepartment;
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                        if (reader["DepartmentInUse"] != DBNull.Value)
                                            employee.EmployeeJobDescription.JobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);

                                        if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                            employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                    }
                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }

                                }

                            }
                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get authorized plants related to iduser
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idUser">Get id user</param>
        /// <returns>List of company details</returns>
        public List<Company> GetAuthorizedPlantsByIdUser(string workbenchConnectionString, Int32 idUser)
        {
            List<Company> companies = new List<Company>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("companies_GetAuthorizedPlantsByIdUser", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idUser", idUser);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Company company = new Company();
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                company.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                company.Name = Convert.ToString(reader["CompanyName"]);
                                company.Alias = Convert.ToString(reader["Alias"]);
                                company.ShortName = Convert.ToString(reader["Alias"]);
                                if (reader["IdCountry"] != DBNull.Value)
                                {
                                    company.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country = new Country();
                                    company.Country.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country.Name = Convert.ToString(reader["CountryName"]);
                                }

                            }
                            companies.Add(company);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAuthorizedPlantsByIdUser(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companies;
        }

        /// <summary>
        /// This method is to get company schedule related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db) </param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>List of company schedule details</returns>
        public List<CompanySchedule> GetCompanyScheduleByIdCompany(string workbenchConnectionString, string idCompany)
        {
            List<CompanySchedule> companySchedules = new List<CompanySchedule>();
            CompanySchedule companyScheduleDefault = new CompanySchedule();
            companyScheduleDefault.Name = "---";

            companySchedules.Add(companyScheduleDefault);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyScheduleByIdCompany", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanySchedule companySchedule = new CompanySchedule();
                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                            }
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                companySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                            }
                            companySchedule.Name = Convert.ToString(reader["Name"]);

                            companySchedules.Add(companySchedule);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyScheduleByIdCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companySchedules;
        }


        /// <summary>
        /// This method is to check employee enjoyed all annual leaves --sprint60
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="idEmployeeLeave">Get id employee leave</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>If true employee enjoyed all annual leaves otherwise false</returns>
        public bool IsEmployeeEnjoyedAllAnnualLeavesSprint60(string workbenchConnectionString, Int32 idEmployee, Int32 idEmployeeLeave, long selectedPeriod, Int32 idCompany)
        {
            EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();
            Dictionary<Int32, TimeSpan> leaveInHoilday = new Dictionary<Int32, TimeSpan>();

            leaveInHoilday = GetAllEmpLeavesByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany.ToString());

            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEnjoyedLeaveHours", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idEmployeeLeave);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        decimal Total = 0;
                        decimal Enjoyed = 0;

                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["Total"] != DBNull.Value)
                                    Total = Total + Convert.ToDecimal(reader["Total"]);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);


                                if (reader["EnjoyedHours"] != DBNull.Value)
                                {
                                    if (leaveInHoilday != null)
                                    {
                                        if (leaveInHoilday.Any(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])))
                                        {
                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                            {
                                                TimeSpan ts = new TimeSpan();
                                                ts = leaveInHoilday.Where(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])).FirstOrDefault().Value;


                                                employeeAnnualLeave.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]) - (Convert.ToDecimal(reader["DailyHoursCount"]) * Convert.ToDecimal(ts.Days));

                                            }
                                        }
                                        else
                                        {
                                            employeeAnnualLeave.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                        }
                                    }
                                    else
                                    {
                                        employeeAnnualLeave.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                    }
                                }
                            }
                        }
                        if (employeeAnnualLeave.Enjoyed > Total)
                        {
                            return true;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsEmployeeEnjoyedAllAnnualLeaves(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return false;
        }

        /// <summary>
        /// This method is to update employee leave sprint 60
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeeLeave">Get employee leave details</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Employee leave details</returns>
        public EmployeeLeave UpdateEmployeeLeaveSprint60(string mainServerWorkbenchConnectionString, string workbenchConnectionString, EmployeeLeave employeeLeave, long selectedPeriod)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {

                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLeave_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeLeave", employeeLeave.IdEmployeeLeave);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeLeave.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeLeave.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                        mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                        mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);

                        employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();

                        ///002
                        AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employeeLeave.IdEmployee, employeeLeave.EmployeeChangelogs);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();

                    if (employeeLeave.Employee == null)
                        employeeLeave.Employee = new Employee();

                    employeeLeave.Employee.CompanyShift = GetEmployeeShiftandDailyHoursByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee, selectedPeriod);

                    employeeLeave.Employee.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                    EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                    employeeJobDescription = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee).LastOrDefault();

                    if (employeeJobDescription != null)
                        employeeLeave.Employee.EmployeeJobDescriptions.Add(employeeJobDescription);

                    string idCompany = "";
                    if (employeeLeave.Employee.EmployeeJobDescriptions != null)
                    {
                        idCompany = employeeLeave.Employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                    }
                    employeeLeave.Employee.EmployeeAnnualLeaves = GetEmployeeAnnualLeavesHourCountByIdEmployeeSprint60(workbenchConnectionString, employeeLeave.IdEmployee, selectedPeriod, idCompany.ToString());
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployeeLeave(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeLeave;
        }

        /// <summary>
        /// This method is to get employee annual leave hour count related to id employee sprint 60
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>List of employee annual leave details</returns>
        public List<EmployeeAnnualLeave> GetEmployeeAnnualLeavesHourCountByIdEmployeeSprint60(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod, string idCompany)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();
            Dictionary<Int32, TimeSpan> leaveInHoilday = new Dictionary<Int32, TimeSpan>();
            if (idCompany != null)
                leaveInHoilday = GetAllEmpLeavesByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesHourCountByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeaves.Add(employeeAnnualLeave);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave eal = employeeAnnualLeaves.FirstOrDefault(x => x.IdLeave == Convert.ToInt64(reader["IdLeave"]));

                                if (eal != null)
                                {
                                    if (leaveInHoilday != null)
                                    {
                                        if (leaveInHoilday.Any(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])))
                                        {
                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                            {
                                                TimeSpan ts = new TimeSpan();
                                                ts = leaveInHoilday.Where(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])).FirstOrDefault().Value;

                                                if (reader["EnjoyedHours"] != DBNull.Value)
                                                    eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]) - (Convert.ToDecimal(reader["DailyHoursCount"]) * Convert.ToDecimal(ts.Days));
                                                else
                                                    eal.Enjoyed = 0;
                                            }
                                        }
                                        else
                                        {
                                            if (reader["EnjoyedHours"] != DBNull.Value)
                                                eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                            else
                                                eal.Enjoyed = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (reader["EnjoyedHours"] != DBNull.Value)
                                            eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                        else
                                            eal.Enjoyed = 0;
                                    }

                                    eal.Remaining = (eal.RegularHoursCount + eal.AdditionalHoursCount) - eal.Enjoyed;
                                }
                            }
                        }

                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeAnnualLeavesHourCountByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeaves;
        }


        /// <summary>
        /// This method is to calculate length of service related to date
        /// </summary>
        /// <param name="EmployeeContractSituations">Get list of employee contract situation details</param>
        /// <param name="currentDate">Get current date</param>
        /// <returns>Get length of service</returns>
        private string CalculateLengthOfServiceByDate(List<EmployeeContractSituation> EmployeeContractSituations, DateTime currentDate)
        {
            string lengthOfService = "0";
            List<YearMonthDayDetail> ymddLst = new List<YearMonthDayDetail>();
            try
            {
                if (EmployeeContractSituations.Count > 0)
                {
                    int month = 0;
                    int year = 0;
                    int days = 0;
                    int cnt = 0;
                    foreach (EmployeeContractSituation employeeContractSituation in EmployeeContractSituations.OrderBy(ec => ec.IdEmployeeContractSituation))
                    {

                        if (employeeContractSituation.ContractSituationStartDate.Value.Date >= currentDate.Date)
                        {
                            lengthOfService += 0;
                        }
                        else if (employeeContractSituation.ContractSituationEndDate == null)
                        {
                            LocalDate start = new LocalDate(employeeContractSituation.ContractSituationStartDate.Value.Year, employeeContractSituation.ContractSituationStartDate.Value.Month, employeeContractSituation.ContractSituationStartDate.Value.Day);
                            LocalDate end = new LocalDate(currentDate.Year, currentDate.Month, currentDate.Day);
                            Period period = null;
                            period = Period.Between(start, end.PlusDays(1));
                            YearMonthDayDetail ymdd = new YearMonthDayDetail();
                            ymdd.Years = period.Years;
                            ymdd.Months = period.Months;
                            ymdd.Days = period.Days;
                            ymdd.CntContract = cnt;

                            if (ymdd.Days > 0)
                            {
                                ymdd.DaysRequired = (currentDate.Date - currentDate.Date.AddMonths(-1)).Days - period.Days;

                            }

                            ymddLst.Add(ymdd);
                            cnt++;

                        }
                        else
                        {
                            if (employeeContractSituation.ContractSituationEndDate.Value.Date > currentDate.Date)
                            {
                                LocalDate start = new LocalDate(employeeContractSituation.ContractSituationStartDate.Value.Year, employeeContractSituation.ContractSituationStartDate.Value.Month, employeeContractSituation.ContractSituationStartDate.Value.Day);
                                LocalDate end = new LocalDate(currentDate.Year, currentDate.Month, currentDate.Day);
                                Period period = null;
                                period = Period.Between(start, end.PlusDays(1));

                                YearMonthDayDetail ymdd = new YearMonthDayDetail();
                                ymdd.Years = period.Years;
                                ymdd.Months = period.Months;
                                ymdd.Days = period.Days;
                                ymdd.CntContract = cnt;

                                if (ymdd.Days > 0)
                                {
                                    ymdd.DaysRequired = (currentDate.Date - currentDate.Date.AddMonths(-1)).Days - period.Days;
                                }
                                ymddLst.Add(ymdd);
                                cnt++;
                            }
                            else
                            {
                                LocalDate start = new LocalDate(employeeContractSituation.ContractSituationStartDate.Value.Year, employeeContractSituation.ContractSituationStartDate.Value.Month, employeeContractSituation.ContractSituationStartDate.Value.Day);
                                LocalDate end = new LocalDate(employeeContractSituation.ContractSituationEndDate.Value.Year, employeeContractSituation.ContractSituationEndDate.Value.Month, employeeContractSituation.ContractSituationEndDate.Value.Day);
                                Period period = null;
                                period = Period.Between(start, end.PlusDays(1));

                                YearMonthDayDetail ymdd = new YearMonthDayDetail();
                                ymdd.Years = period.Years;
                                ymdd.Months = period.Months;
                                ymdd.Days = period.Days;
                                ymdd.CntContract = cnt;

                                if (ymdd.Days > 0)
                                {
                                    ymdd.DaysRequired = (employeeContractSituation.ContractSituationEndDate.Value.Date - employeeContractSituation.ContractSituationEndDate.Value.Date.AddMonths(-1)).Days - period.Days;
                                }

                                ymddLst.Add(ymdd);
                                cnt++;
                            }
                        }

                    }

                    year = ymddLst.Sum(i => i.Years);
                    month = ymddLst.Sum(i => i.Months);
                    days = ymddLst.Sum(i => i.Days);

                    int tempmonth = month;
                    if (month >= 12)
                    {
                        int yearcnt = 0;
                        while (tempmonth != 0)
                        {
                            if (tempmonth >= 12)
                            {
                                tempmonth = tempmonth - 12;

                                year++;

                                yearcnt++;

                                if (tempmonth == 0)
                                {
                                    month = 0;
                                }
                            }
                            else
                            {
                                month = tempmonth;
                                tempmonth = 0;
                            }

                        }
                    }


                    //  int daysDifference = ymddLst.Sum(i => i.DaysRequired);

                    //foreach (YearMonthDayDetail itemymdd in ymddLst.Where(i=>i.DaysRequired==0 && i.Days>0).ToList())
                    //{
                    //    days = days - itemymdd.Days;
                    //    month++;
                    //    if (month == 12)
                    //    {
                    //        year++;
                    //        month = 0;
                    //    }
                    //}

                    foreach (YearMonthDayDetail itemymdd in ymddLst.Where(i => i.DaysRequired > 0 && i.Days > 0).OrderBy(yl => yl.CntContract).ToList())
                    {
                        if (days > 0)
                        {
                            int daysWithCurrentRecord = days - itemymdd.Days;
                            if (daysWithCurrentRecord > 0)
                            {

                                if (daysWithCurrentRecord >= itemymdd.DaysRequired)
                                {

                                    days = days - (itemymdd.DaysRequired + itemymdd.Days);
                                    month++;
                                    if (month == 12)
                                    {
                                        year++;
                                        month = 0;
                                    }
                                }

                            }
                            else
                            {
                                break;
                            }
                        }
                        else
                        {
                            break;
                        }

                    }



                    if (year > 0)
                    {
                        if (month == 0)
                        {

                            if (days == 1)
                            {
                                lengthOfService = Convert.ToString(year);
                            }
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error CalculateLengthOfServiceByDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return lengthOfService;
        }


        /// <summary>
        /// This method is to get today company anniversaries list of employee details
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="employees">Get employee details</param>
        /// <param name="currentDate">Get current date</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetTodayEmployeeCompanyAnniversariesDetails(string workbenchConnectionString, string employeesProfileImagePath, List<Employee> employees, DateTime currentDate)
        {
            string idEmployees = String.Join(",", ((List<Employee>)employees).ConvertAll<string>(d => d.IdEmployee.ToString()).ToArray());
            List<Employee> employeesCAD = new List<Employee>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetTodayEmployeeCompanyAnniversaryDetails", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdEmployees", idEmployees);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            employee.EmployeeContractSituation = new EmployeeContractSituation();
                            employee.EmployeeContractSituation.ContractSituationStartDate = currentDate;

                            //if (reader["AnniversaryDate"] != DBNull.Value)
                            //{
                            //    employee.EmployeeContractSituation = new EmployeeContractSituation();
                            //    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["AnniversaryDate"]);
                            //}

                            // if (reader["AnniversaryYear"] != DBNull.Value)
                            employee.LengthOfService = employees.Where(emp => emp.IdEmployee == employee.IdEmployee).FirstOrDefault().LengthOfService;

                            if (reader["CompanyEmails"] != DBNull.Value)
                                employee.EmployeeContactEmail = Convert.ToString(reader["CompanyEmails"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                employee.EmployeeJobDescription.Company = new Company();
                                employee.EmployeeJobDescription.Company.IdCompany = employee.EmployeeJobDescription.IdCompany;

                                if (reader["Name"] != DBNull.Value)
                                    employee.EmployeeJobDescription.Company.Name = Convert.ToString(reader["Name"]);

                                if (reader["Alias"] != DBNull.Value)
                                    employee.EmployeeJobDescription.Company.Alias = Convert.ToString(reader["Alias"]);

                                if (reader["TimeZoneIdentifier"] != DBNull.Value)
                                    employee.EmployeeJobDescription.Company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employeesCAD.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetTodayEmployeeCompanyAnniversariesDetails(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employeesCAD;
        }

        /// <summary>
        /// This method is to get employee details for leave summary
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetEmployeeDetailsForLeaveSummary(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeeDetailsForLeaveSummary", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);


                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }



                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["CompanyShortName"] != DBNull.Value)
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["CompanyShortName"]);

                                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employee.IdEmployee);
                                if (employee.EmployeeJobDescriptions != null)
                                {
                                    if (employee.EmployeeJobDescriptions.Count > 1)
                                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                                }

                                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany);

                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDetailsForLeaveSummary(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }


                }
            }
            Log4NetLogger.Logger.Log("Executed GetEmployeeDetailsForLeaveSummary().", category: Category.Info, priority: Priority.Low);
            return employees;
        }


        /// <summary>
        /// This method is to get company setting related to id company
        /// </summary>
        /// <param name="idAppSetting">Get id appsetting</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="connectionString">Get workbench connection string (emdep_geos db)</param>
        /// <returns>List of company setting details</returns>
        public List<CompanySetting> GetCompanySettingByIdCompany(Int16 idAppSetting, string idCompany, Int64 selectedPeriod, string connectionString)
        {
            List<CompanySetting> companySettings = new List<CompanySetting>();

            using (MySqlConnection MyConnection = new MySqlConnection(connectionString))
            {
                MyConnection.Open();
                MySqlCommand myCommand = new MySqlCommand("Hrm_GetCompanySettingByIdCompany", MyConnection);
                myCommand.CommandType = CommandType.StoredProcedure;
                myCommand.Parameters.AddWithValue("_IdAppSetting", idAppSetting);
                myCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                myCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = myCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            CompanySetting companySetting = new CompanySetting();

                            if (reader["IdCompanySetting"] != DBNull.Value)
                                companySetting.IdCompanySetting = Convert.ToInt64(reader["IdCompanySetting"].ToString());
                            if (reader["IdCompany"] != DBNull.Value)
                                companySetting.IdCompany = Convert.ToInt32(reader["IdCompany"].ToString());
                            if (reader["IdAppSetting"] != DBNull.Value)
                            {
                                companySetting.IdAppSetting = Convert.ToInt32(reader["IdAppSetting"].ToString());
                                companySetting.GeosAppSetting = new GeosAppSetting();

                                if (reader["IdAppSetting"] != DBNull.Value)
                                    companySetting.GeosAppSetting.IdAppSetting = Convert.ToInt16(reader["IdAppSetting"].ToString());

                                if (reader["AppSettingValue"] != DBNull.Value)
                                    companySetting.GeosAppSetting.DefaultValue = Convert.ToString(reader["AppSettingValue"].ToString());

                            }
                            if (reader["CompanySettingValue"] != DBNull.Value)
                            {
                                companySetting.Value = Convert.ToString(reader["CompanySettingValue"].ToString());
                            }

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                companySetting.StartDate = Convert.ToDateTime(reader["StartDate"].ToString());
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                companySetting.EndDate = Convert.ToDateTime(reader["EndDate"].ToString());
                            }

                            companySettings.Add(companySetting);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDetailsForLeaveSummary(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    reader.Close();
                }

                myCommand.Dispose();
                MyConnection.Close();
            }

            return companySettings;
        }


        /// <summary>
        /// This method is to get employee related to id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>Get employee details</returns>
        public Employee GetEmployeeByIdEmployee_V2031(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2031(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                employee.EmployeeShifts = GetEmployeeShifts(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee(workbenchConnectionString, idEmployee);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2031(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }


        /// <summary>
        /// This method is to get employee polyvalence related to id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <returns>List of employee polyvalence details</returns>
        public List<EmployeePolyvalence> GetEmployeePolyvalenceByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeePolyvalence> employeePolyvalences = new List<EmployeePolyvalence>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeePolyvalenceByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeePolyvalence employeePolyvalence = new EmployeePolyvalence();
                            employeePolyvalence.IdEmployee = idEmployee;

                            if (reader["IdEmployeePolyvalence"] != DBNull.Value)
                                employeePolyvalence.IdEmployeePolyvalence = Convert.ToUInt64(reader["IdEmployeePolyvalence"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeePolyvalence.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeePolyvalence.Company = new Company();
                                employeePolyvalence.Company.IdCompany = employeePolyvalence.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeePolyvalence.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeePolyvalence.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeePolyvalence.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeePolyvalence.JobDescription = new JobDescription();
                                employeePolyvalence.JobDescription.IdJobDescription = employeePolyvalence.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeePolyvalence.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["Abbreviation"] != DBNull.Value)
                                    employeePolyvalence.JobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeePolyvalence.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeePolyvalence.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeePolyvalence.JobDescription.Department = new Department();
                                    employeePolyvalence.JobDescription.Department.IdDepartment = employeePolyvalence.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeePolyvalence.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                }
                            }


                            if (reader["PolyvalenceUsage"] != DBNull.Value)
                                employeePolyvalence.PolyvalenceUsage = Convert.ToUInt16(reader["PolyvalenceUsage"]);


                            if (reader["PolyvalenceRemarks"] != DBNull.Value)
                                employeePolyvalence.PolyvalenceRemarks = Convert.ToString(reader["PolyvalenceRemarks"]);

                            employeePolyvalences.Add(employeePolyvalence);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeePolyvalenceByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeePolyvalences;
        }

        /// <summary>
        /// This method is to add employee details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeProfileImage">Get employee image path</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path</param>
        /// <param name="empProfessionalEducationFilesPath">Get employee professional eductaion file path</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        /// <param name="employeeExitDocument">Get employee exit document file path</param>
        /// <returns>Get employee details</returns>
        public Employee AddEmployee_V2031(string mainServerWorkbenchConnectionString, string workbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    string lastestEmployeeCode = "";
                    lastestEmployeeCode = GetLatestEmployeeCode(workbenchConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Insert_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        if (!string.IsNullOrEmpty(lastestEmployeeCode) && lastestEmployeeCode != employee.EmployeeCode)
                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", lastestEmployeeCode);
                        else
                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);


                        employee.IdEmployee = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (employee.IdEmployee > 0)
                    {
                        if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)   //Save employee profile image.
                            SaveEmployeeProfileImage(employeeProfileImage, employee);
                        else if (employee.IsProfileImageDeleted)                                       //Delete employee profile image.
                            DeleteEmployeeProfileImage(employeeProfileImage, employee);

                        //if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                        //    SaveEmployeeExitDocument(employeeExitDocument, employee);
                        //else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                        //    DeleteEmployeeExitDocument(employeeExitDocument, employee);

                        AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                        AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                        AddEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                        AddEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                        AddEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                        AddEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                        AddEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                        AddEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                        AddEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                        AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                        AddEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                        AddEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployee_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employee;
        }

        /// <summary>
        /// This method is to add employee polyvalence
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get Employee ID</param>
        /// <param name="employeePolyvalences">Get list of employee polyvalences</param>
        public void AddEmployeePolyvalence(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeePolyvalence> employeePolyvalences)
        {
            try
            {
                if (employeePolyvalences != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeePolyvalence employeePolyvalence in employeePolyvalences)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeePolyvalence_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployeeJobDescription", employeePolyvalence.IdEmployeePolyvalence);
                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdCompany", employeePolyvalence.IdCompany);
                            mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeePolyvalence.IdJobDescription);
                            mySqlCommand.Parameters.AddWithValue("_PolyvalenceUsage", employeePolyvalence.PolyvalenceUsage);
                            mySqlCommand.Parameters.AddWithValue("_PolyvalenceRemarks", employeePolyvalence.PolyvalenceRemarks);

                            employeePolyvalence.IdEmployeePolyvalence = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeePolyvalences(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// This method is to update employee details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeProfileImage">Get employee image path</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path</param>
        /// <param name="empProfessionalEducationFilesPath">Get employee professional education file path</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        /// <param name="employeeExitDocument">Get employee exit document file path</param>
        /// <returns>If true updated employee otherwise false</returns>
        public bool UpdateEmployee_V2031(string mainServerWorkbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {
            bool isUpdatedEmployee = false;

            if (employee.IdEmployeeStatus == 136 || employee.IdEmployeeStatus == 137)
                employee.EmployeeCode = employee.EmployeeCode.Replace("D", "E");

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Update_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);
                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employee.ExitFileName);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)    //Save employee profile image.
                        SaveEmployeeProfileImage(employeeProfileImage, employee);
                    else if (employee.IsProfileImageDeleted)                                        //Delete employee profile image.
                        DeleteEmployeeProfileImage(employeeProfileImage, employee);

                    if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                        SaveEmployeeExitDocument(employeeExitDocument, employee);
                    else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                        DeleteEmployeeExitDocument(employeeExitDocument, employee);

                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                    AddUpdateDeleteEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                    AddUpdateDeleteEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                    AddUpdateDeleteEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                    AddUpdateDeleteEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                    AddUpdateDeleteEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                    AddUpdateDeleteEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                    AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                    AddUpdateDeleteEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                    AddUpdateDeleteEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                    AddUpdateDeleteEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployee_V2031(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }

        /// <summary>
        /// This method is to add/upadte/delete employee polyvalence
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emndep_geos db)</param>
        /// <param name="idEmployee">Get ID employee</param>
        /// <param name="employeePolyvalences">Get list of employee polyvalences details</param>
        public void AddUpdateDeleteEmployeePolyvalence(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeePolyvalence> employeePolyvalences)
        {
            try
            {
                if (employeePolyvalences != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeePolyvalence employeePolyvalence in employeePolyvalences)
                        {
                            employeePolyvalence.IdEmployee = idEmployee;

                            if (employeePolyvalence.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeePolyvalence_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeePolyvalence", employeePolyvalence.IdEmployeePolyvalence);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeePolyvalence.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeePolyvalence.IdEmployeePolyvalence > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeePolyvalence_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeePolyvalence", employeePolyvalence.IdEmployeePolyvalence);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", employeePolyvalence.IdCompany);
                                    mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeePolyvalence.IdJobDescription);
                                    mySqlCommand.Parameters.AddWithValue("_PolyvalenceUsage", employeePolyvalence.PolyvalenceUsage);
                                    mySqlCommand.Parameters.AddWithValue("_PolyvalenceRemarks", employeePolyvalence.PolyvalenceRemarks);


                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeePolyvalence.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeePolyvalence_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdCompany", employeePolyvalence.IdCompany);
                                mySqlCommand.Parameters.AddWithValue("_IdJobDescription", employeePolyvalence.IdJobDescription);
                                mySqlCommand.Parameters.AddWithValue("_PolyvalenceUsage", employeePolyvalence.PolyvalenceUsage);
                                mySqlCommand.Parameters.AddWithValue("_PolyvalenceRemarks", employeePolyvalence.PolyvalenceRemarks);


                                employeePolyvalence.IdEmployeePolyvalence = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeePolyvalences(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to get length of service related to department
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected id companies</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of department details</returns>
        public List<Department> GetLengthOfServiceByDepartment_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Department> departments = new List<Department>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetLengthOfServiceByDepartment_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Department department = new Department();

                            department.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                            if (empReader["DepartmentName"] != DBNull.Value)
                                department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                            if (empReader["DepartmentHtmlColor"] != DBNull.Value)
                                department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);

                            if (empReader["Years"] != DBNull.Value)
                                department.YearsCount = Convert.ToDecimal(empReader["Years"]);

                            departments.Add(department);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetLengthOfServiceByDepartment_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            List<Department> EmpHeadCountByDept = GetEmployeesHeadCountByDepartmentByIdCompany_V2031(workbenchConnectionString, idCompanies, selectedPeriod);

            foreach (Department item in departments)
            {
                if (EmpHeadCountByDept.Any(x => x.IdDepartment == item.IdDepartment))
                {
                    item.EmployeesCount = EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment).EmployeesCount;
                    item.EmployeesRecordCount = EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment).EmployeesRecordCount;
                    EmpHeadCountByDept.Remove(EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment));
                }
            }

            if (EmpHeadCountByDept.Count > 0)
            {
                departments.AddRange(EmpHeadCountByDept);
            }

            return departments;
        }


        /// <summary>
        /// This method is to get employees count related to selected id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of company details</returns>
        public List<Company> GetEmployeesCountByIdCompany_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Company> companies = new List<Company>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByIdCompany_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                    {
                        while (empReader.Read())
                        {
                            try
                            {
                                Company company = new Company();

                                company.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                if (empReader["Name"] != DBNull.Value)
                                {
                                    company.Name = Convert.ToString(empReader["Name"]);
                                    company.Alias = Convert.ToString(empReader["Alias"]);
                                }

                                if (empReader["EmpCount"] != DBNull.Value)
                                    company.EmployeesCount = Convert.ToUInt32(empReader["EmpCount"]);

                                companies.Add(company);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByIdCompany_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }

            return companies;
        }

        /// <summary>
        /// This method is to get employees head count related to department and id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected id companies</param>
        /// <param name="selectedPeriod">Fet selected period</param>
        /// <returns>List of department details</returns>
        public List<Department> GetEmployeesHeadCountByDepartmentByIdCompany_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<Department> departments = new List<Department>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpHeadcountByDeptByIdCompany_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Department department = new Department();

                                department.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                                if (empReader["DepartmentName"] != DBNull.Value)
                                    department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                                if (empReader["DepartmentHtmlColor"] != DBNull.Value)
                                    department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);

                                if (empReader["EmployeesRecordCount"] != DBNull.Value)
                                {
                                    department.EmployeesCount = Convert.ToUInt32(empReader["EmployeesRecordCount"]);
                                    department.EmployeesRecordCount = Convert.ToDecimal(empReader["EmployeesRecordCount"]);
                                }

                                departments.Add(department);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesHeadCountByDepartmentByIdCompany_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return departments;
        }

        /// <summary>
        /// This method is to get employees count related to job position anf selected id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of job description details</returns>
        public List<JobDescription> GetEmployeesCountByJobPositionByIdCompany_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpHeadcountByJobPositionByIdCompany_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                JobDescription jobDescription = new JobDescription();

                                jobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJd"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                {
                                    jobDescription.EmployeeCount = Convert.ToUInt64(empReader["EmployeeCount"]);
                                    jobDescription.EmployeeRecordCount = Convert.ToDecimal(empReader["EmployeeCount"]);
                                }

                                jobDescriptions.Add(jobDescription);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByJobPositionByIdCompany_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            List<JobDescription> jdLengthOfService = GetLengthOfServiceByJobPosition(workbenchConnectionString, idCompanies, selectedPeriod);

            foreach (JobDescription jd in jobDescriptions)
            {
                if (jdLengthOfService.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.YearsCount = jdLengthOfService.FirstOrDefault(x => x.IdJobDescription == jd.IdJobDescription).YearsCount;
                    jdLengthOfService.Remove(jdLengthOfService.FirstOrDefault(x => x.IdJobDescription == jd.IdJobDescription));
                }
            }

            if (jdLengthOfService.Count > 0)
            {
                jobDescriptions.AddRange(jdLengthOfService);
            }

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get birthday of employee related to selected year
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetBirthdaysOfEmployeesByYear_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetBirthdaysOfEmployeesByYear_V2031", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(reader["NativeName"]);

                            if (reader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(reader["BirthDay"]);
                                employee.DateOfBirth = Convert.ToDateTime(reader["BirthDate"]);
                            }

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            //employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetBirthdaysOfEmployeesByYear_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employees;
        }

        /// <summary>
        /// This method is to get employees count related to department area and selected to company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get employee count in each department area related selected companies</returns>
        public List<LookupValue> GetEmployeesCountByDepartmentAreaByIdCompany_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByDeptAreaByIdCompany_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                LookupValue lvDepartmentArea = new LookupValue();

                                lvDepartmentArea.IdLookupValue = Convert.ToInt32(empReader["IdLookupValue"]);

                                if (empReader["Value"] != DBNull.Value)
                                    lvDepartmentArea.Value = Convert.ToString(empReader["Value"]);

                                if (empReader["HtmlColor"] != DBNull.Value)
                                    lvDepartmentArea.HtmlColor = Convert.ToString(empReader["HtmlColor"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                {
                                    lvDepartmentArea.Count = Convert.ToUInt64(empReader["EmployeeCount"]);
                                    lvDepartmentArea.CountValue = Convert.ToDecimal(empReader["EmployeeCount"]);
                                }

                                departmentAreaList.Add(lvDepartmentArea);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByDepartmentAreaByIdCompany_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return departmentAreaList;
        }

        /// <summary>
        /// This method is to get employees count related to gender and selected companies
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get employee count related to gender and selected companies</returns>
        public List<LookupValue> GetEmployeesCountByGenderByIdCompany_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<LookupValue> genderList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByGenderByIdCompany_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                LookupValue lvGender = new LookupValue();

                                lvGender.IdLookupValue = Convert.ToInt32(empReader["IdLookupValue"]);

                                if (empReader["Value"] != DBNull.Value)
                                    lvGender.Value = Convert.ToString(empReader["Value"]);

                                if (empReader["HtmlColor"] != DBNull.Value)
                                    lvGender.HtmlColor = Convert.ToString(empReader["HtmlColor"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                    lvGender.Count = Convert.ToUInt64(empReader["EmployeeCount"]);

                                genderList.Add(lvGender);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByGenderByIdCompany_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return genderList;
        }

        /// <summary>
        /// This method is to get employees count related to contract and selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee count related to contract and selected companies ids</returns>
        public List<ContractSituation> GetEmployeesCountByContractByIdCompany_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<ContractSituation> contractSituations = new List<ContractSituation>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByContractByIdCompany_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                ContractSituation contractSituation = new ContractSituation();

                                contractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);

                                if (empReader["Name"] != DBNull.Value)
                                    contractSituation.Name = Convert.ToString(empReader["Name"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                    contractSituation.EmployeeCount = Convert.ToUInt64(empReader["EmployeeCount"]);

                                contractSituations.Add(contractSituation);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByContractByIdCompany_V2031(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return contractSituations;
        }

        /// <summary>
        /// This method is to get employees leaves for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period </param>
        /// <returns>List of employee leave details</returns>
        public List<EmployeeLeave> GetEmployeeLeavesForDashboard_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesForDashboard_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeLeave.Employee = new Employee();
                                employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["IdLeave"] != DBNull.Value)
                            {
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                employeeLeave.CompanyLeave = new CompanyLeave();
                                employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesForDashboard_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        /// <summary>
        /// This method is to get employee dcument expiration for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List fo employee document details</returns>
        public List<EmployeeDocument> GetEmployeeDocumentsExpirationForDashboard_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<EmployeeDocument> employeeDocuments = new List<EmployeeDocument>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeDocumentsExpirationForDashboard_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeDocument employeeDocument = new EmployeeDocument();

                            if (reader["IdEmployeeDocument"] != DBNull.Value)
                                employeeDocument.IdEmployeeDocument = Convert.ToUInt64(reader["IdEmployeeDocument"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeDocument.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeDocument.Employee = new Employee();
                                employeeDocument.Employee.IdEmployee = employeeDocument.IdEmployee;
                                employeeDocument.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeDocument.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["EmployeeDocumentName"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentName = Convert.ToString(reader["EmployeeDocumentName"]);

                            if (reader["EmployeeDocumentIdType"] != DBNull.Value)
                            {
                                employeeDocument.EmployeeDocumentIdType = Convert.ToInt32(reader["EmployeeDocumentIdType"]);

                                employeeDocument.EmployeeDocumentType = new LookupValue();
                                employeeDocument.EmployeeDocumentType.IdLookupValue = employeeDocument.EmployeeDocumentIdType;
                                employeeDocument.EmployeeDocumentType.Value = Convert.ToString(reader["Value"]);
                                employeeDocument.EmployeeDocumentType.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            if (reader["EmployeeDocumentNumber"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                            if (reader["EmployeeDocumentIssueDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentIssueDate = Convert.ToDateTime(reader["EmployeeDocumentIssueDate"]);

                            if (reader["EmployeeDocumentExpiryDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentExpiryDate = Convert.ToDateTime(reader["EmployeeDocumentExpiryDate"]);

                            employeeDocuments.Add(employeeDocument);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDocumentsExpirationForDashboard_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeDocuments;
        }


        /// <summary>
        /// This method to get employees with exit date for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetEmployeesWithExitDateForDashboard_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithExitDateForDashboard_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            employee.FirstName = Convert.ToString(reader["FirstName"]);
                            employee.LastName = Convert.ToString(reader["LastName"]);

                            employee.ExitDate = Convert.ToDateTime(reader["ExitDate"]);

                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesWithExitDateForDashboard_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get latest contract expiration for dashboard
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee contract situation details</returns>
        public List<EmployeeContractSituation> GetLatestContractExpirationForDashboard_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<EmployeeContractSituation> employeeContracts = new List<EmployeeContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithLatestContractExpiration_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeContractSituation employeeContract = new EmployeeContractSituation();

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeContract.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeContract.Employee = new Employee();
                                employeeContract.Employee.IdEmployee = employeeContract.IdEmployee;
                                employeeContract.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeContract.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["ExpirationDate"] != DBNull.Value)
                                employeeContract.ContractSituationEndDate = Convert.ToDateTime(reader["ExpirationDate"]);

                            employeeContracts.Add(employeeContract);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestContractExpirationForDashboard_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContracts;
        }

        /// <summary>
        /// This method is to get employees with anniversary date
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employees details</returns>
        public List<Employee> GetEmployeesWithAnniversaryDate_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithAnniversaryDate_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            employee.FirstName = Convert.ToString(reader["FirstName"]);
                            employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["AnniversaryDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(reader["AnniversaryDate"]);
                                employee.DateOfBirth = employee.BirthDate;

                                employee.LengthOfService = Convert.ToInt32(reader["AnniversaryYear"]);
                            }

                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesWithAnniversaryDate_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get all employees for organization related to selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of department details</returns>
        public List<Department> GetAllEmployeesForOrganizationByIdCompany_V2031(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<JobDescription> jobDescriptions = GetAllJobDescriptions(workbenchConnectionString);

            List<Employee> emp = new List<Employee>();
            emp = GetAllEmployeeOfJobDescription(workbenchConnectionString, idCompany, employeesProfileImagePath);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForOrganizationByIdCompany_V2031", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (reader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    }
                                }

                                if (reader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(reader["LengthOfService"]);
                                }

                                if (reader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmployeeJobCodes = Convert.ToString(reader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (reader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(reader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                    }

                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {

                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {

                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);

                                    }
                                }


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (Employee itememp in employees)
            {

                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            var grouppJD = emp.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdJobDescription);

            foreach (var item in grouppJD)
            {
                JobDescription jobDescription = jobDescriptions.Where(x => x.IdJobDescription == item.Key).FirstOrDefault();
                jobDescription.Employees = new List<Employee>();
                jobDescription.Employees.AddRange(item.ToList());
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);



            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(o => o.EmployeeJobDescription.JobDescription.JobDescriptionCode).ThenBy(o => o.FullName).ToList());
            }

            foreach (Department dept in departments)
            {
                dept.JobDescriptions = jobDescriptions.Where(x => x.IdDepartment == dept.IdDepartment).ToList();
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }

        /// <summary>
        /// This method is to get organization hierarchies
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench coinnection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of job description details</returns>
        public List<JobDescription> GetOrganizationHierarchy_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<JobDescription> jobDescriptions = GetAllJobDescriptionsHeirarchy(workbenchConnectionString);

            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesOrganizationHierarchy_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();

                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeJobDescription.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                if (reader["JobDescriptionUsage"] != DBNull.Value)
                                    employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                employeeJobDescription.Employee = new Employee();
                                employeeJobDescription.Employee.IdEmployee = employeeJobDescription.IdEmployee;
                                employeeJobDescription.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeJobDescription.Employee.LastName = Convert.ToString(reader["LastName"]);
                                employeeJobDescription.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                employeeJobDescriptions.Add(employeeJobDescription);
                            }
                        }
                        employeeJobDescriptions = employeeJobDescriptions.OrderBy(x => x.Employee.FullName).ToList();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOrganizationHierarchy_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (JobDescription jd in jobDescriptions)
            {
                if (employeeJobDescriptions.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    jd.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == jd.IdJobDescription));
                }

                if (jd.ChildJobDescriptions != null)
                {
                    foreach (var itemJD in jd.ChildJobDescriptions)
                    {
                        if (employeeJobDescriptions.Any(x => x.IdJobDescription == itemJD.IdJobDescription))
                        {
                            itemJD.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                            itemJD.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == itemJD.IdJobDescription));
                            jd.IsEmployeeExistInChildJD = true;
                        }
                    }
                }
            }

            jobDescriptions = IsChildJobDescriptionExistEmployee(jobDescriptions);

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get organizational chart department area details
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get list of Department are details</returns>
        public List<LookupValue> GetOrganizationalChartDepartmentArea_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<LookupValue> departmentAreaList = GetEmployeesCountByDepartmentAreaByIdCompany_V2031(workbenchConnectionString, idCompanies, selectedPeriod);

            double total = departmentAreaList.Sum(y => Convert.ToDouble(y.Count));
            foreach (LookupValue item in departmentAreaList)
            {
                item.Percentage = Math.Round((item.Count / total) * 100);
            }

            List<LookupValue> departmentAreaAvgList = GetEmployeesAverageByDepartmentAreaByIdCompany_V2031(workbenchConnectionString, idCompanies, selectedPeriod);

            double totalAvg = Convert.ToDouble(departmentAreaAvgList.Sum(x => x.Average));
            foreach (LookupValue item in departmentAreaAvgList)
            {
                LookupValue lv = departmentAreaList.FirstOrDefault(x => x.IdLookupValue == item.IdLookupValue);

                if (lv != null)
                {
                    //lv.Average = item.Average;
                    lv.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                }
                else
                {
                    item.Percentage = 0;
                    item.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                    departmentAreaList.Add(item);
                }
            }

            return departmentAreaList;
        }

        /// <summary>
        /// This method is to get employees average related to department area and selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employees</returns>
        public List<LookupValue> GetEmployeesAverageByDepartmentAreaByIdCompany_V2031(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpAvgByDeptAreaByIdCompany_V2031", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = empCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            LookupValue lvDepartmentArea = new LookupValue();

                            lvDepartmentArea.IdLookupValue = Convert.ToInt32(reader["IdLookupValue"]);

                            if (reader["Value"] != DBNull.Value)
                                lvDepartmentArea.Value = Convert.ToString(reader["Value"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                lvDepartmentArea.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            if (reader["AvgEmployees"] != DBNull.Value)
                                lvDepartmentArea.Average = Convert.ToDouble(reader["AvgEmployees"]);

                            departmentAreaList.Add(lvDepartmentArea);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesAverageByDepartmentAreaByIdCompany(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return departmentAreaList;
        }

        /// <summary>
        /// This method is to update company details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="company">Get company details</param>
        /// <param name="ImagePath">Get image path</param>
        /// <returns>Get company details</returns>
        public Company UpdateCompany_V2031(string mainServerWorkbenchConnectionString, Company company, string ImagePath)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompaniesUpdate_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Name", company.Name);
                        mySqlCommand.Parameters.AddWithValue("_RegisteredName", company.RegisteredName);
                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", company.Alias);
                        mySqlCommand.Parameters.AddWithValue("_FiscalName", company.CIF);
                        mySqlCommand.Parameters.AddWithValue("_Size", company.Size);
                        mySqlCommand.Parameters.AddWithValue("_EstablishmentDate", company.EstablishmentDate);
                        mySqlCommand.Parameters.AddWithValue("_Phone", company.Telephone);
                        mySqlCommand.Parameters.AddWithValue("_Email", company.Email);
                        mySqlCommand.Parameters.AddWithValue("_Fax", company.Fax);
                        mySqlCommand.Parameters.AddWithValue("_Website", company.Website);
                        mySqlCommand.Parameters.AddWithValue("_Address", company.Address);
                        mySqlCommand.Parameters.AddWithValue("_City", company.City);
                        mySqlCommand.Parameters.AddWithValue("_Region", company.Region);
                        mySqlCommand.Parameters.AddWithValue("_ZipCode", company.ZipCode);
                        mySqlCommand.Parameters.AddWithValue("_IdCountry", company.IdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", company.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", company.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", company.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                        mySqlCommand.Parameters.AddWithValue("_IdCompany", company.IdCompany);
                        mySqlCommand.Parameters.AddWithValue("_IsCompany", company.IsCompany);
                        mySqlCommand.Parameters.AddWithValue("_IsOrganization", company.IsOrganization);
                        mySqlCommand.Parameters.AddWithValue("_IsLocation", company.IsLocation);


                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }
                    AddCompanyChangelogs(mainServerWorkbenchConnectionString, company.IdCompany, company.CompanyChangelogs);

                    if (company.ImageInBytes != null && !company.IsImageDeleted)
                        SaveCompanyImage(ImagePath, company);
                    else if (company.IsImageDeleted)
                        DeleteCompanyImage(ImagePath, company);

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCompany(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return company;
        }

        /// <summary>
        /// This method is to get is company authorized plants related to id user
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idUser">Get id user</param>
        /// <returns>List of company details</returns>
        public List<Company> GetIsCompanyAuthorizedPlantsByIdUser(string workbenchConnectionString, Int32 idUser)
        {
            List<Company> companies = new List<Company>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("companies_GetIsCompanyAuthorizedPlantsByIdUser", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idUser", idUser);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Company company = new Company();
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                company.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                company.Name = Convert.ToString(reader["CompanyName"]);
                                company.Alias = Convert.ToString(reader["Alias"]);
                                company.ShortName = Convert.ToString(reader["Alias"]);
                                if (reader["IdCountry"] != DBNull.Value)
                                {
                                    company.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country = new Country();
                                    company.Country.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country.Name = Convert.ToString(reader["CountryName"]);
                                }

                            }
                            companies.Add(company);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIsCompanyAuthorizedPlantsByIdUser(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companies;
        }


        /// <summary>
        /// This method is to get is organization authorized plants related to id user.
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idUser">Get id user details</param>
        /// <returns>List of companies details</returns>
        public List<Company> GetIsOrganizationAuthorizedPlantsByIdUser(string workbenchConnectionString, Int32 idUser)
        {
            List<Company> companies = new List<Company>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("companies_GetIsOrganizationAuthorizedPlantsByIdUser", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idUser", idUser);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Company company = new Company();
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                company.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                company.Name = Convert.ToString(reader["CompanyName"]);
                                company.Alias = Convert.ToString(reader["Alias"]);
                                company.ShortName = Convert.ToString(reader["Alias"]);
                                if (reader["IdCountry"] != DBNull.Value)
                                {
                                    company.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country = new Country();
                                    company.Country.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country.Name = Convert.ToString(reader["CountryName"]);
                                }

                            }
                            companies.Add(company);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIsOrganizationAuthorizedPlantsByIdUser(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companies;
        }

        /// <summary>
        /// This method is to get is location authorized plants related to id user
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idUser">Get id user</param>
        /// <returns>List of company details</returns>
        public List<Company> GetIsLocationAuthorizedPlantsByIdUser(string workbenchConnectionString, Int32 idUser)
        {
            List<Company> companies = new List<Company>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("companies_GetIsLocationAuthorizedPlantsByIdUser", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idUser", idUser);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Company company = new Company();
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                company.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                company.Name = Convert.ToString(reader["CompanyName"]);
                                company.Alias = Convert.ToString(reader["Alias"]);
                                company.ShortName = Convert.ToString(reader["Alias"]);
                                if (reader["IdCountry"] != DBNull.Value)
                                {
                                    company.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country = new Country();
                                    company.Country.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country.Name = Convert.ToString(reader["CountryName"]);
                                }

                            }
                            companies.Add(company);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIsLocationAuthorizedPlantsByIdUser(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companies;
        }


        /// <summary>
        /// This method is to get employee contract situation related to employee id
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <returns>List of employee contract situation details</returns>
        public List<EmployeeContractSituation> GetEmployeeContractSituationsByIdEmployee_V2031(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeContractSituation> employeeContractSituations = new List<EmployeeContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractSituationsByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                            employeeContractSituation.IdEmployee = idEmployee;

                            if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);

                            if (reader["IdContractSituation"] != DBNull.Value)
                            {
                                employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);

                                employeeContractSituation.ContractSituation = new ContractSituation();
                                employeeContractSituation.ContractSituation.IdContractSituation = employeeContractSituation.IdContractSituation;
                                employeeContractSituation.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);
                            }

                            if (reader["IdProfessionalCategory"] != DBNull.Value)
                            {
                                employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                employeeContractSituation.ProfessionalCategory = new ProfessionalCategory();
                                employeeContractSituation.ProfessionalCategory.IdProfessionalCategory = employeeContractSituation.IdProfessionalCategory;
                                employeeContractSituation.ProfessionalCategory.Name = Convert.ToString(reader["ProfessionalCategory"]);
                            }

                            if (reader["ContractSituationStartDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                            if (reader["ContractSituationEndDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                            if (reader["ContractSituationFileName"] != DBNull.Value)
                                employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);

                            if (reader["ContractSituationRemarks"] != DBNull.Value)
                                employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeContractSituation.Company = new Company();
                                employeeContractSituation.Company.IdCompany = employeeContractSituation.IdCompany.Value;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeContractSituation.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeContractSituation.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            employeeContractSituations.Add(employeeContractSituation);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeContractSituationsByIdEmployee_V2031(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContractSituations;
        }

        /// <summary>
        /// This method is to add employee contract situations
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeContractSituations">Get employee contract situations details</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        public void AddEmployeeContractSituations_V2031(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeContractSituation> employeeContractSituations, string empContractSituationFilesPath)
        {
            try
            {
                if (employeeContractSituations != null)
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeContractSituation employeeContractSituation in employeeContractSituations)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Insert_V2031", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdContractSituation", employeeContractSituation.IdContractSituation);
                            mySqlCommand.Parameters.AddWithValue("_IdProfessionalCategory", employeeContractSituation.IdProfessionalCategory);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationStartDate", employeeContractSituation.ContractSituationStartDate);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationEndDate", employeeContractSituation.ContractSituationEndDate);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationFileName", employeeContractSituation.ContractSituationFileName);
                            mySqlCommand.Parameters.AddWithValue("_ContractSituationRemarks", employeeContractSituation.ContractSituationRemarks);
                            mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeContractSituation.IdCompany);


                            // Save a contract situation document file.
                            if (employeeContractSituation.ContractSituationFileInBytes != null)
                                SaveEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeContractSituations_V2031(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to add/update/delete employee contract situations
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeContractSituations">Get employee contract situations details</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situations file path</param>
        public void AddUpdateDeleteEmployeeContractSituations_V2031(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeContractSituation> employeeContractSituations, string empContractSituationFilesPath)
        {
            try
            {
                if (employeeContractSituations != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeContractSituation employeeContractSituation in employeeContractSituations)
                        {
                            employeeContractSituation.IdEmployee = employee.IdEmployee;

                            if (employeeContractSituation.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeContractSituation", employeeContractSituation.IdEmployeeContractSituation);

                                DeleteEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeContractSituation.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeContractSituation.IdEmployeeContractSituation > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Update_V2031", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeContractSituation", employeeContractSituation.IdEmployeeContractSituation);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_IdContractSituation", employeeContractSituation.IdContractSituation);
                                    mySqlCommand.Parameters.AddWithValue("_IdProfessionalCategory", employeeContractSituation.IdProfessionalCategory);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationStartDate", employeeContractSituation.ContractSituationStartDate);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationEndDate", employeeContractSituation.ContractSituationEndDate);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationFileName", employeeContractSituation.ContractSituationFileName);
                                    mySqlCommand.Parameters.AddWithValue("_ContractSituationRemarks", employeeContractSituation.ContractSituationRemarks);
                                    mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeContractSituation.IdCompany);

                                    //Delete Old file of contract situation document 
                                    if (!string.IsNullOrEmpty(employeeContractSituation.OldFileName))
                                        DeleteEmployeeContractSituationOldDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                    // Save a contract situation document file.
                                    if (employeeContractSituation.ContractSituationFileInBytes != null)
                                        SaveEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);
                                    else if (employeeContractSituation.IsContractSituationFileDeleted)
                                        DeleteEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeContractSituation.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeContractSituation_Insert_V2031", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdContractSituation", employeeContractSituation.IdContractSituation);
                                mySqlCommand.Parameters.AddWithValue("_IdProfessionalCategory", employeeContractSituation.IdProfessionalCategory);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationStartDate", employeeContractSituation.ContractSituationStartDate);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationEndDate", employeeContractSituation.ContractSituationEndDate);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationFileName", employeeContractSituation.ContractSituationFileName);
                                mySqlCommand.Parameters.AddWithValue("_ContractSituationRemarks", employeeContractSituation.ContractSituationRemarks);
                                mySqlCommand.Parameters.AddWithValue("_IdCompany", employeeContractSituation.IdCompany);


                                // Save a contract Situation document file.
                                if (employeeContractSituation.ContractSituationFileInBytes != null)
                                    SaveEmployeeContractSituationDocument(empContractSituationFilesPath, employee, employeeContractSituation);

                                employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeContractSituations_V2031(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to get all employees related to id company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employees image path</param>
        /// <param name="idCompany">Get selected id companies</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeesByIdCompany_V2031(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByIdCompany_V2031", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["IdGender"] != DBNull.Value)
                                {
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                    employee.Gender = new LookupValue();
                                    employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                    employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                                }

                                if (empReader["IdMaritalStatus"] != DBNull.Value)
                                {
                                    employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                    employee.MaritalStatus = new LookupValue();
                                    employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                    employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                                }

                                if (empReader["IdNationality"] != DBNull.Value)
                                {
                                    employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                    employee.Nationality = new Country();
                                    employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                    employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                                }

                                if (empReader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (empReader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (empReader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(empReader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (empReader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (empReader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["CompanyMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(empReader["CompanyMobiles"]);
                                    employee.EmployeeContactCompanyMobileList = Convert.ToString(empReader["CompanyMobiles"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyMobileList != null && employee.EmployeeContactCompanyMobileList.Count > 0)
                                    {
                                        employee.EmployeeContactMobile = employee.EmployeeContactCompanyMobileList.First();
                                    }
                                }

                                if (empReader["CompanyEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyEmailList = Convert.ToString(empReader["CompanyEmails"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyEmailList != null && employee.EmployeeContactCompanyEmailList.Count > 0)
                                    {
                                        employee.EmployeeContactEmail = employee.EmployeeContactCompanyEmailList.First();
                                    }
                                }

                                if (empReader["PrivateMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateMobiles = Convert.ToString(empReader["PrivateMobiles"]);
                                    employee.EmployeeContactPrivateMobileList = Convert.ToString(empReader["PrivateMobiles"]).Split('\n').ToList<string>();
                                }

                                if (empReader["PrivateEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateEmailList = Convert.ToString(empReader["PrivateEmails"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }


                                if (empReader["Languages"] != DBNull.Value)
                                    employee.Languages = Convert.ToString(empReader["Languages"]);

                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["EmployeeDocumentNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocNationalId = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentName = Convert.ToString(empReader["EmployeeDocumentName"]);
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                }

                                if (empReader["DocPassportNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPassport = Convert.ToString(empReader["DocPassportNumber"]);
                                }

                                if (empReader["DocDrLicenseNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocDrLicense = Convert.ToString(empReader["DocDrLicenseNumber"]);
                                }

                                if (empReader["DocPubInsNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPubIns = Convert.ToString(empReader["DocPubInsNumber"]);
                                }

                                if (empReader["DocPriInsNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocPriIns = Convert.ToString(empReader["DocPriInsNumber"]);
                                }

                                if (empReader["DocVisaNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocVisa = Convert.ToString(empReader["DocVisaNumber"]);
                                }

                                if (empReader["DocOtherNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocOther = Convert.ToString(empReader["DocOtherNumber"]);
                                }

                                if (empReader["DocClockIdNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocClockId = Convert.ToString(empReader["DocClockIdNumber"]);
                                }

                                // Exit 
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                if (empReader["ExitIdReason"] != DBNull.Value)
                                {
                                    employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                    employee.ExitReason = new LookupValue();
                                    employee.ExitReason.IdLookupValue = (Int32)employee.ExitIdReason;
                                    employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                                }

                                if (empReader["ExitRemarks"] != DBNull.Value)
                                    employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                    empJobDescription.JobDescription = new JobDescription();

                                    if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);
                                    }



                                    if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);
                                    }

                                    if (empReader["JobCodeAndTitles"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitleAndCode = Convert.ToString(empReader["JobCodeAndTitles"]);
                                    }


                                    if (empReader["DepartmentName"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                    }



                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }

                                    empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["MaxJobDescriptionUsage"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (empReader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);

                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }
                                }

                                if (empReader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(empReader["LengthOfService"]);

                                }

                                if (empReader["IdEmployeeStatus"] != DBNull.Value)
                                {
                                    employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus = new LookupValue();
                                    employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus.Value = empReader["EmployeeStatus"].ToString();
                                    employee.EmployeeStatus.HtmlColor = empReader["EmployeeStatusColor"].ToString();

                                    if (empReader["EmployeeIdImage"] != DBNull.Value)
                                        employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["EmployeeIdImage"].ToString());

                                    if (empReader["EmployeeStatusPosition"] != DBNull.Value)
                                        employee.EmployeeStatus.Position = Convert.ToInt32(empReader["EmployeeStatusPosition"].ToString());
                                }

                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["CompanyShiftName"] != DBNull.Value)
                                        employee.CompanyShift.Name = Convert.ToString(empReader["CompanyShiftName"]);

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["WorkScheduleName"]);
                                    }

                                    if (empReader["StartTime1"] != DBNull.Value)
                                        employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                    if (empReader["EndTime1"] != DBNull.Value)
                                        employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                    if (empReader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];
                                }

                                if (empReader["IdCompanyLocation"] != DBNull.Value)
                                {
                                    employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation = new Company();
                                    employee.CompanyLocation.IdCompany = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["Location"]);
                                }

                                if (empReader["Organization"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Organization"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Organization = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["Company"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Company"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Company = string.Join("\n", tempDifferentJobComp.ToArray());
                                }


                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    Employee emp = employees.Where(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])).FirstOrDefault();
                                    if (emp != null)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                        if (empReader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                        if (empReader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(empReader["ContractSituationFileName"]);
                                        if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);
                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);
                                        if (empReader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(empReader["ContractSituationRemarks"]);
                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);
                                        if (empReader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(empReader["IdProfessionalCategory"]);


                                        emp.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesByIdCompany_V2031().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        /// <summary>
        /// This method is to get all employees for attendance related to selected id companies
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employees image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2031(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2031", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                            if (empReader["IdEmployeeJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(empReader["IdEmployeeJobDescription"]);
                                if (empReader["IdCompany"] != DBNull.Value)
                                    employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);
                                    employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                    employee.EmployeeJobDescription.JobDescription.IdJobDescription = employee.EmployeeJobDescription.IdJobDescription;
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                    if (empReader["IdDepartment"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                                        employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employee.EmployeeJobDescription.JobDescription.Department.IdDepartment = employee.EmployeeJobDescription.JobDescription.IdDepartment;
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);
                                    }
                                }
                            }

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["Year"] != DBNull.Value)
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                    if (empReader["DailyHoursCount"] != DBNull.Value)
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                    if (empReader["WorkingDays"] != DBNull.Value)
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                }
                            }

                            employee.EmployeeContractSituation = new EmployeeContractSituation();

                            if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                            if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                            if (empReader["ContractIdCompany"] != DBNull.Value)
                            {
                                employee.EmployeeContractSituation.Company = new Company();
                                employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                            }

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }

        /// <summary>
        /// This method is to get selected id company employee attendance
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get id company</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee attendance details</returns>
        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2031", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                            if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                            }

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeAttendance.Employee = new Employee();
                                employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                employeeAttendance.Employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employeeAttendance.Employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["JDIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(reader["JDIdCompany"]);
                                    employeeAttendance.Employee.EmployeeJobDescription.Company = new Company();
                                    employeeAttendance.Employee.EmployeeJobDescription.Company.IdCompany = employeeAttendance.Employee.EmployeeJobDescription.IdCompany;

                                    if (reader["CompanyName"] != DBNull.Value)
                                        employeeAttendance.Employee.EmployeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                    if (reader["CompanyAlias"] != DBNull.Value)
                                        employeeAttendance.Employee.EmployeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                                }

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    employeeAttendance.Employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                    employeeAttendance.Employee.EmployeeJobDescription.JobDescription.IdJobDescription = employeeAttendance.Employee.EmployeeJobDescription.IdJobDescription;
                                    employeeAttendance.Employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.IdDepartment = employeeAttendance.Employee.EmployeeJobDescription.JobDescription.IdDepartment;
                                        employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                        if (reader["DepartmentInUse"] != DBNull.Value)
                                            employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);

                                        if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                            employeeAttendance.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                    }
                                }

                                if (reader["TotalWorkedHours"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                    //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                    string span = employeeAttendance.Employee.TotalWorkedHours;
                                    employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                               int.Parse(span.Split(':')[1]),    // minutes
                                                               0);
                                }

                                if (reader["IdCompanyWork"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                    employeeAttendance.CompanyWork = new CompanyWork();
                                    employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                    employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                    employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeAttendance.CompanyShift = new CompanyShift();
                                    employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                    if (reader["DailyHoursCount"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                    if (reader["Year"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                    if (reader["WorkingDays"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                }
                            }

                            if (reader["empContractIdCompany"] != DBNull.Value)
                            {
                                employeeAttendance.CompanyContract = new Company();
                                employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                            }

                            employeeAttendances.Add(employeeAttendance);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employeeAttendances;
        }

        /// <summary>
        /// This method is to get employee leaves related to selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee leave details</returns>
        public List<EmployeeLeave> GetEmployeeLeavesBySelectedIdCompany_V2031(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();


            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesBySelectedIdCompany_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeLeave employeeLeave = new EmployeeLeave();

                                if (reader["IdEmployeeLeave"] != DBNull.Value)
                                    employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeLeave.Employee = new Employee();
                                    employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    if (reader["EmployeeCode"] != DBNull.Value)
                                        employeeLeave.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                    if (reader["FirstName"] != DBNull.Value)
                                        employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                    if (reader["LastName"] != DBNull.Value)
                                        employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                        employeeLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    if (reader["IdGender"] != DBNull.Value)
                                        employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                    if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeJobDescription = new EmployeeJobDescription();

                                        employeeLeave.Employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                        employeeLeave.Employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                    employeeLeave.CompanyLeave = new CompanyLeave();
                                    employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                    employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                    employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeLeave.CompanyLeave.Company = new Company();
                                        employeeLeave.CompanyLeave.Company.IdCompany = employeeLeave.CompanyLeave.IdCompany;

                                        if (reader["CompanyAlias"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.Alias = Convert.ToString(reader["CompanyAlias"]);

                                        if (reader["CompanyName"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.Name = Convert.ToString(reader["CompanyName"]);

                                        employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule = new CompanyAnnualSchedule();

                                        employeeLeave.CompanyLeave.Company.CompanySetting = new CompanySetting();

                                        if (reader["CompanySetting"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeLeave.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeLeave.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeLeave.StartDate.Value, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeLeave.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["FileName"] != DBNull.Value)
                                    employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                                if (reader["Remark"] != DBNull.Value)
                                    employeeLeave.Remark = Convert.ToString(reader["Remark"]);

                                if (reader["IsAllDayEvent"] != DBNull.Value)
                                    employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);



                                employeeLeaves.Add(employeeLeave);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesBySelectedIdCompany_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }


        /// <summary>
        /// This method is to add job description
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="EmpJobDescriptionsFilesPath">Get employee job description file path</param>
        /// <param name="jobDescription">Get job description details</param>
        /// <returns>Get added job description details</returns>
        public JobDescription AddJobDescription_V2031(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Insert_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);

                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);
                        mySqlCommand.Parameters.AddWithValue("_IdJDLevel", jobDescription.IdJDLevel);

                        jobDescription.IdJobDescription = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddJobDescription_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        /// <summary>
        /// This method is to update job description details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="EmpJobDescriptionsFilesPath">Get employee job description file path</param>
        /// <param name="jobDescription">Get job description details</param>
        /// <returns>Get job description details</returns>
        public JobDescription UpdateJobDescription_V2031(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Update_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdJobDescription", jobDescription.IdJobDescription);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);

                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);
                        mySqlCommand.Parameters.AddWithValue("_IdJDLevel", jobDescription.IdJDLevel);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (!string.IsNullOrEmpty(jobDescription.OldJobDescriptionCode) && !string.IsNullOrEmpty(jobDescription.JobDescriptionCode) && jobDescription.JobDescriptionCode != jobDescription.OldJobDescriptionCode)
                    {
                        string oldFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.OldJobDescriptionCode);
                        string newFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.JobDescriptionCode);

                        if (fileMgr.FileExists(oldFileName))
                            fileMgr.Move(oldFileName, newFileName);
                    }

                    if (jobDescription.IsJobDescriptionFileUpdated && jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateJobDescription_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        /// <summary>
        /// This method is to get all job descriptions
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <returns>List of job description details</returns>
        public List<JobDescription> GetAllJobDescriptions_V2031(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllJobDescriptions_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                jobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel = new LookupValue();
                                jobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel.Value = reader["JDLevel"].ToString();
                                jobDescription.JDLevel.HtmlColor = reader["JDHtmlColor"].ToString();
                                if (reader["JDImage"] != DBNull.Value)
                                    jobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDImage"].ToString());
                            }

                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptions_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }


        /// <summary>
        /// This method is to get employee details related employee documnet number and selected period
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="EmployeeDocumentNumbers">Get employee document numbers</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetEmpDtlByEmpDocNoAndPeriod_V2031(string workbenchConnectionString, string EmployeeDocumentNumbers, string idCompany, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employees_GetEmpDtlByEmpDocNoAndPeriod_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumbers);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employee.LastName = Convert.ToString(reader["LastName"]);
                                employee.EmployeeDocument = new EmployeeDocument();
                                employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["JDIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdCompany = Convert.ToInt32(reader["JDIdCompany"]);
                                    employee.EmployeeJobDescription.Company = new Company();
                                    employee.EmployeeJobDescription.Company.IdCompany = employee.EmployeeJobDescription.IdCompany;

                                    if (reader["CompanyName"] != DBNull.Value)
                                        employee.EmployeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                    if (reader["CompanyAlias"] != DBNull.Value)
                                        employee.EmployeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                                }

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    employee.EmployeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                    employee.EmployeeJobDescription.JobDescription.IdJobDescription = employee.EmployeeJobDescription.IdJobDescription;
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        employee.EmployeeJobDescription.JobDescription.Department = new Department();
                                        employee.EmployeeJobDescription.JobDescription.Department.IdDepartment = employee.EmployeeJobDescription.JobDescription.IdDepartment;
                                        employee.EmployeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                        if (reader["DepartmentInUse"] != DBNull.Value)
                                            employee.EmployeeJobDescription.JobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);

                                        if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                            employee.EmployeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                    }
                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }

                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation = new EmployeeContractSituation();
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                            }
                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method to get authorized plant related to id user
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idUser">Get id user</param>
        /// <returns>List of companies</returns>
        public List<Company> GetAuthorizedPlantsByIdUser_V2031(string workbenchConnectionString, Int32 idUser)
        {
            List<Company> companies = new List<Company>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("companies_GetAuthorizedPlantsByIdUser_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idUser", idUser);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Company company = new Company();
                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                company.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                company.Name = Convert.ToString(reader["CompanyName"]);
                                company.Alias = Convert.ToString(reader["Alias"]);
                                company.ShortName = Convert.ToString(reader["Alias"]);
                                if (reader["IdCountry"] != DBNull.Value)
                                {
                                    company.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country = new Country();
                                    company.Country.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                    company.Country.Name = Convert.ToString(reader["CountryName"]);
                                }
                                if (reader["IsLocation"] != DBNull.Value)
                                    company.IsLocation = Convert.ToByte(reader["IsLocation"]);

                                if (reader["IsOrganization"] != DBNull.Value)
                                    company.IsOrganization = Convert.ToByte(reader["IsOrganization"]);

                                if (reader["IsCompany"] != DBNull.Value)
                                    company.IsCompany = Convert.ToByte(reader["IsCompany"]);
                            }
                            companies.Add(company);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAuthorizedPlantsByIdUser_V2031(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companies;
        }

        /// <summary>
        /// This method is to get employee leaves related to selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected cmpanies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee leave details</returns>
        public List<EmployeeLeave> GetEmployeeLeavesBySelectedIdCompany_V2032(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();


            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesBySelectedIdCompany_V2032", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeLeave employeeLeave = new EmployeeLeave();

                                if (reader["IdEmployeeLeave"] != DBNull.Value)
                                    employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeLeave.Employee = new Employee();
                                    employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    if (reader["EmployeeCode"] != DBNull.Value)
                                        employeeLeave.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                    if (reader["FirstName"] != DBNull.Value)
                                        employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                    if (reader["LastName"] != DBNull.Value)
                                        employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                        employeeLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    if (reader["IdGender"] != DBNull.Value)
                                        employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeLeave.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeLeave.Employee.EmpJobCodes.Split('\n');
                                        employeeLeave.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeLeave.Employee.EmployeeJobTitles.Split('\n');
                                        employeeLeave.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeLeave.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeLeave.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeLeave.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeLeave.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }


                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                    employeeLeave.CompanyLeave = new CompanyLeave();
                                    employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                    employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                    employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeLeave.CompanyLeave.Company = new Company();

                                        employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule = new CompanyAnnualSchedule();

                                        employeeLeave.CompanyLeave.Company.CompanySetting = new CompanySetting();

                                        if (reader["CompanySetting"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeLeave.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeLeave.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeLeave.StartDate.Value, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeLeave.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["FileName"] != DBNull.Value)
                                    employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                                if (reader["Remark"] != DBNull.Value)
                                    employeeLeave.Remark = Convert.ToString(reader["Remark"]);

                                if (reader["IsAllDayEvent"] != DBNull.Value)
                                    employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);



                                employeeLeaves.Add(employeeLeave);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesBySelectedIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        /// <summary>
        /// This method is to get selected companies ids employee attendance
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee attendance details</returns>
        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2032(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2032", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employeeAttendances;
        }

        /// <summary>
        /// This method is to get all employees for organization related to selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employees image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of department details</returns>
        public List<Department> GetAllEmployeesForOrganizationByIdCompany_V2032(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<JobDescription> jobDescriptions = GetAllJobDescriptions(workbenchConnectionString);

            List<Employee> emp = new List<Employee>();
            emp = GetAllEmployeeOfJobDescription(workbenchConnectionString, idCompany, employeesProfileImagePath);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForOrganizationByIdCompany_V2032", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (reader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    }
                                }

                                if (reader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(reader["LengthOfService"]);
                                }

                                if (reader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmployeeJobCodes = Convert.ToString(reader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (reader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(reader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                    }

                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {

                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {

                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);

                                    }
                                }


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (Employee itememp in employees)
            {

                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            var grouppJD = emp.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdJobDescription);

            foreach (var item in grouppJD)
            {
                JobDescription jobDescription = jobDescriptions.Where(x => x.IdJobDescription == item.Key).FirstOrDefault();
                jobDescription.Employees = new List<Employee>();
                jobDescription.Employees.AddRange(item.ToList());
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);



            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(o => o.EmployeeJobDescription.JobDescription.JobDescriptionCode).ThenBy(o => o.FullName).ToList());
            }

            foreach (Department dept in departments)
            {
                dept.JobDescriptions = jobDescriptions.Where(x => x.IdDepartment == dept.IdDepartment).ToList();
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }

        /// <summary>
        /// This method is to update company shift
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="companyShift">Gewt company shift details</param>
        /// <returns>updated company shift details</returns>
        public CompanyShift UpdateCompanyShift_V2032(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Update_V2032", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", companyShift.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_MonStartTime", companyShift.MonStartTime);
                        mySqlCommand.Parameters.AddWithValue("_MonEndTime", companyShift.MonEndTime);
                        mySqlCommand.Parameters.AddWithValue("_MonBreakTime", companyShift.MonBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_TueStartTime", companyShift.TueStartTime);
                        mySqlCommand.Parameters.AddWithValue("_TueEndTime", companyShift.TueEndTime);
                        mySqlCommand.Parameters.AddWithValue("_TueBreakTime", companyShift.TueBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_WedStartTime", companyShift.WedStartTime);
                        mySqlCommand.Parameters.AddWithValue("_WedEndTime", companyShift.WedEndTime);
                        mySqlCommand.Parameters.AddWithValue("_WedBreakTime", companyShift.WedBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuStartTime", companyShift.ThuStartTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuEndTime", companyShift.ThuEndTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuBreakTime", companyShift.ThuBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_FriStartTime", companyShift.FriStartTime);
                        mySqlCommand.Parameters.AddWithValue("_FriEndTime", companyShift.FriEndTime);
                        mySqlCommand.Parameters.AddWithValue("_FriBreakTime", companyShift.FriBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SatStartTime", companyShift.SatStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SatEndTime", companyShift.SatEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SatBreakTime", companyShift.SatBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SunStartTime", companyShift.SunStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SunEndTime", companyShift.SunEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SunBreakTime", companyShift.SunBreakTime);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCompanyShift_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }

        /// <summary>
        /// This method is to add company shift
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="companyShift">Get company shift details to add</param>
        /// <returns>Get added company shift details </returns>
        public CompanyShift AddCompanyShift_V2032(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Insert_V2032", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_MonStartTime", companyShift.MonStartTime);
                        mySqlCommand.Parameters.AddWithValue("_MonEndTime", companyShift.MonEndTime);
                        mySqlCommand.Parameters.AddWithValue("_MonBreakTime", companyShift.MonBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_TueStartTime", companyShift.TueStartTime);
                        mySqlCommand.Parameters.AddWithValue("_TueEndTime", companyShift.TueEndTime);
                        mySqlCommand.Parameters.AddWithValue("_TueBreakTime", companyShift.TueBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_WedStartTime", companyShift.WedStartTime);
                        mySqlCommand.Parameters.AddWithValue("_WedEndTime", companyShift.WedEndTime);
                        mySqlCommand.Parameters.AddWithValue("_WedBreakTime", companyShift.WedBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuStartTime", companyShift.ThuStartTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuEndTime", companyShift.ThuEndTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuBreakTime", companyShift.ThuBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_FriStartTime", companyShift.FriStartTime);
                        mySqlCommand.Parameters.AddWithValue("_FriEndTime", companyShift.FriEndTime);
                        mySqlCommand.Parameters.AddWithValue("_FriBreakTime", companyShift.FriBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SatStartTime", companyShift.SatStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SatEndTime", companyShift.SatEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SatBreakTime", companyShift.SatBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SunStartTime", companyShift.SunStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SunEndTime", companyShift.SunEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SunBreakTime", companyShift.SunBreakTime);

                        companyShift.IdCompanyShift = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCompanyShift_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }

        /// <summary>
        /// This method is to get all company shift related to selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <returns>List of company shifts details</returns>
        public List<CompanyShift> GetAllCompanyShiftsByIdCompany_V2032(string workbenchConnectionString, string idCompanies = null)
        {
            List<CompanyShift> companyShifts = new List<CompanyShift>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyShiftsByIdCompany_V2032", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyShift companyShift = new CompanyShift();

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["ShiftName"] != DBNull.Value)
                                companyShift.Name = Convert.ToString(reader["ShiftName"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanySchedule = new CompanySchedule();
                                companyShift.CompanySchedule.IdCompanySchedule = companyShift.IdCompanySchedule;

                                if (reader["WorkSchedule"] != DBNull.Value)
                                    companyShift.CompanySchedule.Name = Convert.ToString(reader["WorkSchedule"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                {
                                    companyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    companyShift.CompanySchedule.Company = new Company();
                                    companyShift.CompanySchedule.Company.IdCompany = companyShift.CompanySchedule.IdCompany;
                                    companyShift.CompanySchedule.Company.Name = Convert.ToString(reader["CompanyName"]);
                                    companyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["Alias"]);
                                }
                            }

                            if (reader["MonStartTime"] != DBNull.Value)
                                companyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                            if (reader["MonEndTime"] != DBNull.Value)
                                companyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                            if (reader["MonBreakTime"] != DBNull.Value)
                                companyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                            if (reader["TueStartTime"] != DBNull.Value)
                                companyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                            if (reader["TueEndTime"] != DBNull.Value)
                                companyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                            if (reader["TueBreakTime"] != DBNull.Value)
                                companyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                            if (reader["WedStartTime"] != DBNull.Value)
                                companyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                            if (reader["WedEndTime"] != DBNull.Value)
                                companyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                            if (reader["WedBreakTime"] != DBNull.Value)
                                companyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                            if (reader["ThuStartTime"] != DBNull.Value)
                                companyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                            if (reader["ThuEndTime"] != DBNull.Value)
                                companyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];

                            if (reader["ThuBreakTime"] != DBNull.Value)
                                companyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                            if (reader["FriStartTime"] != DBNull.Value)
                                companyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                            if (reader["FriEndTime"] != DBNull.Value)
                                companyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                            if (reader["FriBreakTime"] != DBNull.Value)
                                companyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                            if (reader["SatStartTime"] != DBNull.Value)
                                companyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                            if (reader["SatEndTime"] != DBNull.Value)
                                companyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                            if (reader["SatBreakTime"] != DBNull.Value)
                                companyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                            if (reader["SunStartTime"] != DBNull.Value)
                                companyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                            if (reader["SunEndTime"] != DBNull.Value)
                                companyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                            if (reader["SunBreakTime"] != DBNull.Value)
                                companyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];

                            companyShifts.Add(companyShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyShiftsByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShifts;
        }

        /// <summary>
        /// This method is to get employee latest job descriptions related to selected id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of job descriptions details</returns>
        public List<JobDescription> GetEmployeeLatestJobDescriptionsByIdEmployee(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetEmployeeLatestJobDescriptionsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                            {
                                jobDescription.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                jobDescription.EmployeeJobDescriptions.Add(employeeJobDescription);
                            }


                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLatestJobDescriptionsByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get all employees for attendance related selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2032(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2032", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                                }

                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }

        /// <summary>
        /// This method is to get all employees for leave details related to selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selcted period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeesForLeaveByIdCompany_V2032(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForLeaveByIdCompany_V2032", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }


                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }

                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany);

                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForLeaveByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employees;
        }

        /// <summary>
        /// This method is to get employee details related employee document number and selected period
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="EmployeeDocumentNumbers">Get employee document number</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetEmpDtlByEmpDocNoAndPeriod_V2032(string workbenchConnectionString, string EmployeeDocumentNumbers, string idCompany, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employees_GetEmpDtlByEmpDocNoAndPeriod_V2032", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumbers);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employee.LastName = Convert.ToString(reader["LastName"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                        employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                        employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }

                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                        employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }

                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation = new EmployeeContractSituation();
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }


                                employees.Add(employee);
                            }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get all employees selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employees image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employees details</returns>
        public List<Employee> GetAllEmployeesByIdCompany_V2032(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByIdCompany_V2032", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["IdGender"] != DBNull.Value)
                                {
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                    employee.Gender = new LookupValue();
                                    employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                    employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                                }

                                if (empReader["IdMaritalStatus"] != DBNull.Value)
                                {
                                    employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                    employee.MaritalStatus = new LookupValue();
                                    employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                    employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                                }

                                if (empReader["IdNationality"] != DBNull.Value)
                                {
                                    employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                    employee.Nationality = new Country();
                                    employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                    employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                                }

                                if (empReader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (empReader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (empReader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(empReader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (empReader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (empReader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["CompanyMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(empReader["CompanyMobiles"]);
                                    employee.EmployeeContactCompanyMobileList = Convert.ToString(empReader["CompanyMobiles"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyMobileList != null && employee.EmployeeContactCompanyMobileList.Count > 0)
                                    {
                                        employee.EmployeeContactMobile = employee.EmployeeContactCompanyMobileList.First();
                                    }
                                }

                                if (empReader["CompanyEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyEmailList = Convert.ToString(empReader["CompanyEmails"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyEmailList != null && employee.EmployeeContactCompanyEmailList.Count > 0)
                                    {
                                        employee.EmployeeContactEmail = employee.EmployeeContactCompanyEmailList.First();
                                    }
                                }

                                if (empReader["PrivateMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateMobiles = Convert.ToString(empReader["PrivateMobiles"]);
                                    employee.EmployeeContactPrivateMobileList = Convert.ToString(empReader["PrivateMobiles"]).Split('\n').ToList<string>();
                                }

                                if (empReader["PrivateEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateEmailList = Convert.ToString(empReader["PrivateEmails"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }


                                if (empReader["Languages"] != DBNull.Value)
                                    employee.Languages = Convert.ToString(empReader["Languages"]);

                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["EmployeeDocumentNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocNationalId = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentName = Convert.ToString(empReader["EmployeeDocumentName"]);
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                }

                                if (empReader["DocPassportNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPassport = Convert.ToString(empReader["DocPassportNumber"]);
                                }

                                if (empReader["DocDrLicenseNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocDrLicense = Convert.ToString(empReader["DocDrLicenseNumber"]);
                                }

                                if (empReader["DocPubInsNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPubIns = Convert.ToString(empReader["DocPubInsNumber"]);
                                }

                                if (empReader["DocPriInsNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocPriIns = Convert.ToString(empReader["DocPriInsNumber"]);
                                }

                                if (empReader["DocVisaNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocVisa = Convert.ToString(empReader["DocVisaNumber"]);
                                }

                                if (empReader["DocOtherNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocOther = Convert.ToString(empReader["DocOtherNumber"]);
                                }

                                if (empReader["DocClockIdNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocClockId = Convert.ToString(empReader["DocClockIdNumber"]);
                                }

                                // Exit 
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                if (empReader["ExitIdReason"] != DBNull.Value)
                                {
                                    employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                    employee.ExitReason = new LookupValue();
                                    employee.ExitReason.IdLookupValue = (Int32)employee.ExitIdReason;
                                    employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                                }

                                if (empReader["ExitRemarks"] != DBNull.Value)
                                    employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                    empJobDescription.JobDescription = new JobDescription();

                                    if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);
                                    }



                                    if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);
                                    }

                                    if (empReader["JobCodeAndTitles"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitleAndCode = Convert.ToString(empReader["JobCodeAndTitles"]);
                                    }


                                    if (empReader["DepartmentName"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                    }



                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }

                                    empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["MaxJobDescriptionUsage"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }


                                employee.ContractSituation = new ContractSituation();
                                // employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                {
                                    employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                }


                                if (empReader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(empReader["LengthOfService"]);

                                }

                                if (empReader["IdEmployeeStatus"] != DBNull.Value)
                                {
                                    employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus = new LookupValue();
                                    employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus.Value = empReader["EmployeeStatus"].ToString();
                                    employee.EmployeeStatus.HtmlColor = empReader["EmployeeStatusColor"].ToString();

                                    if (empReader["EmployeeIdImage"] != DBNull.Value)
                                        employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["EmployeeIdImage"].ToString());

                                    if (empReader["EmployeeStatusPosition"] != DBNull.Value)
                                        employee.EmployeeStatus.Position = Convert.ToInt32(empReader["EmployeeStatusPosition"].ToString());
                                }

                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["CompanyShiftName"] != DBNull.Value)
                                        employee.CompanyShift.Name = Convert.ToString(empReader["CompanyShiftName"]);

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["WorkScheduleName"]);
                                    }

                                    if (empReader["StartTime1"] != DBNull.Value)
                                        employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                    if (empReader["EndTime1"] != DBNull.Value)
                                        employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                    if (empReader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];
                                }

                                if (empReader["IdCompanyLocation"] != DBNull.Value)
                                {
                                    employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation = new Company();
                                    employee.CompanyLocation.IdCompany = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["Location"]);
                                }

                                if (empReader["Organization"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Organization"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Organization = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["Company"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Company"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Company = string.Join("\n", tempDifferentJobComp.ToArray());
                                }


                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    Employee emp = employees.Where(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])).FirstOrDefault();
                                    if (emp != null)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                        if (empReader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                        if (empReader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(empReader["ContractSituationFileName"]);
                                        if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);
                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);
                                        if (empReader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(empReader["ContractSituationRemarks"]);
                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);
                                        if (empReader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(empReader["IdProfessionalCategory"]);


                                        emp.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesByIdCompany_V2032().", category: Category.Info, priority: Priority.Low);
            return employees;
        }


        /// <summary>
        /// This method is to get all employees related to department and selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of department details</returns>
        public List<Department> GetAllEmployeesByDepartmentByIdCompany_V2032(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByDepartmentByIdCompany_V2032", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["IdDepartment"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();
                                    empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }





                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByDepartmentByIdCompany_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);

            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(x => x.FullName).ToList());
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }

        /// <summary>
        /// This method is to get all employee of job description
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="employeesProfileImagePath">Get employees image path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employees details</returns>
        public List<Employee> GetAllEmployeeOfJobDescription_V2033(string workbenchConnectionString, string idCompany, string employeesProfileImagePath, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeeOfJobDescription_V2033", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_selectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                if (reader["IdParent"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);

                                employee.EmployeeJobDescription.JobDescription.Abbreviation = reader["Abbreviation"].ToString();

                                if (reader["ChildOrientation"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                            employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                }
            }

            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            return employees;
        }

        /// <summary>
        /// This method is to get all employees for organization related to selected companies ids.
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of department details</returns>
        public List<Department> GetAllEmployeesForOrganizationByIdCompany_V2033(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<JobDescription> jobDescriptions = GetAllJobDescriptions(workbenchConnectionString);

            List<Employee> emp = new List<Employee>();
            emp = GetAllEmployeeOfJobDescription_V2033(workbenchConnectionString, idCompany, employeesProfileImagePath, selectedPeriod);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForOrganizationByIdCompany_V2033", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (reader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    }
                                }

                                if (reader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(reader["LengthOfService"]);
                                }

                                if (reader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmployeeJobCodes = Convert.ToString(reader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (reader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(reader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                    }

                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2033(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {

                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {

                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);

                                    }
                                }


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2033(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (Employee itememp in employees)
            {

                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            var grouppJD = emp.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdJobDescription);

            foreach (var item in grouppJD)
            {
                JobDescription jobDescription = jobDescriptions.Where(x => x.IdJobDescription == item.Key).FirstOrDefault();
                jobDescription.Employees = new List<Employee>();
                jobDescription.Employees.AddRange(item.ToList());
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);



            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(o => o.EmployeeJobDescription.JobDescription.JobDescriptionCode).ThenBy(o => o.FullName).ToList());
            }

            foreach (Department dept in departments)
            {
                dept.JobDescriptions = jobDescriptions.Where(x => x.IdDepartment == dept.IdDepartment).ToList();
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }

        /// <summary>
        /// This method to get organization hierarchy
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List fo job description details</returns>
        public List<JobDescription> GetOrganizationHierarchy_V2033(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<JobDescription> jobDescriptions = GetAllJobDescriptionsHeirarchy(workbenchConnectionString);

            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesOrganizationHierarchy_V2033", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();

                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeJobDescription.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                if (reader["JobDescriptionUsage"] != DBNull.Value)
                                    employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                employeeJobDescription.Employee = new Employee();
                                employeeJobDescription.Employee.IdEmployee = employeeJobDescription.IdEmployee;
                                employeeJobDescription.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeJobDescription.Employee.LastName = Convert.ToString(reader["LastName"]);
                                employeeJobDescription.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                employeeJobDescriptions.Add(employeeJobDescription);
                            }
                        }
                        employeeJobDescriptions = employeeJobDescriptions.OrderBy(x => x.Employee.FullName).ToList();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOrganizationHierarchy_V2033(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (JobDescription jd in jobDescriptions)
            {
                if (employeeJobDescriptions.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    jd.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == jd.IdJobDescription));
                }

                if (jd.ChildJobDescriptions != null)
                {
                    foreach (var itemJD in jd.ChildJobDescriptions)
                    {
                        if (employeeJobDescriptions.Any(x => x.IdJobDescription == itemJD.IdJobDescription))
                        {
                            itemJD.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                            itemJD.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == itemJD.IdJobDescription));
                            jd.IsEmployeeExistInChildJD = true;
                        }
                    }
                }
            }

            jobDescriptions = IsChildJobDescriptionExistEmployee(jobDescriptions);

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get employee count related to selected companies
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of company details</returns>
        public List<Company> GetEmployeesCountByIdCompany_V2033(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<Company> companies = new List<Company>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByIdCompany_V2033", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                    {
                        while (empReader.Read())
                        {
                            try
                            {
                                Company company = new Company();

                                company.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                if (empReader["Name"] != DBNull.Value)
                                {
                                    company.Name = Convert.ToString(empReader["Name"]);
                                    company.Alias = Convert.ToString(empReader["Alias"]);
                                }

                                if (empReader["EmpCount"] != DBNull.Value)
                                    company.EmployeesCount = Convert.ToUInt32(empReader["EmpCount"]);

                                companies.Add(company);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByIdCompany_V2033(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }

            return companies;
        }

        /// <summary>
        /// This method is to get organizational chart department area details
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get list of Department are details</returns>
        public List<LookupValue> GetOrganizationalChartDepartmentArea_V2033(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<LookupValue> departmentAreaList = GetEmployeesCountByDepartmentAreaByIdCompany_V2033(workbenchConnectionString, idCompanies, selectedPeriod);

            double total = departmentAreaList.Sum(y => Convert.ToDouble(y.Count));
            foreach (LookupValue item in departmentAreaList)
            {
                item.Percentage = Math.Round((item.Count / total) * 100);
            }

            List<LookupValue> departmentAreaAvgList = GetEmployeesAverageByDepartmentAreaByIdCompany_V2033(workbenchConnectionString, idCompanies, selectedPeriod);

            double totalAvg = Convert.ToDouble(departmentAreaAvgList.Sum(x => x.Average));
            foreach (LookupValue item in departmentAreaAvgList)
            {
                LookupValue lv = departmentAreaList.FirstOrDefault(x => x.IdLookupValue == item.IdLookupValue);

                if (lv != null)
                {
                    //lv.Average = item.Average;
                    lv.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                }
                else
                {
                    item.Percentage = 0;
                    item.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                    departmentAreaList.Add(item);
                }
            }

            return departmentAreaList;
        }

        /// <summary>
        /// This method is to get employees count related to department area and selected to company
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get employee count in each department area related selected companies</returns>
        public List<LookupValue> GetEmployeesCountByDepartmentAreaByIdCompany_V2033(string workbenchConnectionString, string idCompanies, long selectedPeriod = 0)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByDeptAreaByIdCompany_V2033", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                LookupValue lvDepartmentArea = new LookupValue();

                                lvDepartmentArea.IdLookupValue = Convert.ToInt32(empReader["IdLookupValue"]);

                                if (empReader["Value"] != DBNull.Value)
                                    lvDepartmentArea.Value = Convert.ToString(empReader["Value"]);

                                if (empReader["HtmlColor"] != DBNull.Value)
                                    lvDepartmentArea.HtmlColor = Convert.ToString(empReader["HtmlColor"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                {
                                    lvDepartmentArea.Count = Convert.ToUInt64(empReader["EmployeeCount"]);
                                    lvDepartmentArea.CountValue = Convert.ToDecimal(empReader["EmployeeCount"]);
                                }

                                departmentAreaList.Add(lvDepartmentArea);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByDepartmentAreaByIdCompany_V2033(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return departmentAreaList;
        }


        /// <summary>
        /// This method is to get employee average related to departnent and idcompany
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idCompanies">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Get list of Department are details</returns>
        public List<LookupValue> GetEmployeesAverageByDepartmentAreaByIdCompany_V2033(string workbenchConnectionString, string idCompanies, long selectedPeriod)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpAvgByDeptAreaByIdCompany_V2033", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = empCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            LookupValue lvDepartmentArea = new LookupValue();

                            lvDepartmentArea.IdLookupValue = Convert.ToInt32(reader["IdLookupValue"]);

                            if (reader["Value"] != DBNull.Value)
                                lvDepartmentArea.Value = Convert.ToString(reader["Value"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                lvDepartmentArea.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            if (reader["AvgEmployees"] != DBNull.Value)
                                lvDepartmentArea.Average = Convert.ToDouble(reader["AvgEmployees"]);

                            departmentAreaList.Add(lvDepartmentArea);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesAverageByDepartmentAreaByIdCompany_V2033(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return departmentAreaList;
        }



        /// <summary>
        /// This method is to get all employees related to companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeesByIdCompany_V2033(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByIdCompany_V2033", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["IdGender"] != DBNull.Value)
                                {
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                    employee.Gender = new LookupValue();
                                    employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                    employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                                }

                                if (empReader["IdMaritalStatus"] != DBNull.Value)
                                {
                                    employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                    employee.MaritalStatus = new LookupValue();
                                    employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                    employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                                }

                                if (empReader["IdNationality"] != DBNull.Value)
                                {
                                    employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                    employee.Nationality = new Country();
                                    employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                    employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                                }

                                if (empReader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (empReader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (empReader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(empReader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (empReader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (empReader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["CompanyMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(empReader["CompanyMobiles"]);
                                    employee.EmployeeContactCompanyMobileList = Convert.ToString(empReader["CompanyMobiles"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyMobileList != null && employee.EmployeeContactCompanyMobileList.Count > 0)
                                    {
                                        employee.EmployeeContactMobile = employee.EmployeeContactCompanyMobileList.First();
                                    }
                                }

                                if (empReader["CompanyEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyEmailList = Convert.ToString(empReader["CompanyEmails"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyEmailList != null && employee.EmployeeContactCompanyEmailList.Count > 0)
                                    {
                                        employee.EmployeeContactEmail = employee.EmployeeContactCompanyEmailList.First();
                                    }
                                }

                                if (empReader["PrivateMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateMobiles = Convert.ToString(empReader["PrivateMobiles"]);
                                    employee.EmployeeContactPrivateMobileList = Convert.ToString(empReader["PrivateMobiles"]).Split('\n').ToList<string>();
                                }

                                if (empReader["PrivateEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateEmailList = Convert.ToString(empReader["PrivateEmails"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }


                                if (empReader["Languages"] != DBNull.Value)
                                    employee.Languages = Convert.ToString(empReader["Languages"]);

                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["EmployeeDocumentNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocNationalId = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentName = Convert.ToString(empReader["EmployeeDocumentName"]);
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                }

                                if (empReader["DocPassportNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPassport = Convert.ToString(empReader["DocPassportNumber"]);
                                }

                                if (empReader["DocDrLicenseNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocDrLicense = Convert.ToString(empReader["DocDrLicenseNumber"]);
                                }

                                if (empReader["DocPubInsNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPubIns = Convert.ToString(empReader["DocPubInsNumber"]);
                                }

                                if (empReader["DocPriInsNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocPriIns = Convert.ToString(empReader["DocPriInsNumber"]);
                                }

                                if (empReader["DocVisaNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocVisa = Convert.ToString(empReader["DocVisaNumber"]);
                                }

                                if (empReader["DocOtherNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocOther = Convert.ToString(empReader["DocOtherNumber"]);
                                }

                                if (empReader["DocClockIdNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocClockId = Convert.ToString(empReader["DocClockIdNumber"]);
                                }

                                // Exit 
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                if (empReader["ExitIdReason"] != DBNull.Value)
                                {
                                    employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                    employee.ExitReason = new LookupValue();
                                    employee.ExitReason.IdLookupValue = (Int32)employee.ExitIdReason;
                                    employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                                }

                                if (empReader["ExitRemarks"] != DBNull.Value)
                                    employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                    empJobDescription.JobDescription = new JobDescription();

                                    if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);
                                    }



                                    if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);
                                    }

                                    if (empReader["JobCodeAndTitles"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitleAndCode = Convert.ToString(empReader["JobCodeAndTitles"]);
                                    }


                                    if (empReader["DepartmentName"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                    }



                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }

                                    empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["MaxJobDescriptionUsage"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }


                                employee.ContractSituation = new ContractSituation();
                                // employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                {
                                    employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                }


                                if (empReader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(empReader["LengthOfService"]);

                                }

                                if (empReader["IdEmployeeStatus"] != DBNull.Value)
                                {
                                    employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus = new LookupValue();
                                    employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus.Value = empReader["EmployeeStatus"].ToString();
                                    employee.EmployeeStatus.HtmlColor = empReader["EmployeeStatusColor"].ToString();

                                    if (empReader["EmployeeIdImage"] != DBNull.Value)
                                        employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["EmployeeIdImage"].ToString());

                                    if (empReader["EmployeeStatusPosition"] != DBNull.Value)
                                        employee.EmployeeStatus.Position = Convert.ToInt32(empReader["EmployeeStatusPosition"].ToString());
                                }

                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["CompanyShiftName"] != DBNull.Value)
                                        employee.CompanyShift.Name = Convert.ToString(empReader["CompanyShiftName"]);

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["WorkScheduleName"]);
                                    }

                                    if (empReader["StartTime1"] != DBNull.Value)
                                        employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                    if (empReader["EndTime1"] != DBNull.Value)
                                        employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                    if (empReader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];
                                }

                                if (empReader["IdCompanyLocation"] != DBNull.Value)
                                {
                                    employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation = new Company();
                                    employee.CompanyLocation.IdCompany = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["Location"]);
                                }

                                if (empReader["Organization"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Organization"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Organization = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["Company"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Company"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Company = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    List<string> tempDiffDepart = Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>();
                                    tempDiffDepart = tempDiffDepart.Distinct().ToList();
                                    employee.EmployeeDepartments = string.Join("\n", tempDiffDepart.ToArray()); ;
                                }
                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2033(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    Employee emp = employees.Where(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])).FirstOrDefault();
                                    if (emp != null)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                        if (empReader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                        if (empReader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(empReader["ContractSituationFileName"]);
                                        if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);
                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);
                                        if (empReader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(empReader["ContractSituationRemarks"]);
                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);
                                        if (empReader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(empReader["IdProfessionalCategory"]);


                                        emp.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2033(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesByIdCompany_V2033().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        /// <summary>
        /// This method is to get employee latest job descriptions related to selected id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of job descriptions details</returns>
        public List<JobDescription> GetEmployeeLatestJobDescriptionsByIdEmployee_V2033(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetEmployeeLatestJobDescriptionsByIdEmployee_V2033", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                jobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"]);
                                jobDescription.JDLevel = new LookupValue();
                                jobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"]);
                                if (reader["JDLevel"] != DBNull.Value)
                                    jobDescription.JDLevel.Value = Convert.ToString(reader["JDLevel"]);
                                if (reader["JDLevelHtmlColor"] != DBNull.Value)
                                    jobDescription.JDLevel.HtmlColor = Convert.ToString(reader["JDLevelHtmlColor"]);
                                if (reader["JDLevelIdImage"] != DBNull.Value)
                                    jobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDLevelIdImage"]);
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                            {
                                jobDescription.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                jobDescription.EmployeeJobDescriptions.Add(employeeJobDescription);
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                            }


                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLatestJobDescriptionsByIdEmployee_V2033(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        /// <summary>
        /// This method is to get employee details
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>Employee details</returns>
        public Employee GetEmployeeByIdEmployee_V2033(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2031(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee_V2033(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                employee.EmployeeShifts = GetEmployeeShifts(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee(workbenchConnectionString, idEmployee);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2033(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }


        /// <summary>
        /// This method is to get employee job descrption related to id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <returns>List of employee job description details</returns>
        public List<EmployeeJobDescription> GetEmployeeJobDescriptionsByIdEmployee_V2033(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeJobDescriptionsByIdEmployee_V2033", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeJobDescription.Company = new Company();
                                employeeJobDescription.Company.IdCompany = employeeJobDescription.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeeJobDescription.JobDescription = new JobDescription();
                                employeeJobDescription.JobDescription.IdJobDescription = employeeJobDescription.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeeJobDescription.JobDescription.Department = new Department();
                                    employeeJobDescription.JobDescription.Department.IdDepartment = employeeJobDescription.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                    if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                }
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                employeeJobDescription.JobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"]);
                                employeeJobDescription.JobDescription.JDLevel = new LookupValue();
                                employeeJobDescription.JobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"]);
                                if (reader["JDLevel"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.Value = Convert.ToString(reader["JDLevel"]);
                                if (reader["JDLevelHtmlColor"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.HtmlColor = Convert.ToString(reader["JDLevelHtmlColor"]);
                                if (reader["JDLevelIdImage"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDLevelIdImage"]);
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                            if (reader["JobDescriptionStartDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["JobDescriptionStartDate"]);

                            if (reader["JobDescriptionEndDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionEndDate = Convert.ToDateTime(reader["JobDescriptionEndDate"]);

                            if (reader["JobDescriptionRemarks"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionRemarks = Convert.ToString(reader["JobDescriptionRemarks"]);

                            employeeJobDescriptions.Add(employeeJobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeJobDescriptionsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeJobDescriptions;
        }

        /// <summary>
        /// This method is to get employee shifts
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <returns>List of employee shifts details</returns>
        public List<EmployeeShift> GetEmployeeShifts_V2034(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeShift> employeeShifts = new List<EmployeeShift>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeShifts_V2034", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            EmployeeShift employeeShift = new EmployeeShift();
                            if (reader["IdEmployeeShift"] != DBNull.Value)
                                employeeShift.IdEmployeeShift = Convert.ToInt64(reader["IdEmployeeShift"]);
                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeShift.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["IdCompanyShift"] != DBNull.Value)
                            {
                                employeeShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                employeeShift.CompanyShift = new CompanyShift();
                                employeeShift.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);



                                if (reader["ShiftName"] != DBNull.Value)
                                    employeeShift.CompanyShift.Name = Convert.ToString(reader["ShiftName"]);

                                if (reader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employeeShift.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeShift.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employeeShift.CompanyShift.CompanySchedule.IdCompanySchedule = employeeShift.CompanyShift.IdCompanySchedule;

                                    if (reader["WorkSchedule"] != DBNull.Value)
                                        employeeShift.CompanyShift.CompanySchedule.Name = Convert.ToString(reader["WorkSchedule"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeShift.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeShift.CompanyShift.CompanySchedule.Company = new Company();
                                        employeeShift.CompanyShift.CompanySchedule.Company.IdCompany = employeeShift.CompanyShift.CompanySchedule.IdCompany;
                                        employeeShift.CompanyShift.CompanySchedule.Company.Name = Convert.ToString(reader["CompanyName"]);
                                        employeeShift.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["Alias"]);
                                    }
                                }

                                if (reader["MonStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                                if (reader["MonEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                                if (reader["MonBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                                if (reader["TueStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                                if (reader["TueEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                                if (reader["TueBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                                if (reader["WedStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                                if (reader["WedEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                                if (reader["WedBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                                if (reader["ThuStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                                if (reader["ThuEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];

                                if (reader["ThuBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                                if (reader["FriStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                                if (reader["FriEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                                if (reader["FriBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                                if (reader["SatStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                                if (reader["SatEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                                if (reader["SatBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                                if (reader["SunStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                                if (reader["SunEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                                if (reader["SunBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];
                            }
                            employeeShifts.Add(employeeShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeShifts_V2034(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeShifts;
        }

        /// <summary>
        /// This method is to get employee related to id employee
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Get employee id</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <returns>employee details</returns>
        public Employee GetEmployeeByIdEmployee_V2034(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2031(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee_V2033(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                employee.EmployeeShifts = GetEmployeeShifts_V2034(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee(workbenchConnectionString, idEmployee);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2034(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }

        /// <summary>
        /// This method is to add employee details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeProfileImage">Get employee image path</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path</param>
        /// <param name="empProfessionalEducationFilesPath">Get employee professional eductaion file path</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        /// <param name="employeeExitDocument">Get employee exit document file path</param>
        /// <returns>Get employee details</returns>
        public Employee AddEmployee_V2034(string mainServerWorkbenchConnectionString, string workbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    //string lastestEmployeeCode = "";
                    employee.EmployeeCode = GetLatestEmployeeCode(workbenchConnectionString);

                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Insert_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        //if (!string.IsNullOrEmpty(lastestEmployeeCode) && lastestEmployeeCode != employee.EmployeeCode)
                        //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", lastestEmployeeCode);
                        //else
                        //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);


                        employee.IdEmployee = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (employee.IdEmployee > 0)
                    {
                        if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)   //Save employee profile image.
                            SaveEmployeeProfileImage(employeeProfileImage, employee);
                        else if (employee.IsProfileImageDeleted)                                       //Delete employee profile image.
                            DeleteEmployeeProfileImage(employeeProfileImage, employee);

                        //if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                        //    SaveEmployeeExitDocument(employeeExitDocument, employee);
                        //else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                        //    DeleteEmployeeExitDocument(employeeExitDocument, employee);

                        AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                        AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                        AddEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                        AddEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                        AddEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                        AddEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                        AddEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                        AddEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                        AddEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                        AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                        AddEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                        AddEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployee_V2034(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employee;
        }

        /// <summary>
        /// This method is to update employee details
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="employee">Get employee details</param>
        /// <param name="employeeProfileImage">Get employee image path</param>
        /// <param name="empEducationQualificationFilesPath">Get employee education qualification file path</param>
        /// <param name="empProfessionalEducationFilesPath">Get employee professional education file path</param>
        /// <param name="empContractSituationFilesPath">Get employee contract situation file path</param>
        /// <param name="empIdentificationDocumentFilesPath">Get employee identification document file path</param>
        /// <param name="employeeExitDocument">Get employee exit document file path</param>
        /// <returns>If true updated employee otherwise false</returns>
        public bool UpdateEmployee_V2034(string mainServerWorkbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {
            bool isUpdatedEmployee = false;

            if (employee.IdEmployeeStatus == 136 || employee.IdEmployeeStatus == 137)
                employee.EmployeeCode = employee.EmployeeCode.Replace("D", "E");

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Update_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);
                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employee.ExitFileName);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)    //Save employee profile image.
                        SaveEmployeeProfileImage(employeeProfileImage, employee);
                    else if (employee.IsProfileImageDeleted)                                        //Delete employee profile image.
                        DeleteEmployeeProfileImage(employeeProfileImage, employee);

                    if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                        SaveEmployeeExitDocument(employeeExitDocument, employee);
                    else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                        DeleteEmployeeExitDocument(employeeExitDocument, employee);

                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                    AddUpdateDeleteEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                    AddUpdateDeleteEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                    AddUpdateDeleteEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                    AddUpdateDeleteEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                    AddUpdateDeleteEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                    AddUpdateDeleteEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                    AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                    AddUpdateDeleteEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                    AddUpdateDeleteEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                    AddUpdateDeleteEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                    AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployee_V2034(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }

        /// <summary>
        /// This method is to add/delete employee shift
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="idEmployee">Employee id</param>
        /// <param name="employeeShifts">Get employee shifts details</param>
        public void AddDeleteEmployeeShifts(string mainServerWorkbenchConnectionString, Int32 idEmployee, List<EmployeeShift> employeeShifts)
        {
            try
            {
                if (employeeShifts != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeShift employeeShift in employeeShifts)
                        {
                            employeeShift.IdEmployee = idEmployee;

                            if (employeeShift.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeShift_Delete", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeShift", employeeShift.IdEmployeeShift);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (employeeShift.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeShift_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                                mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeShift.IdCompanyShift);
                                mySqlCommand.Parameters.AddWithValue("_StartDate", employeeShift.StartDate);
                                mySqlCommand.Parameters.AddWithValue("_EndDate", employeeShift.EndDate);


                                employeeShift.IdEmployeeShift = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteEmployeeShifts(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is to get employee details related employee document number and selected period
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="EmployeeDocumentNumbers">Get employee document number</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetEmpDtlByEmpDocNoAndPeriod_V2034(string workbenchConnectionString, string EmployeeDocumentNumbers, string idCompany, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employees_GetEmpDtlByEmpDocNoAndPeriod_V2034", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumbers);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employee.LastName = Convert.ToString(reader["LastName"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                        employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                        employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }

                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                        employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);
                                        string[] LstCompanyIds = employee.EmployeeCompanyIds.Split('\n');
                                        employee.EmployeeCompanyIds = string.Join("\n", LstCompanyIds.Distinct());
                                    }

                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }

                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation = new EmployeeContractSituation();
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }


                                employees.Add(employee);
                            }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to update company shift
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="companyShift">Gewt company shift details</param>
        /// <returns>updated company shift details</returns>
        public CompanyShift UpdateCompanyShift_V2034(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Update_V2034", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", companyShift.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_MonStartTime", companyShift.MonStartTime);
                        mySqlCommand.Parameters.AddWithValue("_MonEndTime", companyShift.MonEndTime);
                        mySqlCommand.Parameters.AddWithValue("_MonBreakTime", companyShift.MonBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_TueStartTime", companyShift.TueStartTime);
                        mySqlCommand.Parameters.AddWithValue("_TueEndTime", companyShift.TueEndTime);
                        mySqlCommand.Parameters.AddWithValue("_TueBreakTime", companyShift.TueBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_WedStartTime", companyShift.WedStartTime);
                        mySqlCommand.Parameters.AddWithValue("_WedEndTime", companyShift.WedEndTime);
                        mySqlCommand.Parameters.AddWithValue("_WedBreakTime", companyShift.WedBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuStartTime", companyShift.ThuStartTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuEndTime", companyShift.ThuEndTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuBreakTime", companyShift.ThuBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_FriStartTime", companyShift.FriStartTime);
                        mySqlCommand.Parameters.AddWithValue("_FriEndTime", companyShift.FriEndTime);
                        mySqlCommand.Parameters.AddWithValue("_FriBreakTime", companyShift.FriBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SatStartTime", companyShift.SatStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SatEndTime", companyShift.SatEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SatBreakTime", companyShift.SatBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SunStartTime", companyShift.SunStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SunEndTime", companyShift.SunEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SunBreakTime", companyShift.SunBreakTime);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCompanyShift_V2034(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }

        /// <summary>
        /// This method is to add company shift
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string (emdep_geos db)</param>
        /// <param name="companyShift">Get company shift details to add</param>
        /// <returns>Get added company shift details </returns>
        public CompanyShift AddCompanyShift_V2034(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Insert_V2034", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_MonStartTime", companyShift.MonStartTime);
                        mySqlCommand.Parameters.AddWithValue("_MonEndTime", companyShift.MonEndTime);
                        mySqlCommand.Parameters.AddWithValue("_MonBreakTime", companyShift.MonBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_TueStartTime", companyShift.TueStartTime);
                        mySqlCommand.Parameters.AddWithValue("_TueEndTime", companyShift.TueEndTime);
                        mySqlCommand.Parameters.AddWithValue("_TueBreakTime", companyShift.TueBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_WedStartTime", companyShift.WedStartTime);
                        mySqlCommand.Parameters.AddWithValue("_WedEndTime", companyShift.WedEndTime);
                        mySqlCommand.Parameters.AddWithValue("_WedBreakTime", companyShift.WedBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuStartTime", companyShift.ThuStartTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuEndTime", companyShift.ThuEndTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuBreakTime", companyShift.ThuBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_FriStartTime", companyShift.FriStartTime);
                        mySqlCommand.Parameters.AddWithValue("_FriEndTime", companyShift.FriEndTime);
                        mySqlCommand.Parameters.AddWithValue("_FriBreakTime", companyShift.FriBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SatStartTime", companyShift.SatStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SatEndTime", companyShift.SatEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SatBreakTime", companyShift.SatBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SunStartTime", companyShift.SunStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SunEndTime", companyShift.SunEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SunBreakTime", companyShift.SunBreakTime);

                        companyShift.IdCompanyShift = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCompanyShift_V2034(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }



        /// <summary>
        /// This method is to get all employees for attendance related selected companies ids
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image path</param>
        /// <param name="idCompany">Get selected companies ids</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2034(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2034", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                                }
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2034(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                    if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                    Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                    employee.EmployeeContractSituations.Add(employeeContractSituation);
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2034(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }


        public void GetEmployeeLeaveByIdEmployee_V2034(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod, string idCompany, List<Employee> employees, Employee employee)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();
            Dictionary<Int32, TimeSpan> leaveInHoilday = new Dictionary<Int32, TimeSpan>();

            if (idCompany != null)
                leaveInHoilday = GetAllEmpLeavesByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAnnualLeave.Employee = new Employee();
                                    employeeAnnualLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeAnnualLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAnnualLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAnnualLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAnnualLeave.Employee.CompanyShift = new CompanyShift();
                                        employeeAnnualLeave.Employee.CompanyShift.IdCompanyShift = employeeAnnualLeave.Employee.IdCompanyShift;

                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                        {
                                            employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule;

                                            if (reader["ScheduleYear"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["ScheduleYear"]);

                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);

                                            if (reader["WorkingDays"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        }
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave = new CompanyLeave();
                                    employeeAnnualLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave.Name = reader["Name"].ToString();
                                    employeeAnnualLeave.CompanyLeave.HtmlColor = reader["HtmlColor"].ToString();
                                    if (reader["Position"] != DBNull.Value)
                                        employeeAnnualLeave.CompanyLeave.Position = Convert.ToUInt64(reader["Position"]);
                                }

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeave.TotalHoursCount = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;
                                employeeAnnualLeaves.Add(employeeAnnualLeave);


                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave eal = employeeAnnualLeaves.FirstOrDefault(x => x.IdLeave == Convert.ToInt64(reader["IdLeave"]));

                                if (eal != null)
                                {

                                    if (leaveInHoilday != null)
                                    {
                                        if (leaveInHoilday.Any(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])))
                                        {
                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                            {
                                                TimeSpan ts = new TimeSpan();
                                                ts = leaveInHoilday.Where(lh => lh.Key == Convert.ToInt64(reader["IdLeave"])).FirstOrDefault().Value;

                                                if (reader["EnjoyedHours"] != DBNull.Value)
                                                    eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]) - (Convert.ToDecimal(reader["DailyHoursCount"]) * Convert.ToDecimal(ts.Days));
                                                else
                                                    eal.Enjoyed = 0;
                                            }
                                        }
                                        else
                                        {
                                            if (reader["EnjoyedHours"] != DBNull.Value)
                                                eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                            else
                                                eal.Enjoyed = 0;
                                        }
                                    }
                                    else
                                    {
                                        if (reader["EnjoyedHours"] != DBNull.Value)
                                            eal.Enjoyed = Convert.ToDecimal(reader["EnjoyedHours"]);
                                        else
                                            eal.Enjoyed = 0;
                                    }

                                    eal.Remaining = (eal.RegularHoursCount + eal.AdditionalHoursCount) - eal.Enjoyed;
                                }
                            }
                        }

                    }
                }

                if (employeeAnnualLeaves.Count > 0)
                {
                    foreach (EmployeeAnnualLeave itemEAL in employeeAnnualLeaves)
                    {
                        Employee emp = new Employee();
                        emp = (Employee)employee.Clone();
                        emp.EmployeeAnnualLeave = itemEAL;
                        employees.Add(emp);
                    }
                }
                else
                {
                    employees.Add(employee);
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveByIdEmployee_V2034(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }


        }

        public List<Employee> GetEmployeeDetailsForLeaveSummary_V2034(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeeDetailsForLeaveSummary", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);


                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }



                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["CompanyShortName"] != DBNull.Value)
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["CompanyShortName"]);

                                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employee.IdEmployee);
                                if (employee.EmployeeJobDescriptions != null)
                                {
                                    if (employee.EmployeeJobDescriptions.Count > 1)
                                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                                }

                                GetEmployeeLeaveByIdEmployee_V2034(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany, employees, employee);

                                // employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDetailsForLeaveSummary(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }


                }
            }
            Log4NetLogger.Logger.Log("Executed GetEmployeeDetailsForLeaveSummary().", category: Category.Info, priority: Priority.Low);
            return employees;
        }


        public bool UpdateEmployee_V2035(string mainServerWorkbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocumentFilePath)
        {
            bool isUpdatedEmployee = false;

            if (employee.IdEmployeeStatus == 136 || employee.IdEmployeeStatus == 137)
                employee.EmployeeCode = employee.EmployeeCode.Replace("D", "E");

            if (employee.IdEmployeeStatus == 136)
            {
                employee.ExitDate = null;
                employee.ExitIdReason = null;
                employee.ExitRemarks = null;
                employee.ExitFileName = null;
            }

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Update_V2031", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);
                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employee.ExitFileName);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)    //Save employee profile image.
                        SaveEmployeeProfileImage(employeeProfileImage, employee);
                    else if (employee.IsProfileImageDeleted)                                        //Delete employee profile image.
                        DeleteEmployeeProfileImage(employeeProfileImage, employee);

                    //if (!employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent!=null)   //Save employee exit Document.
                    //    SaveEmployeeExitDocument_V2035(employeeExitDocument, employee);
                    //else if (employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent != null)                                       //Delete employee exit Document.
                    //    DeleteEmployeeExitDocument_V2035(employeeExitDocument, employee);

                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                    AddUpdateDeleteEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                    AddUpdateDeleteEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                    AddUpdateDeleteEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                    AddUpdateDeleteEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                    AddUpdateDeleteEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                    AddUpdateDeleteEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                    AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                    AddUpdateDeleteEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                    AddUpdateDeleteEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                    AddUpdateDeleteEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                    AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                    AddUpdateDeleteEmployeeExitEvent(mainServerWorkbenchConnectionString, employee, employee.EmployeeExitEvents, employeeExitDocumentFilePath);


                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployee_V2035(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }

        private void AddExitEvent(string mainServerWorkbenchConnectionString, EmployeeExitEvent employeeExitEvent)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeExitEvent_Insert", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employeeExitEvent.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_IdReason", employeeExitEvent.IdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employeeExitEvent.FileName);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employeeExitEvent.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdExitEvent", employeeExitEvent.IdExitEvent);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeExitEvent.IdEmployee);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }



                    transactionScope.Complete();
                    transactionScope.Dispose();

                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddExitEvent. IdEmployee- {0} ErrorMessage- {1}", employeeExitEvent.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
        }
        public bool SaveEmployeeExitDocument_V2035(string employeesExitDocumentPath, Employee employee, EmployeeExitEvent employeeExitEvent)
        {
            if (employeeExitEvent.ExitEventBytes != null)
            {
                try
                {
                    string[] files = null;
                    if (!Directory.Exists(employeesExitDocumentPath + "\\" + employee.EmployeeCode))
                    {
                        Directory.CreateDirectory(employeesExitDocumentPath + "\\" + employee.EmployeeCode);
                    }
                    // files = Directory.GetFiles(employeesExitDocument + "\\" + employee.EmployeeCode);


                    //foreach (string sourcefile in files)
                    //{
                    //    string targetPath = employeesExitDocument + "\\" + employee.EmployeeCode+ "\\"+ 1;
                    //    string fileName = Path.GetFileName(sourcefile);
                    //    string destFile = Path.Combine(targetPath, fileName);

                    //    File.Move(sourcefile, destFile);
                    //}

                    //if (!Directory.Exists(Path.Combine(employeesExitDocument , employee.EmployeeCode,employee.EmployeeExitEvent.IdExitEvent.ToString())))
                    //{
                    //    Directory.CreateDirectory(Path.Combine(employeesExitDocument, employee.EmployeeCode, employee.EmployeeExitEvent.IdExitEvent.ToString()));
                    //}

                    string imagePath = employeesExitDocumentPath + "\\" + employee.EmployeeCode + "\\" + employeeExitEvent.FileName;

                    File.WriteAllBytes(imagePath, employeeExitEvent.ExitEventBytes);
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error SaveEmployeeExitDocument_V2035()-Code - {0}. ErrorMessage- {1}", employee.EmployeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }

            return true;
        }

        /// <summary>
        /// This method is delete employee exit document
        /// </summary>
        /// <param name="employeesExitDocument">Get employee exit document path</param>
        /// <param name="employee">Get employee details</param>
        /// <returns>If true deleted employee exit document otherwise false</returns>
        public bool DeleteEmployeeExitDocument_V2035(string employeesExitDocument, Employee employee)
        {
            try
            {
                if (!Directory.Exists(employeesExitDocument + "\\" + employee.EmployeeCode))
                {
                    return false;
                }
                else
                {
                    string imagePathold = employeesExitDocument + "\\" + employee.EmployeeCode + "\\" + employee.EmployeeExitEvent.FileName;
                    if (File.Exists(imagePathold))
                    {
                        File.Delete(imagePathold);
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeExitDocument_V2035()-Code - {0}. ErrorMessage- {1}", employee.EmployeeCode, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }


        public Employee GetEmployeeByIdEmployee_V2035(string workbenchConnectionString, Int32 idEmployee, string exitDocumentFilePath, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                employee.EmployeeShifts = GetEmployeeShifts_V2034(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee_V2035(workbenchConnectionString, idEmployee);

                employee.EmployeeExitEvents = GetEmployeeExitEventsByIdEmployee(workbenchConnectionString, idEmployee, employee.EmployeeCode, exitDocumentFilePath);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2035(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }

        public byte[] GetEmployeesExitDocument(string employeeCode, EmployeeExitEvent employeeExitEvent, string employeeExitDocument)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Empty;

            if (File.Exists(Path.Combine(employeeExitDocument, employeeCode, employeeExitEvent.FileName)))
            {
                fileUploadPath = Path.Combine(employeeExitDocument, employeeCode, employeeExitEvent.FileName);
            }
            else if ((File.Exists(employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName + ".png")))
            {
                fileUploadPath = employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName + ".png";
            }



            if (!string.IsNullOrEmpty(fileUploadPath))
            {
                try
                {
                    if (File.Exists(fileUploadPath))
                    {
                        using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                        {
                            bytes = new byte[stream.Length];
                            int numBytesToRead = (int)stream.Length;
                            int numBytesRead = 0;

                            while (numBytesToRead > 0)
                            {
                                // Read may return anything from 0 to numBytesToRead.
                                int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                                // Break when the end of the file is reached.
                                if (n == 0)
                                    break;

                                numBytesRead += n;
                                numBytesToRead -= n;
                            }
                        }
                    }


                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesExitDocument(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    throw;
                }
            }
            return bytes;
        }

        //public byte[] GetEmployeesExitDocument_V2036(string employeeCode, EmployeeExitEvent employeeExitEvent, string employeeExitDocument)
        //{
        //    byte[] bytes = null;
        //    string fileUploadPath = string.Empty;

        //        //File.Exists(Properties.Settings.Default.EmployeeExitDocument + "/" + employeeCode + "/" + fileName + ".png")
        //    if (File.Exists(employeeExitDocument+"\\"+ employeeCode+"\\"+ employeeExitEvent.FileName))
        //    {
        //        fileUploadPath = employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName;
        //    }
        //    //else if (File.Exists(employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName +".png"))
        //    //{

        //    //    string filename;
        //    //    string[] filenamewithextension = employeeExitEvent.FileName.Split('.');
        //    //    filename = filenamewithextension[0];
        //    //    File.Move(employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName + ".png", employeeExitDocument + "\\" + employeeCode + "\\" + filename + ".pdf");
        //    //    fileUploadPath = employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName ;


        //    //}
        //    //else
        //    //{
        //    //    string filename;
        //    //    string[] filenamewithextension = employeeExitEvent.FileName.Split('.');
        //    //    filename = filenamewithextension[0];
        //    //    File.Move(employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName + ".jpg", employeeExitDocument + "\\" + employeeCode + "\\" + filename + ".pdf");
        //    //    fileUploadPath = employeeExitDocument + "\\" + employeeCode + "\\" + employeeExitEvent.FileName;

        //    //}


        //    if (!string.IsNullOrEmpty(fileUploadPath))
        //    {
        //        try
        //        {
        //            if (File.Exists(fileUploadPath))
        //            {
        //                using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
        //                {
        //                    bytes = new byte[stream.Length];
        //                    int numBytesToRead = (int)stream.Length;
        //                    int numBytesRead = 0;

        //                    while (numBytesToRead > 0)
        //                    {
        //                        // Read may return anything from 0 to numBytesToRead.
        //                        int n = stream.Read(bytes, numBytesRead, numBytesToRead);

        //                        // Break when the end of the file is reached.
        //                        if (n == 0)
        //                            break;

        //                        numBytesRead += n;
        //                        numBytesToRead -= n;
        //                    }
        //                }
        //            }


        //        }
        //        catch (Exception ex)
        //        {
        //            Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesExitDocument_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
        //            throw;
        //        }
        //    }
        //    return bytes;
        //}



        public List<EmployeePolyvalence> GetEmployeePolyvalenceByIdEmployee_V2035(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeePolyvalence> employeePolyvalences = new List<EmployeePolyvalence>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeePolyvalenceByIdEmployee_V2035", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeePolyvalence employeePolyvalence = new EmployeePolyvalence();
                            employeePolyvalence.IdEmployee = idEmployee;

                            if (reader["IdEmployeePolyvalence"] != DBNull.Value)
                                employeePolyvalence.IdEmployeePolyvalence = Convert.ToUInt64(reader["IdEmployeePolyvalence"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeePolyvalence.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeePolyvalence.Company = new Company();
                                employeePolyvalence.Company.IdCompany = employeePolyvalence.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeePolyvalence.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeePolyvalence.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeePolyvalence.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeePolyvalence.JobDescription = new JobDescription();
                                employeePolyvalence.JobDescription.IdJobDescription = employeePolyvalence.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeePolyvalence.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["Abbreviation"] != DBNull.Value)
                                    employeePolyvalence.JobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeePolyvalence.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeePolyvalence.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeePolyvalence.JobDescription.Department = new Department();
                                    employeePolyvalence.JobDescription.Department.IdDepartment = employeePolyvalence.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeePolyvalence.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                }
                            }


                            if (reader["PolyvalenceUsage"] != DBNull.Value)
                                employeePolyvalence.PolyvalenceUsage = Convert.ToUInt16(reader["PolyvalenceUsage"]);


                            if (reader["PolyvalenceRemarks"] != DBNull.Value)
                                employeePolyvalence.PolyvalenceRemarks = Convert.ToString(reader["PolyvalenceRemarks"]);




                            employeePolyvalences.Add(employeePolyvalence);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeePolyvalenceByIdEmployee_V2035(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeePolyvalences;
        }


        public List<EmployeeContractSituation> GetEmployeeContractSituationsByIdEmployee_V2035(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeContractSituation> employeeContractSituations = new List<EmployeeContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractSituationsByIdEmployee_V2035", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                            employeeContractSituation.IdEmployee = idEmployee;

                            if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);

                            if (reader["IdContractSituation"] != DBNull.Value)
                            {
                                employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);

                                employeeContractSituation.ContractSituation = new ContractSituation();
                                employeeContractSituation.ContractSituation.IdContractSituation = employeeContractSituation.IdContractSituation;
                                employeeContractSituation.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);
                            }

                            if (reader["IdProfessionalCategory"] != DBNull.Value)
                            {
                                employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                employeeContractSituation.ProfessionalCategory = new ProfessionalCategory();
                                employeeContractSituation.ProfessionalCategory.IdProfessionalCategory = employeeContractSituation.IdProfessionalCategory;
                                employeeContractSituation.ProfessionalCategory.Name = Convert.ToString(reader["ProfessionalCategory"]);
                            }

                            if (reader["ContractSituationStartDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                            if (reader["ContractSituationEndDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                            if (reader["ContractSituationFileName"] != DBNull.Value)
                                employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);

                            if (reader["ContractSituationRemarks"] != DBNull.Value)
                                employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeContractSituation.Company = new Company();
                                employeeContractSituation.Company.IdCompany = employeeContractSituation.IdCompany.Value;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeContractSituation.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeContractSituation.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }


                            if (reader["IdEmployeeExitEvent"] != DBNull.Value)
                            {
                                employeeContractSituation.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                employeeContractSituation.EmployeeExitEvent = new EmployeeExitEvent();

                                employeeContractSituation.EmployeeExitEvent.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                if (reader["IdExitEvent"] != DBNull.Value)
                                    employeeContractSituation.EmployeeExitEvent.IdExitEvent = Convert.ToInt32(reader["IdExitEvent"]);
                            }

                            employeeContractSituations.Add(employeeContractSituation);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeContractSituationsByIdEmployee_V2035(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContractSituations;
        }


        public List<EmployeeJobDescription> GetEmployeeJobDescriptionsByIdEmployee_V2035(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeJobDescriptionsByIdEmployee_V2035", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeJobDescription.Company = new Company();
                                employeeJobDescription.Company.IdCompany = employeeJobDescription.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeeJobDescription.JobDescription = new JobDescription();
                                employeeJobDescription.JobDescription.IdJobDescription = employeeJobDescription.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["Abbreviation"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeeJobDescription.JobDescription.Department = new Department();
                                    employeeJobDescription.JobDescription.Department.IdDepartment = employeeJobDescription.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                    if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                }
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                employeeJobDescription.JobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"]);
                                employeeJobDescription.JobDescription.JDLevel = new LookupValue();
                                employeeJobDescription.JobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"]);
                                if (reader["JDLevel"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.Value = Convert.ToString(reader["JDLevel"]);
                                if (reader["JDLevelHtmlColor"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.HtmlColor = Convert.ToString(reader["JDLevelHtmlColor"]);
                                if (reader["JDLevelIdImage"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDLevelIdImage"]);
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                            if (reader["JobDescriptionStartDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["JobDescriptionStartDate"]);

                            if (reader["JobDescriptionEndDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionEndDate = Convert.ToDateTime(reader["JobDescriptionEndDate"]);

                            if (reader["JobDescriptionRemarks"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionRemarks = Convert.ToString(reader["JobDescriptionRemarks"]);

                            if (reader["IdEmployeeExitEvent"] != DBNull.Value)
                            {
                                employeeJobDescription.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                employeeJobDescription.EmployeeExitEvent = new EmployeeExitEvent();

                                employeeJobDescription.EmployeeExitEvent.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                if (reader["IdExitEvent"] != DBNull.Value)
                                    employeeJobDescription.EmployeeExitEvent.IdExitEvent = Convert.ToInt32(reader["IdExitEvent"]);
                            }

                            employeeJobDescriptions.Add(employeeJobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeJobDescriptionsByIdEmployee_V2035(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeJobDescriptions;
        }
        public List<EmployeeJobDescription> GetEmployeeJobDescriptionsByIdEmployee_V2042(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeJobDescriptionsByIdEmployee_V2042", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeJobDescription.Company = new Company();
                                employeeJobDescription.Company.IdCompany = employeeJobDescription.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeeJobDescription.JobDescription = new JobDescription();
                                employeeJobDescription.JobDescription.IdJobDescription = employeeJobDescription.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["Abbreviation"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeeJobDescription.JobDescription.Department = new Department();
                                    employeeJobDescription.JobDescription.Department.IdDepartment = employeeJobDescription.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                    if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                }
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                employeeJobDescription.JobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"]);
                                employeeJobDescription.JobDescription.JDLevel = new LookupValue();
                                employeeJobDescription.JobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"]);
                                if (reader["JDLevel"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.Value = Convert.ToString(reader["JDLevel"]);
                                if (reader["JDLevelHtmlColor"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.HtmlColor = Convert.ToString(reader["JDLevelHtmlColor"]);
                                if (reader["JDLevelIdImage"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDLevelIdImage"]);
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                            if (reader["JobDescriptionStartDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["JobDescriptionStartDate"]);

                            if (reader["JobDescriptionEndDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionEndDate = Convert.ToDateTime(reader["JobDescriptionEndDate"]);

                            if (reader["JobDescriptionRemarks"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionRemarks = Convert.ToString(reader["JobDescriptionRemarks"]);

                            if (reader["IdEmployeeExitEvent"] != DBNull.Value)
                            {
                                employeeJobDescription.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                employeeJobDescription.EmployeeExitEvent = new EmployeeExitEvent();

                                employeeJobDescription.EmployeeExitEvent.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                if (reader["IdExitEvent"] != DBNull.Value)
                                    employeeJobDescription.EmployeeExitEvent.IdExitEvent = Convert.ToInt32(reader["IdExitEvent"]);
                            }
                            employeeJobDescription.IsMainVisible = Visibility.Hidden;

                            if (reader["IsMainJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IsMainJobDescription = Convert.ToByte(reader["IsMainJobDescription"]);
                                if (employeeJobDescription.IsMainJobDescription == 1)
                                {
                                    employeeJobDescription.IsMainVisible = Visibility.Visible;
                                }
                            }

                            employeeJobDescriptions.Add(employeeJobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeJobDescriptionsByIdEmployee_V2042(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeJobDescriptions;
        }


        public List<EmployeeJobDescription> GetEmployeeJobDescriptionsByIdEmployee_V2046(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeJobDescriptionsByIdEmployee_V2046", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                            employeeJobDescription.IdEmployee = idEmployee;

                            if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                employeeJobDescription.Company = new Company();
                                employeeJobDescription.Company.IdCompany = employeeJobDescription.IdCompany;

                                if (reader["CompanyName"] != DBNull.Value)
                                    employeeJobDescription.Company.Name = Convert.ToString(reader["CompanyName"]);

                                if (reader["CompanyAlias"] != DBNull.Value)
                                    employeeJobDescription.Company.Alias = Convert.ToString(reader["CompanyAlias"]);
                            }

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                employeeJobDescription.JobDescription = new JobDescription();
                                employeeJobDescription.JobDescription.IdJobDescription = employeeJobDescription.IdJobDescription;

                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                if (reader["JobDescriptionTitle"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                if (reader["Abbreviation"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                                if (reader["IdDepartment"] != DBNull.Value)
                                {
                                    employeeJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                    employeeJobDescription.JobDescription.Department = new Department();
                                    employeeJobDescription.JobDescription.Department.IdDepartment = employeeJobDescription.JobDescription.IdDepartment;

                                    if (reader["DepartmentName"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                    if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                        employeeJobDescription.JobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);
                                }
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                employeeJobDescription.JobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"]);
                                employeeJobDescription.JobDescription.JDLevel = new LookupValue();
                                employeeJobDescription.JobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"]);
                                if (reader["JDLevel"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.Value = Convert.ToString(reader["JDLevel"]);
                                if (reader["JDLevelHtmlColor"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.HtmlColor = Convert.ToString(reader["JDLevelHtmlColor"]);
                                if (reader["JDLevelIdImage"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDLevelIdImage"]);
                            }

                            if (reader["IdRegion"] != DBNull.Value)
                            {
                                employeeJobDescription.IdRegion = Convert.ToInt32(reader["IdRegion"]);
                                employeeJobDescription.Region = new LookupValue();
                                employeeJobDescription.Region.IdLookupValue = Convert.ToInt32(reader["IdRegion"]);
                                if (reader["Region"] != DBNull.Value)
                                    employeeJobDescription.Region.Value = Convert.ToString(reader["Region"]);

                                employeeJobDescription.JDScope = new LookupValue();

                                employeeJobDescription.JDScope.IdLookupValue = Convert.ToInt32(reader["IdRegion"]);
                                if (reader["Region"] != DBNull.Value)
                                    employeeJobDescription.JDScope.Value = employeeJobDescription.Region.Value;

                                employeeJobDescription.StrJDScope=employeeJobDescription.Region.Value;
                            }

                            if (reader["IdCountry"] != DBNull.Value)
                            {
                                employeeJobDescription.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                employeeJobDescription.Country = new Country();
                                employeeJobDescription.Country.IdCountry = Convert.ToByte(reader["IdCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                    employeeJobDescription.Country.Name = Convert.ToString(reader["CountryName"]);

                                employeeJobDescription.JDScope = new LookupValue();
                                employeeJobDescription.JDScope.IdLookupValue = Convert.ToInt32(reader["IdCountry"]);
                                if (reader["CountryName"] != DBNull.Value)
                                    employeeJobDescription.JDScope.Value = employeeJobDescription.Country.Name;

                                employeeJobDescription.StrJDScope = employeeJobDescription.Country.Name;
                            }
                            
                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                            if (reader["JobDescriptionStartDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["JobDescriptionStartDate"]);

                            if (reader["JobDescriptionEndDate"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionEndDate = Convert.ToDateTime(reader["JobDescriptionEndDate"]);

                            if (reader["JobDescriptionRemarks"] != DBNull.Value)
                                employeeJobDescription.JobDescriptionRemarks = Convert.ToString(reader["JobDescriptionRemarks"]);

                            if (reader["IdEmployeeExitEvent"] != DBNull.Value)
                            {
                                employeeJobDescription.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                employeeJobDescription.EmployeeExitEvent = new EmployeeExitEvent();

                                employeeJobDescription.EmployeeExitEvent.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                                if (reader["IdExitEvent"] != DBNull.Value)
                                    employeeJobDescription.EmployeeExitEvent.IdExitEvent = Convert.ToInt32(reader["IdExitEvent"]);
                            }
                            employeeJobDescription.IsMainVisible = Visibility.Hidden;

                            if (reader["IsMainJobDescription"] != DBNull.Value)
                            {
                                employeeJobDescription.IsMainJobDescription = Convert.ToByte(reader["IsMainJobDescription"]);
                                if (employeeJobDescription.IsMainJobDescription == 1)
                                {
                                    employeeJobDescription.IsMainVisible = Visibility.Visible;
                                }
                            }

                            employeeJobDescriptions.Add(employeeJobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeJobDescriptionsByIdEmployee_V2046(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeJobDescriptions;
        }


        public List<EmployeeExitEvent> GetEmployeeExitEventsByIdEmployee(string workbenchConnectionString, Int32 idEmployee, string employeeCode, string exitDocumnetFilePath)
        {
            List<EmployeeExitEvent> employeeExitEvents = new List<EmployeeExitEvent>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetExitEventsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeExitEvent employeeExitEvent = new EmployeeExitEvent();
                            employeeExitEvent.IdEmployee = idEmployee;

                            if (reader["IdEmployeeExitEvent"] != DBNull.Value)
                            {
                                employeeExitEvent.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);

                            }

                            if (reader["ExitDate"] != DBNull.Value)
                                employeeExitEvent.ExitDate = Convert.ToDateTime(reader["ExitDate"]);

                            if (reader["IdExitEvent"] != DBNull.Value)
                            {
                                employeeExitEvent.IdExitEvent = Convert.ToByte(reader["IdExitEvent"]);
                            }


                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeExitEvent.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["IdReason"] != DBNull.Value)
                            {
                                employeeExitEvent.IdReason = Convert.ToInt32(reader["IdReason"]);

                                employeeExitEvent.ExitReason = new LookupValue();
                                employeeExitEvent.ExitReason.IdLookupValue = employeeExitEvent.IdReason;
                                employeeExitEvent.ExitReason.Value = Convert.ToString(reader["Reason"]);

                            }

                            if (reader["Remarks"] != DBNull.Value)
                                employeeExitEvent.Remarks = Convert.ToString(reader["Remarks"]);

                            if (reader["FileName"] != DBNull.Value)
                            {
                                employeeExitEvent.FileName = Convert.ToString(reader["FileName"]);

                                employeeExitEvent.ExitEventBytes = GetEmployeesExitDocument(employeeCode, employeeExitEvent, exitDocumnetFilePath);
                            }

                            employeeExitEvents.Add(employeeExitEvent);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeExitEventsByIdEmployee(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeExitEvents;
        }


        public void AddUpdateDeleteEmployeeExitEvent(string mainServerWorkbenchConnectionString, Employee employee, List<EmployeeExitEvent> employeeExitEvents, string empExitEventFilesPath)
        {
            try
            {
                if (employeeExitEvents != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (EmployeeExitEvent employeeExitEvent in employeeExitEvents)
                        {
                            employeeExitEvent.IdEmployee = employee.IdEmployee;
                            if (employeeExitEvent.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                if (employeeExitEvent.IdEmployeeExitEvent > 0)
                                {
                                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeExitEvent_Update", mySqlConnection);
                                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                                    mySqlCommand.Parameters.AddWithValue("_IdEmployeeExitEvent", employeeExitEvent.IdEmployeeExitEvent);
                                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                                    mySqlCommand.Parameters.AddWithValue("_ExitDate", employeeExitEvent.ExitDate);
                                    mySqlCommand.Parameters.AddWithValue("_IdReason", employeeExitEvent.IdReason);
                                    mySqlCommand.Parameters.AddWithValue("_Remarks", employeeExitEvent.Remarks);
                                    mySqlCommand.Parameters.AddWithValue("_ExitFileName", employeeExitEvent.FileName);
                                    mySqlCommand.Parameters.AddWithValue("_IdExitEvent", employeeExitEvent.IdExitEvent);


                                    //Delete Old file of exit event document 
                                    if (!string.IsNullOrEmpty(employeeExitEvent.OldFileName))
                                        DeleteEmployeeExitEventOldDocument(empExitEventFilesPath, employee, employeeExitEvent);

                                    // Save a exit event document file.
                                    if (employeeExitEvent.ExitEventBytes != null)
                                        SaveEmployeeExitDocument_V2035(empExitEventFilesPath, employee, employeeExitEvent);
                                    else if (employeeExitEvent.IsExitEventFileDeleted)
                                        DeleteEmployeeExitEventDocument(empExitEventFilesPath, employee, employeeExitEvent);

                                    mySqlCommand.ExecuteNonQuery();
                                }
                            }
                            else if (employeeExitEvent.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeExitEvent_Insert", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_ExitDate", employeeExitEvent.ExitDate);
                                mySqlCommand.Parameters.AddWithValue("_IdReason", employeeExitEvent.IdReason);
                                mySqlCommand.Parameters.AddWithValue("_ExitFileName", employeeExitEvent.FileName);
                                mySqlCommand.Parameters.AddWithValue("_Remarks", employeeExitEvent.Remarks);
                                mySqlCommand.Parameters.AddWithValue("_IdExitEvent", employeeExitEvent.IdExitEvent);
                                mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeExitEvent.IdEmployee);


                                // Save a exit event document file.
                                if (employeeExitEvent.ExitEventBytes != null)
                                    SaveEmployeeExitDocument_V2035(empExitEventFilesPath, employee, employeeExitEvent);

                                employeeExitEvent.IdEmployeeExitEvent = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                            }
                        }

                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteEmployeeExitEvent(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public bool DeleteEmployeeExitEventOldDocument(string employeeExitFilePath, Employee employee, EmployeeExitEvent employeeExitEvent)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeExitFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeExitEvent.OldFileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeExitEventOldDocument()-Filename - {0}. ErrorMessage- {1}", employeeExitEvent.OldFileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }


        public bool DeleteEmployeeExitEventDocument(string employeeExitEventFilePath, Employee employee, EmployeeExitEvent employeeExitEvent)
        {
            try
            {
                string completePath = string.Format(@"{0}\{1}", employeeExitEventFilePath, employee.EmployeeCode);

                if (!fileMgr.DirectoryExists(completePath))
                {
                    return false;
                }
                else
                {
                    string filePath = completePath + "\\" + employeeExitEvent.FileName;

                    if (fileMgr.FileExists(filePath))
                    {
                        fileMgr.Delete(filePath);
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteEmployeeExitEventDocument()-Filename - {0}. ErrorMessage- {1}", employeeExitEvent.FileName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return true;
        }



        public CompanyShift AddCompanyShift_V2035(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Insert_V2035", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_MonStartTime", companyShift.MonStartTime);
                        mySqlCommand.Parameters.AddWithValue("_MonEndTime", companyShift.MonEndTime);
                        mySqlCommand.Parameters.AddWithValue("_MonBreakTime", companyShift.MonBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_TueStartTime", companyShift.TueStartTime);
                        mySqlCommand.Parameters.AddWithValue("_TueEndTime", companyShift.TueEndTime);
                        mySqlCommand.Parameters.AddWithValue("_TueBreakTime", companyShift.TueBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_WedStartTime", companyShift.WedStartTime);
                        mySqlCommand.Parameters.AddWithValue("_WedEndTime", companyShift.WedEndTime);
                        mySqlCommand.Parameters.AddWithValue("_WedBreakTime", companyShift.WedBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuStartTime", companyShift.ThuStartTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuEndTime", companyShift.ThuEndTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuBreakTime", companyShift.ThuBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_FriStartTime", companyShift.FriStartTime);
                        mySqlCommand.Parameters.AddWithValue("_FriEndTime", companyShift.FriEndTime);
                        mySqlCommand.Parameters.AddWithValue("_FriBreakTime", companyShift.FriBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SatStartTime", companyShift.SatStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SatEndTime", companyShift.SatEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SatBreakTime", companyShift.SatBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SunStartTime", companyShift.SunStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SunEndTime", companyShift.SunEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SunBreakTime", companyShift.SunBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_IsNightShift", companyShift.IsNightShift);

                        companyShift.IdCompanyShift = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddCompanyShift_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }


        public CompanyShift UpdateCompanyShift_V2035(string mainServerWorkbenchConnectionString, CompanyShift companyShift)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_CompanyShifts_Update_V2035", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", companyShift.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanySchedule", companyShift.IdCompanySchedule);
                        mySqlCommand.Parameters.AddWithValue("_Name", companyShift.Name);
                        mySqlCommand.Parameters.AddWithValue("_MonStartTime", companyShift.MonStartTime);
                        mySqlCommand.Parameters.AddWithValue("_MonEndTime", companyShift.MonEndTime);
                        mySqlCommand.Parameters.AddWithValue("_MonBreakTime", companyShift.MonBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_TueStartTime", companyShift.TueStartTime);
                        mySqlCommand.Parameters.AddWithValue("_TueEndTime", companyShift.TueEndTime);
                        mySqlCommand.Parameters.AddWithValue("_TueBreakTime", companyShift.TueBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_WedStartTime", companyShift.WedStartTime);
                        mySqlCommand.Parameters.AddWithValue("_WedEndTime", companyShift.WedEndTime);
                        mySqlCommand.Parameters.AddWithValue("_WedBreakTime", companyShift.WedBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuStartTime", companyShift.ThuStartTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuEndTime", companyShift.ThuEndTime);
                        mySqlCommand.Parameters.AddWithValue("_ThuBreakTime", companyShift.ThuBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_FriStartTime", companyShift.FriStartTime);
                        mySqlCommand.Parameters.AddWithValue("_FriEndTime", companyShift.FriEndTime);
                        mySqlCommand.Parameters.AddWithValue("_FriBreakTime", companyShift.FriBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SatStartTime", companyShift.SatStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SatEndTime", companyShift.SatEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SatBreakTime", companyShift.SatBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_SunStartTime", companyShift.SunStartTime);
                        mySqlCommand.Parameters.AddWithValue("_SunEndTime", companyShift.SunEndTime);
                        mySqlCommand.Parameters.AddWithValue("_SunBreakTime", companyShift.SunBreakTime);
                        mySqlCommand.Parameters.AddWithValue("_IsNightShift", companyShift.IsNightShift);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCompanyShift_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return companyShift;
        }


        public List<CompanyShift> GetEmployeeRelatedCompanyShifts_V2035(string workbenchConnectionString, Int32 idEmployee)
        {
            List<CompanyShift> companyShifts = new List<CompanyShift>();

            CompanyShift companyShiftDefault = new CompanyShift();
            companyShiftDefault.Name = "---";
            companyShifts.Add(companyShiftDefault);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeRelatedCompanyShifts_V2035", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyShift companyShift = new CompanyShift();

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["MonBreakTime"] != DBNull.Value)
                                companyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                            if (reader["TueBreakTime"] != DBNull.Value)
                                companyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                            if (reader["WedBreakTime"] != DBNull.Value)
                                companyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                            if (reader["ThuBreakTime"] != DBNull.Value)
                                companyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                            if (reader["FriBreakTime"] != DBNull.Value)
                                companyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                            if (reader["SatBreakTime"] != DBNull.Value)
                                companyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                            if (reader["SunBreakTime"] != DBNull.Value)
                                companyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanySchedule = new CompanySchedule();
                                companyShift.CompanySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                if (reader["IdCompany"] != DBNull.Value)
                                {
                                    companyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    companyShift.CompanySchedule.Company = new Company();
                                    companyShift.CompanySchedule.Company.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    companyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["Alias"]);
                                }


                            }


                            if (reader["Name"] != DBNull.Value)
                                companyShift.Name = Convert.ToString(reader["Name"]);

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                            if (reader["IsNightShift"] != DBNull.Value)
                                companyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                            companyShifts.Add(companyShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeRelatedCompanyShifts_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShifts;
        }



        public List<CompanyShift> GetAllCompanyShiftsByIdCompany_V2035(string workbenchConnectionString, string idCompanies = null)
        {
            List<CompanyShift> companyShifts = new List<CompanyShift>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllCompanyShiftsByIdCompany_V2035", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanyShift companyShift = new CompanyShift();

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                            if (reader["ShiftName"] != DBNull.Value)
                                companyShift.Name = Convert.ToString(reader["ShiftName"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanySchedule = new CompanySchedule();
                                companyShift.CompanySchedule.IdCompanySchedule = companyShift.IdCompanySchedule;

                                if (reader["WorkSchedule"] != DBNull.Value)
                                    companyShift.CompanySchedule.Name = Convert.ToString(reader["WorkSchedule"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                {
                                    companyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    companyShift.CompanySchedule.Company = new Company();
                                    companyShift.CompanySchedule.Company.IdCompany = companyShift.CompanySchedule.IdCompany;
                                    companyShift.CompanySchedule.Company.Name = Convert.ToString(reader["CompanyName"]);
                                    companyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["Alias"]);
                                }
                            }

                            if (reader["MonStartTime"] != DBNull.Value)
                                companyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                            if (reader["MonEndTime"] != DBNull.Value)
                                companyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                            if (reader["MonBreakTime"] != DBNull.Value)
                                companyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                            if (reader["TueStartTime"] != DBNull.Value)
                                companyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                            if (reader["TueEndTime"] != DBNull.Value)
                                companyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                            if (reader["TueBreakTime"] != DBNull.Value)
                                companyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                            if (reader["WedStartTime"] != DBNull.Value)
                                companyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                            if (reader["WedEndTime"] != DBNull.Value)
                                companyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                            if (reader["WedBreakTime"] != DBNull.Value)
                                companyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                            if (reader["ThuStartTime"] != DBNull.Value)
                                companyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                            if (reader["ThuEndTime"] != DBNull.Value)
                                companyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];

                            if (reader["ThuBreakTime"] != DBNull.Value)
                                companyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                            if (reader["FriStartTime"] != DBNull.Value)
                                companyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                            if (reader["FriEndTime"] != DBNull.Value)
                                companyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                            if (reader["FriBreakTime"] != DBNull.Value)
                                companyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                            if (reader["SatStartTime"] != DBNull.Value)
                                companyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                            if (reader["SatEndTime"] != DBNull.Value)
                                companyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                            if (reader["SatBreakTime"] != DBNull.Value)
                                companyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                            if (reader["SunStartTime"] != DBNull.Value)
                                companyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                            if (reader["SunEndTime"] != DBNull.Value)
                                companyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                            if (reader["SunBreakTime"] != DBNull.Value)
                                companyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];

                            if (reader["IsNightShift"] != DBNull.Value)
                                companyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                            companyShifts.Add(companyShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllCompanyShiftsByIdCompany_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShifts;
        }

        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2035(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2035", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employeeAttendances;
        }

        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2035(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2035", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;


                                    if (empReader["MonBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.MonBreakTime = (TimeSpan)empReader["MonBreakTime"];

                                    if (empReader["TueBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.TueBreakTime = (TimeSpan)empReader["TueBreakTime"];

                                    if (empReader["WedBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.WedBreakTime = (TimeSpan)empReader["WedBreakTime"];

                                    if (empReader["ThuBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.ThuBreakTime = (TimeSpan)empReader["ThuBreakTime"];

                                    if (empReader["FriBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.FriBreakTime = (TimeSpan)empReader["FriBreakTime"];

                                    if (empReader["SatBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SatBreakTime = (TimeSpan)empReader["SatBreakTime"];

                                    if (empReader["SunBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SunBreakTime = (TimeSpan)empReader["SunBreakTime"];

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                                }
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                    if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                    Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                    employee.EmployeeContractSituations.Add(employeeContractSituation);
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }



        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2036(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2036", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["AccountingDate"] != DBNull.Value)
                                {
                                    employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employeeAttendances;
        }


        public bool UpdateEmployeeAttendance_V2036(string mainServerWorkbenchConnectionString, EmployeeAttendance employeeAttendance)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendanceUpdate_V2036", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeAttendance", employeeAttendance.IdEmployeeAttendance);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeAttendance.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", employeeAttendance.IdCompanyWork);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeAttendance.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeAttendance.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeAttendance.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_AccountingDate", employeeAttendance.AccountingDate);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployeeAttendance_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return true;
        }

        public EmployeeAttendance AddEmployeeAttendance_V2036(string mainServerWorkbenchConnectionString, EmployeeAttendance employeeAttendance)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendanceInsert_V2036", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeAttendance.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", employeeAttendance.IdCompanyWork);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeAttendance.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeAttendance.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeAttendance.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_AccountingDate", employeeAttendance.AccountingDate);

                        employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeAttendance_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeAttendance;
        }


        public List<EmployeeAttendance> AddEmpAttendanceWithClockIdFromExcel_V2036(string mainServerWorkbenchConnectionString, List<EmployeeAttendance> employeeAttendanceList)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmpAttendanceInsertFromExcelByClockId_V2036", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        foreach (EmployeeAttendance item in employeeAttendanceList)
                        {
                            mySqlCommand.Parameters.Clear();

                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", item.ClockID);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", item.IdCompanyWork);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", item.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", item.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", item.EndDate);
                            mySqlCommand.Parameters.AddWithValue("_AccountingDate", item.AccountingDate);

                            item.IdEmployeeAttendance = Convert.ToInt64(mySqlCommand.ExecuteScalar());

                        }

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmpAttendanceWithClockIdFromExcel_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeAttendanceList;
        }

        public List<EmployeeAttendance> AddEmployeeImportAttendance_V2038(string mainServerWorkbenchConnectionString, List<EmployeeAttendance> employeeAttendanceList)
        {
            using (TransactionScope transactionScope = new TransactionScope(TransactionScopeOption.Required, TimeSpan.FromMinutes(10)))
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_AddEmployeeImportAttendance_V2038", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        foreach (EmployeeAttendance item in employeeAttendanceList)
                        {
                            mySqlCommand.Parameters.Clear();

                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", item.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", item.ClockID);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", item.IdCompanyWork);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", item.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", item.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", item.EndDate);
                            mySqlCommand.Parameters.AddWithValue("_AccountingDate", item.AccountingDate);

                            item.IdEmployeeAttendance = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                        }

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeImportAttendance_V2038(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeAttendanceList;
        }


        public List<Employee> GetEmpDtlByEmpDocNoAndPeriod_V2036(string workbenchConnectionString, string EmployeeDocumentNumbers, string idCompany, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmpDtlByEmpDocNoAndPeriod_V2036", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumbers);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employee.LastName = Convert.ToString(reader["LastName"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                        employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                        employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }

                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                        employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);
                                        string[] LstCompanyIds = employee.EmployeeCompanyIds.Split('\n');
                                        employee.EmployeeCompanyIds = string.Join("\n", LstCompanyIds.Distinct());
                                    }

                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employee.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }

                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation = new EmployeeContractSituation();
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }


                                employees.Add(employee);
                            }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2032(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }


        public List<Employee> GetAllEmployeesByIdCompany_V2036(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByIdCompany_V2036", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["IdGender"] != DBNull.Value)
                                {
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                    employee.Gender = new LookupValue();
                                    employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                    employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                                }

                                if (empReader["IdMaritalStatus"] != DBNull.Value)
                                {
                                    employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                    employee.MaritalStatus = new LookupValue();
                                    employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                    employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                                }

                                if (empReader["IdNationality"] != DBNull.Value)
                                {
                                    employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                    employee.Nationality = new Country();
                                    employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                    employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                                }

                                if (empReader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (empReader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (empReader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(empReader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (empReader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (empReader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["CompanyMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(empReader["CompanyMobiles"]);
                                    employee.EmployeeContactCompanyMobileList = Convert.ToString(empReader["CompanyMobiles"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyMobileList != null && employee.EmployeeContactCompanyMobileList.Count > 0)
                                    {
                                        employee.EmployeeContactMobile = employee.EmployeeContactCompanyMobileList.First();
                                    }
                                }

                                if (empReader["CompanyEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyEmailList = Convert.ToString(empReader["CompanyEmails"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyEmailList != null && employee.EmployeeContactCompanyEmailList.Count > 0)
                                    {
                                        employee.EmployeeContactEmail = employee.EmployeeContactCompanyEmailList.First();
                                    }
                                }

                                if (empReader["PrivateMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateMobiles = Convert.ToString(empReader["PrivateMobiles"]);
                                    employee.EmployeeContactPrivateMobileList = Convert.ToString(empReader["PrivateMobiles"]).Split('\n').ToList<string>();
                                }

                                if (empReader["employeeShiftNames"] != DBNull.Value)
                                {
                                    employee.EmployeeShiftNames = Convert.ToString(empReader["employeeShiftNames"]);
                                    List<string> eshiftNames = Convert.ToString(empReader["employeeShiftNames"]).Split('\n').ToList<string>();
                                    eshiftNames = eshiftNames.Distinct().ToList();
                                    employee.EmployeeShiftNames = string.Join("\n", eshiftNames.ToArray());
                                }

                                if (empReader["employeeShiftScheduleNames"] != DBNull.Value)
                                {

                                    employee.EmployeeShiftScheduleNames = Convert.ToString(empReader["employeeShiftScheduleNames"]);
                                    List<string> eshiftScheduleNames = Convert.ToString(empReader["employeeShiftScheduleNames"]).Split('\n').ToList<string>();
                                    eshiftScheduleNames = eshiftScheduleNames.Distinct().ToList();
                                    employee.EmployeeShiftScheduleNames = string.Join("\n", eshiftScheduleNames.ToArray());
                                }

                                if (empReader["PrivateEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateEmailList = Convert.ToString(empReader["PrivateEmails"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }


                                if (empReader["Languages"] != DBNull.Value)
                                    employee.Languages = Convert.ToString(empReader["Languages"]);

                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["EmployeeDocumentNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocNationalId = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentName = Convert.ToString(empReader["EmployeeDocumentName"]);
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                }

                                if (empReader["DocPassportNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPassport = Convert.ToString(empReader["DocPassportNumber"]);
                                }

                                if (empReader["DocDrLicenseNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocDrLicense = Convert.ToString(empReader["DocDrLicenseNumber"]);
                                }

                                if (empReader["DocPubInsNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPubIns = Convert.ToString(empReader["DocPubInsNumber"]);
                                }

                                if (empReader["DocPriInsNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocPriIns = Convert.ToString(empReader["DocPriInsNumber"]);
                                }

                                if (empReader["DocVisaNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocVisa = Convert.ToString(empReader["DocVisaNumber"]);
                                }

                                if (empReader["DocOtherNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocOther = Convert.ToString(empReader["DocOtherNumber"]);
                                }

                                if (empReader["DocClockIdNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocClockId = Convert.ToString(empReader["DocClockIdNumber"]);
                                }

                                // Exit 
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                if (empReader["ExitIdReason"] != DBNull.Value)
                                {
                                    employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                    employee.ExitReason = new LookupValue();
                                    employee.ExitReason.IdLookupValue = (Int32)employee.ExitIdReason;
                                    employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                                }

                                if (empReader["ExitRemarks"] != DBNull.Value)
                                    employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                    empJobDescription.JobDescription = new JobDescription();

                                    if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);
                                    }



                                    if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);
                                    }

                                    if (empReader["JobCodeAndTitles"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitleAndCode = Convert.ToString(empReader["JobCodeAndTitles"]);
                                    }


                                    if (empReader["DepartmentName"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                    }



                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }

                                    empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["MaxJobDescriptionUsage"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }


                                employee.ContractSituation = new ContractSituation();
                                // employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                {
                                    employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                }


                                if (empReader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(empReader["LengthOfService"]);

                                }

                                if (empReader["IdEmployeeStatus"] != DBNull.Value)
                                {
                                    employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus = new LookupValue();
                                    employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus.Value = empReader["EmployeeStatus"].ToString();
                                    employee.EmployeeStatus.HtmlColor = empReader["EmployeeStatusColor"].ToString();

                                    if (empReader["EmployeeIdImage"] != DBNull.Value)
                                        employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["EmployeeIdImage"].ToString());

                                    if (empReader["EmployeeStatusPosition"] != DBNull.Value)
                                        employee.EmployeeStatus.Position = Convert.ToInt32(empReader["EmployeeStatusPosition"].ToString());
                                }

                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["CompanyShiftName"] != DBNull.Value)
                                        employee.CompanyShift.Name = Convert.ToString(empReader["CompanyShiftName"]);

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["WorkScheduleName"]);
                                    }

                                    if (empReader["StartTime1"] != DBNull.Value)
                                        employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                    if (empReader["EndTime1"] != DBNull.Value)
                                        employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                    if (empReader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];
                                }

                                if (empReader["IdCompanyLocation"] != DBNull.Value)
                                {
                                    employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation = new Company();
                                    employee.CompanyLocation.IdCompany = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["Location"]);
                                }

                                if (empReader["Organization"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Organization"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Organization = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["Company"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Company"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Company = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    List<string> tempDiffDepart = Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>();
                                    tempDiffDepart = tempDiffDepart.Distinct().ToList();
                                    employee.EmployeeDepartments = string.Join("\n", tempDiffDepart.ToArray()); ;
                                }
                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    Employee emp = employees.Where(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])).FirstOrDefault();
                                    if (emp != null)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                        if (empReader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                        if (empReader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(empReader["ContractSituationFileName"]);
                                        if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);
                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);
                                        if (empReader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(empReader["ContractSituationRemarks"]);
                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);
                                        if (empReader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(empReader["IdProfessionalCategory"]);


                                        emp.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesByIdCompany_V2036().", category: Category.Info, priority: Priority.Low);
            return employees;
        }


        public bool UpdateExitEmployeeStatusInActive(string mainServerWorkbenchConnectionString, DateTime currentDate)
        {
            bool isUpdated = false;


            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand empCommand = new MySqlCommand("HRM_UpdateExitEmployeeStatusInActive", mySqlConnection);
                        empCommand.CommandType = CommandType.StoredProcedure;
                        empCommand.Parameters.AddWithValue("_CurrentDate", currentDate);
                        empCommand.ExecuteNonQuery();

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateExitEmployeeStatusInActive(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    isUpdated = false;
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdated;
        }


        public List<EmployeeShift> GetEmployeeShiftsByIdEmployee(string workbenchConnectionString, Int32 idEmployee)
        {
            List<EmployeeShift> employeeShifts = new List<EmployeeShift>();
            EmployeeShift employeeShiftDefault = new EmployeeShift();
            employeeShiftDefault.CompanyShift = new CompanyShift();
            employeeShiftDefault.CompanyShift.Name = "---";
            employeeShifts.Add(employeeShiftDefault);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetEmployeeShiftsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeShift employeeShift = new EmployeeShift();

                            if (reader["IdEmployeeShift"] != DBNull.Value)
                                employeeShift.IdEmployeeShift = Convert.ToInt32(reader["IdEmployeeShift"]);

                            if (reader["IdCompanyShift"] != DBNull.Value)
                            {
                                employeeShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                employeeShift.CompanyShift = new CompanyShift();
                                employeeShift.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                employeeShift.CompanyShift.Name = Convert.ToString(reader["ShiftName"]);

                                if (reader["MonStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                                if (reader["MonEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                                if (reader["MonBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                                if (reader["TueStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                                if (reader["TueEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                                if (reader["TueBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                                if (reader["WedStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                                if (reader["WedEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                                if (reader["WedBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                                if (reader["ThuStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                                if (reader["ThuEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];

                                if (reader["ThuBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                                if (reader["FriStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                                if (reader["FriEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                                if (reader["FriBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                                if (reader["SatStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                                if (reader["SatEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                                if (reader["SatBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                                if (reader["SunStartTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                                if (reader["SunEndTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                                if (reader["SunBreakTime"] != DBNull.Value)
                                    employeeShift.CompanyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];

                                if (reader["IsNightShift"] != DBNull.Value)
                                    employeeShift.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                if (reader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employeeShift.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeShift.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employeeShift.CompanyShift.CompanySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeShift.CompanyShift.CompanySchedule.Name = Convert.ToString(reader["CompanyScheduleName"]);


                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeShift.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeShift.CompanyShift.CompanySchedule.Company = new Company();
                                        employeeShift.CompanyShift.CompanySchedule.Company.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeShift.CompanyShift.CompanySchedule.Company.Name = Convert.ToString(reader["CompanyName"]);
                                        employeeShift.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["CompanyShortName"]);

                                    }
                                }
                            }


                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeShift.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["StartDate"] != DBNull.Value)
                                employeeShift.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeShift.EndDate = Convert.ToDateTime(reader["EndDate"]);


                            employeeShifts.Add(employeeShift);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeShiftByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeShifts;
        }

        public CompanyShift GetCompanyShiftDetailAfterUpdateAdd(Int32 idCompanyShift,string connectionString,Int64 selectedPeriod)
        {
            CompanyShift companyShift = new CompanyShift();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetCompanyShiftDetailAfterAddUpdate", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", idCompanyShift);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                         

                            if (reader["IdCompanyShift"] != DBNull.Value)
                            {
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                if (reader["MonStartTime"] != DBNull.Value)
                                    companyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                                if (reader["MonEndTime"] != DBNull.Value)
                                    companyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                                if (reader["MonBreakTime"] != DBNull.Value)
                                    companyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                                if (reader["TueStartTime"] != DBNull.Value)
                                    companyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                                if (reader["TueEndTime"] != DBNull.Value)
                                    companyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                                if (reader["TueBreakTime"] != DBNull.Value)
                                    companyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                                if (reader["WedStartTime"] != DBNull.Value)
                                    companyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                                if (reader["WedEndTime"] != DBNull.Value)
                                    companyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                                if (reader["WedBreakTime"] != DBNull.Value)
                                    companyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                                if (reader["ThuStartTime"] != DBNull.Value)
                                    companyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                                if (reader["ThuEndTime"] != DBNull.Value)
                                    companyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];

                                if (reader["ThuBreakTime"] != DBNull.Value)
                                    companyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                                if (reader["FriStartTime"] != DBNull.Value)
                                    companyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                                if (reader["FriEndTime"] != DBNull.Value)
                                    companyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                                if (reader["FriBreakTime"] != DBNull.Value)
                                    companyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                                if (reader["SatStartTime"] != DBNull.Value)
                                    companyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                                if (reader["SatEndTime"] != DBNull.Value)
                                    companyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                                if (reader["SatBreakTime"] != DBNull.Value)
                                    companyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                                if (reader["SunStartTime"] != DBNull.Value)
                                    companyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                                if (reader["SunEndTime"] != DBNull.Value)
                                    companyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                                if (reader["SunBreakTime"] != DBNull.Value)
                                    companyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];

                                if (reader["IsNightShift"] != DBNull.Value)
                                    companyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                            }

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                companyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                companyShift.CompanyAnnualSchedule.IdCompanySchedule = companyShift.IdCompanySchedule;

                                if (reader["Year"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["DailyHoursCount"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                if (reader["WorkingDays"] != DBNull.Value)
                                    companyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);

                                if (reader["Value"] != DBNull.Value)
                                {
                                    companyShift.CompanyAnnualSchedule.CompanySetting = new CompanySetting();
                                    companyShift.CompanyAnnualSchedule.CompanySetting.Value = Convert.ToString(reader["Value"]);
                                }
                            }

                            if (reader["StartTime1"] != DBNull.Value)
                                companyShift.StartTime1 = (TimeSpan)reader["StartTime1"];

                            if (reader["EndTime1"] != DBNull.Value)
                                companyShift.EndTime1 = (TimeSpan)reader["EndTime1"];

                            if (reader["BreakTime"] != DBNull.Value)
                                companyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyShiftDetailByIdCompanyShift(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return companyShift;
        }

        public Employee GetEmployeeByIdEmployee_V2036(string workbenchConnectionString, Int32 idEmployee, string exitDocumentFilePath, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                employee.EmployeeShifts = GetEmployeeShifts_V2034(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee_V2035(workbenchConnectionString, idEmployee);

                employee.EmployeeExitEvents = GetEmployeeExitEventsByIdEmployee_V2036(workbenchConnectionString, idEmployee, employee.EmployeeCode, exitDocumentFilePath);
                employee.EmployeeShifts = GetEmployeeShiftsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeShifts != null)
                {
                    if (employee.EmployeeShifts.Count > 0)
                        employee.EmployeeShifts.RemoveAt(0);
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2036(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }

        public List<EmployeeExitEvent> GetEmployeeExitEventsByIdEmployee_V2036(string workbenchConnectionString, Int32 idEmployee, string employeeCode, string exitDocumnetFilePath)
        {
            List<EmployeeExitEvent> employeeExitEvents = new List<EmployeeExitEvent>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetExitEventsByIdEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeExitEvent employeeExitEvent = new EmployeeExitEvent();
                            employeeExitEvent.IdEmployee = idEmployee;

                            if (reader["IdEmployeeExitEvent"] != DBNull.Value)
                            {
                                employeeExitEvent.IdEmployeeExitEvent = Convert.ToInt64(reader["IdEmployeeExitEvent"]);
                                employeeExitEvent.IsExist = true;
                            }

                            if (reader["ExitDate"] != DBNull.Value)
                                employeeExitEvent.ExitDate = Convert.ToDateTime(reader["ExitDate"]);

                            if (reader["IdExitEvent"] != DBNull.Value)
                            {
                                employeeExitEvent.IdExitEvent = Convert.ToByte(reader["IdExitEvent"]);
                            }


                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeExitEvent.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["IdReason"] != DBNull.Value)
                            {
                                employeeExitEvent.IdReason = Convert.ToInt32(reader["IdReason"]);

                                employeeExitEvent.ExitReason = new LookupValue();
                                employeeExitEvent.ExitReason.IdLookupValue = employeeExitEvent.IdReason;
                                employeeExitEvent.ExitReason.Value = Convert.ToString(reader["Reason"]);

                            }

                            if (reader["Remarks"] != DBNull.Value)
                                employeeExitEvent.Remarks = Convert.ToString(reader["Remarks"]);

                            if (reader["FileName"] != DBNull.Value)
                            {
                                employeeExitEvent.FileName = Convert.ToString(reader["FileName"]);

                                employeeExitEvent.ExitEventBytes = GetEmployeesExitDocument(employeeCode, employeeExitEvent, exitDocumnetFilePath);
                            }

                            employeeExitEvents.Add(employeeExitEvent);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeExitEventsByIdEmployee_V2036(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeExitEvents;
        }

        public Employee AddEmployee_V2036(string mainServerWorkbenchConnectionString, string workbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {

            employee.EmployeeCode = GetLatestEmployeeCode(workbenchConnectionString);

            if (!string.IsNullOrEmpty(employee.EmployeeCode))
            {
                using (TransactionScope transactionScope = new TransactionScope())
                {
                    try
                    {
                        //string lastestEmployeeCode = "";


                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Insert_V2031", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            //if (!string.IsNullOrEmpty(lastestEmployeeCode) && lastestEmployeeCode != employee.EmployeeCode)
                            //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", lastestEmployeeCode);
                            //else
                            //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                            mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                            mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                            mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                            if (employee.DateOfBirth.HasValue)
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                            else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                            else
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                            mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                            mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                            if (employee.IdMaritalStatus > 0)
                                mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                            mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                            mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                            mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                            mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                            mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                            mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                            mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                            mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                            mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                            mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                            mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                            mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                            mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                            mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);


                            employee.IdEmployee = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                            mySqlConnection.Close();
                        }

                        if (employee.IdEmployee > 0)
                        {
                            if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)   //Save employee profile image.
                                SaveEmployeeProfileImage(employeeProfileImage, employee);
                            else if (employee.IsProfileImageDeleted)                                       //Delete employee profile image.
                                DeleteEmployeeProfileImage(employeeProfileImage, employee);

                            //if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                            //    SaveEmployeeExitDocument(employeeExitDocument, employee);
                            //else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                            //    DeleteEmployeeExitDocument(employeeExitDocument, employee);

                            AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                            AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                            AddEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                            AddEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                            AddEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                            AddEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                            AddEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                            AddEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                            AddEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                            AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                            AddEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                            AddEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                            AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                        }

                        transactionScope.Complete();
                        transactionScope.Dispose();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error AddEmployee_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        if (Transaction.Current != null)
                            Transaction.Current.Rollback();

                        if (transactionScope != null)
                            transactionScope.Dispose();

                        throw;
                    }
                }
            }

            return employee;
        }

        public Employee AddEmployee_V2042(string mainServerWorkbenchConnectionString, string workbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {

            employee.EmployeeCode = GetLatestEmployeeCode(workbenchConnectionString);

            if (!string.IsNullOrEmpty(employee.EmployeeCode))
            {
                using (TransactionScope transactionScope = new TransactionScope())
                {
                    try
                    {
                        //string lastestEmployeeCode = "";


                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Insert_V2031", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            //if (!string.IsNullOrEmpty(lastestEmployeeCode) && lastestEmployeeCode != employee.EmployeeCode)
                            //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", lastestEmployeeCode);
                            //else
                            //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                            mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                            mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                            mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                            if (employee.DateOfBirth.HasValue)
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                            else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                            else
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                            mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                            mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                            if (employee.IdMaritalStatus > 0)
                                mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                            mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                            mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                            mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                            mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                            mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                            mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                            mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                            mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                            mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                            mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                            mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                            mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                            mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                            mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);


                            employee.IdEmployee = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                            mySqlConnection.Close();
                        }

                        if (employee.IdEmployee > 0)
                        {
                            if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)   //Save employee profile image.
                                SaveEmployeeProfileImage(employeeProfileImage, employee);
                            else if (employee.IsProfileImageDeleted)                                       //Delete employee profile image.
                                DeleteEmployeeProfileImage(employeeProfileImage, employee);

                            //if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                            //    SaveEmployeeExitDocument(employeeExitDocument, employee);
                            //else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                            //    DeleteEmployeeExitDocument(employeeExitDocument, employee);

                            AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                            AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                            AddEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                            AddEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                            AddEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                            AddEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                            AddEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                            AddEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                            AddEmployeeJobDescriptions_V2042(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                            AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                            AddEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                            AddEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                            AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                        }

                        transactionScope.Complete();
                        transactionScope.Dispose();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error AddEmployee_V2036(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        if (Transaction.Current != null)
                            Transaction.Current.Rollback();

                        if (transactionScope != null)
                            transactionScope.Dispose();

                        throw;
                    }
                }
            }

            return employee;
        }

        public CompanyShift GetAnnualScheduleByIdCompanyShift(string workbenchConnectionString, Int32 idCompanyShift, Int32 year)
        {
            CompanyShift companyShift = new CompanyShift();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetAnnualScheduleByIdCompanyShift", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", idCompanyShift);
                    mySqlCommand.Parameters.AddWithValue("_Year", year);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {

                            if (reader["IdCompanyShift"] != DBNull.Value)
                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);


                            if (reader["ShiftName"] != DBNull.Value)
                                companyShift.Name = Convert.ToString(reader["ShiftName"]);

                            if (reader["IdCompanySchedule"] != DBNull.Value)
                            {
                                companyShift.CompanySchedule = new CompanySchedule();
                                companyShift.CompanySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                if (reader["CompanyScheduleName"] != DBNull.Value)
                                    companyShift.CompanySchedule.Name = Convert.ToString(reader["CompanyScheduleName"]);
                                if (reader["IdCompany"] != DBNull.Value)
                                    companyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                {
                                    companyShift.CompanySchedule.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    companyShift.CompanySchedule.CompanyAnnualSchedule.IdCompanyAnnualSchedule = Convert.ToInt64(reader["IdCompanyAnnualSchedule"]);
                                    if (reader["Year"] != DBNull.Value)
                                        companyShift.CompanySchedule.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                    if (reader["DailyHoursCount"] != DBNull.Value)
                                        companyShift.CompanySchedule.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                    if (reader["WeeklyHoursCount"] != DBNull.Value)
                                        companyShift.CompanySchedule.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                    if (reader["WorkingDays"] != DBNull.Value)
                                        companyShift.CompanySchedule.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                }


                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAnnualScheduleByIdCompanyShift(). IdCompanyShift- {0} ErrorMessage- {1}", idCompanyShift, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyShift;
        }

        public List<Employee> GetExitEmployeeToUpdateStatusInActive(string workbenchConnectionString, DateTime currentDate)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_ExitEmployeeToUpdateStatusInActive", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Employee employee = new Employee();

                            if (reader["IdEmployee"] != DBNull.Value)
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);


                            if (reader["IdEmployeeStatus"] != DBNull.Value)
                                employee.IdEmployeeStatus = Convert.ToInt32(reader["IdEmployeeStatus"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            employees.Add(employee);
                        }
                    }
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetExitEmployeeToUpdateStatusInActive().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is obsolete after V2038 use this method instead IsExistDocumentNumberInAnotherEmployee_V2038
        /// </summary>
        /// <param name="workbenchConnectionString"></param>
        /// <param name="employeeDocumentNumber"></param>
        /// <param name="idEmployee"></param>
        /// <param name="employeeDocumentIdType"></param>
        /// <returns></returns>
        public bool IsExistDocumentNumberInAnotherEmployee(string workbenchConnectionString, string employeeDocumentNumber, Int32 idEmployee, Int32 employeeDocumentIdType)
        {
            bool isExist = false;

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_IsExistDocumentNumberInAnotherEmployee", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_employeeDocumentNumber", employeeDocumentNumber);
                    mySqlCommand.Parameters.AddWithValue("_idEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_employeeDocumentIdType", employeeDocumentIdType);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.Read())
                        {
                            if (reader["IdEmployeeDocument"] != DBNull.Value)
                                isExist = true;
                        }
                    }
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsExistDocumentNumberInAnotherEmployee().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                isExist = false;
                throw;
            }

            return isExist;
        }

        public bool IsExistDocumentNumberInAnotherEmployee_V2038(string workbenchConnectionString, string employeeDocumentNumber, Int32 idEmployee, Int32 employeeDocumentIdType, Int32 idCompany)
        {
            bool isExist = false;

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_IsExistDocumentNumberInAnotherEmployee_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_employeeDocumentNumber", employeeDocumentNumber);
                    mySqlCommand.Parameters.AddWithValue("_idEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_employeeDocumentIdType", employeeDocumentIdType);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.Read())
                        {
                            if (reader["IdEmployeeDocument"] != DBNull.Value)
                                isExist = true;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsExistDocumentNumberInAnotherEmployee().ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                isExist = false;
                throw;
            }

            return isExist;
        }


        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2037(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2037", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;


                                    if (empReader["MonBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.MonBreakTime = (TimeSpan)empReader["MonBreakTime"];

                                    if (empReader["TueBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.TueBreakTime = (TimeSpan)empReader["TueBreakTime"];

                                    if (empReader["WedBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.WedBreakTime = (TimeSpan)empReader["WedBreakTime"];

                                    if (empReader["ThuBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.ThuBreakTime = (TimeSpan)empReader["ThuBreakTime"];

                                    if (empReader["FriBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.FriBreakTime = (TimeSpan)empReader["FriBreakTime"];

                                    if (empReader["SatBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SatBreakTime = (TimeSpan)empReader["SatBreakTime"];

                                    if (empReader["SunBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SunBreakTime = (TimeSpan)empReader["SunBreakTime"];

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                                }
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2037(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                    if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                    Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                    employee.EmployeeContractSituations.Add(employeeContractSituation);
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2037(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }


        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2037(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2037", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["AccountingDate"] != DBNull.Value)
                                {
                                    employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2035(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employeeAttendances;
        }

        public List<Employee> GetEmployeesWithAnniversaryDate_V2037(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {

            List<Employee> employees = new List<Employee>();
            List<Employee> employeesCompletedyears = new List<Employee>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractSituationsByYear", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_CompanyIds", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {

                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])))
                                    {
                                        employee = employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).FirstOrDefault();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                    }
                                    else
                                    {
                                        employee = new Employee();
                                        employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        employee.FirstName = Convert.ToString(reader["FirstName"]);
                                        employee.LastName = Convert.ToString(reader["LastName"]);
                                        employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                        employees.Add(employee);
                                    }
                                }
                            }
                        }

                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesWithAnniversaryDate_V2037(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (Employee employee in employees)
            {

                if (employee.EmployeeContractSituations != null)
                {
                    for (int i = 1; i <= 12; i++)
                    {
                        for (DateTime currentDate = new DateTime(Convert.ToInt32(selectedPeriod), i, 1); currentDate.Month == i; currentDate = currentDate.AddDays(1))
                        {

                            employee.LengthOfServiceString = CalculateLengthOfServiceByDate(employee.EmployeeContractSituations, currentDate);

                            if (employee.LengthOfServiceString != null && Convert.ToInt64(employee.LengthOfServiceString) > 0)
                            {
                                employee.BirthDate = currentDate;
                                employee.DateOfBirth = currentDate;
                                employee.LengthOfService = Convert.ToInt32(employee.LengthOfServiceString);
                                employeesCompletedyears.Add(employee);
                                break;
                            }
                        }
                        if (employee.LengthOfService > 0)
                        {
                            break;
                        }
                    }
                }
            }

            return employeesCompletedyears;


        }

        /// <summary>
        /// [cpatil][13-12-2019][GEOS2-1831]Import attendance (all data sources) with night shifts values. [IES15]
        /// </summary>
        /// <param name="workbenchConnectionString"></param>
        /// <param name="companyIds"></param>
        /// <returns></returns>
        public List<Company> GetCompaniesDetailByIds(string workbenchConnectionString, string companyIds)
        {

            List<Company> companies = new List<Company>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompaniesDetailByIds", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CompanyIds", companyIds);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {

                            while (reader.Read())
                            {
                                if (reader["IdCompany"] != DBNull.Value)
                                    if (companies.Any(comp => comp.IdCompany == Convert.ToInt32(reader["IdCompany"])))
                                    {
                                        Company company = companies.Where(comp => comp.IdCompany == Convert.ToInt32(reader["IdCompany"])).FirstOrDefault();

                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                            if (company.CompanySchedules.Any(compsc => compsc.IdCompanySchedule == Convert.ToInt32(reader["IdCompanySchedule"])))
                                            {


                                                CompanySchedule companySchedule = company.CompanySchedules.Where(compsc => compsc.IdCompanySchedule == Convert.ToInt32(reader["IdCompanySchedule"])).FirstOrDefault();
                                                companySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);

                                                if (reader["IdCompanyShift"] != DBNull.Value)
                                                {
                                                    CompanyShift companyShift = new CompanyShift();
                                                    companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                                        companyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);
                                                    companySchedule.CompanyShifts.Add(companyShift);
                                                }

                                            }
                                            else
                                            {

                                                CompanySchedule companySchedule = new CompanySchedule();
                                                companySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);

                                                if (reader["IdCompanyShift"] != DBNull.Value)
                                                {
                                                    companySchedule.CompanyShifts = new List<CompanyShift>();
                                                    CompanyShift companyShift = new CompanyShift();
                                                    companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                                        companyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);
                                                    companySchedule.CompanyShifts.Add(companyShift);
                                                }
                                                company.CompanySchedules.Add(companySchedule);
                                            }
                                    }
                                    else
                                    {
                                        Company company = new Company();
                                        company.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        if (reader["Name"] != DBNull.Value)
                                            company.Name = Convert.ToString(reader["Name"]);
                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                        {
                                            company.CompanySchedules = new List<CompanySchedule>();
                                            CompanySchedule companySchedule = new CompanySchedule();
                                            companySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);

                                            if (reader["IdCompanyShift"] != DBNull.Value)
                                            {
                                                companySchedule.CompanyShifts = new List<CompanyShift>();
                                                CompanyShift companyShift = new CompanyShift();
                                                companyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                                if (reader["IdCompanyShift"] != DBNull.Value)
                                                    companyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);
                                                companySchedule.CompanyShifts.Add(companyShift);
                                            }
                                            company.CompanySchedules.Add(companySchedule);
                                        }
                                        companies.Add(company);
                                    }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompaniesDetailByIds(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companies;
        }

        /// <summary>
        /// [cpatil][13-12-2019][GEOS2-1831]Import attendance (all data sources) with night shifts values. [IES15]
        ///[001] [cpatil][17-12-2019][GEOS2-1831]Import attendance (all data sources) with night shifts values. [IES15]
        /// </summary>
        /// <param name="workbenchConnectionString"></param>
        /// <param name="employeeIds"></param>
        /// <returns></returns>
        public List<Employee> GetAllEmployeeShifts(string workbenchConnectionString, string employeeIds)
        {
            List<Employee> employees = new List<Employee>();


            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetALLEmployeeShifts", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_employeeIds", employeeIds);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            if (employees.Any(emp => emp.IdEmployee == Convert.ToInt32(reader["IdEmployee"])))
                            {
                                Employee employee = employees.Where(emp => emp.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).FirstOrDefault();

                                EmployeeShift employeeShift = new EmployeeShift();
                                if (reader["IdEmployeeShift"] != DBNull.Value)
                                    employeeShift.IdEmployeeShift = Convert.ToInt64(reader["IdEmployeeShift"]);

                                employeeShift.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeShift.CompanyShift = new CompanyShift();
                                    employeeShift.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    #region [001] Add Mon -Sun company shift times in sp and method on 17-12-2019
                                    if (reader["MonStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                                    if (reader["MonEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                                    if (reader["MonBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                                    if (reader["TueStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                                    if (reader["TueEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                                    if (reader["TueBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                                    if (reader["WedStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                                    if (reader["WedEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                                    if (reader["WedBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                                    if (reader["ThuStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                                    if (reader["ThuEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];

                                    if (reader["ThuBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                                    if (reader["FriStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                                    if (reader["FriEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                                    if (reader["FriBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                                    if (reader["SatStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                                    if (reader["SatEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                                    if (reader["SatBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                                    if (reader["SunStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                                    if (reader["SunEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                                    if (reader["SunBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];
                                    #endregion

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employeeShift.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);


                                    if (reader["ShiftName"] != DBNull.Value)
                                        employeeShift.CompanyShift.Name = Convert.ToString(reader["ShiftName"]);

                                    if (reader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employeeShift.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeShift.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employeeShift.CompanyShift.CompanySchedule.IdCompanySchedule = employeeShift.CompanyShift.IdCompanySchedule;

                                        if (reader["WorkSchedule"] != DBNull.Value)
                                            employeeShift.CompanyShift.CompanySchedule.Name = Convert.ToString(reader["WorkSchedule"]);

                                        if (reader["IdCompany"] != DBNull.Value)
                                        {
                                            employeeShift.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                            employeeShift.CompanyShift.CompanySchedule.Company = new Company();
                                            employeeShift.CompanyShift.CompanySchedule.Company.IdCompany = employeeShift.CompanyShift.CompanySchedule.IdCompany;
                                            employeeShift.CompanyShift.CompanySchedule.Company.Name = Convert.ToString(reader["CompanyName"]);
                                            employeeShift.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["Alias"]);
                                        }
                                    }

                                }
                                employee.EmployeeShifts.Add(employeeShift);

                            }
                            else
                            {
                                Employee employee = new Employee();

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employee.EmployeeShifts = new List<EmployeeShift>();

                                EmployeeShift employeeShift = new EmployeeShift();

                                if (reader["IdEmployeeShift"] != DBNull.Value)
                                    employeeShift.IdEmployeeShift = Convert.ToInt64(reader["IdEmployeeShift"]);

                                employeeShift.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeShift.CompanyShift = new CompanyShift();
                                    employeeShift.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    #region [001] Add Mon -Sun company shift times in sp and method on 17-12-2019
                                    if (reader["MonStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                                    if (reader["MonEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                                    if (reader["MonBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                                    if (reader["TueStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                                    if (reader["TueEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                                    if (reader["TueBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                                    if (reader["WedStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                                    if (reader["WedEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                                    if (reader["WedBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                                    if (reader["ThuStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                                    if (reader["ThuEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];

                                    if (reader["ThuBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                                    if (reader["FriStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                                    if (reader["FriEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                                    if (reader["FriBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                                    if (reader["SatStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                                    if (reader["SatEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                                    if (reader["SatBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                                    if (reader["SunStartTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                                    if (reader["SunEndTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                                    if (reader["SunBreakTime"] != DBNull.Value)
                                        employeeShift.CompanyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];
                                    #endregion

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employeeShift.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["ShiftName"] != DBNull.Value)
                                        employeeShift.CompanyShift.Name = Convert.ToString(reader["ShiftName"]);

                                    if (reader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employeeShift.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeShift.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employeeShift.CompanyShift.CompanySchedule.IdCompanySchedule = employeeShift.CompanyShift.IdCompanySchedule;

                                        if (reader["WorkSchedule"] != DBNull.Value)
                                            employeeShift.CompanyShift.CompanySchedule.Name = Convert.ToString(reader["WorkSchedule"]);

                                        if (reader["IdCompany"] != DBNull.Value)
                                        {
                                            employeeShift.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                            employeeShift.CompanyShift.CompanySchedule.Company = new Company();
                                            employeeShift.CompanyShift.CompanySchedule.Company.IdCompany = employeeShift.CompanyShift.CompanySchedule.IdCompany;
                                            employeeShift.CompanyShift.CompanySchedule.Company.Name = Convert.ToString(reader["CompanyName"]);
                                            employeeShift.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["Alias"]);
                                        }
                                    }

                                }
                                employee.EmployeeShifts.Add(employeeShift);
                                employees.Add(employee);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeShifts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        /// <summary>
        /// This method is to get final holiday merged with leaves
        /// </summary>
        /// [cpatil][19-12-2019][GEOS2-1941]GRHM - Calculation of holidays
        /// <param name="workbenchConnectionString">Get workbench connection string</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>Get holidays timespan</returns>
        public List<LeavedHoursDetail> GetAllEmpLeavesByIdEmployee_V2038(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod, string idCompany)
        {
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetail = new List<EmployeeDaywiseLeaveDetail>();
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetailIgnore = new List<EmployeeDaywiseLeaveDetail>();
            List<HolidayDaywiseDetail> LstHolidayDaywiseDetail = new List<HolidayDaywiseDetail>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();
            Employee employee = null;
            CrmManager crmmanager = new CrmManager();
            GeosAppSetting Setting = crmmanager.GetGeosAppSettings(11, workbenchConnectionString);
            string[] employeeWorkingDays = null;
            TimeSpan dailyHoursInTimeSpan = new TimeSpan();

            employee = new Employee();
            employee = GetCompanyAnnualScheduleByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod);
            if (employee != null)
                if (employee.CompanyShift != null)
                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        employeeWorkingDays = employee.CompanyShift.CompanyAnnualSchedule.WorkingDays.Split(',');
                        dailyHoursInTimeSpan = TimeSpan.FromHours((float)employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                    }


            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmpLeavesByIdEmployee_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdLeave"] != DBNull.Value)
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmpLeavesByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            List<CompanyHoliday> comhol = GetCompanyHolidaysBySelectedIdCompany(workbenchConnectionString, idCompany, selectedPeriod);
            List<EmployeeLeave> leaves = new List<EmployeeLeave>();
            List<EmployeeLeave> leavesIgnore = new List<EmployeeLeave>();
            List<string> holidays = new List<string>();

            foreach (CompanyHoliday item in comhol)
            {
                if (item.IsAllDayEvent == 1)
                {
                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }

                }
                else
                {
                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }
                }

                for (DateTime hoildayDate = item.StartDate.Value; hoildayDate <= item.EndDate.Value;)
                {
                    if (item.IsAllDayEvent == 1)
                    {
                        LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent });
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                    else
                    {
                        TimeSpan hoildayHours = item.EndDate.Value - item.StartDate.Value;

                        if (hoildayHours >= dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent });
                        else if (hoildayHours < dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = hoildayHours, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent });
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                }

            }



            if (employee != null)
            {
                if (employee.CompanyShift != null)
                {


                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        if (employee.CompanyShift.CompanyAnnualSchedule.CompanySetting.Value == "Working")
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan });
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        }
                                        else
                                        {
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        }
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                            }
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                            }
                                        }
                                        else
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        }


                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }


                            }
                        }
                        else
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                        if (leavedHours >= dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        else if (leavedHours < dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }
                            }
                        }
                    }
                    else
                    {
                        foreach (EmployeeLeave item in employeeLeaves)
                        {
                            for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                            {
                                if (item.IsAllDayEvent == 1)
                                {
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                    leaveDate = leaveDate.AddDays(1);
                                }
                                else
                                {
                                    TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                    if (leavedHours >= dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                    else if (leavedHours < dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                                    leaveDate = leaveDate.AddDays(1);
                                }

                            }
                        }
                    }
                }
                else
                {
                    foreach (EmployeeLeave item in employeeLeaves)
                    {
                        for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                        {
                            if (item.IsAllDayEvent == 1)
                            {
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                leaveDate = leaveDate.AddDays(1);
                            }
                            else
                            {
                                TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                if (leavedHours >= dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                else if (leavedHours < dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                                leaveDate = leaveDate.AddDays(1);
                            }

                        }
                    }
                }
            }
            else
            {
                foreach (EmployeeLeave item in employeeLeaves)
                {
                    for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                    {
                        if (item.IsAllDayEvent == 1)
                        {
                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                            leaveDate = leaveDate.AddDays(1);
                        }
                        else
                        {
                            TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                            if (leavedHours >= dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                            else if (leavedHours < dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                            leaveDate = leaveDate.AddDays(1);
                        }

                    }
                }
            }


            if (LstEmployeeDaywiseLeaveDetailIgnore != null)
            {
                foreach (DateTime LeaveIgnoredDates in LstEmployeeDaywiseLeaveDetailIgnore.Select(hdd => hdd.LeaveDate.Date).ToList())
                {
                    if (LstHolidayDaywiseDetail.Any(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.Date))
                    {
                        LstHolidayDaywiseDetail.Remove(LstHolidayDaywiseDetail.Where(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.Date).FirstOrDefault());
                    }
                }
            }
            List<DateTime> HolidayDates = new List<DateTime>();
            HolidayDates = LstHolidayDaywiseDetail.Select(hdd => hdd.HolidayDate.Date).ToList();

            if (LstEmployeeDaywiseLeaveDetail.Any(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)))
            {

                List<EmployeeDaywiseLeaveDetail> employeeDaywiseLeaveDetails = LstEmployeeDaywiseLeaveDetail.Where(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)).ToList();

                foreach (EmployeeDaywiseLeaveDetail itemEmployeeDaywiseLeaveDetail in employeeDaywiseLeaveDetails)
                {
                    HolidayDaywiseDetail holidayDaywiseDetail = LstHolidayDaywiseDetail.Where(hdd => hdd.HolidayDate == itemEmployeeDaywiseLeaveDetail.LeaveDate).FirstOrDefault();
                    TimeSpan holidayHours = holidayDaywiseDetail.HolidayHours;
                    if (holidayDaywiseDetail.IsAllDayEvent == 1)
                    {
                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                    }
                    else
                    {
                        if (itemEmployeeDaywiseLeaveDetail.IsAllDayEvent == 1)
                        {
                            if (itemEmployeeDaywiseLeaveDetail.LeavedHours >= holidayHours)
                            {
                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = holidayHours });
                            }
                            else
                            {
                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                            }

                        }
                        else
                        {
                            if (checkexisttimespanfullbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });

                            }
                            else if (checkexisttimespanhalfStartbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                TimeSpan ignored = itemEmployeeDaywiseLeaveDetail.EndTime - holidayDaywiseDetail.StartTime;
                                if (ignored > new TimeSpan(0, 0, 0, 0))
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                }

                            }
                            else if (checkexisttimespanhalfEndbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {

                                TimeSpan ignored = holidayDaywiseDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                if (ignored > new TimeSpan(0, 0, 0, 0))
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                }
                            }
                            else if (checkexisttimespanhalfbothbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                TimeSpan ignored = holidayDaywiseDetail.EndTime - holidayDaywiseDetail.StartTime;
                                if (ignored > new TimeSpan(0, 0, 0, 0))
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                }
                            }


                        }
                    }
                }



            }

            foreach (var item in LstEmployeeDaywiseLeaveDetailIgnore.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));

                LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, IgnoredHours = ts, EnjoyedHours = new TimeSpan(0, 0, 0) });
            }

            foreach (var item in LstEmployeeDaywiseLeaveDetail.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));
                if (LstLeavedHoursDetail.Any(lhd => lhd.IdLeave == item.Key))
                {
                    LeavedHoursDetail lhd = LstLeavedHoursDetail.Where(lhdd => lhdd.IdLeave == item.Key).FirstOrDefault();
                    lhd.EnjoyedHours = ts;

                }
                else
                {
                    LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, EnjoyedHours = ts, IgnoredHours = new TimeSpan(0, 0, 0) });
                }

            }

            return LstLeavedHoursDetail;
        }

        public List<LeavedHoursDetail> GetAllEmpLeavesByIdEmployee_V2050(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod, string idCompany)
        {
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetail = new List<EmployeeDaywiseLeaveDetail>();
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetailIgnore = new List<EmployeeDaywiseLeaveDetail>();
            List<HolidayDaywiseDetail> LstHolidayDaywiseDetail = new List<HolidayDaywiseDetail>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();
            Employee employee = null;
            CrmManager crmmanager = new CrmManager();
            GeosAppSetting Setting = crmmanager.GetGeosAppSettings(11, workbenchConnectionString);
            string[] employeeWorkingDays = null;
            TimeSpan dailyHoursInTimeSpan = new TimeSpan();

            employee = new Employee();
            employee = GetCompanyAnnualScheduleByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod);
            if (employee != null)
                if (employee.CompanyShift != null)
                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        employeeWorkingDays = employee.CompanyShift.CompanyAnnualSchedule.WorkingDays.Split(',');
                        dailyHoursInTimeSpan = TimeSpan.FromHours((float)employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                    }


            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();
            List<Int32> empContractidsCompany = new List<int>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmpLeavesByIdEmployee_V2050", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                   
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdLeave"] != DBNull.Value)
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                            if (reader["IdCompany"] != DBNull.Value)
                            {
                                employeeLeave.IdEmpContractCompany = Convert.ToInt32(reader["IdCompany"]);
                                if(!empContractidsCompany.Any(ic=>ic== employeeLeave.IdEmpContractCompany))
                                {
                                    empContractidsCompany.Add(employeeLeave.IdEmpContractCompany);
                                }
                            }

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmpLeavesByIdEmployee(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            string empContractidsCompanyStr=null;
            if (empContractidsCompany != null && empContractidsCompany.Count()>0)
            {
                empContractidsCompanyStr = String.Join(",", empContractidsCompany.Select(i=>i.ToString()).ToList());

            }
            List<CompanyHoliday> comhol = GetCompanyHolidaysBySelectedIdCompany(workbenchConnectionString, empContractidsCompanyStr, selectedPeriod);
            List<EmployeeLeave> leaves = new List<EmployeeLeave>();
            List<EmployeeLeave> leavesIgnore = new List<EmployeeLeave>();
            List<string> holidays = new List<string>();

            foreach (CompanyHoliday item in comhol)
            {
                if (item.IsAllDayEvent == 1)
                {
                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }

                }
                else
                {
                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }
                }

                for (DateTime hoildayDate = item.StartDate.Value; hoildayDate <= item.EndDate.Value;)
                {
                    if (item.IsAllDayEvent == 1)
                    {
                        LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent , IdCompany=item.IdCompany});
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                    else
                    {
                        TimeSpan hoildayHours = item.EndDate.Value - item.StartDate.Value;

                        if (hoildayHours >= dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent, IdCompany = item.IdCompany });
                        else if (hoildayHours < dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = hoildayHours, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent, IdCompany = item.IdCompany });
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                }

            }



            if (employee != null)
            {
                if (employee.CompanyShift != null)
                {


                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        if (employee.CompanyShift.CompanyAnnualSchedule.CompanySetting.Value == "Working")
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, IdEmpContractCompany= item.IdEmpContractCompany });
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        }
                                        else
                                        {
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        }
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, IdEmpContractCompany = item.IdEmpContractCompany });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                            }
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, IdEmpContractCompany = item.IdEmpContractCompany });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                            }
                                        }
                                        else
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        }


                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }


                            }
                        }
                        else
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                        if (leavedHours >= dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        else if (leavedHours < dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }
                            }
                        }
                    }
                    else
                    {
                        foreach (EmployeeLeave item in employeeLeaves)
                        {
                            for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                            {
                                if (item.IsAllDayEvent == 1)
                                {
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                    leaveDate = leaveDate.AddDays(1);
                                }
                                else
                                {
                                    TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                    if (leavedHours >= dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                    else if (leavedHours < dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                                    leaveDate = leaveDate.AddDays(1);
                                }

                            }
                        }
                    }
                }
                else
                {
                    foreach (EmployeeLeave item in employeeLeaves)
                    {
                        for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                        {
                            if (item.IsAllDayEvent == 1)
                            {
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                leaveDate = leaveDate.AddDays(1);
                            }
                            else
                            {
                                TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                if (leavedHours >= dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                else if (leavedHours < dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                                leaveDate = leaveDate.AddDays(1);
                            }

                        }
                    }
                }
            }
            else
            {
                foreach (EmployeeLeave item in employeeLeaves)
                {
                    for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                    {
                        if (item.IsAllDayEvent == 1)
                        {
                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                            leaveDate = leaveDate.AddDays(1);
                        }
                        else
                        {
                            TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                            if (leavedHours >= dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                            else if (leavedHours < dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                            leaveDate = leaveDate.AddDays(1);
                        }

                    }
                }
            }


            if (LstEmployeeDaywiseLeaveDetailIgnore != null)
            {
                foreach (EmployeeDaywiseLeaveDetail LeaveIgnoredDates in LstEmployeeDaywiseLeaveDetailIgnore.ToList())
                {
                    if (LstHolidayDaywiseDetail.Any(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.LeaveDate.Date && lhdd.IdCompany== LeaveIgnoredDates.IdEmpContractCompany))
                    {
                        LstHolidayDaywiseDetail.Remove(LstHolidayDaywiseDetail.Where(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.LeaveDate.Date && lhdd.IdCompany== LeaveIgnoredDates.IdEmpContractCompany).FirstOrDefault());
                    }
                }
            }
            List<DateTime> HolidayDates = new List<DateTime>();
            HolidayDates = LstHolidayDaywiseDetail.Select(hdd => hdd.HolidayDate.Date).ToList();

            if (LstEmployeeDaywiseLeaveDetail.Any(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)))
            {

                List<EmployeeDaywiseLeaveDetail> employeeDaywiseLeaveDetails = LstEmployeeDaywiseLeaveDetail.Where(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)).ToList();

                foreach (EmployeeDaywiseLeaveDetail itemEmployeeDaywiseLeaveDetail in employeeDaywiseLeaveDetails)
                {
                    HolidayDaywiseDetail holidayDaywiseDetail = LstHolidayDaywiseDetail.Where(hdd => hdd.HolidayDate == itemEmployeeDaywiseLeaveDetail.LeaveDate).FirstOrDefault();
                    TimeSpan holidayHours = holidayDaywiseDetail.HolidayHours;
                    if (holidayDaywiseDetail.IsAllDayEvent == 1)
                    {
                        if(holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                    }
                    else
                    {
                        if (itemEmployeeDaywiseLeaveDetail.IsAllDayEvent == 1)
                        {
                            if (itemEmployeeDaywiseLeaveDetail.LeavedHours >= holidayHours)
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = holidayHours });
                            }
                            else
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                            }

                        }
                        else
                        {
                            if (checkexisttimespanfullbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                                }

                            }
                            else if (checkexisttimespanhalfStartbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    TimeSpan ignored = itemEmployeeDaywiseLeaveDetail.EndTime - holidayDaywiseDetail.StartTime;
                                    if (ignored > new TimeSpan(0, 0, 0, 0))
                                    {
                                        itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                    }
                                }

                            }
                            else if (checkexisttimespanhalfEndbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    TimeSpan ignored = holidayDaywiseDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    if (ignored > new TimeSpan(0, 0, 0, 0))
                                    {
                                        itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });

                                    }
                                }
                            }
                            else if (checkexisttimespanhalfbothbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    TimeSpan ignored = holidayDaywiseDetail.EndTime - holidayDaywiseDetail.StartTime;
                                    if (ignored > new TimeSpan(0, 0, 0, 0))
                                    {
                                        itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                    }
                                }
                            }


                        }
                    }
                }



            }

            foreach (var item in LstEmployeeDaywiseLeaveDetailIgnore.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));

                LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, IgnoredHours = ts, EnjoyedHours = new TimeSpan(0, 0, 0) });
            }

            foreach (var item in LstEmployeeDaywiseLeaveDetail.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));
                if (LstLeavedHoursDetail.Any(lhd => lhd.IdLeave == item.Key))
                {
                    LeavedHoursDetail lhd = LstLeavedHoursDetail.Where(lhdd => lhdd.IdLeave == item.Key).FirstOrDefault();
                    lhd.EnjoyedHours = ts;

                }
                else
                {
                    LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, EnjoyedHours = ts, IgnoredHours = new TimeSpan(0, 0, 0) });
                }

            }

            return LstLeavedHoursDetail;
        }

        /// <summary>
        /// This method is to get employee details
        /// </summary>
        /// [cpatil][19-12-2019][GEOS2-1941]GRHM - Calculation of holidays
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="exitDocumentFilePath">Get exit document file path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>Get employee Details</returns>
        public Employee GetEmployeeByIdEmployee_V2038(string workbenchConnectionString, Int32 idEmployee, string exitDocumentFilePath, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                //  employee.EmployeeShifts = GetEmployeeShifts_V2034(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee_V2035(workbenchConnectionString, idEmployee);

                employee.EmployeeExitEvents = GetEmployeeExitEventsByIdEmployee_V2036(workbenchConnectionString, idEmployee, employee.EmployeeCode, exitDocumentFilePath);
                employee.EmployeeShifts = GetEmployeeShiftsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeShifts != null)
                {
                    if (employee.EmployeeShifts.Count > 0)
                        employee.EmployeeShifts.RemoveAt(0);
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2038(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }


        /// <summary>
        /// This method is to get employee details
        /// </summary>
        /// [adhatkar][08-05-2020]
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="exitDocumentFilePath">Get exit document file path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>Get employee Details</returns>
        public Employee GetEmployeeByIdEmployee_V2042(string workbenchConnectionString, Int32 idEmployee, string exitDocumentFilePath, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2031", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee_V2042(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                //  employee.EmployeeShifts = GetEmployeeShifts_V2034(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee_V2035(workbenchConnectionString, idEmployee);

                employee.EmployeeExitEvents = GetEmployeeExitEventsByIdEmployee_V2036(workbenchConnectionString, idEmployee, employee.EmployeeCode, exitDocumentFilePath);
                employee.EmployeeShifts = GetEmployeeShiftsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeShifts != null)
                {
                    if (employee.EmployeeShifts.Count > 0)
                        employee.EmployeeShifts.RemoveAt(0);
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2042(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }

        /// <summary>
        /// This method is to get employee leave details
        /// </summary>
        /// [cpatil][19-12-2019][GEOS2-1941]GRHM - Calculation of holidays
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="idEmployee">Get id Employee</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get id company</param>
        /// <returns>Get employee annual leave details</returns>
        public List<EmployeeAnnualLeave> GetEmployeeLeaveByIdEmployee_V2038(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod, string idCompany)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();

            if (idCompany != null)
                LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesByIdEmployee_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAnnualLeave.Employee = new Employee();
                                    employeeAnnualLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeAnnualLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAnnualLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAnnualLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAnnualLeave.Employee.CompanyShift = new CompanyShift();
                                        employeeAnnualLeave.Employee.CompanyShift.IdCompanyShift = employeeAnnualLeave.Employee.IdCompanyShift;

                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                        {
                                            employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule;

                                            if (reader["ScheduleYear"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["ScheduleYear"]);

                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);

                                            if (reader["WorkingDays"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        }
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave = new CompanyLeave();
                                    employeeAnnualLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave.Name = reader["Name"].ToString();
                                    employeeAnnualLeave.CompanyLeave.HtmlColor = reader["HtmlColor"].ToString();
                                    if (reader["Position"] != DBNull.Value)
                                        employeeAnnualLeave.CompanyLeave.Position = Convert.ToUInt64(reader["Position"]);
                                }

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeave.TotalHoursCount = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;
                                employeeAnnualLeaves.Add(employeeAnnualLeave);

                            }
                        }

                    }
                }

                foreach (EmployeeAnnualLeave itemEmployeeAnnualLeave in employeeAnnualLeaves)
                {
                    LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == itemEmployeeAnnualLeave.IdLeave);
                    if (leavedHoursDetail != null)
                    {
                        itemEmployeeAnnualLeave.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                        itemEmployeeAnnualLeave.Remaining = (itemEmployeeAnnualLeave.RegularHoursCount + itemEmployeeAnnualLeave.AdditionalHoursCount) - itemEmployeeAnnualLeave.Enjoyed;
                    }
                    else
                    {
                        itemEmployeeAnnualLeave.Enjoyed = 0;
                        itemEmployeeAnnualLeave.Remaining = (itemEmployeeAnnualLeave.RegularHoursCount + itemEmployeeAnnualLeave.AdditionalHoursCount) - itemEmployeeAnnualLeave.Enjoyed;
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveByIdEmployee_V2038(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeaves;
        }

        public List<EmployeeAnnualLeave> GetEmployeeLeaveByIdEmployee_V2050(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod, string idCompany)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();

            if (idCompany != null)
                LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployee_V2050(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesByIdEmployee_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAnnualLeave.Employee = new Employee();
                                    employeeAnnualLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeAnnualLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAnnualLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAnnualLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAnnualLeave.Employee.CompanyShift = new CompanyShift();
                                        employeeAnnualLeave.Employee.CompanyShift.IdCompanyShift = employeeAnnualLeave.Employee.IdCompanyShift;

                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                        {
                                            employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule;

                                            if (reader["ScheduleYear"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["ScheduleYear"]);

                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);

                                            if (reader["WorkingDays"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        }
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave = new CompanyLeave();
                                    employeeAnnualLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave.Name = reader["Name"].ToString();
                                    employeeAnnualLeave.CompanyLeave.HtmlColor = reader["HtmlColor"].ToString();
                                    if (reader["Position"] != DBNull.Value)
                                        employeeAnnualLeave.CompanyLeave.Position = Convert.ToUInt64(reader["Position"]);
                                }

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeave.TotalHoursCount = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;
                                employeeAnnualLeaves.Add(employeeAnnualLeave);

                            }
                        }

                    }
                }

                foreach (EmployeeAnnualLeave itemEmployeeAnnualLeave in employeeAnnualLeaves)
                {
                    LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == itemEmployeeAnnualLeave.IdLeave);
                    if (leavedHoursDetail != null)
                    {
                        itemEmployeeAnnualLeave.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                        itemEmployeeAnnualLeave.Remaining = (itemEmployeeAnnualLeave.RegularHoursCount + itemEmployeeAnnualLeave.AdditionalHoursCount) - itemEmployeeAnnualLeave.Enjoyed;
                    }
                    else
                    {
                        itemEmployeeAnnualLeave.Enjoyed = 0;
                        itemEmployeeAnnualLeave.Remaining = (itemEmployeeAnnualLeave.RegularHoursCount + itemEmployeeAnnualLeave.AdditionalHoursCount) - itemEmployeeAnnualLeave.Enjoyed;
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveByIdEmployee_V2038(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeaves;
        }


        public Employee GetCompanyAnnualScheduleByIdEmployee_V2038(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod)
        {
            Employee employee = new Employee();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetCompanyAnnualScheduleByIdEmployee_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        if (reader.Read())
                        {

                            if (reader["IdEmployee"] != DBNull.Value)
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);


                                if (reader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    if (reader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanyAnnualSchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.CompanySetting = new CompanySetting();
                                        if (reader["CompanySetting"] != DBNull.Value)
                                        {
                                            employee.CompanyShift.CompanyAnnualSchedule.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCompanyAnnualScheduleByIdEmployee_V2038(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return employee;
        }



        public bool IsEmployeeEnjoyedAllAnnualLeaves_V2038(string workbenchConnectionString, Int32 idEmployee, Int32 idEmployeeLeave, long selectedPeriod, Int32 idCompany)
        {
            EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();
            LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployeeAndIdLeave_V2038(workbenchConnectionString, idEmployee, selectedPeriod, idCompany.ToString(), idEmployeeLeave);
            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEnjoyedLeaveHours_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idEmployeeLeave);
                    decimal Total = 0;
                    decimal Enjoyed = 0;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["Total"] != DBNull.Value)
                                    Total = Total + Convert.ToDecimal(reader["Total"]);
                            }
                        }

                    }

                    LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == idEmployeeLeave);
                    if (leavedHoursDetail != null)
                    {
                        employeeAnnualLeave.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                        employeeAnnualLeave.Remaining = Total - employeeAnnualLeave.Enjoyed;
                    }
                    else
                    {
                        employeeAnnualLeave.Enjoyed = 0;
                        employeeAnnualLeave.Remaining = Total - employeeAnnualLeave.Enjoyed;
                    }


                    if (employeeAnnualLeave.Enjoyed > Total)
                    {
                        return true;
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsEmployeeEnjoyedAllAnnualLeaves_V2038(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return false;
        }


        public bool IsEmployeeEnjoyedAllAnnualLeaves_V2050(string workbenchConnectionString, Int32 idEmployee, Int32 idEmployeeLeave, long selectedPeriod, Int32 idCompany)
        {
            EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();
            LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployeeAndIdLeave_V2038(workbenchConnectionString, idEmployee, selectedPeriod, idCompany.ToString(), idEmployeeLeave);
            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEnjoyedLeaveHours_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idEmployeeLeave);
                    decimal Total = 0;
                    decimal Enjoyed = 0;
                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["Total"] != DBNull.Value)
                                    Total = Total + Convert.ToDecimal(reader["Total"]);
                            }
                        }

                    }

                    LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == idEmployeeLeave);
                    if (leavedHoursDetail != null)
                    {
                        employeeAnnualLeave.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                        employeeAnnualLeave.Remaining = Total - employeeAnnualLeave.Enjoyed;
                    }
                    else
                    {
                        employeeAnnualLeave.Enjoyed = 0;
                        employeeAnnualLeave.Remaining = Total - employeeAnnualLeave.Enjoyed;
                    }


                    if (employeeAnnualLeave.Enjoyed > Total)
                    {
                        return true;
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error IsEmployeeEnjoyedAllAnnualLeaves_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return false;
        }


        public List<LeavedHoursDetail> GetAllEmpLeavesByIdEmployeeAndIdLeave_V2038(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod, string idCompany, Int32 idLeave)
        {
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetail = new List<EmployeeDaywiseLeaveDetail>();
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetailIgnore = new List<EmployeeDaywiseLeaveDetail>();
            List<HolidayDaywiseDetail> LstHolidayDaywiseDetail = new List<HolidayDaywiseDetail>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();
            Employee employee = null;
            CrmManager crmmanager = new CrmManager();
            GeosAppSetting Setting = crmmanager.GetGeosAppSettings(11, workbenchConnectionString);
            string[] employeeWorkingDays = null;
            TimeSpan dailyHoursInTimeSpan = new TimeSpan();

            employee = new Employee();
            employee = GetCompanyAnnualScheduleByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod);
            if (employee != null)
                if (employee.CompanyShift != null)
                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        employeeWorkingDays = employee.CompanyShift.CompanyAnnualSchedule.WorkingDays.Split(',');

                        dailyHoursInTimeSpan = TimeSpan.FromHours((float)employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                    }

            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmpLeavesByIdEmployeeAndIdLeave_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idLeave);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdLeave"] != DBNull.Value)
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmpLeavesByIdEmployeeAndIdLeave_V2038(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            List<CompanyHoliday> comhol = GetCompanyHolidaysBySelectedIdCompany(workbenchConnectionString, idCompany, selectedPeriod);


            foreach (CompanyHoliday item in comhol)
            {
                if (item.IsAllDayEvent == 1)
                {
                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }

                }
                else
                {

                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }
                }

                for (DateTime hoildayDate = item.StartDate.Value; hoildayDate <= item.EndDate.Value;)
                {
                    if (item.IsAllDayEvent == 1)
                    {
                        LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent });
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                    else
                    {
                        TimeSpan hoildayHours = item.EndDate.Value - item.StartDate.Value;

                        if (hoildayHours >= dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent });
                        else if (hoildayHours < dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = hoildayHours, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent });
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                }

            }



            if (employee != null)
            {
                if (employee.CompanyShift != null)
                {


                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        if (employee.CompanyShift.CompanyAnnualSchedule.CompanySetting.Value == "Working")
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan });
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        }
                                        else
                                        {
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        }
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                            }
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                            }
                                        }
                                        else
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        }


                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }


                            }
                        }
                        else
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                        if (leavedHours >= dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                        else if (leavedHours < dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }
                            }
                        }
                    }
                    else
                    {
                        foreach (EmployeeLeave item in employeeLeaves)
                        {
                            for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                            {
                                if (item.IsAllDayEvent == 1)
                                {
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                    leaveDate = leaveDate.AddDays(1);
                                }
                                else
                                {
                                    TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                    if (leavedHours >= dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                    else if (leavedHours < dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                                    leaveDate = leaveDate.AddDays(1);
                                }

                            }
                        }
                    }
                }
                else
                {
                    foreach (EmployeeLeave item in employeeLeaves)
                    {
                        for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                        {
                            if (item.IsAllDayEvent == 1)
                            {
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                leaveDate = leaveDate.AddDays(1);
                            }
                            else
                            {
                                TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                if (leavedHours >= dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                                else if (leavedHours < dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                                leaveDate = leaveDate.AddDays(1);
                            }

                        }
                    }
                }
            }
            else
            {
                foreach (EmployeeLeave item in employeeLeaves)
                {
                    for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                    {
                        if (item.IsAllDayEvent == 1)
                        {
                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                            leaveDate = leaveDate.AddDays(1);
                        }
                        else
                        {
                            TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                            if (leavedHours >= dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });
                            else if (leavedHours < dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent });

                            leaveDate = leaveDate.AddDays(1);
                        }

                    }
                }
            }

            if (LstEmployeeDaywiseLeaveDetailIgnore != null)
            {
                foreach (DateTime LeaveIgnoredDates in LstEmployeeDaywiseLeaveDetailIgnore.Select(hdd => hdd.LeaveDate.Date).ToList())
                {
                    if (LstHolidayDaywiseDetail.Any(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.Date))
                    {
                        LstHolidayDaywiseDetail.Remove(LstHolidayDaywiseDetail.Where(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.Date).FirstOrDefault());
                    }
                }
            }
            List<DateTime> HolidayDates = new List<DateTime>();
            HolidayDates = LstHolidayDaywiseDetail.Select(hdd => hdd.HolidayDate.Date).ToList();

            if (LstEmployeeDaywiseLeaveDetail.Any(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)))
            {
                List<EmployeeDaywiseLeaveDetail> employeeDaywiseLeaveDetails = LstEmployeeDaywiseLeaveDetail.Where(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)).ToList();

                foreach (EmployeeDaywiseLeaveDetail itemEmployeeDaywiseLeaveDetail in employeeDaywiseLeaveDetails)
                {
                    HolidayDaywiseDetail holidayDaywiseDetail = LstHolidayDaywiseDetail.Where(hdd => hdd.HolidayDate == itemEmployeeDaywiseLeaveDetail.LeaveDate).FirstOrDefault();
                    TimeSpan holidayHours = holidayDaywiseDetail.HolidayHours;
                    if (holidayDaywiseDetail.IsAllDayEvent == 1)
                    {
                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                    }
                    else
                    {
                        if (itemEmployeeDaywiseLeaveDetail.IsAllDayEvent == 1)
                        {
                            if (itemEmployeeDaywiseLeaveDetail.LeavedHours >= holidayHours)
                            {
                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = holidayHours });
                            }
                            else
                            {
                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                            }

                        }
                        else
                        {
                            if (checkexisttimespanfullbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });

                            }
                            else if (checkexisttimespanhalfStartbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                TimeSpan ignored = itemEmployeeDaywiseLeaveDetail.EndTime - holidayDaywiseDetail.StartTime;
                                if (ignored > new TimeSpan(0, 0, 0, 0))
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                }

                            }
                            else if (checkexisttimespanhalfEndbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {

                                TimeSpan ignored = holidayDaywiseDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                if (ignored > new TimeSpan(0, 0, 0, 0))
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                }
                            }
                            else if (checkexisttimespanhalfbothbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                TimeSpan ignored = holidayDaywiseDetail.EndTime - holidayDaywiseDetail.StartTime;
                                if (ignored > new TimeSpan(0, 0, 0, 0))
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                }
                            }


                        }
                    }

                }
            }

            foreach (var item in LstEmployeeDaywiseLeaveDetailIgnore.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));

                LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, IgnoredHours = ts, EnjoyedHours = new TimeSpan(0, 0, 0) });
            }

            foreach (var item in LstEmployeeDaywiseLeaveDetail.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));
                if (LstLeavedHoursDetail.Any(lhd => lhd.IdLeave == item.Key))
                {
                    LeavedHoursDetail lhd = LstLeavedHoursDetail.Where(lhdd => lhdd.IdLeave == item.Key).FirstOrDefault();
                    lhd.EnjoyedHours = ts;

                }
                else
                {
                    LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, EnjoyedHours = ts, IgnoredHours = new TimeSpan(0, 0, 0) });
                }

            }

            return LstLeavedHoursDetail;
        }


        public List<LeavedHoursDetail> GetAllEmpLeavesByIdEmployeeAndIdLeave_V2050(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod, string idCompany, Int32 idLeave)
        {
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetail = new List<EmployeeDaywiseLeaveDetail>();
            List<EmployeeDaywiseLeaveDetail> LstEmployeeDaywiseLeaveDetailIgnore = new List<EmployeeDaywiseLeaveDetail>();
            List<HolidayDaywiseDetail> LstHolidayDaywiseDetail = new List<HolidayDaywiseDetail>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();
            Employee employee = null;
            CrmManager crmmanager = new CrmManager();
            GeosAppSetting Setting = crmmanager.GetGeosAppSettings(11, workbenchConnectionString);
            string[] employeeWorkingDays = null;
            TimeSpan dailyHoursInTimeSpan = new TimeSpan();

            employee = new Employee();
            employee = GetCompanyAnnualScheduleByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod);
            if (employee != null)
                if (employee.CompanyShift != null)
                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        employeeWorkingDays = employee.CompanyShift.CompanyAnnualSchedule.WorkingDays.Split(',');

                        dailyHoursInTimeSpan = TimeSpan.FromHours((float)employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                    }

            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmpLeavesByIdEmployeeAndIdLeave_V2050", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idLeave);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdLeave"] != DBNull.Value)
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);


                            if (reader["IdCompany"] != DBNull.Value)
                                employeeLeave.IdEmpContractCompany = Convert.ToInt32(reader["IdCompany"]);


                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmpLeavesByIdEmployeeAndIdLeave_V2038(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            List<CompanyHoliday> comhol = GetCompanyHolidaysBySelectedIdCompany(workbenchConnectionString, idCompany, selectedPeriod);


            foreach (CompanyHoliday item in comhol)
            {
                if (item.IsAllDayEvent == 1)
                {
                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }

                }
                else
                {

                    if (item.IsRecursive == 1)
                    {
                        item.StartDate = new DateTime(Convert.ToInt32(selectedPeriod), item.StartDate.Value.Month, item.StartDate.Value.Day, item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second);
                        item.EndDate = new DateTime(Convert.ToInt32(selectedPeriod), item.EndDate.Value.Month, item.EndDate.Value.Day, item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second);
                    }
                }

                for (DateTime hoildayDate = item.StartDate.Value; hoildayDate <= item.EndDate.Value;)
                {
                    if (item.IsAllDayEvent == 1)
                    {
                        LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent, IdCompany=item.IdCompany });
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                    else
                    {
                        TimeSpan hoildayHours = item.EndDate.Value - item.StartDate.Value;

                        if (hoildayHours >= dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = dailyHoursInTimeSpan, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent, IdCompany = item.IdCompany });
                        else if (hoildayHours < dailyHoursInTimeSpan)
                            LstHolidayDaywiseDetail.Add(new HolidayDaywiseDetail() { HolidayDate = hoildayDate.Date, HolidayHours = hoildayHours, StartTime = item.StartTime.Value, EndTime = item.EndTime.Value, IsAllDayEvent = item.IsAllDayEvent, IdCompany = item.IdCompany });
                        hoildayDate = hoildayDate.AddDays(1);
                    }
                }

            }



            if (employee != null)
            {
                if (employee.CompanyShift != null)
                {


                    if (employee.CompanyShift.CompanyAnnualSchedule != null)
                    {
                        if (employee.CompanyShift.CompanyAnnualSchedule.CompanySetting.Value == "Working")
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, IdEmpContractCompany=item.IdEmpContractCompany });
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        }
                                        else
                                        {
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        }
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;
                                        if (!employeeWorkingDays.Any(x => x.Contains(leaveDate.DayOfWeek.ToString().Substring(0, 3))))
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, IdEmpContractCompany = item.IdEmpContractCompany });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                            }
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                            {
                                                LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours });
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                            }
                                        }
                                        else
                                        {
                                            if (leavedHours >= dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                            else if (leavedHours < dailyHoursInTimeSpan)
                                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        }


                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }


                            }
                        }
                        else
                        {
                            foreach (EmployeeLeave item in employeeLeaves)
                            {
                                for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                                {
                                    if (item.IsAllDayEvent == 1)
                                    {
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        leaveDate = leaveDate.AddDays(1);
                                    }
                                    else
                                    {
                                        TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                        if (leavedHours >= dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                        else if (leavedHours < dailyHoursInTimeSpan)
                                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                                        leaveDate = leaveDate.AddDays(1);
                                    }

                                }
                            }
                        }
                    }
                    else
                    {
                        foreach (EmployeeLeave item in employeeLeaves)
                        {
                            for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                            {
                                if (item.IsAllDayEvent == 1)
                                {
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                    leaveDate = leaveDate.AddDays(1);
                                }
                                else
                                {
                                    TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                    if (leavedHours >= dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                    else if (leavedHours < dailyHoursInTimeSpan)
                                        LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                                    leaveDate = leaveDate.AddDays(1);
                                }

                            }
                        }
                    }
                }
                else
                {
                    foreach (EmployeeLeave item in employeeLeaves)
                    {
                        for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                        {
                            if (item.IsAllDayEvent == 1)
                            {
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                leaveDate = leaveDate.AddDays(1);
                            }
                            else
                            {
                                TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                                if (leavedHours >= dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                                else if (leavedHours < dailyHoursInTimeSpan)
                                    LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                                leaveDate = leaveDate.AddDays(1);
                            }

                        }
                    }
                }
            }
            else
            {
                foreach (EmployeeLeave item in employeeLeaves)
                {
                    for (DateTime leaveDate = item.StartDate.Value; leaveDate <= item.EndDate.Value;)
                    {
                        if (item.IsAllDayEvent == 1)
                        {
                            LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                            leaveDate = leaveDate.AddDays(1);
                        }
                        else
                        {
                            TimeSpan leavedHours = item.EndDate.Value - item.StartDate.Value;

                            if (leavedHours >= dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = dailyHoursInTimeSpan, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });
                            else if (leavedHours < dailyHoursInTimeSpan)
                                LstEmployeeDaywiseLeaveDetail.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = item.IdLeave, LeaveDate = leaveDate.Date, LeavedHours = leavedHours, StartTime = new TimeSpan(item.StartDate.Value.Hour, item.StartDate.Value.Minute, item.StartDate.Value.Second), EndTime = new TimeSpan(item.EndDate.Value.Hour, item.EndDate.Value.Minute, item.EndDate.Value.Second), IsAllDayEvent = item.IsAllDayEvent, IdEmpContractCompany = item.IdEmpContractCompany });

                            leaveDate = leaveDate.AddDays(1);
                        }

                    }
                }
            }

            if (LstEmployeeDaywiseLeaveDetailIgnore != null)
            {
                foreach (EmployeeDaywiseLeaveDetail LeaveIgnoredDates in LstEmployeeDaywiseLeaveDetailIgnore.ToList())
                {
                    if (LstHolidayDaywiseDetail.Any(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.LeaveDate.Date && lhdd.IdCompany== LeaveIgnoredDates.IdEmpContractCompany))
                    {
                        LstHolidayDaywiseDetail.Remove(LstHolidayDaywiseDetail.Where(lhdd => lhdd.HolidayDate.Date == LeaveIgnoredDates.LeaveDate.Date && lhdd.IdCompany == LeaveIgnoredDates.IdEmpContractCompany).FirstOrDefault());
                    }
                }
            }
            List<DateTime> HolidayDates = new List<DateTime>();
            HolidayDates = LstHolidayDaywiseDetail.Select(hdd => hdd.HolidayDate.Date).ToList();

            if (LstEmployeeDaywiseLeaveDetail.Any(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)))
            {
                List<EmployeeDaywiseLeaveDetail> employeeDaywiseLeaveDetails = LstEmployeeDaywiseLeaveDetail.Where(ledld => HolidayDates.Contains(ledld.LeaveDate.Date)).ToList();

                foreach (EmployeeDaywiseLeaveDetail itemEmployeeDaywiseLeaveDetail in employeeDaywiseLeaveDetails)
                {
                    HolidayDaywiseDetail holidayDaywiseDetail = LstHolidayDaywiseDetail.Where(hdd => hdd.HolidayDate == itemEmployeeDaywiseLeaveDetail.LeaveDate).FirstOrDefault();
                    TimeSpan holidayHours = holidayDaywiseDetail.HolidayHours;
                    if (holidayDaywiseDetail.IsAllDayEvent == 1)
                    {
                        if(holidayDaywiseDetail.IdCompany== itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                    }
                    else
                    {
                        if (itemEmployeeDaywiseLeaveDetail.IsAllDayEvent == 1)
                        {
                            if (itemEmployeeDaywiseLeaveDetail.LeavedHours >= holidayHours)
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = holidayHours });
                            }
                            else
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                            }

                        }
                        else
                        {
                            if (checkexisttimespanfullbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = itemEmployeeDaywiseLeaveDetail.LeavedHours });
                                }

                            }
                            else if (checkexisttimespanhalfStartbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    TimeSpan ignored = itemEmployeeDaywiseLeaveDetail.EndTime - holidayDaywiseDetail.StartTime;
                                    if (ignored > new TimeSpan(0, 0, 0, 0))
                                    {
                                        itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                    }
                                }

                            }
                            else if (checkexisttimespanhalfEndbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    TimeSpan ignored = holidayDaywiseDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                    if (ignored > new TimeSpan(0, 0, 0, 0))
                                    {
                                        itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                    }
                                }
                            }
                            else if (checkexisttimespanhalfbothbetweenInHoliday(itemEmployeeDaywiseLeaveDetail.StartTime, itemEmployeeDaywiseLeaveDetail.EndTime, holidayDaywiseDetail.StartTime, holidayDaywiseDetail.EndTime))
                            {
                                if (holidayDaywiseDetail.IdCompany == itemEmployeeDaywiseLeaveDetail.IdEmpContractCompany)
                                {
                                    TimeSpan ignored = holidayDaywiseDetail.EndTime - holidayDaywiseDetail.StartTime;
                                    if (ignored > new TimeSpan(0, 0, 0, 0))
                                    {
                                        itemEmployeeDaywiseLeaveDetail.LeavedHours = itemEmployeeDaywiseLeaveDetail.EndTime - itemEmployeeDaywiseLeaveDetail.StartTime;
                                        LstEmployeeDaywiseLeaveDetailIgnore.Add(new EmployeeDaywiseLeaveDetail() { IdLeave = itemEmployeeDaywiseLeaveDetail.IdLeave, LeaveDate = itemEmployeeDaywiseLeaveDetail.LeaveDate.Date, LeavedHours = ignored });
                                    }
                                }
                            }


                        }
                    }

                }
            }

            foreach (var item in LstEmployeeDaywiseLeaveDetailIgnore.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));

                LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, IgnoredHours = ts, EnjoyedHours = new TimeSpan(0, 0, 0) });
            }

            foreach (var item in LstEmployeeDaywiseLeaveDetail.GroupBy(edldi => edldi.IdLeave))
            {
                TimeSpan ts = new TimeSpan(item.ToList().Sum(ik => ik.LeavedHours.Ticks));
                if (LstLeavedHoursDetail.Any(lhd => lhd.IdLeave == item.Key))
                {
                    LeavedHoursDetail lhd = LstLeavedHoursDetail.Where(lhdd => lhdd.IdLeave == item.Key).FirstOrDefault();
                    lhd.EnjoyedHours = ts;

                }
                else
                {
                    LstLeavedHoursDetail.Add(new LeavedHoursDetail() { IdLeave = item.Key, EnjoyedHours = ts, IgnoredHours = new TimeSpan(0, 0, 0) });
                }

            }

            return LstLeavedHoursDetail;
        }


        public EmployeeAnnualLeave GetEmployeeEnjoyedLeaveHours_V2038(string workbenchConnectionString, Int32 idEmployee, Int32 idEmployeeLeave, long selectedPeriod, Int32 idCompany = 0)
        {
            EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();

            if (idCompany != 0)
                LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployeeAndIdLeave_V2038(workbenchConnectionString, idEmployee, selectedPeriod, idCompany.ToString(), idEmployeeLeave);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEnjoyedLeaveHours_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idEmployeeLeave);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["Total"] != DBNull.Value)
                                    employeeAnnualLeave.TotalHoursCount = Convert.ToDecimal(reader["Total"]);
                            }
                        }

                    }
                }

                LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == idEmployeeLeave);
                if (leavedHoursDetail != null)
                {
                    employeeAnnualLeave.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                    employeeAnnualLeave.Remaining = employeeAnnualLeave.TotalHoursCount - employeeAnnualLeave.Enjoyed;
                }
                else
                {
                    employeeAnnualLeave.Enjoyed = 0;
                    employeeAnnualLeave.Remaining = employeeAnnualLeave.TotalHoursCount - employeeAnnualLeave.Enjoyed;
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEnjoyedLeaveHours_V2038(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeave;
        }

        public EmployeeAnnualLeave GetEmployeeEnjoyedLeaveHours_V2050(string workbenchConnectionString, Int32 idEmployee, Int32 idEmployeeLeave, long selectedPeriod, Int32 idCompany = 0)
        {
            EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();

            if (idCompany != 0)
                LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployeeAndIdLeave_V2050(workbenchConnectionString, idEmployee, selectedPeriod, idCompany.ToString(), idEmployeeLeave);

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeEnjoyedLeaveHours_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Period", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_IdLeave", idEmployeeLeave);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["Total"] != DBNull.Value)
                                    employeeAnnualLeave.TotalHoursCount = Convert.ToDecimal(reader["Total"]);
                            }
                        }

                    }
                }

                LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == idEmployeeLeave);
                if (leavedHoursDetail != null)
                {
                    employeeAnnualLeave.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                    employeeAnnualLeave.Remaining = employeeAnnualLeave.TotalHoursCount - employeeAnnualLeave.Enjoyed;
                }
                else
                {
                    employeeAnnualLeave.Enjoyed = 0;
                    employeeAnnualLeave.Remaining = employeeAnnualLeave.TotalHoursCount - employeeAnnualLeave.Enjoyed;
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeEnjoyedLeaveHours_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeAnnualLeave;
        }


        public bool checkexisttimespanfullbetweenInHoliday(TimeSpan leaveStart, TimeSpan leaveEnd, TimeSpan holidayStart, TimeSpan holidayend)
        {
            // see if start comes before end
            if (holidayStart < holidayend && leaveStart < leaveEnd)
                return (leaveStart >= holidayStart && leaveStart <= holidayend) && (holidayend >= leaveEnd && leaveEnd >= holidayStart);

            return false;
        }

        public bool checkexisttimespanhalfStartbetweenInHoliday(TimeSpan leaveStart, TimeSpan leaveEnd, TimeSpan holidayStart, TimeSpan holidayend)
        {

            // see if start comes before end
            if (holidayStart < holidayend && leaveStart < leaveEnd)
                return (leaveStart <= holidayStart && leaveStart <= holidayend) && (holidayend >= leaveEnd && leaveEnd >= holidayStart);

            return false;
        }

        public bool checkexisttimespanhalfEndbetweenInHoliday(TimeSpan leaveStart, TimeSpan leaveEnd, TimeSpan holidayStart, TimeSpan holidayend)
        {

            // see if start comes before end
            if (holidayStart < holidayend && leaveStart < leaveEnd)
                return (leaveStart >= holidayStart && leaveStart <= holidayend) && (holidayend <= leaveEnd && leaveEnd >= holidayStart);

            return false;
        }

        public bool checkexisttimespanhalfbothbetweenInHoliday(TimeSpan leaveStart, TimeSpan leaveEnd, TimeSpan holidayStart, TimeSpan holidayend)
        {

            // see if start comes before end
            if (holidayStart < holidayend && leaveStart < leaveEnd)
                return (leaveStart <= holidayStart && leaveStart <= holidayend) && (holidayend <= leaveEnd && leaveEnd >= holidayStart);

            return false;
        }


        public bool UpdateEmployee_V2038(string mainServerWorkbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocumentFilePath)
        {
            bool isUpdatedEmployee = false;

            if (employee.IdEmployeeStatus == 136 || employee.IdEmployeeStatus == 137)
                employee.EmployeeCode = employee.EmployeeCode.Replace("D", "E");

            if (employee.IdEmployeeStatus == 136)
            {
                employee.ExitDate = null;
                employee.ExitIdReason = null;
                employee.ExitRemarks = null;
                employee.ExitFileName = null;
            }

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Update_V2038", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);
                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employee.ExitFileName);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);
                        mySqlCommand.Parameters.AddWithValue("_HasWelcomeMessageBeenReceived", employee.HasWelcomeMessageBeenReceived);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)    //Save employee profile image.
                        SaveEmployeeProfileImage(employeeProfileImage, employee);
                    else if (employee.IsProfileImageDeleted)                                        //Delete employee profile image.
                        DeleteEmployeeProfileImage(employeeProfileImage, employee);

                    //if (!employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent!=null)   //Save employee exit Document.
                    //    SaveEmployeeExitDocument_V2035(employeeExitDocument, employee);
                    //else if (employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent != null)                                       //Delete employee exit Document.
                    //    DeleteEmployeeExitDocument_V2035(employeeExitDocument, employee);

                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                    AddUpdateDeleteEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                    AddUpdateDeleteEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                    AddUpdateDeleteEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                    AddUpdateDeleteEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                    AddUpdateDeleteEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                    AddUpdateDeleteEmployeeJobDescriptions(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                    AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                    AddUpdateDeleteEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                    AddUpdateDeleteEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                    AddUpdateDeleteEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                    AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                    AddUpdateDeleteEmployeeExitEvent(mainServerWorkbenchConnectionString, employee, employee.EmployeeExitEvents, employeeExitDocumentFilePath);


                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployee_V2038(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }


        public bool UpdateEmployee_V2042(string mainServerWorkbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocumentFilePath)
        {
            bool isUpdatedEmployee = false;

            if (employee.IdEmployeeStatus == 136 || employee.IdEmployeeStatus == 137)
                employee.EmployeeCode = employee.EmployeeCode.Replace("D", "E");

            if (employee.IdEmployeeStatus == 136)
            {
                employee.ExitDate = null;
                employee.ExitIdReason = null;
                employee.ExitRemarks = null;
                employee.ExitFileName = null;
            }

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Update_V2038", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);
                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employee.ExitFileName);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);
                        mySqlCommand.Parameters.AddWithValue("_HasWelcomeMessageBeenReceived", employee.HasWelcomeMessageBeenReceived);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)    //Save employee profile image.
                        SaveEmployeeProfileImage(employeeProfileImage, employee);
                    else if (employee.IsProfileImageDeleted)                                        //Delete employee profile image.
                        DeleteEmployeeProfileImage(employeeProfileImage, employee);

                    //if (!employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent!=null)   //Save employee exit Document.
                    //    SaveEmployeeExitDocument_V2035(employeeExitDocument, employee);
                    //else if (employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent != null)                                       //Delete employee exit Document.
                    //    DeleteEmployeeExitDocument_V2035(employeeExitDocument, employee);

                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                    AddUpdateDeleteEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                    AddUpdateDeleteEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                    AddUpdateDeleteEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                    AddUpdateDeleteEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                    AddUpdateDeleteEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                    AddUpdateDeleteEmployeeJobDescriptions_V2042(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                    AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                    AddUpdateDeleteEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                    AddUpdateDeleteEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                    AddUpdateDeleteEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                    AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                    AddUpdateDeleteEmployeeExitEvent(mainServerWorkbenchConnectionString, employee, employee.EmployeeExitEvents, employeeExitDocumentFilePath);


                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployee_V2042(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }

        public bool UpdateEmployeeHasWelcomeMessageBeenReceived(string mainServerWorkbenchConnectionString, Int32 idEmployee)
        {
            bool isUpdatedEmployee = false;


            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_UpdateEmployeeHasWelcomeMessageBeenReceived", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }


                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployeeHasWelcomeMessageBeenReceived(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }


        public Tuple<List<Employee>, Employee> GetEmployeeForWelcomeBoard(string workbenchConnectionString, string employeesProfileImagePath)
        {
            List<Employee> employees = new List<Employee>();
            Employee welcomeBoardInformer = new Employee();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeForWelcomeBoard", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Employee employee = new Employee();

                            if (reader["IdEmployee"] != DBNull.Value)
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);
                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);
                            if (reader["ContractSituationStartDate"] != DBNull.Value)
                            {
                                employee.ContractSituation = new ContractSituation();
                                employee.ContractSituation.HireDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                            }
                            if (reader["EmpDepartments"] != DBNull.Value)
                            {

                                List<string> LstDepartments = new List<string>();

                                LstDepartments = Convert.ToString(reader["EmpDepartments"]).Split('\n').ToList<string>();

                                employee.EmployeeDepartments = string.Join("\n", LstDepartments.ToList().Distinct().ToList());
                            }
                            if (reader["CompanyEmail"] != DBNull.Value)
                            {
                                employee.EmployeeContactEmail = Convert.ToString(reader["CompanyEmail"]);
                            }
                            employees.Add(employee);
                        }
                        if (reader.NextResult())
                        {
                            if (reader.Read())
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                    welcomeBoardInformer.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                if (reader["EmployeeCode"] != DBNull.Value)
                                    welcomeBoardInformer.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                if (reader["FirstName"] != DBNull.Value)
                                    welcomeBoardInformer.FirstName = Convert.ToString(reader["FirstName"]);
                                if (reader["LastName"] != DBNull.Value)
                                    welcomeBoardInformer.LastName = Convert.ToString(reader["LastName"]);
                                if (reader["IdGender"] != DBNull.Value)
                                    welcomeBoardInformer.IdGender = Convert.ToUInt32(reader["IdGender"]);
                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                {
                                    welcomeBoardInformer.EmployeeJobDescription = new EmployeeJobDescription();
                                    welcomeBoardInformer.EmployeeJobDescription.JobDescription = new JobDescription();
                                    welcomeBoardInformer.EmployeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        welcomeBoardInformer.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                }

                                welcomeBoardInformer.ProfileImageInBytes = GetEmployeeImage(welcomeBoardInformer.EmployeeCode, employeesProfileImagePath);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeForWelcomeBoard(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            Tuple<List<Employee>, Employee> employeeDaywiseLeaveDetail = null;
            if (employees.Count > 0)
            {
                employeeDaywiseLeaveDetail = Tuple.Create(employees, welcomeBoardInformer);
            }
            else
            {
                employeeDaywiseLeaveDetail = null;
            }


            return employeeDaywiseLeaveDetail;
        }


        public List<Employee> GetEmployeeDetailsForLeaveSummary_V2039(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeeDetailsForLeaveSummary_V2039", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);


                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }



                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["CompanyShortName"] != DBNull.Value)
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["CompanyShortName"]);

                                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employee.IdEmployee);
                                if (employee.EmployeeJobDescriptions != null)
                                {
                                    if (employee.EmployeeJobDescriptions.Count > 1)
                                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                                }

                                GetEmployeeLeaveByIdEmployee_V2039(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany, employees, employee);

                                // employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDetailsForLeaveSummary_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }


                }
            }
            Log4NetLogger.Logger.Log("Executed GetEmployeeDetailsForLeaveSummary_V2039().", category: Category.Info, priority: Priority.Low);
            return employees;
        }



        private string GetStringOfDayAndHourFromHours(decimal hours, decimal dailyHoursCount)
        {
            decimal TotalHours = hours;
            decimal DailyHours = dailyHoursCount;
            if (TotalHours == 0)
            {
                return TotalHours.ToString() + "d";
            }

            decimal Days = TotalHours / DailyHours;
            decimal Hours = TotalHours % DailyHours;

            if (Hours == 0)
                return Days.ToString() + "d";

            return string.Format("{0}d {1}H", (Int32)Days, Hours.ToString("0.##"));
        }


        public void GetEmployeeLeaveByIdEmployee_V2039(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod, string idCompany, List<Employee> employees, Employee employee)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();

            if (idCompany != null)
                LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployee_V2038(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesByIdEmployee_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAnnualLeave.Employee = new Employee();
                                    employeeAnnualLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeAnnualLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAnnualLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAnnualLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAnnualLeave.Employee.CompanyShift = new CompanyShift();
                                        employeeAnnualLeave.Employee.CompanyShift.IdCompanyShift = employeeAnnualLeave.Employee.IdCompanyShift;

                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                        {
                                            employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule;

                                            if (reader["ScheduleYear"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["ScheduleYear"]);

                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);

                                            if (reader["WorkingDays"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        }
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave = new CompanyLeave();
                                    employeeAnnualLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave.Name = reader["Name"].ToString();
                                    employeeAnnualLeave.CompanyLeave.HtmlColor = reader["HtmlColor"].ToString();
                                    if (reader["Position"] != DBNull.Value)
                                        employeeAnnualLeave.CompanyLeave.Position = Convert.ToUInt64(reader["Position"]);
                                }

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeave.TotalHoursCount = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;
                                employeeAnnualLeaves.Add(employeeAnnualLeave);


                            }
                        }


                    }
                }

                if (employeeAnnualLeaves.Count > 0)
                {
                    foreach (EmployeeAnnualLeave itemEAL in employeeAnnualLeaves)
                    {
                        Employee emp = new Employee();
                        emp = (Employee)employee.Clone();
                        LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == itemEAL.IdLeave);
                        if (leavedHoursDetail != null)
                        {
                            itemEAL.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                            itemEAL.Remaining = (itemEAL.RegularHoursCount + itemEAL.AdditionalHoursCount) - itemEAL.Enjoyed;
                        }
                        else
                        {
                            itemEAL.Enjoyed = 0;
                            itemEAL.Remaining = (itemEAL.RegularHoursCount + itemEAL.AdditionalHoursCount) - itemEAL.Enjoyed;
                        }

                        if (itemEAL.Employee.CompanyShift != null)
                            if (itemEAL.Employee.CompanyShift.CompanyAnnualSchedule != null)
                            {
                                itemEAL.RegularHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.RegularHoursCount, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.AdditionalHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.AdditionalHoursCount, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.TotalHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.TotalHoursCount, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.EnjoyedHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.Enjoyed, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.RemainingHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.Remaining, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                            }
                        emp.EmployeeAnnualLeave = itemEAL;
                        employees.Add(emp);
                    }
                }
                else
                {
                    employees.Add(employee);
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveByIdEmployee_V2039(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }


        }

        public void GetEmployeeLeaveByIdEmployee_V2050(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod, string idCompany, List<Employee> employees, Employee employee)
        {
            List<EmployeeAnnualLeave> employeeAnnualLeaves = new List<EmployeeAnnualLeave>();
            List<LeavedHoursDetail> LstLeavedHoursDetail = new List<LeavedHoursDetail>();

            if (idCompany != null)
                LstLeavedHoursDetail = GetAllEmpLeavesByIdEmployee_V2050(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAnnualLeavesByIdEmployee_V2038", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeAnnualLeave employeeAnnualLeave = new EmployeeAnnualLeave();

                                if (reader["IdEmployeeAnnualLeave"] != DBNull.Value)
                                    employeeAnnualLeave.IdEmployeeAnnualLeave = Convert.ToInt64(reader["IdEmployeeAnnualLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAnnualLeave.Employee = new Employee();
                                    employeeAnnualLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeAnnualLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAnnualLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAnnualLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAnnualLeave.Employee.CompanyShift = new CompanyShift();
                                        employeeAnnualLeave.Employee.CompanyShift.IdCompanyShift = employeeAnnualLeave.Employee.IdCompanyShift;

                                        if (reader["IdCompanySchedule"] != DBNull.Value)
                                        {
                                            employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                            employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAnnualLeave.Employee.CompanyShift.IdCompanySchedule;

                                            if (reader["ScheduleYear"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["ScheduleYear"]);

                                            if (reader["DailyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);

                                            if (reader["WorkingDays"] != DBNull.Value)
                                                employeeAnnualLeave.Employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                        }
                                    }
                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeAnnualLeave.IdLeave = Convert.ToInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave = new CompanyLeave();
                                    employeeAnnualLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(reader["IdLeave"]);
                                    employeeAnnualLeave.CompanyLeave.Name = reader["Name"].ToString();
                                    employeeAnnualLeave.CompanyLeave.HtmlColor = reader["HtmlColor"].ToString();
                                    if (reader["Position"] != DBNull.Value)
                                        employeeAnnualLeave.CompanyLeave.Position = Convert.ToUInt64(reader["Position"]);
                                }

                                if (reader["Year"] != DBNull.Value)
                                    employeeAnnualLeave.Year = Convert.ToInt32(reader["Year"]);

                                if (reader["RegularHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.RegularHoursCount = Convert.ToDecimal(reader["RegularHoursCount"]);

                                if (reader["AdditionalHoursCount"] != DBNull.Value)
                                    employeeAnnualLeave.AdditionalHoursCount = Convert.ToDecimal(reader["AdditionalHoursCount"]);

                                employeeAnnualLeave.Remaining = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;

                                employeeAnnualLeave.TotalHoursCount = employeeAnnualLeave.RegularHoursCount + employeeAnnualLeave.AdditionalHoursCount;
                                employeeAnnualLeaves.Add(employeeAnnualLeave);


                            }
                        }


                    }
                }

                if (employeeAnnualLeaves.Count > 0)
                {
                    foreach (EmployeeAnnualLeave itemEAL in employeeAnnualLeaves)
                    {
                        Employee emp = new Employee();
                        emp = (Employee)employee.Clone();
                        LeavedHoursDetail leavedHoursDetail = LstLeavedHoursDetail.FirstOrDefault(x => x.IdLeave == itemEAL.IdLeave);
                        if (leavedHoursDetail != null)
                        {
                            itemEAL.Enjoyed = Convert.ToDecimal((leavedHoursDetail.EnjoyedHours - leavedHoursDetail.IgnoredHours).TotalHours);
                            itemEAL.Remaining = (itemEAL.RegularHoursCount + itemEAL.AdditionalHoursCount) - itemEAL.Enjoyed;
                        }
                        else
                        {
                            itemEAL.Enjoyed = 0;
                            itemEAL.Remaining = (itemEAL.RegularHoursCount + itemEAL.AdditionalHoursCount) - itemEAL.Enjoyed;
                        }

                        if (itemEAL.Employee.CompanyShift != null)
                            if (itemEAL.Employee.CompanyShift.CompanyAnnualSchedule != null)
                            {
                                itemEAL.RegularHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.RegularHoursCount, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.AdditionalHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.AdditionalHoursCount, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.TotalHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.TotalHoursCount, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.EnjoyedHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.Enjoyed, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                                itemEAL.RemainingHoursInDays = GetStringOfDayAndHourFromHours(itemEAL.Remaining, itemEAL.Employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount);
                            }
                        emp.EmployeeAnnualLeave = itemEAL;
                        employees.Add(emp);
                    }
                }
                else
                {
                    employees.Add(employee);
                }

            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeaveByIdEmployee_V2050(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }


        }


        public List<EmployeeOrganizationChart> GetEmployeesForOrganizationChart(string workbenchConnectionString, Int32 idCompany, long selectedPeriod)
        {
            List<EmployeeOrganizationChart> employees = new List<EmployeeOrganizationChart>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeesForOrganizationChart", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                EmployeeOrganizationChart employee = new EmployeeOrganizationChart();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["EmpStatus"] != DBNull.Value)
                                    employee.EmployeeStatus = Convert.ToString(empReader["EmpStatus"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                    employee.HireDate = Convert.ToDateTime(empReader["HireDate"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                }
                                if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                    employee.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                if (empReader["JDCode"] != DBNull.Value)
                                    employee.JDCode = Convert.ToString(empReader["JDCode"]);

                                if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    employee.JobCode = Convert.ToString(empReader["JobDescriptionCode"]);

                                if (empReader["DepartmentName"] != DBNull.Value)
                                    employee.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    employee.JobTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                employee.Organization = Convert.ToString(empReader["CompanyOrganization"]);
                                employee.Company = Convert.ToString(empReader["CompanyContract"]);
                                employee.CompanyLocation = Convert.ToString(empReader["CompanyLocation"]);

                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])))
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                        employees.Where(i => i.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(i => i.EmployeeContractSituations.Add(employeeContractSituation));
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (var itememp in employees.GroupBy(i => i.IdEmployee))
            {
                EmployeeOrganizationChart itememployee = employees.Where(i => i.IdEmployee == itememp.Key).FirstOrDefault();
                if (itememployee.EmployeeContractSituations != null && itememployee.EmployeeContractSituations.Count > 0)
                {
                    // itememp.HireDate = itememp.EmployeeContractSituations.FirstOrDefault().ContractSituationStartDate;
                    itememployee.LengthOfServiceString = CalculateLengthOfService(itememployee.EmployeeContractSituations);
                }
                employees.Where(i => i.IdEmployee == itememp.Key).ToList().ForEach(i => i.LengthOfServiceString = itememployee.LengthOfServiceString);
            }


            Log4NetLogger.Logger.Log("Executed GetEmployeesForOrganizationChart().", category: Category.Info, priority: Priority.Low);
            return employees;
        }



        public List<EmployeeLeave> GetEmployeeLeavesBySelectedIdCompany_V2039(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();


            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesBySelectedIdCompany_V2039", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeLeave employeeLeave = new EmployeeLeave();

                                if (reader["IdEmployeeLeave"] != DBNull.Value)
                                    employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeLeave.Employee = new Employee();
                                    employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    if (reader["EmployeeCode"] != DBNull.Value)
                                        employeeLeave.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                    if (reader["FirstName"] != DBNull.Value)
                                        employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                    if (reader["LastName"] != DBNull.Value)
                                        employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                        employeeLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    if (reader["IdGender"] != DBNull.Value)
                                        employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeLeave.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeLeave.Employee.EmpJobCodes.Split('\n');
                                        employeeLeave.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeLeave.Employee.EmployeeJobTitles.Split('\n');
                                        employeeLeave.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeLeave.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeLeave.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeLeave.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeLeave.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }


                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                    employeeLeave.CompanyLeave = new CompanyLeave();
                                    employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                    employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                    employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeLeave.CompanyLeave.Company = new Company();

                                        employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule = new CompanyAnnualSchedule();

                                        employeeLeave.CompanyLeave.Company.CompanySetting = new CompanySetting();

                                        if (reader["CompanySetting"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeLeave.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeLeave.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeLeave.StartDate.Value, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeLeave.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["FileName"] != DBNull.Value)
                                    employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                                if (reader["Remark"] != DBNull.Value)
                                    employeeLeave.Remark = Convert.ToString(reader["Remark"]);

                                if (reader["IsAllDayEvent"] != DBNull.Value)
                                    employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);



                                employeeLeaves.Add(employeeLeave);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesBySelectedIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2039(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2039", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;


                                    if (empReader["MonBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.MonBreakTime = (TimeSpan)empReader["MonBreakTime"];

                                    if (empReader["TueBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.TueBreakTime = (TimeSpan)empReader["TueBreakTime"];

                                    if (empReader["WedBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.WedBreakTime = (TimeSpan)empReader["WedBreakTime"];

                                    if (empReader["ThuBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.ThuBreakTime = (TimeSpan)empReader["ThuBreakTime"];

                                    if (empReader["FriBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.FriBreakTime = (TimeSpan)empReader["FriBreakTime"];

                                    if (empReader["SatBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SatBreakTime = (TimeSpan)empReader["SatBreakTime"];

                                    if (empReader["SunBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SunBreakTime = (TimeSpan)empReader["SunBreakTime"];

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                                }
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                    if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                    Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                    employee.EmployeeContractSituations.Add(employeeContractSituation);
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }


        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2039(string workbenchConnectionString, string idCompany, long selectedPeriod = 0)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2039", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["AccountingDate"] != DBNull.Value)
                                {
                                    employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employeeAttendances;
        }


        public List<Department> GetAllEmployeesByDepartmentByIdCompany_V2039(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod = 0)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByDepartmentByIdCompany_V2039", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["IdDepartment"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();
                                    empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }





                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByDepartmentByIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);

            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(x => x.FullName).ToList());
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }


        public List<Employee> GetAllEmployeesForLeaveByIdCompany_V2039(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForLeaveByIdCompany_V2039", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }


                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }

                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee_V2038(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany);

                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForLeaveByIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employees;
        }

        /// <summary>
        /// This method is to get employee contracts details
        /// GEOS2-1959 GHRM - Leaves/Attendance inactive employees
        /// </summary>
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="idEmployees">Get employee ids</param>
        /// <returns>Employee contracts details</returns>
        public List<EmployeeContractSituation> GetEmployeeContracts(string workbenchConnectionString, string idEmployees)
        {
            List<EmployeeContractSituation> employeeContractSituations = new List<EmployeeContractSituation>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeeContracts", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_idEmployees", idEmployees);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {

                    while (empReader.Read())
                    {
                        try
                        {
                            EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                            if (empReader["IdEmployee"] != DBNull.Value)
                                employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);

                            if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                            if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                            employeeContractSituations.Add(employeeContractSituation);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeContracts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }

                return employeeContractSituations;
            }
        }


        /// <summary>
        /// This method is to get Number of Workstation in Department
        /// GEOS2-1919 GHRM - Org chart in excel
        /// </summary>
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="departmentIds">Get department ids</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>List of Company department</returns>
        public List<CompanyDepartment> GetNumberOfWorkStationByIdDepartment(string workbenchConnectionString, string departmentIds, Int32 idCompany)
        {
            List<CompanyDepartment> companyDepartments = new List<CompanyDepartment>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetNumberOfWorkStationByIdDepartment", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_DepartmentIds", departmentIds);
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {

                    while (empReader.Read())
                    {
                        try
                        {
                            CompanyDepartment companyDepartment = new CompanyDepartment();

                            if (empReader["IdDepartment"] != DBNull.Value)
                                companyDepartment.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                            if (empReader["IdCompany"] != DBNull.Value)
                                companyDepartment.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                            if (empReader["NumberOfWorkstations"] != DBNull.Value)
                                companyDepartment.NumberOfWorkstations = Convert.ToInt64(empReader["NumberOfWorkstations"]);


                            companyDepartments.Add(companyDepartment);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetNumberOfWorkStationByIdDepartment(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }

                return companyDepartments;
            }
        }



        /// <summary>
        /// This method is to get Number of Workstation in Department
        /// GEOS2-1919 GHRM - Org chart in excel
        /// </summary>
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="departmentAreaIds">Get department area ids</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>List of Company department</returns>
        public List<CompanyDepartment> GetSizeByIdDepartmentArea(string workbenchConnectionString, string departmentAreaIds, Int32 idCompany)
        {
            List<CompanyDepartment> companyDepartments = new List<CompanyDepartment>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetSizeByIdDepartmentArea", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_DepartmentAreaIds", departmentAreaIds);
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {

                    while (empReader.Read())
                    {
                        try
                        {
                            CompanyDepartment companyDepartment = new CompanyDepartment();

                            if (empReader["IdDepartmentArea"] != DBNull.Value)
                                companyDepartment.IdDepartmentArea = Convert.ToInt32(empReader["IdDepartmentArea"]);

                            if (empReader["IdCompany"] != DBNull.Value)
                                companyDepartment.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                            if (empReader["Size"] != DBNull.Value)
                                companyDepartment.Size = Convert.ToInt64(empReader["Size"]);


                            companyDepartments.Add(companyDepartment);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSizeByIdDepartmentArea(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }

                return companyDepartments;
            }
        }


        public List<Employee> GetEmpDtlByEmpDocNoAndPeriod_V2039(string workbenchConnectionString, string EmployeeDocumentNumbers, string idCompany, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmpDtlByEmpDocNoAndPeriod_V2039", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumbers);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employee.LastName = Convert.ToString(reader["LastName"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                        employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                        employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }

                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                        employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);
                                        string[] LstCompanyIds = employee.EmployeeCompanyIds.Split('\n');
                                        employee.EmployeeCompanyIds = string.Join("\n", LstCompanyIds.Distinct());
                                    }

                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employee.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }

                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation = new EmployeeContractSituation();
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                        if (reader.NextResult())
                            while (reader.Read())
                            {

                                try
                                {
                                    if (reader["IdEmployee"] != DBNull.Value)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                        employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                        if (reader["IdCompany"] != DBNull.Value)
                                            employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                        Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                        employee.EmployeeContractSituations.Add(employeeContractSituation);
                                    }

                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        public Dictionary<string, decimal> GetPlantWorkHours(string workbenchConnectionString, Int32 idCompany, Int64 selectedPeriod)
        {
            Dictionary<string, decimal> plantWorkhours = new Dictionary<string, decimal>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetPlantWorkHours", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {

                    if (empReader.Read())
                    {
                        try
                        {


                            if (empReader["DaliyHours"] != DBNull.Value)
                                plantWorkhours.Add("Day", Convert.ToDecimal(empReader["DaliyHours"]));

                            if (empReader["WeeklyHours"] != DBNull.Value)
                                plantWorkhours.Add("Week", Convert.ToDecimal(empReader["WeeklyHours"]));


                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPlantWorkHours(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (empReader.NextResult())
                        if (empReader.Read())
                        {
                            try
                            {


                                if (empReader["Plant_CNC_N_Shifts"] != DBNull.Value)
                                    plantWorkhours.Add("Plant_CNC_N_Shifts", Convert.ToInt64(empReader["Plant_CNC_N_Shifts"]));


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPlantWorkHours(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                }

                return plantWorkhours;
            }

        }

        /// <summary>
        /// This method is to get Number of Workstation in Department
        /// GEOS2-1919 GHRM - Org chart in excel
        /// </summary>
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="departmentAreaIds">Get department area ids</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>List of Company department</returns>
        public Double GetCompanySize(string workbenchConnectionString, Int32 idCompany)
        {
            Double companySize = 0;
            using (MySqlConnection conn = new MySqlConnection(workbenchConnectionString))
            {
                conn.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetCompanySize", conn);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {

                    while (empReader.Read())
                    {
                        try
                        {

                            if (empReader["Size"] != DBNull.Value)
                                companySize = Convert.ToDouble(empReader["Size"]);

                        }
                        catch (Exception ex)
                        {
                            empReader.Close();
                            conn.Close();
                            Log4NetLogger.Logger.Log(string.Format("Error GetCompanySize(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }

                return companySize;
            }
        }


        public JobDescription AddJobDescription_V2040(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Insert_V2040", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);

                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);
                        mySqlCommand.Parameters.AddWithValue("_IdJDLevel", jobDescription.IdJDLevel);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionIsMandatory", jobDescription.JobDescriptionIsMandatory);

                        jobDescription.IdJobDescription = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddJobDescription_V2040(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        public JobDescription UpdateJobDescription_V2040(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Update_V2040", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdJobDescription", jobDescription.IdJobDescription);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);

                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);
                        mySqlCommand.Parameters.AddWithValue("_IdJDLevel", jobDescription.IdJDLevel);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionIsMandatory", jobDescription.JobDescriptionIsMandatory);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (!string.IsNullOrEmpty(jobDescription.OldJobDescriptionCode) && !string.IsNullOrEmpty(jobDescription.JobDescriptionCode) && jobDescription.JobDescriptionCode != jobDescription.OldJobDescriptionCode)
                    {
                        string oldFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.OldJobDescriptionCode);
                        string newFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.JobDescriptionCode);

                        if (fileMgr.FileExists(oldFileName))
                            fileMgr.Move(oldFileName, newFileName);
                    }

                    if (jobDescription.IsJobDescriptionFileUpdated && jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateJobDescription_V2040(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        public List<JobDescription> GetAllJobDescriptions_V2040(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllJobDescriptions_V2040", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                jobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel = new LookupValue();
                                jobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel.Value = reader["JDLevel"].ToString();
                                jobDescription.JDLevel.HtmlColor = reader["JDHtmlColor"].ToString();
                                if (reader["JDImage"] != DBNull.Value)
                                    jobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDImage"].ToString());
                            }

                            if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                jobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);

                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptions_V2040(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        public List<JobDescription> GetIsMandatoryNotExistInJobDescriptionParent(string workbenchConnectionString, Int32 IdJobDescription)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetIsMandatoryNotExistInJobDescriptionParent", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdJobDescription", IdJobDescription);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();
                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                            if (reader["JobDescriptionCodeAndTitle"] != DBNull.Value)
                                jobDescription.JobDescriptionTitleAndCode = Convert.ToString(reader["JobDescriptionCodeAndTitle"]);
                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetIsMandatoryNotExistInJobDescriptionParent(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;

        }


        public bool UpdateIsMandatoryInJobDescriptionParent(string mainServerWorkbenchConnectionString, Int32 idJobDescription)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_UpdateIsMandatoryInJobDescriptionParent", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdJobDescription", idJobDescription);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateIsMandatoryInJobDescriptionParent(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    isUpdated = false;
                    throw;
                }
            }

            return isUpdated;
        }

        public List<JobDescription> GetOrganizationHierarchy_V2040(string workbenchConnectionString, string idCompany, long selectedPeriod)
        {
            List<JobDescription> jobDescriptions = GetAllJobDescriptionsHeirarchy_V2040(workbenchConnectionString);

            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesOrganizationHierarchy_V2040", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                                employeeJobDescription.JobDescription = new JobDescription();
                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeJobDescription.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                if (reader["JobDescriptionUsage"] != DBNull.Value)
                                    employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);

                                employeeJobDescription.Employee = new Employee();
                                employeeJobDescription.Employee.IdEmployee = employeeJobDescription.IdEmployee;
                                employeeJobDescription.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeJobDescription.Employee.LastName = Convert.ToString(reader["LastName"]);
                                employeeJobDescription.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                employeeJobDescriptions.Add(employeeJobDescription);
                            }
                        }
                        employeeJobDescriptions = employeeJobDescriptions.OrderBy(x => x.Employee.FullName).ToList();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOrganizationHierarchy_V2040(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (JobDescription jd in jobDescriptions)
            {
                if (employeeJobDescriptions.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    jd.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == jd.IdJobDescription));
                }

                if (jd.ChildJobDescriptions != null)
                {
                    foreach (var itemJD in jd.ChildJobDescriptions)
                    {
                        if (employeeJobDescriptions.Any(x => x.IdJobDescription == itemJD.IdJobDescription))
                        {
                            itemJD.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                            itemJD.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == itemJD.IdJobDescription));
                            jd.IsEmployeeExistInChildJD = true;
                        }
                    }
                }
            }

            jobDescriptions = IsChildJobDescriptionExistEmployee(jobDescriptions);

            return jobDescriptions;
        }

        public List<JobDescription> GetAllJobDescriptionsHeirarchy_V2040(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllJobDescriptionHeirarchy_V2040", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            jobDescription.ChildJobDescriptions = new List<JobDescription>();
                            jobDescriptions.Add(jobDescription);
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {

                                if (jobDescriptions.Any(i => i.IdJobDescription == Convert.ToUInt32(reader["IdParent"])))
                                {
                                    JobDescription JD = jobDescriptions.Where(i => i.IdJobDescription == Convert.ToUInt32(reader["IdParent"])).FirstOrDefault();

                                    JobDescription childJD = new JobDescription();
                                    if (reader["IdJobDescription"] != DBNull.Value)
                                        childJD.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                    childJD.JobDescriptionCode = reader["JobDescriptionCode"].ToString();
                                    childJD.JobDescriptionTitle = reader["JobDescriptionTitle"].ToString();
                                    if (reader["IdParent"] != DBNull.Value)
                                        childJD.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                    if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                        childJD.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);

                                    JD.ChildJobDescriptions.Add(childJD);
                                }

                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptionsHeirarchy_V2040(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        public List<JobDescription> GetAllJobDescriptionsHeirarchy_V2050(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllJobDescriptionHeirarchy_V2050", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);
                            }

                            if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            jobDescription.ChildJobDescriptions = new List<JobDescription>();
                            jobDescriptions.Add(jobDescription);
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {

                                if (jobDescriptions.Any(i => i.IdJobDescription == Convert.ToUInt32(reader["IdParent"])))
                                {
                                    JobDescription JD = jobDescriptions.Where(i => i.IdJobDescription == Convert.ToUInt32(reader["IdParent"])).FirstOrDefault();

                                    JobDescription childJD = new JobDescription();
                                    if (reader["IdJobDescription"] != DBNull.Value)
                                        childJD.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                    childJD.JobDescriptionCode = reader["JobDescriptionCode"].ToString();
                                    childJD.JobDescriptionTitle = reader["JobDescriptionTitle"].ToString();
                                    if (reader["IdParent"] != DBNull.Value)
                                        childJD.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                    if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                        childJD.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);
                                    if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                    {
                                        childJD.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);
                                    }
                                    if (reader["JobDescriptionInUse"] != DBNull.Value)
                                    {
                                        childJD.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);
                                    }

                                    JD.ChildJobDescriptions.Add(childJD);
                                }

                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptionsHeirarchy_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }


        public List<CompanySchedule> GetEmployeeCompanySchedule(string workbenchConnectionString, Int32 idEmployee, long selectedPeriod)
        {
            List<CompanySchedule> companySchedules = new List<CompanySchedule>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeCompanySchedule", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            CompanySchedule companySchedule = new CompanySchedule();
                            companySchedule.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                            if (reader["IdCompanySchedule"] != DBNull.Value)
                                companySchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                            if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                companySchedule.CompanyAnnualSchedule.IdCompanyAnnualSchedule = Convert.ToInt64(reader["IdCompanyAnnualSchedule"]);
                            if (reader["DailyHoursCount"] != DBNull.Value)
                                companySchedule.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                            if (reader["WeeklyHoursCount"] != DBNull.Value)
                                companySchedule.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                            if (reader["WorkingDays"] != DBNull.Value)
                                companySchedule.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);

                            companySchedules.Add(companySchedule);
                        }


                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeCompanySchedule(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companySchedules;
        }

        public List<EmployeeLeave> GetEmployeeLeavesBySelectedIdCompany_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();


            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesBySelectedIdCompany_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeLeave employeeLeave = new EmployeeLeave();

                                if (reader["IdEmployeeLeave"] != DBNull.Value)
                                    employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeLeave.Employee = new Employee();
                                    employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    if (reader["EmployeeCode"] != DBNull.Value)
                                        employeeLeave.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                    if (reader["FirstName"] != DBNull.Value)
                                        employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                    if (reader["LastName"] != DBNull.Value)
                                        employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                        employeeLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    if (reader["IdGender"] != DBNull.Value)
                                        employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeLeave.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeLeave.Employee.EmpJobCodes.Split('\n');
                                        employeeLeave.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeLeave.Employee.EmployeeJobTitles.Split('\n');
                                        employeeLeave.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeLeave.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeLeave.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeLeave.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeLeave.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }


                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                    employeeLeave.CompanyLeave = new CompanyLeave();
                                    employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                    employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                    employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeLeave.CompanyLeave.Company = new Company();

                                        employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule = new CompanyAnnualSchedule();

                                        employeeLeave.CompanyLeave.Company.CompanySetting = new CompanySetting();

                                        if (reader["CompanySetting"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeLeave.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeLeave.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeLeave.StartDate.Value, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeLeave.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["FileName"] != DBNull.Value)
                                    employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                                if (reader["Remark"] != DBNull.Value)
                                    employeeLeave.Remark = Convert.ToString(reader["Remark"]);

                                if (reader["IsAllDayEvent"] != DBNull.Value)
                                    employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);



                                employeeLeaves.Add(employeeLeave);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesBySelectedIdCompany_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        public List<Employee> GetEmployeeDetailsForLeaveSummary_V2041(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeeDetailsForLeaveSummary_V2041", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);


                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }



                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["CompanyShortName"] != DBNull.Value)
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["CompanyShortName"]);

                                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employee.IdEmployee);
                                if (employee.EmployeeJobDescriptions != null)
                                {
                                    if (employee.EmployeeJobDescriptions.Count > 1)
                                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                                }

                                GetEmployeeLeaveByIdEmployee_V2039(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany, employees, employee);

                                // employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDetailsForLeaveSummary_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }


                }
            }
            Log4NetLogger.Logger.Log("Executed GetEmployeeDetailsForLeaveSummary_V2041().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        public List<Employee> GetEmployeeDetailsForLeaveSummary_V2050(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeeDetailsForLeaveSummary_V2041", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);


                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }



                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["CompanyShortName"] != DBNull.Value)
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["CompanyShortName"]);

                                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employee.IdEmployee);
                                if (employee.EmployeeJobDescriptions != null)
                                {
                                    if (employee.EmployeeJobDescriptions.Count > 1)
                                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                                }

                                GetEmployeeLeaveByIdEmployee_V2050(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany, employees, employee);

                                // employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDetailsForLeaveSummary_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }


                }
            }
            Log4NetLogger.Logger.Log("Executed GetEmployeeDetailsForLeaveSummary_V2050().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        public List<Department> GetAllEmployeesByDepartmentByIdCompany_V2041(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByDepartmentByIdCompany_V2041", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["IdDepartment"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();
                                    empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }





                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByDepartmentByIdCompany_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);

            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(x => x.FullName).ToList());
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }


        public Employee GetEmployeeCurrentDetail(string workbenchConnectionString, Int32 idUser, Int64 selectedPeriod)
        {
            Employee employee = new Employee();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeCurrentDetails", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdUser", idUser);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employee.EmployeeDepartments = Convert.ToString(reader["departIds"]);
                                employee.Organization = Convert.ToString(reader["companiesIds"]);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeCurrentDetail(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employee;
        }
        public List<Employee> GetAllEmployeesByIdCompany_V2041(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByIdCompany_V2041", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganizationPlant", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["IdGender"] != DBNull.Value)
                                {
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                    employee.Gender = new LookupValue();
                                    employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                    employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                                }

                                if (empReader["IdMaritalStatus"] != DBNull.Value)
                                {
                                    employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                    employee.MaritalStatus = new LookupValue();
                                    employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                    employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                                }

                                if (empReader["IdNationality"] != DBNull.Value)
                                {
                                    employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                    employee.Nationality = new Country();
                                    employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                    employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                                }

                                if (empReader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (empReader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (empReader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(empReader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (empReader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (empReader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["CompanyMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(empReader["CompanyMobiles"]);
                                    employee.EmployeeContactCompanyMobileList = Convert.ToString(empReader["CompanyMobiles"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyMobileList != null && employee.EmployeeContactCompanyMobileList.Count > 0)
                                    {
                                        employee.EmployeeContactMobile = employee.EmployeeContactCompanyMobileList.First();
                                    }
                                }

                                if (empReader["CompanyEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyEmailList = Convert.ToString(empReader["CompanyEmails"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyEmailList != null && employee.EmployeeContactCompanyEmailList.Count > 0)
                                    {
                                        employee.EmployeeContactEmail = employee.EmployeeContactCompanyEmailList.First();
                                    }
                                }

                                if (empReader["PrivateMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateMobiles = Convert.ToString(empReader["PrivateMobiles"]);
                                    employee.EmployeeContactPrivateMobileList = Convert.ToString(empReader["PrivateMobiles"]).Split('\n').ToList<string>();
                                }

                                if (empReader["employeeShiftNames"] != DBNull.Value)
                                {
                                    employee.EmployeeShiftNames = Convert.ToString(empReader["employeeShiftNames"]);
                                    List<string> eshiftNames = Convert.ToString(empReader["employeeShiftNames"]).Split('\n').ToList<string>();
                                    eshiftNames = eshiftNames.Distinct().ToList();
                                    employee.EmployeeShiftNames = string.Join("\n", eshiftNames.ToArray());
                                }

                                if (empReader["employeeShiftScheduleNames"] != DBNull.Value)
                                {

                                    employee.EmployeeShiftScheduleNames = Convert.ToString(empReader["employeeShiftScheduleNames"]);
                                    List<string> eshiftScheduleNames = Convert.ToString(empReader["employeeShiftScheduleNames"]).Split('\n').ToList<string>();
                                    eshiftScheduleNames = eshiftScheduleNames.Distinct().ToList();
                                    employee.EmployeeShiftScheduleNames = string.Join("\n", eshiftScheduleNames.ToArray());
                                }

                                if (empReader["PrivateEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateEmailList = Convert.ToString(empReader["PrivateEmails"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }


                                if (empReader["Languages"] != DBNull.Value)
                                    employee.Languages = Convert.ToString(empReader["Languages"]);

                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["EmployeeDocumentNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocNationalId = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentName = Convert.ToString(empReader["EmployeeDocumentName"]);
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                }

                                if (empReader["DocPassportNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPassport = Convert.ToString(empReader["DocPassportNumber"]);
                                }

                                if (empReader["DocDrLicenseNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocDrLicense = Convert.ToString(empReader["DocDrLicenseNumber"]);
                                }

                                if (empReader["DocPubInsNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPubIns = Convert.ToString(empReader["DocPubInsNumber"]);
                                }

                                if (empReader["DocPriInsNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocPriIns = Convert.ToString(empReader["DocPriInsNumber"]);
                                }

                                if (empReader["DocVisaNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocVisa = Convert.ToString(empReader["DocVisaNumber"]);
                                }

                                if (empReader["DocOtherNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocOther = Convert.ToString(empReader["DocOtherNumber"]);
                                }

                                if (empReader["DocClockIdNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocClockId = Convert.ToString(empReader["DocClockIdNumber"]);
                                }

                                // Exit 
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                if (empReader["ExitIdReason"] != DBNull.Value)
                                {
                                    employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                    employee.ExitReason = new LookupValue();
                                    employee.ExitReason.IdLookupValue = (Int32)employee.ExitIdReason;
                                    employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                                }

                                if (empReader["ExitRemarks"] != DBNull.Value)
                                    employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                    empJobDescription.JobDescription = new JobDescription();

                                    if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);
                                    }



                                    if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);
                                    }

                                    if (empReader["JobCodeAndTitles"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitleAndCode = Convert.ToString(empReader["JobCodeAndTitles"]);
                                    }


                                    if (empReader["DepartmentName"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                    }



                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }

                                    empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["MaxJobDescriptionUsage"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }


                                employee.ContractSituation = new ContractSituation();
                                // employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                {
                                    employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                }


                                if (empReader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(empReader["LengthOfService"]);

                                }

                                if (empReader["IdEmployeeStatus"] != DBNull.Value)
                                {
                                    employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus = new LookupValue();
                                    employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus.Value = empReader["EmployeeStatus"].ToString();
                                    employee.EmployeeStatus.HtmlColor = empReader["EmployeeStatusColor"].ToString();

                                    if (empReader["EmployeeIdImage"] != DBNull.Value)
                                        employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["EmployeeIdImage"].ToString());

                                    if (empReader["EmployeeStatusPosition"] != DBNull.Value)
                                        employee.EmployeeStatus.Position = Convert.ToInt32(empReader["EmployeeStatusPosition"].ToString());
                                }

                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["CompanyShiftName"] != DBNull.Value)
                                        employee.CompanyShift.Name = Convert.ToString(empReader["CompanyShiftName"]);

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["WorkScheduleName"]);
                                    }

                                    if (empReader["StartTime1"] != DBNull.Value)
                                        employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                    if (empReader["EndTime1"] != DBNull.Value)
                                        employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                    if (empReader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];
                                }

                                if (empReader["IdCompanyLocation"] != DBNull.Value)
                                {
                                    employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation = new Company();
                                    employee.CompanyLocation.IdCompany = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["Location"]);
                                }

                                if (empReader["Organization"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Organization"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Organization = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["Company"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Company"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Company = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    List<string> tempDiffDepart = Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>();
                                    tempDiffDepart = tempDiffDepart.Distinct().ToList();
                                    employee.EmployeeDepartments = string.Join("\n", tempDiffDepart.ToArray()); ;
                                }
                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    Employee emp = employees.Where(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])).FirstOrDefault();
                                    if (emp != null)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                        if (empReader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                        if (empReader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(empReader["ContractSituationFileName"]);
                                        if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);
                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);
                                        if (empReader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(empReader["ContractSituationRemarks"]);
                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);
                                        if (empReader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(empReader["IdProfessionalCategory"]);


                                        emp.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesByIdCompany_V2041().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        public List<Employee> GetAllEmployeesByIdCompany_V2046(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();


            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesByIdCompany_V2046", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganizationPlant", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["DisplayName"] != DBNull.Value)
                                    employee.DisplayName = Convert.ToString(empReader["DisplayName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["IdGender"] != DBNull.Value)
                                {
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                    employee.Gender = new LookupValue();
                                    employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                    employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                                }

                                if (empReader["IdMaritalStatus"] != DBNull.Value)
                                {
                                    employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                    employee.MaritalStatus = new LookupValue();
                                    employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                    employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                                }

                                if (empReader["IdNationality"] != DBNull.Value)
                                {
                                    employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                    employee.Nationality = new Country();
                                    employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                    employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                                }

                                if (empReader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (empReader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (empReader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(empReader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (empReader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (empReader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["CompanyMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyMobiles = Convert.ToString(empReader["CompanyMobiles"]);
                                    employee.EmployeeContactCompanyMobileList = Convert.ToString(empReader["CompanyMobiles"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyMobileList != null && employee.EmployeeContactCompanyMobileList.Count > 0)
                                    {
                                        employee.EmployeeContactMobile = employee.EmployeeContactCompanyMobileList.First();
                                    }
                                }

                                if (empReader["CompanyEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactCompanyEmailList = Convert.ToString(empReader["CompanyEmails"]).Split('\n').ToList<string>();

                                    if (employee.EmployeeContactCompanyEmailList != null && employee.EmployeeContactCompanyEmailList.Count > 0)
                                    {
                                        employee.EmployeeContactEmail = employee.EmployeeContactCompanyEmailList.First();
                                    }
                                }

                                if (empReader["PrivateMobiles"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateMobiles = Convert.ToString(empReader["PrivateMobiles"]);
                                    employee.EmployeeContactPrivateMobileList = Convert.ToString(empReader["PrivateMobiles"]).Split('\n').ToList<string>();
                                }

                                if (empReader["employeeShiftNames"] != DBNull.Value)
                                {
                                    employee.EmployeeShiftNames = Convert.ToString(empReader["employeeShiftNames"]);
                                    List<string> eshiftNames = Convert.ToString(empReader["employeeShiftNames"]).Split('\n').ToList<string>();
                                    eshiftNames = eshiftNames.Distinct().ToList();
                                    employee.EmployeeShiftNames = string.Join("\n", eshiftNames.ToArray());
                                }

                                if (empReader["employeeShiftScheduleNames"] != DBNull.Value)
                                {

                                    employee.EmployeeShiftScheduleNames = Convert.ToString(empReader["employeeShiftScheduleNames"]);
                                    List<string> eshiftScheduleNames = Convert.ToString(empReader["employeeShiftScheduleNames"]).Split('\n').ToList<string>();
                                    eshiftScheduleNames = eshiftScheduleNames.Distinct().ToList();
                                    employee.EmployeeShiftScheduleNames = string.Join("\n", eshiftScheduleNames.ToArray());
                                }

                                if (empReader["PrivateEmails"] != DBNull.Value)
                                {
                                    employee.EmployeeContactPrivateEmailList = Convert.ToString(empReader["PrivateEmails"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(empReader["JobTitles"]);
                                    }

                                }


                                if (empReader["Languages"] != DBNull.Value)
                                    employee.Languages = Convert.ToString(empReader["Languages"]);

                                if (empReader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmpJobCodes = Convert.ToString(empReader["JobCodes"]);
                                    employee.EmployeeJobCodes = Convert.ToString(empReader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (empReader["JobCodeAbbreviations"] != DBNull.Value)
                                {
                                    employee.EmpJobCodeAbbreviations = Convert.ToString(empReader["JobCodeAbbreviations"]);
                                }

                                if (empReader["EmployeeDocumentNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocNationalId = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentName = Convert.ToString(empReader["EmployeeDocumentName"]);
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(empReader["EmployeeDocumentNumber"]);
                                }

                                if (empReader["DocPassportNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPassport = Convert.ToString(empReader["DocPassportNumber"]);
                                }

                                if (empReader["DocDrLicenseNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocDrLicense = Convert.ToString(empReader["DocDrLicenseNumber"]);
                                }

                                if (empReader["DocPubInsNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocPubIns = Convert.ToString(empReader["DocPubInsNumber"]);
                                }

                                if (empReader["DocPriInsNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocPriIns = Convert.ToString(empReader["DocPriInsNumber"]);
                                }

                                if (empReader["DocVisaNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocVisa = Convert.ToString(empReader["DocVisaNumber"]);
                                }

                                if (empReader["DocOtherNumber"] != DBNull.Value)
                                {

                                    employee.EmployeeDocOther = Convert.ToString(empReader["DocOtherNumber"]);
                                }

                                if (empReader["DocClockIdNumber"] != DBNull.Value)
                                {
                                    employee.EmployeeDocClockId = Convert.ToString(empReader["DocClockIdNumber"]);
                                }

                                // Exit 
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                if (empReader["ExitIdReason"] != DBNull.Value)
                                {
                                    employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                    employee.ExitReason = new LookupValue();
                                    employee.ExitReason.IdLookupValue = (Int32)employee.ExitIdReason;
                                    employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                                }

                                if (empReader["ExitRemarks"] != DBNull.Value)
                                    employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                                if (empReader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                    empJobDescription.JobDescription = new JobDescription();

                                    if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);
                                    }



                                    if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);
                                    }

                                    if (empReader["JobCodeAndTitles"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.JobDescriptionTitleAndCode = Convert.ToString(empReader["JobCodeAndTitles"]);
                                    }


                                    if (empReader["DepartmentName"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);
                                    }



                                    if (empReader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(empReader["HireDate"]);
                                    }

                                    empJobDescription.JobDescriptionUsage = Convert.ToUInt16(empReader["MaxJobDescriptionUsage"]);
                                    employee.EmployeeJobDescription = empJobDescription;
                                }


                                employee.ContractSituation = new ContractSituation();
                                // employee.ContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                employee.ContractSituation.Name = Convert.ToString(empReader["ContractSituation"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                {
                                    employee.ContractSituation.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                }


                                if (empReader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(empReader["LengthOfService"]);

                                }

                                if (empReader["IdEmployeeStatus"] != DBNull.Value)
                                {
                                    employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus = new LookupValue();
                                    employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                    employee.EmployeeStatus.Value = empReader["EmployeeStatus"].ToString();
                                    employee.EmployeeStatus.HtmlColor = empReader["EmployeeStatusColor"].ToString();

                                    if (empReader["EmployeeIdImage"] != DBNull.Value)
                                        employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["EmployeeIdImage"].ToString());

                                    if (empReader["EmployeeStatusPosition"] != DBNull.Value)
                                        employee.EmployeeStatus.Position = Convert.ToInt32(empReader["EmployeeStatusPosition"].ToString());
                                }

                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                    if (empReader["CompanyShiftName"] != DBNull.Value)
                                        employee.CompanyShift.Name = Convert.ToString(empReader["CompanyShiftName"]);

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["WorkScheduleName"]);
                                    }

                                    if (empReader["StartTime1"] != DBNull.Value)
                                        employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                    if (empReader["EndTime1"] != DBNull.Value)
                                        employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                    if (empReader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];
                                }

                                if (empReader["IdCompanyLocation"] != DBNull.Value)
                                {
                                    employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation = new Company();
                                    employee.CompanyLocation.IdCompany = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["Location"]);
                                }

                                if (empReader["Organization"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Organization"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Organization = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["Company"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Company"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Company = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["DifferentDepartmentName"] != DBNull.Value)
                                {
                                    List<string> tempDiffDepart = Convert.ToString(empReader["DifferentDepartmentName"]).Split('\n').ToList<string>();
                                    tempDiffDepart = tempDiffDepart.Distinct().ToList();
                                    employee.EmployeeDepartments = string.Join("\n", tempDiffDepart.ToArray()); ;
                                }
                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2046(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    Employee emp = employees.Where(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])).FirstOrDefault();
                                    if (emp != null)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                        if (empReader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);
                                        if (empReader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(empReader["ContractSituationFileName"]);
                                        if (empReader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(empReader["IdEmployeeContractSituation"]);
                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);
                                        if (empReader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(empReader["ContractSituationRemarks"]);
                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);
                                        if (empReader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(empReader["IdProfessionalCategory"]);


                                        emp.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesByIdCompany_V2046(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesByIdCompany_V2046().", category: Category.Info, priority: Priority.Low);
            return employees;
        }


        public List<Employee> GetAllEmployeesShortDetail(string workbenchConnectionString, string idCompany, string SelectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission,string firstName,string lastName)
        {
            List<Employee> employees = new List<Employee>();
            string[] cntSplit = SelectedPeriod.Split(',');

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesShortDetail", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", SelectedPeriod);
                empCommand.Parameters.AddWithValue("_NoOfCommaInSelectedPeriod", cntSplit!=null?cntSplit.Count():0);
                empCommand.Parameters.AddWithValue("_idsOrganizationPlant", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);
                empCommand.Parameters.AddWithValue("_FirstName", firstName);
                empCommand.Parameters.AddWithValue("_LastName", lastName);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                     if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);
                                
                                if (empReader["ExitDate"] != DBNull.Value)
                                    employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                                 if (empReader["HireDate"] != DBNull.Value)
                                 {
                                        employee.HireDate = Convert.ToDateTime(empReader["HireDate"]);
                                 }

                                if (empReader["IdCompanyLocation"] != DBNull.Value)
                                {
                                    employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation = new Company();
                                    employee.CompanyLocation.IdCompany = Convert.ToInt32(empReader["IdCompanyLocation"]);
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["Location"]);
                                }

                                if (empReader["Organization"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Organization"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Organization = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                if (empReader["Company"] != DBNull.Value)
                                {
                                    List<string> tempDifferentJobComp = Convert.ToString(empReader["Company"]).Split(',').ToList<string>();
                                    tempDifferentJobComp = tempDifferentJobComp.Distinct().ToList();
                                    employee.Company = string.Join("\n", tempDifferentJobComp.ToArray());
                                }

                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesShortDetail(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                   
                }
            }
           


            Log4NetLogger.Logger.Log("Executed GetAllEmployeesShortDetail().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        public List<Department> GetLengthOfServiceByDepartment_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Department> departments = new List<Department>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetLengthOfServiceByDepartment_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Department department = new Department();

                            department.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                            if (empReader["DepartmentName"] != DBNull.Value)
                                department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                            if (empReader["DepartmentHtmlColor"] != DBNull.Value)
                                department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);

                            if (empReader["Years"] != DBNull.Value)
                                department.YearsCount = Convert.ToDecimal(empReader["Years"]);

                            departments.Add(department);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetLengthOfServiceByDepartment_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            List<Department> EmpHeadCountByDept = GetEmployeesHeadCountByDepartmentByIdCompany_V2041(workbenchConnectionString, idCompanies, selectedPeriod, idsOrganization, idsDepartment, idPermission);

            foreach (Department item in departments)
            {
                if (EmpHeadCountByDept.Any(x => x.IdDepartment == item.IdDepartment))
                {
                    item.EmployeesCount = EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment).EmployeesCount;
                    item.EmployeesRecordCount = EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment).EmployeesRecordCount;
                    EmpHeadCountByDept.Remove(EmpHeadCountByDept.FirstOrDefault(x => x.IdDepartment == item.IdDepartment));
                }
            }

            if (EmpHeadCountByDept.Count > 0)
            {
                departments.AddRange(EmpHeadCountByDept);
            }

            return departments;
        }

        public List<Department> GetEmployeesHeadCountByDepartmentByIdCompany_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Department> departments = new List<Department>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpHeadcountByDeptByIdCompany_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Department department = new Department();

                                department.IdDepartment = Convert.ToUInt32(empReader["IdDepartment"]);

                                if (empReader["DepartmentName"] != DBNull.Value)
                                    department.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                                if (empReader["DepartmentHtmlColor"] != DBNull.Value)
                                    department.DepartmentHtmlColor = Convert.ToString(empReader["DepartmentHtmlColor"]);

                                if (empReader["EmployeesRecordCount"] != DBNull.Value)
                                {
                                    department.EmployeesCount = Convert.ToUInt32(empReader["EmployeesRecordCount"]);
                                    department.EmployeesRecordCount = Convert.ToDecimal(empReader["EmployeesRecordCount"]);
                                }

                                departments.Add(department);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesHeadCountByDepartmentByIdCompany_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return departments;
        }

        public List<Company> GetEmployeesCountByIdCompany_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Company> companies = new List<Company>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByIdCompany_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                    {
                        while (empReader.Read())
                        {
                            try
                            {
                                Company company = new Company();

                                company.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                if (empReader["Name"] != DBNull.Value)
                                {
                                    company.Name = Convert.ToString(empReader["Name"]);
                                    company.Alias = Convert.ToString(empReader["Alias"]);
                                }

                                if (empReader["EmpCount"] != DBNull.Value)
                                    company.EmployeesCount = Convert.ToUInt32(empReader["EmpCount"]);

                                companies.Add(company);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByIdCompany_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }

            return companies;
        }

        public List<JobDescription> GetEmployeesCountByJobPositionByIdCompany_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpHeadcountByJobPositionByIdCompany_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                JobDescription jobDescription = new JobDescription();

                                jobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJd"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                {
                                    jobDescription.EmployeeCount = Convert.ToUInt64(empReader["EmployeeCount"]);
                                    jobDescription.EmployeeRecordCount = Convert.ToDecimal(empReader["EmployeeCount"]);
                                }

                                jobDescriptions.Add(jobDescription);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByJobPositionByIdCompany_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            List<JobDescription> jdLengthOfService = GetLengthOfServiceByJobPosition_V2041(workbenchConnectionString, idCompanies, selectedPeriod, idsOrganization, idsDepartment, idPermission);

            foreach (JobDescription jd in jobDescriptions)
            {
                if (jdLengthOfService.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.YearsCount = jdLengthOfService.FirstOrDefault(x => x.IdJobDescription == jd.IdJobDescription).YearsCount;
                    jdLengthOfService.Remove(jdLengthOfService.FirstOrDefault(x => x.IdJobDescription == jd.IdJobDescription));
                }
            }

            if (jdLengthOfService.Count > 0)
            {
                jobDescriptions.AddRange(jdLengthOfService);
            }

            return jobDescriptions;
        }


        public List<JobDescription> GetLengthOfServiceByJobPosition_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetLengthOfServiceByJobPosition_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            JobDescription jobDescription = new JobDescription();

                            jobDescription.IdJobDescription = Convert.ToUInt32(empReader["IdJobDescription"]);

                            if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                jobDescription.JobDescriptionTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                            if (empReader["JobDescriptionCode"] != DBNull.Value)
                                jobDescription.JobDescriptionCode = Convert.ToString(empReader["JobDescriptionCode"]);

                            if (empReader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(empReader["Abbreviation"]);

                            if (empReader["Years"] != DBNull.Value)
                                jobDescription.YearsCount = Convert.ToDecimal(empReader["Years"]);

                            jobDescriptions.Add(jobDescription);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetLengthOfServiceByJobPosition_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return jobDescriptions;
        }


        public List<Employee> GetBirthdaysOfEmployeesByYear_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetBirthdaysOfEmployeesByYear_V2041", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                mySqlCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(reader["NativeName"]);

                            if (reader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(reader["BirthDay"]);
                                employee.DateOfBirth = Convert.ToDateTime(reader["BirthDate"]);
                            }

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            //employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetBirthdaysOfEmployeesByYear_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return employees;
        }
        public List<LookupValue> GetEmployeesCountByDepartmentAreaByIdCompany_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByDeptAreaByIdCompany_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                LookupValue lvDepartmentArea = new LookupValue();

                                lvDepartmentArea.IdLookupValue = Convert.ToInt32(empReader["IdLookupValue"]);

                                if (empReader["Value"] != DBNull.Value)
                                    lvDepartmentArea.Value = Convert.ToString(empReader["Value"]);

                                if (empReader["HtmlColor"] != DBNull.Value)
                                    lvDepartmentArea.HtmlColor = Convert.ToString(empReader["HtmlColor"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                {
                                    lvDepartmentArea.Count = Convert.ToUInt64(empReader["EmployeeCount"]);
                                    lvDepartmentArea.CountValue = Convert.ToDecimal(empReader["EmployeeCount"]);
                                }

                                departmentAreaList.Add(lvDepartmentArea);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByDepartmentAreaByIdCompany_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return departmentAreaList;
        }


        public List<LookupValue> GetEmployeesCountByGenderByIdCompany_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<LookupValue> genderList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByGenderByIdCompany_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                LookupValue lvGender = new LookupValue();

                                lvGender.IdLookupValue = Convert.ToInt32(empReader["IdLookupValue"]);

                                if (empReader["Value"] != DBNull.Value)
                                    lvGender.Value = Convert.ToString(empReader["Value"]);

                                if (empReader["HtmlColor"] != DBNull.Value)
                                    lvGender.HtmlColor = Convert.ToString(empReader["HtmlColor"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                    lvGender.Count = Convert.ToUInt64(empReader["EmployeeCount"]);

                                genderList.Add(lvGender);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByGenderByIdCompany_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return genderList;
        }

        public List<ContractSituation> GetEmployeesCountByContractByIdCompany_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<ContractSituation> contractSituations = new List<ContractSituation>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpCountByContractByIdCompany_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                ContractSituation contractSituation = new ContractSituation();

                                contractSituation.IdContractSituation = Convert.ToUInt16(empReader["IdContractSituation"]);

                                if (empReader["Name"] != DBNull.Value)
                                    contractSituation.Name = Convert.ToString(empReader["Name"]);

                                if (empReader["EmployeeCount"] != DBNull.Value)
                                    contractSituation.EmployeeCount = Convert.ToUInt64(empReader["EmployeeCount"]);

                                contractSituations.Add(contractSituation);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesCountByContractByIdCompany_V2041(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return contractSituations;
        }

        public List<EmployeeLeave> GetEmployeeLeavesForDashboard_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesForDashboard_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeLeave employeeLeave = new EmployeeLeave();

                            if (reader["IdEmployeeLeave"] != DBNull.Value)
                                employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeLeave.Employee = new Employee();
                                employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["IdLeave"] != DBNull.Value)
                            {
                                employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                employeeLeave.CompanyLeave = new CompanyLeave();
                                employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            if (reader["StartDate"] != DBNull.Value)
                                employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);

                            if (reader["EndDate"] != DBNull.Value)
                                employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);

                            if (reader["IsAllDayEvent"] != DBNull.Value)
                                employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                            employeeLeaves.Add(employeeLeave);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesForDashboard_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }


        public List<EmployeeDocument> GetEmployeeDocumentsExpirationForDashboard_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeDocument> employeeDocuments = new List<EmployeeDocument>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeDocumentsExpirationForDashboard_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeDocument employeeDocument = new EmployeeDocument();

                            if (reader["IdEmployeeDocument"] != DBNull.Value)
                                employeeDocument.IdEmployeeDocument = Convert.ToUInt64(reader["IdEmployeeDocument"]);

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeDocument.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeDocument.Employee = new Employee();
                                employeeDocument.Employee.IdEmployee = employeeDocument.IdEmployee;
                                employeeDocument.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeDocument.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["EmployeeDocumentName"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentName = Convert.ToString(reader["EmployeeDocumentName"]);

                            if (reader["EmployeeDocumentIdType"] != DBNull.Value)
                            {
                                employeeDocument.EmployeeDocumentIdType = Convert.ToInt32(reader["EmployeeDocumentIdType"]);

                                employeeDocument.EmployeeDocumentType = new LookupValue();
                                employeeDocument.EmployeeDocumentType.IdLookupValue = employeeDocument.EmployeeDocumentIdType;
                                employeeDocument.EmployeeDocumentType.Value = Convert.ToString(reader["Value"]);
                                employeeDocument.EmployeeDocumentType.HtmlColor = Convert.ToString(reader["HtmlColor"]);
                            }

                            if (reader["EmployeeDocumentNumber"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                            if (reader["EmployeeDocumentIssueDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentIssueDate = Convert.ToDateTime(reader["EmployeeDocumentIssueDate"]);

                            if (reader["EmployeeDocumentExpiryDate"] != DBNull.Value)
                                employeeDocument.EmployeeDocumentExpiryDate = Convert.ToDateTime(reader["EmployeeDocumentExpiryDate"]);

                            employeeDocuments.Add(employeeDocument);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeDocumentsExpirationForDashboard_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeDocuments;
        }


        public List<Employee> GetEmployeesWithExitDateForDashboard_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithExitDateForDashboard_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Employee employee = new Employee();
                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            employee.FirstName = Convert.ToString(reader["FirstName"]);
                            employee.LastName = Convert.ToString(reader["LastName"]);

                            employee.ExitDate = Convert.ToDateTime(reader["ExitDate"]);

                            employees.Add(employee);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesWithExitDateForDashboard_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }

        public List<EmployeeContractSituation> GetLatestContractExpirationForDashboard_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeContractSituation> employeeContracts = new List<EmployeeContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeesWithLatestContractExpiration_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            EmployeeContractSituation employeeContract = new EmployeeContractSituation();

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeContract.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeContract.Employee = new Employee();
                                employeeContract.Employee.IdEmployee = employeeContract.IdEmployee;
                                employeeContract.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeContract.Employee.LastName = Convert.ToString(reader["LastName"]);
                            }

                            if (reader["ExpirationDate"] != DBNull.Value)
                                employeeContract.ContractSituationEndDate = Convert.ToDateTime(reader["ExpirationDate"]);

                            employeeContracts.Add(employeeContract);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetLatestContractExpirationForDashboard_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContracts;
        }


        public List<Employee> GetEmployeesWithAnniversaryDate_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {

            List<Employee> employees = new List<Employee>();
            List<Employee> employeesCompletedyears = new List<Employee>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractSituationsByYear_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_Year", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_CompanyIds", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {

                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])))
                                    {
                                        employee = employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).FirstOrDefault();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                    }
                                    else
                                    {
                                        employee = new Employee();
                                        employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        employee.FirstName = Convert.ToString(reader["FirstName"]);
                                        employee.LastName = Convert.ToString(reader["LastName"]);
                                        employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                        employees.Add(employee);
                                    }
                                }
                            }
                        }

                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesWithAnniversaryDate_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (Employee employee in employees)
            {

                if (employee.EmployeeContractSituations != null)
                {
                    for (int i = 1; i <= 12; i++)
                    {
                        for (DateTime currentDate = new DateTime(Convert.ToInt32(selectedPeriod), i, 1); currentDate.Month == i; currentDate = currentDate.AddDays(1))
                        {

                            employee.LengthOfServiceString = CalculateLengthOfServiceByDate(employee.EmployeeContractSituations, currentDate);

                            if (employee.LengthOfServiceString != null && Convert.ToInt64(employee.LengthOfServiceString) > 0)
                            {
                                employee.BirthDate = currentDate;
                                employee.DateOfBirth = currentDate;
                                employee.LengthOfService = Convert.ToInt32(employee.LengthOfServiceString);
                                employeesCompletedyears.Add(employee);
                                break;
                            }
                        }
                        if (employee.LengthOfService > 0)
                        {
                            break;
                        }
                    }
                }
            }

            return employeesCompletedyears;


        }

        public List<Department> GetAllEmployeesForOrganizationByIdCompany_V2041(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<JobDescription> jobDescriptions = GetAllJobDescriptions(workbenchConnectionString);

            List<Employee> emp = new List<Employee>();
            emp = GetAllEmployeeOfJobDescription_V2041(workbenchConnectionString, idCompany, employeesProfileImagePath, selectedPeriod, idsOrganization, idsDepartment, idPermission);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForOrganizationByIdCompany_V2041", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (reader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    }
                                }

                                if (reader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(reader["LengthOfService"]);
                                }

                                if (reader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmployeeJobCodes = Convert.ToString(reader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (reader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(reader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                    }

                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {

                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {

                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);

                                    }
                                }


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (Employee itememp in employees)
            {

                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            var grouppJD = emp.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdJobDescription);

            foreach (var item in grouppJD)
            {
                JobDescription jobDescription = jobDescriptions.Where(x => x.IdJobDescription == item.Key).FirstOrDefault();
                jobDescription.Employees = new List<Employee>();
                jobDescription.Employees.AddRange(item.ToList());
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);



            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(o => o.EmployeeJobDescription.JobDescription.JobDescriptionCode).ThenBy(o => o.FullName).ToList());
            }

            foreach (Department dept in departments)
            {
                dept.JobDescriptions = jobDescriptions.Where(x => x.IdDepartment == dept.IdDepartment).ToList();
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }


        public List<Department> GetAllEmployeesForOrganizationByIdCompany_V2050(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<JobDescription> jobDescriptions = GetAllJobDescriptions_V2046(workbenchConnectionString);

            List<Employee> emp = new List<Employee>();
            emp = GetAllEmployeeOfJobDescription_V2050(workbenchConnectionString, idCompany, employeesProfileImagePath, selectedPeriod, idsOrganization, idsDepartment, idPermission);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForOrganizationByIdCompany_V2050", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["JobDescriptionInUse"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                                    if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (reader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    }
                                }

                                if (reader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(reader["LengthOfService"]);
                                }

                                if (reader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmployeeJobCodes = Convert.ToString(reader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (reader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(reader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                    }

                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {

                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {

                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);

                                    }
                                }


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (Employee itememp in employees)
            {

                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            var grouppJD = emp.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdJobDescription);

            foreach (var item in grouppJD)
            {
                JobDescription jobDescription = jobDescriptions.Where(x => x.IdJobDescription == item.Key).FirstOrDefault();
                jobDescription.Employees = new List<Employee>();
                jobDescription.Employees.AddRange(item.ToList());
            }

            var groupp = employees.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdDepartment);



            foreach (var item in groupp)
            {
                Department dept = departments.FirstOrDefault(x => x.IdDepartment == item.First().EmployeeJobDescription.JobDescription.IdDepartment);
                dept.Employees = new List<Employee>();
                dept.Employees.AddRange(item.OrderBy(o => o.EmployeeJobDescription.JobDescription.JobDescriptionCode).ThenBy(o => o.FullName).ToList());
            }

            foreach (Department dept in departments)
            {
                dept.JobDescriptions = jobDescriptions.Where(x => x.IdDepartment == dept.IdDepartment).ToList();
            }

            //002
            departments.RemoveAll(x => x.Employees == null);

            Department department = new Department();
            department.DepartmentName = "ALL";
            department.DepartmentPosition = "1";
            department.DepartmentInUse = 1;
            departments.Insert(0, department);

            return departments;
        }

        public List<JobDescription> GetEmployeesForJobDescription(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
           // List<Department> departments = GetAllDepartments(workbenchConnectionString);

            List<JobDescription> jobDescriptions = GetAllJobDescriptionsForIsRemoteInUse(workbenchConnectionString);

            List<Employee> emp = new List<Employee>();
            emp = GetAllEmployeeOfJobDescriptionIsRemoteInUse(workbenchConnectionString, idCompany, employeesProfileImagePath, selectedPeriod, idsOrganization, idsDepartment, idPermission);

            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesForIsRemoteAndInUse", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    //No of years.
                    DateTime zeroTime = new DateTime(1, 1, 1);
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                if (reader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);

                                if (reader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(reader["NativeName"]);

                                if (reader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(reader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (reader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                if (reader["AddressStreet"] != DBNull.Value)
                                {
                                    employee.AddressStreet = Convert.ToString(reader["AddressStreet"]);
                                    employee.FullAddress = employee.AddressStreet;
                                }

                                if (reader["AddressZipCode"] != DBNull.Value)
                                {
                                    employee.AddressZipCode = Convert.ToString(reader["AddressZipCode"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressZipCode;
                                }

                                if (reader["AddressCity"] != DBNull.Value)
                                {
                                    employee.AddressCity = Convert.ToString(reader["AddressCity"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCity;
                                }

                                if (reader["AddressRegion"] != DBNull.Value)
                                {
                                    employee.AddressRegion = Convert.ToString(reader["AddressRegion"]);
                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressRegion;
                                }

                                if (reader["AddressIdCountry"] != DBNull.Value)
                                {
                                    employee.AddressIdCountry = Convert.ToUInt16(reader["AddressIdCountry"]);

                                    employee.AddressCountry = new Country();
                                    employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                    employee.AddressCountry.Name = Convert.ToString(reader["AddressCountry"]);

                                    employee.FullAddress = employee.FullAddress + " - " + employee.AddressCountry.Name;
                                }

                                if (employee.FullAddress.StartsWith(" - "))
                                {
                                    employee.FullAddress = employee.FullAddress.Trim();
                                    employee.FullAddress = employee.FullAddress.Remove(0, 1);
                                }

                                if (reader["SkypeValue"] != DBNull.Value)
                                    employee.EmployeeContactSkype = Convert.ToString(reader["SkypeValue"]);

                                if (reader["emailValue"] != DBNull.Value)
                                    employee.EmployeeContactEmail = Convert.ToString(reader["emailValue"]);

                                if (reader["homePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactHome = Convert.ToString(reader["homePhoneValue"]);

                                if (reader["mobilePhoneValue"] != DBNull.Value)
                                    employee.EmployeeContactMobile = Convert.ToString(reader["mobilePhoneValue"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    EmployeeJobDescription empJobDescription = new EmployeeJobDescription();
                                    empJobDescription.JobDescription = new JobDescription();

                                    empJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                        empJobDescription.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["JobDescriptionCode"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);

                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["JobDescriptionUsage"] != DBNull.Value)
                                        empJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                    if (reader["JobDescriptionInUse"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                                    if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                        empJobDescription.JobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);

                                    if (reader["IdDepartment"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                        empJobDescription.JobDescription.Department = new Department();
                                        empJobDescription.JobDescription.Department.IdDepartment = empJobDescription.JobDescription.IdDepartment;

                                        if (reader["DepartmentName"] != DBNull.Value)
                                            empJobDescription.JobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                                    }

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        empJobDescription.JobDescriptionStartDate = Convert.ToDateTime(reader["HireDate"]);

                                    }

                                    employee.EmployeeJobDescription = empJobDescription;
                                }

                                if (reader["IdContractSituation"] != DBNull.Value)
                                {
                                    employee.ContractSituation = new ContractSituation();
                                    employee.ContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                    employee.ContractSituation.Name = Convert.ToString(reader["ContractSituation"]);

                                    if (reader["HireDate"] != DBNull.Value)
                                    {
                                        employee.ContractSituation.HireDate = Convert.ToDateTime(reader["HireDate"]);

                                    }
                                }

                                if (reader["LengthOfService"] != DBNull.Value)
                                {
                                    employee.LengthOfService = Convert.ToInt32(reader["LengthOfService"]);
                                }

                                if (reader["JobCodes"] != DBNull.Value)
                                {
                                    employee.EmployeeJobCodes = Convert.ToString(reader["JobCodes"]).Split('\n').ToList<string>();
                                }

                                if (reader["JobTitlesWithCompanyAlias"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(reader["JobTitlesWithCompanyAlias"]);

                                    List<String> result = new List<String>(employee.EmployeeJobTitles.Split(new string[] { "\n" }, StringSplitOptions.None));
                                    if (result.Count() > 1)
                                    {
                                        string matchString = null;
                                        bool isDiffPlant = false;
                                        matchString = result[0].Substring(result[0].IndexOf("[") + 1, ((result[0].IndexOf("]")) - (result[0].IndexOf("[") + 1)));
                                        if (string.IsNullOrEmpty(matchString))
                                        {
                                            isDiffPlant = false;
                                        }
                                        else
                                        {
                                            matchString = " [" + matchString + "]";
                                            foreach (string item in result)
                                            {
                                                if (!item.Contains(matchString))
                                                {
                                                    isDiffPlant = true;
                                                    break;
                                                }
                                            }
                                        }

                                        if (isDiffPlant == false)
                                        {
                                            employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                        }

                                    }
                                    else if (result.Count() == 1)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JobTitles"]);
                                    }

                                }

                                employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {

                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {

                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);

                                    }
                                }


                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForOrganizationByIdCompany_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (Employee itememp in employees)
            {

                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            var grouppJD = emp.GroupBy(x => x.EmployeeJobDescription.JobDescription.IdJobDescription);

            foreach (var item in grouppJD)
            {
                JobDescription jobDescription = jobDescriptions.Where(x => x.IdJobDescription == item.Key).FirstOrDefault();
                jobDescription.Employees = new List<Employee>();
                jobDescription.Employees.AddRange(item.ToList());
            }

            //002
            jobDescriptions.RemoveAll(x => x.Employees == null);

            return jobDescriptions;
        }




        public List<Employee> GetAllEmployeeOfJobDescription_V2041(string workbenchConnectionString, string idCompany, string employeesProfileImagePath, Int64 selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeeOfJobDescription_V2041", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_selectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                if (reader["IdParent"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);

                                employee.EmployeeJobDescription.JobDescription.Abbreviation = reader["Abbreviation"].ToString();

                                if (reader["ChildOrientation"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                            employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                }
            }

            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            return employees;
        }

        public List<Employee> GetAllEmployeeOfJobDescription_V2050(string workbenchConnectionString, string idCompany, string employeesProfileImagePath, Int64 selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeeOfJobDescription_V2050", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_selectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                if (reader["IdParent"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);

                                employee.EmployeeJobDescription.JobDescription.Abbreviation = reader["Abbreviation"].ToString();

                                if (reader["ChildOrientation"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.ChildOrientation = reader["ChildOrientation"].ToString();

                                if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);

                                if (reader["JobDescriptionInUse"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionIsRemote"]);
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                            employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                }
            }

            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            return employees;
        }


        public List<Employee> GetAllEmployeeOfJobDescriptionIsRemoteInUse(string workbenchConnectionString, string idCompany, string employeesProfileImagePath, Int64 selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeeOfJobDescriptionForIsRemoteInuse", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_selectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {

                    while (reader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);

                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);

                            if (reader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                            if (reader["IdJobDescription"] != DBNull.Value)
                            {
                                employee.EmployeeJobDescription = new EmployeeJobDescription();
                                employee.EmployeeJobDescription.JobDescription = new JobDescription();
                                employee.EmployeeJobDescription.JobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                if (reader["IdParent"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);

                                employee.EmployeeJobDescription.JobDescription.Abbreviation = reader["Abbreviation"].ToString();

                                if (reader["ChildOrientation"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.ChildOrientation = reader["ChildOrientation"].ToString();

                                if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);

                                if (reader["JobDescriptionInUse"] != DBNull.Value)
                                    employee.EmployeeJobDescription.JobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionIsRemote"]);
                            }

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);
                            employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    foreach (Employee employee in employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).ToList())
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (reader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdContractSituation = Convert.ToUInt16(reader["IdContractSituation"]);
                                        if (reader["ContractSituationFileName"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationFileName = Convert.ToString(reader["ContractSituationFileName"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            employeeContractSituation.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        if (reader["ContractSituationRemarks"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationRemarks = Convert.ToString(reader["ContractSituationRemarks"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["IdProfessionalCategory"] != DBNull.Value)
                                            employeeContractSituation.IdProfessionalCategory = Convert.ToUInt16(reader["IdProfessionalCategory"]);

                                        employee.EmployeeContractSituations.Add(employeeContractSituation);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeeOfJobDescription_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                }
            }

            foreach (Employee itememp in employees)
            {
                itememp.LengthOfServiceString = CalculateLengthOfService(itememp.EmployeeContractSituations);
            }

            return employees;
        }

        public List<JobDescription> GetOrganizationHierarchy_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<JobDescription> jobDescriptions = GetAllJobDescriptionsHeirarchy_V2040(workbenchConnectionString);

            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesOrganizationHierarchy_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                                employeeJobDescription.JobDescription = new JobDescription();
                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeJobDescription.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                if (reader["JobDescriptionUsage"] != DBNull.Value)
                                    employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);

                                employeeJobDescription.Employee = new Employee();
                                employeeJobDescription.Employee.IdEmployee = employeeJobDescription.IdEmployee;
                                employeeJobDescription.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeJobDescription.Employee.LastName = Convert.ToString(reader["LastName"]);
                                employeeJobDescription.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                employeeJobDescriptions.Add(employeeJobDescription);
                            }
                        }
                        employeeJobDescriptions = employeeJobDescriptions.OrderBy(x => x.Employee.FullName).ToList();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOrganizationHierarchy_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (JobDescription jd in jobDescriptions)
            {
                if (employeeJobDescriptions.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    jd.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == jd.IdJobDescription));
                }

                if (jd.ChildJobDescriptions != null)
                {
                    foreach (var itemJD in jd.ChildJobDescriptions)
                    {
                        if (employeeJobDescriptions.Any(x => x.IdJobDescription == itemJD.IdJobDescription))
                        {
                            itemJD.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                            itemJD.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == itemJD.IdJobDescription));
                            jd.IsEmployeeExistInChildJD = true;
                        }
                    }
                }
            }

            jobDescriptions = IsChildJobDescriptionExistEmployee(jobDescriptions);

            return jobDescriptions;
        }

        public List<JobDescription> GetOrganizationHierarchy_V2050(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<JobDescription> jobDescriptions = GetAllJobDescriptionsHeirarchy_V2050(workbenchConnectionString);

            List<EmployeeJobDescription> employeeJobDescriptions = new List<EmployeeJobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllEmployeesOrganizationHierarchy_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                                employeeJobDescription.JobDescription = new JobDescription();
                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    employeeJobDescription.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                                if (reader["JobDescriptionUsage"] != DBNull.Value)
                                    employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);

                                if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                    employeeJobDescription.JobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);

                                employeeJobDescription.Employee = new Employee();
                                employeeJobDescription.Employee.IdEmployee = employeeJobDescription.IdEmployee;
                                employeeJobDescription.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeJobDescription.Employee.LastName = Convert.ToString(reader["LastName"]);
                                employeeJobDescription.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                employeeJobDescriptions.Add(employeeJobDescription);
                            }
                        }
                        employeeJobDescriptions = employeeJobDescriptions.OrderBy(x => x.Employee.FullName).ToList();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOrganizationHierarchy_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (JobDescription jd in jobDescriptions)
            {
                if (employeeJobDescriptions.Any(x => x.IdJobDescription == jd.IdJobDescription))
                {
                    jd.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    jd.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == jd.IdJobDescription));
                }

                if (jd.ChildJobDescriptions != null)
                {
                    foreach (var itemJD in jd.ChildJobDescriptions)
                    {
                        if (employeeJobDescriptions.Any(x => x.IdJobDescription == itemJD.IdJobDescription))
                        {
                            itemJD.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                            itemJD.EmployeeJobDescriptions.AddRange(employeeJobDescriptions.Where(x => x.IdJobDescription == itemJD.IdJobDescription));
                            jd.IsEmployeeExistInChildJD = true;
                        }
                    }
                }
            }

            jobDescriptions = IsChildJobDescriptionExistEmployee(jobDescriptions);

            return jobDescriptions;
        }

        public List<LookupValue> GetOrganizationalChartDepartmentArea_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<LookupValue> departmentAreaList = GetEmployeesCountByDepartmentAreaByIdCompany_V2041(workbenchConnectionString, idCompanies, selectedPeriod, idsOrganization, idsDepartment, idPermission);

            double total = departmentAreaList.Sum(y => Convert.ToDouble(y.Count));
            foreach (LookupValue item in departmentAreaList)
            {
                item.Percentage = Math.Round((item.Count / total) * 100);
            }

            List<LookupValue> departmentAreaAvgList = GetEmployeesAverageByDepartmentAreaByIdCompany_V2041(workbenchConnectionString, idCompanies, selectedPeriod, idsOrganization, idsDepartment, idPermission);

            double totalAvg = Convert.ToDouble(departmentAreaAvgList.Sum(x => x.Average));
            foreach (LookupValue item in departmentAreaAvgList)
            {
                LookupValue lv = departmentAreaList.FirstOrDefault(x => x.IdLookupValue == item.IdLookupValue);

                if (lv != null)
                {
                    //lv.Average = item.Average;
                    lv.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                }
                else
                {
                    item.Percentage = 0;
                    item.Average = Math.Round((double)(item.Average / totalAvg) * 100);
                    departmentAreaList.Add(item);
                }
            }

            return departmentAreaList;
        }

        public List<LookupValue> GetEmployeesAverageByDepartmentAreaByIdCompany_V2041(string workbenchConnectionString, string idCompanies, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<LookupValue> departmentAreaList = new List<LookupValue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmpAvgByDeptAreaByIdCompany_V2041", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompanies", idCompanies);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);


                using (MySqlDataReader reader = empCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            LookupValue lvDepartmentArea = new LookupValue();

                            lvDepartmentArea.IdLookupValue = Convert.ToInt32(reader["IdLookupValue"]);

                            if (reader["Value"] != DBNull.Value)
                                lvDepartmentArea.Value = Convert.ToString(reader["Value"]);

                            if (reader["HtmlColor"] != DBNull.Value)
                                lvDepartmentArea.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                            if (reader["AvgEmployees"] != DBNull.Value)
                                lvDepartmentArea.Average = Convert.ToDouble(reader["AvgEmployees"]);

                            departmentAreaList.Add(lvDepartmentArea);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesAverageByDepartmentAreaByIdCompany_V2033(). ErrorMessage- {0} - {1}", idCompanies, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return departmentAreaList;
        }

        public List<EmployeeOrganizationChart> GetEmployeesForOrganizationChart_V2041(string workbenchConnectionString, Int32 idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeOrganizationChart> employees = new List<EmployeeOrganizationChart>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeesForOrganizationChart_V2041", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                EmployeeOrganizationChart employee = new EmployeeOrganizationChart();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["EmpStatus"] != DBNull.Value)
                                    employee.EmployeeStatus = Convert.ToString(empReader["EmpStatus"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                    employee.HireDate = Convert.ToDateTime(empReader["HireDate"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                }
                                if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                    employee.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                if (empReader["JDCode"] != DBNull.Value)
                                    employee.JDCode = Convert.ToString(empReader["JDCode"]);

                                if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    employee.JobCode = Convert.ToString(empReader["JobDescriptionCode"]);

                                if (empReader["DepartmentName"] != DBNull.Value)
                                    employee.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    employee.JobTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                employee.Organization = Convert.ToString(empReader["CompanyOrganization"]);
                                employee.Company = Convert.ToString(empReader["CompanyContract"]);
                                employee.CompanyLocation = Convert.ToString(empReader["CompanyLocation"]);

                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])))
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                        employees.Where(i => i.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(i => i.EmployeeContractSituations.Add(employeeContractSituation));
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (var itememp in employees.GroupBy(i => i.IdEmployee))
            {
                EmployeeOrganizationChart itememployee = employees.Where(i => i.IdEmployee == itememp.Key).FirstOrDefault();
                if (itememployee.EmployeeContractSituations != null && itememployee.EmployeeContractSituations.Count > 0)
                {
                    // itememp.HireDate = itememp.EmployeeContractSituations.FirstOrDefault().ContractSituationStartDate;
                    itememployee.LengthOfServiceString = CalculateLengthOfService(itememployee.EmployeeContractSituations);
                }
                employees.Where(i => i.IdEmployee == itememp.Key).ToList().ForEach(i => i.LengthOfServiceString = itememployee.LengthOfServiceString);
            }


            Log4NetLogger.Logger.Log("Executed GetEmployeesForOrganizationChart().", category: Category.Info, priority: Priority.Low);
            return employees;
        }


        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2041(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2041", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;


                                    if (empReader["MonBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.MonBreakTime = (TimeSpan)empReader["MonBreakTime"];

                                    if (empReader["TueBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.TueBreakTime = (TimeSpan)empReader["TueBreakTime"];

                                    if (empReader["WedBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.WedBreakTime = (TimeSpan)empReader["WedBreakTime"];

                                    if (empReader["ThuBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.ThuBreakTime = (TimeSpan)empReader["ThuBreakTime"];

                                    if (empReader["FriBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.FriBreakTime = (TimeSpan)empReader["FriBreakTime"];

                                    if (empReader["SatBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SatBreakTime = (TimeSpan)empReader["SatBreakTime"];

                                    if (empReader["SunBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SunBreakTime = (TimeSpan)empReader["SunBreakTime"];

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                                }
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                    if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                    Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                    employee.EmployeeContractSituations.Add(employeeContractSituation);
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }

        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2041(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2041", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["AccountingDate"] != DBNull.Value)
                                {
                                    employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employeeAttendances;
        }

        public List<EmployeeAttendance> GetEmployeeAttendanceForNewLeave(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2041", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                   // employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["AccountingDate"] != DBNull.Value)
                                {
                                    employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeAttendanceForNewLeave(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employeeAttendances;
        }


        public List<JobDescription> GetEmployeeLatestJobDescriptionsByIdEmployee_V2041(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetEmployeeLatestJobDescriptionsByIdEmployee_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                jobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"]);
                                jobDescription.JDLevel = new LookupValue();
                                jobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"]);
                                if (reader["JDLevel"] != DBNull.Value)
                                    jobDescription.JDLevel.Value = Convert.ToString(reader["JDLevel"]);
                                if (reader["JDLevelHtmlColor"] != DBNull.Value)
                                    jobDescription.JDLevel.HtmlColor = Convert.ToString(reader["JDLevelHtmlColor"]);
                                if (reader["JDLevelIdImage"] != DBNull.Value)
                                    jobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDLevelIdImage"]);
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                            {
                                jobDescription.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);
                                if (reader["IsMainJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IsMainJobDescription = Convert.ToByte(reader["IsMainJobDescription"]);

                                jobDescription.EmployeeJobDescriptions.Add(employeeJobDescription);
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                            }


                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLatestJobDescriptionsByIdEmployee_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }



        public List<Employee> GetEmpDtlByEmpDocNoAndPeriod_V2041(string workbenchConnectionString, string EmployeeDocumentNumbers, string idCompany, Int64 selectedPeriod)
        {
            List<Employee> employees = new List<Employee>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmpDtlByEmpDocNoAndPeriod_V2041", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_EmployeeDocumentNumber", EmployeeDocumentNumbers);
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employee.LastName = Convert.ToString(reader["LastName"]);
                                    employee.EmployeeDocument = new EmployeeDocument();
                                    employee.EmployeeDocument.EmployeeDocumentNumber = Convert.ToString(reader["EmployeeDocumentNumber"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                        employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                        employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }

                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                        employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);
                                        string[] LstCompanyIds = employee.EmployeeCompanyIds.Split('\n');
                                        employee.EmployeeCompanyIds = string.Join("\n", LstCompanyIds.Distinct());
                                    }

                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employee.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employee.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employee.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["IdCompanyAnnualSchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = Convert.ToInt32(reader["IdCompanyAnnualSchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WeeklyHoursCount = Convert.ToDecimal(reader["WeeklyHoursCount"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);
                                        employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }

                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation = new EmployeeContractSituation();
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }

                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                        if (reader.NextResult())
                            while (reader.Read())
                            {

                                try
                                {
                                    if (reader["IdEmployee"] != DBNull.Value)
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                        employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                        if (reader["IdCompany"] != DBNull.Value)
                                            employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                        foreach (var item in employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).ToList())
                                        {
                                            item.EmployeeContractSituations.Add(employeeContractSituation);
                                        }
                                    }

                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmpDtlByEmpDocNoAndPeriod_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employees;
        }


        public List<Employee> GetAllEmployeesForLeaveByIdCompany_V2041(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForLeaveByIdCompany_V2041", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);


                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                    employee.DateOfBirth = employee.BirthDate;
                                }

                                if (empReader["Disability"] != DBNull.Value)
                                    employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                                if (empReader["IsEnabled"] != DBNull.Value)
                                    employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                                if (empReader["Remarks"] != DBNull.Value)
                                    employee.Remarks = Convert.ToString(empReader["Remarks"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }


                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }

                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee_V2038(workbenchConnectionString, employee.IdEmployee, selectedPeriod, idCompany);

                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForLeaveByIdCompany_V2039(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            return employees;
        }



        public List<EmployeeLeave> GetUpcomingEmployeeLeaves_V2044(string workbenchConnectionString, Int32 idCompany, ref List<string> ToEmailList, ref List<string> ccEmailList, DateTime? currentDate = null)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetUpcomingEmployeeLeaves_V2044", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["StartDate"] != DBNull.Value && reader["EndDate"] != DBNull.Value)
                                {
                                    DateTime start = Convert.ToDateTime(reader["StartDate"]);
                                    DateTime end = Convert.ToDateTime(reader["EndDate"]);

                                    for (var day = start.Date; day.Date <= end.Date; day = day.AddDays(1))
                                    {
                                        int result = DateTime.Compare(day, DateTime.Now.Date);

                                        if (result < 0)        //day is the earlier than today
                                        {
                                            continue;
                                        }

                                        EmployeeLeave employeeLeave = new EmployeeLeave();

                                        if (reader["IdEmployeeLeave"] != DBNull.Value)
                                            employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                        if (reader["IdLeave"] != DBNull.Value)
                                        {
                                            employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                            employeeLeave.CompanyLeave = new CompanyLeave();
                                            employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                            employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                        }

                                        if (reader["IdEmployee"] != DBNull.Value)
                                        {
                                            employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                            employeeLeave.Employee = new Employee();
                                            employeeLeave.Employee.IdEmployee = employeeLeave.IdEmployee;
                                            employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                            employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);
                                        }

                                        TimeSpan startSpan = TimeSpan.Zero;
                                        TimeSpan endSpan = TimeSpan.Zero;

                                        if (reader["IsAllDayEvent"] != DBNull.Value)
                                        {
                                            employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                                            if (employeeLeave.IsAllDayEvent == 1)
                                            {
                                                if (reader["IdCompanyShift"] != DBNull.Value)
                                                {
                                                    if (reader["StartTime1"] != DBNull.Value)
                                                        startSpan = (TimeSpan)(reader["StartTime1"]);

                                                    if (reader["EndTime1"] != DBNull.Value)
                                                        endSpan = (TimeSpan)(reader["EndTime1"]);
                                                }
                                                else
                                                {
                                                    startSpan = start.TimeOfDay;
                                                    endSpan = end.TimeOfDay;
                                                }
                                            }
                                            else
                                            {
                                                startSpan = start.TimeOfDay;
                                                endSpan = end.TimeOfDay;
                                            }
                                        }

                                        employeeLeave.StartDate = day.Add(startSpan);
                                        employeeLeave.EndDate = day.Add(endSpan);

                                        if (employeeLeave.StartDate.Value.DayOfWeek == DayOfWeek.Saturday || employeeLeave.StartDate.Value.DayOfWeek == DayOfWeek.Sunday)
                                        {
                                            //No need to add SAT and SUN
                                        }
                                        else if (result == 0)        //day is the same time as today
                                        {
                                            employeeLeaves.Add(employeeLeave);
                                        }
                                        else if (result > 0 && (day - DateTime.Now.Date).TotalDays <= 6)    //day is later than today & <= 7 days
                                        {
                                            employeeLeaves.Add(employeeLeave);
                                        }
                                    }
                                }
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                try
                                {
                                    if (reader["Emails"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(reader["Emails"])))
                                    {
                                        if (Convert.ToUInt32(reader["IdJobDescription"]) == 21)
                                            ToEmailList.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                        else if (Convert.ToUInt32(reader["IdJobDescription"]) == 42)
                                            ccEmailList.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingEmployeeLeaves_V2044(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }

                            ToEmailList = ToEmailList.Distinct().OrderBy(q => q).ToList();
                            ccEmailList = ccEmailList.Distinct().OrderBy(q => q).ToList();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingEmployeeLeaves_V2044(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }


        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2044(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2044", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    if (reader.NextResult())
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["AccountingDate"] != DBNull.Value)
                                {
                                    employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }
                                   
                                        if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {
                                        
                                            employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                            //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                            string span = employeeAttendance.Employee.TotalWorkedHours;
                                            employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                       int.Parse(span.Split(':')[1]),    // minutes
                                                                       0);
                                        }
                                       
                                    
                                     
                                        

                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }


                                employeeAttendance.Employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2044(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    if (reader.NextResult())
                        while (reader.Read())
                        {

                            try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeContractSituation.Company = new Company();
                                    if (reader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                    if (reader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                    if (reader["Alias"] != DBNull.Value)
                                        employeeContractSituation.Company.Alias = Convert.ToString(reader["Alias"]);

                                     employeeAttendances.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(ea=>ea.Employee.EmployeeContractSituations.Add(employeeContractSituation));
                                   
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2044(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }
            employeeAttendances.ToList().ForEach(ea => ea.CurrentContractForAttendance = ea.Employee.EmployeeContractSituations != null ? ea.Employee.EmployeeContractSituations.Where(ecs => ecs.ContractSituationStartDate.Value.Date <= ea.StartDate.Date).Select(i => i.Company.Alias).LastOrDefault():"");

            return employeeAttendances;
        }

        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2044(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2044", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;


                                    if (empReader["MonBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.MonBreakTime = (TimeSpan)empReader["MonBreakTime"];

                                    if (empReader["TueBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.TueBreakTime = (TimeSpan)empReader["TueBreakTime"];

                                    if (empReader["WedBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.WedBreakTime = (TimeSpan)empReader["WedBreakTime"];

                                    if (empReader["ThuBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.ThuBreakTime = (TimeSpan)empReader["ThuBreakTime"];

                                    if (empReader["FriBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.FriBreakTime = (TimeSpan)empReader["FriBreakTime"];

                                    if (empReader["SatBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SatBreakTime = (TimeSpan)empReader["SatBreakTime"];

                                    if (empReader["SunBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SunBreakTime = (TimeSpan)empReader["SunBreakTime"];

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);


                                }
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2044(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        {

                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);
                                    employeeContractSituation.Company = new Company();
                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                    if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                    if (empReader["Alias"] != DBNull.Value)
                                        employeeContractSituation.Company.Alias = Convert.ToString(empReader["Alias"]);

                                    Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                    employee.EmployeeContractSituations.Add(employeeContractSituation);
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2044(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }

        public List<JobDescription> GetEmployeeLatestJobDescriptionsByIdEmployee_V2045(string workbenchConnectionString, Int32 idEmployee, Int64 selectedPeriod)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetEmployeeLatestJobDescriptionsByIdEmployee_V2045", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                jobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"]);
                                jobDescription.JDLevel = new LookupValue();
                                jobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"]);
                                if (reader["JDLevel"] != DBNull.Value)
                                    jobDescription.JDLevel.Value = Convert.ToString(reader["JDLevel"]);
                                if (reader["JDLevelHtmlColor"] != DBNull.Value)
                                    jobDescription.JDLevel.HtmlColor = Convert.ToString(reader["JDLevelHtmlColor"]);
                                if (reader["JDLevelIdImage"] != DBNull.Value)
                                    jobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDLevelIdImage"]);
                            }

                            if (reader["JobDescriptionUsage"] != DBNull.Value)
                            {
                                jobDescription.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                                EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                                employeeJobDescription.JobDescriptionUsage = Convert.ToUInt16(reader["JobDescriptionUsage"]);
                                if (reader["IsMainJobDescription"] != DBNull.Value)
                                    employeeJobDescription.IsMainJobDescription = Convert.ToByte(reader["IsMainJobDescription"]);

                                jobDescription.EmployeeJobDescriptions.Add(employeeJobDescription);
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);
                            }


                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLatestJobDescriptionsByIdEmployee_V2041(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2045(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();
            DataSet dataSet = new DataSet();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2045", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);
                MySqlDataAdapter da = new MySqlDataAdapter(mySqlCommand);
                da.Fill(dataSet);
            }


            if (dataSet != null && dataSet.Tables.Count > 0)
            {
                if (dataSet.Tables[1] != null && dataSet.Tables[1].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[1].Rows)
                    {
                          try
                            {
                                EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                                if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                    employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["AccountingDate"] != DBNull.Value)
                                {
                                    employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                                }

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    employeeAttendance.Employee = new Employee();
                                    employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                    employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                    employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                    employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                        employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                        employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }

                                    if (reader["companiesIds"] != DBNull.Value)
                                    {
                                        employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                    }

                                    if (reader["TotalWorkedHours"] != DBNull.Value)
                                    {

                                        employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                        //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                        string span = employeeAttendance.Employee.TotalWorkedHours;
                                        employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                                   int.Parse(span.Split(':')[1]),    // minutes
                                                                   0);
                                    }





                                    if (reader["IdCompanyWork"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                        employeeAttendance.CompanyWork = new CompanyWork();
                                        employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                        //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                        employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                    }

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                    {
                                        employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                        employeeAttendance.CompanyShift = new CompanyShift();
                                        employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                        if (reader["IsNightShift"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                        if (reader["CompanyShiftName"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                        employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                        employeeAttendance.CompanyShift.CompanySchedule = new CompanySchedule();
                                        employeeAttendance.CompanyShift.CompanySchedule.Company = new Company();
                                        if (reader["ScheduleAlias"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanySchedule.Company.Alias= Convert.ToString(reader["ScheduleAlias"]);


                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["empContractIdCompany"] != DBNull.Value)
                                {
                                    employeeAttendance.CompanyContract = new Company();
                                    employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                    employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                                }


                                employeeAttendance.Employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employeeAttendances.Add(employeeAttendance);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                if (dataSet.Tables[2] != null && dataSet.Tables[2].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[2].Rows)
                    {

                        try
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeContractSituation.Company = new Company();
                                    if (reader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                    if (reader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                    if (reader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                    if (reader["Alias"] != DBNull.Value)
                                        employeeContractSituation.Company.Alias = Convert.ToString(reader["Alias"]);

                                    employeeAttendances.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(ea => ea.Employee.EmployeeContractSituations.Add(employeeContractSituation));

                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
           
            employeeAttendances.ToList().ForEach(ea => ea.CurrentContractForAttendance = ea.Employee.EmployeeContractSituations != null ? ea.Employee.EmployeeContractSituations.Where(ecs => ecs.ContractSituationStartDate.Value.Date <= ea.StartDate.Date).Select(i => i.Company.Alias).LastOrDefault() : "");

            return employeeAttendances;
        }

        public List<EmployeeAttendance> GetEmployeeAttendanceShortDetail(string workbenchConnectionString, string idCompany, string idsOrganization, string idsDepartment, Int32 idPermission,DateTime fromDate,DateTime toDate)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();
            DataSet dataSet = new DataSet();
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAttendanceShortDetail", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);
                mySqlCommand.Parameters.AddWithValue("_fromDate", fromDate);
                mySqlCommand.Parameters.AddWithValue("_toDate", toDate);
                MySqlDataAdapter da = new MySqlDataAdapter(mySqlCommand);
                da.Fill(dataSet);
            }


            if (dataSet != null && dataSet.Tables.Count > 0)
            {
                if (dataSet.Tables[1] != null && dataSet.Tables[1].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[1].Rows)
                    {
                        try
                        {
                            EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                            if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                            }

                            if (reader["AccountingDate"] != DBNull.Value)
                            {
                                employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                            }

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeAttendance.Employee = new Employee();
                                employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["JDCodes"] != DBNull.Value)
                                {

                                    employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                    string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                    employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (reader["JDTitles"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                    string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                    employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (reader["DeptNames"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }


                                if (reader["companies"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                    string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                    employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }

                                if (reader["companiesIds"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                }

                                if (reader["TotalWorkedHours"] != DBNull.Value)
                                {

                                    employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                    //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                    string span = employeeAttendance.Employee.TotalWorkedHours;
                                    employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                               int.Parse(span.Split(':')[1]),    // minutes
                                                               0);
                                }





                                if (reader["IdCompanyWork"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                    employeeAttendance.CompanyWork = new CompanyWork();
                                    employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                    //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                    employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeAttendance.CompanyShift = new CompanyShift();
                                    employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;

                                    if (reader["BreakTime"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["CompanyShiftName"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeAttendance.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employeeAttendance.CompanyShift.CompanySchedule.Company = new Company();
                                    if (reader["ScheduleAlias"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["ScheduleAlias"]);


                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                    if (reader["DailyHoursCount"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                    if (reader["Year"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                    if (reader["WorkingDays"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                }
                            }

                            if (reader["empContractIdCompany"] != DBNull.Value)
                            {
                                employeeAttendance.CompanyContract = new Company();
                                employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                            }


                            employeeAttendance.Employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employeeAttendances.Add(employeeAttendance);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                if (dataSet.Tables[2] != null && dataSet.Tables[2].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[2].Rows)
                    {

                        try
                        {
                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeContractSituation.Company = new Company();
                                if (reader["IdCompany"] != DBNull.Value)
                                    employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                if (reader["ContractSituationStartDate"] != DBNull.Value)
                                    employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                if (reader["ContractSituationEndDate"] != DBNull.Value)
                                    employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                if (reader["Alias"] != DBNull.Value)
                                    employeeContractSituation.Company.Alias = Convert.ToString(reader["Alias"]);

                                employeeAttendances.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(ea => ea.Employee.EmployeeContractSituations.Add(employeeContractSituation));

                            }

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
            }

            employeeAttendances.ToList().ForEach(ea => ea.CurrentContractForAttendance = ea.Employee.EmployeeContractSituations != null ? ea.Employee.EmployeeContractSituations.Where(ecs => ecs.ContractSituationStartDate.Value.Date <= ea.StartDate.Date).Select(i => i.Company.Alias).LastOrDefault() : "");

            return employeeAttendances;
        }

        /// <summary>
        ///  [001][2020-07-25][cpatil] GEOS2-2452 The email notifications from HRM are sent also to the users with Inactive status.
        /// </summary>
        /// <param name="workbenchConnectionString"></param>
        /// <param name="employeesProfileImagePath"></param>
        /// <param name="selectedPeriod"></param>
        /// <param name="currentDate"></param>
        /// <returns></returns>
        public List<Employee> GetTodayBirthdayOfEmployees_V2045(string workbenchConnectionString, string employeesProfileImagePath, long selectedPeriod = 0, DateTime? currentDate = null)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetTodayBirthdayOfEmployees_V2045", mySqlConnection);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeJDByIdEmployee", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

               
                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    while (empReader.Read())
                    {
                        try
                        {
                            Employee employee = new Employee();

                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);

                            if (empReader["Birthday"] != DBNull.Value)
                                employee.DateOfBirth = Convert.ToDateTime(empReader["Birthday"]);

                            if (empReader["IdGender"] != DBNull.Value)
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                            if (empReader["CompanyEmails"] != DBNull.Value)
                                employee.EmployeeContactEmail = Convert.ToString(empReader["CompanyEmails"]);

                            employee.ProfileImageInBytes = GetEmployeeImage(employee.EmployeeCode, employeesProfileImagePath);

                            employees.Add(employee);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetTodayBirthdayOfEmployees_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }

                foreach (Employee employee in employees)
                {
                    employee.EmployeeJobDescriptions = new List<EmployeeJobDescription>();
                    mySqlCommand.Parameters.Clear();
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                EmployeeJobDescription ejd = new EmployeeJobDescription();

                                if (reader["IdEmployeeJobDescription"] != DBNull.Value)
                                    ejd.IdEmployeeJobDescription = Convert.ToUInt64(reader["IdEmployeeJobDescription"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                    ejd.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                if (reader["IdCompany"] != DBNull.Value)
                                {
                                    ejd.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    ejd.Company = new Company();
                                    ejd.Company.IdCompany = ejd.IdCompany;
                                    ejd.Company.Name = Convert.ToString(reader["Name"]);
                                    ejd.Company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);
                                }

                                if (reader["IdJobDescription"] != DBNull.Value)
                                {
                                    ejd.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);
                                    ejd.JobDescription = new JobDescription();
                                    ejd.JobDescription.IdJobDescription = ejd.IdJobDescription;
                                    ejd.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                    if (reader["IdJobDescription"] != DBNull.Value)
                                        ejd.JobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);
                                }

                                employee.EmployeeJobDescriptions.Add(ejd);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetTodayBirthdayOfEmployees_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }

                    employee.EmployeeContactCompanyEmailList = new List<string>();

                }
            }

            return employees;
        }


        /// <summary>
        /// [001][2020-07-25][cpatil] GEOS2-2452 The email notifications from HRM are sent also to the users with Inactive status.
        /// [001] The upcoming company holidays.
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="emails">The emails list.</param>
        /// <returns>The list of company holidays.</returns>
        public List<CompanyHoliday> GetUpcomingCompanyHolidays_V2045(string workbenchConnectionString, ref List<string> emails, DateTime? currentDate = null)
        {
            List<CompanyHoliday> companyHolidays = new List<CompanyHoliday>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetUpcomingCompanyHolidays_V2045", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["StartDate"] != DBNull.Value && reader["EndDate"] != DBNull.Value)
                                {
                                    DateTime start = Convert.ToDateTime(reader["StartDate"]).Date;
                                    DateTime end = Convert.ToDateTime(reader["EndDate"]).Date;

                                    for (var day = start.Date; day.Date <= end.Date; day = day.AddDays(1))
                                    {
                                        int result = DateTime.Compare(day, DateTime.Now.Date);

                                        if (result < 0)        //day is the earlier than today
                                        {
                                            continue;
                                        }

                                        CompanyHoliday companyHoliday = new CompanyHoliday();

                                        if (reader["IdCompanyHoliday"] != DBNull.Value)
                                            companyHoliday.IdCompanyHoliday = Convert.ToUInt64(reader["IdCompanyHoliday"]);

                                        if (reader["IdCompany"] != DBNull.Value)
                                        {
                                            companyHoliday.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                            companyHoliday.Company = new Company();
                                            companyHoliday.Company.IdCompany = companyHoliday.IdCompany;

                                            if (reader["CompanyName"] != DBNull.Value)
                                                companyHoliday.Company.Name = Convert.ToString(reader["CompanyName"]);

                                            if (reader["Alias"] != DBNull.Value)
                                                companyHoliday.Company.Alias = Convert.ToString(reader["Alias"]);

                                            if (reader["TimeZoneIdentifier"] != DBNull.Value)
                                                companyHoliday.Company.TimeZoneIdentifier = Convert.ToString(reader["TimeZoneIdentifier"]);
                                        }

                                        if (reader["HolidayName"] != DBNull.Value)
                                            companyHoliday.Name = Convert.ToString(reader["HolidayName"]);

                                        if (reader["IdHoliday"] != DBNull.Value)
                                            companyHoliday.IdHoliday = Convert.ToInt32(reader["IdHoliday"]);

                                        if (reader["IsRecursive"] != DBNull.Value)
                                            companyHoliday.IsRecursive = Convert.ToByte(reader["IsRecursive"]);

                                        companyHoliday.StartDate = day;
                                        companyHoliday.EndDate = day;

                                        if (result == 0)        //day is the same time as today
                                        {
                                            companyHolidays.Add(companyHoliday);
                                        }
                                        else if (result > 0 && (day - DateTime.Now.Date).TotalDays <= 7)    //day is later than today & <= 7 days
                                        {
                                            companyHolidays.Add(companyHoliday);
                                        }
                                    }
                                }
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                try
                                {
                                    if (reader["Emails"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(reader["Emails"])))
                                    {
                                        emails.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingCompanyHolidays_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }

                            emails = emails.Distinct().OrderBy(q => q).ToList();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingCompanyHolidays_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return companyHolidays;
        }

        public List<EmployeeLeave> GetUpcomingEmployeeLeaves_V2045(string workbenchConnectionString, Int32 idCompany, ref List<string> ToEmailList, ref List<string> ccEmailList, DateTime? currentDate = null)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetUpcomingEmployeeLeaves_V2045", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);


                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                if (reader["StartDate"] != DBNull.Value && reader["EndDate"] != DBNull.Value)
                                {
                                    DateTime start = Convert.ToDateTime(reader["StartDate"]);
                                    DateTime end = Convert.ToDateTime(reader["EndDate"]);

                                    for (var day = start.Date; day.Date <= end.Date; day = day.AddDays(1))
                                    {
                                        int result = DateTime.Compare(day, DateTime.Now.Date);

                                        if (result < 0)        //day is the earlier than today
                                        {
                                            continue;
                                        }

                                        EmployeeLeave employeeLeave = new EmployeeLeave();

                                        if (reader["IdEmployeeLeave"] != DBNull.Value)
                                            employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                        if (reader["IdLeave"] != DBNull.Value)
                                        {
                                            employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                            employeeLeave.CompanyLeave = new CompanyLeave();
                                            employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                            employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                        }

                                        if (reader["IdEmployee"] != DBNull.Value)
                                        {
                                            employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                            employeeLeave.Employee = new Employee();
                                            employeeLeave.Employee.IdEmployee = employeeLeave.IdEmployee;
                                            employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                            employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);
                                        }

                                        TimeSpan startSpan = TimeSpan.Zero;
                                        TimeSpan endSpan = TimeSpan.Zero;

                                        if (reader["IsAllDayEvent"] != DBNull.Value)
                                        {
                                            employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                                            if (employeeLeave.IsAllDayEvent == 1)
                                            {
                                                if (reader["IdCompanyShift"] != DBNull.Value)
                                                {
                                                    if (reader["StartTime1"] != DBNull.Value)
                                                        startSpan = (TimeSpan)(reader["StartTime1"]);

                                                    if (reader["EndTime1"] != DBNull.Value)
                                                        endSpan = (TimeSpan)(reader["EndTime1"]);
                                                }
                                                else
                                                {
                                                    startSpan = start.TimeOfDay;
                                                    endSpan = end.TimeOfDay;
                                                }
                                            }
                                            else
                                            {
                                                startSpan = start.TimeOfDay;
                                                endSpan = end.TimeOfDay;
                                            }
                                        }

                                        employeeLeave.StartDate = day.Add(startSpan);
                                        employeeLeave.EndDate = day.Add(endSpan);

                                        if (employeeLeave.StartDate.Value.DayOfWeek == DayOfWeek.Saturday || employeeLeave.StartDate.Value.DayOfWeek == DayOfWeek.Sunday)
                                        {
                                            //No need to add SAT and SUN
                                        }
                                        else if (result == 0)        //day is the same time as today
                                        {
                                            employeeLeaves.Add(employeeLeave);
                                        }
                                        else if (result > 0 && (day - DateTime.Now.Date).TotalDays <= 6)    //day is later than today & <= 7 days
                                        {
                                            employeeLeaves.Add(employeeLeave);
                                        }
                                    }
                                }
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                try
                                {
                                    if (reader["Emails"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(reader["Emails"])))
                                    {
                                        if (Convert.ToUInt32(reader["IdJobDescription"]) == 21)
                                            ToEmailList.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                        else if (Convert.ToUInt32(reader["IdJobDescription"]) == 42)
                                            ccEmailList.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingEmployeeLeaves_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }

                            ToEmailList = ToEmailList.Distinct().OrderBy(q => q).ToList();
                            ccEmailList = ccEmailList.Distinct().OrderBy(q => q).ToList();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetUpcomingEmployeeLeaves_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        /// <summary>
        /// This method is to get today employee company anniversaries
        /// </summary>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeesProfileImagePath">Get employee image file path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="currentDate">Get current date</param>
        /// <returns>List of employee details</returns>
        public List<Employee> GetTodayEmployeeCompanyAnniversaries_V2045(string workbenchConnectionString, string employeesProfileImagePath, long selectedPeriod, DateTime? currentDate = null)
        {
          

            List<Employee> employees = new List<Employee>();
            List<Employee> employeesCompletedyears = new List<Employee>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractSituationsByDate_V2045", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                Employee employee = new Employee();
                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])))
                                    {
                                        employee = employees.Where(i => i.IdEmployee == Convert.ToInt32(reader["IdEmployee"])).FirstOrDefault();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                    }
                                    else
                                    {
                                        employee = new Employee();
                                        employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                        EmployeeContractSituation ecs = new EmployeeContractSituation();
                                        ecs.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                        if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                            ecs.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);
                                        if (reader["ContractSituationStartDate"] != DBNull.Value)
                                            ecs.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                                        if (reader["ContractSituationEndDate"] != DBNull.Value)
                                            ecs.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);
                                        employee.EmployeeContractSituations.Add(ecs);
                                        employees.Add(employee);
                                    }
                                }
                            }
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetTodayEmployeeCompanyAnniversaries_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (Employee employee in employees)
            {

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfServiceByDate(employee.EmployeeContractSituations, currentDate.Value);

                if (employee.LengthOfServiceString != null && Convert.ToInt64(employee.LengthOfServiceString) > 0)
                {
                    employee.LengthOfService = Convert.ToInt32(employee.LengthOfServiceString);
                    employeesCompletedyears.Add(employee);
                }

            }
            List<Employee> companyAnniversaryEmployees = new List<Employee>();
            companyAnniversaryEmployees = GetTodayEmployeeCompanyAnniversariesDetails(workbenchConnectionString, employeesProfileImagePath, employeesCompletedyears, currentDate.Value);
            return companyAnniversaryEmployees;
        }


        public Tuple<List<Employee>, Employee> GetEmployeeForWelcomeBoard_V2045(string workbenchConnectionString, string employeesProfileImagePath)
        {
            List<Employee> employees = new List<Employee>();
            Employee welcomeBoardInformer = new Employee();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeForWelcomeBoard_V2045", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {

                        while (reader.Read())
                        {
                            Employee employee = new Employee();

                            if (reader["IdEmployee"] != DBNull.Value)
                                employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                            if (reader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                            if (reader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(reader["FirstName"]);
                            if (reader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(reader["LastName"]);
                            if (reader["ContractSituationStartDate"] != DBNull.Value)
                            {
                                employee.ContractSituation = new ContractSituation();
                                employee.ContractSituation.HireDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);
                            }
                            if (reader["EmpDepartments"] != DBNull.Value)
                            {

                                List<string> LstDepartments = new List<string>();

                                LstDepartments = Convert.ToString(reader["EmpDepartments"]).Split('\n').ToList<string>();

                                employee.EmployeeDepartments = string.Join("\n", LstDepartments.ToList().Distinct().ToList());
                            }
                            if (reader["CompanyEmail"] != DBNull.Value)
                            {
                                employee.EmployeeContactEmail = Convert.ToString(reader["CompanyEmail"]);
                            }
                            employees.Add(employee);
                        }
                        if (reader.NextResult())
                        {
                            if (reader.Read())
                            {
                                if (reader["IdEmployee"] != DBNull.Value)
                                    welcomeBoardInformer.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                if (reader["EmployeeCode"] != DBNull.Value)
                                    welcomeBoardInformer.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                if (reader["FirstName"] != DBNull.Value)
                                    welcomeBoardInformer.FirstName = Convert.ToString(reader["FirstName"]);
                                if (reader["LastName"] != DBNull.Value)
                                    welcomeBoardInformer.LastName = Convert.ToString(reader["LastName"]);
                                if (reader["IdGender"] != DBNull.Value)
                                    welcomeBoardInformer.IdGender = Convert.ToUInt32(reader["IdGender"]);
                                if (reader["JobDescriptionCode"] != DBNull.Value)
                                {
                                    welcomeBoardInformer.EmployeeJobDescription = new EmployeeJobDescription();
                                    welcomeBoardInformer.EmployeeJobDescription.JobDescription = new JobDescription();
                                    welcomeBoardInformer.EmployeeJobDescription.JobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                    if (reader["JobDescriptionTitle"] != DBNull.Value)
                                        welcomeBoardInformer.EmployeeJobDescription.JobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);

                                }

                                welcomeBoardInformer.ProfileImageInBytes = GetEmployeeImage(welcomeBoardInformer.EmployeeCode, employeesProfileImagePath);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeForWelcomeBoard_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            Tuple<List<Employee>, Employee> employeeDaywiseLeaveDetail = null;
            if (employees.Count > 0)
            {
                employeeDaywiseLeaveDetail = Tuple.Create(employees, welcomeBoardInformer);
            }
            else
            {
                employeeDaywiseLeaveDetail = null;
            }


            return employeeDaywiseLeaveDetail;
        }

        /// <summary>
        /// This method is to add employee leaves from list
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server workbench connection string(emdep_geos db.)</param>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="empLeaveAttachment">Get employee leave attachmnent details</param>
        /// <param name="employeeLeaves">Get employee leaves details</param>
        /// <param name="fileInBytes">Get bytes of file</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>List of employee leaves</returns>
        public List<EmployeeLeave> AddEmployeeLeavesFromList_V2045(string mainServerWorkbenchConnectionString, string workbenchConnectionString, string empLeaveAttachment, List<EmployeeLeave> employeeLeaves, byte[] fileInBytes, long selectedPeriod)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLeaveInsert_V2045", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        MySqlCommand mySqlCommandChangelog = new MySqlCommand("Hrm_EmployeeChangelog_Insert", mySqlConnection);
                        mySqlCommandChangelog.CommandType = CommandType.StoredProcedure;

                        foreach (EmployeeLeave employeeLeave in employeeLeaves)
                        {
                           
                            mySqlCommand.Parameters.Clear();
                            mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                            mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                            mySqlCommand.Parameters.AddWithValue("_StartDate", employeeLeave.StartDate);
                            mySqlCommand.Parameters.AddWithValue("_EndDate", employeeLeave.EndDate);
                            mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                            mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                            mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeLeave.IdCompanyShift);

                            employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());
                            //}


                            //Employee Change logs.
                            if (employeeLeave.EmployeeChangelogs != null && employeeLeave.EmployeeChangelogs.Count > 0)
                                foreach (EmployeeChangelog employeeChangelog in employeeLeave.EmployeeChangelogs)
                                {
                                    mySqlCommandChangelog.Parameters.Clear();
                                    mySqlCommandChangelog.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                                    mySqlCommandChangelog.Parameters.AddWithValue("_ChangeLogDatetime", employeeChangelog.ChangeLogDatetime);
                                    mySqlCommandChangelog.Parameters.AddWithValue("_ChangeLogIdUser", employeeChangelog.ChangeLogIdUser);
                                    mySqlCommandChangelog.Parameters.AddWithValue("_ChangeLogChange", employeeChangelog.ChangeLogChange);
                                    mySqlCommandChangelog.ExecuteNonQuery();
                                }
                        }

                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();

                    foreach (EmployeeLeave employeeLeave in employeeLeaves)
                    {
                        if (employeeLeave.Employee == null)
                            employeeLeave.Employee = new Employee();

                        employeeLeave.Employee.CompanyShift = GetCompanyShiftDetailAfterUpdateAdd(employeeLeave.IdCompanyShift, workbenchConnectionString, selectedPeriod); ;

                        if (fileInBytes != null)
                            SaveEmployeeLeaveAttachment(employeeLeave.Employee.EmployeeCode, employeeLeave.IdEmployeeLeave, employeeLeave.FileName, empLeaveAttachment, fileInBytes);

                        employeeLeave.Employee.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                        EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                        employeeJobDescription = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee).LastOrDefault();

                        if (employeeJobDescription != null)
                            employeeLeave.Employee.EmployeeJobDescriptions.Add(employeeJobDescription);

                        string idCompany = "";
                        if (employeeLeave.Employee.EmployeeJobDescriptions != null)
                        {
                            idCompany = employeeLeave.Employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                        }
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeLeavesFromList_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeLeaves;
        }


        /// <summary>
        /// This method is to update employee leave 
        /// </summary>
        /// <param name="mainServerWorkbenchConnectionString">Get main server connection string (emdep_geos db)</param>
        /// <param name="workbenchConnectionString">Get workbench connection string (emdep_geos db)</param>
        /// <param name="employeeLeave">Get employee leave details</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <returns>Employee leave details</returns>
        public EmployeeLeave UpdateEmployeeLeave_V2045(string mainServerWorkbenchConnectionString, string workbenchConnectionString, EmployeeLeave employeeLeave, long selectedPeriod)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {

                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeLeaveUpdate_V2045", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeLeave", employeeLeave.IdEmployeeLeave);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeLeave.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdLeave", employeeLeave.IdLeave);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeLeave.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeLeave.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_FileName1", employeeLeave.FileName);
                        mySqlCommand.Parameters.AddWithValue("_Remark", employeeLeave.Remark);
                        mySqlCommand.Parameters.AddWithValue("_IsAllDayEvent", employeeLeave.IsAllDayEvent);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeLeave.IdCompanyShift);

                        employeeLeave.IdEmployeeLeave = Convert.ToUInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();

                        ///002
                        AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employeeLeave.IdEmployee, employeeLeave.EmployeeChangelogs);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();

                    if (employeeLeave.Employee == null)
                        employeeLeave.Employee = new Employee();

                    employeeLeave.Employee.CompanyShift =GetCompanyShiftDetailAfterUpdateAdd( employeeLeave.IdCompanyShift, workbenchConnectionString, selectedPeriod);

                    employeeLeave.Employee.EmployeeJobDescriptions = new List<EmployeeJobDescription>();

                    EmployeeJobDescription employeeJobDescription = new EmployeeJobDescription();
                    employeeJobDescription = GetEmployeeJobDescriptionsByIdEmployee(workbenchConnectionString, employeeLeave.IdEmployee).LastOrDefault();

                    if (employeeJobDescription != null)
                        employeeLeave.Employee.EmployeeJobDescriptions.Add(employeeJobDescription);

                    string idCompany = "";
                    if (employeeLeave.Employee.EmployeeJobDescriptions != null)
                    {
                        idCompany = employeeLeave.Employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                    }
                    employeeLeave.Employee.EmployeeAnnualLeaves = GetEmployeeAnnualLeavesHourCountByIdEmployeeSprint60(workbenchConnectionString, employeeLeave.IdEmployee, selectedPeriod, idCompany.ToString());
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployeeLeave_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeLeave;
        }

        public List<EmployeeLeave> GetEmployeeLeavesBySelectedIdCompany_V2045(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeLeave> employeeLeaves = new List<EmployeeLeave>();


            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeLeavesBySelectedIdCompany_V2045", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                    mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                    mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                    mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                    mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                EmployeeLeave employeeLeave = new EmployeeLeave();

                                if (reader["IdEmployeeLeave"] != DBNull.Value)
                                    employeeLeave.IdEmployeeLeave = Convert.ToUInt64(reader["IdEmployeeLeave"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeLeave.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeLeave.Employee = new Employee();
                                    employeeLeave.Employee.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                    if (reader["EmployeeCode"] != DBNull.Value)
                                        employeeLeave.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                    if (reader["FirstName"] != DBNull.Value)
                                        employeeLeave.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                    if (reader["LastName"] != DBNull.Value)
                                        employeeLeave.Employee.LastName = Convert.ToString(reader["LastName"]);

                                    if (reader["IdCompanyShift"] != DBNull.Value)
                                        employeeLeave.Employee.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);

                                    if (reader["IdGender"] != DBNull.Value)
                                        employeeLeave.Employee.IdGender = Convert.ToUInt32(reader["IdGender"]);

                                    if (reader["JDCodes"] != DBNull.Value)
                                    {

                                        employeeLeave.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                        string[] LstJDCodes = employeeLeave.Employee.EmpJobCodes.Split('\n');
                                        employeeLeave.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                    }


                                    if (reader["JDTitles"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                        string[] LstJDTitles = employeeLeave.Employee.EmployeeJobTitles.Split('\n');
                                        employeeLeave.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                    }

                                    if (reader["DeptNames"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.LstEmployeeDepartments = new List<Department>();
                                        foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                        {
                                            string[] itemDepartmentSplit = itemDepartment.Split('^');
                                            if (itemDepartmentSplit != null)
                                            {
                                                Department department = new Department();
                                                department.DepartmentName = itemDepartmentSplit[0].ToString();
                                                if (itemDepartmentSplit.Count() > 1)
                                                    department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                                if (!employeeLeave.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                    employeeLeave.Employee.LstEmployeeDepartments.Add(department);
                                            }

                                        }
                                    }


                                    if (reader["companies"] != DBNull.Value)
                                    {
                                        employeeLeave.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                        string[] LstAlias = employeeLeave.Employee.EmployeeCompanyAlias.Split('\n');
                                        employeeLeave.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                    }


                                }

                                if (reader["IdLeave"] != DBNull.Value)
                                {
                                    employeeLeave.IdLeave = Convert.ToInt32(reader["IdLeave"]);

                                    employeeLeave.CompanyLeave = new CompanyLeave();
                                    employeeLeave.CompanyLeave.IdCompanyLeave = Convert.ToUInt64(employeeLeave.IdLeave);
                                    employeeLeave.CompanyLeave.Name = Convert.ToString(reader["Name"]);
                                    employeeLeave.CompanyLeave.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                    if (reader["IdCompany"] != DBNull.Value)
                                    {
                                        employeeLeave.CompanyLeave.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                        employeeLeave.CompanyLeave.Company = new Company();

                                        employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule = new CompanyAnnualSchedule();

                                        employeeLeave.CompanyLeave.Company.CompanySetting = new CompanySetting();

                                        if (reader["CompanySetting"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanySetting.Value = Convert.ToString(reader["CompanySetting"]);

                                        if (reader["DailyHoursCount"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                        if (reader["Year"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                        if (reader["WorkingDays"] != DBNull.Value)
                                            employeeLeave.CompanyLeave.Company.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                    }
                                }

                                if (reader["StartDate"] != DBNull.Value)
                                {
                                    employeeLeave.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                    employeeLeave.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                    employeeLeave.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeLeave.StartDate.Value, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                                }

                                if (reader["EndDate"] != DBNull.Value)
                                {
                                    employeeLeave.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                    employeeLeave.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                                }

                                if (reader["FileName"] != DBNull.Value)
                                    employeeLeave.FileName = Convert.ToString(reader["FileName"]);

                                if (reader["Remark"] != DBNull.Value)
                                    employeeLeave.Remark = Convert.ToString(reader["Remark"]);

                                if (reader["IsAllDayEvent"] != DBNull.Value)
                                    employeeLeave.IsAllDayEvent = Convert.ToSByte(reader["IsAllDayEvent"]);

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeLeave.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeLeave.CompanyShift = new CompanyShift();
                                    employeeLeave.CompanyShift.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeLeave.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);
                                    if (reader["MonStartTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.MonStartTime = (TimeSpan)reader["MonStartTime"];

                                    if (reader["MonEndTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.MonEndTime = (TimeSpan)reader["MonEndTime"];

                                    if (reader["MonBreakTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.MonBreakTime = (TimeSpan)reader["MonBreakTime"];

                                    if (reader["TueStartTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.TueStartTime = (TimeSpan)reader["TueStartTime"];

                                    if (reader["TueEndTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.TueEndTime = (TimeSpan)reader["TueEndTime"];

                                    if (reader["TueBreakTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.TueBreakTime = (TimeSpan)reader["TueBreakTime"];

                                    if (reader["WedStartTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.WedStartTime = (TimeSpan)reader["WedStartTime"];

                                    if (reader["WedEndTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.WedEndTime = (TimeSpan)reader["WedEndTime"];

                                    if (reader["WedBreakTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.WedBreakTime = (TimeSpan)reader["WedBreakTime"];

                                    if (reader["ThuStartTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.ThuStartTime = (TimeSpan)reader["ThuStartTime"];

                                    if (reader["ThuEndTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.ThuEndTime = (TimeSpan)reader["ThuEndTime"];


                                    if (reader["ThuBreakTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.ThuBreakTime = (TimeSpan)reader["ThuBreakTime"];

                                    if (reader["FriStartTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.FriStartTime = (TimeSpan)reader["FriStartTime"];

                                    if (reader["FriEndTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.FriEndTime = (TimeSpan)reader["FriEndTime"];

                                    if (reader["FriBreakTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.FriBreakTime = (TimeSpan)reader["FriBreakTime"];

                                    if (reader["SatStartTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.SatStartTime = (TimeSpan)reader["SatStartTime"];

                                    if (reader["SatEndTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.SatEndTime = (TimeSpan)reader["SatEndTime"];

                                    if (reader["SatBreakTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.SatBreakTime = (TimeSpan)reader["SatBreakTime"];

                                    if (reader["SunStartTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.SunStartTime = (TimeSpan)reader["SunStartTime"];

                                    if (reader["SunEndTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.SunEndTime = (TimeSpan)reader["SunEndTime"];

                                    if (reader["SunBreakTime"] != DBNull.Value)
                                        employeeLeave.CompanyShift.SunBreakTime = (TimeSpan)reader["SunBreakTime"];

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employeeLeave.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["CompanyScheduleAlias"] != DBNull.Value)
                                    {
                                        if (employeeLeave.CompanyShift.CompanySchedule == null)
                                            employeeLeave.CompanyShift.CompanySchedule = new CompanySchedule();
                                        if (employeeLeave.CompanyShift.CompanySchedule.Company == null)
                                            employeeLeave.CompanyShift.CompanySchedule.Company = new Company();

                                        employeeLeave.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["CompanyScheduleAlias"]);

                                    }
                                        

                                    

                                }

                                    employeeLeaves.Add(employeeLeave);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeLeavesBySelectedIdCompany_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeLeaves;
        }

        /// <summary>
        /// [001][2020-07-29][adhatkar] GEOS2-2141 end of contract reminder
        /// </summary>
        /// <param name="workbenchConnectionString">The workbench connection string</param>
        /// <param name="emails">The emails list.</param>
        /// <returns>The list of employee contract expirations.</returns>
        public List<EmployeeContractSituation> GetEmployeeContractExpirations(string workbenchConnectionString, Int32 idCompany, ref List<string> ToEmailList, DateTime? currentDate = null)
        {
            List<EmployeeContractSituation> employeeContractExpirations = new List<EmployeeContractSituation>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeContractExpirations", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);
                    mySqlCommand.Parameters.AddWithValue("_idCompany", idCompany);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        if(reader.NextResult())
                        if (reader.HasRows)
                        {
                            while (reader.Read())
                            {
                                EmployeeContractSituation employeeContractExpiration = new EmployeeContractSituation();

                                if (reader["IdEmployeeContractSituation"] != DBNull.Value)
                                    employeeContractExpiration.IdEmployeeContractSituation = Convert.ToUInt64(reader["IdEmployeeContractSituation"]);

                                if (reader["IdEmployee"] != DBNull.Value)
                                {
                                    employeeContractExpiration.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                    employeeContractExpiration.Employee = new Employee();
                                    employeeContractExpiration.Employee.IdEmployee = employeeContractExpiration.IdEmployee;

                                    if (reader["EmployeeCode"] != DBNull.Value)
                                        employeeContractExpiration.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);

                                    if (reader["FirstName"] != DBNull.Value)
                                        employeeContractExpiration.Employee.FirstName = Convert.ToString(reader["FirstName"]);

                                    if (reader["LastName"] != DBNull.Value)
                                        employeeContractExpiration.Employee.LastName = Convert.ToString(reader["LastName"]);
                                }

                                if (reader["ContractSituationStartDate"] != DBNull.Value)
                                    employeeContractExpiration.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                if (reader["ContractSituationEndDate"] != DBNull.Value)
                                    employeeContractExpiration.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                if (reader["ContractExpirationWarningDate"] != DBNull.Value)
                                    employeeContractExpiration.ContractExpirationWarningDate = Convert.ToDateTime(reader["ContractExpirationWarningDate"]);

                                employeeContractExpirations.Add(employeeContractExpiration);
                            }
                        }

                        if (reader.NextResult())
                        {
                            while (reader.Read())
                            {
                                try
                                {
                                    if (reader["Emails"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(reader["Emails"])))
                                    {
                                        ToEmailList.AddRange(Convert.ToString(reader["Emails"]).Split(';').ToList());
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeContractExpirations(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                    throw;
                                }
                            }

                            ToEmailList = ToEmailList.Distinct().OrderBy(q => q).ToList();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeContractExpirations(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employeeContractExpirations;
        }

        public bool UpdateEmployeeContractWarningDate(string mainServerWorkbenchConnectionString, List<EmployeeContractSituation> employeeContractExpirationList, DateTime? currentDate = null)
        {
            bool isUpdated = false;
            if (employeeContractExpirationList != null)
            {
                using (TransactionScope transactionScope = new TransactionScope())
                {
                    try
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                        {

                            mySqlConnection.Open();
                            foreach (EmployeeContractSituation EmployeeContract in employeeContractExpirationList)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_employee_contract_situations_UpdateWarningDate", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdEmployeeContractSituation", EmployeeContract.IdEmployeeContractSituation);
                                mySqlCommand.Parameters.AddWithValue("_CurrentDate", currentDate);

                                mySqlCommand.ExecuteNonQuery();
                            }
                            mySqlConnection.Close();
                        }

                        transactionScope.Complete();
                        transactionScope.Dispose();
                        isUpdated = true;
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployeeContractWarningDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        if (Transaction.Current != null)
                            Transaction.Current.Rollback();

                        if (transactionScope != null)
                            transactionScope.Dispose();

                        throw;
                    }
                }
            }
            return isUpdated;
        }

        public Employee AddEmployee_V2046(string mainServerWorkbenchConnectionString, string workbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocument)
        {

            employee.EmployeeCode = GetLatestEmployeeCode(workbenchConnectionString);

            if (!string.IsNullOrEmpty(employee.EmployeeCode))
            {
                using (TransactionScope transactionScope = new TransactionScope())
                {
                    try
                    {
                        //string lastestEmployeeCode = "";


                        using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Insert_V2046", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            //if (!string.IsNullOrEmpty(lastestEmployeeCode) && lastestEmployeeCode != employee.EmployeeCode)
                            //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", lastestEmployeeCode);
                            //else
                            //    mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                            mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);

                            mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                            mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                            mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                            if (employee.DateOfBirth.HasValue)
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                            else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                            else
                                mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                            mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                            mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                            if (employee.IdMaritalStatus > 0)
                                mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                            else
                                mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                            mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                            mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                            mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                            mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                            mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                            mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                            mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                            mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                            mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                            mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                            mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                            mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                            mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                            mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                            mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                            mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);
                            mySqlCommand.Parameters.AddWithValue("_DisplayName", employee.DisplayName);

                            employee.IdEmployee = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                            mySqlConnection.Close();
                        }

                        if (employee.IdEmployee > 0)
                        {
                            if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)   //Save employee profile image.
                                SaveEmployeeProfileImage(employeeProfileImage, employee);
                            else if (employee.IsProfileImageDeleted)                                       //Delete employee profile image.
                                DeleteEmployeeProfileImage(employeeProfileImage, employee);

                            //if (employee.EmployeeExitDocInBytes != null && !employee.IsemployeeExitDocDeleted)   //Save employee exit Document.
                            //    SaveEmployeeExitDocument(employeeExitDocument, employee);
                            //else if (employee.IsemployeeExitDocDeleted)                                       //Delete employee exit Document.
                            //    DeleteEmployeeExitDocument(employeeExitDocument, employee);

                            AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                            AddEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                            AddEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                            AddEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                            AddEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                            AddEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                            AddEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                            AddEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                            AddEmployeeJobDescriptions_V2046(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                            AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                            AddEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                            AddEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                            AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                        }

                        transactionScope.Complete();
                        transactionScope.Dispose();
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error AddEmployee_V2046(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                        if (Transaction.Current != null)
                            Transaction.Current.Rollback();

                        if (transactionScope != null)
                            transactionScope.Dispose();

                        throw;
                    }
                }
            }

            return employee;
        }

        public bool UpdateEmployee_V2046(string mainServerWorkbenchConnectionString, Employee employee, string employeeProfileImage, string empEducationQualificationFilesPath, string empProfessionalEducationFilesPath, string empContractSituationFilesPath, string empIdentificationDocumentFilesPath, string employeeExitDocumentFilePath)
        {
            bool isUpdatedEmployee = false;

            if (employee.IdEmployeeStatus == 136 || employee.IdEmployeeStatus == 137)
                employee.EmployeeCode = employee.EmployeeCode.Replace("D", "E");

            if (employee.IdEmployeeStatus == 136)
            {
                employee.ExitDate = null;
                employee.ExitIdReason = null;
                employee.ExitRemarks = null;
                employee.ExitFileName = null;
            }

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_Employee_Update_V2046", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employee.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_EmployeeCode", employee.EmployeeCode);
                        mySqlCommand.Parameters.AddWithValue("_FirstName", employee.FirstName);
                        mySqlCommand.Parameters.AddWithValue("_LastName", employee.LastName);
                        mySqlCommand.Parameters.AddWithValue("_NativeName", employee.NativeName);

                        if (employee.DateOfBirth.HasValue)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.DateOfBirth.Value);
                        else if (DateTime.Compare(employee.BirthDate.Date, DateTime.MinValue.Date) > 1)
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", employee.BirthDate);
                        else
                            mySqlCommand.Parameters.AddWithValue("_BirthDate", null);

                        mySqlCommand.Parameters.AddWithValue("_IdGender", employee.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_IsLongTermAbsent", employee.IsLongTermAbsent);

                        if (employee.IdMaritalStatus > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", employee.IdMaritalStatus);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdMaritalStatus", null);

                        mySqlCommand.Parameters.AddWithValue("_IdNationality", employee.IdNationality);
                        mySqlCommand.Parameters.AddWithValue("_AddressStreet", employee.AddressStreet);
                        mySqlCommand.Parameters.AddWithValue("_AddressCity", employee.AddressCity);
                        mySqlCommand.Parameters.AddWithValue("_AddressRegion", employee.AddressRegion);
                        mySqlCommand.Parameters.AddWithValue("_AddressZipCode", employee.AddressZipCode);
                        mySqlCommand.Parameters.AddWithValue("_AddressIdCountry", employee.AddressIdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Disability", employee.Disability);
                        mySqlCommand.Parameters.AddWithValue("_IsEnabled", employee.IsEnabled);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", employee.Remarks);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employee.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_IdEmployeeStatus", employee.IdEmployeeStatus);
                        mySqlCommand.Parameters.AddWithValue("_ExitDate", employee.ExitDate);
                        mySqlCommand.Parameters.AddWithValue("_ExitIdReason", employee.ExitIdReason);
                        mySqlCommand.Parameters.AddWithValue("_ExitRemarks", employee.ExitRemarks);
                        mySqlCommand.Parameters.AddWithValue("_Latitude", employee.Latitude);
                        mySqlCommand.Parameters.AddWithValue("_Longitude", employee.Longitude);
                        mySqlCommand.Parameters.AddWithValue("_ExitFileName", employee.ExitFileName);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyLocation", employee.IdCompanyLocation);
                        mySqlCommand.Parameters.AddWithValue("_HasWelcomeMessageBeenReceived", employee.HasWelcomeMessageBeenReceived);
                        mySqlCommand.Parameters.AddWithValue("_DisplayName", employee.DisplayName);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (employee.ProfileImageInBytes != null && !employee.IsProfileImageDeleted)    //Save employee profile image.
                        SaveEmployeeProfileImage(employeeProfileImage, employee);
                    else if (employee.IsProfileImageDeleted)                                        //Delete employee profile image.
                        DeleteEmployeeProfileImage(employeeProfileImage, employee);

                    //if (!employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent!=null)   //Save employee exit Document.
                    //    SaveEmployeeExitDocument_V2035(employeeExitDocument, employee);
                    //else if (employee.IsemployeeExitDocDeleted && employee.EmployeeExitEvent != null)                                       //Delete employee exit Document.
                    //    DeleteEmployeeExitDocument_V2035(employeeExitDocument, employee);

                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePersonalContacts);
                    AddUpdateDeleteEmployeeContacts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeProfessionalContacts);
                    AddUpdateDeleteEmployeeDocuments(mainServerWorkbenchConnectionString, employee, employee.EmployeeDocuments, empIdentificationDocumentFilesPath);
                    AddUpdateDeleteEmployeeLanguages(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeLanguages);
                    AddUpdateDeleteEmployeeEducationQualifications(mainServerWorkbenchConnectionString, employee, employee.EmployeeEducationQualifications, empEducationQualificationFilesPath);
                    AddUpdateDeleteEmployeeContractSituations_V2031(mainServerWorkbenchConnectionString, employee, employee.EmployeeContractSituations, empContractSituationFilesPath);
                    AddUpdateDeleteEmployeeFamilyMembers(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeFamilyMembers);
                    AddUpdateDeleteEmployeeJobDescriptions_V2046(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeJobDescriptions);
                    AddEmployeeChangelogs(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeChangelogs);
                    AddUpdateDeleteEmployeeProfessionalEducations(mainServerWorkbenchConnectionString, employee, employee.EmployeeProfessionalEducations, empProfessionalEducationFilesPath);
                    AddUpdateDeleteEmployeeAnnualLeaves(mainServerWorkbenchConnectionString, employee, employee.EmployeeAnnualLeaves);
                    AddUpdateDeleteEmployeePolyvalence(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeePolyvalences);
                    AddDeleteEmployeeShifts(mainServerWorkbenchConnectionString, employee.IdEmployee, employee.EmployeeShifts);
                    AddUpdateDeleteEmployeeExitEvent(mainServerWorkbenchConnectionString, employee, employee.EmployeeExitEvents, employeeExitDocumentFilePath);


                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdatedEmployee = true;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateEmployee_V2046(). IdEmployee- {0} ErrorMessage- {1}", employee.IdEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return isUpdatedEmployee;
        }

        /// <summary>
        /// This method is to get employee details
        /// </summary>
        /// <param name="workbenchConnectionString">Get connection string</param>
        /// <param name="idEmployee">Get id employee</param>
        /// <param name="exitDocumentFilePath">Get exit document file path</param>
        /// <param name="selectedPeriod">Get selected period</param>
        /// <param name="idCompany">Get company id</param>
        /// <returns>Get employee Details</returns>
        public Employee GetEmployeeByIdEmployee_V2046(string workbenchConnectionString, Int32 idEmployee, string exitDocumentFilePath, Int64 selectedPeriod = 0, string idCompany = null)
        {
            Employee employee = new Employee();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeByIdEmployee_V2046", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdEmployee", idEmployee);

                    using (MySqlDataReader empReader = mySqlCommand.ExecuteReader())
                    {
                        while (empReader.Read())
                        {
                            employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                            if (empReader["EmployeeCode"] != DBNull.Value)
                                employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                            if (empReader["FirstName"] != DBNull.Value)
                                employee.FirstName = Convert.ToString(empReader["FirstName"]);

                            if (empReader["LastName"] != DBNull.Value)
                                employee.LastName = Convert.ToString(empReader["LastName"]);

                            if (empReader["DisplayName"] != DBNull.Value)
                                employee.DisplayName = Convert.ToString(empReader["DisplayName"]);

                            if (empReader["NativeName"] != DBNull.Value)
                                employee.NativeName = Convert.ToString(empReader["NativeName"]);

                            if (empReader["BirthDate"] != DBNull.Value)
                            {
                                employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                employee.DateOfBirth = employee.BirthDate;
                            }

                            if (empReader["IdGender"] != DBNull.Value)
                            {
                                employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                employee.Gender = new LookupValue();
                                employee.Gender.IdLookupValue = Convert.ToInt32(employee.IdGender);
                                employee.Gender.Value = Convert.ToString(empReader["Gender"]);
                            }

                            if (empReader["IdMaritalStatus"] != DBNull.Value)
                            {
                                employee.IdMaritalStatus = Convert.ToUInt32(empReader["IdMaritalStatus"]);

                                employee.MaritalStatus = new LookupValue();
                                employee.MaritalStatus.IdLookupValue = Convert.ToInt32(employee.IdMaritalStatus);
                                employee.MaritalStatus.Value = Convert.ToString(empReader["MaritalStatus"]);
                            }

                            if (empReader["IdNationality"] != DBNull.Value)
                            {
                                employee.IdNationality = Convert.ToUInt32(empReader["IdNationality"]);

                                employee.Nationality = new Country();
                                employee.Nationality.IdCountry = Convert.ToByte(employee.IdNationality);
                                employee.Nationality.Name = Convert.ToString(empReader["Nationality"]);
                            }

                            if (empReader["AddressStreet"] != DBNull.Value)
                                employee.AddressStreet = Convert.ToString(empReader["AddressStreet"]);

                            if (empReader["AddressCity"] != DBNull.Value)
                                employee.AddressCity = Convert.ToString(empReader["AddressCity"]);

                            if (empReader["AddressRegion"] != DBNull.Value)
                                employee.AddressRegion = Convert.ToString(empReader["AddressRegion"]);

                            if (empReader["AddressZipCode"] != DBNull.Value)
                                employee.AddressZipCode = Convert.ToString(empReader["AddressZipCode"]);

                            if (empReader["AddressIdCountry"] != DBNull.Value)
                            {
                                employee.AddressIdCountry = Convert.ToUInt16(empReader["AddressIdCountry"]);

                                employee.AddressCountry = new Country();
                                employee.AddressCountry.IdCountry = Convert.ToByte(employee.AddressIdCountry);
                                employee.AddressCountry.Name = Convert.ToString(empReader["AddressCountry"]);
                            }

                            if (empReader["Disability"] != DBNull.Value)
                                employee.Disability = Convert.ToUInt16(empReader["Disability"]);

                            if (empReader["IsEnabled"] != DBNull.Value)
                                employee.IsEnabled = Convert.ToByte(empReader["IsEnabled"]);

                            if (empReader["Remarks"] != DBNull.Value)
                                employee.Remarks = Convert.ToString(empReader["Remarks"]);

                            if (empReader["IsLongTermAbsent"] != DBNull.Value)
                                employee.IsLongTermAbsent = Convert.ToByte(empReader["IsLongTermAbsent"]);

                            if (empReader["IdCompanyShift"] != DBNull.Value)
                            {
                                employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);

                                employee.CompanyShift = new CompanyShift();
                                employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;

                                if (empReader["StartTime1"] != DBNull.Value)
                                    employee.CompanyShift.StartTime1 = (TimeSpan)empReader["StartTime1"];

                                if (empReader["EndTime1"] != DBNull.Value)
                                    employee.CompanyShift.EndTime1 = (TimeSpan)empReader["EndTime1"];

                                if (empReader["BreakTime"] != DBNull.Value)
                                    employee.CompanyShift.BreakTime = (TimeSpan)empReader["BreakTime"];

                                if (empReader["IdCompanySchedule"] != DBNull.Value)
                                {
                                    employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                    employee.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employee.CompanyShift.CompanySchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.IdCompany = Convert.ToInt32(empReader["IdCompany"]);

                                    if (empReader["CompanyScheduleName"] != DBNull.Value)
                                        employee.CompanyShift.CompanySchedule.Name = Convert.ToString(empReader["CompanyScheduleName"]);
                                }
                            }

                            if (empReader["IdEmployeeStatus"] != DBNull.Value)
                            {
                                employee.IdEmployeeStatus = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus = new LookupValue();
                                employee.EmployeeStatus.IdLookupValue = Convert.ToInt32(empReader["IdEmployeeStatus"]);
                                employee.EmployeeStatus.Value = empReader["Value"].ToString();
                                employee.EmployeeStatus.HtmlColor = empReader["HtmlColor"].ToString();

                                if (empReader["IdImage"] != DBNull.Value)
                                    employee.EmployeeStatus.IdImage = Convert.ToInt64(empReader["IdImage"].ToString());
                                if (empReader["Position"] != DBNull.Value)
                                    employee.EmployeeStatus.Position = Convert.ToInt32(empReader["Position"].ToString());
                            }

                            if (empReader["ExitDate"] != DBNull.Value)
                                employee.ExitDate = Convert.ToDateTime(empReader["ExitDate"]);

                            if (empReader["ExitIdReason"] != DBNull.Value)
                            {
                                employee.ExitIdReason = Convert.ToInt32(empReader["ExitIdReason"]);

                                employee.ExitReason = new LookupValue();
                                employee.ExitReason.IdLookupValue = Convert.ToInt32(employee.ExitIdReason);
                                employee.ExitReason.Value = Convert.ToString(empReader["ExitReason"]);
                            }

                            if (empReader["ExitRemarks"] != DBNull.Value)
                                employee.ExitRemarks = Convert.ToString(empReader["ExitRemarks"]);

                            if (empReader["ExitFileName"] != DBNull.Value)
                                employee.ExitFileName = Convert.ToString(empReader["ExitFileName"]);

                            if (empReader["Latitude"] != DBNull.Value)
                                employee.Latitude = Convert.ToDouble(empReader["Latitude"]);

                            if (empReader["Longitude"] != DBNull.Value)
                                employee.Longitude = Convert.ToDouble(empReader["Longitude"]);

                            if (empReader["IdCompanyLocation"] != DBNull.Value)
                            {
                                employee.IdCompanyLocation = Convert.ToInt32(empReader["IdCompanyLocation"]);

                                employee.CompanyLocation = new Company();
                                employee.CompanyLocation.IdCompany = employee.IdCompanyLocation.Value;

                                if (empReader["CompanyName"] != DBNull.Value)
                                    employee.CompanyLocation.Name = Convert.ToString(empReader["CompanyName"]);

                                if (empReader["CompanyAlias"] != DBNull.Value)
                                    employee.CompanyLocation.Alias = Convert.ToString(empReader["CompanyAlias"]);
                            }
                        }
                    }
                }

                employee.EmployeePersonalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 0);
                employee.EmployeeProfessionalContacts = GetEmployeeContactsByIdEmployee(workbenchConnectionString, idEmployee, 1);
                employee.EmployeeDocuments = GetEmployeeDocumentsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeLanguages = GetEmployeeLanguagesByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeEducationQualifications = GetEmployeeEducationQualificationsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeContractSituations = GetEmployeeContractSituationsByIdEmployee_V2035(workbenchConnectionString, idEmployee);
                employee.EmployeeFamilyMembers = GetEmployeeFamilyMembersByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeJobDescriptions = GetEmployeeJobDescriptionsByIdEmployee_V2046(workbenchConnectionString, idEmployee);
                employee.EmployeeChangelogs = GetEmployeeChangeLogsByIdEmployee(workbenchConnectionString, idEmployee);
                employee.EmployeeProfessionalEducations = GetEmployeeProfessionalEducationsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeJobDescriptions != null)
                {
                    if (employee.EmployeeJobDescriptions.Count > 1)
                        idCompany = employee.EmployeeJobDescriptions.LastOrDefault().IdCompany.ToString();
                }

                //string ContractidsCompany;
                //DateTime dtMatchDate = new DateTime(Convert.ToInt32(selectedPeriod), DateTime.Now.Month, DateTime.Now.Day);
                //ContractidsCompany = String.Join(",",employee.EmployeeContractSituations.Where(ecs => (ecs.ContractSituationStartDate.Value >= dtMatchDate && (ecs.ContractSituationEndDate.HasValue ? DateTime.Now : ecs.ContractSituationEndDate.Value) <= dtMatchDate)).Select(i => i.IdCompany).ToList());
                employee.EmployeeAnnualLeaves = GetEmployeeLeaveByIdEmployee_V2050(workbenchConnectionString, idEmployee, selectedPeriod, idCompany);
                //  employee.EmployeeShifts = GetEmployeeShifts_V2034(workbenchConnectionString, idEmployee);

                if (employee.EmployeeContractSituations != null)
                    employee.LengthOfServiceString = CalculateLengthOfService(employee.EmployeeContractSituations);

                employee.EmployeePolyvalences = GetEmployeePolyvalenceByIdEmployee_V2035(workbenchConnectionString, idEmployee);

                employee.EmployeeExitEvents = GetEmployeeExitEventsByIdEmployee_V2036(workbenchConnectionString, idEmployee, employee.EmployeeCode, exitDocumentFilePath);
                employee.EmployeeShifts = GetEmployeeShiftsByIdEmployee(workbenchConnectionString, idEmployee);
                if (employee.EmployeeShifts != null)
                {
                    if (employee.EmployeeShifts.Count > 0)
                        employee.EmployeeShifts.RemoveAt(0);
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeeByIdEmployee_V2046(). IdEmployee- {0} ErrorMessage- {1}", idEmployee, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return employee;
        }

        public JobDescription AddJobDescription_V2046(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Insert_V2046", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionIsRemote", jobDescription.JobDescriptionIsRemote);

                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);
                        mySqlCommand.Parameters.AddWithValue("_IdJDLevel", jobDescription.IdJDLevel);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionIsMandatory", jobDescription.JobDescriptionIsMandatory);
                        mySqlCommand.Parameters.AddWithValue("_IdJDScope", jobDescription.IdJdScope);

                        jobDescription.IdJobDescription = Convert.ToUInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddJobDescription_V2046(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        public JobDescription UpdateJobDescription_V2046(string mainServerWorkbenchConnectionString, string EmpJobDescriptionsFilesPath, JobDescription jobDescription)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_JobDescription_Update_V2046", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdJobDescription", jobDescription.IdJobDescription);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionCode", jobDescription.JobDescriptionCode);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionTitle", jobDescription.JobDescriptionTitle);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", jobDescription.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionFileName", jobDescription.JobDescriptionFileName);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionInUse", jobDescription.JobDescriptionInUse);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionIsRemote", jobDescription.JobDescriptionIsRemote);
                        if (jobDescription.IdParent > 0)
                            mySqlCommand.Parameters.AddWithValue("_IdParent", jobDescription.IdParent);
                        else
                            mySqlCommand.Parameters.AddWithValue("_IdParent", null);

                        mySqlCommand.Parameters.AddWithValue("_Abbreviation", jobDescription.Abbreviation);
                        mySqlCommand.Parameters.AddWithValue("_ChildOrientation", jobDescription.ChildOrientation);
                        mySqlCommand.Parameters.AddWithValue("_IdJDLevel", jobDescription.IdJDLevel);
                        mySqlCommand.Parameters.AddWithValue("_JobDescriptionIsMandatory", jobDescription.JobDescriptionIsMandatory);
                        mySqlCommand.Parameters.AddWithValue("_IdJDScope", jobDescription.IdJdScope);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    if (!string.IsNullOrEmpty(jobDescription.OldJobDescriptionCode) && !string.IsNullOrEmpty(jobDescription.JobDescriptionCode) && jobDescription.JobDescriptionCode != jobDescription.OldJobDescriptionCode)
                    {
                        string oldFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.OldJobDescriptionCode);
                        string newFileName = string.Format(@"{0}\{1}.pdf", EmpJobDescriptionsFilesPath, jobDescription.JobDescriptionCode);

                        if (fileMgr.FileExists(oldFileName))
                            fileMgr.Move(oldFileName, newFileName);
                    }

                    if (jobDescription.IsJobDescriptionFileUpdated && jobDescription.JobDescriptionFileInBytes != null)
                    {
                        SaveJobDescriptionFile(EmpJobDescriptionsFilesPath, jobDescription);
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateJobDescription_V2046(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return jobDescription;
        }


        public List<JobDescription> GetAllJobDescriptions_V2046(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetAllJobDescriptions_V2046", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                jobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                jobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel = new LookupValue();
                                jobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel.Value = reader["JDLevel"].ToString();
                                jobDescription.JDLevel.HtmlColor = reader["JDHtmlColor"].ToString();
                                if (reader["JDImage"] != DBNull.Value)
                                    jobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDImage"].ToString());
                            }

                            if (reader["IdJDScope"] != DBNull.Value)
                            {
                                jobDescription.IdJdScope = Convert.ToInt32(reader["IdJDScope"].ToString());
                                jobDescription.JDScope = new LookupValue();
                                jobDescription.JDScope.IdLookupValue = Convert.ToInt32(reader["IdJDScope"].ToString());
                                jobDescription.JDScope.Value = reader["JDScope"].ToString();
                                jobDescription.JDScope.HtmlColor = reader["JDScopeHtmlColor"].ToString();
                               
                            }

                            if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                jobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);

                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptions_V2040(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        public List<JobDescription> GetAllJobDescriptionsForIsRemoteInUse(string workbenchConnectionString)
        {
            List<JobDescription> jobDescriptions = new List<JobDescription>();

            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("HRM_GetAllJobDescriptionsForIsRemoteInUse", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            JobDescription jobDescription = new JobDescription();

                            if (reader["IdJobDescription"] != DBNull.Value)
                                jobDescription.IdJobDescription = Convert.ToUInt32(reader["IdJobDescription"]);

                            if (reader["JobDescriptionCode"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionCode = Convert.ToString(reader["JobDescriptionCode"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionCode;
                            }

                            if (reader["JobDescriptionTitle"] != DBNull.Value)
                            {
                                jobDescription.JobDescriptionTitle = Convert.ToString(reader["JobDescriptionTitle"]);
                                jobDescription.JobDescriptionTitleAndCode = jobDescription.JobDescriptionTitleAndCode + " - " + jobDescription.JobDescriptionTitle;
                            }

                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                jobDescription.IdDepartment = Convert.ToUInt32(reader["IdDepartment"]);

                                jobDescription.Department = new Department();
                                jobDescription.Department.IdDepartment = jobDescription.IdDepartment;
                                jobDescription.Department.DepartmentName = Convert.ToString(reader["DepartmentName"]);

                                if (reader["IdDepartmentArea"] != DBNull.Value)
                                    jobDescription.Department.IdDepartmentArea = Convert.ToUInt32(reader["IdDepartmentArea"]);

                                if (reader["DepartmentHtmlColor"] != DBNull.Value)
                                    jobDescription.Department.DepartmentHtmlColor = Convert.ToString(reader["DepartmentHtmlColor"]);

                                if (reader["DepartmentInUse"] != DBNull.Value)
                                    jobDescription.Department.DepartmentInUse = Convert.ToByte(reader["DepartmentInUse"]);
                            }

                            if (reader["JobDescriptionFileName"] != DBNull.Value)
                                jobDescription.JobDescriptionFileName = Convert.ToString(reader["JobDescriptionFileName"]);

                            if (reader["JobDescriptionInUse"] != DBNull.Value)
                                jobDescription.JobDescriptionInUse = Convert.ToByte(reader["JobDescriptionInUse"]);

                            if (reader["JobDescriptionIsRemote"] != DBNull.Value)
                                jobDescription.JobDescriptionIsRemote = Convert.ToByte(reader["JobDescriptionIsRemote"]);

                            if (reader["IdParent"] != DBNull.Value)
                            {
                                jobDescription.IdParent = Convert.ToUInt32(reader["IdParent"]);
                                jobDescription.ParentJobDescription = new JobDescription();
                                jobDescription.ParentJobDescription.IdJobDescription = (UInt32)jobDescription.IdParent;

                                if (reader["ParentJobDescriptionCode"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionCode = Convert.ToString(reader["ParentJobDescriptionCode"]);

                                if (reader["ParentJobDescriptionTitle"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.JobDescriptionTitle = Convert.ToString(reader["ParentJobDescriptionTitle"]);

                                if (reader["ParentAbbreviation"] != DBNull.Value)
                                    jobDescription.ParentJobDescription.Abbreviation = Convert.ToString(reader["ParentAbbreviation"]);
                            }

                            if (reader["Abbreviation"] != DBNull.Value)
                                jobDescription.Abbreviation = Convert.ToString(reader["Abbreviation"]);

                            if (reader["ChildOrientation"] != DBNull.Value)
                            {
                                jobDescription.ChildOrientation = reader["ChildOrientation"].ToString();
                            }

                            if (reader["IdJDLevel"] != DBNull.Value)
                            {
                                jobDescription.IdJDLevel = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel = new LookupValue();
                                jobDescription.JDLevel.IdLookupValue = Convert.ToInt32(reader["IdJDLevel"].ToString());
                                jobDescription.JDLevel.Value = reader["JDLevel"].ToString();
                                jobDescription.JDLevel.HtmlColor = reader["JDHtmlColor"].ToString();
                                if (reader["JDImage"] != DBNull.Value)
                                    jobDescription.JDLevel.IdImage = Convert.ToInt64(reader["JDImage"].ToString());
                            }

                            if (reader["IdJDScope"] != DBNull.Value)
                            {
                                jobDescription.IdJdScope = Convert.ToInt32(reader["IdJDScope"].ToString());
                                jobDescription.JDScope = new LookupValue();
                                jobDescription.JDScope.IdLookupValue = Convert.ToInt32(reader["IdJDScope"].ToString());
                                jobDescription.JDScope.Value = reader["JDScope"].ToString();
                                jobDescription.JDScope.HtmlColor = reader["JDScopeHtmlColor"].ToString();

                            }

                            if (reader["JobDescriptionIsMandatory"] != DBNull.Value)
                                jobDescription.JobDescriptionIsMandatory = Convert.ToByte(reader["JobDescriptionIsMandatory"]);

                            jobDescriptions.Add(jobDescription);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllJobDescriptionsForIsRemoteInUse(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return jobDescriptions;
        }

        public List<EmployeeOrganizationChart> GetEmployeesForOrganizationChart_V2046(string workbenchConnectionString, Int32 idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeOrganizationChart> employees = new List<EmployeeOrganizationChart>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeesForOrganizationChart_V2046", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                EmployeeOrganizationChart employee = new EmployeeOrganizationChart();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["EmpStatus"] != DBNull.Value)
                                    employee.EmployeeStatus = Convert.ToString(empReader["EmpStatus"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                    employee.HireDate = Convert.ToDateTime(empReader["HireDate"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                }
                                if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                    employee.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                if (empReader["JDCode"] != DBNull.Value)
                                    employee.JDCode = Convert.ToString(empReader["JDCode"]);

                                if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    employee.JobCode = Convert.ToString(empReader["JobDescriptionCode"]);

                                if (empReader["DepartmentName"] != DBNull.Value)
                                    employee.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    employee.JobTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                employee.Organization = Convert.ToString(empReader["CompanyOrganization"]);
                                employee.Company = Convert.ToString(empReader["CompanyContract"]);
                                employee.CompanyLocation = Convert.ToString(empReader["CompanyLocation"]);

                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart_V2046(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])))
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                        employees.Where(i => i.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(i => i.EmployeeContractSituations.Add(employeeContractSituation));
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart_V2046(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (var itememp in employees.GroupBy(i => i.IdEmployee))
            {
                EmployeeOrganizationChart itememployee = employees.Where(i => i.IdEmployee == itememp.Key).FirstOrDefault();
                if (itememployee.EmployeeContractSituations != null && itememployee.EmployeeContractSituations.Count > 0)
                {
                    // itememp.HireDate = itememp.EmployeeContractSituations.FirstOrDefault().ContractSituationStartDate;
                    itememployee.LengthOfServiceString = CalculateLengthOfService(itememployee.EmployeeContractSituations);
                }
                employees.Where(i => i.IdEmployee == itememp.Key).ToList().ForEach(i => i.LengthOfServiceString = itememployee.LengthOfServiceString);
            }


            Log4NetLogger.Logger.Log("Executed GetEmployeesForOrganizationChart_V2046().", category: Category.Info, priority: Priority.Low);
            return employees;
        }


        public List<EmployeeOrganizationChart> GetEmployeesForOrganizationChart_V2050(string workbenchConnectionString, Int32 idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeOrganizationChart> employees = new List<EmployeeOrganizationChart>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetEmployeesForOrganizationChart_V2050", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;

                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                EmployeeOrganizationChart employee = new EmployeeOrganizationChart();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["EmpStatus"] != DBNull.Value)
                                    employee.EmployeeStatus = Convert.ToString(empReader["EmpStatus"]);

                                if (empReader["HireDate"] != DBNull.Value)
                                    employee.HireDate = Convert.ToDateTime(empReader["HireDate"]);

                                if (empReader["BirthDate"] != DBNull.Value)
                                {
                                    employee.BirthDate = Convert.ToDateTime(empReader["BirthDate"]);
                                }
                                if (empReader["JobDescriptionUsage"] != DBNull.Value)
                                    employee.JobDescriptionUsage = Convert.ToUInt16(empReader["JobDescriptionUsage"]);

                                if (empReader["JDCode"] != DBNull.Value)
                                    employee.JDCode = Convert.ToString(empReader["JDCode"]);

                                if (empReader["JobDescriptionCode"] != DBNull.Value)
                                    employee.JobCode = Convert.ToString(empReader["JobDescriptionCode"]);

                                if (empReader["DepartmentName"] != DBNull.Value)
                                    employee.DepartmentName = Convert.ToString(empReader["DepartmentName"]);

                                if (empReader["JobDescriptionTitle"] != DBNull.Value)
                                    employee.JobTitle = Convert.ToString(empReader["JobDescriptionTitle"]);

                                if (empReader["JobDescriptionIsRemote"] != DBNull.Value)
                                {
                                    byte JobDescriptionIsRemote = Convert.ToByte(empReader["JobDescriptionIsRemote"]);

                                    if(JobDescriptionIsRemote==1)
                                    {
                                        employee.JDRemote = "R";
                                    }
                                    else
                                    {
                                        employee.JDRemote = "P";
                                    }
                                }
                                    

                                employee.Organization = Convert.ToString(empReader["CompanyOrganization"]);
                                employee.Company = Convert.ToString(empReader["CompanyContract"]);
                                employee.CompanyLocation = Convert.ToString(empReader["CompanyLocation"]);

                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    if (employees.Any(i => i.IdEmployee == Convert.ToInt32(empReader["IdEmployee"])))
                                    {
                                        EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();
                                        if (empReader["IdEmployee"] != DBNull.Value)
                                            employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                        if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                        if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                            employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                        employees.Where(i => i.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(i => i.EmployeeContractSituations.Add(employeeContractSituation));
                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetEmployeesForOrganizationChart_V2050(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            foreach (var itememp in employees.GroupBy(i => i.IdEmployee))
            {
                EmployeeOrganizationChart itememployee = employees.Where(i => i.IdEmployee == itememp.Key).FirstOrDefault();
                if (itememployee.EmployeeContractSituations != null && itememployee.EmployeeContractSituations.Count > 0)
                {
                    // itememp.HireDate = itememp.EmployeeContractSituations.FirstOrDefault().ContractSituationStartDate;
                    itememployee.LengthOfServiceString = CalculateLengthOfService(itememployee.EmployeeContractSituations);
                }
                employees.Where(i => i.IdEmployee == itememp.Key).ToList().ForEach(i => i.LengthOfServiceString = itememployee.LengthOfServiceString);
            }


            Log4NetLogger.Logger.Log("Executed GetEmployeesForOrganizationChart_V2050().", category: Category.Info, priority: Priority.Low);
            return employees;
        }

        public List<Employee> GetAllEmployeesForAttendanceByIdCompany_V2060(string workbenchConnectionString, string employeesProfileImagePath, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<Employee> employees = new List<Employee>();

            using (MySqlConnection connEmployees = new MySqlConnection(workbenchConnectionString))
            {
                connEmployees.Open();

                MySqlCommand empCommand = new MySqlCommand("Hrm_GetAllEmployeesForAttendanceByIdCompany_V2060", connEmployees);
                empCommand.CommandType = CommandType.StoredProcedure;
                empCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                empCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                empCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                empCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                empCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader empReader = empCommand.ExecuteReader())
                {
                    if (empReader.NextResult())
                        while (empReader.Read())
                        {
                            try
                            {
                                Employee employee = new Employee();

                                employee.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                if (empReader["EmployeeCode"] != DBNull.Value)
                                    employee.EmployeeCode = Convert.ToString(empReader["EmployeeCode"]);

                                if (empReader["FirstName"] != DBNull.Value)
                                    employee.FirstName = Convert.ToString(empReader["FirstName"]);

                                if (empReader["LastName"] != DBNull.Value)
                                    employee.LastName = Convert.ToString(empReader["LastName"]);

                                if (empReader["NativeName"] != DBNull.Value)
                                    employee.NativeName = Convert.ToString(empReader["NativeName"]);

                                if (empReader["IdGender"] != DBNull.Value)
                                    employee.IdGender = Convert.ToUInt32(empReader["IdGender"]);

                                if (empReader["JDCodes"] != DBNull.Value)
                                {

                                    employee.EmpJobCodes = Convert.ToString(empReader["JDCodes"]);

                                    string[] LstJDCodes = employee.EmpJobCodes.Split('\n');
                                    employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (empReader["JDTitles"] != DBNull.Value)
                                {
                                    employee.EmployeeJobTitles = Convert.ToString(empReader["JDTitles"]);

                                    string[] LstJDTitles = employee.EmployeeJobTitles.Split('\n');
                                    employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (empReader["DeptNames"] != DBNull.Value)
                                {
                                    employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(empReader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }

                                if (empReader["ExitDate"] != DBNull.Value)
                                {
                                    employee.EmployeeExitEvents = new List<EmployeeExitEvent>();
                                    foreach (string itemExitDate in Convert.ToString(empReader["ExitDate"]).Split(',').ToList<string>())
                                    {
                                        if (!String.IsNullOrEmpty(itemExitDate))
                                        {
                                            EmployeeExitEvent employeeExitEvent = new EmployeeExitEvent();
                                            employeeExitEvent.IdEmployee = employee.IdEmployee;
                                            employeeExitEvent.ExitDate= Convert.ToDateTime(itemExitDate);
                                            employee.EmployeeExitEvents.Add(employeeExitEvent);
                                        }
                                    }
                                }

                                if (empReader["companies"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyAlias = Convert.ToString(empReader["companies"]);
                                    string[] LstAlias = employee.EmployeeCompanyAlias.Split('\n');
                                    employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }


                                if (empReader["companiesIds"] != DBNull.Value)
                                {
                                    employee.EmployeeCompanyIds = Convert.ToString(empReader["companiesIds"]);
                                }


                                if (empReader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employee.IdCompanyShift = Convert.ToInt32(empReader["IdCompanyShift"]);
                                    employee.CompanyShift = new CompanyShift();
                                    employee.CompanyShift.IdCompanyShift = employee.IdCompanyShift;


                                    if (empReader["MonBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.MonBreakTime = (TimeSpan)empReader["MonBreakTime"];

                                    if (empReader["TueBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.TueBreakTime = (TimeSpan)empReader["TueBreakTime"];

                                    if (empReader["WedBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.WedBreakTime = (TimeSpan)empReader["WedBreakTime"];

                                    if (empReader["ThuBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.ThuBreakTime = (TimeSpan)empReader["ThuBreakTime"];

                                    if (empReader["FriBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.FriBreakTime = (TimeSpan)empReader["FriBreakTime"];

                                    if (empReader["SatBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SatBreakTime = (TimeSpan)empReader["SatBreakTime"];

                                    if (empReader["SunBreakTime"] != DBNull.Value)
                                        employee.CompanyShift.SunBreakTime = (TimeSpan)empReader["SunBreakTime"];

                                    if (empReader["IdCompanySchedule"] != DBNull.Value)
                                    {
                                        employee.CompanyShift.IdCompanySchedule = Convert.ToInt32(empReader["IdCompanySchedule"]);
                                        employee.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                        employee.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employee.CompanyShift.IdCompanySchedule;

                                        if (empReader["Year"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(empReader["Year"]);

                                        if (empReader["DailyHoursCount"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(empReader["DailyHoursCount"]);

                                        if (empReader["WorkingDays"] != DBNull.Value)
                                            employee.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(empReader["WorkingDays"]);
                                    }
                                }

                                employee.EmployeeContractSituation = new EmployeeContractSituation();

                                if (empReader["CurrentContractStartDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["CurrentContractStartDate"]);

                                if (empReader["CurrentContractEndDate"] != DBNull.Value)
                                    employee.EmployeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["CurrentContractEndDate"]);

                                if (empReader["ContractIdCompany"] != DBNull.Value)
                                {
                                    employee.EmployeeContractSituation.Company = new Company();
                                    employee.EmployeeContractSituation.Company.IdCompany = Convert.ToInt32(empReader["ContractIdCompany"]);
                                    employee.EmployeeContractSituation.Company.Alias = Convert.ToString(empReader["ContractCompany"]);
                                }
                                employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                                employees.Add(employee);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2060(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    if (empReader.NextResult())
                        while (empReader.Read())
                        { 
                            try
                            {
                                if (empReader["IdEmployee"] != DBNull.Value)
                                {
                                    EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                    employeeContractSituation.IdEmployee = Convert.ToInt32(empReader["IdEmployee"]);

                                    employeeContractSituation.Company = new Company();
                                    if (empReader["IdCompany"] != DBNull.Value)
                                        employeeContractSituation.IdCompany = Convert.ToInt32(empReader["IdCompany"]);
                                   
                                    if (empReader["ContractSituationStartDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(empReader["ContractSituationStartDate"]);

                                    if (empReader["ContractSituationEndDate"] != DBNull.Value)
                                        employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(empReader["ContractSituationEndDate"]);

                                    if (empReader["Alias"] != DBNull.Value)
                                        employeeContractSituation.Company.Alias = Convert.ToString(empReader["Alias"]);

                                    Employee employee = employees.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).FirstOrDefault();
                                    employee.EmployeeContractSituations.Add(employeeContractSituation);
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetAllEmployeesForAttendanceByIdCompany_V2060(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                }
            }

            employees = employees.OrderBy(x => x.FullName).ToList();
            return employees;
        }


        public EmployeeAttendance AddEmployeeAttendance_V2060(string mainServerWorkbenchConnectionString, EmployeeAttendance employeeAttendance)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerWorkbenchConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("Hrm_EmployeeAttendanceInsert_V2060", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdEmployee", employeeAttendance.IdEmployee);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyWork", employeeAttendance.IdCompanyWork);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyShift", employeeAttendance.IdCompanyShift);
                        mySqlCommand.Parameters.AddWithValue("_StartDate", employeeAttendance.StartDate);
                        mySqlCommand.Parameters.AddWithValue("_EndDate", employeeAttendance.EndDate);
                        mySqlCommand.Parameters.AddWithValue("_AccountingDate", employeeAttendance.AccountingDate);
                        mySqlCommand.Parameters.AddWithValue("_IsManual", employeeAttendance.IsManual);

                        employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddEmployeeAttendance_V2060(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return employeeAttendance;
        }


        public List<EmployeeAttendance> GetSelectedIdCompanyEmployeeAttendance_V2060(string workbenchConnectionString, string idCompany, long selectedPeriod, string idsOrganization, string idsDepartment, Int32 idPermission)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();
            DataSet dataSet = new DataSet();
            List<GeosAppSetting> appSetting = new List<GeosAppSetting>();
            List<Int32> BreakWTIdCompanyWork = new List<Int32>();
            UserManager usrManager = new UserManager();
            appSetting = usrManager.GetSelectedGeosAppSettings(workbenchConnectionString,"41");
            if (appSetting.Any(i => i.IdAppSetting == 41))
            {
                foreach (string itemSplit in appSetting.Where(i => i.IdAppSetting == 41).Select(i => i.DefaultValue).FirstOrDefault().Split(','))
                {
                    if (BreakWTIdCompanyWork == null)
                        BreakWTIdCompanyWork = new List<int>();

                    BreakWTIdCompanyWork.Add(Convert.ToInt32(itemSplit));
                }

            }
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetSelectedIdCompanyEmployeeAttendance_V2060", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_SelectedPeriod", selectedPeriod);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);
                MySqlDataAdapter da = new MySqlDataAdapter(mySqlCommand);
                da.Fill(dataSet);
            }


            if (dataSet != null && dataSet.Tables.Count > 0)
            {
                if (dataSet.Tables[1] != null && dataSet.Tables[1].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[1].Rows)
                    {
                        try
                        {
                            EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                            if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                            if (reader["IsManual"] != DBNull.Value)
                                employeeAttendance.IsManual = Convert.ToByte(reader["IsManual"]);

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                            }

                            if (reader["AccountingDate"] != DBNull.Value)
                            {
                                employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                            }

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeAttendance.Employee = new Employee();
                                employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["JDCodes"] != DBNull.Value)
                                {

                                    employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                    string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                    employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (reader["JDTitles"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                    string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                    employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (reader["DeptNames"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }


                                if (reader["companies"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                    string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                    employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }

                                if (reader["companiesIds"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                }

                                if (reader["TotalWorkedHours"] != DBNull.Value)
                                {

                                    employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                    //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                    string span = employeeAttendance.Employee.TotalWorkedHours;
                                    employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                               int.Parse(span.Split(':')[1]),    // minutes
                                                               0);
                                }





                                if (reader["IdCompanyWork"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                    employeeAttendance.CompanyWork = new CompanyWork();
                                    employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                    //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                    employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeAttendance.CompanyShift = new CompanyShift();
                                    employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;
                                    if (BreakWTIdCompanyWork.Any(bwc => bwc == employeeAttendance.IdCompanyWork))
                                    {
                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];
                                    }
                                    else
                                    {
                                        employeeAttendance.CompanyShift.BreakTime = new TimeSpan();
                                    }

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["CompanyShiftName"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeAttendance.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employeeAttendance.CompanyShift.CompanySchedule.Company = new Company();
                                    if (reader["ScheduleAlias"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["ScheduleAlias"]);


                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                    if (reader["DailyHoursCount"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                    if (reader["Year"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                    if (reader["WorkingDays"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                }
                            }

                            if (reader["empContractIdCompany"] != DBNull.Value)
                            {
                                employeeAttendance.CompanyContract = new Company();
                                employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                            }


                            employeeAttendance.Employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employeeAttendances.Add(employeeAttendance);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                if (dataSet.Tables[2] != null && dataSet.Tables[2].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[2].Rows)
                    {

                        try
                        {
                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeContractSituation.Company = new Company();
                                if (reader["IdCompany"] != DBNull.Value)
                                    employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                if (reader["ContractSituationStartDate"] != DBNull.Value)
                                    employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                if (reader["ContractSituationEndDate"] != DBNull.Value)
                                    employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                if (reader["Alias"] != DBNull.Value)
                                    employeeContractSituation.Company.Alias = Convert.ToString(reader["Alias"]);

                                employeeAttendances.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(ea => ea.Employee.EmployeeContractSituations.Add(employeeContractSituation));

                            }

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
            }

            employeeAttendances.ToList().ForEach(ea => ea.CurrentContractForAttendance = ea.Employee.EmployeeContractSituations != null ? ea.Employee.EmployeeContractSituations.Where(ecs => ecs.ContractSituationStartDate.Value.Date <= ea.StartDate.Date).Select(i => i.Company.Alias).LastOrDefault() : "");

            return employeeAttendances;
        }

        public List<EmployeeAttendance> GetEmployeeAttendanceShortDetail_V2070(string workbenchConnectionString, string idCompany, string idsOrganization, string idsDepartment, Int32 idPermission, DateTime fromDate, DateTime toDate)
        {
            List<EmployeeAttendance> employeeAttendances = new List<EmployeeAttendance>();
            DataSet dataSet = new DataSet();
            List<GeosAppSetting> appSetting = new List<GeosAppSetting>();
            List<Int32> BreakWTIdCompanyWork = new List<Int32>();
            UserManager usrManager = new UserManager();
            appSetting = usrManager.GetSelectedGeosAppSettings(workbenchConnectionString, "41");
            if (appSetting.Any(i => i.IdAppSetting == 41))
            {
                foreach (string itemSplit in appSetting.Where(i => i.IdAppSetting == 41).Select(i => i.DefaultValue).FirstOrDefault().Split(','))
                {
                    if (BreakWTIdCompanyWork == null)
                        BreakWTIdCompanyWork = new List<int>();

                    BreakWTIdCompanyWork.Add(Convert.ToInt32(itemSplit));
                }

            }
            using (MySqlConnection mySqlConnection = new MySqlConnection(workbenchConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("Hrm_GetEmployeeAttendanceShortDetail_V2070", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdCompany", idCompany);
                mySqlCommand.Parameters.AddWithValue("_idsOrganization", idsOrganization);
                mySqlCommand.Parameters.AddWithValue("_idsDepartment", idsDepartment);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);
                mySqlCommand.Parameters.AddWithValue("_fromDate", fromDate);
                mySqlCommand.Parameters.AddWithValue("_toDate", toDate);
                MySqlDataAdapter da = new MySqlDataAdapter(mySqlCommand);
                da.Fill(dataSet);
            }


            if (dataSet != null && dataSet.Tables.Count > 0)
            {
                if (dataSet.Tables[1] != null && dataSet.Tables[1].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[1].Rows)
                    {
                        try
                        {
                            EmployeeAttendance employeeAttendance = new EmployeeAttendance();

                            if (reader["IdEmployeeAttendance"] != DBNull.Value)
                                employeeAttendance.IdEmployeeAttendance = Convert.ToInt64(reader["IdEmployeeAttendance"]);

                            if (reader["IsManual"] != DBNull.Value)
                                employeeAttendance.IsManual = Convert.ToByte(reader["IsManual"]);

                            if (reader["StartDate"] != DBNull.Value)
                            {
                                employeeAttendance.StartDate = Convert.ToDateTime(reader["StartDate"]);
                                employeeAttendance.StartTime = Convert.ToDateTime(reader["StartDate"]).TimeOfDay;

                                employeeAttendance.WeekNumber = currentCulture.Calendar.GetWeekOfYear(employeeAttendance.StartDate, CalendarWeekRule.FirstDay, DayOfWeek.Monday);
                            }

                            if (reader["EndDate"] != DBNull.Value)
                            {
                                employeeAttendance.EndDate = Convert.ToDateTime(reader["EndDate"]);
                                employeeAttendance.EndTime = Convert.ToDateTime(reader["EndDate"]).TimeOfDay;
                            }

                            if (reader["AccountingDate"] != DBNull.Value)
                            {
                                employeeAttendance.AccountingDate = Convert.ToDateTime(reader["AccountingDate"]);
                            }

                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                employeeAttendance.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);

                                employeeAttendance.Employee = new Employee();
                                employeeAttendance.Employee.IdEmployee = employeeAttendance.IdEmployee;
                                employeeAttendance.Employee.EmployeeCode = Convert.ToString(reader["EmployeeCode"]);
                                employeeAttendance.Employee.FirstName = Convert.ToString(reader["FirstName"]);
                                employeeAttendance.Employee.LastName = Convert.ToString(reader["LastName"]);

                                if (reader["JDCodes"] != DBNull.Value)
                                {

                                    employeeAttendance.Employee.EmpJobCodes = Convert.ToString(reader["JDCodes"]);

                                    string[] LstJDCodes = employeeAttendance.Employee.EmpJobCodes.Split('\n');
                                    employeeAttendance.Employee.EmpJobCodes = string.Join("\n", LstJDCodes.Distinct());
                                }


                                if (reader["JDTitles"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeJobTitles = Convert.ToString(reader["JDTitles"]);

                                    string[] LstJDTitles = employeeAttendance.Employee.EmployeeJobTitles.Split('\n');
                                    employeeAttendance.Employee.EmployeeJobTitles = string.Join("\n", LstJDTitles.Distinct());
                                }

                                if (reader["DeptNames"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.LstEmployeeDepartments = new List<Department>();
                                    foreach (string itemDepartment in Convert.ToString(reader["DeptNames"]).Split('\n').ToList<string>())
                                    {
                                        string[] itemDepartmentSplit = itemDepartment.Split('^');
                                        if (itemDepartmentSplit != null)
                                        {
                                            Department department = new Department();
                                            department.DepartmentName = itemDepartmentSplit[0].ToString();
                                            if (itemDepartmentSplit.Count() > 1)
                                                department.DepartmentHtmlColor = itemDepartmentSplit[1].ToString();

                                            if (!employeeAttendance.Employee.LstEmployeeDepartments.Any(i => i.DepartmentName == department.DepartmentName))
                                                employeeAttendance.Employee.LstEmployeeDepartments.Add(department);
                                        }

                                    }
                                }


                                if (reader["companies"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeCompanyAlias = Convert.ToString(reader["companies"]);
                                    string[] LstAlias = employeeAttendance.Employee.EmployeeCompanyAlias.Split('\n');
                                    employeeAttendance.Employee.EmployeeCompanyAlias = string.Join("\n", LstAlias.Distinct());
                                }

                                if (reader["companiesIds"] != DBNull.Value)
                                {
                                    employeeAttendance.Employee.EmployeeCompanyIds = Convert.ToString(reader["companiesIds"]);

                                }

                                if (reader["TotalWorkedHours"] != DBNull.Value)
                                {

                                    employeeAttendance.Employee.TotalWorkedHours = Convert.ToString(reader["TotalWorkedHours"]);

                                    //employeeAttendance.TotalTime = DateTime.Parse(Convert.ToString(reader["TotalWorkedHours"])).TimeOfDay;

                                    string span = employeeAttendance.Employee.TotalWorkedHours;
                                    employeeAttendance.TotalTime = new TimeSpan(int.Parse(span.Split(':')[0]),    // hours
                                                               int.Parse(span.Split(':')[1]),    // minutes
                                                               0);
                                }





                                if (reader["IdCompanyWork"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyWork = Convert.ToInt32(reader["IdCompanyWork"].ToString());
                                    employeeAttendance.CompanyWork = new CompanyWork();
                                    employeeAttendance.CompanyWork.IdCompanyWork = employeeAttendance.IdCompanyWork;
                                    //   employeeAttendance.CompanyWork.IdCompany = Convert.ToInt32(reader["IdCompany"]);
                                    employeeAttendance.CompanyWork.Name = Convert.ToString(reader["CompanyWorkName"]);
                                    employeeAttendance.CompanyWork.HtmlColor = Convert.ToString(reader["CompanyWorkColor"]);
                                }

                                if (reader["IdCompanyShift"] != DBNull.Value)
                                {
                                    employeeAttendance.IdCompanyShift = Convert.ToInt32(reader["IdCompanyShift"]);
                                    employeeAttendance.CompanyShift = new CompanyShift();
                                    employeeAttendance.CompanyShift.IdCompanyShift = employeeAttendance.IdCompanyShift;
                                    if (BreakWTIdCompanyWork.Any(bwc => bwc == employeeAttendance.IdCompanyWork))
                                    {
                                        if (reader["BreakTime"] != DBNull.Value)
                                            employeeAttendance.CompanyShift.BreakTime = (TimeSpan)reader["BreakTime"];
                                    }
                                    else
                                    {
                                        employeeAttendance.CompanyShift.BreakTime = new TimeSpan();
                                    }

                                    if (reader["IsNightShift"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.IsNightShift = Convert.ToSByte(reader["IsNightShift"]);

                                    if (reader["CompanyShiftName"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.Name = Convert.ToString(reader["CompanyShiftName"]);

                                    employeeAttendance.CompanyShift.IdCompanySchedule = Convert.ToInt32(reader["IdCompanySchedule"]);
                                    employeeAttendance.CompanyShift.CompanySchedule = new CompanySchedule();
                                    employeeAttendance.CompanyShift.CompanySchedule.Company = new Company();
                                    if (reader["ScheduleAlias"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanySchedule.Company.Alias = Convert.ToString(reader["ScheduleAlias"]);


                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule = new CompanyAnnualSchedule();
                                    employeeAttendance.CompanyShift.CompanyAnnualSchedule.IdCompanySchedule = employeeAttendance.CompanyShift.IdCompanySchedule;

                                    if (reader["DailyHoursCount"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.DailyHoursCount = Convert.ToDecimal(reader["DailyHoursCount"]);

                                    if (reader["Year"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.Year = Convert.ToInt32(reader["Year"]);

                                    if (reader["WorkingDays"] != DBNull.Value)
                                        employeeAttendance.CompanyShift.CompanyAnnualSchedule.WorkingDays = Convert.ToString(reader["WorkingDays"]);
                                }
                            }

                            if (reader["empContractIdCompany"] != DBNull.Value)
                            {
                                employeeAttendance.CompanyContract = new Company();
                                employeeAttendance.CompanyContract.IdCompany = Convert.ToInt32(reader["empContractIdCompany"]);
                                employeeAttendance.CompanyContract.Alias = Convert.ToString(reader["empContractCompanyAlias"]);

                            }


                            employeeAttendance.Employee.EmployeeContractSituations = new List<EmployeeContractSituation>();
                            employeeAttendances.Add(employeeAttendance);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                if (dataSet.Tables[2] != null && dataSet.Tables[2].Rows.Count > 0)
                    foreach (DataRow reader in dataSet.Tables[2].Rows)
                    {

                        try
                        {
                            if (reader["IdEmployee"] != DBNull.Value)
                            {
                                EmployeeContractSituation employeeContractSituation = new EmployeeContractSituation();

                                employeeContractSituation.IdEmployee = Convert.ToInt32(reader["IdEmployee"]);
                                employeeContractSituation.Company = new Company();
                                if (reader["IdCompany"] != DBNull.Value)
                                    employeeContractSituation.IdCompany = Convert.ToInt32(reader["IdCompany"]);

                                if (reader["ContractSituationStartDate"] != DBNull.Value)
                                    employeeContractSituation.ContractSituationStartDate = Convert.ToDateTime(reader["ContractSituationStartDate"]);

                                if (reader["ContractSituationEndDate"] != DBNull.Value)
                                    employeeContractSituation.ContractSituationEndDate = Convert.ToDateTime(reader["ContractSituationEndDate"]);

                                if (reader["Alias"] != DBNull.Value)
                                    employeeContractSituation.Company.Alias = Convert.ToString(reader["Alias"]);

                                employeeAttendances.Where(emp => emp.IdEmployee == employeeContractSituation.IdEmployee).ToList().ForEach(ea => ea.Employee.EmployeeContractSituations.Add(employeeContractSituation));

                            }

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetSelectedIdCompanyEmployeeAttendance_V2045(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
            }

            employeeAttendances.ToList().ForEach(ea => ea.CurrentContractForAttendance = ea.Employee.EmployeeContractSituations != null ? ea.Employee.EmployeeContractSituations.Where(ecs => ecs.ContractSituationStartDate.Value.Date <= ea.StartDate.Date).Select(i => i.Company.Alias).LastOrDefault() : "");

            return employeeAttendances;
        }

    }
}

