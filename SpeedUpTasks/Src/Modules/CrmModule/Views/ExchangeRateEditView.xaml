<dxwui:WinUIDialogWindow x:Class="Emdep.Geos.Modules.Crm.Views.ExchangeRateEditView"
                         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                         xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
                         xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
                         xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts"
                         xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
                         xmlns:dxpg="http://schemas.devexpress.com/winfx/2008/xaml/pivotgrid"
                         xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
                         xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core" 
                         xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
                         xmlns:Converter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
                         xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
                         xmlns:behaviors="clr-namespace:Emdep.Geos.UI.Behaviors;assembly=Emdep.Geos.UI.Common"
                         xmlns:ViewModels="clr-namespace:Emdep.Geos.Modules.Crm.ViewModels" 
                         mc:Ignorable="d" 
                         d:DesignHeight="300"
                         Style="{DynamicResource WinUIDialogWindowStyle}">

    <!--<dxwui:WinUIDialogWindow.DataContext>
        <ViewModels:ExchangeRateEditViewModel/>
    </dxwui:WinUIDialogWindow.DataContext>-->

    <dxwui:WinUIDialogWindow.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding ExchangeRateEditCancelCommand}" />
    </dxwui:WinUIDialogWindow.InputBindings>
    
    <dxwui:WinUIDialogWindow.Resources>
        <UIHelper:ColumnTemplateSelector x:Key="ColumnTemplateSelector"/>
        <UIHelper:CellTemplateSelector x:Key="templateSelector" />

        <DataTemplate x:Key="ImageWithTextColumnTemplate">
            <StackPanel  VerticalAlignment="Center" HorizontalAlignment="Stretch">
                <Image Source="{Binding Converter={Converter:ByteArrayToImage}}"  Width="25" Height="25" VerticalAlignment="Center" HorizontalAlignment="Center" />
                <TextBlock Text="{ Binding DisplayText}" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" />
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="DefaultCellTemplateLead">
            <StackPanel Orientation="Vertical"  Name="PART_Editor" >
                <TextBlock  Text="{Binding DisplayText}" TextWrapping="Wrap" Height="15" Style="{DynamicResource TextBlock10Style}"/>
            </StackPanel>
        </DataTemplate>
    </dxwui:WinUIDialogWindow.Resources>

    <Grid>
        <DockPanel LastChildFill="True">
            <Grid DockPanel.Dock="Top"  >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="10*" />
                </Grid.ColumnDefinitions>
                <Label Content="Edit Exchange Rate"	HorizontalAlignment="Left"
                       VerticalAlignment="Top" Margin="40,-50,0,0" Style="{DynamicResource LabelTitleStyle}" Grid.Column="0"/>
            </Grid>

            <Grid DockPanel.Dock="Bottom">
                <Grid.Resources>
                    <DataTemplate x:Key="FieldValueTemplate">
                        <Label Content="{Binding DisplayText, Mode=OneWay}" Foreground="Black"  HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                    </DataTemplate >
                </Grid.Resources>

                <Grid.RowDefinitions >
                    <RowDefinition Height="100"/>
                    <RowDefinition Height="50"/>
                </Grid.RowDefinitions>

                <dxpg:PivotGridControl  Name="pivotGridControl1" DockPanel.Dock="Right" Grid.Row="0" Height="Auto" 
                                        DataSource = "{Binding DataTableExchangeRateEdit,Mode=TwoWay}" Tag="{Binding}"
                                        ShowFilterHeaders="False" ChartSelectionOnly="False"
                                        RowFieldValuesAlignment="Center"
                                        ColumnFieldValuesAlignment="Center"
                                        IsPrefilterEnabled="False"
                                        ShowColumnHeaders = "False"
                                        ShowRowHeaders ="False"    
                                        ShowColumnTotals = "False"
                                        ShowColumnGrandTotals="False"
                                        ShowDataHeaders = "False"
                                        ShowRowGrandTotals="False"
                                        ShowRowGrandTotalHeader = "False"
                                        ShowRowTotals = "False"  
                                        ShowTotalsForSingleValues="False"
                                        AllowExpand = "False"
                                        AllowFilter = "False"
                                        AllowFilterInFieldList = "False"
                                        AllowSort = "False"
                                        RowTotalsLocation="Far"
                                        PrintColumnHeaders="False"
                                        PrintDataHeaders="False"
                                        FixedRowHeaders="False" 
                                        BestFitMaxRowCount="34" 
                                        AllowExpandOnDoubleClick="False">
                    <dxpg:PivotGridControl.Fields>
                        <dxpg:PivotGridField Area="ColumnArea" FieldName="CurrencyTo"  TotalsVisibility="None" RunningTotal="False" Height="50"  Width="80">
                            <dxpg:PivotGridField.ValueTemplate>
                                <DataTemplate>
                                    <StackPanel  VerticalAlignment="Center" HorizontalAlignment="Stretch">
                                        <Image Source="{Binding Converter={Converter:ByteArrayToImageCurrencyTo}}"  Width="25" Height="25" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{ Binding DisplayText}" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </DataTemplate>
                            </dxpg:PivotGridField.ValueTemplate>
                        </dxpg:PivotGridField>

                        <dxpg:PivotGridField Area="RowArea" FieldName="Currency" Width="90" Height="50" TotalsVisibility="None"  RunningTotal="False"  PrintCellTemplate="{StaticResource ImageWithTextColumnTemplate}"  >
                            <dxpg:PivotGridField.ValueTemplate>
                                <DataTemplate>
                                    <StackPanel  VerticalAlignment="Center" HorizontalAlignment="Stretch">
                                        <Image Source="{Binding Converter={Converter:ByteArrayToImage}}"  Width="25" Height="25" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{ Binding DisplayText}" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </dxpg:PivotGridField.ValueTemplate>
                        </dxpg:PivotGridField>

                        <dxpg:PivotGridField Area="DataArea"  Name="fieldExtendedPrice"  
                                             FieldName="ExchangeRate" Width="80" TotalsVisibility="None" 
                                             RunningTotal="False"  Visible="True" SummaryType="Max" >
                            <dxpg:PivotGridField.CellTemplate>
                                <DataTemplate>
                                    <dxe:TextEdit x:Name="edit" MaskType="Numeric" 
                                                  EditMode="InplaceInactive"
                                                  EditValue="{Binding  Converter={Converter:CellContentConverter},Mode=OneWay,UpdateSourceTrigger=LostFocus}" 
                                                  TextWrapping="Wrap" 
                                                  HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsReadOnly="True" >
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="MouseDown">
                                                <i:InvokeCommandAction Command="{Binding DataContext.ExchangeRateMouseDownCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=dxwui:WinUIDialogWindow}}" CommandParameter="{Binding ElementName=edit}" />
                                            </i:EventTrigger>
                                            <i:EventTrigger EventName="KeyDown" >
                                                <i:InvokeCommandAction Command="{Binding DataContext.ExchangeRateEditCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=dxwui:WinUIDialogWindow}}" CommandParameter="{Binding ElementName=edit}" />
                                            </i:EventTrigger>
                                            <i:EventTrigger EventName="LostFocus" >
                                                <i:InvokeCommandAction Command="{Binding DataContext.ExchangeRateLostFocusCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=dxwui:WinUIDialogWindow}}" CommandParameter="{Binding ElementName=edit}" />
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </dxe:TextEdit>

                                </DataTemplate>
                            </dxpg:PivotGridField.CellTemplate>

                        </dxpg:PivotGridField>
                    </dxpg:PivotGridControl.Fields>
                    <dxpg:PivotGridControl.PrintFieldValueTemplateSelector>
                        <UIHelper:PivotGridCellTemplateSelector 
                                                ExchangeRateTemplate="{StaticResource ResourceKey=DefaultCellTemplateLead}"
                                                ImageWithText="{StaticResource ResourceKey=ImageWithTextColumnTemplate}" />
                    </dxpg:PivotGridControl.PrintFieldValueTemplateSelector>

                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand EventName="CellDoubleClick" Command="{Binding CommandGridDoubleClick}" >
                            <dxmvvm:EventToCommand.EventArgsConverter>
                                <Converter:PivotCellEventArgsConverter/>
                            </dxmvvm:EventToCommand.EventArgsConverter>
                        </dxmvvm:EventToCommand>

                        <dxmvvm:EventToCommand EventName="MouseDoubleClick" Command="{Binding CommandGridDoubleClick}" >
                            <dxmvvm:EventToCommand.EventArgsConverter>
                                <Converter:PivotMouseEventArgsConverter/>
                            </dxmvvm:EventToCommand.EventArgsConverter>
                        </dxmvvm:EventToCommand>

                        <dxmvvm:EventToCommand EventName="CellClick" Command="{Binding CommandGridDoubleClick}" >
                            <dxmvvm:EventToCommand.EventArgsConverter>
                                <Converter:PivotMouseEventArgsConverter/>
                            </dxmvvm:EventToCommand.EventArgsConverter>
                        </dxmvvm:EventToCommand>
                    </dxmvvm:Interaction.Behaviors>
                </dxpg:PivotGridControl>

                <StackPanel  HorizontalAlignment="Center" Orientation="Horizontal"  Grid.Row="1">
                    <Button Content="Accept" Height="30" Width="100" Margin="0,0,30,0" VerticalAlignment="Bottom" Command="{Binding ExchangeRateEditAcceptCommand}"/>
                    <Button Content="Cancel" Height="30" Width="100" Margin="30,0,0,0" VerticalAlignment="Bottom" Command="{Binding ExchangeRateEditCancelCommand}"/>
                </StackPanel>
            </Grid>
        </DockPanel>
    </Grid>
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="KeyDown">
            <behaviors:InvokeDelegateCommandAction Command="{Binding CommandTextInput}" CommandParameter="{Binding Path=InvokeParameter, RelativeSource={RelativeSource Self}}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
</dxwui:WinUIDialogWindow>
