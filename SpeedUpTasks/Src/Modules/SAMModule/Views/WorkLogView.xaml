<dxwui:WinUIDialogWindow x:Class="Emdep.Geos.Modules.SAM.Views.WorkLogView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Emdep.Geos.Modules.SAM.Views"
             xmlns:Converters="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui" 
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:dxga="http://schemas.devexpress.com/winfx/2008/xaml/gauges"            
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
             xmlns:ve="http://schemas.devexpress.com/winfx/2008/xaml/docking/visualelements"
             xmlns:sysglb="clr-namespace:System.Globalization;assembly=mscorlib"
             xmlns:behaviors="clr-namespace:Emdep.Geos.UI.Behaviors;assembly=Emdep.Geos.UI.Common"
             xmlns:dxnav="http://schemas.devexpress.com/winfx/2008/xaml/navigation"
             xmlns:dxn="http://schemas.devexpress.com/winfx/2008/xaml/navbar"
             xmlns:dxwuin="http://schemas.devexpress.com/winfx/2008/xaml/windowsui/navigation"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"   
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             Height="{Binding SystemParameters.PrimaryScreenHeight}" 
             Width="{Binding SystemParameters.PrimaryScreenWidth}"
             mc:Ignorable="d" >

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="PreviewTextInput">
            <behaviors:InvokeDelegateCommandAction Command="{Binding CommandScanBarcode}" CommandParameter="{Binding Path=InvokeParameter, RelativeSource={RelativeSource Self}}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>


    <dxwui:WinUIDialogWindow.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding CommandCancelButton}" />
    </dxwui:WinUIDialogWindow.InputBindings>

    <dxwui:WinUIDialogWindow.Resources>
        <ControlTemplate x:Key="DigitalGaugeControlTemplate">
            <Grid>
                <Rectangle>
                    <Rectangle.Fill>
                        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0" MappingMode="RelativeToBoundingBox">
                            <GradientStop Color="Transparent" Offset="1"/>
                            <GradientStop Color="Transparent" Offset="0"/>
                        </LinearGradientBrush>
                    </Rectangle.Fill>
                </Rectangle>
            </Grid>
        </ControlTemplate>

        <system:Double x:Key="FontSize15">15</system:Double>
        <system:Double x:Key="FontSize18">18</system:Double>
        <system:Double x:Key="FontSize19">19</system:Double>
        <system:Double x:Key="FontSize24">24</system:Double>
        <system:Double x:Key="FontSize33">33</system:Double>
        <system:Double x:Key="FontSize35">35</system:Double>

        <Style x:Key="CustomGroupBoxStyle" TargetType="{x:Type dxlc:GroupBox}">
            <Setter Property="Padding" Value="0"/>
        </Style>

    </dxwui:WinUIDialogWindow.Resources>

    <!--Height="{Binding DialogHeight}" Width="{Binding DialogWidth}"-->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="30"/>
            <RowDefinition Height="40"/>
          
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="100"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="5"/>
        </Grid.ColumnDefinitions>

        <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding WindowHeader}" FontSize="{StaticResource FontSize33}" FontWeight="Bold" HorizontalAlignment="Left" VerticalAlignment="Top"></TextBlock>
        
        <StackPanel Grid.Row="2" Grid.Column="2" Orientation="Horizontal"   VerticalAlignment="Top">
            <TextBlock Text="{DynamicResource WorklogWorkOrder}" FontSize="{StaticResource FontSize24}" HorizontalAlignment="Left" Margin="5,0,0,0" ></TextBlock>
            <TextBlock Text="{Binding WorkOrder}" Margin="10 0 0 0"  FontSize="{StaticResource FontSize24}" ></TextBlock>
        </StackPanel>


        <dxlc:LayoutGroup Grid.Row="4" Grid.Column="2" View="GroupBox" GroupBoxStyle="{StaticResource CustomGroupBoxStyle}"
                              HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                              IsCollapsible="False" IsCollapsed="False">
            <dxlc:LayoutGroup.HeaderTemplate>
                <DataTemplate>
                    <Grid>
                        <TextBlock Text="{DynamicResource operator}" FontWeight="Bold"  FontSize="{StaticResource FontSize24}" Margin="5,0,0,0" VerticalAlignment="Center"></TextBlock>
                        <!--<TextBlock Text="{DynamicResource operator}" Grid.Row="4" Grid.Column="2" FontWeight="Bold"  FontSize="{StaticResource FontSize24}" Margin="5,0,0,0" VerticalAlignment="Center"></TextBlock>-->
                    </Grid>
                </DataTemplate>
            </dxlc:LayoutGroup.HeaderTemplate>

            <UIHelper:GridControlWithoutClickEx AllowLiveDataShaping ="True" VerticalAlignment="Stretch" VerticalContentAlignment="Center" 
                                      HorizontalAlignment="Stretch"  ShowBorder="True" 
                                      ItemsSource="{Binding OtWorkingTimeList,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"
                                      SelectionMode="None"
                                                Height="238">

                <dxg:GridColumn Header=" " FieldName="" Width="20" AllowColumnFiltering ="False" AllowSorting="False">
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>

                            <Image Name="image" VerticalAlignment="Top" HorizontalAlignment="Center"
                                             Height="50" Width="50"  Stretch="Fill" Margin="0,5,0,5">
                                <Image.Style>
                                    <Style TargetType="{x:Type Image}">
                                        <Setter Property="Source" Value="{Binding RowData.Row.UserShortDetail.UserImageInBytes, Converter={Converters:ByteArrayToImageConverter}}"></Setter>
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding RowData.Row.UserShortDetail.UserImageInBytes}" Value="{x:Null}"/>
                                                    <Condition Binding="{Binding RowData.Row.UserShortDetail.IdUserGender}" Value="2"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Source" Value="{DynamicResource MaleUserImage}"/>
                                            </MultiDataTrigger>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding RowData.Row.UserShortDetail.UserImageInBytes}" Value="{x:Null}"/>
                                                    <Condition Binding="{Binding RowData.Row.UserShortDetail.IdUserGender}" Value="1"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Source" Value="{DynamicResource FemaleUserImage}"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>

                                </Image.Style>

                            </Image>

                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>

                <dxg:GridColumn Header="{DynamicResource FullName}" FieldName="UserShortDetail.UserName"  AllowColumnFiltering ="False" AllowSorting="False" />

                <dxg:GridColumn Header="{DynamicResource LoggedTime}" HorizontalHeaderContentAlignment="Center"   AllowColumnFiltering ="False" AllowSorting="False"  Width="50" UnboundType="Datetime" FieldName="Timer">
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <dxga:DigitalGaugeControl Grid.Row="1" Name="gaugeControl" Margin="5"
                                      VerticalAlignment="Stretch" HorizontalAlignment="Center"
                                      Text="{Binding RowData.Row.TotalTimeInString,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}" EnableAnimation="True">
                                <dxga:DigitalGaugeControl.Layers>
                                    <dxga:DigitalGaugeLayer>
                                        <dxga:DigitalGaugeLayer.Presentation>
                                            <dxga:CustomDigitalGaugeLayerPresentation GaugeLayerTemplate="{StaticResource DigitalGaugeControlTemplate}"/>
                                        </dxga:DigitalGaugeLayer.Presentation>
                                    </dxga:DigitalGaugeLayer>
                                </dxga:DigitalGaugeControl.Layers>
                                <dxga:DigitalGaugeControl.SymbolView>
                                    <dxga:SevenSegmentsView Height="Auto" Width="Auto">
                                        <dxga:SevenSegmentsView.Animation>
                                            <dxga:BlinkingAnimation RefreshTime="00:000:00.5" SymbolsStates="0 0 1 0 0"/>
                                        </dxga:SevenSegmentsView.Animation>
                                        <dxga:SevenSegmentsView.Presentation>
                                            <dxga:DefaultSevenSegmentsPresentation FillActive="{DynamicResource SAMColor}" />
                                        </dxga:SevenSegmentsView.Presentation>
                                    </dxga:SevenSegmentsView>
                                </dxga:DigitalGaugeControl.SymbolView>
                                <dxga:DigitalGaugeControl.Model>
                                    <dxga:DigitalDefaultModel InnerPadding="0"/>
                                </dxga:DigitalGaugeControl.Model>
                            </dxga:DigitalGaugeControl>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>

                <dxg:GridColumn Width="45" FieldName=" " FixedWidth="True" AllowMoving="False" AllowColumnFiltering="false" >
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <Image Name="image" Height="30" Width="30"  Margin="10,5,5,5" >
                                <Image.Style>
                                    <Style TargetType="{x:Type Image}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding RowData.Row.IsTimerStarted}" Value="true">
                                                <Setter Property="Source" Value="{DynamicResource StartImage}" />
                                                <Setter Property="ToolTip" Value="{DynamicResource Start}" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding RowData.Row.IsTimerStarted}" Value="false">
                                                <Setter Property="Source" Value="{DynamicResource StopImage}" />
                                                <Setter Property="ToolTip" Value="{DynamicResource Stop}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>

                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>

                <dxmvvm:Interaction.Behaviors>
                    <UIHelper:GridTimerBehavior/>
                </dxmvvm:Interaction.Behaviors>

                <UIHelper:GridControlWithoutClickEx.View>
                    <dxg:TableView x:Name="ItemsTableView"
                                            ShowGroupPanel="False"
                                            NavigationStyle="None"
                                            ShowColumnHeaders="True"
                                            ShowIndicator="False" 
                                            AutoWidth="True" 
                                            RowMinHeight="60" 
                                            FontSize="35" 
                                            IsColumnMenuEnabled="False"
                                            SearchColumns="False"
                                            HorizontalScrollbarVisibility="Auto"
                                            VerticalScrollbarVisibility="Auto"                                   
                                            IndicatorWidth="60"
                                            FocusedRow="{Binding SelectedWorkLog, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"  >

                        <dxg:TableView.RowStyle>
                            <Style TargetType="dxg:RowControl">
                                <Setter Property="Height" Value="40"/>
                            </Style>
                        </dxg:TableView.RowStyle>



                    </dxg:TableView>
                </UIHelper:GridControlWithoutClickEx.View>
            </UIHelper:GridControlWithoutClickEx>

        </dxlc:LayoutGroup>

        <!--<TextBlock Text="{DynamicResource operator}" Grid.Row="4" Grid.Column="2" FontWeight="Bold"  FontSize="{StaticResource FontSize24}" Margin="5,0,0,0"></TextBlock>-->

        <Label Grid.Row="4" Grid.Column="1" Width="70" Style="{DynamicResource LabelBackgroundImageBrush}" HorizontalAlignment="Right" Height="70" VerticalAlignment="Top" ToolTip="{DynamicResource Scan}" />

        <StackPanel Orientation="Horizontal"  Grid.Row="6" Grid.Column="2" HorizontalAlignment="Left" Visibility="{Binding OperatorBarcodeErrorVisibility}" Height="25"  Grid.ColumnSpan="3">
            <Image Height="24" Width="24" Source="/Emdep.Geos.Modules.SAM;component/Assets/Images/error.png" />
            <TextBlock Text="{Binding OperatorBarcodeError}" Foreground="{Binding OperatorBarcodeErrorColour}" FontWeight="SemiBold"  FontSize="20" VerticalAlignment="Center" HorizontalAlignment="Right" />
        </StackPanel>

        <Grid Grid.Column="2" Grid.Row="7"  HorizontalAlignment="Stretch" VerticalAlignment="Bottom" >
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="140"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!--Back-->
            <Button Grid.Column="0" Grid.Row="0" Width="150" 
                    HorizontalAlignment="Right" VerticalContentAlignment="Center"
                    Command="{Binding CommandBackButton}" 
                    FontSize="{StaticResource FontSize24}" FontWeight="Bold" 
                    Content="{DynamicResource Back}" />

            <!--Cancel-->
            <Button Grid.Column="2" Grid.Row="0" Width="150" 
                    HorizontalAlignment="Left" VerticalContentAlignment="Center"
                    Command="{Binding CommandCancelButton}" 
                    FontSize="{StaticResource FontSize24}" FontWeight="Bold" Focusable="False" 
                    Content="{DynamicResource Cancel}"/>

           
        </Grid>

    </Grid>
</dxwui:WinUIDialogWindow>
